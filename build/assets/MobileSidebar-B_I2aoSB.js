import{r as P,c as B,b as F,u as le,l as z,k as K,j as e,L as G,T as H,U as V,V as Q,W as X,X as J,Y as q,R as ce}from"./index-DcYk0AxP.js";import{M as de,d as fe,C as D}from"./constants-B8VJ7ujN.js";import{b as Z}from"./CTOApi-Cwjj3-E8.js";import{b as ee}from"./clientApi-rwsSybJ1.js";import{d as se}from"./staffApi-n-4bcpXQ.js";import{d as te}from"./userApi-byujQMQW.js";import{d as oe}from"./workerApi-BhtmJzV3.js";import{B as W}from"./Button-BYLj5R3i.js";import{t as $}from"./toast-BSC5QTk1.js";import{u as ae}from"./stageSelectionApi-DO4ZoQu_.js";function ue(d,f){P.useEffect(()=>{const N=t=>{t.ctrlKey&&t.key==="]"?(t.preventDefault(),f()):t.ctrlKey&&t.key==="["&&(t.preventDefault(),d())};window.addEventListener("keydown",N)},[f,d])}const xe=(d,f,N,t,u)=>{const w=t==null?void 0:t.some(s=>s.toLowerCase()==="projectdetails");let x={},l={},n={};if(w){let s=["DOCUMENTATION","WORKERS","INVITECLIENT","PREREQUISTIES","REQUIREMENTFORM","SITEMEASUREMENT","SAMPLEDESIGN","WORKSCHEDULE","TECHNICALCONSULTANT","SELECTSTAGE","PAYMENTCONFIRMATION","ORDERMATERIALS","MATERIALARRIVED","INSTALLATION","QUALITYCHECK","CLEANINGSANITATION","PROJECTDELIVERY"];const p=s.indexOf("TECHNICALCONSULTANT")+1;d==="Manual Flow"?s.splice(p,0,"MATERIALSELECTION","COSTESTIMATION"):d==="Modular Units"&&s.splice(p,0,"MODULARUNIT","EXTERNAL"),d!=null&&(s=s.filter(i=>i!=="SELECTSTAGE"));for(const i of s)f[i]&&u[i]&&N[i]&&(x[i]=f[i],l[i]=u[i],n[i]=N[i])}else x=f,l=u,n=N;let A=1,m=!1;const g={};for(const s of Object.keys(x))s==="REQUIREMENTFORM"&&(m=!0),m?(g[s]=`${A} ${x[s]}`,A++):g[s]=x[s];return{filteredLabels:g,filteredIcons:l,filteredPaths:n}},me=({labels:d,icons:f,path:N})=>{const[t,u]=P.useState(!1),{projectId:w}=B(),x=F(),l=le(),n=l.pathname.split("/"),{organizationId:A}=B(),m=z(),{role:g}=K(o=>o.authStore),[s,h]=P.useState(""),{data:p,isLoading:i}=ae(w),{mutateAsync:v,isPending:C}=Z(),{mutateAsync:y,isPending:T}=ee(),{mutateAsync:M,isPending:S}=se(),{mutateAsync:E,isPending:b}=te(),{mutateAsync:R,isPending:U}=oe(),k=()=>{u(!1)},r=()=>{u(!0)};P.useEffect(()=>{const c=l.pathname.split("/")[4];h(t?()=>de[c]:()=>fe[c])},[l.pathname,t]),ue(r,k);const a=!i&&p;let{filteredLabels:j,filteredIcons:ne,filteredPaths:I}=xe(a,d,N,n,f);const Y=n[2]==="projectdetails",ie=n[1]==="login",re=()=>{Y&&x(`/organizations/${A}/projects`),ie&&x("/organizations")},_=async()=>{var o,c;try{g==="CTO"?await v():g==="client"?await y():g==="staff"?await M():g==="owner"?await E():g==="worker"&&await R(),m(H()),m(V()),m(Q()),m(X()),m(J()),m(q()),$({title:"Success",description:"logout successfull"}),(!C||!T||!S||!b||!U)&&x("/")}catch(L){$({title:"Error",description:((c=(o=L==null?void 0:L.response)==null?void 0:o.data)==null?void 0:c.message)||"Failed to logout",variant:"destructive"})}};return e.jsx(e.Fragment,{children:t?e.jsxs("aside",{onMouseLeave:()=>u(!1),className:"relative flex flex-col bg-[#2f303a] w-[17%] min-h-screen max-h-screen text-[#9ca3af] select-none transition-all duration-300",children:[e.jsxs("div",{className:"flex flex-col flex-grow overflow-y-auto overflow-x-hidden custom-scrollbar p-2 large-scrollbar",children:[e.jsxs("div",{onClick:re,className:`flex ${Y?"cursor-pointer":""} justify-between items-center border-b-1 py-2`,children:[e.jsx("span",{className:"text-xl",children:D.COMPANY_NAME}),e.jsx("div",{className:"w-[30px] h-[30px]",children:e.jsx("img",{className:"w-full h-full",src:D.COMPANY_LOGO,alt:"LOGO"})})]}),e.jsxs("section",{className:"py-2 space-y-2",children:[" ",Object.entries(j).map(([o,c])=>{const L=s===c;return I[o]&&e.jsx(G,{to:I[o],className:"outline-none",children:e.jsxs("div",{onClick:()=>h(c),className:`cursor-pointer flex justify-between max-w-[95%] py-4 px-4 ${s===c?"bg-[#3a3b45] rounded-xl text-white":"rounded-xl hover:bg-[#3a3b45]"} `,ref:O=>{L&&O&&O.scrollIntoView({behavior:"smooth",block:"center"})},children:[e.jsx("span",{className:"text-lg",children:c}),e.jsx("span",{children:e.jsx("i",{className:"fa-solid fa-chevron-right"})})]})},c)})]})]}),e.jsxs("div",{className:"flex flex-col p-2 border-t border-[#3a3b45]",children:[n[1]!=="login"&&e.jsxs(W,{isLoading:C||T||S||b||U,onClick:_,className:"flex items-center gap-2 px-4 py-3 rounded-lg !bg-[#3a3b45] !text-[#9ca3af] hover:!bg-[#464751] hover:!text-white transition",children:[e.jsx("i",{className:"fa-solid fa-right-from-bracket"}),e.jsx("span",{children:"Logout"})]}),e.jsx("button",{title:"Ctrl+] to close",onClick:k,className:"mt-2 flex items-center justify-center outline-none border border-blue-600 text-blue-500 hover:bg-[#3a3b45] rounded-lg w-full py-2",children:e.jsx("i",{className:"fa-solid fa-chevron-left"})})]})]}):e.jsxs("aside",{onMouseEnter:()=>u(!0),className:"flex flex-col relative justify-between bg-[#2f303a] w-[6%]  max-h-full  text-[#9ca3af] transition-all duration-300 ",children:[e.jsx("div",{className:"max-h-[95%] overflow-y-auto overflow-x-hidden custom-scrollbar ",children:e.jsx("div",{className:"flex items-center flex-col justify-between w-full",children:Object.entries(ne).map(([o,c])=>{const L=(s==null?void 0:s.toLowerCase())===o.toLowerCase();return I[o]?e.jsx(G,{to:I[o],className:`${I[o]?"":"cursor-not-allowed"}`,children:e.jsx("div",{onClick:()=>h(o),className:`cursor-pointer flex justify-between max-w-[95%] py-4 px-4 ${(s==null?void 0:s.toLowerCase())===o.toLowerCase()?"bg-[#3a3b45] rounded-xl text-white":"rounded-xl hover:bg-[#3a3b45]"} `,ref:O=>{L&&O&&O.scrollIntoView({behavior:"smooth",block:"center"})},children:e.jsx("i",{className:`${c} ${(s==null?void 0:s.toLowerCase())===o.toLowerCase()?"text-[#4a86f7]":"text-[#9ca3af]"} `})})},o):e.jsx("div",{className:"cursor-not-allowed flex justify-between max-w-[95%] py-4 px-4",children:e.jsx("i",{className:`${c}`})})})})}),e.jsxs("div",{className:"flex flex-col items-center p-2 border-t border-[#3a3b45]",children:[n[1]!=="login"&&e.jsx(W,{isLoading:C||T||S||b||U,title:"logout",onClick:_,className:"w-[40px] h-[40px] flex items-center justify-center !bg-[#3a3b45] !text-[#9ca3af] hover:!text-red-500 transition",children:e.jsx("i",{className:"fa-solid fa-right-from-bracket"})}),e.jsx("button",{title:"Ctrl+[ to open",onClick:r,className:"mt-2 cursor-pointer outline-none border-[#9ca3af] h-[40px] w-[40px] flex items-center justify-center border rounded-lg",children:e.jsx("i",{className:"fa-solid fa-chevron-right text-[#4a86f7]"})})]})]})})},Ce=P.memo(me),Te=({isOpen:d,onClose:f,labels:N,path:t})=>{const u=F(),{organizationId:w,projectId:x}=B(),l=z(),{role:n}=K(r=>r.authStore),{data:A,isLoading:m}=ae(x),{mutateAsync:g,isPending:s}=Z(),{mutateAsync:h,isPending:p}=ee(),{mutateAsync:i,isPending:v}=se(),{mutateAsync:C,isPending:y}=te(),{mutateAsync:T,isPending:M}=oe(),S=async()=>{var r,a;try{n==="CTO"?await g():n==="client"?await h():n==="staff"?await i():n==="owner"?await C():n==="worker"&&await T(),l(H()),l(V()),l(Q()),l(X()),l(J()),l(q()),$({title:"Success",description:"logout successfull"}),(!s||!p||!v||!y||!M)&&u("/")}catch(j){$({title:"Error",description:((a=(r=j==null?void 0:j.response)==null?void 0:r.data)==null?void 0:a.message)||"Failed to logout",variant:"destructive"})}};let E=Object.entries(N);const b=location.pathname.split("/"),R=b[2]==="projectdetails";if(b.includes("projectdetails")&&!m){const r=A;E=E.filter(([a])=>{if(r){if(r==="Modular Units")return a!=="MATERIALSELECTION"&&a!=="COSTESTIMATION"&&a!=="SELECTSTAGE";if(r==="Manual Flow")return a!=="MODULARUNIT"&&a!=="SELECTSTAGE"}else return a!=="MODULARUNIT"&&a!=="MATERIALSELECTION"&&a!=="COSTESTIMATION";return!0})}const k=()=>{R&&u(`/organizations/${w}/projects`)};return e.jsxs(e.Fragment,{children:[d&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40",onClick:f}),e.jsxs("aside",{className:`fixed top-0 left-0 z-50 h-screen bg-white w-[75%] flex flex-col transition-transform duration-300 ${d?"translate-x-0":"-translate-x-full"}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsxs("div",{onClick:k,className:`flex items-center gap-3 ${R?"cursor-pointer":""}`,children:[e.jsx("img",{src:D.COMPANY_LOGO,alt:"Logo",className:"w-10 h-10 rounded-full object-cover"}),e.jsx("span",{className:"text-lg font-semibold",children:D.COMPANY_NAME})]}),e.jsx("button",{onClick:f,className:"text-xl text-gray-700",children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsx("nav",{className:"flex flex-col flex-grow overflow-y-auto p-4",children:E.map(([r,a],j)=>e.jsxs(ce.Fragment,{children:[t[r]?e.jsx(G,{to:t[r],onClick:f,className:"text-gray-800 hover:bg-gray-100 p-3 rounded block",children:a}):e.jsx("span",{className:"text-gray-400 p-3 rounded cursor-not-allowed block",children:a}),j<E.length-1&&e.jsx("hr",{className:"border-t border-gray-200 my-1"})]},r))}),e.jsx("div",{className:"border-t border-gray-200 p-4",children:b[1]!=="login"&&e.jsxs(W,{className:"w-full flex items-center justify-center gap-2",isLoading:s||p||v||y||M,onClick:S,children:[e.jsx("i",{className:"fas fa-sign-out-alt"})," Logout"]})})]})]})};export{Te as M,Ce as S};
