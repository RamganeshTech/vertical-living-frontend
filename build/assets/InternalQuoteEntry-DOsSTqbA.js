import{j as e,B as T,u as J,a as Y,q as H,g as X,d as $,t as O,b as Z,r as A,M as ue,c as pe,O as ge}from"./index-DyM6T-eT.js";import{u as ee}from"./projectApi-CMY3yoCw.js";import{S as he,a as fe,b as ye,c as Ne,d as je}from"./Select-CKRO57ug.js";import{e as be,f as we}from"./quoteVariantApi-m51q8T1h.js";import{C as ve,a as Ce}from"./Card-CnQJFMCV.js";import{d as Me,f as Se}from"./dateFormator-BGKi5rfZ.js";import{c as Te,u as ke}from"./labourRateconfigApi-DkdkZ9F8.js";import{S as Ae}from"./StageGuide-DzUcb6ZB.js";const K={plywood:1,laminate:1},Ie=()=>({itemName:"",plywoodNos:{quantity:0,thickness:0},laminateNos:{quantity:0,thickness:0},carpenters:0,days:0,profitOnMaterial:0,profitOnLabour:0,rowTotal:0,remarks:""}),W=()=>({itemName:"",description:"",quantity:0,cost:0,rowTotal:0}),G=(t,u)=>{if(t.length===0)return[];const g=t.length,c=t[0],p=c.carpenters*c.days*u*(1+(c.profitOnLabour||0)/100)/g;return t.map(b=>{var a,s;const S=((a=b.plywoodNos)==null?void 0:a.quantity)||0,C=((s=b.laminateNos)==null?void 0:s.quantity)||0,l=(S*K.plywood+C*K.laminate)*(1+(b.profitOnMaterial||0)/100);return{...b,rowTotal:Math.round(l+p)}})},Qe=({data:t,isEditing:u,labourCost:g,updateFurniture:c,removeFurniture:y})=>{const f=l=>{const a=l.coreMaterials.reduce((n,h)=>n+h.rowTotal,0),s=l.fittingsAndAccessories.reduce((n,h)=>n+h.rowTotal,0),i=l.glues.reduce((n,h)=>n+h.rowTotal,0),r=l.nonBrandMaterials.reduce((n,h)=>n+h.rowTotal,0);return{core:a,fittings:s,glues:i,nbms:r,furnitureTotal:a+s+i+r}},p=(l,a,s)=>{var m;const i=[...t.coreMaterials];a==="imageUrl"?(u&&(i[l].newImageFile=s),i[l].imageUrl=s,i[l].previewUrl=URL.createObjectURL(s)):a==="plywoodNos"||a==="laminateNos"?i[l][a]={...i[l][a]||{},...s}:i[l][a]=s;const r=G(i,g),n=((m=r==null?void 0:r[0])==null?void 0:m.profitOnMaterial)||0,h=(o,w=!1)=>o.map(k=>{const I=n,Q=w?k.cost||0:(k.quantity||0)*(k.cost||0),L=Q*(I/100),U=Math.round(Q+L);return{...k,profitOnMaterial:I,rowTotal:U}}),N={...t,coreMaterials:r,fittingsAndAccessories:h(t.fittingsAndAccessories),glues:h(t.glues,!0),nonBrandMaterials:h(t.nonBrandMaterials)};N.totals=f(N),c==null||c(N)},b=(l,a,s,i)=>{const r=[...t[l]];if(r[a][s]=i,l!=="glues"){const m=(r[a].quantity||0)*(r[a].cost||0),o=m*((r[a].profitOnMaterial||0)/100);r[a].rowTotal=Math.round(m+o)}else{const m=r[a].cost||0,o=m*((r[a].profitOnMaterial||0)/100);r[a].rowTotal=Math.round(m+o)}const n=a===r.length-1,h=r[a].itemName||r[a].description||r[a].quantity||r[a].cost;n&&h&&r.push(W());const N={...t,[l]:r};N.totals=f(N),c&&c(N)},S=()=>e.jsxs("div",{className:"mt-4",children:[e.jsxs("h3",{className:"font-semibold text-md mb-2",children:["Core Materials - Total: ₹",t==null?void 0:t.totals.core.toLocaleString("en-IN")]}),e.jsx("div",{className:"overflow-x-auto  rounded-md",children:e.jsxs("table",{className:"min-w-full text-sm bg-white shadow-sm",children:[e.jsxs("thead",{className:"bg-blue-50 text-sm font-semibold text-gray-600",children:[e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Image"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Item Name"}),e.jsx("th",{className:"text-center px-6 py-1 text-xs font-medium text-gray-500 uppercase tracking-wider",colSpan:2,children:"Plywood"}),e.jsx("th",{className:"text-center px-6 py-1 text-xs font-medium text-gray-500 uppercase tracking-wider",colSpan:2,children:"Laminate"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"No. of Carpenters / Day"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"No. of Days"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Profit % Material"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Profit % Labour"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Remarks"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Total"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Actions"})]}),e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-6 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Qty"}),e.jsx("th",{className:"text-center px-6 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Thk"}),e.jsx("th",{className:"text-center px-6 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Qty"}),e.jsx("th",{className:"text-center px-6 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Thk"})]})]}),e.jsx("tbody",{children:t.coreMaterials.map((l,a)=>e.jsxs("tr",{className:"group relative border-none !border-b-1 px-4 py-2 transition-all duration-150 hover:bg-gray-50",children:[a===0&&e.jsxs("td",{rowSpan:t.coreMaterials.length,children:[e.jsx("input",{type:"file",className:"w-full px-2 py-3 text-center outline-none",onChange:s=>{var i;return p(0,"imageUrl",(i=s.target.files)==null?void 0:i[0])}}),l.previewUrl&&e.jsx("img",{src:l.previewUrl,className:"h-10 mt-2 mx-auto"})]}),e.jsx("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{value:l.itemName,placeholder:"TV Unit | Wardrobe",onChange:s=>p(a,"itemName",s.target.value),className:"w-full px-2 py-1 text-center outline-none"})}),["plywoodNos","laminateNos"].map(s=>["quantity","thickness"].map(i=>e.jsx("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",placeholder:`${i==="quantity"?"QTY":"THK"}`,value:l[s][i]||"",onChange:r=>{Number(r.target.value)>=0&&p(a,s,{...l[s],[i]:Number(r.target.value)})},className:"w-full px-2 py-1 text-center outline-none"})},`${s}-${i}`))),a===0&&e.jsxs(e.Fragment,{children:[e.jsx("td",{rowSpan:t.coreMaterials.length,className:"px-1 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",placeholder:"no of carpentors",value:l.carpenters||"",onChange:s=>p(a,"carpenters",Number(s.target.value)),className:"w-full px-[2px] py-1 text-center outline-none"})}),e.jsx("td",{rowSpan:t.coreMaterials.length,className:"px-1 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",placeholder:"no of days",value:l.days||"",onChange:s=>p(a,"days",Number(s.target.value)),className:"w-full px-[2px] py-1 text-center outline-none"})})]}),e.jsx("td",{className:"px-1 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",placeholder:"profit percent",value:l.profitOnMaterial||"",onChange:s=>p(a,"profitOnMaterial",Number(s.target.value)),className:"w-full px-[2px] py-1 text-center outline-none"})}),a===0&&e.jsx(e.Fragment,{children:e.jsx("td",{rowSpan:t.coreMaterials.length,className:"px-1 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",placeholder:"profit percent",value:l.profitOnLabour||"",onChange:s=>p(a,"profitOnLabour",Number(s.target.value)),className:"w-full px-[2px] py-1 text-center outline-none"})})}),e.jsx("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{value:l.remarks,placeholder:"remarks",onChange:s=>p(a,"remarks",s.target.value),className:"w-full px-2 py-1 text-center outline-none"})}),e.jsxs("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:["₹",l.rowTotal.toLocaleString("en-IN")]}),e.jsx("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx(T,{variant:"danger",onClick:()=>{const s=[...t.coreMaterials];s.splice(a,1);const i=G(s,g),r={...t,coreMaterials:i};r.totals=f(r),c==null||c(r)},className:"px-1 text-xs bg-red-600 text-white",children:"Remove"})})]},a))})]})}),e.jsx("div",{className:"mt-2 text-right",children:e.jsx(T,{onClick:()=>{const l=[...t.coreMaterials,Ie()],a=G(l,g),s={...t,coreMaterials:a};s.totals=f(s),c==null||c(s)},children:"+ Add Core Material"})})]}),C=(l,a)=>{var s;return e.jsxs("div",{className:"mt-6",children:[e.jsxs("h3",{className:"font-semibold text-md mb-2",children:[l," - Total: ₹",(s=t==null?void 0:t.totals[a==="fittingsAndAccessories"?"fittings":a])==null?void 0:s.toLocaleString("en-IN")]}),e.jsx("div",{className:"overflow-x-auto  rounded-md",children:e.jsxs("table",{className:"min-w-full text-sm bg-white shadow-sm",children:[e.jsx("thead",{className:"bg-blue-50 text-sm font-semibold text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Item Name"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Description"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Quantity"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cost"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Profit %"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{children:t[a].map((i,r)=>e.jsxs("tr",{className:"group relative border-none !border-b-1 px-4 !py-2 transition-all duration-150 hover:bg-gray-50",children:[e.jsx("td",{className:"p-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{value:i.itemName||"",placeholder:"Item Name",onChange:n=>b(a,r,"itemName",n.target.value),className:"w-full px-2 py-1 text-center outline-none"})}),e.jsx("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{value:i.description,placeholder:"description",onChange:n=>b(a,r,"description",n.target.value),className:"w-full px-2 py-1 text-center outline-none"})}),e.jsx("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",placeholder:"enter quantity",value:i.quantity||"",onChange:n=>{Number(n.target.value)>=0&&b(a,r,"quantity",Number(n.target.value))},className:"w-full px-2 py-1 text-center outline-none"})}),e.jsx("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",value:i.cost||"",placeholder:"enter cost",onChange:n=>b(a,r,"cost",Number(n.target.value)),className:"w-full px-2 py-1 text-center outline-none"})}),e.jsx("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",placeholder:"enter profit",value:(i.profitOnMaterial??0)||"",onChange:n=>b(a,r,"profitOnMaterial",Number(n.target.value)),className:"w-full px-2 py-1 text-center outline-none"})}),e.jsxs("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:["₹",i.rowTotal.toLocaleString("en-IN")]}),e.jsx("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx(T,{variant:"danger",onClick:()=>{const n=[...t[a]];n.splice(r,1);const h={...t,[a]:n};h.totals=f(h),c&&c(h)},className:"px-1 text-xs bg-red-600 text-white",children:"Remove"})})]},r))})]})}),e.jsx("div",{className:"mt-2 text-right",children:e.jsxs(T,{onClick:()=>{const i=[...t[a],W()],r={...t,[a]:i};r.totals=f(r),c&&c(r)},children:["+ Add ",l," Item"]})})]})};return e.jsxs("div",{className:"shadow-md p-4 my-4 border rounded-lg bg-white",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-700",children:["Product: ",t.furnitureName]}),y&&e.jsx(T,{variant:"danger",size:"sm",onClick:y,className:"bg-red-600 text-white",children:"Remove Product"})]}),S(),C("Fittings","fittingsAndAccessories"),C("Glues","glues"),C("Non-Branded Materials","nonBrandMaterials"),e.jsxs("div",{className:"mt-6 text-right text-xl text-green-700 font-bold",children:["Product Total: ₹",t.totals.furnitureTotal.toLocaleString("en-IN")]})]})},Oe=async({api:t,organizationId:u,projectId:g,formData:c})=>{const{data:y}=await t.post(`/quote/quotegenerate/createquote/${u}/${g}`,c,{headers:{"Content-Type":"multipart/form-data"}});if(!y.ok)throw new Error(y.message||"Failed to create quote.");return y.data},Pe=async({api:t,organizationId:u,id:g,projectId:c,formData:y})=>{const f=await t.put(`/quote/quotegenerate/editquote/${u}/${c}/${g}`,y);if(!f.data.ok)throw new Error(f.data.message||"Failed to create quote.");return f.data.data},Ee=()=>{const t=["owner","staff","CTO"],{role:u}=J(),g=X(u);return Y({mutationFn:async({organizationId:c,projectId:y,formData:f})=>{if(!u||!t.includes(u))throw new Error("Not allowed to create quotes");if(!g)throw new Error("API instance for role not found");return await Oe({api:g,organizationId:c,projectId:y,formData:f})},onSuccess:(c,{organizationId:y})=>{H.invalidateQueries({queryKey:["quote-material-items",y]})}})},Le=()=>{const t=["owner","staff","CTO"],{role:u}=J(),g=X(u);return Y({mutationFn:async({organizationId:c,projectId:y,formData:f,id:p})=>{if(!u||!t.includes(u))throw new Error("Not allowed to create quotes");if(!g)throw new Error("API instance for role not found");return await Pe({api:g,organizationId:c,projectId:y,formData:f,id:p})},onSuccess:(c,{organizationId:y})=>{H.invalidateQueries({queryKey:["quote-material-items",y]})}})},Ue=({quote:t,organizationId:u,setFurnitures:g,setIsEditingId:c,setQuoteType:y,setEditQuoteNo:f,setFiltersMain:p})=>{var i,r,n;const{mutateAsync:b,isPending:S}=be(),{role:C,permission:l}=$(),a=C==="owner"||((i=l==null?void 0:l.internalquote)==null?void 0:i.delete),s=async h=>{var N,m;try{await b({id:h,organizationId:u}),O({title:"Success",description:"Items deleted successfully"})}catch(o){O({title:"Error",description:((m=(N=o==null?void 0:o.response)==null?void 0:N.data)==null?void 0:m.message)??"Operation failed"})}};return e.jsx(ve,{className:"w-full border-l-4 border-blue-600 shadow-md bg-white hover:shadow-lg transition-all",children:e.jsxs(Ce,{className:"p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"my-1",children:[e.jsxs("h3",{className:"text-base font-bold text-blue-700 leading-[8px] ",children:["Project: ",e.jsx("span",{className:"text-black",children:((r=t==null?void 0:t.projectId)==null?void 0:r.projectName)||"Project"})]}),e.jsxs("span",{className:"text-[12px] font-semibold text-gray-500",children:["Quote No: ",e.jsx("span",{className:"text-black",children:t.quoteNo||"N/A"})]})]}),e.jsxs("p",{className:"text-xs text-gray-500 ",children:["Created on: ",Me(t.createdAt)," -  ",Se(t.createdAt)]})]}),e.jsx("i",{className:"fas fa-file-alt text-gray-400 text-xl"})]}),e.jsxs("p",{className:"text-sm text-gray-500 italic",children:[e.jsx("strong",{children:"Furnitures: "})," ",((n=t.furnitures)==null?void 0:n.length)||0]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsxs(T,{size:"sm",variant:"secondary",onClick:()=>{const{furnitures:h}=t,N=h.map(m=>({furnitureName:m.furnitureName,coreMaterials:m.coreMaterials.map(o=>({itemName:(o==null?void 0:o.itemName)||"",plywoodNos:(o==null?void 0:o.plywoodNos)||{quantity:0,thickness:0},laminateNos:o.laminateNos||{quantity:0,thickness:0},carpenters:o.carpenters||0,days:o.days||0,profitOnMaterial:o.profitOnMaterial||0,profitOnLabour:o.profitOnLabour||0,rowTotal:o.rowTotal||0,remarks:o.remarks||"",imageUrl:o.imageUrl||"",previewUrl:o.imageUrl||""})),fittingsAndAccessories:m.fittingsAndAccessories||[],glues:m.glues||[],nonBrandMaterials:m.nonBrandMaterials||[],totals:{core:m.coreMaterialsTotal||0,fittings:m.fittingsAndAccessoriesTotal||0,glues:m.gluesTotal||0,nbms:m.nonBrandMaterialsTotal||0,furnitureTotal:m.furnitureTotal||0}}));console.log("parsedFurniture",N),f(t==null?void 0:t.quoteNo),g(N),c(t._id),y(()=>{var m;return((m=t==null?void 0:t.furnitures)==null?void 0:m.length)>1?"residential":"single"}),p({projectId:t.projectId._id,projectName:t.projectId.projectName})},children:[e.jsx("i",{className:"fas fa-eye mr-1"})," Edit"]}),a&&e.jsxs(T,{size:"sm",isLoading:S,variant:"danger",className:"bg-red-600 text-white",onClick:()=>s(t._id),children:[e.jsx("i",{className:"fas fa-trash mr-1"})," Delete"]})]})]})})},Be=({setFurnitures:t,setEditQuoteNo:u,setIsEditingId:g,setFiltersMain:c,setQuoteType:y})=>{var m;const{organizationId:f}=Z(),[p,b]=A.useState({projectId:"",projectName:"",createdAt:""}),{role:S,permission:C}=$(),l=S==="owner"||((m=C==null?void 0:C.internalquote)==null?void 0:m.list),{data:a}=ee(f),s=a==null?void 0:a.map(o=>({_id:o._id,projectName:o.projectName})),{data:i,isLoading:r}=we(f,{createdAt:p.createdAt,projectId:p.projectId,quoteNo:""}),n=i==null?void 0:i.filter(o=>o.furnitures.length),h=()=>{b({projectId:"",projectName:"",createdAt:""})},N=Object.values(p).filter(Boolean).length;return e.jsx("div",{children:e.jsxs("main",{className:"flex gap-2 !max-h-[80vh]",children:[e.jsx("div",{className:"xl:w-80 flex-shrink-0",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-filter mr-2 text-blue-600"}),"Filters"]}),N>0&&e.jsxs("button",{onClick:h,className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:["Clear All (",N,")"]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Created Date"}),e.jsx("input",{type:"date",onChange:o=>b(w=>({...w,createdAt:o.target.value})),value:p.createdAt,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Project"}),e.jsx("select",{value:(p==null?void 0:p.projectId)||"",onChange:o=>{const w=s==null?void 0:s.find(k=>k._id===o.target.value);w&&b(k=>({...k,projectId:w._id,projectName:w.projectName}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:s==null?void 0:s.map(o=>e.jsx("option",{value:o._id,children:o.projectName},o._id))})]})]})]})}),l&&e.jsx("section",{className:"w-full max-h-full  gap-2  overflow-y-auto  min-h-full",children:r?e.jsx(ue,{}):n!=null&&n.length?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:n==null?void 0:n.map(o=>e.jsx(e.Fragment,{children:e.jsx(Ue,{setEditQuoteNo:u,setFurnitures:t,setIsEditingId:g,setQuoteType:y,setFiltersMain:c,quote:o,organizationId:f},o._id)}))}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center text-gray-700",children:[e.jsx("i",{className:"fas fa-file-circle-exclamation text-gray-300 text-7xl mb-4"}),e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"No Quotes Found"}),e.jsxs("p",{className:"text-base text-gray-500 leading-relaxed max-w-md",children:["You haven't generated any quote variants yet.",e.jsx("br",{}),"Please create a quote by clicking the + Product section to view brand-wise breakdowns here."]})]})})]})})},E=t=>t.filter(u=>{var g,c;return!!((g=u.itemName)!=null&&g.trim())||!!((c=u.description)!=null&&c.trim())}),We=()=>{var D,V;const t=pe(),{organizationId:u}=Z(),{data:g}=ee(u),[c,y]=A.useState({categoryId:"",categoryName:""});let{data:f=0}=Te({organizationId:u,categoryId:c.categoryId}),{data:p=[]}=ke(u);A.useEffect(()=>{if(p&&(p==null?void 0:p.length)>0&&!c.categoryId){const d=p[0];y({categoryId:d._id,categoryName:d.name})}},[p]);const{role:b,permission:S}=$(),C=b==="owner"||((D=S==null?void 0:S.internalquote)==null?void 0:D.create),l=b==="owner"||((V=S==null?void 0:S.internalquote)==null?void 0:V.edit),a=A.useMemo(()=>(g==null?void 0:g.map(d=>({_id:d._id,projectName:d.projectName})))||[],[g]),[s,i]=A.useState({projectId:"",projectName:""}),[r,n]=A.useState([]),[h,N]=A.useState(!1),[m,o]=A.useState(""),[w,k]=A.useState(null),[I,Q]=A.useState(null),[L,U]=A.useState(null),{mutateAsync:te,isPending:re}=Ee(),{mutateAsync:ae,isPending:se}=Le(),ne=d=>{Q(d)},oe=()=>I==="single"?"Single Quote":I==="residential"?"Residential Quote":"";A.useEffect(()=>{I==="single"&&!w?(n([]),F("Common Category")):I==="residential"&&!w&&(n([]),N(!0))},[I]),console.log("furnitures",r);const F=d=>{n(j=>[...j,{furnitureName:d,coreMaterials:[ie()],fittingsAndAccessories:[_()],glues:[_()],nonBrandMaterials:[_()],totals:{core:0,fittings:0,glues:0,nbms:0,furnitureTotal:0}}])},le=d=>{n(j=>j.filter((x,v)=>v!==d))},ie=()=>({itemName:"",plywoodNos:{quantity:0,thickness:0},laminateNos:{quantity:0,thickness:0},carpenters:0,days:0,profitOnMaterial:0,profitOnLabour:0,rowTotal:0,remarks:""}),_=()=>({itemName:"",description:"",quantity:0,cost:0,rowTotal:0}),R=r==null?void 0:r.reduce((d,j)=>d+j.totals.furnitureTotal,0),ce=async()=>{var d,j;try{if(!s.projectId){O({title:"Error",description:"Please select a project",variant:"destructive"});return}const x=new FormData;x.append("furnitures",JSON.stringify(r.map(v=>({furnitureName:v.furnitureName,coreMaterials:v.coreMaterials.map(M=>{if(Object.values(M).some(P=>!!P)){const{imageUrl:P,previewUrl:B,...q}=M;return q}return null}).filter(Boolean),fittingsAndAccessories:E(v.fittingsAndAccessories),glues:E(v.glues),nonBrandMaterials:E(v.nonBrandMaterials),coreMaterialsTotal:v.totals.core,fittingsAndAccessoriesTotal:v.totals.fittings,gluesTotal:v.totals.glues,nonBrandMaterialsTotal:v.totals.nbms,furnitureTotal:v.totals.furnitureTotal})))),r.forEach((v,M)=>{v.coreMaterials.forEach((P,B)=>{P.imageUrl&&x.append(`images[${M}][${B}]`,P.imageUrl)})}),x.append("grandTotal",R.toString()),x.append("notes","Generated"),await te({organizationId:u,projectId:s.projectId,formData:x}),O({title:"Success",description:"Created Successfully, Visit in Quote Generator Section"}),n([]),Q(null)}catch(x){O({title:"Error",description:((j=(d=x==null?void 0:x.response)==null?void 0:d.data)==null?void 0:j.message)||(x==null?void 0:x.message)||"failed to generate the items",variant:"destructive"})}},de=async()=>{var d,j;try{if(!s.projectId){O({title:"Error",description:"Please select a project",variant:"destructive"});return}const x=new FormData,v=r.map((M,P)=>{const B=M.coreMaterials.map((q,me)=>{const{previewUrl:Fe,newImageFile:z,...xe}=q;return z&&x.append(`images[${P}][${me}]`,z),{...xe,imageUrl:q.imageUrl||null}});return{furnitureName:M.furnitureName,coreMaterials:B,fittingsAndAccessories:E(M.fittingsAndAccessories),glues:E(M.glues),nonBrandMaterials:E(M.nonBrandMaterials),coreMaterialsTotal:M.totals.core,fittingsAndAccessoriesTotal:M.totals.fittings,gluesTotal:M.totals.glues,nonBrandMaterialsTotal:M.totals.nbms,furnitureTotal:M.totals.furnitureTotal}});x.append("furnitures",JSON.stringify(v)),x.append("grandTotal",R.toString()),x.append("notes","Updated via frontend"),L&&x.append("quoteNo",L),w&&(await ae({organizationId:u,projectId:s.projectId,formData:x,id:w}),O({title:"Updated!",description:"Quote edited successfully."}),n([]),Q(null),k(null))}catch(x){O({title:"Error",description:((j=(d=x==null?void 0:x.response)==null?void 0:d.data)==null?void 0:j.message)||(x==null?void 0:x.message)||"Failed to Update the Quote",variant:"destructive"})}};return location.pathname.includes("internalquotenew")?e.jsx(ge,{}):e.jsxs("div",{className:`h-full mx-auto max-h-full ${w?"overflow-y-auto":""} `,children:[e.jsxs("header",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 py-1 border-b-1 border-[#818283]",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-file mr-3 text-blue-600"}),"Internal Quote Entry"]}),(r==null?void 0:r.length)>0&&e.jsxs("p",{className:"ml-[30px] mt-[5px] block text-[15px] text-gray-800",children:["Single Labour cost:  ",e.jsxs("span",{className:"text-black font-semibold",children:["₹",f]})]})]}),e.jsxs("div",{className:"flex gap-6 items-center ",children:[e.jsx("div",{children:e.jsxs(T,{className:"flex items-center",onClick:()=>{t("internalquotenew")},children:[e.jsx("i",{className:"fas fa-new mr-1",children:" "})," New Version"]})}),C&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Select QuoteType"}),e.jsxs(he,{onValueChange:d=>ne(d),children:[e.jsx(fe,{className:"w-full",children:e.jsx(ye,{placeholder:"Select Quote",selectedValue:I||""})}),e.jsx(Ne,{children:["single","residential"].map(d=>e.jsx(je,{value:d.toString(),children:d},d))})]})]}),C&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Select Project *"}),e.jsxs("select",{value:s.projectId,onChange:d=>{const j=a.find(x=>x._id===d.target.value);j&&i({projectId:j._id,projectName:j.projectName})},className:" px-2 py-2 rounded-xl border border-blue-200 focus:border-blue-200 active:border-blue-200",children:[e.jsx("option",{value:"",children:"Select a project"}),a.map(d=>e.jsx("option",{value:d._id,children:d.projectName},d._id))]})]}),r.length>0&&e.jsxs("div",{className:"text-right flex gap-2 items-center",children:[e.jsx("div",{className:"text-xs text-gray-600 uppercase tracking-widest",children:"Grand Total"}),e.jsxs("div",{className:"text-xl font-semibold text-green-600",children:["₹",R.toLocaleString("en-IN")]})]}),C&&e.jsxs(T,{className:"flex items-center",onClick:()=>{N(!0)},children:[e.jsx("i",{className:"fas fa-add mr-1",children:" "})," Create"]}),e.jsx("div",{className:"w-full sm:w-auto flex justify-end sm:block",children:e.jsx(Ae,{organizationId:u,stageName:"materialquote"})})]})]}),h&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 bg-opacity-40 backdrop-blur-sm transition",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg p-6 w-full max-w-md relative animate-scaleIn",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-800",children:"Add New Quote"}),e.jsx("input",{className:"w-full border border-gray-300 rounded px-3 py-2 mb-4 outline-none focus:ring-2 focus:ring-blue-400",placeholder:"Enter Product Name",value:m,autoFocus:!0,onChange:d=>o(d.target.value),onKeyDown:d=>{if(d.key==="Enter"){if(!m.trim())return;F(m),o(""),N(!1)}}}),e.jsxs("div",{className:"flex justify-end gap-3 mt-4",children:[e.jsx(T,{variant:"secondary",onClick:()=>N(!1),children:"Cancel"}),e.jsx(T,{onClick:()=>{m.trim()&&(F(m),o(""),N(!1))},children:"Create"})]})]})}),r.length>0&&e.jsxs("section",{className:"shadow overflow-y-auto max-h-[86%]",children:[!w&&e.jsx("h1",{className:"text-2xl text-gray-500",children:oe()}),r.map((d,j)=>e.jsx(Qe,{index:j,labourCost:f,data:d,updateFurniture:x=>{const v=[...r];v[j]=x,n(v)},removeFurniture:()=>le(j),isEditing:!!w},j))]}),r.length!==0&&e.jsxs("div",{className:"mt-1 text-right flex gap-2 justify-end",children:[(C||l)&&e.jsx(T,{variant:"primary",isLoading:re||se,onClick:w?de:ce,className:"px-6 py-2 bg-blue-600 text-white rounded",children:"Save Quote"}),!w&&(C||l)&&e.jsx(T,{variant:"secondary",onClick:()=>{n([]),Q(null)},className:"",children:"Cancel"}),w&&e.jsx(T,{variant:"secondary",onClick:()=>{k(null),n([]),Q(null),U(null)},className:"",children:"Cancel"})]}),!w&&(r==null?void 0:r.length)===0&&e.jsx("section",{className:"my-4",children:e.jsx(Be,{setEditQuoteNo:U,setIsEditingId:k,setFurnitures:n,setQuoteType:Q,setFiltersMain:i})})]})};export{We as default,E as filterValidSimpleRows};
