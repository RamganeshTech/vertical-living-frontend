import{r as g,j as e}from"./index-C0KkMjHg.js";import{b as O,c as V,d as $}from"./expenseApi-B-BrhCqT.js";import{t as x}from"./toast-BSC5QTk1.js";import{u as I}from"./vendorAccApi-CCK3L5-I.js";import{L as A}from"./Label-0ovsOw6V.js";import{S as F}from"./SearchSelectNew-BcESoLUi.js";const M=({mode:a,organizationId:b,expenseId:c,onSuccess:i,onCancel:w})=>{var N;const f=O(),v=V(),{data:o,isLoading:C}=$(c||"",a!=="create"&&!!c),{data:m}=I(b),E=(N=m||[])==null?void 0:N.map(r=>({value:r._id,label:r.vendorName,email:r.email})),[t,u]=g.useState({vendorId:"",vendorName:"",amount:0,dateOfPayment:new Date,paidThrough:"",notes:""}),[l,y]=g.useState({});g.useEffect(()=>{o&&(a==="edit"||a==="view")&&u({vendorId:o.vendorId,vendorName:o.vendorName,amount:o.amount,dateOfPayment:new Date(o.dateOfPayment),paidThrough:o.paidThrough,notes:o.notes||""})},[o,a]);const P=()=>{const r={};return t.vendorId.trim()||(r.vendorId="Vendor is required"),t.vendorName.trim()||(r.vendorName="Vendor name is required"),t.amount<=0&&(r.amount="Amount must be greater than 0"),t.paidThrough.trim()||(r.paidThrough="Payment method is required"),y(r),Object.keys(r).length===0},p=r=>{const{name:s,value:d}=r.target;u(h=>({...h,[s]:s==="amount"?parseFloat(d)||0:d})),l[s]&&y(h=>({...h,[s]:void 0}))},T=r=>{u(s=>({...s,dateOfPayment:new Date(r.target.value)}))},k=r=>{const s=m==null?void 0:m.find(d=>d._id===r);u(d=>({...d,vendorId:r||"",vendorName:(s==null?void 0:s.vendorName)||""}))},D=async r=>{if(r.preventDefault(),a!=="view"){if(!P()){x({title:"Error",description:"Please fix the errors in the form"});return}try{a==="create"?(await f.mutateAsync({organizationId:b,...t}),x({title:"Success",description:"Expense created successfully!"}),i==null||i()):a==="edit"&&c&&(await v.mutateAsync({id:c,...t}),x({title:"Success",description:"Expense updated successfully!"}),i==null||i())}catch(s){throw x({title:"Error",description:s.message||"Failed to submit expense"}),s}}};if(a!=="create"&&C)return e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})});const n=a==="view",j=f.isPending||v.isPending;return e.jsxs("form",{onSubmit:D,className:"space-y-6",children:[e.jsxs("div",{className:"border-b pb-4",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900",children:[a==="create"&&"Create New Expense",a==="edit"&&"Edit Expense",a==="view"&&"Expense Details"]}),a==="view"&&o&&e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Invoice: ",o.invoiceNumber]})]}),e.jsxs("div",{children:[e.jsx(A,{children:"Label"}),e.jsx(F,{options:E,placeholder:"Select Vendor",searchPlaceholder:"Search Vendor...",value:(t==null?void 0:t.vendorId)||void 0,onValueChange:r=>k(r),searchBy:"name",displayFormat:"simple",className:"w-full"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Vendor Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"vendorName",value:t.vendorName,onChange:p,disabled:n,className:`w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 
                        ${l.vendorName?"border-red-500":"border-gray-300"}
                        ${n?"bg-gray-100 cursor-not-allowed":""}`,placeholder:"Enter vendor name"}),l.vendorName&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:l.vendorName})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Amount ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-2.5 text-gray-500",children:"$"}),e.jsx("input",{type:"number",name:"amount",value:t.amount,onChange:p,disabled:n,step:"0.01",min:"0",className:`w-full pl-8 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 
                            ${l.amount?"border-red-500":"border-gray-300"}
                            ${n?"bg-gray-100 cursor-not-allowed":""}`,placeholder:"0.00"})]}),l.amount&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:l.amount})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date of Payment"}),e.jsx("input",{type:"date",value:t.dateOfPayment.toISOString().split("T")[0],onChange:T,disabled:n,className:`w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 
                        ${n?"bg-gray-100 cursor-not-allowed":"border-gray-300"}`})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Paid Through ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{name:"paidThrough",value:t.paidThrough,onChange:p,disabled:n,className:`w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 
                        ${l.paidThrough?"border-red-500":"border-gray-300"}
                        ${n?"bg-gray-100 cursor-not-allowed":""}`,children:[e.jsx("option",{value:"",children:"Select payment method"}),e.jsx("option",{value:"Cash",children:"Cash"}),e.jsx("option",{value:"Bank Transfer",children:"Bank Transfer"}),e.jsx("option",{value:"Credit Card",children:"Credit Card"}),e.jsx("option",{value:"Debit Card",children:"Debit Card"}),e.jsx("option",{value:"Check",children:"Check"}),e.jsx("option",{value:"UPI",children:"UPI"}),e.jsx("option",{value:"Other",children:"Other"})]}),l.paidThrough&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:l.paidThrough})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes"}),e.jsx("textarea",{name:"notes",value:t.notes,onChange:p,disabled:n,rows:4,className:`w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 
                        ${n?"bg-gray-100 cursor-not-allowed":"border-gray-300"}`,placeholder:"Add any additional notes..."})]}),e.jsxs("div",{className:"flex gap-4 pt-4 border-t",children:[!n&&e.jsx("button",{type:"submit",disabled:j,className:`flex-1 bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 \r
                            disabled:opacity-50 disabled:cursor-not-allowed transition-colors`,children:j?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsxs("svg",{className:"animate-spin h-5 w-5",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),a==="create"?"Creating...":"Updating..."]}):a==="create"?"Create Expense":"Update Expense"}),e.jsx("button",{type:"button",onClick:w,className:`flex-1 bg-gray-200 text-gray-700 py-2 px-4 rounded-lg \r
                        hover:bg-gray-300 transition-colors`,children:n?"Close":"Cancel"})]})]})};export{M as E};
