import{r as l,j as e,b as R,u as F,a as O,O as B}from"./index-C1DtYOG4.js";import{B as $}from"./Button-D6HVPia8.js";import D from"./MaterialOverviewLoading-B_RCn-RH.js";import{u as T}from"./projectApi-CV3wP0VJ.js";import{u as _}from"./accountingApi-DSnTVXrk.js";import{d as M}from"./dateFormator-BGKi5rfZ.js";import"./Skeleton-CR6oVN79.js";import"./useQuery-DD9aZBjN.js";import"./useMutation-BgVKkKtF.js";import"./roleCheck-vyRiFK58.js";import"./useInfiniteQuery-4I03x6LQ.js";const V=({isOpen:s,onClose:a,sections:g,heading:d,subHeading:x})=>{const m=l.useRef(null);return l.useEffect(()=>{const r=i=>{i.key==="Escape"&&a()};return document.addEventListener("keydown",r),()=>document.removeEventListener("keydown",r)},[a]),e.jsxs(e.Fragment,{children:[s&&e.jsx("div",{className:"fixed inset-0 bg-black/10 bg-opacity-30 z-40",onClick:a}),e.jsxs("div",{ref:m,className:`fixed left-1/2 top-[90px] -translate-x-1/2 z-50 max-w-6xl bg-white rounded-lg shadow-xl transition-all duration-300 transform ${s?"translate-y-0 opacity-100 visible":"-translate-y-5 opacity-0 invisible"}`,children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-b-[#9a9c9e] px-6 py-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:d}),x&&e.jsx("p",{className:"text-sm text-gray-500",children:x})]}),e.jsx("button",{onClick:a,className:"text-gray-500 hover:text-gray-700 cursor-pointer",title:"Close",children:e.jsx("i",{className:"fas fa-xmark text-xl"})})]}),e.jsx("div",{className:"p-6 max-h-[400px] max-w-full overflow-x-auto overflow-y-auto",style:{whiteSpace:"nowrap"},children:g.map((r,i)=>e.jsxs("div",{className:"inline-block align-top mr-6 vertical-section",style:{verticalAlign:"top",whiteSpace:"normal"},children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-500 mb-3",children:r.title}),e.jsx("div",{className:"flex flex-col gap-2",children:r.items.map((p,f)=>e.jsxs("button",{onClick:p.onClick,className:"flex cursor-pointer items-center px-2 py-1.5 rounded-md text-sm text-gray-700 hover:bg-gray-100 transition w-44 text-left",children:[e.jsx("i",{className:`${p.icon} mr-2 text-[14px] w-4`}),e.jsx("span",{children:p.label})]},f))})]},i))})]})]})},G=({data:s,index:a,onView:g})=>{var m;const d=r=>{switch(r==null?void 0:r.toLowerCase()){case"paid":return"bg-green-100 text-green-700 border-green-200";case"pending":return"bg-orange-100 text-orange-700 border-orange-200";case"cancelled":return"bg-red-100 text-red-700 border-red-200";default:return"bg-gray-100 text-gray-600 border-gray-200"}},x=r=>{switch(r){case"Bill Acc":return"fa-file-invoice text-purple-500";case"Expense Acc":return"fa-receipt text-pink-500";case"Payment Acc":return"fa-money-check-alt text-green-500";default:return"fa-file-alt text-gray-400"}};return e.jsxs("div",{onClick:g,className:"grid grid-cols-12 gap-4 px-6 py-4 hover:bg-blue-50/30 transition-colors cursor-pointer items-center",children:[e.jsx("div",{className:"col-span-1 text-center text-gray-400 font-medium text-sm",children:a+1}),e.jsx("div",{className:"col-span-2",children:e.jsx("span",{className:"font-mono text-xs font-bold text-gray-700 bg-gray-100 px-2 py-1 rounded border border-gray-200",children:s.recordNumber||"N/A"})}),e.jsx("div",{className:"col-span-3",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold text-gray-900 truncate text-sm",title:s.personName,children:s.personName||"Unknown Payee"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("i",{className:`fas ${x(s.type)} text-[10px]`}),e.jsx("span",{className:"text-[10px] text-gray-500 uppercase tracking-wide",children:s.type})]})]})}),e.jsx("div",{className:"col-span-2 text-sm text-gray-600",children:M(s.createdAt)}),e.jsxs("div",{className:"col-span-2 text-right font-bold text-gray-800 text-sm",children:["â‚¹",((m=s.amount)==null?void 0:m.toLocaleString("en-IN"))||"0.00"]}),e.jsx("div",{className:"col-span-1 text-center",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-[10px] font-bold uppercase border ${d(s.status)}`,children:s.status||"Pending"})}),e.jsx("div",{className:"col-span-1 text-center",children:e.jsx("button",{className:"text-blue-600 hover:bg-blue-100 p-2 rounded-full transition-colors",children:e.jsx("i",{className:"fas fa-chevron-right text-xs"})})})]})},te=()=>{const{organizationId:s}=R(),a=F(),g=O(),d=l.useRef(null),x=[{title:"Sales Transactions",items:[{label:"Invoice",path:`/organizations/${s}/projects/invoicemain`,icon:"fas fa-file-invoice text-blue-600",onClick:()=>a(`/organizations/${s}/projects/invoicemain`)},{label:"Retail Invoice",path:`/organizations/${s}/projects/retailinvoicemain`,icon:"fas fa-receipt text-blue-600",onClick:()=>a(`/organizations/${s}/projects/retailinvoicemain`)},{label:"Sales Order",path:`/organizations/${s}/projects/salesordermain`,icon:"fas fa-shopping-cart text-blue-600",onClick:()=>a(`/organizations/${s}/projects/salesordermain`)},{label:"Purchase Orders",path:`/organizations/${s}/projects/purchasemain`,icon:"fas fa-wallet text-blue-600",onClick:()=>a(`/organizations/${s}/projects/purchasemain`)}]},{title:"Expense Transactions",items:[{label:"Expense",path:`/organizations/${s}/projects/expensemain`,icon:"fas fa-money-bill text-blue-600",onClick:()=>a(`/organizations/${s}/projects/expensemain`)},{label:"Bills",path:`/organizations/${s}/projects/billmain`,icon:"fas fa-receipt text-blue-600",onClick:()=>a(`/organizations/${s}/projects/billmain`)},{label:"Design Bills",path:`/organizations/${s}/projects/billnew`,icon:"fas fa-file-pdf text-blue-600",onClick:()=>a(`/organizations/${s}/projects/billnew`)},{label:"Payments Accounts",path:`/organizations/${s}/projects/paymentmain`,icon:"fas fa-receipt text-blue-600",onClick:()=>a(`/organizations/${s}/projects/paymentmain`)},{label:"Vendor Payments",path:`/organizations/${s}/projects/vendorpaymentmain`,icon:"fas fa-credit-card text-blue-600",onClick:()=>a(`/organizations/${s}/projects/vendorpaymentmain`)}]},{title:"Office Records",items:[{label:"Customer",path:`/organizations/${s}/projects/customermain`,icon:"fas fa-users text-blue-600",onClick:()=>a(`/organizations/${s}/projects/customermain`)},{label:"Vendor",path:`/organizations/${s}/projects/vendormain`,icon:"fas fa-user text-blue-600",onClick:()=>a(`/organizations/${s}/projects/vendormain`)}]}],[m,r]=l.useState(!1),[i,p]=l.useState(""),[f,b]=l.useState(""),[o,h]=l.useState({}),{data:j}=T(s),u=j==null?void 0:j.map(t=>({_id:t._id,projectName:t.projectName})),{data:v,fetchNextPage:C,hasNextPage:y,isFetchingNextPage:N,isLoading:z,isError:S,error:w,refetch:P}=_(s,o,f);l.useEffect(()=>{const t=d.current;if(!t)return;const n=()=>{const{scrollTop:c,scrollHeight:I,clientHeight:L}=t;I-c-L<100&&y&&!N&&(console.log("ðŸ“œ Loading more accounting records..."),C())};return t.addEventListener("scroll",n),()=>t.removeEventListener("scroll",n)},[y,N,C]);const A=Object.values(o).filter(Boolean).length,E=()=>{h({}),p(""),b("")},k=(v==null?void 0:v.pages.flatMap(t=>t.data))||[];return g.pathname.includes("single")?e.jsx(B,{}):e.jsxs("div",{className:"p-2 space-y-4 h-full",children:[e.jsx(V,{isOpen:m,onClose:()=>r(!1),heading:"Accounts",sections:x}),e.jsxs("header",{className:"flex justify-between items-center pb-2",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-money-bill-wave mr-3 text-blue-600"}),"Accounting Department"]}),e.jsx("p",{className:"text-gray-600 mt-1 text-sm",children:"Manage your projectâ€™s financial transactions and accounting records"})]}),e.jsxs("div",{className:"flex gap-2 w-[300px] md:w-[400px]",children:[e.jsx("button",{onClick:()=>r(!0),className:"bg-blue-600 hover:bg-blue-700 cursor-pointer text-white p-2.5 rounded-lg transition-colors shadow-md hover:shadow-lg transform hover:scale-105",title:"Quick Navigation",children:e.jsx("i",{className:"fas fa-plus text-lg"})}),e.jsx("input",{type:"text",placeholder:"Search Payee, Record No...",value:i,autoFocus:!0,onChange:t=>p(t.target.value),onKeyDown:t=>{t.key==="Enter"&&b(i)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"}),e.jsx($,{onClick:()=>b(i),className:"bg-blue-600 text-white px-4 py-2 rounded",children:e.jsx("i",{className:"fas fa-search"})})]})]}),z?e.jsx(D,{}):S?e.jsxs("div",{className:"max-w-xl mx-auto mt-4 p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2 text-xl",children:"âš ï¸ Error Occurred"}),e.jsx("p",{className:"text-red-500 mb-4 text-lg",children:(w==null?void 0:w.message)||"Failed to load data"}),e.jsx($,{onClick:()=>P(),className:"bg-red-600 text-white px-4 py-2",children:"Retry"})]}):e.jsxs("main",{className:"flex gap-4 h-[calc(100%-90px)]",children:[e.jsx("div",{className:"xl:w-72 w-64 flex-shrink-0 overflow-y-auto custom-scrollbar",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-5 border border-gray-100 h-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-filter mr-2 text-blue-600"}),"Filters"]}),A>0&&e.jsx("button",{onClick:E,className:"text-sm text-blue-600 cursor-pointer hover:text-blue-800 font-medium",children:"Clear All"})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsxs("select",{value:o.status||"",onChange:t=>h(n=>({...n,status:t.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"paid",children:"Paid"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Source Type"}),e.jsxs("select",{value:o.fromDept||"",onChange:t=>h(n=>({...n,fromDept:t.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white",children:[e.jsx("option",{value:"",children:"All Sources"}),e.jsx("option",{value:"Bill Acc",children:"Bill Accounts"}),e.jsx("option",{value:"Expense Acc",children:"Expense Accounts"}),e.jsx("option",{value:"SubContract Acc",children:"SubContract Accounts"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Project"}),e.jsxs("select",{value:(o==null?void 0:o.projectId)||"",onChange:t=>{const n=u==null?void 0:u.find(c=>c._id===t.target.value);h(n?c=>({...c,projectId:n._id,projectName:n.projectName}):c=>({...c,projectId:void 0,projectName:void 0}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white",children:[e.jsx("option",{value:"",children:"All Projects"}),u==null?void 0:u.map(t=>e.jsx("option",{value:t._id,children:t.projectName},t._id))]})]})]})]})}),k.length===0?e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center bg-white rounded-xl border border-gray-200 text-center p-6",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-50 rounded-full flex items-center justify-center mb-4",children:e.jsx("i",{className:"fas fa-file-invoice-dollar text-3xl text-blue-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-1",children:"No Records Found"}),e.jsx("p",{className:"text-sm text-gray-500 max-w-md",children:f||A>0?"Try adjusting your filters or search query.":"Transactions from Bills, Expenses, and Payments will appear here automatically."})]}):e.jsxs("div",{ref:d,className:"flex-1 bg-white rounded-xl shadow-sm border border-gray-200 overflow-y-auto custom-scrollbar flex flex-col",children:[e.jsx("div",{className:"sticky top-0 z-10 bg-white border-b border-blue-200 shadow-sm",children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 px-6 py-4 bg-gradient-to-r from-blue-50 to-indigo-50 font-semibold text-gray-700 text-sm uppercase tracking-wider",children:[e.jsx("div",{className:"col-span-1 text-center",children:"#"}),e.jsx("div",{className:"col-span-2",children:"Rec No"}),e.jsx("div",{className:"col-span-3",children:"Payee / Source"}),e.jsx("div",{className:"col-span-2",children:"Date"}),e.jsx("div",{className:"col-span-2 text-right",children:"Amount"}),e.jsx("div",{className:"col-span-1 text-center",children:"Status"}),e.jsx("div",{className:"col-span-1 text-center",children:"Action"})]})}),e.jsx("div",{className:"divide-y divide-gray-100",children:k.map((t,n)=>e.jsx(G,{data:t,index:n,onView:()=>a(`single/${t._id}`)},t._id))}),N&&e.jsx("div",{className:"flex justify-center py-6 bg-gray-50 border-t border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-2 text-blue-600",children:[e.jsx("i",{className:"fas fa-spinner fa-spin text-xl"}),e.jsx("span",{className:"text-sm font-medium",children:"Loading more records..."})]})}),!y&&k.length>0&&e.jsx("div",{className:"flex justify-center py-6 bg-gray-50 border-t border-gray-100",children:e.jsxs("p",{className:"text-gray-400 text-sm font-medium flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle mr-2"}),"All records loaded"]})})]})]})]})};export{te as default};
