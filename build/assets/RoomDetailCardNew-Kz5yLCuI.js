import{r as p,j as e,B as S,e as U,t as h,u as A,a as K}from"./index-ogMTmcqi.js";import{u as L,a as z,b as T,c as $,d as G}from"./materialSelectionApi-CcDGy4L-.js";import{I as O}from"./Input-Bl8lW2bK.js";import{I as Q}from"./ImageGalleryMain-fxCT6Vi3.js";import"./constants-BoN4q75_.js";const W=({projectId:f,packageId:g,roomId:N,initialFiles:I,refetch:w})=>{const[k,l]=p.useState([]),[y,a]=p.useState(I.filter(r=>r.type==="pdf")),[d,m]=p.useState(I.filter(r=>r.type==="image")),[u,C]=p.useState(null),{mutateAsync:E,isPending:_}=L(),{mutateAsync:M,isPending:F}=z(),q=r=>{r.target.files&&l(Array.from(r.target.files))},c=async()=>{var j,v;if(k.length===0)return;const r=new FormData;k.forEach(t=>r.append("files",t));try{const t=await E({projectId:f,roomId:N,formData:r,packageId:g}),i=t.filter(s=>s.type==="pdf"),o=t.filter(s=>s.type==="image");a(s=>[...s,...i]),m(s=>[...s,...o]),l([]),h({title:"Success",description:"file uploaded successfully"}),w()}catch(t){h({title:"error",description:((v=(j=t==null?void 0:t.response)==null?void 0:j.data)==null?void 0:v.message)||"failed to upload file",variant:"destructive"})}},b=async(r,j)=>{var v,t;try{await M({projectId:f,roomId:N,fileId:r,packageId:g}),j==="pdf"?a(i=>i.filter(o=>o._id!==r)):m(i=>i.filter(o=>o._id!==r)),h({title:"Success",description:"deleted successfully"}),w()}catch(i){h({title:"error",description:((t=(v=i==null?void 0:i.response)==null?void 0:v.data)==null?void 0:t.message)||"failed to upload file",variant:"destructive"})}};return e.jsxs("div",{className:"space-y-6 ",children:[e.jsx("h3",{className:"text-xl font-semibold text-blue-700",children:"Uploads"}),e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsx(O,{type:"file",multiple:!0,onChange:q,accept:"image/*,application/pdf"}),e.jsx(S,{onClick:c,isLoading:_,className:"bg-blue-600 text-white",children:"Upload"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 pt-4",children:[e.jsxs("div",{className:"p-2",children:[e.jsx("h4",{className:"font-semibold text-red-700 mb-2",children:"📄 PDF Files"}),e.jsxs("ul",{className:"space-y-2 max-h-[280px] h-[280px] rounded-lg shadow-lg p-2 overflow-y-auto custom-scrollbar-none",children:[y.length===0&&e.jsx("div",{className:"min-h-[180px] rounded-lg  flex items-center justify-center",children:e.jsx("p",{className:"text-sm text-gray-500",children:"No PDFs uploaded."})}),y.map(r=>e.jsxs("li",{className:"flex justify-between items-center bg-red-50 p-2 rounded-xl",children:[e.jsx("span",{className:"text-sm",children:r.originalName}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(S,{size:"sm",variant:"primary",onClick:()=>U({src:r==null?void 0:r.url,alt:(r==null?void 0:r.originalName)||"file.pdf"}),children:e.jsx("i",{className:"fa-solid fa-download"})}),e.jsx(S,{onClick:()=>b(r._id,"pdf"),size:"sm",isLoading:F,variant:"primary",children:e.jsx("i",{className:"fa-solid fa-trash"})})]})]},r._id))]})]}),e.jsxs("div",{className:"p-2",children:[e.jsx("h4",{className:"font-semibold text-green-700 mb-2",children:"🖼️ Image Files"}),e.jsx("section",{className:"space-y-2 max-h-[280px] h-[280px] shadow-lg rounded-lg p-2 overflow-y-auto custom-scrollbar",children:e.jsx(Q,{imageFiles:d,handleDeleteFile:b,height:80,minWidth:98,maxWidth:100})})]})]}),u&&e.jsx("div",{onClick:()=>C(null),className:"fixed inset-0 bg-black/70 z-50 p-8 bg-opacity-60 flex items-center justify-center",children:e.jsxs("div",{onClick:r=>r.stopPropagation(),className:"relative bg-white rounded py-8 px-4 max-w-[90vw] max-h-[80vh] shadow-lg",children:[e.jsx("i",{className:"fas fa-times absolute top-2 right-3 text-xl text-gray-700 hover:text-red-500 cursor-pointer",onClick:()=>C(null)}),e.jsx("img",{src:u,alt:"Full View",className:"max-h-[70vh] w-auto object-contain rounded"})]})})]})},B=["nos","pieces","litre","kg","mm","cm","meter","feet","inch","sqft","sqmm","packet","roll","sheet"],Z=()=>{const{projectId:f,roomId:g,packageId:N}=A(),I=K(),[w,k]=p.useState(null),[l,y]=p.useState(null),[a,d]=p.useState({materialName:"",quantity:1,unit:"",price:0,labourCost:0}),m=p.useRef(null);p.useEffect(()=>{l&&m.current&&(m.current.focus(),m.current.select())},[l]);const{data:u,isLoading:C,isError:E,refetch:_}=T({projectId:f,roomId:g,packageId:N}),{mutateAsync:M}=$(),F=G(),q=async(t,i)=>{var o,s;try{await F.mutateAsync({projectId:f,itemId:t,packageId:N,roomId:g,fieldId:i}),h({title:"Success",description:"Item deleted successfully"}),_()}catch(x){h({title:"Error",description:((s=(o=x==null?void 0:x.response)==null?void 0:o.data)==null?void 0:s.message)||"Failed to delete item",variant:"destructive"})}},c=async(t,i,o)=>{var D,R;const{materialName:s,unit:x,...n}=t;if(!s.trim()||!x)return h({title:"Error",description:"Material Name and Unit are required",variant:"destructive"});try{await M({projectId:f,packageId:N,roomId:g,fieldId:i,formData:o?{_id:o,materialName:s,unit:x,...n}:{materialName:s,unit:x,...n}}),y(null),h({title:o?"Success":"Added",description:o?`Material "${s}" updated successfully.`:`Material "${s}" created successfully.`}),d({materialName:"",quantity:1,unit:"",price:0,labourCost:0}),_()}catch(P){h({title:"Error",description:((R=(D=P==null?void 0:P.response)==null?void 0:D.data)==null?void 0:R.message)||"Failed to save material item",variant:"destructive"})}},b=({mat:t,fieldName:i,_id:o,index:s})=>{y({itemIndex:s,subItemId:o,field:i}),d({materialName:t.materialName,quantity:t.quantity,unit:t.unit,price:t.price,labourCost:t.labourCost})},r=()=>{I(-1)};if(C)return e.jsx("div",{className:"max-h-screen overflow-y-auto flex justify-center items-center min-h-screen bg-slate-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-600 font-medium",children:"Loading room details..."})]})});if(E)return e.jsx("div",{className:"max-h-screen overflow-y-auto flex flex-col items-center justify-center min-h-screen bg-slate-50",children:e.jsxs("div",{className:"text-center bg-white rounded-xl shadow-lg p-8 max-w-md",children:[e.jsx("i",{className:"fa-solid fa-exclamation-triangle text-red-500 text-4xl mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-slate-800 mb-2",children:"Failed to Load"}),e.jsx("p",{className:"text-slate-600 mb-4",children:"Unable to retrieve room details"}),e.jsxs("button",{onClick:()=>window.location.reload(),className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-colors",children:[e.jsx("i",{className:"fa-solid fa-refresh mr-2"}),"Retry"]})]})});const j=u!=null&&u.roomFields?Object.values(u.roomFields):[],v=u.totalCost;return e.jsxs("div",{className:"max-h-screen overflow-y-auto bg-slate-50",children:[e.jsx("header",{className:"bg-white border-b border-slate-200 sticky top-0 z-10",children:e.jsx("div",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex justify-between items-center gap-2",children:[e.jsx("button",{onClick:r,className:"flex bg-slate-200 rounded-md px-2 py-1 cursor-pointer items-center gap-2 text-slate-700 hover:text-slate-600 transition-colors",children:e.jsx("i",{className:"fa-solid fa-arrow-left"})}),e.jsxs("div",{className:"flex items-center gap-2 text-blue-500",children:[e.jsx("i",{className:"fa-solid fa-door-open"}),e.jsx("span",{className:"font-semibold text-blue-600 text-xl sm:text-2xl",children:(u==null?void 0:u.name)||"Room Details"})]})]}),e.jsxs("button",{onClick:r,className:"flex  rounded-2xl px-2 py-1 cursor-pointer items-center gap-2 text-slate-700 hover:text-slate-600 transition-colors",children:["Total Cost:",e.jsx("span",{className:"font-medium",children:v})]})]})})}),e.jsxs("main",{className:"p-4",children:[e.jsxs("section",{className:"bg-white rounded-lg shadow-sm border border-slate-200 mb-6",children:[e.jsx("div",{className:"border-b border-slate-200 px-4 py-3",children:e.jsxs("h2",{className:"text-lg font-semibold text-slate-800 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-list-check text-blue-600"}),"Room Items & Specifications"]})}),j.length>0?e.jsxs("div",{className:"divide-y divide-slate-200",children:[e.jsxs("div",{className:"grid grid-cols-15 gap-4 px-4 py-3 bg-slate-50 text-sm font-medium text-slate-600",children:[e.jsx("div",{className:"col-span-1",children:"#"}),e.jsx("div",{className:"col-span-1",children:e.jsx("i",{className:"fa-solid fa-box"})}),e.jsx("div",{className:"col-span-7 sm:col-span-8",children:"Item Name"}),e.jsx("div",{className:"col-span-3 sm:col-span-2 text-center",children:"Quantity"}),e.jsx("div",{className:"col-span-3 sm:col-span-2 text-center",children:"Material Items"})]}),j.map((t,i)=>{var o;return e.jsxs("div",{className:"border-b",children:[e.jsxs("div",{className:"grid grid-cols-15 gap-4 px-4 py-4 hover:bg-slate-50 transition-colors",onClick:()=>k(w===i?null:i),children:[e.jsx("div",{className:"col-span-1 flex items-center",children:e.jsx("span",{className:"bg-slate-100 text-slate-600 text-xs font-medium px-2 py-1 rounded-full",children:i+1})}),e.jsx("div",{className:"col-span-1 flex items-center",children:e.jsx("div",{className:"bg-blue-100 p-2 rounded-lg",children:e.jsx("i",{className:"fa-solid fa-cube text-blue-600 text-sm"})})}),e.jsx("div",{className:"col-span-7 sm:col-span-8 flex items-center",children:e.jsx("span",{className:"font-medium text-slate-800",children:t.itemName})}),e.jsx("div",{className:"col-span-3 sm:col-span-2 flex items-center justify-center",children:e.jsx("span",{className:"bg-green-100 text-green-700 font-semibold px-3 py-1 rounded-full text-sm",children:t.quantity})}),e.jsxs("div",{className:"col-span-3 sm:col-span-3 flex items-center cursor-pointer transition-all duration-300 hover:bg-gray-200 w-fit px-2 py-2 rounded-md",children:[e.jsx("span",{className:"font-medium text-slate-800",children:"Create Mateiral Items"}),e.jsx("i",{className:`fa-solid transition-transform duration-300 ml-2 ${w===i?"fa-chevron-up":"fa-chevron-down"}`})]})]}),w===i&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 bg-[#faffff] rounded-lg p-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("i",{className:"fa-solid fa-list text-blue-600"}),e.jsxs("h4",{className:"font-semibold text-gray-800",children:["Material Items of ",t.itemName]})]}),e.jsx("p",{className:"text-sm text-gray-500",children:"( Click to edit, save changes by clicking Enter )"})]}),e.jsxs("div",{className:"grid grid-cols-12 bg-gray-100 text-sm font-medium text-gray-700 border-b border-gray-200",children:[e.jsx("div",{className:"col-span-4 px-4 py-3 text-sm font-medium text-gray-700 border-r border-gray-200",children:"Material Name"}),e.jsx("div",{className:"col-span-2 px-4 py-3 text-sm font-medium text-gray-700 border-r border-gray-200",children:"Quantity"}),e.jsx("div",{className:"col-span-2 px-4 py-3 text-sm font-medium text-gray-700 border-r border-gray-200",children:"Unit"}),e.jsx("div",{className:"col-span-2 px-4 py-3 text-sm font-medium text-gray-700 border-r border-gray-200",children:"Material Cost "}),e.jsx("div",{className:"col-span-1 px-4 py-3 text-sm font-medium text-gray-700 border-r border-gray-200",children:"Labour Cost "}),e.jsx("div",{className:"col-span-1 px-4 py-3 text-sm font-medium text-gray-700",children:"Action"})]}),((o=t==null?void 0:t.materialItems)==null?void 0:o.length)===0&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"p-8 text-center bg-white",children:[e.jsx("div",{className:"bg-slate-100 w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-3",children:e.jsx("i",{className:"fa-solid fa-inbox text-slate-400"})}),e.jsx("h3",{className:"font-semibold text-slate-700 mb-1",children:"No Items Found"}),e.jsx("p",{className:"text-slate-500 text-sm",children:"This room doesn't have any items configured yet."})]})}),t.materialItems.map((s,x)=>e.jsxs("div",{className:"grid grid-cols-12 gap-0 border-b border-gray-100 ",children:[e.jsx("div",{className:"col-span-4 border-r border-gray-200 bg-white",onClick:()=>{b({mat:s,_id:s._id,fieldName:"materialName",index:i})},children:(l==null?void 0:l.subItemId)===s._id&&(l==null?void 0:l.field)==="materialName"?e.jsx("input",{ref:m,value:a.materialName,onChange:n=>d({...a,materialName:n.target.value}),onBlur:()=>{a.materialName.trim()&&a.unit&&c(a,t._id,s._id)},onKeyDown:n=>{n.key==="Enter"&&c(a,t._id,s._id)},className:"w-full px-4 py-3 border-none outline-none focus:bg-blue-50"}):e.jsx("div",{className:"px-4 py-3 cursor-pointer hover:bg-blue-50 transition-colors",children:s.materialName})}),e.jsx("div",{className:"col-span-2 border-r border-gray-200 bg-white",onClick:()=>{b({mat:s,_id:s._id,fieldName:"quantity",index:i})},children:(l==null?void 0:l.subItemId)===s._id&&(l==null?void 0:l.field)==="quantity"?e.jsx("input",{type:"number",ref:m,onChange:n=>d({...a,quantity:+n.target.value}),value:a.quantity,className:"w-full px-4 py-3 border-none outline-none focus:bg-blue-50",onBlur:()=>{a.materialName.trim()&&a.unit&&c(a,t._id,s._id)},onKeyDown:n=>{n.key==="Enter"&&c(a,t._id,s._id)}}):e.jsx("div",{className:"px-4 py-3 cursor-pointer hover:bg-blue-50 transition-colors",children:s.quantity})}),e.jsx("div",{className:"col-span-2 border-r border-gray-200 bg-white",children:(l==null?void 0:l.subItemId)===s._id&&(l==null?void 0:l.field)==="unit"?e.jsxs("select",{value:a.unit,onChange:async n=>{d({...a,unit:n.target.value});const D={...a,unit:n.target.value};await c(D,t._id,s._id)},onBlur:()=>y(null),className:"w-full px-4 py-3 border-none outline-none focus:bg-blue-50",children:[e.jsx("option",{value:"",disabled:!0,children:"Select Unit"}),B.map(n=>e.jsx("option",{value:n,children:n},n))]}):e.jsx("div",{className:"px-4 py-3 cursor-pointer hover:bg-blue-50 transition-colors",onClick:()=>{b({mat:s,_id:s._id,fieldName:"unit",index:i})},children:s.unit})}),e.jsx("div",{className:"col-span-2 border-r border-gray-200 bg-white",onClick:()=>{b({mat:s,_id:s._id,fieldName:"price",index:i})},children:(l==null?void 0:l.subItemId)===s._id&&(l==null?void 0:l.field)==="price"?e.jsx("input",{type:"number",ref:m,value:a.price,onChange:n=>d({...a,price:+n.target.value}),onBlur:()=>{a.materialName.trim()&&a.unit&&c(a,t._id,s._id)},onKeyDown:n=>{n.key==="Enter"&&c(a,t._id,s._id)},className:"w-full px-4 py-3 border-none outline-none focus:bg-blue-50"}):e.jsx("div",{className:"px-4 py-3 cursor-pointer hover:bg-blue-50 transition-colors",children:s.price})}),e.jsx("div",{className:"col-span-1 border-r border-gray-200 bg-white",onClick:()=>{b({mat:s,_id:s._id,fieldName:"labourCost",index:i})},children:(l==null?void 0:l.subItemId)===s._id&&(l==null?void 0:l.field)==="labourCost"?e.jsx("input",{type:"number",ref:m,value:a.labourCost,onChange:n=>d({...a,labourCost:+n.target.value}),onBlur:()=>{a.materialName.trim()&&a.unit&&c(a,t._id,s._id)},onKeyDown:n=>{n.key==="Enter"&&c(a,t._id,s._id)},className:"w-full px-4 py-3 border-none outline-none focus:bg-blue-50"}):e.jsx("div",{className:"px-4 py-3 cursor-pointer hover:bg-blue-50 transition-colors",children:s.labourCost})}),e.jsx("div",{className:"col-span-1 flex justify-center items-center bg-white",children:e.jsx(S,{variant:"danger",isLoading:F.isPending,onClick:()=>q(s._id,t._id),className:"p-2 bg-red-600 text-white hover:bg-red-50 rounded transition-colors",title:"Delete item",children:e.jsx("i",{className:"fa fa-trash text-sm"})})})]},s._id||x)),e.jsxs("div",{className:"grid grid-cols-12 text-sm gap-0 bg-green-50 border-b border-gray-100",children:[e.jsx("div",{className:"col-span-4 border-r border-gray-200",children:e.jsx("input",{autoFocus:!0,ref:m,value:l?"":a.materialName,onChange:s=>d({...a,materialName:s.target.value}),placeholder:"plywoods, curtains , etc...",onBlur:()=>{a.materialName.trim()&&a.unit&&c(a,t._id)},onKeyDown:s=>{s.key==="Enter"&&c(a,t._id)},className:"w-full px-4 py-3 bg-transparent border-none outline-none placeholder-gray-400"})}),e.jsx("div",{className:"col-span-2 border-r border-gray-200",children:e.jsx("input",{type:"number",ref:m,onChange:s=>d({...a,quantity:+s.target.value}),value:l?1:a.quantity,className:"w-full px-4 py-3 bg-transparent border-none outline-none placeholder-gray-400"})}),e.jsx("div",{className:"col-span-2 border-r border-gray-200",children:e.jsxs("select",{value:l?"":a.unit,onChange:async s=>{d({...a,unit:s.target.value})},onBlur:()=>y(null),className:"w-full px-4 py-3 border-none outline-none focus:bg-blue-50",children:[e.jsx("option",{value:"",disabled:!0,children:"Select Unit"}),B.map(s=>e.jsx("option",{value:s,children:s},s))]})}),e.jsx("div",{className:"col-span-2 border-r border-gray-200",children:e.jsx("input",{type:"number",ref:m,value:l?0:a.price,onChange:s=>d({...a,price:+s.target.value}),onKeyDown:s=>{s.key==="Enter"&&c(a,t._id)},className:"w-full px-4 py-3 bg-transparent border-none outline-none placeholder-gray-400"})}),e.jsx("div",{className:"col-span-1 border-r border-gray-200 ",children:e.jsx("input",{type:"number",ref:m,value:l?0:a.labourCost,onChange:s=>d({...a,labourCost:+s.target.value}),onBlur:()=>{a.materialName.trim()&&a.unit&&c(a,t._id)},onKeyDown:s=>{s.key==="Enter"&&c(a,t._id)},className:"w-full px-4 py-3 bg-transparent border-none outline-none placeholder-gray-400"})})]})]})]},t._id||i)})]}):e.jsxs("div",{className:"p-8 text-center bg-white",children:[e.jsx("div",{className:"bg-slate-100 w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-3",children:e.jsx("i",{className:"fa-solid fa-inbox text-slate-400"})}),e.jsx("h3",{className:"font-semibold text-slate-700 mb-1",children:"No Items Found"}),e.jsx("p",{className:"text-slate-500 text-sm",children:"This room doesn't have any items configured yet."})]})]}),e.jsxs("section",{className:"bg-white rounded-lg shadow-sm border border-slate-200",children:[e.jsx("div",{className:"border-b border-slate-200 px-4 py-3",children:e.jsxs("h2",{className:"text-lg font-semibold text-slate-800 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-paperclip text-purple-600"}),"Attachments & Documents"]})}),e.jsx("div",{className:"p-4",children:e.jsx(W,{projectId:f,roomId:g,packageId:N,initialFiles:(u==null?void 0:u.uploads)||[],refetch:_})})]})]})]})};export{Z as default};
