import{j as e,g as V,q as K,b as R,u as W,r as T}from"./index-Dkf7SbMA.js";import{u as J}from"./useMutation-DtRxugN4.js";import{g as Y}from"./roleCheck-CXq1v0D5.js";import{t as A}from"./toast-BSC5QTk1.js";import{u as H}from"./projectApi-DzFbt4lZ.js";import{B as C}from"./Button-ClgICMLF.js";import{S as oe,a as le,b as ie,c as ce,d as de}from"./Select-CPbUX6hy.js";import{d as me,e as xe}from"./quoteVariantApi-CKEc4CWx.js";import ue from"./MaterialOverviewLoading-Bdf5VoUF.js";import{C as pe,a as ge}from"./Card-BI-_ii1r.js";import{d as he,f as fe}from"./dateFormator-BGKi5rfZ.js";import{e as ye}from"./labourRateconfigApi-FcAk1eyo.js";import{S as Ne}from"./StageGuide-CjTD8LTi.js";import"./useQuery-h0LZ4b8f.js";import"./Skeleton-SSJQa0KM.js";const $={plywood:1,laminate:1},je=()=>({itemName:"",plywoodNos:{quantity:0,thickness:0},laminateNos:{quantity:0,thickness:0},carpenters:0,days:0,profitOnMaterial:0,profitOnLabour:0,rowTotal:0,remarks:""}),z=()=>({itemName:"",description:"",quantity:0,cost:0,rowTotal:0}),q=(r,u)=>{if(r.length===0)return[];const i=r.length,h=r[0],j=h.carpenters*h.days*u*(1+(h.profitOnLabour||0)/100)/i;return r.map(w=>{var a,n;const M=((a=w.plywoodNos)==null?void 0:a.quantity)||0,l=((n=w.laminateNos)==null?void 0:n.quantity)||0,t=(M*$.plywood+l*$.laminate)*(1+(w.profitOnMaterial||0)/100);return{...w,rowTotal:Math.round(t+j)}})},be=({data:r,labourCost:u,updateFurniture:i,removeFurniture:h})=>{const x=l=>{const t=l.coreMaterials.reduce((c,f)=>c+f.rowTotal,0),a=l.fittingsAndAccessories.reduce((c,f)=>c+f.rowTotal,0),n=l.glues.reduce((c,f)=>c+f.rowTotal,0),s=l.nonBrandMaterials.reduce((c,f)=>c+f.rowTotal,0);return{core:t,fittings:a,glues:n,nbms:s,furnitureTotal:t+a+n+s}},p=(l,t,a)=>{var b;const n=[...r.coreMaterials];t==="imageUrl"?(n[l].imageUrl=a,n[l].previewUrl=URL.createObjectURL(a)):t==="plywoodNos"||t==="laminateNos"?n[l][t]={...n[l][t]||{},...a}:n[l][t]=a;const s=q(n,u),c=((b=s==null?void 0:s[0])==null?void 0:b.profitOnMaterial)||0,f=(o,d=!1)=>o.map(S=>{const P=c,O=d?S.cost||0:(S.quantity||0)*(S.cost||0),L=O*(P/100),U=Math.round(O+L);return{...S,profitOnMaterial:P,rowTotal:U}}),N={...r,coreMaterials:s,fittingsAndAccessories:f(r.fittingsAndAccessories),glues:f(r.glues,!0),nonBrandMaterials:f(r.nonBrandMaterials)};N.totals=x(N),i==null||i(N)},j=(l,t,a,n)=>{const s=[...r[l]];if(s[t][a]=n,l!=="glues"){const b=(s[t].quantity||0)*(s[t].cost||0),o=b*((s[t].profitOnMaterial||0)/100);s[t].rowTotal=Math.round(b+o)}else{const b=s[t].cost||0,o=b*((s[t].profitOnMaterial||0)/100);s[t].rowTotal=Math.round(b+o)}const c=t===s.length-1,f=s[t].itemName||s[t].description||s[t].quantity||s[t].cost;c&&f&&s.push(z());const N={...r,[l]:s};N.totals=x(N),i&&i(N)},w=()=>e.jsxs("div",{className:"mt-4",children:[e.jsxs("h3",{className:"font-semibold text-md mb-2",children:["Core Materials - Total: ₹",r==null?void 0:r.totals.core.toLocaleString("en-IN")]}),e.jsx("div",{className:"overflow-x-auto  rounded-md",children:e.jsxs("table",{className:"min-w-full text-sm bg-white shadow-sm",children:[e.jsxs("thead",{className:"bg-blue-50 text-sm font-semibold text-gray-600",children:[e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Image"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Item Name"}),e.jsx("th",{className:"text-center px-6 py-1 text-xs font-medium text-gray-500 uppercase tracking-wider",colSpan:2,children:"Plywood"}),e.jsx("th",{className:"text-center px-6 py-1 text-xs font-medium text-gray-500 uppercase tracking-wider",colSpan:2,children:"Laminate"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"No. of Carpenters / Day"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"No. of Days"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Profit % Material"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Profit % Labour"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Remarks"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Total"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Actions"})]}),e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-6 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Qty"}),e.jsx("th",{className:"text-center px-6 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Thk"}),e.jsx("th",{className:"text-center px-6 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Qty"}),e.jsx("th",{className:"text-center px-6 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Thk"})]})]}),e.jsx("tbody",{children:r.coreMaterials.map((l,t)=>e.jsxs("tr",{className:"group relative border-none !border-b-1 px-4 py-2 transition-all duration-150 hover:bg-gray-50",children:[t===0&&e.jsxs("td",{rowSpan:r.coreMaterials.length,children:[e.jsx("input",{type:"file",className:"w-full px-2 py-3 text-center outline-none",onChange:a=>{var n;return p(0,"imageUrl",(n=a.target.files)==null?void 0:n[0])}}),l.previewUrl&&e.jsx("img",{src:l.previewUrl,className:"h-10 mt-2 mx-auto"})]}),e.jsx("td",{className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{value:l.itemName,placeholder:"TV Unit | Wardrobe",onChange:a=>p(t,"itemName",a.target.value),className:"w-full px-2 py-1 text-center outline-none"})}),["plywoodNos","laminateNos"].map(a=>["quantity","thickness"].map(n=>e.jsx("td",{className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",value:l[a][n],onChange:s=>{Number(s.target.value)>=0&&p(t,a,{...l[a],[n]:Number(s.target.value)})},className:"w-full px-2 py-1 text-center outline-none"})},`${a}-${n}`))),t===0&&e.jsxs(e.Fragment,{children:[e.jsx("td",{rowSpan:r.coreMaterials.length,className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",value:l.carpenters,onChange:a=>p(t,"carpenters",Number(a.target.value)),className:"w-full px-2 py-1 text-center outline-none"})}),e.jsx("td",{rowSpan:r.coreMaterials.length,className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",value:l.days,onChange:a=>p(t,"days",Number(a.target.value)),className:"w-full px-2 py-1 text-center outline-none"})})]}),e.jsx("td",{className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",value:l.profitOnMaterial,onChange:a=>p(t,"profitOnMaterial",Number(a.target.value)),className:"w-full px-2 py-1 text-center outline-none"})}),t===0&&e.jsx(e.Fragment,{children:e.jsx("td",{rowSpan:r.coreMaterials.length,className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",value:l.profitOnLabour,onChange:a=>p(t,"profitOnLabour",Number(a.target.value)),className:"w-full px-2 py-1 text-center outline-none"})})}),e.jsx("td",{className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{value:l.remarks,placeholder:"remarks",onChange:a=>p(t,"remarks",a.target.value),className:"w-full px-2 py-1 text-center outline-none"})}),e.jsxs("td",{className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:["₹",l.rowTotal.toLocaleString("en-IN")]}),e.jsx("td",{className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx(C,{variant:"danger",onClick:()=>{const a=[...r.coreMaterials];a.splice(t,1);const n=q(a,u),s={...r,coreMaterials:n};s.totals=x(s),i==null||i(s)},className:"px-1 text-xs bg-red-600 text-white",children:"Remove"})})]},t))})]})}),e.jsx("div",{className:"mt-2 text-right",children:e.jsx(C,{onClick:()=>{const l=[...r.coreMaterials,je()],t=q(l,u),a={...r,coreMaterials:t};a.totals=x(a),i==null||i(a)},children:"+ Add Core Material"})})]}),M=(l,t)=>{var a;return e.jsxs("div",{className:"mt-6",children:[e.jsxs("h3",{className:"font-semibold text-md mb-2",children:[l," - Total: ₹",(a=r==null?void 0:r.totals[t==="fittingsAndAccessories"?"fittings":t])==null?void 0:a.toLocaleString("en-IN")]}),e.jsx("div",{className:"overflow-x-auto  rounded-md",children:e.jsxs("table",{className:"min-w-full text-sm bg-white shadow-sm",children:[e.jsx("thead",{className:"bg-blue-50 text-sm font-semibold text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Item Name"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Description"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Quantity"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cost"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Profit %"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{children:r[t].map((n,s)=>e.jsxs("tr",{className:"group relative border-none !border-b-1 px-4 !py-2 transition-all duration-150 hover:bg-gray-50",children:[e.jsx("td",{className:"p-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{value:n.itemName||"",placeholder:"Item Name",onChange:c=>j(t,s,"itemName",c.target.value),className:"w-full px-2 py-1 text-center outline-none"})}),e.jsx("td",{className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{value:n.description,placeholder:"description",onChange:c=>j(t,s,"description",c.target.value),className:"w-full px-2 py-1 text-center outline-none"})}),e.jsx("td",{className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",value:n.quantity,onChange:c=>{Number(c.target.value)>=0&&j(t,s,"quantity",Number(c.target.value))},className:"w-full px-2 py-1 text-center outline-none"})}),e.jsx("td",{className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",value:n.cost,onChange:c=>j(t,s,"cost",Number(c.target.value)),className:"w-full px-2 py-1 text-center outline-none"})}),e.jsx("td",{className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",value:n.profitOnMaterial??0,onChange:c=>j(t,s,"profitOnMaterial",Number(c.target.value)),className:"w-16 text-center border border-gray-300 rounded px-2 py-1 text-sm"})}),e.jsxs("td",{className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:["₹",n.rowTotal.toLocaleString("en-IN")]}),e.jsx("td",{className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx(C,{variant:"danger",onClick:()=>{const c=[...r[t]];c.splice(s,1);const f={...r,[t]:c};f.totals=x(f),i&&i(f)},className:"px-1 text-xs bg-red-600 text-white",children:"Remove"})})]},s))})]})}),e.jsx("div",{className:"mt-2 text-right",children:e.jsxs(C,{onClick:()=>{const n=[...r[t],z()],s={...r,[t]:n};s.totals=x(s),i&&i(s)},children:["+ Add ",l," Item"]})})]})};return e.jsxs("div",{className:"shadow-md p-4 my-4 border rounded-lg bg-white",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-700",children:["Product: ",r.furnitureName]}),h&&e.jsx(C,{variant:"danger",size:"sm",onClick:h,className:"bg-red-600 text-white",children:"Remove Product"})]}),w(),M("Fittings","fittingsAndAccessories"),M("Glues","glues"),M("Non-Branded Materials","nonBrandMaterials"),e.jsxs("div",{className:"mt-6 text-right text-xl text-green-700 font-bold",children:["Product Total: ₹",r.totals.furnitureTotal.toLocaleString("en-IN")]})]})},ve=async({api:r,organizationId:u,projectId:i,formData:h})=>{const{data:x}=await r.post(`/quote/quotegenerate/createquote/${u}/${i}`,h,{headers:{"Content-Type":"multipart/form-data"}});if(!x.ok)throw new Error(x.message||"Failed to create quote.");return x.data},we=async({api:r,organizationId:u,id:i,projectId:h,formData:x})=>{const p=await r.put(`/quote/quotegenerate/editquote/${u}/${h}/${i}`,x);if(!p.data.ok)throw new Error(p.data.message||"Failed to create quote.");return p.data.data},Me=()=>{const r=["owner","staff","CTO"],{role:u}=V(),i=Y(u);return J({mutationFn:async({organizationId:h,projectId:x,formData:p})=>{if(!u||!r.includes(u))throw new Error("Not allowed to create quotes");if(!i)throw new Error("API instance for role not found");return await ve({api:i,organizationId:h,projectId:x,formData:p})},onSuccess:(h,{organizationId:x})=>{K.invalidateQueries({queryKey:["quote-material-items",x]})}})},Ce=()=>{const r=["owner","staff","CTO"],{role:u}=V(),i=Y(u);return J({mutationFn:async({organizationId:h,projectId:x,formData:p,id:j})=>{if(!u||!r.includes(u))throw new Error("Not allowed to create quotes");if(!i)throw new Error("API instance for role not found");return await we({api:i,organizationId:h,projectId:x,formData:p,id:j})},onSuccess:(h,{organizationId:x})=>{K.invalidateQueries({queryKey:["quote-material-items",x]})}})},Se=({quote:r,organizationId:u,setFurnitures:i,setIsEditingId:h,setQuoteType:x,setEditQuoteNo:p,setFiltersMain:j})=>{var s,c,f;const{mutateAsync:w,isPending:M}=me(),{role:l,permission:t}=R(),a=l==="owner"||((s=t==null?void 0:t.materialquote)==null?void 0:s.delete),n=async N=>{var b,o;try{await w({id:N,organizationId:u}),A({title:"Success",description:"Items deleted successfully"})}catch(d){A({title:"Error",description:((o=(b=d==null?void 0:d.response)==null?void 0:b.data)==null?void 0:o.message)??"Operation failed"})}};return e.jsx(pe,{className:"w-full border-l-4 border-blue-600 shadow-md bg-white hover:shadow-lg transition-all",children:e.jsxs(ge,{className:"p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"my-1",children:[e.jsxs("h3",{className:"text-base font-bold text-blue-700 leading-[8px] ",children:["Project: ",e.jsx("span",{className:"text-black",children:((c=r==null?void 0:r.projectId)==null?void 0:c.projectName)||"Project"})]}),e.jsxs("span",{className:"text-[12px] font-semibold text-gray-500",children:["Quote No: ",e.jsx("span",{className:"text-black",children:r.quoteNo||"N/A"})]})]}),e.jsxs("p",{className:"text-xs text-gray-500 ",children:["Created on: ",he(r.createdAt)," -  ",fe(r.createdAt)]})]}),e.jsx("i",{className:"fas fa-file-alt text-gray-400 text-xl"})]}),e.jsxs("p",{className:"text-sm text-gray-500 italic",children:[e.jsx("strong",{children:"Furnitures: "})," ",((f=r.furnitures)==null?void 0:f.length)||0]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsxs(C,{size:"sm",variant:"secondary",onClick:()=>{const{furnitures:N}=r,b=N.map(o=>({furnitureName:o.furnitureName,coreMaterials:o.coreMaterials.map(d=>({itemName:(d==null?void 0:d.itemName)||"",plywoodNos:(d==null?void 0:d.plywoodNos)||{quantity:0,thickness:0},laminateNos:d.laminateNos||{quantity:0,thickness:0},carpenters:d.carpenters||0,days:d.days||0,profitOnMaterial:d.profitOnMaterial||0,profitOnLabour:d.profitOnLabour||0,rowTotal:d.rowTotal||0,remarks:d.remarks||"",imageUrl:d.imageUrl||"",previewUrl:d.imageUrl||""})),fittingsAndAccessories:o.fittingsAndAccessories||[],glues:o.glues||[],nonBrandMaterials:o.nonBrandMaterials||[],totals:{core:o.coreMaterialsTotal||0,fittings:o.fittingsAndAccessoriesTotal||0,glues:o.gluesTotal||0,nbms:o.nonBrandMaterialsTotal||0,furnitureTotal:o.furnitureTotal||0}}));console.log("parsedFurniture",b),p(r==null?void 0:r.quoteNo),i(b),h(r._id),x(()=>{var o;return((o=r==null?void 0:r.furnitures)==null?void 0:o.length)>1?"residential":"single"}),j({projectId:r.projectId._id,projectName:r.projectId.projectName})},children:[e.jsx("i",{className:"fas fa-eye mr-1"})," Edit"]}),a&&e.jsxs(C,{size:"sm",isLoading:M,variant:"danger",className:"bg-red-600 text-white",onClick:()=>n(r._id),children:[e.jsx("i",{className:"fas fa-trash mr-1"})," Delete"]})]})]})})},Te=({setFurnitures:r,setEditQuoteNo:u,setIsEditingId:i,setFiltersMain:h,setQuoteType:x})=>{var b;const{organizationId:p}=W(),[j,w]=T.useState({projectId:"",projectName:"",createdAt:""}),{role:M,permission:l}=R(),t=M==="owner"||((b=l==null?void 0:l.materialquote)==null?void 0:b.list),{data:a}=H(p),n=a==null?void 0:a.map(o=>({_id:o._id,projectName:o.projectName})),{data:s,isLoading:c}=xe(p,{createdAt:j.createdAt,projectId:j.projectId,quoteNo:""}),f=()=>{w({projectId:"",projectName:"",createdAt:""})},N=Object.values(j).filter(Boolean).length;return e.jsx("div",{children:e.jsxs("main",{className:"flex gap-2 !max-h-[80vh]",children:[e.jsx("div",{className:"xl:w-80 flex-shrink-0",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-filter mr-2 text-blue-600"}),"Filters"]}),N>0&&e.jsxs("button",{onClick:f,className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:["Clear All (",N,")"]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Created Date"}),e.jsx("input",{type:"date",onChange:o=>w(d=>({...d,createdAt:o.target.value})),value:j.createdAt,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Project"}),e.jsx("select",{value:(j==null?void 0:j.projectId)||"",onChange:o=>{const d=n==null?void 0:n.find(S=>S._id===o.target.value);d&&w(S=>({...S,projectId:d._id,projectName:d.projectName}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:n==null?void 0:n.map(o=>e.jsx("option",{value:o._id,children:o.projectName},o._id))})]})]})]})}),t&&e.jsx("section",{className:"w-full max-h-full  gap-2  overflow-y-auto  min-h-full",children:c?e.jsx("p",{children:e.jsx(ue,{})}):s!=null&&s.length?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s==null?void 0:s.map(o=>e.jsx(e.Fragment,{children:e.jsx(Se,{setEditQuoteNo:u,setFurnitures:r,setIsEditingId:i,setQuoteType:x,setFiltersMain:h,quote:o,organizationId:p},o._id)}))}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center text-gray-700",children:[e.jsx("i",{className:"fas fa-file-circle-exclamation text-gray-300 text-7xl mb-4"}),e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"No Quotes Found"}),e.jsxs("p",{className:"text-base text-gray-500 leading-relaxed max-w-md",children:["You haven't generated any quote variants yet.",e.jsx("br",{}),"Please create a quote by clicking the + Product section to view brand-wise breakdowns here."]})]})})]})})},Q=r=>r.filter(u=>{var i,h;return!!((i=u.itemName)!=null&&i.trim())||!!((h=u.description)!=null&&h.trim())}),De=()=>{var G,D;const{organizationId:r}=W(),{data:u}=H(r);let{data:i=0}=ye(r);const{role:h,permission:x}=R(),p=h==="owner"||((G=x==null?void 0:x.materialquote)==null?void 0:G.create),j=h==="owner"||((D=x==null?void 0:x.materialquote)==null?void 0:D.edit),w=T.useMemo(()=>(u==null?void 0:u.map(m=>({_id:m._id,projectName:m.projectName})))||[],[u]),[M,l]=T.useState({projectId:"",projectName:""}),[t,a]=T.useState([]),[n,s]=T.useState(!1),[c,f]=T.useState(""),[N,b]=T.useState(null),[o,d]=T.useState(null),[S,P]=T.useState(null),{mutateAsync:O,isPending:L}=Me(),{mutateAsync:U,isPending:X}=Ce(),Z=m=>{d(m)},ee=()=>o==="single"?"Single Quote":o==="residential"?"Residential Quote":"";T.useEffect(()=>{o==="single"&&!N?(a([]),B("Common Category")):o==="residential"&&!N&&(a([]),s(!0))},[o]);const B=m=>{a(v=>[...v,{furnitureName:m,coreMaterials:[re()],fittingsAndAccessories:[_()],glues:[_()],nonBrandMaterials:[_()],totals:{core:0,fittings:0,glues:0,nbms:0,furnitureTotal:0}}])},te=m=>{a(v=>v.filter((y,g)=>g!==m))},re=()=>({itemName:"",plywoodNos:{quantity:0,thickness:0},laminateNos:{quantity:0,thickness:0},carpenters:0,days:0,profitOnMaterial:0,profitOnLabour:0,rowTotal:0,remarks:""}),_=()=>({itemName:"",description:"",quantity:0,cost:0,rowTotal:0}),F=t==null?void 0:t.reduce((m,v)=>m+v.totals.furnitureTotal,0),ae=async()=>{var m,v;try{if(!M.projectId){A({title:"Error",description:"Please select a project",variant:"destructive"});return}const y=new FormData;y.append("furnitures",JSON.stringify(t.map(g=>({furnitureName:g.furnitureName,coreMaterials:g.coreMaterials.map(k=>{if(Object.values(k).some(I=>!!I)){const{imageUrl:I,previewUrl:E,...ne}=k;return ne}}),fittingsAndAccessories:Q(g.fittingsAndAccessories),glues:Q(g.glues),nonBrandMaterials:Q(g.nonBrandMaterials),coreMaterialsTotal:g.totals.core,fittingsAndAccessoriesTotal:g.totals.fittings,gluesTotal:g.totals.glues,nonBrandMaterialsTotal:g.totals.nbms,furnitureTotal:g.totals.furnitureTotal})))),t.forEach((g,k)=>{g.coreMaterials.forEach((I,E)=>{I.imageUrl&&y.append(`images[${k}][${E}]`,I.imageUrl)})}),y.append("grandTotal",F.toString()),y.append("notes","Generated"),await O({organizationId:r,projectId:M.projectId,formData:y}),A({title:"Success",description:"Created Successfully, Visit in Quote Generator Section"}),a([]),d(null)}catch(y){A({title:"Error",description:((v=(m=y==null?void 0:y.response)==null?void 0:m.data)==null?void 0:v.message)||(y==null?void 0:y.message)||"failed to generate the items",variant:"destructive"})}},se=async()=>{var m,v;try{if(!M.projectId){A({title:"Error",description:"Please select a project",variant:"destructive"});return}const y={furnitures:t.map(g=>({furnitureName:g.furnitureName,coreMaterials:g.coreMaterials.map(k=>{const{previewUrl:I,...E}=k;return{...E,imageUrl:k.imageUrl||null}}),fittingsAndAccessories:Q(g.fittingsAndAccessories),glues:Q(g.glues),nonBrandMaterials:Q(g.nonBrandMaterials),coreMaterialsTotal:g.totals.core,fittingsAndAccessoriesTotal:g.totals.fittings,gluesTotal:g.totals.glues,nonBrandMaterialsTotal:g.totals.nbms,furnitureTotal:g.totals.furnitureTotal})),grandTotal:F,notes:"Updated via frontend",quoteNo:S};N&&(await U({organizationId:r,projectId:M.projectId,formData:y,id:N}),A({title:"Updated!",description:"Quote edited successfully."}),a([]),d(null),b(null))}catch(y){A({title:"Error",description:((v=(m=y==null?void 0:y.response)==null?void 0:m.data)==null?void 0:v.message)||(y==null?void 0:y.message)||"Failed to Update the Quote",variant:"destructive"})}};return e.jsxs("div",{className:`h-full mx-auto max-h-full ${N?"overflow-y-auto":""} `,children:[e.jsxs("header",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 py-1 border-b-1 border-[#818283]",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-file mr-3 text-blue-600"}),"Internal Quote Entry"]}),(t==null?void 0:t.length)>0&&e.jsxs("p",{className:"ml-[30px] mt-[5px] block text-[15px] text-gray-800",children:["Single Labour cost:  ",e.jsxs("span",{className:"text-black font-semibold",children:["₹",i]})]})]}),e.jsxs("div",{className:"flex gap-6 items-center ",children:[p&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Select QuoteType"}),e.jsxs(oe,{onValueChange:m=>Z(m),children:[e.jsx(le,{className:"w-full",children:e.jsx(ie,{placeholder:"Select Quote",selectedValue:o||""})}),e.jsx(ce,{children:["single","residential"].map(m=>e.jsx(de,{value:m.toString(),children:m},m))})]})]}),p&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Select Project *"}),e.jsxs("select",{value:M.projectId,onChange:m=>{const v=w.find(y=>y._id===m.target.value);v&&l({projectId:v._id,projectName:v.projectName})},className:" px-2 py-2 rounded-xl border border-blue-200 focus:border-blue-200 active:border-blue-200",children:[e.jsx("option",{value:"",children:"Select a project"}),w.map(m=>e.jsx("option",{value:m._id,children:m.projectName},m._id))]})]}),t.length>0&&e.jsxs("div",{className:"text-right flex gap-2 items-center",children:[e.jsx("div",{className:"text-xs text-gray-600 uppercase tracking-widest",children:"Grand Total"}),e.jsxs("div",{className:"text-xl font-semibold text-green-600",children:["₹",F.toLocaleString("en-IN")]})]}),p&&e.jsxs(C,{className:"flex items-center",onClick:()=>{s(!0)},children:[e.jsx("i",{className:"fas fa-add mr-1",children:" "})," Product"]}),e.jsx("div",{className:"w-full sm:w-auto flex justify-end sm:block",children:e.jsx(Ne,{organizationId:r,stageName:"materialquote"})})]})]}),n&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 bg-opacity-40 backdrop-blur-sm transition",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg p-6 w-full max-w-md relative animate-scaleIn",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-800",children:"Add New Product"}),e.jsx("input",{className:"w-full border border-gray-300 rounded px-3 py-2 mb-4 outline-none focus:ring-2 focus:ring-blue-400",placeholder:"Enter Product Name",value:c,autoFocus:!0,onChange:m=>f(m.target.value),onKeyDown:m=>{if(m.key==="Enter"){if(!c.trim())return;B(c),f(""),s(!1)}}}),e.jsxs("div",{className:"flex justify-end gap-3 mt-4",children:[e.jsx(C,{variant:"secondary",onClick:()=>s(!1),children:"Cancel"}),e.jsx(C,{onClick:()=>{c.trim()&&(B(c),f(""),s(!1))},children:"Create"})]})]})}),t.length>0&&e.jsxs("section",{className:"shadow overflow-y-auto max-h-[86%]",children:[!N&&e.jsx("h1",{className:"text-2xl text-gray-500",children:ee()}),t.map((m,v)=>e.jsx(be,{index:v,labourCost:i,data:m,updateFurniture:y=>{const g=[...t];g[v]=y,a(g)},removeFurniture:()=>te(v)},v))]}),t.length!==0&&e.jsxs("div",{className:"mt-1 text-right flex gap-2 justify-end",children:[(p||j)&&e.jsx(C,{variant:"primary",isLoading:L||X,onClick:N?se:ae,className:"px-6 py-2 bg-blue-600 text-white rounded",children:"Save Quote"}),!N&&(p||j)&&e.jsx(C,{variant:"secondary",onClick:()=>{a([]),d(null)},className:"",children:"Cancel"}),N&&e.jsx(C,{variant:"secondary",onClick:()=>{b(null),a([]),d(null),P(null)},className:"",children:"Cancel"})]}),!N&&(t==null?void 0:t.length)===0&&e.jsx("section",{className:"my-4",children:e.jsx(Te,{setEditQuoteNo:P,setIsEditingId:b,setFurnitures:a,setQuoteType:d,setFiltersMain:l})})]})};export{De as default,Q as filterValidSimpleRows};
