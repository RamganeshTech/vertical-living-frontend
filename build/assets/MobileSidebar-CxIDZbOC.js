import{r as x,R as K,q as ge,K as w,j as e,u as T,b as S,a as he,P as Q,M as X,L as z,Q as J,T as Z,U as ee,V as se,W as te,X as ae}from"./index-CDrefmTi.js";import{M as pe,b as je,C as E}from"./constants-ZBpAFlne.js";import{b as ne}from"./CTOApi-DR8aVeBy.js";import{b as ie}from"./clientApi-30QmGY0o.js";import{b as oe}from"./staffApi-DE1dyTbE.js";import{b as re}from"./userApi-BqsurvvH.js";import{b as le}from"./workerApi-MpP36PQQ.js";import{B as W}from"./Button-DSSReI3J.js";import{t as $}from"./toast-BSC5QTk1.js";import{u as be}from"./currentActiveStageApi-DDsMemxO.js";import{c as we}from"./notificationApi-CLz8-33B.js";import{u as Y}from"./useCurrentSupervisor-CYnaOYRW.js";import{f as Ne}from"./issueDiscussionApi-BzzrxJIT.js";function ye(l,t){x.useEffect(()=>{const i=s=>{s.ctrlKey&&s.key==="]"?(s.preventDefault(),t()):s.ctrlKey&&s.key==="["&&(s.preventDefault(),l())};window.addEventListener("keydown",i)},[t,l])}const D=K.memo(({size:l="small"})=>{const{data:t,isLoading:i}=we(),s=Y(),a=x.useCallback(()=>{console.log("calling ðŸ“Š Unread count updated:"),t!==void 0&&ge.invalidateQueries({queryKey:["notifications","unread-count"]})},[]);return x.useEffect(()=>{const n=s==null?void 0:s.id;if(n)return w.emit("join_notifications",{userId:n}),w.on("unread_count_update",a),()=>{w.off("unread_count_update",a)}},[s==null?void 0:s.id,a]),!i&&typeof t=="number"&&t>0?l==="large"?e.jsx("span",{className:"absolute -top-2 -right-4 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:t>99?"99+":t}):e.jsx("span",{className:"absolute -top-2 -right-4 bg-red-500 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center",children:t>9?"9+":t}):null});D.displayName="NotificationBadge";const V=({isExpanded:l=!1,isActive:t=!1})=>{const i=T(),{organizationId:s}=S(),a=()=>{i(`/${s}/notification`)};return l?e.jsxs("div",{onClick:a,className:`cursor-pointer w-full flex justify-between items-center max-w-[95%] py-4 px-4 ${t?"bg-[#3a3b45] rounded-xl text-white":"rounded-xl hover:bg-[#3a3b45]"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("i",{className:`fa-solid fa-bell text-lg ${t?"text-[#4a86f7]":"text-[#9ca3af]"}`}),e.jsx(D,{size:"large"})]}),e.jsx("span",{className:"text-lg",children:"Notifications"})]}),e.jsx("span",{children:e.jsx("i",{className:"fa-solid fa-chevron-right"})})]}):e.jsx("div",{onClick:a,className:`cursor-pointer flex justify-center items-center py-4 px-4 ${t?"bg-[#3a3b45] rounded-xl text-white":"rounded-xl hover:bg-[#3a3b45]"}`,children:e.jsxs("div",{className:"relative",children:[e.jsx("i",{className:`fa-solid fa-bell ${t?"text-[#4a86f7]":"text-[#9ca3af]"}`}),e.jsx(D,{size:"small"})]})})},G=K.memo(({size:l="small",organizationId:t})=>{const{data:i,isLoading:s}=Ne({organizationId:t}),a=Y(),[r,n]=x.useState(0);return x.useEffect(()=>{typeof i=="number"&&n(i)},[i]),x.useEffect(()=>{if(!(a==null?void 0:a.id)||!w||!t)return;const g=m=>{console.log("ðŸ”” unread_ticket_count_update:",m.count),n(m.count)};return w.on("unread_ticket_count_update",g),()=>{w.off("unread_ticket_count_update",g)}},[]),!s&&typeof r=="number"&&r>0?l==="large"?e.jsx("span",{className:"absolute -top-2 -right-4 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:r>99?"99+":r}):e.jsx("span",{className:"absolute -top-2 -right-4 bg-red-500 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center",children:r>9?"9+":r}):null});G.displayName="TicketOperationBadge";const H=({isExpanded:l=!1,isActive:t=!1})=>{const i=T(),{organizationId:s}=S(),a=Y();x.useEffect(()=>{const n=a==null?void 0:a.id;!w||!s||!n||w.emit("join_ticket_discussion",{organizationId:s,userId:n})},[s,a==null?void 0:a.id]);const r=()=>{i(`/${s}/ticket`)};return l?e.jsxs("div",{onClick:r,className:`cursor-pointer flex w-full justify-between items-center max-w-[95%] py-4 px-4 ${t?"bg-[#3a3b45] rounded-xl text-white":"rounded-xl hover:bg-[#3a3b45]"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("i",{className:`fa-solid fa-ticket text-lg ${t?"text-[#4a86f7]":"text-[#9ca3af]"}`}),e.jsx(G,{organizationId:s,size:"large"})]}),e.jsx("span",{className:"text-lg",children:"Tickets"})]}),e.jsx("span",{children:e.jsx("i",{className:"fa-solid fa-chevron-right"})})]}):e.jsx("div",{onClick:r,className:`cursor-pointer flex justify-center items-center py-4 px-4 ${t?"bg-[#3a3b45] rounded-xl text-white":"rounded-xl hover:bg-[#3a3b45]"}`,children:e.jsxs("div",{className:"relative",children:[e.jsx("i",{className:`fa-solid fa-ticket ${t?"text-[#4a86f7]":"text-[#9ca3af]"}`}),e.jsx(G,{size:"small",organizationId:s})]})})},ve=({labels:l,icons:t,path:i,setProjectName:s,projectName:a})=>{const[r,n]=x.useState(!1),{projectId:p}=S(),C=T(),g=he(),m=g.pathname.split("/"),{organizationId:P}=S(),j=Q(),{role:f}=X(o=>o.authStore),[d,N]=x.useState(""),{data:b,isLoading:A}=be(p),{mutateAsync:B,isPending:L}=ne(),{mutateAsync:_,isPending:k}=ie(),{mutateAsync:I,isPending:u}=oe(),{mutateAsync:y,isPending:h}=re(),{mutateAsync:ce,isPending:M}=le();x.useEffect(()=>{s&&b&&b.projectName&&!A&&s((b==null?void 0:b.projectName)||"Project")},[b,A]);const de=()=>{n(!1)},fe=()=>{n(!0)},ue=m[2]==="projectdetails";x.useEffect(()=>{const c=g.pathname.split("/")[4];N(r?()=>pe[c]:()=>je[c])},[g.pathname,r]),ye(fe,de);const R=m[2]==="projectdetails",xe=m[1]==="login",me=()=>{R&&C(`/organizations/${P}/projects`),xe&&C("/organizations")},q=f&&["owner","CTO","staff"].includes(f),F=f&&["owner","CTO","staff","worker"].includes(f)&&P,U=async()=>{var o,c;try{f==="CTO"?await B():f==="client"?await _():f==="staff"?await I():f==="owner"?await y():f==="worker"&&await ce(),j(J()),j(Z()),j(ee()),j(se()),j(te()),j(ae()),$({title:"Success",description:"logout successfull"}),(!L||!k||!u||!h||!M)&&C("/")}catch(v){$({title:"Error",description:((c=(o=v==null?void 0:v.response)==null?void 0:o.data)==null?void 0:c.message)||"Failed to logout",variant:"destructive"})}};return e.jsx(e.Fragment,{children:r?e.jsxs("aside",{onMouseLeave:()=>n(!1),className:"relative flex flex-col bg-[#2f303a] w-[17%] min-h-screen max-h-screen text-[#9ca3af] select-none transition-all duration-300",children:[e.jsxs("div",{className:"flex flex-col flex-grow overflow-y-auto overflow-x-hidden custom-scrollbar p-2 large-scrollbar",children:[e.jsxs("div",{onClick:me,className:`flex ${R?"cursor-pointer":""} justify-between items-center border-b-1 py-2`,children:[e.jsx("span",{className:"text-xl",children:ue?a||"Project":E.COMPANY_NAME}),e.jsx("div",{className:"w-[30px] h-[30px]",children:e.jsx("img",{className:"w-full h-full",src:E.COMPANY_LOGO,alt:"LOGO"})})]}),e.jsxs("section",{className:"py-2 space-y-2",children:[" ",Object.entries(l).map(([o,c])=>{const v=d===c;return i[o]&&e.jsx(z,{to:i[o],className:"outline-none",children:e.jsxs("div",{onClick:()=>N(c),className:`cursor-pointer flex justify-between max-w-[95%] py-4 px-4 ${d===c?"bg-[#3a3b45] rounded-xl text-white":"rounded-xl hover:bg-[#3a3b45]"} `,ref:O=>{v&&O&&O.scrollIntoView({behavior:"smooth",block:"center"})},children:[e.jsx("span",{className:"text-lg",children:c}),e.jsx("span",{children:e.jsx("i",{className:"fa-solid fa-chevron-right"})})]})},c)})]})]}),e.jsxs("div",{className:"flex flex-col p-2 border-t border-[#3a3b45]",children:[m[1]!=="login"&&e.jsxs(W,{isLoading:L||k||u||h||M,onClick:U,className:"flex items-center gap-2 px-4 py-3 rounded-lg !bg-[#3a3b45] !text-[#9ca3af] hover:!bg-[#464751] hover:!text-white transition",children:[e.jsx("i",{className:"fa-solid fa-right-from-bracket"}),e.jsx("span",{children:"Logout"})]}),e.jsxs("div",{className:"mt-2 flex gap-2 w-full",children:[q&&e.jsx(V,{isExpanded:!1,isActive:!1}),F&&e.jsx(H,{isExpanded:!1,isActive:!1})]})]})]}):e.jsxs("aside",{onMouseEnter:()=>n(!0),className:"flex flex-col relative justify-between bg-[#2f303a] w-[6%]  max-h-full  text-[#9ca3af] transition-all duration-300 ",children:[e.jsx("div",{className:"max-h-[95%] overflow-y-auto overflow-x-hidden custom-scrollbar ",children:e.jsx("div",{className:"flex items-center flex-col justify-between w-full",children:Object.entries(t).map(([o,c])=>{const v=(d==null?void 0:d.toLowerCase())===o.toLowerCase();return i[o]?e.jsx(z,{to:i[o],className:`${i[o]?"":"cursor-not-allowed"}`,children:e.jsx("div",{onClick:()=>N(o),className:`cursor-pointer flex justify-between max-w-[95%] py-4 px-4 ${(d==null?void 0:d.toLowerCase())===o.toLowerCase()?"bg-[#3a3b45] rounded-xl text-white":"rounded-xl hover:bg-[#3a3b45]"} `,ref:O=>{v&&O&&O.scrollIntoView({behavior:"smooth",block:"center"})},children:e.jsx("i",{className:`${c} ${(d==null?void 0:d.toLowerCase())===o.toLowerCase()?"text-[#4a86f7]":"text-[#9ca3af]"} `})})},o):e.jsx("div",{className:"cursor-not-allowed flex justify-between max-w-[95%] py-4 px-4",children:e.jsx("i",{className:`${c}`})})})})}),e.jsxs("div",{className:"flex flex-col items-center p-2 border-t border-[#3a3b45]",children:[m[1]!=="login"&&e.jsx(W,{isLoading:L||k||u||h||M,title:"logout",onClick:U,className:"w-[40px] h-[40px] flex items-center justify-center !bg-[#3a3b45] !text-[#9ca3af] hover:!text-red-500 transition",children:e.jsx("i",{className:"fa-solid fa-right-from-bracket"})}),e.jsxs("div",{className:"",children:[q&&e.jsx(V,{isExpanded:!1,isActive:!1}),F&&e.jsx(H,{isExpanded:!1,isActive:!1})]})]})]})})},Me=x.memo(ve),ze=({isOpen:l,onClose:t,labels:i,path:s})=>{const a=T(),{organizationId:r}=S(),n=Q(),{role:p}=X(u=>u.authStore),{mutateAsync:C,isPending:g}=ne(),{mutateAsync:m,isPending:P}=ie(),{mutateAsync:j,isPending:f}=oe(),{mutateAsync:d,isPending:N}=re(),{mutateAsync:b,isPending:A}=le(),B=async()=>{var u,y;try{p==="CTO"?await C():p==="client"?await m():p==="staff"?await j():p==="owner"?await d():p==="worker"&&await b(),n(J()),n(Z()),n(ee()),n(se()),n(te()),n(ae()),$({title:"Success",description:"logout successfull"}),(!g||!P||!f||!N||!A)&&a("/")}catch(h){$({title:"Error",description:((y=(u=h==null?void 0:h.response)==null?void 0:u.data)==null?void 0:y.message)||"Failed to logout",variant:"destructive"})}};let L=Object.entries(i);const _=location.pathname.split("/"),k=_[2]==="projectdetails",I=()=>{k&&a(`/organizations/${r}/projects`)};return e.jsxs(e.Fragment,{children:[l&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40",onClick:t}),e.jsxs("aside",{className:`fixed top-0 left-0 z-50 h-screen bg-white w-[75%] flex flex-col transition-transform duration-300 ${l?"translate-x-0":"-translate-x-full"}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsxs("div",{onClick:I,className:`flex items-center gap-3 ${k?"cursor-pointer":""}`,children:[e.jsx("img",{src:E.COMPANY_LOGO,alt:"Logo",className:"w-10 h-10 rounded-full object-cover"}),e.jsx("span",{className:"text-lg font-semibold",children:E.COMPANY_NAME})]}),e.jsx("button",{onClick:t,className:"text-xl text-gray-700",children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsx("nav",{className:"flex flex-col flex-grow overflow-y-auto p-4",children:L.map(([u,y],h)=>e.jsxs(K.Fragment,{children:[s[u]?e.jsx(z,{to:s[u],onClick:t,className:"text-gray-800 hover:bg-gray-100 p-3 rounded block",children:y}):e.jsx("span",{className:"text-gray-400 p-3 rounded cursor-not-allowed block",children:y}),h<L.length-1&&e.jsx("hr",{className:"border-t border-gray-200 my-1"})]},u))}),e.jsx("div",{className:"border-t border-gray-200 p-4",children:_[1]!=="login"&&e.jsxs(W,{className:"w-full flex items-center justify-center gap-2",isLoading:g||P||f||N||A,onClick:B,children:[e.jsx("i",{className:"fas fa-sign-out-alt"})," Logout"]})})]})]})};export{ze as M,Me as S};
