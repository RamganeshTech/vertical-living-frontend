var D=i=>{throw TypeError(i)};var k=(i,e,s)=>e.has(i)||D("Cannot "+s);var n=(i,e,s)=>(k(i,e,"read from private field"),s?s.call(i):e.get(i)),b=(i,e,s)=>e.has(i)?D("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,s),c=(i,e,s,t)=>(k(i,e,"write to private field"),t?t.call(i,s):e.set(i,s),s),y=(i,e,s)=>(k(i,e,"access private method"),s);import{S as K,n as q,k as N,h as V,r as w,l as X}from"./index-By5P0A7l.js";import{Q as G,a as Y,b as Z,e as $,c as W,d as ee,s as F,f as T,w as se,g as te}from"./useQuery-Cc7pLKfK.js";function _(i,e){const s=new Set(e);return i.filter(t=>!s.has(t))}function re(i,e,s){const t=i.slice(0);return t[e]=s,t}var m,f,v,Q,p,g,C,S,x,a,P,B,H,L,A,j,ie=(j=class extends K{constructor(e,s,t){super();b(this,a);b(this,m);b(this,f);b(this,v);b(this,Q);b(this,p);b(this,g);b(this,C);b(this,S);b(this,x,[]);c(this,m,e),c(this,Q,t),c(this,v,[]),c(this,p,[]),c(this,f,[]),this.setQueries(s)}onSubscribe(){this.listeners.size===1&&n(this,p).forEach(e=>{e.subscribe(s=>{y(this,a,L).call(this,e,s)})})}onUnsubscribe(){this.listeners.size||this.destroy()}destroy(){this.listeners=new Set,n(this,p).forEach(e=>{e.destroy()})}setQueries(e,s){c(this,v,e),c(this,Q,s),q.batch(()=>{const t=n(this,p),u=y(this,a,H).call(this,n(this,v));c(this,x,u),u.forEach(o=>o.observer.setOptions(o.defaultedQueryOptions));const r=u.map(o=>o.observer),h=r.map(o=>o.getCurrentResult()),d=r.some((o,E)=>o!==t[E]);t.length===r.length&&!d||(c(this,p,r),c(this,f,h),this.hasListeners()&&(_(t,r).forEach(o=>{o.destroy()}),_(r,t).forEach(o=>{o.subscribe(E=>{y(this,a,L).call(this,o,E)})}),y(this,a,A).call(this)))})}getCurrentResult(){return n(this,f)}getQueries(){return n(this,p).map(e=>e.getCurrentQuery())}getObservers(){return n(this,p)}getOptimisticResult(e,s){const t=y(this,a,H).call(this,e),u=t.map(r=>r.observer.getOptimisticResult(r.defaultedQueryOptions));return[u,r=>y(this,a,B).call(this,r??u,s),()=>y(this,a,P).call(this,u,t)]}},m=new WeakMap,f=new WeakMap,v=new WeakMap,Q=new WeakMap,p=new WeakMap,g=new WeakMap,C=new WeakMap,S=new WeakMap,x=new WeakMap,a=new WeakSet,P=function(e,s){return s.map((t,u)=>{const r=e[u];return t.defaultedQueryOptions.notifyOnChangeProps?r:t.observer.trackResult(r,h=>{s.forEach(d=>{d.observer.trackProp(h)})})})},B=function(e,s){return s?((!n(this,g)||n(this,f)!==n(this,S)||s!==n(this,C))&&(c(this,C,s),c(this,S,n(this,f)),c(this,g,N(n(this,g),s(e)))),n(this,g)):e},H=function(e){const s=new Map(n(this,p).map(u=>[u.options.queryHash,u])),t=[];return e.forEach(u=>{const r=n(this,m).defaultQueryOptions(u),h=s.get(r.queryHash);h?t.push({defaultedQueryOptions:r,observer:h}):t.push({defaultedQueryOptions:r,observer:new G(n(this,m),r)})}),t},L=function(e,s){const t=n(this,p).indexOf(e);t!==-1&&(c(this,f,re(n(this,f),t,s)),y(this,a,A).call(this))},A=function(){var e;if(this.hasListeners()){const s=n(this,g),t=y(this,a,P).call(this,n(this,f),n(this,x)),u=y(this,a,B).call(this,t,(e=n(this,Q))==null?void 0:e.combine);s!==u&&q.batch(()=>{this.listeners.forEach(r=>{r(n(this,f))})})}},j);function he({queries:i,...e},s){const t=V(),u=Y(),r=Z(),h=w.useMemo(()=>i.map(l=>{const R=t.defaultQueryOptions(l);return R._optimisticResults=u?"isRestoring":"optimistic",R}),[i,t,u]);h.forEach(l=>{$(l),W(l,r)}),ee(r);const[d]=w.useState(()=>new ie(t,h,e)),[o,E,J]=d.getOptimisticResult(h,e.combine),z=!u&&e.subscribed!==!1;w.useSyncExternalStore(w.useCallback(l=>z?d.subscribe(q.batchCalls(l)):X,[d,z]),()=>d.getCurrentResult(),()=>d.getCurrentResult()),w.useEffect(()=>{d.setQueries(h,e)},[h,e,d]);const I=o.some((l,R)=>F(h[R],l))?o.flatMap((l,R)=>{const O=h[R];if(O){const U=new G(t,O);if(F(O,l))return T(O,U,r);se(l,u)&&T(O,U,r)}return[]}):[];if(I.length>0)throw Promise.all(I);const M=o.find((l,R)=>{const O=h[R];return O&&te({result:l,errorResetBoundary:r,throwOnError:O.throwOnError,query:t.getQueryCache().get(O.queryHash),suspense:O.suspense})});if(M!=null&&M.error)throw M.error;return E(J())}export{he as u};
