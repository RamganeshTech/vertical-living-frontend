import{a as i,j as e,c as ue,e as pe,R as he}from"./index-ftjmZ4WH.js";import{b as fe,c as de,d as ge}from"./quoteVariantApi-Qvh3e2Ay.js";import{B as Ne}from"./Button-BhpUbe89.js";import{N as be}from"./constants-BQ9tBty9.js";import je from"./MaterialOverviewLoading-D7Qp4omS.js";import{t as ie}from"./toast-BSC5QTk1.js";import{d as ye}from"./downloadFile-Dr-Jygm_.js";import{C as ne}from"./Card-BB2WhPtT.js";import{e as Se}from"./labourRateconfigApi-BbXk8Wks.js";import"./useQuery-DmDT-v30.js";import"./useMutation-CSGCjuCw.js";import"./roleCheck-BuedAs3v.js";import"./Skeleton-DF3ynh9X.js";const ce=({options:r,placeholder:q="Select an option",searchPlaceholder:A="Search...",onSelect:u,selectedValue:k,className:C=""})=>{const[$,P]=i.useState(!1),[B,N]=i.useState(""),[_,p]=i.useState(null),L=i.useRef(null),b=r.filter(h=>h.toLowerCase().includes(B.toLowerCase()));i.useEffect(()=>{const h=Q=>{L.current&&!L.current.contains(Q.target)&&P(!1)};return document.addEventListener("mousedown",h),()=>document.removeEventListener("mousedown",h)},[]),i.useEffect(()=>{if(k){const h=r.find(Q=>Q===k);p(h||null)}else p(null)},[k,r]);const G=h=>{p(h),u(h),P(!1),N("")},z=()=>{P(!0),N("")},U=h=>{N(h.target.value)};return e.jsxs("div",{className:`relative ${C}`,ref:L,children:[e.jsxs("div",{className:"w-full p-3 border border-gray-300 rounded-lg bg-white cursor-pointer hover:border-gray-400 transition-colors",onClick:z,children:[_?e.jsx("span",{className:"text-gray-800",children:_}):e.jsx("span",{className:"text-gray-500",children:q}),e.jsx("span",{className:"absolute right-3 top-3 text-gray-400",children:"▼"})]}),$&&e.jsxs("div",{className:"absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-auto",children:[e.jsx("div",{className:"p-2 border-b border-gray-200",children:e.jsx("input",{type:"text",placeholder:A,value:B,onChange:U,className:"w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0})}),e.jsx("div",{className:"py-1",children:b.length>0?b.map(h=>e.jsx("div",{className:`px-4 py-2 cursor-pointer hover:bg-gray-100 transition-colors ${_===h?"bg-blue-50 text-blue-600":""}`,onClick:()=>G(h),children:h},h)):e.jsx("div",{className:"px-4 py-2 text-gray-500 text-center",children:"No options found"})})]})]})},Z=(r,q,A)=>{const u=String(r).toLowerCase().replace("mm","").trim(),k=q.find(C=>String(C.thickness).toLowerCase().replace("mm","").trim()===u);return(k==null?void 0:k.rs)!==void 0?k.rs:A==="laminate"?ve:0},Te=i.forwardRef(({data:r,index:q,brandOptions:A,laminateBrandOptions:u,laminateRatesByBrand:k,brandRatesByName:C,labourCost:$,selectedBrand:P,selectedLaminateBrand:B,onFurnitureChange:N},_)=>{var H,ae;const[p,L]=i.useState(null),[b,G]=i.useState(null),z=p?C[p]||[]:[],U=b?k[b]||[]:[],h=i.useRef(B),Q=i.useRef(P),[m,O]=i.useState((r==null?void 0:r.coreMaterials)||[]),[J,V]=i.useState((r==null?void 0:r.fittingsAndAccessories)||[]),[K,D]=i.useState((r==null?void 0:r.glues)||[]),[X,te]=i.useState((r==null?void 0:r.nonBrandMaterials)||[]);i.useEffect(()=>{O((r==null?void 0:r.coreMaterials)||[])},[r==null?void 0:r.coreMaterials]),i.useEffect(()=>{Q.current!==P&&(L(P),Q.current=P)},[P]),i.useEffect(()=>{h.current!==B&&(G(B),h.current=B)},[B]),i.useEffect(()=>{!p&&(A==null?void 0:A.length)>0&&L(A[0])},[A]),i.useEffect(()=>{!b&&(u==null?void 0:u.length)>0&&G(u[0])},[u]);const le=()=>{let s=0;const a=p?C[p]||[]:[],c=b?k[b]||[]:[],n=m,o=n[0],R=((o==null?void 0:o.carpenters)||0)*((o==null?void 0:o.days)||0)*$,y=n.length>0?R/n.length:0;for(const w of n){const F=Z(w.plywoodNos.thickness,a,"plywood"),oe=Z(w.laminateNos.thickness,c,"laminate"),xe=w.plywoodNos.quantity*32*F,me=w.laminateNos.quantity*32*oe;s+=xe+me+y}const v=w=>(w.quantity||0)*(w.cost||0),g=w=>w.cost||0,j=r.fittingsAndAccessories.reduce((w,F)=>w+v(F),0),S=r.glues.reduce((w,F)=>w+g(F),0),W=r.nonBrandMaterials.reduce((w,F)=>w+v(F),0);return s+=j+S+W,Math.round(s)},Y=(t,s)=>{if(!b&&!b)return t.rowTotal||0;const c=Z(t.plywoodNos.thickness,z,"plywood"),n=Z(t.laminateNos.thickness,U,"laminate");console.log("ply Rate",c),console.log("lami Rate",n);const o=32,R=t.plywoodNos.quantity*(c*o),y=t.laminateNos.quantity*(n*o);console.log("plyCost",R),console.log("lamiCost",y);const v=R+y;console.log("baseMaterialCost",v);const g=v*(t.profitOnMaterial/100);console.log("profitOnMaterial",g);const j=s.length,S=s[0],F=S.carpenters*S.days*$*(1+(S.profitOnLabour||0)/100)/j,oe=v+g+F;return Math.round(oe)},se=m.reduce((t,s)=>t+Y(s,m),0),re=J.reduce((t,s)=>{const a=(s.quantity||0)*(s.cost||0),c=a*((s.profitOnMaterial||0)/100);return t+a+c},0),ee=K.reduce((t,s)=>{const a=s.cost||0,c=a*((s.profitOnMaterial||0)/100);return t+a+c},0),x=X.reduce((t,s)=>{const a=(s.quantity||0)*(s.cost||0),c=a*((s.profitOnMaterial||0)/100);return t+a+c},0),l=se+re+ee+x;i.useImperativeHandle(_,()=>({getUpdatedFurniture:()=>{const t=m.map(g=>({...g,rowTotal:Y(g,m)})),s=[...J],a=[...K],c=[...X],n=s.reduce((g,j)=>{const S=(j.quantity||0)*(j.cost||0),W=S*((j.profitOnMaterial||0)/100);return g+S+W},0),o=a.reduce((g,j)=>{const S=j.cost||0,W=S*((j.profitOnMaterial||0)/100);return g+S+W},0),R=c.reduce((g,j)=>{const S=(j.quantity||0)*(j.cost||0),W=S*((j.profitOnMaterial||0)/100);return g+S+W},0),y=t.reduce((g,j)=>g+(j.rowTotal||0),0),v=y+n+o+R;return{furnitureName:r.furnitureName,plywoodBrand:p,laminateBrand:b,coreMaterials:m.map(g=>({...g,rowTotal:Y(g,m)})),fittingsAndAccessories:s,glues:a,nonBrandMaterials:c,coreMaterialsTotal:y,fittingsAndAccessoriesTotal:n,gluesTotal:o,nonBrandMaterialsTotal:R,furnitureTotal:v,totals:{core:y,fittings:n,glues:o,nbms:R,furnitureTotal:v}}}}));const d=(t,s)=>{const a=[...m];if(a[t]={...a[t],profitOnMaterial:s||0},O(a),t!==0){N==null||N();return}const c=s,n=(o,R=!1)=>o.map(y=>{const v=R?y.cost||0:(y.quantity||0)*(y.cost||0),g=v*((c||0)/100);return{...y,profitOnMaterial:c,rowTotal:Math.round(v+g)}});V(o=>n(o)),D(o=>n(o,!0)),te(o=>n(o)),N==null||N()},f=t=>{if(!m[0])return;const s=[...m];s[0]={...s[0],profitOnLabour:t||0},O(s),N==null||N()},I=(t,s,a)=>{if(t==="Fittings & Accessories"){const c=[...J],n=(c[s].quantity||0)*(c[s].cost||0),o=n*((a||0)/100);c[s]={...c[s],profitOnMaterial:a,rowTotal:Math.round(n+o)},V(c)}if(t==="Glues"){const c=[...K],n=c[s].cost||0,o=n*((a||0)/100);c[s]={...c[s],profitOnMaterial:a,rowTotal:Math.round(n+o)},D(c)}if(t==="Non-Branded Materials"){const c=[...X],n=(c[s].quantity||0)*(c[s].cost||0),o=n*((a||0)/100);c[s]={...c[s],profitOnMaterial:a,rowTotal:Math.round(n+o)},te(c)}N==null||N()};i.useEffect(()=>{N==null||N()},[p,b,m,r.fittingsAndAccessories,r.glues]);const T=()=>e.jsxs("div",{className:"mt-6",children:[e.jsxs("h3",{className:"font-semibold text-md text-gray-800 mb-2",children:["Core Materials (Total: ₹",se.toLocaleString("en-IN"),")"]}),e.jsx("div",{className:"overflow-x-auto rounded-md",children:e.jsxs("table",{className:"min-w-full text-sm bg-white shadow-sm",children:[e.jsxs("thead",{className:"bg-blue-50 text-sm font-semibold text-gray-600",children:[e.jsxs("tr",{children:[e.jsx("th",{rowSpan:2,className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Image"}),e.jsx("th",{rowSpan:2,className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Item Name"}),e.jsx("th",{colSpan:2,className:"text-center px-6 py-1 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Plywood"}),e.jsx("th",{colSpan:2,className:"text-center px-6 py-1 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Laminate"}),e.jsx("th",{rowSpan:2,className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"No. of Carpenters / Day"}),e.jsx("th",{rowSpan:2,className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"No. of Days"}),e.jsx("th",{rowSpan:2,className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Profit % Material"}),e.jsx("th",{rowSpan:2,className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Profit % Labour"}),e.jsx("th",{rowSpan:2,className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Remarks"}),e.jsx("th",{rowSpan:2,className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),e.jsx("th",{rowSpan:2,className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]}),e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-6 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Qty"}),e.jsx("th",{className:"text-center px-6 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Thk"}),e.jsx("th",{className:"text-center px-6 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Qty"}),e.jsx("th",{className:"text-center px-6 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Thk"})]})]}),e.jsx("tbody",{children:(m==null?void 0:m.length)>0&&(m==null?void 0:m.map((t,s)=>{var c,n,o,R,y,v,g,j;const a=Y(t,m);return e.jsxs("tr",{className:"group border",children:[s===0&&e.jsx("td",{rowSpan:(c=r==null?void 0:r.coreMaterials)==null?void 0:c.length,className:"text-center border-r-1 p-2",children:t!=null&&t.imageUrl?e.jsx("img",{src:(t==null?void 0:t.imageUrl)||be,className:"h-10 mx-auto"}):e.jsx(e.Fragment,{children:"—"})}),e.jsx("td",{className:"text-center border-r-1 p-2",children:(t==null?void 0:t.itemName)||"—"}),e.jsx("td",{className:"text-center border-r-1 p-2",children:((n=t==null?void 0:t.plywoodNos)==null?void 0:n.quantity)??0}),e.jsx("td",{className:"text-center border-r-1 p-2",children:((o=t==null?void 0:t.plywoodNos)==null?void 0:o.thickness)??0}),e.jsx("td",{className:"text-center border-r-1 p-2",children:((R=t==null?void 0:t.laminateNos)==null?void 0:R.quantity)??0}),e.jsx("td",{className:"text-center border-r-1 p-2",children:((y=t==null?void 0:t.laminateNos)==null?void 0:y.thickness)??0}),s===0&&e.jsxs(e.Fragment,{children:[e.jsx("td",{rowSpan:(v=r==null?void 0:r.coreMaterials)==null?void 0:v.length,className:"text-center border-r-1 p-2",children:(t==null?void 0:t.carpenters)||0}),e.jsx("td",{rowSpan:(g=r==null?void 0:r.coreMaterials)==null?void 0:g.length,className:"text-center border-r-1 p-2",children:(t==null?void 0:t.days)||0})]}),e.jsx("td",{className:"text-center border-r-1 p-2",children:e.jsx("input",{type:"number",value:m[s].profitOnMaterial,onChange:S=>d(s,parseFloat(S.target.value)),className:"w-16 text-center border border-gray-300 rounded px-2 py-1 text-sm"})}),s===0&&e.jsx("td",{rowSpan:(j=r==null?void 0:r.coreMaterials)==null?void 0:j.length,className:"text-center border-r-1 p-2",children:e.jsx("input",{type:"number",value:m[0].profitOnLabour,onChange:S=>f(parseFloat(S.target.value)),className:"w-16 text-center border border-gray-300 rounded px-2 py-1 text-sm"})}),e.jsx("td",{className:"text-center border-r-1 p-2",children:(t==null?void 0:t.remarks)||"—"}),e.jsxs("td",{className:"text-center border-r-1 p-2 text-green-700 font-bold",children:["₹",a==null?void 0:a.toLocaleString("en-IN")]}),e.jsx("td",{className:"text-center border-r-1 p-2",children:"—"})]},s)}))})]})})]}),M=t=>t==="Fittings & Accessories"?Math.round(re):t==="Glues"?Math.round(ee):t==="Non-Branded Materials"?Math.round(x):0,E=(t,s)=>e.jsxs("div",{className:"mt-4",children:[e.jsxs("h3",{className:"font-semibold text-md mb-2 text-gray-800",children:[t,"(Total: ₹",M(t).toLocaleString("en-IN"),")"]}),e.jsxs("table",{className:"min-w-full text-sm bg-white shadow-sm",children:[e.jsx("thead",{className:"bg-blue-50 text-sm font-semibold text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Item Name"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Description"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Quantity"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Cost"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Profit On Materials"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{children:s.length>0&&s.map((a,c)=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"text-center border p-2",children:(a==null?void 0:a.itemName)||"—"}),e.jsx("td",{className:"text-center border p-2",children:(a==null?void 0:a.description)||"—"}),e.jsx("td",{className:"text-center border p-2",children:(a==null?void 0:a.quantity)||0}),e.jsx("td",{className:"text-center border p-2",children:(a==null?void 0:a.cost)||0}),e.jsx("td",{className:"text-center border p-2",children:e.jsx("input",{type:"number",value:a.profitOnMaterial||0,onChange:n=>I(t,c,parseFloat(n.target.value)),className:"w-16 text-center border border-gray-300 rounded px-2 py-1 text-sm"})}),e.jsxs("td",{className:"text-center border p-2 text-green-700 font-bold",children:["₹",(a.rowTotal||0).toLocaleString("en-IN")]}),e.jsx("td",{className:"text-center border p-2",children:"—"})]},c))})]})]});return e.jsxs("div",{className:"shadow-md p-4 my-4 border rounded-lg bg-white",children:[e.jsxs("div",{className:" flex justify-between items-center",children:[e.jsxs("h2",{className:"text-xl font-semibold  text-blue-600",children:["Product ",q+1,": ",r.furnitureName]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-right text-xl font-bold text-green-700",children:["Product Total: ₹",l.toLocaleString("en-IN")]}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Raw Cost (no profit)"}),e.jsxs("p",{className:"text-lg font-semibold text-blue-700",children:["₹",le().toLocaleString("en-IN")]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"font-medium text-gray-700",children:"Select Plwyood Brand:"}),e.jsx(ce,{options:A,placeholder:"-- Choose Plwyood Brand --",searchPlaceholder:"Search Plywood brands...",onSelect:L,selectedValue:p||"",className:"mt-1"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"font-medium text-gray-700",children:"Select Laminate Brand:"}),e.jsx(ce,{options:u,placeholder:"-- Choose Laminate Brand --",searchPlaceholder:"Search laminate brands...",onSelect:G,selectedValue:b||"",className:"mt-1"})]})]}),e.jsxs("div",{children:[p&&((H=C[p])==null?void 0:H.length)>0&&e.jsxs("div",{className:"mt-6 border border-gray-200 bg-white rounded-md shadow-sm p-4",children:[e.jsxs("h3",{className:"text-md font-semibold text-gray-800 mb-2",children:["Available Thickness & Rates for ",e.jsx("span",{className:"text-blue-600",children:p})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm text-left border border-gray-100",children:[e.jsx("thead",{className:"bg-blue-50 text-xs text-gray-600 uppercase tracking-wider",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 border-r",children:"Thickness"}),e.jsx("th",{className:"px-4 py-2",children:"Rate (₹/sqft)"})]})}),e.jsx("tbody",{children:C[p].map((t,s)=>e.jsxs("tr",{className:"border-t border-gray-100",children:[e.jsx("td",{className:"px-4 py-2 border-r text-gray-700 font-medium",children:t.thickness}),e.jsxs("td",{className:"px-4 py-2 text-green-800 font-bold",children:["₹",t.rs.toFixed(2)]})]},s))})]})})]}),b&&((ae=k[b])==null?void 0:ae.length)>0&&e.jsxs("div",{className:"mt-4 border bg-white rounded-md shadow-sm p-4",children:[e.jsxs("h3",{className:"text-md font-semibold text-gray-800 mb-2",children:["Laminate Rates for ",e.jsx("span",{className:"text-blue-600",children:b})]}),e.jsxs("table",{className:"min-w-full text-sm border",children:[e.jsx("thead",{className:"bg-blue-50 text-xs text-gray-600 uppercase",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 border-r",children:"Thickness"}),e.jsx("th",{className:"px-4 py-2",children:"Rate (₹/sqft)"})]})}),e.jsx("tbody",{children:k[b].map((t,s)=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-2 border-r font-medium",children:t.thickness}),e.jsxs("td",{className:"px-4 py-2 text-green-800 font-bold",children:["₹",t.rs.toFixed(2)]})]},s))})]})]})]})]}),T(),E("Fittings & Accessories",J),E("Glues",K),E("Non-Branded Materials",X)]})}),ve=10,qe=()=>{var ee;const{organizationId:r,quoteId:q}=ue(),A=pe(),{data:u,isLoading:k}=fe(r,q);let{data:C,isLoading:$}=de(r,"plywood"),{data:P}=de(r,"Laminate"),{data:B=0}=Se(r);const{mutateAsync:N,isPending:_}=ge(),p=i.useRef([]),[L,b]=i.useState(null),[G,z]=i.useState(null),U=i.useMemo(()=>{if(!C)return{};const x={};return C.forEach(l=>{const d=(l==null?void 0:l.data)||{},f=d.Brand??d.brand,I=d["thickness (mm)"]||d.thickness||d.Thickness;let T=d.Rs||d.rs;if(f&&I&&T){const M=String(f).trim(),E=String(I).trim(),H=parseFloat(T);x[M]||(x[M]=[]),x[M].push({thickness:E,rs:H})}}),x},[C]),h=i.useMemo(()=>Object.keys(U),[U]),Q=i.useMemo(()=>{if(!P)return{};const x={};return P.forEach(l=>{const d=(l==null?void 0:l.data)||{},f=d.Brand??d.brand,I=d["thickness (mm)"]||d.thickness||d.Thickness,T=d.Rs||d.rs;if(f&&I&&T){const M=String(f).trim(),E=String(I).trim(),H=parseFloat(T);x[M]||(x[M]=[]),x[M].push({thickness:E,rs:H})}}),x},[P]),m=i.useMemo(()=>Object.keys(Q),[Q]),[O,J]=i.useState([]),[V,K]=i.useState(0),[D,X]=i.useState(0),te=()=>{const x=p.current.map(d=>d.current).filter(d=>d!==null).map(d=>d.getUpdatedFurniture());console.log("updatedFurnitures",x);const l=x.reduce((d,f)=>d+f.totals.furnitureTotal,0);console.log("total",l),K(l),X(se())},{profitDifference:le,profitPercentage:Y}=i.useMemo(()=>{const x=V-D,l=D>0?x/D*100:0;return{profitDifference:Math.round(x),profitPercentage:l}},[V,D]),se=()=>{const x=p.current.map(f=>f.current).filter(f=>f!==null).map(f=>f.getUpdatedFurniture()),l=32;let d=0;return x.forEach(f=>{const I=f.plywoodBrand?U[f.plywoodBrand]||[]:[],T=f.laminateBrand?Q[f.laminateBrand]||[]:[],M=f.coreMaterials,E=M[0],H=((E==null?void 0:E.carpenters)||0)*((E==null?void 0:E.days)||0)*B,ae=M.length>0?H/M.length:0;M.forEach(n=>{const o=Z(n.plywoodNos.thickness,I,"plywood"),R=Z(n.laminateNos.thickness,T,"laminate"),y=n.plywoodNos.quantity*(o*l),v=n.laminateNos.quantity*(R*l),g=y+v;d+=g+ae});const t=n=>n.quantity*n.cost,s=f.fittingsAndAccessories.reduce((n,o)=>n+t(o),0),a=f.glues.reduce((n,o)=>n+(o.cost||0),0),c=f.nonBrandMaterials.reduce((n,o)=>n+t(o),0);d+=s+a+c}),Math.round(d)},re=async()=>{var x,l;try{if(!r||!q||!u||!L){ie({title:"Missing info",description:"Please ensure brand and all details are selected",variant:"destructive"});return}const d=p.current.map(T=>T.current).filter(T=>T!==null).map(T=>T.getUpdatedFurniture()),f=d.reduce((T,M)=>T+M.totals.furnitureTotal,0),I=await N({quoteId:q,organizationId:r,data:{quoteId:q,organizationId:r,projectId:u.projectId,brandName:L,laminateBrand:G,furnitures:d,grandTotal:f,notes:"Generated with brand variant"}});ye({src:I.url,alt:I.fileName}),ie({title:"success",description:"Successfully created, check it in the Quote for clients section"})}catch(d){ie({title:"Error",description:((l=(x=d==null?void 0:d.response)==null?void 0:x.data)==null?void 0:l.message)??"Operation failed"})}};return i.useEffect(()=>{if(!(u!=null&&u.furnitures))return;const x=u.furnitures.map(l=>({furnitureName:l.furnitureName,coreMaterials:l.coreMaterials||[],fittingsAndAccessories:l.fittingsAndAccessories||[],glues:l.glues||[],nonBrandMaterials:l.nonBrandMaterials||[],totals:{core:l.coreMaterialsTotal||0,fittings:l.fittingsAndAccessoriesTotal||0,glues:l.gluesTotal||0,nbms:l.nonBrandMaterialsTotal||0,furnitureTotal:l.furnitureTotal||0},plywoodBrand:L,laminateBrand:G}));J(x)},[u]),p.current.length!==O.length&&(p.current=O.map((x,l)=>p.current[l]??he.createRef())),i.useEffect(()=>{console.log("furnitureRefs Array",p),p.current=O.map((x,l)=>p.current[l]??i.createRef())},[O]),i.useEffect(()=>{!L&&(h==null?void 0:h.length)>0&&b(h[0])},[h]),i.useEffect(()=>{!G&&(m==null?void 0:m.length)>0&&z(m[0])},[m]),e.jsxs("div",{className:"p-2 max-h-full overflow-y-auto",children:[e.jsxs("header",{className:"bg-white border-b border-gray-200 pb-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("button",{onClick:()=>A(-1),className:"flex items-center justify-center w-8 h-8 bg-gray-50 hover:bg-gray-100 border border-gray-300 rounded-md transition-colors flex-shrink-0",children:e.jsx("i",{className:"fas fa-arrow-left text-gray-600 text-sm"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900 truncate",children:((ee=u==null?void 0:u.projectId)==null?void 0:ee.projectName)||"Project"}),e.jsx("p",{className:"text-md text-gray-500",children:u!=null&&u.quoteNo?`Quote: #${u==null?void 0:u.quoteNo}`:""})]})]}),e.jsx(Ne,{onClick:re,disabled:_,className:"flex-shrink-0",children:_?"Generating...":"Generate Quote"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 whitespace-nowrap",children:"Plywood Brand:"}),e.jsx(ce,{options:h,placeholder:"Select Plywood Brand",searchPlaceholder:"Search brands...",onSelect:b,selectedValue:L||"",className:"flex-1"})]})}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 whitespace-nowrap",children:"Laminate Brand:"}),e.jsx(ce,{options:m,placeholder:"Select Laminate Brand",searchPlaceholder:"Search brands...",onSelect:z,selectedValue:G||"",className:"flex-1"})]})})]}),e.jsxs("div",{className:" grid grid-cols-4 gap-2",children:[e.jsx(ne,{className:"px-2 py-4 border-l-4 border-blue-600",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-md text-gray-600",children:["Project Cost "," "," ",e.jsx("span",{className:"font-bold",children:"(without profit)"})]}),e.jsxs("p",{className:"text-md font-bold text-blue-600",children:["₹",D.toLocaleString("en-IN")]})]})}),e.jsx(ne,{className:"px-2 py-4 border-l-4 border-green-600",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-md text-gray-600",children:["Client Quote Amount "," "," ",e.jsx("span",{className:"font-bold",children:"(with profit)"})]}),e.jsxs("p",{className:"text-md font-bold text-green-600",children:["₹",V.toLocaleString("en-IN")]})]})}),e.jsx(ne,{className:"px-2 py-4 border-l-4 border-violet-600",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-md text-gray-600",children:"Profit Amount"}),e.jsxs("p",{className:"text-md font-bold text-violet-600",children:["₹",le.toLocaleString("en-IN")," ",e.jsxs("span",{className:"text-black !text-[12px] ml-[5px] font-semibold",children:["(",Y.toFixed(2),"%)"]})]})]})}),e.jsx(ne,{className:"px-2 py-4 border-l-4 border-orange-600",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-md text-gray-600",children:"Single Labour Cost"}),e.jsxs("p",{className:"text-md font-bold text-orange-600",children:["₹",B]})]})})]})]}),k||$?e.jsx(je,{}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-6",children:[O.map((x,l)=>e.jsx(Te,{index:l,data:x,labourCost:B,ref:p.current[l],laminateRatesByBrand:Q,brandRatesByName:U,selectedBrand:L,selectedLaminateBrand:G,brandOptions:h,laminateBrandOptions:m,onFurnitureChange:te},l)),e.jsx("div",{className:"mt-10 text-right",children:e.jsxs("div",{className:"inline-block bg-green-50 border border-green-200 rounded-md px-6 py-4",children:[e.jsx("p",{className:"text-md font-medium text-gray-700 mb-1",children:"Total Estimate"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700",children:["₹",V.toLocaleString("en-IN")]})]})})]})})]})};export{ve as DEFAULT_LAMINATE_RATE_PER_SQFT,qe as default};
