import{u as T,a as B,b as M,j as e}from"./index-Dkf7SbMA.js";import{B as d}from"./Button-ClgICMLF.js";import{C as S,a as I}from"./Card-BI-_ii1r.js";import{t as o}from"./toast-BSC5QTk1.js";import{u as R,a as H,b as U}from"./orderMaterialHistoryApi-C6JelmQB.js";import{I as V}from"./ImageGalleryMain-DWzO9-7s.js";import{d as F}from"./downloadFile-C340hrAB.js";import"./roleCheck-CXq1v0D5.js";import"./useQuery-h0LZ4b8f.js";import"./useMutation-DtRxugN4.js";import"./constants-4IFJeChr.js";import"./index-CwzFm0RL.js";const re=()=>{var y,v,w,P;const{projectId:m,orderItemId:x,organizationId:C}=T(),u=B(),{role:b,permission:i}=M(),g=b==="owner"||((y=i==null?void 0:i.ordermaterial)==null?void 0:y.create),p=b==="owner"||((v=i==null?void 0:i.ordermaterial)==null?void 0:v.edit),{data:s,isLoading:O,isError:E,refetch:G}=R(m,x),{mutateAsync:z,isPending:j}=H(),{mutateAsync:A,isPending:W}=U(),_=async()=>{var r,n;try{await A({projectId:m,orderItemId:x,organizationId:C}),o({description:"Sent to Procurement",title:"Success"})}catch(a){o({title:"Error",description:((n=(r=a==null?void 0:a.response)==null?void 0:r.data)==null?void 0:n.message)||a.message||"Failed to update completion status",variant:"destructive"})}},N=async()=>{var r,n;try{if(!m||!x)return;const a=await z({projectId:m,organizationId:s==null?void 0:s.organizationId,orderItemId:x});await F({src:a==null?void 0:a.pdfUrl,alt:"Order Material"}),o({title:"Success",description:"PDF Generated successfully"}),G()}catch(a){o({title:"Error",description:((n=(r=a==null?void 0:a.response)==null?void 0:r.data)==null?void 0:n.message)||(a==null?void 0:a.message)||"Failed to generate PDF",variant:"destructive"})}},L=async()=>{var r,n,a,k;try{await F({src:(r=s==null?void 0:s.pdfLink)==null?void 0:r.url,alt:(n=s==null?void 0:s.pdfLink)==null?void 0:n.pdfName}),o({title:"Success",description:"PDF Downloaded successfully"})}catch(c){o({title:"Error",description:((k=(a=c==null?void 0:c.response)==null?void 0:a.data)==null?void 0:k.message)||(c==null?void 0:c.message)||"Failed to generate PDF",variant:"destructive"})}};if(O)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"flex flex-col items-center gap-2 text-blue-600",children:[e.jsx("i",{className:"fas fa-spinner fa-spin text-4xl"}),e.jsx("p",{className:"font-medium",children:"Loading Order Details..."})]})});if(E||!s)return e.jsx("div",{className:"p-8 text-center",children:e.jsxs("div",{className:"bg-red-50 text-red-600 p-4 rounded-lg inline-block",children:[e.jsx("i",{className:"fas fa-exclamation-triangle text-2xl mb-2"}),e.jsx("p",{children:"Failed to load order details."}),e.jsx(d,{onClick:()=>u(-1),className:"mt-4",variant:"outline",children:"Go Back"})]})});const{shopDetails:t,deliveryLocationDetails:l,subItems:f,pdfLink:h}=s;return e.jsx("div",{className:"min-h-full max-h-full overflow-y-auto bg-gray-50/50 p-4 sm:p-6 lg:p-8 font-sans pb-24",children:e.jsxs("div",{className:"max-w-full mx-auto space-y-6",children:[e.jsxs("header",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 bg-white p-4 rounded-xl shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>u(-1),className:"w-8 h-8 flex items-center justify-center rounded-lg bg-gray-100 hover:bg-gray-200 text-gray-600 transition-colors",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl sm:text-2xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-file-invoice text-blue-600"}),"Order Details"]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Order Id: ",e.jsx("span",{className:"font-mono font-bold text-gray-700",children:s.orderMaterialNumber||"N/A"})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[s.isSyncWithProcurement&&e.jsxs("span",{className:"px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-xs font-bold flex items-center gap-1 border border-purple-200",children:[e.jsx("i",{className:"fas fa-check-circle"})," Synced with Procurement"]}),s.isPublicOrder&&e.jsxs("span",{className:"px-3 py-1 bg-green-100 text-green-700 rounded-full text-xs font-bold flex items-center gap-1 border border-green-200",children:[e.jsx("i",{className:"fas fa-globe"})," Public Order"]}),(g||p)&&e.jsx(d,{variant:"primary",onClick:_,disabled:s==null?void 0:s.isSyncWithProcurement,title:s!=null&&s.isSyncWithProcurement?"already sent to procurement":"",isLoading:W,className:"border-green-300 text-blue-700 hover:bg-blue-100 hover:border-blue-400 disabled:cursor-not-allowed",children:"Send To Procurement"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(S,{className:"bg-white border-l-4 border-l-purple-500 shadow-sm",children:e.jsxs(I,{className:"p-5",children:[e.jsxs("h3",{className:"text-md font-bold text-gray-800 mb-3 flex items-center gap-2 border-b border-gray-100 pb-2",children:[e.jsx("i",{className:"fas fa-store text-purple-600"})," Shop Details"]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-700",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Name:"})," ",e.jsx("span",{className:"font-semibold",children:(t==null?void 0:t.shopName)||"-"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Contact:"})," ",e.jsx("span",{children:(t==null?void 0:t.contactPerson)||"-"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Phone:"})," ",e.jsx("span",{className:"font-mono",children:(t==null?void 0:t.phoneNumber)||"-"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Location:"})," ",e.jsx("span",{className:"truncate max-w-[200px]",children:(t==null?void 0:t.address)||"-"})]})]})]})}),e.jsx(S,{className:"bg-white border-l-4 border-l-orange-500 shadow-sm",children:e.jsxs(I,{className:"p-5",children:[e.jsxs("h3",{className:"text-md font-bold text-gray-800 mb-3 flex items-center gap-2 border-b border-gray-100 pb-2",children:[e.jsx("i",{className:"fas fa-truck text-orange-600"})," Delivery Location"]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-700",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Site:"})," ",e.jsx("span",{className:"font-semibold",children:(l==null?void 0:l.siteName)||"-"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Supervisor:"})," ",e.jsx("span",{children:(l==null?void 0:l.siteSupervisor)||"-"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Phone:"})," ",e.jsx("span",{className:"font-mono",children:(l==null?void 0:l.phoneNumber)||"-"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Address:"})," ",e.jsx("span",{className:"truncate max-w-[200px]",children:(l==null?void 0:l.address)||"-"})]})]})]})})]}),(s==null?void 0:s.images)&&((w=s==null?void 0:s.images)==null?void 0:w.length)>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-image text-blue-600"})," Images"]}),((P=s==null?void 0:s.images)==null?void 0:P.length)>0?e.jsx(V,{imageFiles:s==null?void 0:s.images,height:150,minWidth:150,maxWidth:200}):e.jsx("div",{className:"text-gray-500 text-sm italic bg-gray-50 p-8 rounded-lg text-center border-2 border-dashed border-gray-200",children:"No Images uploaded yet."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-cubes text-blue-600"})," Ordered Items"]}),e.jsx("div",{className:"grid gap-5",children:e.jsx("div",{className:"mt-5 pt-0 animate-in fade-in zoom-in-95 duration-200",children:e.jsxs("div",{className:"relative overflow-hidden rounded-lg border-2 border-blue-100 bg-white",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-0 bg-blue-50/50 border-b border-blue-100 text-xs font-bold text-blue-800 uppercase tracking-wide",children:[e.jsx("div",{className:"col-span-2 px-4 py-3 border-r border-blue-100",children:"Ref ID"}),e.jsx("div",{className:"col-span-6 px-4 py-3 border-r border-blue-100",children:"Material Name"}),e.jsx("div",{className:"col-span-2 px-4 py-3 border-r border-blue-100 text-center",children:"Qty"}),e.jsx("div",{className:"col-span-2 px-4 py-3 text-center",children:"Unit"})]}),f&&f.length>0?f.map((r,n)=>e.jsxs("div",{className:"grid grid-cols-12 gap-0 border-b border-gray-100 hover:bg-gray-50 transition-colors text-sm text-gray-700",children:[e.jsx("div",{className:"col-span-2 px-4 py-3 border-r border-gray-100 font-mono text-xs text-gray-500 truncate",children:r.refId||"-"}),e.jsx("div",{className:"col-span-6 px-4 py-3 border-r border-gray-100 font-medium",children:r.subItemName}),e.jsx("div",{className:"col-span-2 px-4 py-3 border-r border-gray-100 text-center",children:r.quantity}),e.jsx("div",{className:"col-span-2 px-4 py-3 border-r border-gray-100 text-center",children:r.unit})]},r._id||n)):e.jsx("div",{className:"p-6 text-center text-gray-400 italic text-sm",children:"No detailed sub-items found for this unit."})]})})})]}),e.jsx("div",{className:" bg-white border-t border-gray-200 p-4 shadow-[0_-4px_10px_rgba(0,0,0,0.05)] z-40",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex flex-col sm:flex-row justify-between items-center gap-4",children:[e.jsx("div",{className:"text-sm text-gray-600",children:h?e.jsxs("span",{className:"flex items-center text-green-600 gap-2 font-medium",children:[e.jsx("i",{className:"fas fa-check-circle"})," PDF is ready for this order."]}):e.jsxs("span",{className:"flex items-center text-orange-600 gap-2 font-medium",children:[e.jsx("i",{className:"fas fa-info-circle"})," PDF not generated yet."]})}),e.jsx("div",{className:"flex gap-3 w-full sm:w-auto",children:h?e.jsxs(e.Fragment,{children:[e.jsxs(d,{variant:"outline",onClick:()=>window.open(h.url,"_blank"),className:"w-full sm:w-auto",children:[e.jsx("i",{className:"fas fa-eye mr-2"})," View PDF"]}),e.jsxs(d,{onClick:L,className:"w-full sm:w-auto bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx("i",{className:"fas fa-download mr-2"})," Download"]}),(p||g)&&e.jsx(d,{variant:"ghost",isLoading:j,onClick:N,className:"text-gray-400 hover:text-blue-600",title:"Regenerate PDF",children:e.jsx("i",{className:"fas fa-sync-alt"})})]}):e.jsx(e.Fragment,{children:(p||g)&&e.jsxs(d,{onClick:N,isLoading:j,className:"w-full sm:w-auto bg-blue-600 hover:bg-blue-700 text-white px-8",children:[e.jsx("i",{className:"fas fa-file-pdf mr-2"})," Generate & Save PDF"]})})})]})})]})})};export{re as default};
