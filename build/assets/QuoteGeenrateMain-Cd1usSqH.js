import{h as q,k as E,q as I,l as Q,u as _,r as x,j as e,B as p,t as b}from"./index-sOEqqOOm.js";import{u as B}from"./projectApi-CmRaFHkL.js";import{F as G}from"./FurnitureForm-AUj5tGUu.js";const O=async({api:u,organizationId:i,projectId:c,formData:l})=>{const{data:o}=await u.post(`/quote/quotegenerate/createquote/${i}/${c}`,l,{headers:{"Content-Type":"multipart/form-data"}});if(!o.ok)throw new Error(o.message||"Failed to create quote.");return o.data},P=()=>{const u=["owner","staff","CTO"],{role:i}=q(),c=Q(i);return E({mutationFn:async({organizationId:l,projectId:o,formData:n})=>{if(!i||!u.includes(i))throw new Error("Not allowed to create quotes");if(!c)throw new Error("API instance for role not found");return await O({api:c,organizationId:l,projectId:o,formData:n})},onSuccess:(l,{organizationId:o})=>{I.invalidateQueries({queryKey:["quote-material-items",o]})}})},L=()=>{const{organizationId:u}=_(),{data:i}=B(u),c=x.useMemo(()=>(i==null?void 0:i.map(t=>({_id:t._id,projectName:t.projectName})))||[],[i]),[l,o]=x.useState({projectId:"",projectName:""}),[n,f]=x.useState([]),[F,d]=x.useState(!1),[m,h]=x.useState(""),{mutateAsync:M,isPending:C}=P(),y=t=>{f(a=>[...a,{furnitureName:t,coreMaterials:[S()],fittingsAndAccessories:[g()],glues:[g()],nonBrandMaterials:[g()],totals:{core:0,fittings:0,glues:0,nbms:0,furnitureTotal:0}}])},k=t=>{f(a=>a.filter((s,r)=>r!==t))},S=()=>({itemName:"",plywoodNos:{quantity:0,thickness:0},laminateNos:{quantity:0,thickness:0},carpenters:0,days:0,profitOnMaterial:0,profitOnLabour:0,rowTotal:0,remarks:""}),g=()=>({itemName:"",description:"",quantity:0,cost:0,rowTotal:0}),v=n==null?void 0:n.reduce((t,a)=>t+a.totals.furnitureTotal,0),T=async()=>{var t,a;try{if(!l.projectId){b({title:"Error",description:"Please select a project",variant:"destructive"});return}const s=new FormData;s.append("furnitures",JSON.stringify(n.map(r=>({furnitureName:r.furnitureName,coreMaterials:r.coreMaterials.map(j=>{const{imageUrl:N,previewUrl:w,...A}=j;return A}),fittingsAndAccessories:r.fittingsAndAccessories,glues:r.glues,nonBrandMaterials:r.nonBrandMaterials,coreMaterialsTotal:r.totals.core,fittingsAndAccessoriesTotal:r.totals.fittings,gluesTotal:r.totals.glues,nonBrandMaterialsTotal:r.totals.nbms,furnitureTotal:r.totals.furnitureTotal})))),n.forEach((r,j)=>{r.coreMaterials.forEach((N,w)=>{N.imageUrl&&s.append(`images[${j}][${w}]`,N.imageUrl)})}),s.append("grandTotal",v.toString()),s.append("notes","Generated"),await M({organizationId:u,projectId:l.projectId,formData:s}),b({title:"Success",description:"Created Successfully, Visit in Quote Generator Section"}),f([])}catch(s){b({title:"Error",description:((a=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:a.message)||(s==null?void 0:s.message)||"failed to generate the items",variant:"destructive"})}};return e.jsxs("div",{className:" h-full mx-auto max-h-full ",children:[e.jsxs("header",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 py-1 border-b-1 border-[#818283]",children:[e.jsx("div",{children:e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-file mr-3 text-blue-600"}),"Internal Quote Entry"]})}),e.jsxs("div",{className:"flex gap-6 items-center ",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Select Project *"}),e.jsxs("select",{value:l.projectId,onChange:t=>{const a=c.find(s=>s._id===t.target.value);a&&o({projectId:a._id,projectName:a.projectName})},className:" px-2 py-2 rounded-xl border border-blue-200 focus:border-blue-200 active:border-blue-200",children:[e.jsx("option",{value:"",children:"Select a project"}),c.map(t=>e.jsx("option",{value:t._id,children:t.projectName},t._id))]})]}),e.jsxs("div",{className:"text-right flex gap-2 items-center",children:[e.jsx("div",{className:"text-xs text-gray-600 uppercase tracking-widest",children:"Grand Total"}),e.jsxs("div",{className:"text-xl font-semibold text-green-600",children:["â‚¹",v.toLocaleString("en-IN")]})]}),e.jsxs(p,{className:"flex items-center",onClick:()=>d(!0),children:[e.jsx("i",{className:"fas fa-add mr-1",children:" "})," Furniture"]})]})]}),F&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 bg-opacity-40 backdrop-blur-sm transition",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg p-6 w-full max-w-md relative animate-scaleIn",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-800",children:"Add New Furniture"}),e.jsx("input",{className:"w-full border border-gray-300 rounded px-3 py-2 mb-4 outline-none focus:ring-2 focus:ring-blue-400",placeholder:"Enter Furniture Name",value:m,autoFocus:!0,onChange:t=>h(t.target.value),onKeyDown:t=>{if(t.key==="Enter"){if(!m.trim())return;y(m),h(""),d(!1)}}}),e.jsxs("div",{className:"flex justify-end gap-3 mt-4",children:[e.jsx(p,{variant:"secondary",onClick:()=>d(!1),children:"Cancel"}),e.jsx(p,{onClick:()=>{m.trim()&&(y(m),h(""),d(!1))},children:"Create"})]})]})}),n.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center text-center py-12 px-4 bg-white  rounded-lg",children:[e.jsx("i",{className:"fas fa-couch text-5xl text-blue-400 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-600 mb-1",children:"No Furnitures Created"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Click the ",e.jsx("strong",{children:"+ furniture"}),"  to create the furnitures",e.jsx("br",{})]}),e.jsxs(p,{onClick:()=>d(!0),className:"bg-blue-600 text-white px-4 py-2 rounded mt-2 flex items-center",children:[e.jsx("i",{className:"fas fa-add !mr-2",children:" "}),"Furniture"]})]}),n.length>0&&e.jsx("section",{className:"shadow overflow-y-auto max-h-[86%]",children:n.map((t,a)=>e.jsx(G,{index:a,data:t,updateFurniture:s=>{const r=[...n];r[a]=s,f(r)},removeFurniture:()=>k(a)},a))}),n.length!==0&&e.jsx("div",{className:"mt-1 text-right",children:e.jsx(p,{variant:"primary",isLoading:C,onClick:T,className:"px-6 py-2 bg-blue-600 text-white rounded",children:"Save Quote"})})]})};export{L as default};
