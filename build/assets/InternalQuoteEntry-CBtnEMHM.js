import{f as w,h as I,s as q,b as M,i as b,a as P,k as _,j as e,B as S,t as j,u as R,r as D,M as L,O as $}from"./index-BAM0eJUz.js";import{u as A}from"./projectApi-D7-uwdh2.js";import{f as z,h as G}from"./quoteVariantApi-SI_JgpSl.js";import{C as K,a as U}from"./Card-CdxfjEr-.js";import{d as B,f as W}from"./dateFormator-BGKi5rfZ.js";import{u as F}from"./useDebounce-DSMcRuVp.js";import{Q as V,C as Y}from"./CreateQuoteModal-C4nTcKOM.js";import{S as H}from"./StageGuide-e28gQ0h1.js";const J=async({organizationId:t,projectId:a,mainQuoteName:s,quoteCategory:n,quoteType:r,api:l})=>{const{data:i}=await l.post("/quote/quotegenerate/createmainquote",{organizationId:t,projectId:a,mainQuoteName:s,quoteCategory:n,quoteType:r});if(!i.ok)throw new Error(i.message);return i.data},X=async({id:t,projectId:a,mainQuoteName:s,quoteCategory:n,quoteType:r,api:l})=>{const{data:i}=await l.put(`/quote/quotegenerate/updatemainquote/${t}`,{projectId:a,quoteType:r,mainQuoteName:s,quoteCategory:n});if(!i.ok)throw new Error(i.message);return i.data},Z=async({api:t,organizationId:a,id:s,projectId:n,formData:r})=>{const l=await t.put(`/quote/quotegenerate/editquote/${a}/${n}/${s}`,r);if(!l.data.ok)throw new Error(l.data.message||"Failed to create quote.");return l.data.data},ee=async({api:t,organizationId:a,id:s,formData:n})=>{console.log("slkdfkl","3873"+a+"sdljfls");const r=await t.put(`/quote/quotegenerate/sqftrate/update/${s}`,n);if(!r.data.ok)throw new Error(r.data.message||"Failed to create quote.");return r.data.data},te=async({api:t,id:a})=>{const s=await t.put(`/quote/quotegenerate/copyquote/${a}`);if(!s.data.ok)throw new Error(s.data.message||"Failed to create quote.");return s.data.data},ae=async({api:t,id:a})=>{const{data:s}=await t.get(`/quote/quotegenerate/getsinglequote/${a}`);if(!s.ok)throw new Error((s==null?void 0:s.message)||"Failed to fetch materials");return s.data},se=()=>{const{role:t}=w(),a=b(t),s=["owner","staff","CTO"];return I({mutationFn:async({organizationId:n,projectId:r,mainQuoteName:l,quoteCategory:i,quoteType:u})=>{if(!t||!s.includes(t))throw new Error("Unauthorized access");if(!a)throw new Error("API configuration missing");return await J({organizationId:n,quoteType:u,projectId:r,mainQuoteName:l,quoteCategory:i,api:a})},onSuccess:(n,{organizationId:r})=>{q.invalidateQueries({queryKey:["quote-material-items",r]})}})},ge=()=>{const{role:t}=w(),a=b(t),s=["owner","staff","CTO"];return I({mutationFn:async({organizationId:n,id:r,projectId:l,mainQuoteName:i,quoteType:u,quoteCategory:c})=>{if(console.log("organizationId","671763hdfhs"+n.slice(5)+"sld;kjsdl"),!t||!s.includes(t))throw new Error("Unauthorized access");if(!a)throw new Error("API configuration missing");return await X({id:r,projectId:l,mainQuoteName:i,quoteCategory:c,quoteType:u,api:a})},onSuccess:(n,r)=>{q.invalidateQueries({queryKey:["quote-material-items",r]})}})},ye=()=>{const t=["owner","staff","CTO"],{role:a}=w(),s=b(a);return I({mutationFn:async({organizationId:n,projectId:r,formData:l,id:i})=>{if(!a||!t.includes(a))throw new Error("Not allowed to create quotes");if(!s)throw new Error("API instance for role not found");return await Z({api:s,organizationId:n,projectId:r,formData:l,id:i})},onSuccess:(n,{organizationId:r})=>{q.invalidateQueries({queryKey:["quote-material-items",r]})}})},je=()=>{const t=["owner","staff","CTO"],{role:a}=w(),s=b(a);return I({mutationFn:async({organizationId:n,formData:r,id:l})=>{if(!a||!t.includes(a))throw new Error("Not allowed to create quotes");if(!s)throw new Error("API instance for role not found");return await ee({api:s,organizationId:n,formData:r,id:l})},onSuccess:(n,{organizationId:r})=>{q.invalidateQueries({queryKey:["quote-material-items",r]})}})},we=({organizationId:t,id:a})=>{const s=["owner","staff","CTO"],{role:n}=w(),r=b(n);return M({queryKey:["material-item",t,a],queryFn:async()=>{if(!n||!s.includes(n))throw new Error("Not allowed to create quotes");if(!r)throw new Error("API instance for role not found");return await ae({api:r,id:a})},enabled:!!t&&!!a})},re=()=>{const t=["owner","staff","CTO"],{role:a}=w(),s=b(a);return I({mutationFn:async({id:n})=>{if(!a||!t.includes(a))throw new Error("Not allowed to create quotes");if(!s)throw new Error("API instance for role not found");return await te({api:s,id:n})},onSuccess:(n,{organizationId:r})=>{q.invalidateQueries({queryKey:["quote-material-items",r]})}})},ne=({quote:t,organizationId:a})=>{var m,f,v,C,o,d,y,O;const s=P(),{mutateAsync:n,isPending:r}=z(),{mutateAsync:l,isPending:i}=re(),{role:u,permission:c}=_(),N=u==="owner"||((m=c==null?void 0:c.internalquote)==null?void 0:m.create),h=u==="owner"||((f=c==null?void 0:c.internalquote)==null?void 0:f.delete),x=u==="owner"||((v=c==null?void 0:c.internalquote)==null?void 0:v.edit),p=async T=>{var Q,E;try{await n({id:T,organizationId:a}),j({title:"Success",description:"Items deleted successfully"})}catch(g){j({title:"Error",description:((E=(Q=g==null?void 0:g.response)==null?void 0:Q.data)==null?void 0:E.message)??"Operation failed"})}},k=async T=>{var Q,E;try{await l({id:T,organizationId:a}),j({title:"Success",description:"Quote duplicated successfully"})}catch(g){j({title:"Error",description:((E=(Q=g==null?void 0:g.response)==null?void 0:Q.data)==null?void 0:E.message)??"Failed to copy quote",variant:"destructive"})}};return e.jsx(K,{className:"w-full border-l-4 border-blue-600 shadow-md bg-white hover:shadow-lg transition-all",children:e.jsxs(U,{className:"p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"my-1",children:[e.jsxs("h3",{className:"text-sm font-bold text-blue-700  ",children:["Quote Name: ",e.jsx("span",{className:"text-black",children:(t==null?void 0:t.mainQuoteName)||"Quote"})]}),e.jsxs("p",{className:"text-sm font-semibold text-blue-700  ",children:["Project: ",e.jsx("span",{className:"text-black",children:((C=t==null?void 0:t.projectId)==null?void 0:C.projectName)||"Project"})]}),e.jsxs("span",{className:"text-[12px] font-semibold text-gray-500",children:["Quote No: ",e.jsx("span",{className:"text-black",children:t.quoteNo||"N/A"})]})]}),e.jsxs("p",{className:"text-xs text-gray-500 ",children:["Created on: ",B(t.createdAt)," -  ",W(t.createdAt)]})]}),e.jsx("i",{className:"fas fa-file-alt text-gray-400 text-xl"})]}),((o=t==null?void 0:t.furnitures)==null?void 0:o.length)>0?e.jsxs("p",{className:"text-sm text-gray-500 italic",children:[e.jsx("strong",{children:"Furnitures: "})," ",((d=t.furnitures)==null?void 0:d.length)||0]}):((y=t==null?void 0:t.sqftRateWork)==null?void 0:y.length)>0?e.jsxs("p",{className:"text-sm text-gray-500 italic",children:[e.jsx("strong",{children:"Works: "})," ",((O=t==null?void 0:t.sqftRateWork)==null?void 0:O.length)||0]}):e.jsx("div",{className:"h-6"}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[(x||N)&&e.jsxs(S,{size:"sm",variant:"outline",className:" text-blue-700  border-blue-200",isLoading:i,onClick:()=>k(t._id),children:[e.jsx("i",{className:"fas fa-copy mr-1"})," Copy"]}),e.jsxs(S,{size:"sm",variant:"secondary",onClick:()=>{s(`single/${t._id}/${t==null?void 0:t.quoteType}`)},children:[e.jsx("i",{className:"fas fa-eye mr-1"})," View"]}),h&&e.jsxs(S,{size:"sm",isLoading:r,variant:"danger",className:"bg-red-600 text-white",onClick:()=>p(t._id),children:[e.jsx("i",{className:"fas fa-trash mr-1"})," Delete"]})]})]})})},oe=({})=>{var C;const{organizationId:t}=R(),[a,s]=D.useState({projectId:"",projectName:"",startDate:"",endDate:"",quoteType:"",search:""}),n=F(a.search,800),r=F(a.startDate,800),l=F(a.endDate,800),i=D.useMemo(()=>({projectId:a.projectId,startDate:r,endDate:l,quoteType:a.quoteType,search:n}),[a.projectId,a.startDate,a.endDate,n,l,r,a.quoteType]),{role:u,permission:c}=_(),N=u==="owner"||((C=c==null?void 0:c.internalquote)==null?void 0:C.list),{data:h}=A(t),x=h==null?void 0:h.map(o=>({_id:o._id,projectName:o.projectName})),{data:p,isLoading:k}=G(t,i),m=p==null?void 0:p.filter(o=>o.mainQuote===null),f=()=>{s({projectId:"",projectName:"",startDate:"",endDate:"",quoteType:"",search:""})},v=Object.values(a).filter(Boolean).length;return e.jsxs("main",{className:"flex gap-2 h-full !max-h-[92%] ",children:[e.jsx("div",{className:"xl:w-80 flex-shrink-0",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-filter mr-2 text-blue-600"}),"Filters"]}),v>0&&e.jsxs("button",{onClick:f,className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:["Clear All (",v,")"]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Search"}),e.jsx("input",{type:"text",placeholder:"Search Quote No, Quote Name",value:a.search,autoFocus:!0,onChange:o=>s(d=>({...d,search:o.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quote Type"}),e.jsxs("select",{value:a.quoteType||"",onChange:o=>s(d=>({...d,quoteType:o.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white",children:[e.jsx("option",{value:"",children:"All Type"}),V.map(o=>e.jsx("option",{value:o,children:o==="sqft_rate"?"Sqft Rate":o[0].toUpperCase()+o.slice(1)},o))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Project"}),e.jsx("select",{value:(a==null?void 0:a.projectId)||"",onChange:o=>{const d=x==null?void 0:x.find(y=>y._id===o.target.value);d&&s(y=>({...y,projectId:d._id,projectName:d.projectName}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:x==null?void 0:x.map(o=>e.jsx("option",{value:o._id,children:o.projectName},o._id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date Range"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500 mb-1 block",children:"From"}),e.jsx("input",{type:"date",value:a.startDate,onChange:o=>s(d=>({...d,startDate:o.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500 mb-1 block",children:"To"}),e.jsx("input",{type:"date",value:a.endDate,onChange:o=>s(d=>({...d,endDate:o.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm"})]})]})]})]})]})}),N&&e.jsx("section",{className:"w-full !max-h-full gap-2 overflow-y-auto h-full",children:k?e.jsx(L,{}):m!=null&&m.length?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:m==null?void 0:m.map(o=>e.jsx(e.Fragment,{children:e.jsx(ne,{quote:o,organizationId:t},o._id)}))}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center text-gray-700",children:[e.jsx("i",{className:"fas fa-file-circle-exclamation text-gray-300 text-7xl mb-4"}),e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"No Quotes Found"}),e.jsxs("p",{className:"text-base text-gray-500 leading-relaxed max-w-md",children:["You haven't generated any quote variants yet.",e.jsx("br",{}),"Please create a quote by clicking the + Product section to view brand-wise breakdowns here."]})]})})]})},le=t=>t.filter(a=>{var s,n;return!!((s=a.itemName)!=null&&s.trim())||!!((n=a.description)!=null&&n.trim())}),ie=()=>{var m;const t=P(),{organizationId:a}=R(),{data:s=[]}=A(a),n=se(),[r,l]=D.useState({mainQuoteName:"",quoteCategory:"residential",quoteType:"basic",projectId:""}),{role:i,permission:u}=_(),c=i==="owner"||((m=u==null?void 0:u.internalquote)==null?void 0:m.create),[N,h]=D.useState(!1),x=async()=>{if(!r.mainQuoteName||!r.projectId||!r.quoteType)return j({title:"Error",description:"Please fill all fields",variant:"destructive"});try{const f=await n.mutateAsync({organizationId:a,projectId:r.projectId,mainQuoteName:r.mainQuoteName,quoteType:r.quoteType,quoteCategory:r.quoteCategory});console.log("response",f),t(`single/${f._id}/${f.quoteType}`),h(!1),p()}catch(f){j({title:"Error",description:f.message,variant:"destructive"})}},p=()=>{l({mainQuoteName:"",quoteCategory:"",quoteType:"",projectId:""})};return location.pathname.includes("internalquotenew")||location.pathname.includes("single")?e.jsx($,{}):e.jsxs("div",{className:"h-full mx-auto max-h-full overflow-hidden",children:[e.jsxs("header",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 py-1 border-b-1 border-[#818283]",children:[e.jsx("div",{children:e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-file mr-3 text-blue-600"}),"Internal Quote Entry"]})}),e.jsxs("div",{className:"flex gap-6 items-center ",children:[c&&e.jsxs(S,{className:"flex items-center",onClick:()=>{h(!0)},children:[e.jsx("i",{className:"fas fa-add mr-1",children:" "})," Create"]}),e.jsx("div",{className:"w-full sm:w-auto flex justify-end sm:block",children:e.jsx(H,{organizationId:a,stageName:"materialquote"})})]})]}),N&&e.jsx(Y,{isEditing:!1,formData:r,projectsData:s,setModalOpen:h,setFormData:l,handleSubmit:x,isSubmitting:n.isPending}),e.jsx("section",{className:"my-2 h-[100%] ",children:e.jsx(oe,{})})]})},be=Object.freeze(Object.defineProperty({__proto__:null,default:ie,filterValidSimpleRows:le},Symbol.toStringTag,{value:"Module"}));export{be as I,we as a,ge as b,ye as c,le as f,je as u};
