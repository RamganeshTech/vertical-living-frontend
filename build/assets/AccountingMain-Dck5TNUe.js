import{j as e,u as Q,a as W,e as X,r as g,b as Y,O as Z}from"./index-BYTWf4fI.js";import{B as v}from"./Button-aRmNljle.js";import ee from"./MaterialOverviewLoading-DkmRHaSw.js";import{u as te}from"./projectApi-DD4NsQCs.js";import{u as se}from"./accountingApi-C4umEuGb.js";import{d as ae}from"./dateFormator-BGKi5rfZ.js";import{u as x}from"./useDebounce-D7ERai60.js";import{S as re}from"./index-BHsD5xzn.js";import{S as le}from"./StageGuide-CqeeYR2U.js";import"./Skeleton-Bc8D3KPj.js";import"./useQuery-DFVFWtWl.js";import"./useMutation-sTZCeqmg.js";import"./roleCheck-DhBlwT6t.js";import"./useInfiniteQuery-BdEWgiGc.js";import"./index-CofIYY6b.js";import"./toast-BSC5QTk1.js";const ne=({data:l,index:m,onView:p})=>{var n,i,c,d;const u=a=>{switch(a==null?void 0:a.toLowerCase()){case"paid":return"bg-green-100 text-green-700 border-green-200";case"pending":return"bg-orange-100 text-orange-700 border-orange-200";case"cancelled":return"bg-red-100 text-red-700 border-red-200";default:return"bg-gray-100 text-gray-600 border-gray-200"}},s=a=>{switch(a){case"Bill Acc":return"fa-file-invoice text-purple-500";case"Expense Acc":return"fa-receipt text-pink-500";case"Payment Acc":return"fa-money-check-alt text-green-500";default:return"fa-file-alt text-gray-400"}};return e.jsxs("div",{onClick:p,className:"grid grid-cols-14 gap-4 px-6 py-4 hover:bg-blue-50/30 transition-colors cursor-pointer items-center",children:[e.jsx("div",{className:"col-span-1 text-center text-gray-400 font-medium text-sm",children:m+1}),e.jsx("div",{className:"col-span-2",children:e.jsx("span",{className:"font-mono text-xs font-bold text-gray-700 bg-gray-100 px-2 py-1 rounded border border-gray-200",children:l.recordNumber||"N/A"})}),e.jsx("div",{className:"col-span-2",children:e.jsx("span",{className:"font-mono text-xs font-bold text-gray-700 bg-gray-100 px-2 py-1 rounded border border-gray-200",children:((n=l==null?void 0:l.sourceDetails)==null?void 0:n.deptNumber)||"N/A"})}),e.jsx("div",{className:"col-span-3",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold text-gray-900 truncate text-sm",title:(i=l.person)==null?void 0:i.name,children:((c=l.person)==null?void 0:c.name)||"Unknown Payee"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("i",{className:`fas ${s(l.type)} text-[10px]`}),e.jsx("span",{className:"text-[10px] text-gray-500 uppercase tracking-wide",children:l.type})]})]})}),e.jsx("div",{className:"col-span-2 text-sm text-gray-600",children:ae(l==null?void 0:l.sourceDetails.deptGeneratedDate)}),e.jsxs("div",{className:"col-span-2 font-bold text-gray-800 text-sm",children:["â‚¹",((d=l.amount)==null?void 0:d.toLocaleString("en-IN"))||"0.00"]}),e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-[10px] font-bold uppercase border ${u(l.status)}`,children:l.status||"Pending"})}),e.jsx("div",{className:"col-span-1 text-center",children:e.jsx("button",{className:"text-blue-600 hover:bg-blue-100 p-2 rounded-full transition-colors",children:e.jsx("i",{className:"fas fa-chevron-right text-xs"})})})]})},Ae=()=>{var L,P,E,F,M,R,B,_,T;const{organizationId:l}=Q(),m=W(),p=X(),u=g.useRef(null),[s,n]=g.useState({status:"",projectId:"",projectName:"",search:"",fromDept:"",startDate:"",endDate:"",minAmount:0,maxAmount:1e6}),{data:i}=te(l),c=i==null?void 0:i.map(t=>({_id:t._id,projectName:t.projectName})),{role:d,permission:a}=Y(),O=d==="owner"||((L=a==null?void 0:a.accounts)==null?void 0:L.list),$=d==="owner"||((P=a==null?void 0:a.billing)==null?void 0:P.create)||((E=a==null?void 0:a.billing)==null?void 0:E.list)||((F=a==null?void 0:a.billing)==null?void 0:F.delete)||((M=a==null?void 0:a.billing)==null?void 0:M.edit),z=d==="owner"||((R=a==null?void 0:a.payments)==null?void 0:R.create)||((B=a==null?void 0:a.payments)==null?void 0:B.list)||((_=a==null?void 0:a.payments)==null?void 0:_.delete)||((T=a==null?void 0:a.payments)==null?void 0:T.edit),G=["Retail Invoice","Invoice","Bill","Expense"],w=x(s.minAmount,800),A=x(s.maxAmount,800),D=x(s.search,800),k=x(s.startDate,800),S=x(s.endDate,800),V=g.useMemo(()=>({status:s.status,projectId:s.projectId,fromDept:s.fromDept,startDate:k,endDate:S,minAmount:w,maxAmount:A,search:D}),[s.status,s.projectId,s.fromDept,s.startDate,s.endDate,w,A,D,S,k]),{data:b,fetchNextPage:C,hasNextPage:h,isFetchingNextPage:f,isLoading:H,isError:q,error:j,refetch:U}=se(l,V);g.useEffect(()=>{const t=u.current;if(!t)return;const r=()=>{const{scrollTop:o,scrollHeight:y,clientHeight:K}=t;y-o-K<100&&h&&!f&&(console.log("ðŸ“œ Loading more accounting records..."),C())};return t.addEventListener("scroll",r),()=>t.removeEventListener("scroll",r)},[h,f,C]);const I=[s.status,s.projectId,s.fromDept,s.startDate,s.endDate].filter(Boolean).length+(s.minAmount>0||s.maxAmount<1e5?1:0),J=()=>{n({status:"",projectId:"",projectName:"",search:"",fromDept:"",startDate:"",endDate:"",minAmount:0,maxAmount:1e5})},N=(b==null?void 0:b.pages.flatMap(t=>t.data))||[];return p.pathname.includes("single")?e.jsx(Z,{}):e.jsxs("div",{className:"p-2 space-y-4 h-full",children:[e.jsxs("header",{className:"flex justify-between items-center pb-2",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-money-bill-wave mr-3 text-blue-600"}),"Accounting Department"]}),e.jsx("p",{className:"text-gray-600 mt-1 text-sm",children:"Manage your projectâ€™s financial transactions and accounting records"})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[z&&e.jsxs(v,{onClick:()=>m(`/organizations/${l}/projects/paymentmain`),children:[e.jsx("i",{className:"fas fa-money-check-alt mr-2 text-white"}),"Payments"]}),$&&e.jsxs(v,{variant:"secondary",onClick:()=>m(`/organizations/${l}/projects/billmain`),children:[e.jsx("i",{className:"fas fa-receipt mr-2 text-blue-600"}),"Billing"]}),e.jsx("div",{className:"w-full sm:w-auto flex justify-end sm:block",children:e.jsx(le,{organizationId:l,stageName:"accounts"})})]})]}),H?e.jsx(ee,{}):q?e.jsxs("div",{className:"max-w-xl mx-auto mt-4 p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2 text-xl",children:"âš ï¸ Error Occurred"}),e.jsx("p",{className:"text-red-500 mb-4 text-lg",children:(j==null?void 0:j.message)||"Failed to load data"}),e.jsx(v,{onClick:()=>U(),className:"bg-red-600 text-white px-4 py-2",children:"Retry"})]}):e.jsxs("main",{className:"flex gap-4 h-[calc(100%-90px)]",children:[e.jsx("div",{className:"xl:w-72 w-64 flex-shrink-0 overflow-y-auto custom-scrollbar",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-5 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-filter mr-2 text-blue-600"}),"Filters"]}),I>0&&e.jsx("button",{onClick:J,className:"text-sm text-blue-600 cursor-pointer hover:text-blue-800 font-medium",children:"Clear All"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Search"}),e.jsx("input",{type:"text",placeholder:"Search Record No, Name",value:s.search,autoFocus:!0,onChange:t=>n(r=>({...r,search:t.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sections"}),e.jsxs("select",{value:s.fromDept||"",onChange:t=>n(r=>({...r,fromDept:t.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white",children:[e.jsx("option",{value:"",children:"All Section"}),G.map(t=>e.jsx("option",{value:t,children:t}))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Project"}),e.jsxs("select",{value:(s==null?void 0:s.projectId)||"",onChange:t=>{const r=c==null?void 0:c.find(o=>o._id===t.target.value);n(r?o=>({...o,projectId:r._id,projectName:r.projectName}):o=>({...o,projectId:"",projectName:""}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white",children:[e.jsx("option",{value:"",children:"All Projects"}),c==null?void 0:c.map(t=>e.jsx("option",{value:t._id,children:t.projectName},t._id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date Range"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500 mb-1 block",children:"From"}),e.jsx("input",{type:"date",value:s.startDate,onChange:t=>n(r=>({...r,startDate:t.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500 mb-1 block",children:"To"}),e.jsx("input",{type:"date",value:s.endDate,onChange:t=>n(r=>({...r,endDate:t.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Amount Range"}),e.jsx("div",{className:"px-2 mb-3 pt-2",children:e.jsx(re,{range:!0,min:0,max:1e5,step:500,value:[Number(s.minAmount),Number(s.maxAmount)],onChange:t=>{const[r,o]=t;n(y=>({...y,minAmount:r,maxAmount:o}))},trackStyle:[{backgroundColor:"#3b82f6",height:6}],handleStyle:[{borderColor:"#3b82f6",backgroundColor:"#fff",boxShadow:"0 2px 6px rgba(59, 130, 246, 0.4)",width:18,height:18,marginTop:-6,opacity:1},{borderColor:"#3b82f6",backgroundColor:"#fff",boxShadow:"0 2px 6px rgba(59, 130, 246, 0.4)",width:18,height:18,marginTop:-6,opacity:1}],railStyle:{backgroundColor:"#e5e7eb",height:6}})}),e.jsxs("div",{className:"flex justify-between items-center gap-2 text-sm",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-xs text-gray-500 block mb-1",children:"Min"}),e.jsxs("div",{className:"bg-blue-50 px-2 py-1.5 rounded border border-blue-100 font-semibold text-blue-700 text-center text-xs",children:["â‚¹",Number(s.minAmount).toLocaleString("en-IN")]})]}),e.jsx("div",{className:"text-gray-300",children:"â€”"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-xs text-gray-500 block mb-1",children:"Max"}),e.jsxs("div",{className:"bg-blue-50 px-2 py-1.5 rounded border border-blue-100 font-semibold text-blue-700 text-center text-xs",children:["â‚¹",Number(s.maxAmount).toLocaleString("en-IN")]})]})]}),e.jsxs("div",{className:"flex gap-2 items-center mt-3",children:[e.jsx("input",{type:"number",value:s.minAmount,onChange:t=>n(r=>({...r,minAmount:+t.target.value})),placeholder:"Min",className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500",min:"0"}),e.jsx("input",{type:"number",value:s.maxAmount,onChange:t=>n(r=>({...r,maxAmount:+t.target.value})),placeholder:"Max",className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500",min:"0"})]})]})]})]})}),O&&e.jsxs(e.Fragment,{children:[" ",N.length===0?e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center bg-white rounded-xl border border-gray-200 text-center p-6",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-50 rounded-full flex items-center justify-center mb-4",children:e.jsx("i",{className:"fas fa-file-invoice-dollar text-3xl text-blue-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-1",children:"No Records Found"}),e.jsx("p",{className:"text-sm text-gray-500 max-w-md",children:I>0?"Try adjusting your filters or search query.":"Transactions from Bills, Expenses, and Payments will appear here automatically."})]}):e.jsxs("div",{ref:u,className:"flex-1 bg-white rounded-xl shadow-sm border border-gray-200 overflow-y-auto custom-scrollbar flex flex-col",children:[e.jsx("div",{className:"sticky top-0 z-10 bg-white border-b border-blue-200 shadow-sm",children:e.jsxs("div",{className:"grid grid-cols-14 gap-4 px-6 py-4 bg-gradient-to-r from-blue-50 to-indigo-50 font-semibold text-gray-700 text-sm uppercase tracking-wider",children:[e.jsx("div",{className:"col-span-1 text-center",children:"#"}),e.jsx("div",{className:"col-span-2",children:"Acc.Rec No"}),e.jsx("div",{className:"col-span-2",children:"Dept.Rec No"}),e.jsx("div",{className:"col-span-3",children:"Vendor/ Customer"}),e.jsx("div",{className:"col-span-2",children:"Date"}),e.jsx("div",{className:"col-span-2 ",children:"Amount"}),e.jsx("div",{className:"col-span-1",children:"Status"}),e.jsx("div",{className:"col-span-1 text-center",children:"Action"})]})}),e.jsx("div",{className:"divide-y divide-gray-100",children:N.map((t,r)=>e.jsx(ne,{data:t,index:r,onView:()=>m(`single/${t._id}`)},t._id))}),f&&e.jsx("div",{className:"flex justify-center py-6 bg-gray-50 border-t border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-2 text-blue-600",children:[e.jsx("i",{className:"fas fa-spinner fa-spin text-xl"}),e.jsx("span",{className:"text-sm font-medium",children:"Loading more records..."})]})}),!h&&N.length>0&&e.jsx("div",{className:"flex justify-center py-6 bg-gray-50 border-t border-gray-100",children:e.jsxs("p",{className:"text-gray-400 text-sm font-medium flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle mr-2"}),"All records loaded"]})})]})]})]})]})};export{Ae as default};
