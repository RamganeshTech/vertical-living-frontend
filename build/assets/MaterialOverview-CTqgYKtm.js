import{r as y,u as k,j as e,a as B,d as z,b as T,O as V}from"./index-CluF71pO.js";import{e as q,f as W,g as Y,h as H,i as J,j as K}from"./materialSelectionApi-O4qR2jUB.js";import{t as c}from"./toast-BSC5QTk1.js";import{B as j}from"./Button-HSHMZ35l.js";import{C as Q}from"./Card-DAuv-BhQ.js";import{A as X,S as Z}from"./AssignStaff-XMsVnvoX.js";import ee from"./MaterialOverviewLoading-Dyvdc7EB.js";import{R as te}from"./ResetStageButton-Cg1In3bV.js";import{S as se}from"./ShareDocumentWhatsapp-p81hpp10.js";import{d as ae}from"./downloadFile-zCVCGP_u.js";import{S as ie,a as le,b as re,c as oe,d as ne}from"./Select-BbcLzekn.js";import"./roleCheck-C6Z-poLV.js";import"./useQuery-BSXZQ8G2.js";import"./useBaseQuery-CtUSRv5w.js";import"./useMutation-Deoeq1CZ.js";import"./Input-DzM7f8mY.js";import"./getAllUsersApi-thQGgwfV.js";import"./Skeleton-BFphkLNL.js";import"./documentationApi-7FURTjOv.js";import"./requirementFormApi-BZFcqrOJ.js";const ce=({room:l,projectId:v,packageId:d,roomType:u})=>{var h;const g=k(),{mutateAsync:w,isPending:i}=q(),p=async o=>{var m,b;o.stopPropagation();try{if(!confirm("Are you sure you need to delete the room?"))return;if(!d){c({title:"Error",description:"Package is not selected",variant:"destructive"});return}await w({projectId:v,roomId:l._id,packageId:d}),c({title:"Success",description:"Room deleted successfully"})}catch(f){c({title:"Error",description:((b=(m=f==null?void 0:f.response)==null?void 0:m.data)==null?void 0:b.message)||"Failed to delete the room",variant:"destructive"})}},t=u==="customRoom"?l.items:l.roomFields;return e.jsxs("div",{onClick:()=>g(`materialroom/${l._id}/${u}/${d}`),className:"border-l-4 border-blue-600 cursor-pointer shadow-sm hover:shadow-md transition-all duration-200 rounded-lg p-4 bg-white flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:l.name}),e.jsxs("p",{className:"text-sm text-blue-500",children:["No of Fields: ",(h=Object.keys(t||{}))==null?void 0:h.length]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsx("button",{onClick:o=>{o.stopPropagation(),g(`materialroom/${l._id}/${u}/${d}`)},className:"text-sm text-blue-600 underline hover:no-underline cursor-pointer",children:"View →"}),e.jsxs(j,{variant:"danger",size:"sm",onClick:p,disabled:i,className:"flex items-center gap-1 px-2 py-1 text-sm hover:text-white",children:[e.jsx("i",{className:"fas fa-trash"})," Delete"]})]})]})},de=y.memo(ce),me=["economy","premium","luxury"];function ke(){var C,A,M,P,$,L,R;const{projectId:l,organizationId:v}=B(),{isMobile:d,openMobileSidebar:u}=z(),g=T(),w=k(),[i,p]=y.useState(null),{data:t,isLoading:h,error:o,refetch:m}=W(l),{mutateAsync:b,isPending:f}=Y(),{mutateAsync:F,isPending:U}=H(),{mutateAsync:_,isPending:S}=J(),{mutateAsync:O}=K();y.useEffect(()=>{var s,n;if(!i&&((s=t==null?void 0:t.package)!=null&&s.length)){const a=(n=t==null?void 0:t.package)==null?void 0:n.find(r=>(r==null?void 0:r.level)==="economy");a&&p({level:a.level,id:a._id})}},[t,i]);const N=(C=t==null?void 0:t.package)==null?void 0:C.find(s=>s._id===(i==null?void 0:i.id)),x=(N==null?void 0:N.rooms)||[],D=async s=>{var n,a;console.log("value",s);try{await O({projectId:l,selectedPacakge:s}),c({description:"Package updated successfully",title:"Success"})}catch(r){c({title:"Error",description:((a=(n=r==null?void 0:r.response)==null?void 0:n.data)==null?void 0:a.message)||r.message||"Failed to update Package level",variant:"destructive"})}};if(h)return e.jsx(ee,{});const E=g.pathname.includes("/materialroom"),G=async()=>{var s,n;try{await F({projectId:l}),c({description:"Completion status updated successfully",title:"Success"}),w("../costestimation")}catch(a){c({title:"Error",description:((n=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:n.message)||a.message||"Failed to update completion status",variant:"destructive"})}},I=async()=>{var s,n;try{const a=await _({projectId:l});ae({src:a==null?void 0:a.url,alt:"home-material-selection"}),c({title:"Success",description:"Pdf Generated successfully"}),m()}catch(a){c({title:"Error",description:((n=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:n.message)||(a==null?void 0:a.message)||"Failed to generate link",variant:"destructive"})}};return e.jsx("div",{className:"flex flex-col h-full w-full  py-2",children:E?e.jsx(V,{}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4 mb-4",children:[e.jsxs("h2",{className:"text-2xl sm:text-3xl font-semibold text-blue-600 flex items-center",children:[d&&e.jsx("button",{onClick:u,className:"mr-3 p-2 rounded-md border-gray-300 hover:bg-gray-100",title:"Open Menu",children:e.jsx("i",{className:"fa-solid fa-bars"})}),e.jsx("i",{className:"fas fa-box mr-2"})," Material Selection"]}),e.jsxs("div",{className:"!w-[100%] sm:!w-[100%] lg:!w-[50%] xl:!w-[65%]  flex flex-col sm:flex-row gap-3 justify-end",children:[e.jsx("div",{className:"flex flex-wrap  md:flex-nowrap gap-2 justify-end",children:e.jsxs(j,{isLoading:U,onClick:G,className:"bg-green-600 hover:bg-green-700 text-white flex-1 sm:flex-initial min-w-max",children:[e.jsx("i",{className:"fa-solid fa-circle-check mr-2"}),"Mark Complete"]})}),e.jsxs("div",{className:"flex flex-wrap md:flex-nowrap gap-2 justify-end",children:[e.jsx(te,{projectId:l,stageNumber:5,stagePath:"materialconfirmation",className:"flex-1 sm:flex-initial min-w-max"}),!o&&e.jsx(se,{projectId:l,stageNumber:"5",className:"w-full sm:w-fit",isStageCompleted:t==null?void 0:t.status}),e.jsx(X,{stageName:"MaterialRoomConfirmationModel",projectId:l,organizationId:v,currentAssignedStaff:(t==null?void 0:t.assignedTo)||null,className:"flex-1 sm:flex-initial min-w-max"})]})]})]}),o&&e.jsxs("div",{className:"max-w-xl mx-auto p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center mb-4",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2",children:"⚠️ Error Occurred"}),e.jsx("p",{className:"text-red-500 text-sm mb-4",children:((M=(A=o==null?void 0:o.response)==null?void 0:A.data)==null?void 0:M.message)||(o==null?void 0:o.message)||"Failed to load room data"}),e.jsx(j,{onClick:()=>m(),className:"bg-red-600 text-white px-4 py-2",children:"Retry"})]}),e.jsx("div",{className:"flex-grow min-h-0 flex flex-col",children:!o&&e.jsxs(e.Fragment,{children:[e.jsxs(Q,{className:"p-4 mb-4 w-full shadow border-l-4 border-blue-600 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-3 text-blue-700 text-sm font-medium mb-2",children:[e.jsx("i",{className:"fa-solid fa-clock text-blue-500 text-lg"}),e.jsx("span",{children:"Stage Timings"})]}),e.jsx(Z,{completedAt:(P=t==null?void 0:t.timer)==null?void 0:P.completedAt,stageName:"materialconfirmation",projectId:l,formId:t==null?void 0:t._id,deadLine:($=t==null?void 0:t.timer)==null?void 0:$.deadLine,startedAt:(L=t==null?void 0:t.timer)==null?void 0:L.startedAt,refetchStageMutate:m,deadLineMutate:b,isPending:f})]}),e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4 mb-6",children:[e.jsx("div",{className:"flex flex-wrap gap-3",children:(R=t==null?void 0:t.package)==null?void 0:R.map(s=>{const n=(i==null?void 0:i.id)===s._id,r={economy:{bgUnselected:"bg-green-100",textUnselected:"text-green-800",bgSelected:"bg-green-600",textSelected:"text-white",borderSelected:"border-green-700"},premium:{bgUnselected:"bg-amber-100",textUnselected:"text-amber-800",bgSelected:"bg-amber-500",textSelected:"text-white",borderSelected:"border-amber-600"},luxury:{bgUnselected:"bg-violet-100",textUnselected:"text-violet-800",bgSelected:"bg-violet-600",textSelected:"text-white",borderSelected:"border-violet-700"}}[s.level];return e.jsxs("div",{onClick:()=>p({level:s.level,id:s._id}),className:`
            min-w-[120px] px-5 py-3 rounded-md text-sm font-semibold text-center capitalize
            border-2 cursor-pointer select-none transition-all duration-200 shadow-sm
            ${n?`${r.bgSelected} ${r.textSelected} ${r.borderSelected} border`:`${r.bgUnselected} ${r.textUnselected} border-transparent hover:brightness-95`}
          `,children:[e.jsx("i",{className:"fa-solid fa-box-open mr-2"}),s.level]},s._id)})}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs(ie,{value:(t==null?void 0:t.packageSelected)||"economy",onValueChange:s=>D(s),children:[e.jsx(le,{className:"w-full border-2 border-gray-200 hover:border-slate-400 focus:border-slate-600 transition-colors",children:e.jsx(re,{placeholder:`${t==null?void 0:t.packageSelected}`})}),e.jsx(oe,{className:"max-h-48 overflow-y-auto custom-scrollbar",children:me.map(s=>e.jsx(ne,{value:s,children:s},s))})]}),e.jsxs(j,{isLoading:S,className:"bg-blue-600 hover:bg-blue-700 text-white px-5 py-2 rounded-md shadow-md transition",onClick:I,children:[e.jsx("i",{className:"fas fa-file-pdf mr-2"}),S?"Generating...":"Generate Comparison PDF"]})]})]}),e.jsxs("h1",{className:"text-lg text-gray-600 font-bold",children:["Rooms  ",i?`for ${(i==null?void 0:i.level[0].toUpperCase())+(i==null?void 0:i.level.slice(1))}`:""," "]}),e.jsxs("div",{className:"flex-grow min-h-[100%] py-2 sm:!min-h-0  overflow-y-auto",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:x==null?void 0:x.map(s=>e.jsx(de,{roomType:"predefinedRoom",packageId:(i==null?void 0:i.id)||null,room:s,projectId:l},s._id))}),(x==null?void 0:x.length)===0&&e.jsx("div",{className:"h-full flex items-center justify-center py-8",children:e.jsxs("div",{className:"text-center max-w-md mx-auto",children:[e.jsx("i",{className:"fas fa-door-open text-5xl sm:text-6xl text-blue-300 mb-4"}),e.jsx("h2",{className:"text-xl sm:text-2xl font-semibold text-gray-700 mb-2",children:"No Rooms Created Yet"}),e.jsx("p",{className:"text-gray-500",children:"Add rooms in client requirement stage and complete the stage"})]})})]})]})})]})})}export{ke as default};
