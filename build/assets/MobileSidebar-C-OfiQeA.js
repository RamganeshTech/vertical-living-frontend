import{r as x,R as Y,d as V,q as ge,X as k,j as e,a as T,u as S,e as he,K as Q,Y as X,W as z,_ as J,$ as Z,a0 as ee,a1 as se,a2 as te,a3 as ae}from"./index-BYTWf4fI.js";import{M as pe,b as je,C as $}from"./constants-4IFJeChr.js";import{b as ne}from"./CTOApi-CMNKof4Y.js";import{b as ie}from"./clientApi-DAoI0t8F.js";import{b as oe}from"./staffApi-B40r53N8.js";import{b as re}from"./userApi-BiOJoXsM.js";import{b as le}from"./workerApi-DXrGAGg8.js";import{B as W}from"./Button-aRmNljle.js";import{t as E}from"./toast-BSC5QTk1.js";import{u as be}from"./currentActiveStageApi-CZmDG3AW.js";import{c as Ne}from"./notificationApi-6vPrGvHl.js";import{f as we}from"./issueDiscussionApi-BT_wbjl4.js";function ye(r,s){x.useEffect(()=>{const a=t=>{t.ctrlKey&&t.key==="]"?(t.preventDefault(),s()):t.ctrlKey&&t.key==="["&&(t.preventDefault(),r())};window.addEventListener("keydown",a)},[s,r])}const D=Y.memo(({size:r="small"})=>{const{data:s,isLoading:a}=Ne(),t=V(),n=x.useCallback(()=>{console.log("calling ðŸ“Š Unread count updated:"),s!==void 0&&ge.invalidateQueries({queryKey:["notifications","unread-count"]})},[]);return x.useEffect(()=>{const i=t==null?void 0:t.id;if(i)return k.emit("join_notifications",{userId:i}),k.on("unread_count_update",n),()=>{k.off("unread_count_update",n)}},[t==null?void 0:t.id,n]),!a&&typeof s=="number"&&s>0?r==="large"?e.jsx("span",{className:"absolute -top-2 -right-4 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:s>99?"99+":s}):e.jsx("span",{className:"absolute -top-2 -right-4 bg-red-500 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center",children:s>9?"9+":s}):null});D.displayName="NotificationBadge";const F=({isExpanded:r=!1,isActive:s=!1})=>{const a=T(),{organizationId:t}=S(),n=()=>{a(`/${t}/notification`)};return r?e.jsxs("div",{onClick:n,className:`cursor-pointer w-full flex justify-between items-center max-w-[95%] py-4 px-4 ${s?"bg-[#3a3b45] rounded-xl text-white":"rounded-xl hover:bg-[#3a3b45]"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("i",{className:`fa-solid fa-bell text-lg ${s?"text-[#4a86f7]":"text-[#9ca3af]"}`}),e.jsx(D,{size:"large"})]}),e.jsx("span",{className:"text-lg",children:"Notifications"})]}),e.jsx("span",{children:e.jsx("i",{className:"fa-solid fa-chevron-right"})})]}):e.jsx("div",{onClick:n,className:`cursor-pointer flex justify-center items-center py-4 px-4 ${s?"bg-[#3a3b45] rounded-xl text-white":"rounded-xl hover:bg-[#3a3b45]"}`,children:e.jsxs("div",{className:"relative",children:[e.jsx("i",{className:`fa-solid fa-bell ${s?"text-[#4a86f7]":"text-[#9ca3af]"}`}),e.jsx(D,{size:"small"})]})})},G=Y.memo(({size:r="small",organizationId:s})=>{const{data:a,isLoading:t}=we({organizationId:s}),n=V(),[c,i]=x.useState(0);return x.useEffect(()=>{typeof a=="number"&&i(a)},[a]),x.useEffect(()=>{if(!(n==null?void 0:n.id)||!k||!s)return;const g=m=>{console.log("ðŸ”” unread_ticket_count_update:",m.count),i(m.count)};return k.on("unread_ticket_count_update",g),()=>{k.off("unread_ticket_count_update",g)}},[]),!t&&typeof c=="number"&&c>0?r==="large"?e.jsx("span",{className:"absolute -top-2 -right-4 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:c>99?"99+":c}):e.jsx("span",{className:"absolute -top-2 -right-4 bg-red-500 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center",children:c>9?"9+":c}):null});G.displayName="TicketOperationBadge";const H=({isExpanded:r=!1,isActive:s=!1})=>{const a=T(),{organizationId:t}=S(),n=()=>{a(`/${t}/ticket`)};return r?e.jsxs("div",{onClick:n,className:`cursor-pointer flex w-full justify-between items-center max-w-[95%] py-4 px-4 ${s?"bg-[#3a3b45] rounded-xl text-white":"rounded-xl hover:bg-[#3a3b45]"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("i",{className:`fa-solid fa-ticket text-lg ${s?"text-[#4a86f7]":"text-[#9ca3af]"}`}),e.jsx(G,{organizationId:t,size:"large"})]}),e.jsx("span",{className:"text-lg",children:"Tickets"})]}),e.jsx("span",{children:e.jsx("i",{className:"fa-solid fa-chevron-right"})})]}):e.jsx("div",{onClick:n,className:`cursor-pointer flex justify-center items-center py-4 px-4 ${s?"bg-[#3a3b45] rounded-xl text-white":"rounded-xl hover:bg-[#3a3b45]"}`,children:e.jsxs("div",{className:"relative",children:[e.jsx("i",{className:`fa-solid fa-ticket ${s?"text-[#4a86f7]":"text-[#9ca3af]"}`}),e.jsx(G,{size:"small",organizationId:t})]})})},ve=({labels:r,icons:s,path:a,setProjectName:t,projectName:n})=>{const[c,i]=x.useState(!1),{projectId:p}=S(),v=T(),g=he(),m=g.pathname.split("/"),{organizationId:A}=S(),j=Q(),{role:f}=X(o=>o.authStore),[d,N]=x.useState(""),{data:b,isLoading:P}=be(p),{mutateAsync:B,isPending:C}=ne(),{mutateAsync:_,isPending:L}=ie(),{mutateAsync:I,isPending:u}=oe(),{mutateAsync:w,isPending:h}=re(),{mutateAsync:ce,isPending:M}=le();x.useEffect(()=>{t&&b&&b.projectName&&!P&&t((b==null?void 0:b.projectName)||"Project")},[b,P]);const de=()=>{i(!1)},fe=()=>{i(!0)},ue=m[2]==="projectdetails";x.useEffect(()=>{const l=g.pathname.split("/")[4];N(c?()=>pe[l]:()=>je[l])},[g.pathname,c]),ye(fe,de);const K=m[2]==="projectdetails",xe=m[1]==="login",me=()=>{K&&v(`/organizations/${A}/projects`),xe&&v("/organizations")},U=f&&["owner","CTO","staff"].includes(f),R=f&&["owner","CTO","staff"].includes(f)&&A,q=async()=>{var o,l;try{f==="CTO"?await B():f==="client"?await _():f==="staff"?await I():f==="owner"?await w():f==="worker"&&await ce(),j(J()),j(Z()),j(ee()),j(se()),j(te()),j(ae()),E({title:"Success",description:"logout successfull"}),(!C||!L||!u||!h||!M)&&v("/")}catch(y){E({title:"Error",description:((l=(o=y==null?void 0:y.response)==null?void 0:o.data)==null?void 0:l.message)||"Failed to logout",variant:"destructive"})}};return e.jsx(e.Fragment,{children:c?e.jsxs("aside",{onMouseLeave:()=>i(!1),className:"relative flex flex-col bg-[#2f303a] w-[17%] min-h-screen max-h-screen text-[#9ca3af] select-none transition-all duration-300",children:[e.jsxs("div",{className:"flex flex-col flex-grow overflow-y-auto overflow-x-hidden custom-scrollbar p-2 large-scrollbar",children:[e.jsxs("div",{onClick:me,className:`flex ${K?"cursor-pointer":""} justify-between items-center border-b-1 py-2`,children:[e.jsx("span",{className:"text-xl",children:ue?n||"Project":$.COMPANY_NAME}),e.jsx("div",{className:"w-[30px] h-[30px]",children:e.jsx("img",{className:"w-full h-full",src:$.COMPANY_LOGO,alt:"LOGO"})})]}),e.jsxs("section",{className:"py-2 space-y-2",children:[" ",Object.entries(r).map(([o,l])=>{const y=d===l;return a[o]&&e.jsx(z,{to:a[o],className:"outline-none",children:e.jsxs("div",{onClick:()=>N(l),className:`cursor-pointer flex justify-between max-w-[95%] py-4 px-4 ${d===l?"bg-[#3a3b45] rounded-xl text-white":"rounded-xl hover:bg-[#3a3b45]"} `,ref:O=>{y&&O&&O.scrollIntoView({behavior:"smooth",block:"center"})},children:[e.jsx("span",{className:"text-lg",children:l}),e.jsx("span",{children:e.jsx("i",{className:"fa-solid fa-chevron-right"})})]})},l)})]})]}),e.jsxs("div",{className:"flex flex-col p-2 border-t border-[#3a3b45]",children:[m[1]!=="login"&&e.jsxs(W,{isLoading:C||L||u||h||M,onClick:q,className:"flex items-center gap-2 px-4 py-3 rounded-lg !bg-[#3a3b45] !text-[#9ca3af] hover:!bg-[#464751] hover:!text-white transition",children:[e.jsx("i",{className:"fa-solid fa-right-from-bracket"}),e.jsx("span",{children:"Logout"})]}),e.jsxs("div",{className:"mt-2 flex gap-2 w-full",children:[U&&e.jsx(F,{isExpanded:!1,isActive:!1}),R&&e.jsx(H,{isExpanded:!1,isActive:!1})]})]})]}):e.jsxs("aside",{onMouseEnter:()=>i(!0),className:"flex flex-col relative justify-between bg-[#2f303a] w-[6%]  max-h-full  text-[#9ca3af] transition-all duration-300 ",children:[e.jsx("div",{className:"max-h-[95%] overflow-y-auto overflow-x-hidden custom-scrollbar ",children:e.jsx("div",{className:"flex items-center flex-col justify-between w-full",children:Object.entries(s).map(([o,l])=>{const y=(d==null?void 0:d.toLowerCase())===o.toLowerCase();return a[o]?e.jsx(z,{to:a[o],className:`${a[o]?"":"cursor-not-allowed"}`,children:e.jsx("div",{onClick:()=>N(o),className:`cursor-pointer flex justify-between max-w-[95%] py-4 px-4 ${(d==null?void 0:d.toLowerCase())===o.toLowerCase()?"bg-[#3a3b45] rounded-xl text-white":"rounded-xl hover:bg-[#3a3b45]"} `,ref:O=>{y&&O&&O.scrollIntoView({behavior:"smooth",block:"center"})},children:e.jsx("i",{className:`${l} ${(d==null?void 0:d.toLowerCase())===o.toLowerCase()?"text-[#4a86f7]":"text-[#9ca3af]"} `})})},o):e.jsx("div",{className:"cursor-not-allowed flex justify-between max-w-[95%] py-4 px-4",children:e.jsx("i",{className:`${l}`})})})})}),e.jsxs("div",{className:"flex flex-col items-center p-2 border-t border-[#3a3b45]",children:[m[1]!=="login"&&e.jsx(W,{isLoading:C||L||u||h||M,title:"logout",onClick:q,className:"w-[40px] h-[40px] flex items-center justify-center !bg-[#3a3b45] !text-[#9ca3af] hover:!text-red-500 transition",children:e.jsx("i",{className:"fa-solid fa-right-from-bracket"})}),e.jsxs("div",{className:"",children:[U&&e.jsx(F,{isExpanded:!1,isActive:!1}),R&&e.jsx(H,{isExpanded:!1,isActive:!1})]})]})]})})},Ie=x.memo(ve),Me=({isOpen:r,onClose:s,labels:a,path:t})=>{const n=T(),{organizationId:c}=S(),i=Q(),{role:p}=X(u=>u.authStore),{mutateAsync:v,isPending:g}=ne(),{mutateAsync:m,isPending:A}=ie(),{mutateAsync:j,isPending:f}=oe(),{mutateAsync:d,isPending:N}=re(),{mutateAsync:b,isPending:P}=le(),B=async()=>{var u,w;try{p==="CTO"?await v():p==="client"?await m():p==="staff"?await j():p==="owner"?await d():p==="worker"&&await b(),i(J()),i(Z()),i(ee()),i(se()),i(te()),i(ae()),E({title:"Success",description:"logout successfull"}),(!g||!A||!f||!N||!P)&&n("/")}catch(h){E({title:"Error",description:((w=(u=h==null?void 0:h.response)==null?void 0:u.data)==null?void 0:w.message)||"Failed to logout",variant:"destructive"})}};let C=Object.entries(a);const _=location.pathname.split("/"),L=_[2]==="projectdetails",I=()=>{L&&n(`/organizations/${c}/projects`)};return e.jsxs(e.Fragment,{children:[r&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40",onClick:s}),e.jsxs("aside",{className:`fixed top-0 left-0 z-50 h-screen bg-white w-[75%] flex flex-col transition-transform duration-300 ${r?"translate-x-0":"-translate-x-full"}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsxs("div",{onClick:I,className:`flex items-center gap-3 ${L?"cursor-pointer":""}`,children:[e.jsx("img",{src:$.COMPANY_LOGO,alt:"Logo",className:"w-10 h-10 rounded-full object-cover"}),e.jsx("span",{className:"text-lg font-semibold",children:$.COMPANY_NAME})]}),e.jsx("button",{onClick:s,className:"text-xl text-gray-700",children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsx("nav",{className:"flex flex-col flex-grow overflow-y-auto p-4",children:C.map(([u,w],h)=>e.jsxs(Y.Fragment,{children:[t[u]?e.jsx(z,{to:t[u],onClick:s,className:"text-gray-800 hover:bg-gray-100 p-3 rounded block",children:w}):e.jsx("span",{className:"text-gray-400 p-3 rounded cursor-not-allowed block",children:w}),h<C.length-1&&e.jsx("hr",{className:"border-t border-gray-200 my-1"})]},u))}),e.jsx("div",{className:"border-t border-gray-200 p-4",children:_[1]!=="login"&&e.jsxs(W,{className:"w-full flex items-center justify-center gap-2",isLoading:g||A||f||N||P,onClick:B,children:[e.jsx("i",{className:"fas fa-sign-out-alt"})," Logout"]})})]})]})};export{Me as M,Ie as S};
