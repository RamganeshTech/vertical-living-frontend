import{c as p,d as C,q as Q,k as T,g as y,b as P,a as q,j as e,B as E,t as g,u as R,r as k,l as M,M as L,O as D}from"./index-CUvv9ev0.js";import{e as $,f as z}from"./quoteVariantApi-DXhk0qe8.js";import{C as G,a as K}from"./Card-CHHq377-.js";import{d as B,f as W}from"./dateFormator-BGKi5rfZ.js";import{S as U}from"./StageGuide-n_FMHWm4.js";import{C as V}from"./CreateQuoteModal-NZC6xFae.js";const Y=async({organizationId:t,projectId:a,mainQuoteName:r,quoteCategory:n,quoteType:s,api:o})=>{const{data:i}=await o.post("/quote/quotegenerate/createmainquote",{organizationId:t,projectId:a,mainQuoteName:r,quoteCategory:n,quoteType:s});if(!i.ok)throw new Error(i.message);return i.data},H=async({id:t,projectId:a,mainQuoteName:r,quoteCategory:n,quoteType:s,api:o})=>{const{data:i}=await o.put(`/quote/quotegenerate/updatemainquote/${t}`,{projectId:a,quoteType:s,mainQuoteName:r,quoteCategory:n});if(!i.ok)throw new Error(i.message);return i.data},J=async({api:t,organizationId:a,id:r,projectId:n,formData:s})=>{const o=await t.put(`/quote/quotegenerate/editquote/${a}/${n}/${r}`,s);if(!o.data.ok)throw new Error(o.data.message||"Failed to create quote.");return o.data.data},X=async({api:t,organizationId:a,id:r,formData:n})=>{console.log("slkdfkl","3873"+a+"sdljfls");const s=await t.put(`/quote/quotegenerate/sqftrate/update/${r}`,n);if(!s.data.ok)throw new Error(s.data.message||"Failed to create quote.");return s.data.data},Z=async({api:t,id:a})=>{const r=await t.put(`/quote/quotegenerate/copyquote/${a}`);if(!r.data.ok)throw new Error(r.data.message||"Failed to create quote.");return r.data.data},ee=async({api:t,id:a})=>{const{data:r}=await t.get(`/quote/quotegenerate/getsinglequote/${a}`);if(!r.ok)throw new Error((r==null?void 0:r.message)||"Failed to fetch materials");return r.data},te=()=>{const{role:t}=p(),a=y(t),r=["owner","staff","CTO"];return C({mutationFn:async({organizationId:n,projectId:s,mainQuoteName:o,quoteCategory:i,quoteType:c})=>{if(!t||!r.includes(t))throw new Error("Unauthorized access");if(!a)throw new Error("API configuration missing");return await Y({organizationId:n,quoteType:c,projectId:s,mainQuoteName:o,quoteCategory:i,api:a})},onSuccess:(n,{organizationId:s})=>{Q.invalidateQueries({queryKey:["quote-material-items",s]})}})},fe=()=>{const{role:t}=p(),a=y(t),r=["owner","staff","CTO"];return C({mutationFn:async({organizationId:n,id:s,projectId:o,mainQuoteName:i,quoteType:c,quoteCategory:d})=>{if(console.log("organizationId","671763hdfhs"+n.slice(5)+"sld;kjsdl"),!t||!r.includes(t))throw new Error("Unauthorized access");if(!a)throw new Error("API configuration missing");return await H({id:s,projectId:o,mainQuoteName:i,quoteCategory:d,quoteType:c,api:a})},onSuccess:(n,s)=>{Q.invalidateQueries({queryKey:["quote-material-items",s]})}})},xe=()=>{const t=["owner","staff","CTO"],{role:a}=p(),r=y(a);return C({mutationFn:async({organizationId:n,projectId:s,formData:o,id:i})=>{if(!a||!t.includes(a))throw new Error("Not allowed to create quotes");if(!r)throw new Error("API instance for role not found");return await J({api:r,organizationId:n,projectId:s,formData:o,id:i})},onSuccess:(n,{organizationId:s})=>{Q.invalidateQueries({queryKey:["quote-material-items",s]})}})},he=()=>{const t=["owner","staff","CTO"],{role:a}=p(),r=y(a);return C({mutationFn:async({organizationId:n,formData:s,id:o})=>{if(!a||!t.includes(a))throw new Error("Not allowed to create quotes");if(!r)throw new Error("API instance for role not found");return await X({api:r,organizationId:n,formData:s,id:o})},onSuccess:(n,{organizationId:s})=>{Q.invalidateQueries({queryKey:["quote-material-items",s]})}})},ge=({organizationId:t,id:a})=>{const r=["owner","staff","CTO"],{role:n}=p(),s=y(n);return T({queryKey:["material-item",t,a],queryFn:async()=>{if(!n||!r.includes(n))throw new Error("Not allowed to create quotes");if(!s)throw new Error("API instance for role not found");return await ee({api:s,id:a})},enabled:!!t&&!!a})},ae=()=>{const t=["owner","staff","CTO"],{role:a}=p(),r=y(a);return C({mutationFn:async({id:n})=>{if(!a||!t.includes(a))throw new Error("Not allowed to create quotes");if(!r)throw new Error("API instance for role not found");return await Z({api:r,id:n})},onSuccess:(n,{organizationId:s})=>{Q.invalidateQueries({queryKey:["quote-material-items",s]})}})},se=({quote:t,organizationId:a})=>{var l,u,h,A,S,F,_,O;const r=P(),{mutateAsync:n,isPending:s}=$(),{mutateAsync:o,isPending:i}=ae(),{role:c,permission:d}=q(),j=c==="owner"||((l=d==null?void 0:d.internalquote)==null?void 0:l.create),m=c==="owner"||((u=d==null?void 0:d.internalquote)==null?void 0:u.delete),w=c==="owner"||((h=d==null?void 0:d.internalquote)==null?void 0:h.edit),x=async I=>{var b,v;try{await n({id:I,organizationId:a}),g({title:"Success",description:"Items deleted successfully"})}catch(f){g({title:"Error",description:((v=(b=f==null?void 0:f.response)==null?void 0:b.data)==null?void 0:v.message)??"Operation failed"})}},N=async I=>{var b,v;try{await o({id:I,organizationId:a}),g({title:"Success",description:"Quote duplicated successfully"})}catch(f){g({title:"Error",description:((v=(b=f==null?void 0:f.response)==null?void 0:b.data)==null?void 0:v.message)??"Failed to copy quote",variant:"destructive"})}};return e.jsx(G,{className:"w-full border-l-4 border-blue-600 shadow-md bg-white hover:shadow-lg transition-all",children:e.jsxs(K,{className:"p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"my-1",children:[e.jsxs("h3",{className:"text-sm font-bold text-blue-700  ",children:["Quote Name: ",e.jsx("span",{className:"text-black",children:(t==null?void 0:t.mainQuoteName)||"Quote"})]}),e.jsxs("p",{className:"text-sm font-semibold text-blue-700  ",children:["Project: ",e.jsx("span",{className:"text-black",children:((A=t==null?void 0:t.projectId)==null?void 0:A.projectName)||"Project"})]}),e.jsxs("span",{className:"text-[12px] font-semibold text-gray-500",children:["Quote No: ",e.jsx("span",{className:"text-black",children:t.quoteNo||"N/A"})]})]}),e.jsxs("p",{className:"text-xs text-gray-500 ",children:["Created on: ",B(t.createdAt)," -  ",W(t.createdAt)]})]}),e.jsx("i",{className:"fas fa-file-alt text-gray-400 text-xl"})]}),((S=t==null?void 0:t.furnitures)==null?void 0:S.length)>0?e.jsxs("p",{className:"text-sm text-gray-500 italic",children:[e.jsx("strong",{children:"Furnitures: "})," ",((F=t.furnitures)==null?void 0:F.length)||0]}):((_=t==null?void 0:t.sqftRateWork)==null?void 0:_.length)>0?e.jsxs("p",{className:"text-sm text-gray-500 italic",children:[e.jsx("strong",{children:"Works: "})," ",((O=t==null?void 0:t.sqftRateWork)==null?void 0:O.length)||0]}):e.jsx("div",{className:"h-6"}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[(w||j)&&e.jsxs(E,{size:"sm",variant:"outline",className:" text-blue-700  border-blue-200",isLoading:i,onClick:()=>N(t._id),children:[e.jsx("i",{className:"fas fa-copy mr-1"})," Copy"]}),e.jsxs(E,{size:"sm",variant:"secondary",onClick:()=>{r(`single/${t._id}/${t==null?void 0:t.quoteType}`)},children:[e.jsx("i",{className:"fas fa-eye mr-1"})," View"]}),m&&e.jsxs(E,{size:"sm",isLoading:s,variant:"danger",className:"bg-red-600 text-white",onClick:()=>x(t._id),children:[e.jsx("i",{className:"fas fa-trash mr-1"})," Delete"]})]})]})})},re=({})=>{var N;const{organizationId:t}=R(),[a,r]=k.useState({projectId:"",projectName:"",createdAt:""}),{role:n,permission:s}=q(),o=n==="owner"||((N=s==null?void 0:s.internalquote)==null?void 0:N.list),{data:i}=M(t),c=i==null?void 0:i.map(l=>({_id:l._id,projectName:l.projectName})),{data:d,isLoading:j}=z(t,{createdAt:a.createdAt,projectId:a.projectId,quoteNo:""}),m=d==null?void 0:d.filter(l=>l.mainQuote===null),w=()=>{r({projectId:"",projectName:"",createdAt:""})},x=Object.values(a).filter(Boolean).length;return e.jsxs("main",{className:"flex gap-2 h-full !max-h-[92%] ",children:[e.jsx("div",{className:"xl:w-80 flex-shrink-0",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-filter mr-2 text-blue-600"}),"Filters"]}),x>0&&e.jsxs("button",{onClick:w,className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:["Clear All (",x,")"]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Created Date"}),e.jsx("input",{type:"date",onChange:l=>r(u=>({...u,createdAt:l.target.value})),value:a.createdAt,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Project"}),e.jsx("select",{value:(a==null?void 0:a.projectId)||"",onChange:l=>{const u=c==null?void 0:c.find(h=>h._id===l.target.value);u&&r(h=>({...h,projectId:u._id,projectName:u.projectName}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:c==null?void 0:c.map(l=>e.jsx("option",{value:l._id,children:l.projectName},l._id))})]})]})]})}),o&&e.jsx("section",{className:"w-full !max-h-full gap-2 overflow-y-auto h-full",children:j?e.jsx(L,{}):m!=null&&m.length?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:m==null?void 0:m.map(l=>e.jsx(e.Fragment,{children:e.jsx(se,{quote:l,organizationId:t},l._id)}))}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center text-gray-700",children:[e.jsx("i",{className:"fas fa-file-circle-exclamation text-gray-300 text-7xl mb-4"}),e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"No Quotes Found"}),e.jsxs("p",{className:"text-base text-gray-500 leading-relaxed max-w-md",children:["You haven't generated any quote variants yet.",e.jsx("br",{}),"Please create a quote by clicking the + Product section to view brand-wise breakdowns here."]})]})})]})},ne=t=>t.filter(a=>{var r,n;return!!((r=a.itemName)!=null&&r.trim())||!!((n=a.description)!=null&&n.trim())}),oe=()=>{var l;const t=P(),{organizationId:a}=R(),{data:r=[]}=M(a),n=te(),[s,o]=k.useState({mainQuoteName:"",quoteCategory:"residential",quoteType:"basic",projectId:""}),{role:i,permission:c}=q(),d=i==="owner"||((l=c==null?void 0:c.internalquote)==null?void 0:l.create),[j,m]=k.useState(!1),w=async()=>{if(!s.mainQuoteName||!s.projectId||!s.quoteType)return g({title:"Error",description:"Please fill all fields",variant:"destructive"});try{const u=await n.mutateAsync({organizationId:a,projectId:s.projectId,mainQuoteName:s.mainQuoteName,quoteType:s.quoteType,quoteCategory:s.quoteCategory});console.log("response",u),t(`single/${u._id}/${u.quoteType}`),m(!1),x()}catch(u){g({title:"Error",description:u.message,variant:"destructive"})}},x=()=>{o({mainQuoteName:"",quoteCategory:"",quoteType:"",projectId:""})};return location.pathname.includes("internalquotenew")||location.pathname.includes("single")?e.jsx(D,{}):e.jsxs("div",{className:"h-full mx-auto max-h-full overflow-hidden",children:[e.jsxs("header",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 py-1 border-b-1 border-[#818283]",children:[e.jsx("div",{children:e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-file mr-3 text-blue-600"}),"Internal Quote Entry"]})}),e.jsxs("div",{className:"flex gap-6 items-center ",children:[d&&e.jsxs(E,{className:"flex items-center",onClick:()=>{m(!0)},children:[e.jsx("i",{className:"fas fa-add mr-1",children:" "})," Create"]}),e.jsx("div",{className:"w-full sm:w-auto flex justify-end sm:block",children:e.jsx(U,{organizationId:a,stageName:"materialquote"})})]})]}),j&&e.jsx(V,{isEditing:!1,formData:s,projectsData:r,setModalOpen:m,setFormData:o,handleSubmit:w}),e.jsx("section",{className:"my-2 h-[100%] ",children:e.jsx(re,{})})]})},pe=Object.freeze(Object.defineProperty({__proto__:null,default:oe,filterValidSimpleRows:ne},Symbol.toStringTag,{value:"Module"}));export{pe as I,ge as a,fe as b,xe as c,ne as f,he as u};
