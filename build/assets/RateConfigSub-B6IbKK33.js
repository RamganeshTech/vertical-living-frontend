import{c as $,d as H,e as V,r as J,j as e,B as h,A as M,t as f}from"./index-CBsAK0nv.js";import{u as Q,c as T,d as U,e as W}from"./rateConfigApi-CFJ5s_2m.js";function ee(){var w,k,R;const{organizationId:j,id:m}=$(),S=H(),{role:y,permission:n}=V(),v=y==="owner"||((w=n==null?void 0:n.materialquote)==null?void 0:w.create),A=y==="owner"||((k=n==null?void 0:n.materialquote)==null?void 0:k.delete),N=y==="owner"||((R=n==null?void 0:n.materialquote)==null?void 0:R.edit),{data:x}=Q(j),{data:b,isLoading:L,refetch:F}=T(m),{mutateAsync:P,isPending:z}=U(),{mutateAsync:O,isPending:q}=W(),[d,g]=J.useState([{data:{}}]);if(L||!x)return e.jsx("p",{children:"Loading category..."});const o=x==null?void 0:x.find(t=>t._id===m);if(!o)return e.jsx("p",{children:"Category not found"});const B=(t,r,a)=>{var C,I;const s=[...d];s[t].data[r]=a;const c=(I=(C=o.fields)==null?void 0:C[0])==null?void 0:I.key,u=t===s.length-1,i=r===c,l=(a==null?void 0:a.toString().trim())!=="",K=s.length>0&&Object.values(s[s.length-1].data).every(p=>p===void 0||p==="");if(u&&i&&l&&!K&&s.push({data:{}}),!l&&i&&d.length>1){const p=s[s.length-1];Object.values(p.data).every(E=>E===void 0||E==="")&&s.pop()}g(s)},D=()=>g([...d,{data:{}}]),_=t=>{const r=[...d];r.splice(t,1),g(r)},G=async()=>{var t,r,a,s;try{const c=(r=(t=o.fields)==null?void 0:t[0])==null?void 0:r.key,u=d.map(i=>i.data).filter(i=>{const l=i[c];return l!=null&&l.toString().trim()!==""});if(u.length===0)return f({title:"Error",description:"Nothing to save",variant:"destructive"});await P({categoryId:m,items:u,organizationId:j}),f({title:"Success",description:"Items created successfully"}),g([{data:{}}]),F()}catch(c){f({title:"Error",description:((s=(a=c==null?void 0:c.response)==null?void 0:a.data)==null?void 0:s.message)??"Operation failed"})}};return e.jsxs("div",{className:"space-y-4 max-h-full overflow-y-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center sticky top-0 bg-white z-10 py-4 border-b",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("div",{onClick:()=>S(-1),className:"bg-slate-50 hover:bg-slate-300 flex items-center justify-between w-8 h-8 border border-[#a6aab8] text-sm cursor-pointer rounded-md px-2 ",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:o.name})]}),e.jsxs("div",{className:"flex gap-2 mt-3 sm:mt-0",children:[(N||v)&&e.jsx(h,{onClick:D,variant:"primary",className:"",children:"+ Add Row"}),(N||v)&&e.jsxs(h,{onClick:G,isLoading:z,className:"bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx("i",{className:"fas fa-file mr-2"})," Save Items"]})]})]}),e.jsx("div",{className:"overflow-x-auto ",children:e.jsxs("table",{className:"min-w-full bg-white text-sm",children:[e.jsx("thead",{className:"bg-blue-50 text-sm font-semibold text-gray-600 px-6 py-1 sm:py-3",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-6 py-1 sm:py-3  text-xs font-medium text-gray-500 uppercase tracking-wider",children:"S.NO"}),o.fields.map(t=>e.jsx("th",{className:"text-center px-6 py-1 sm:py-3  text-xs font-medium text-gray-500 uppercase tracking-wider",children:t.key},t.key)),e.jsx("th",{className:"text-center px-6 py-1 sm:py-3  text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsxs("tbody",{children:[b==null?void 0:b.map((t,r)=>{var a;return e.jsxs("tr",{className:`group relative border-none !border-b-1 px-4 py-2  cursor-pointer transition-all duration-200
     hover:bg-gray-50 hover:border-gray-300
  `,children:[e.jsx("td",{className:"border border-gray-100 p-4 font-medium text-center  text-sm text-gray-700 group-hover:text-gray-900 transition-colors duration-200",children:r+1||"—"}),(a=o==null?void 0:o.fields)==null?void 0:a.map(s=>e.jsx("td",{className:"border border-gray-100 font-medium text-center  text-sm text-gray-700 group-hover:text-gray-900 transition-colors duration-200",children:(t==null?void 0:t.data[s==null?void 0:s.key])??"—"},s==null?void 0:s.key)),A&&e.jsx("td",{className:"text-center p-4 border border-gray-100",children:e.jsxs(h,{size:"sm",variant:"danger",isLoading:q,className:"group text-white bg-red-600",onClick:()=>O({itemId:t==null?void 0:t._id,categoryId:m}),children:[e.jsx("i",{className:"fas fa-trash mr-2"}),e.jsx("span",{className:"",children:"Delete"})]})})]},`existing-${t==null?void 0:t._id}`)}),d.map((t,r)=>e.jsxs("tr",{className:`group relative border-none !border-b-1 px-4 py-2  cursor-pointer transition-all duration-200\r
     hover:bg-gray-50 hover:border-gray-300`,children:[e.jsx("td",{className:"border border-gray-100 p-4 font-medium text-center  text-sm text-gray-700 group-hover:text-gray-900 transition-colors duration-200"}),o.fields.map(a=>e.jsx("td",{className:"border border-gray-100 px-1 font-medium text-center  text-sm text-gray-700 group-hover:text-gray-900 transition-colors duration-200",children:e.jsx(M,{type:a.type==="number"?"number":"text",placeholder:a.key,className:"w-full rounded-md ",value:t.data[a.key]||"",onChange:s=>B(r,a.key,a.type==="number"?Number(s.target.value):s.target.value)})},a.key)),e.jsx("td",{className:"text-center p-4 border border-gray-100",children:e.jsxs(h,{size:"sm",variant:"ghost",className:"group text-white bg-red-600 hover:bg-red-600",onClick:()=>_(r),children:[e.jsx("i",{className:"fas fa-xmark mr-2"})," Remove"]})})]},`new-${r}`))]})]})})]})}export{ee as default};
