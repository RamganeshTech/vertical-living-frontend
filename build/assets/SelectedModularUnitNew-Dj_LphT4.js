import{b as $,f as B,c as _,r as Q,j as e}from"./index-BnxfhzlG.js";import{t as n}from"./toast-BSC5QTk1.js";import{B as c}from"./Button-B-Uk6Apc.js";import{B as f}from"./Badge-CrQOuY5N.js";import{C as k,a as z,b as M,c as q}from"./Card-CI6YJNzS.js";import{u as H,a as Y,b as V,c as W}from"./selectedModularUnitNewApi-zZSXGuxd.js";import{N as Z}from"./constants-Dsaf8__L.js";import J from"./MaterialOverviewLoading-_5OR22vi.js";import{d as F}from"./downloadFile-3m7eWOIo.js";import{d as K,f as X}from"./dateFormator-BGKi5rfZ.js";import"./useQuery-DQ8spYHd.js";import"./useMutation-BcezwzYU.js";import"./roleCheck-B2ZABSQw.js";import"./Skeleton-B_wz9nub.js";function he(){var C,I;const{projectId:x}=$(),{isMobile:m,openMobileSidebar:h}=B(),S=_(),[p,b]=Q.useState(null),{data:l,isLoading:U,error:A,refetch:u}=H(x),{mutateAsync:P,isPending:D,variables:T}=Y(),{mutateAsync:G,isPending:v}=V(),{mutateAsync:R,isPending:j}=W(),E=async s=>{var t,d;try{await P({projectId:x,unitId:s}),n({title:"Success",description:"Unit removed successfully"})}catch(i){n({title:"Error",description:((d=(t=i==null?void 0:i.response)==null?void 0:t.data)==null?void 0:d.message)||"Failed to delete unit",variant:"destructive"})}},y=async(s,t)=>{var d,i;b(s.productId);try{const a={_id:s.productId,productName:s.productName,attributes:s.attributes,serialNo:s.serialNo,dimention:s.dimention,description:s.description,totalAreaSqFt:s.totalAreaSqFt,materialsNeeded:s.materialsNeeded,fabricationCost:s.fabricationCost,timeRequired:s.timeRequired,productImages:s.productImages,"2dImages":s["2dImages"],"3dImages":s["3dImages"],category:s.category};await R({projectId:x,quantity:t,singleUnitCost:s.singleUnitCost,product:a}),n({title:"Success",description:"Quantity updated successfully"}),u()}catch(a){n({title:"Error",description:((i=(d=a==null?void 0:a.response)==null?void 0:d.data)==null?void 0:i.message)||"Failed to update quantity",variant:"destructive"})}finally{b(null)}},L=async()=>{var s,t,d,i;try{const a=await G({projectId:x});await F({src:(s=a==null?void 0:a.pdfData)==null?void 0:s.url,alt:((t=a==null?void 0:a.pdfData)==null?void 0:t.originalName)||"modular unit pdf"}),n({title:"Success",description:"Pdf Generated successfully"})}catch(a){n({title:"Error",description:((i=(d=a==null?void 0:a.response)==null?void 0:d.data)==null?void 0:i.message)||"Failed to complete selection",variant:"destructive"})}},o=s=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(s),N=s=>s===null?"":s.replace(/([A-Z])/g," $1").replace(/^./,t=>t.toUpperCase()).trim(),O=s=>s.productImages&&s.productImages.length>0&&s.productImages[0].url?s.productImages[0].url:s["2dImages"]&&s["2dImages"].length>0&&s["2dImages"][0].url?s["2dImages"][0].url:s["3dImages"]&&s["3dImages"].length>0&&s["3dImages"][0].url?s["3dImages"][0].url:Z,r=(l==null?void 0:l.selectedUnits)||[],w=(l==null?void 0:l.totalCost)||0,g=(r==null?void 0:r.length)>0;return U?e.jsxs("div",{className:"max-h-full overflow-y-auto flex flex-col bg-gradient-to-br from-slate-50 to-slate-100",children:[e.jsx("div",{className:"bg-white shadow-sm border-b border-slate-200 px-4 py-4",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center",children:[m&&e.jsx("button",{onClick:h,className:"mr-3 p-2 rounded-md border border-gray-300 hover:bg-gray-100",title:"Open Menu",children:e.jsx("i",{className:"fa-solid fa-bars"})}),e.jsx("h1",{className:"text-xl md:text-2xl font-bold text-slate-900",children:"Selected Units"})]})})}),e.jsx(J,{})]}):A?e.jsxs("div",{className:"h-screen flex flex-col bg-gradient-to-br from-slate-50 to-slate-100",children:[e.jsx("div",{className:"bg-white shadow-sm border-b border-slate-200 px-4 py-4",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center",children:[m&&e.jsx("button",{onClick:h,className:"mr-3 p-2 rounded-md border border-gray-300 hover:bg-gray-100",title:"Open Menu",children:e.jsx("i",{className:"fa-solid fa-bars"})}),e.jsx("h1",{className:"text-xl md:text-2xl font-bold text-slate-900",children:"Selected Units"})]})})}),e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"fas fa-exclamation-triangle text-3xl text-red-500 mb-4"}),e.jsx("p",{className:"text-red-600 text-lg mb-4",children:"Failed to load selected units"}),e.jsxs(c,{onClick:()=>u(),variant:"outline",children:[e.jsx("i",{className:"fas fa-refresh mr-2"}),"Try Again"]})]})})]}):e.jsxs("div",{className:"h-full overflow-y-auto w-full flex flex-col bg-gradient-to-br from-slate-50 to-slate-100",children:[e.jsx("header",{className:"bg-white w-full shadow-sm border-b border-slate-200 px-4 py-4 flex-shrink-0",children:e.jsxs("div",{className:"flex w-full items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center",children:[m&&e.jsx("button",{onClick:h,className:"mr-3 p-2 rounded-md border border-gray-300 hover:bg-gray-100",title:"Open Menu",children:e.jsx("i",{className:"fa-solid fa-bars"})}),e.jsxs("div",{className:"flex gap-2 items-center flex-row-reverse w-70 justify-between sm:flex-row sm:justify-start",children:[e.jsxs("div",{onClick:()=>S(-1),className:"flex bg-gray-200 cursor-pointer rounded-full items-center gap-2 backdrop-blur-sm px-4 py-2",children:[e.jsx("i",{className:"fas fa-arrow-left text-sm"}),e.jsx("span",{className:"text-sm font-medium",children:"Back"})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl md:text-2xl font-bold text-slate-900",children:"Selected Units"}),e.jsx("div",{className:"flex items-center space-x-4 mt-1",children:!m&&e.jsx(e.Fragment,{children:e.jsxs(f,{variant:"secondary",className:"text-xs px-2 py-1",children:[e.jsx("i",{className:"fas fa-cube mr-1"}),r.length," ",r.length===1?"Unit":"Units"]})})})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between sm:justify-center space-x-4 w-full sm:w-fit",children:[e.jsxs("div",{className:"text-left sm:text-right",children:[e.jsx("p",{className:"text-sm text-slate-600",children:"Total Cost"}),e.jsx("p",{className:"text-xl md:text-2xl font-bold text-green-600",children:o(w)})]}),e.jsxs(c,{isLoading:v,onClick:L,disabled:v||!g,className:"px-4 md:px-6 bg-green-600 hover:bg-green-700 text-white disabled:bg-gray-400",children:[e.jsx("i",{className:"fas fa-check-circle mr-2"}),m?"Generate":"Generate PDf"]})]})]})}),e.jsx("div",{className:"flex-1  ",children:e.jsx("div",{className:"p-4 md:p-6",children:e.jsx("div",{className:"max-w-full  mx-auto",children:g?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 md:gap-4",children:r.map((s,t)=>e.jsxs(k,{className:"hover:shadow-lg transition-shadow duration-300 overflow-hidden",children:[e.jsxs("div",{className:"relative h-48 bg-gray-100",children:[e.jsx("img",{src:O(s),alt:s.productName||N(s.category),className:"w-full h-full object-cover"}),e.jsx(c,{onClick:()=>E(s._id),isLoading:D&&T.unitId===s._id,variant:"ghost",size:"sm",className:"absolute top-2 right-2 bg-white/90 hover:bg-white text-red-500 hover:text-red-700 shadow-sm",children:e.jsx("i",{className:"fas fa-trash text-sm"})}),s.category&&e.jsx(f,{className:"absolute bottom-2 left-2 bg-white/90 text-slate-700",children:N(s.category)})]}),e.jsx(z,{className:"pb-2",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx(M,{className:"text-base md:text-lg font-semibold text-slate-900 truncate",children:s.productName||N(s.category)}),s.serialNo&&e.jsxs("p",{className:"text-xs text-slate-500 truncate",children:[e.jsx("i",{className:"fas fa-hashtag text-gray-500 text-xs"})," ",s.serialNo]})]})})}),e.jsx(q,{className:"pt-0",children:e.jsxs("div",{className:"space-y-3",children:[s.description&&e.jsx("div",{className:"pb-2 border-b border-slate-100",children:e.jsx("p",{className:"text-xs text-slate-600 line-clamp-2",children:s.description})}),s.attributes&&s.attributes.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.attributes.slice(0,3).map((d,i)=>e.jsx(f,{variant:"outline",className:"text-xs px-2 py-0",children:d},i)),s.attributes.length>3&&e.jsxs(f,{variant:"outline",className:"text-xs px-2 py-0",children:["+",s.attributes.length-3]})]}),s.dimention&&(s.dimention.depth||s.dimention.width||s.dimention.height)&&e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-slate-600",children:"Dimensions:"}),e.jsxs("span",{className:"font-medium text-slate-900",children:[s.dimention.height&&`${s.dimention.height}H`,s.dimention.width&&` × ${s.dimention.width}W`,s.dimention.depth&&` × ${s.dimention.depth}D`]})]}),s.totalAreaSqFt&&e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-slate-600",children:"Area:"}),e.jsxs("span",{className:"font-medium text-slate-900",children:[s.totalAreaSqFt," sq.ft"]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-slate-200",children:[e.jsx("span",{className:"text-sm text-slate-600",children:"Quantity:"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(c,{onClick:()=>y(s,s.quantity-1),disabled:s.quantity<=0||j||p===s.productId,isLoading:j,variant:"outline",size:"sm",className:"h-7 w-7 p-0",children:e.jsx("i",{className:"fas fa-minus text-xs"})}),e.jsx("span",{className:"font-semibold text-slate-900 min-w-[30px] text-center",children:p===s.productId?e.jsx("i",{className:"fas fa-spinner fa-spin text-sm"}):s.quantity}),e.jsx(c,{onClick:()=>y(s,s.quantity+1),disabled:j||p===s.productId,variant:"outline",size:"sm",className:"h-7 w-7 p-0",children:e.jsx("i",{className:"fas fa-plus text-xs"})})]})]}),s.fabricationCost&&s.fabricationCost>0&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-slate-600",children:"Unit Cost:"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("i",{className:"fas fa-rupee-sign text-slate-400 text-xs"}),e.jsx("span",{className:"font-semibold text-slate-900 text-sm",children:o(s.fabricationCost)})]})]}),s.timeRequired&&s.timeRequired>0&&e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-slate-600",children:"Time:"}),e.jsxs("span",{className:"font-medium text-slate-700",children:[e.jsx("i",{className:"fas fa-clock mr-1"}),s.timeRequired," days"]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-slate-200",children:[e.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Total:"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("i",{className:"fas fa-calculator text-green-500 text-xs"}),e.jsx("span",{className:"font-bold text-green-600 text-sm",children:o(s.singleUnitCost)})]})]})]})})]},`${s.productId}-${t}`))}),g&&e.jsxs("div",{className:"mt-8 bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:[e.jsx("i",{className:"fas fa-chart-pie mr-2 text-blue-600"}),"Order Summary"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-blue-600 mb-1",children:"Total Units"}),e.jsx("p",{className:"text-2xl font-bold text-blue-700",children:r.length})]}),e.jsxs("div",{className:"p-4 bg-purple-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-purple-600 mb-1",children:"Total Quantity"}),e.jsx("p",{className:"text-2xl font-bold text-purple-700",children:r.reduce((s,t)=>s+t.quantity,0)})]}),e.jsxs("div",{className:"p-4 bg-green-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-green-600 mb-1",children:"Total Cost"}),e.jsx("p",{className:"text-2xl font-bold text-green-700",children:o(w)})]})]}),r.some(s=>s.materialsNeeded)&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-200",children:[e.jsxs("h4",{className:"text-sm font-semibold text-slate-700 mb-2",children:[e.jsx("i",{className:"fas fa-tools mr-2"}),"Materials Needed"]}),e.jsx("div",{className:"space-y-1",children:r.filter(s=>s.materialsNeeded).map((s,t)=>e.jsxs("div",{className:"text-xs text-slate-600",children:[e.jsxs("span",{className:"font-medium",children:[s.productName,":"]})," ",s.materialsNeeded]},t))})]}),r.some(s=>s.timeRequired)&&e.jsx("div",{className:"mt-4 pt-4 border-t border-slate-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-semibold text-slate-700",children:[e.jsx("i",{className:"fas fa-calendar-alt mr-2"}),"Estimated Total Time:"]}),e.jsxs("span",{className:"text-lg font-bold text-slate-900",children:[r.reduce((s,t)=>s+(t.timeRequired||0),0)," days"]})]})})]})]}):e.jsxs("div",{className:"h-full min-h-[60vh] text-center py-16",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-slate-100 rounded-full mb-6",children:e.jsx("i",{className:"fas fa-shopping-cart text-6xl text-slate-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-slate-900 mb-2",children:"No Units Selected"}),e.jsx("p",{className:"text-slate-600 mb-6 max-w-md mx-auto",children:"You haven't added any modular units in cart yet."})]})})})}),e.jsxs("div",{className:"space-y-6 px-3",children:[e.jsx("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"Export Order Material"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Generate a PDF document of your order materials"})]})}),l!=null&&l.pdfList&&((C=l==null?void 0:l.pdfList)==null?void 0:C.length)>0?(I=l==null?void 0:l.pdfList)==null?void 0:I.map(s=>e.jsx(k,{className:"border-green-200 bg-green-50 ",children:e.jsx(q,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx("i",{className:"fas fa-check-circle text-green-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-green-900 mb-1",children:s.originalName}),e.jsxs("span",{className:"text-sm",children:["Created At: ",`${K(s.uploadedAt)} - ${X(s.uploadedAt)}`||"N/A"]}),e.jsx("p",{className:"text-sm text-green-700",children:"Your order material PDF is ready to view or download"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full sm:w-auto ",children:[e.jsxs(c,{variant:"outline",onClick:()=>window.open(s.url,"_blank"),className:"border-green-300 text-blue-700 hover:bg-blue-100 hover:border-blue-400",children:[e.jsx("i",{className:"fas mr-2 fa-external-link-alt"}),"View in New Tab"]}),e.jsx(c,{variant:"secondary",onClick:()=>F({src:s.url,alt:"order material"}),className:"border-blue-300 text-blue-700 hover:bg-blue-100 hover:border-blue-400",children:"Download PDF"})]})]})})},s._id)):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col items-center  justify-center min-h-[300px] w-full bg-white rounded-xl text-center p-6",children:[e.jsx("i",{className:"fa-solid fa-file-lines text-5xl text-blue-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-1",children:"No Pdf Found"}),e.jsx("p",{className:"text-sm text-gray-500",children:"No PDF Generated"})]})})]})]})}export{he as default};
