import{a as v,j as h}from"./index-CqEiDvr_.js";import{u as I}from"./designLabApi-B8CqL0uw.js";import{D as b}from"./DesignLabForm-CjEAQbTZ.js";import{t as p}from"./toast-BSC5QTk1.js";import"./useQuery-DyvuN1xf.js";import"./useMutation-DDHgQq3T.js";import"./useInfiniteQuery-DFFyAdlX.js";import"./roleCheck-BJ07f95N.js";import"./Button-DzcQpMPj.js";const q=()=>{const{organizationId:n}=v(),{mutateAsync:m,isPending:l}=I(),u=async r=>{var c;try{const t=new FormData;if(!r.productName||!((c=r==null?void 0:r.productName)!=null&&c.trim())){p({title:"Error",description:"Enter the product name",variant:"destructive"});return}const o=[],d=r.components.map(e=>{const i=e.materials.filter(a=>{var s;return((s=a.materialName)==null?void 0:s.trim())||a.rate!==""&&a.rate!==0||a.image});return{...e,materials:i}}),f=r.sequenceOfOperations.filter(e=>e.description&&e.description.trim()!=="").map((e,i)=>({...e,stepNumber:i+1})),g={...r,organizationId:n,sequenceOfOperations:f,referenceImages:[],components:d.map(e=>({...e,materials:e.materials.map(i=>({...i,vendorId:i.vendorId===""?void 0:i.vendorId}))}))};r.newRefFiles.forEach(e=>{t.append("files",e),o.push({target:"reference"})}),d.forEach((e,i)=>{e.materials.forEach((a,s)=>{a.tempFile&&(t.append("files",a.tempFile),o.push({target:"material",componentIndex:i,materialIndex:s}))})}),t.append("data",JSON.stringify(g)),t.append("fileMapping",JSON.stringify(o)),t.append("organizationId",n),await m({organizationId:n,formData:t}),p({title:"Success",description:"Design created successfully"})}catch(t){console.error(t),p({title:"Error",description:t.message||"Failed to create design",variant:"destructive"})}};return h.jsx(b,{mode:"create",organizationId:n,onSubmit:u,isLoading:l})};export{q as default};
