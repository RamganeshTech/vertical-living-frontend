import{F as ee,a as se,k as ae,r as f,j as e,B as j}from"./index-BAM0eJUz.js";const N=({className:o="",children:i,onClick:C})=>e.jsx("div",{onClick:C,className:`bg-white border border-gray-300 rounded-xl shadow-sm mb-6 overflow-hidden ${o}`,children:i}),v=({className:o="",children:i})=>e.jsx("div",{className:`px-6 py-3 bg-gray-100 border-b border-gray-300 ${o}`,children:i}),S=({className:o="",children:i})=>e.jsx("div",{className:`p-6 ${o}`,children:i}),y=({className:o="",children:i})=>e.jsx("h3",{className:`text-base font-extrabold text-gray-800 flex items-center gap-2 uppercase tracking-wide ${o}`,children:i}),te=["Bedroom","Living Room","Kitchen","Bathroom","Foyer","Commercial"],re=["Beginner","Intermediate","Advanced","Factory Pro"],le=["Nos","Sqft","Sqmt","Rft","mm","Meters","Kg","Liters","Sheets","Box","Set","Bundle"],w={materialName:"",rate:"",unit:"Nos",labourCost:"",specsNotes:"",vendorId:null,vendorName:""},$=o=>{var i;return!o.materialName&&!o.vendorName&&!o.rate&&!o.labourCost&&!o.specsNotes&&!((i=o.image)!=null&&i.url)&&!o.tempFile&&(o.vendorId===""||o.vendorId===null)},oe=({initialData:o,mode:i,onSubmit:C,isLoading:O,onReset:D})=>{var q,P,A;const d=ee(),B=se(),p=i==="create",{role:k,permission:u}=ae(),z=k==="owner"||((q=u==null?void 0:u.design)==null?void 0:q.create),U=k==="owner"||((P=u==null?void 0:u.design)==null?void 0:P.edit),V=k==="owner"||((A=u==null?void 0:u.design)==null?void 0:A.list),[r,m]=f.useState({designerName:(d==null?void 0:d.name)||"Loading...",designerId:(d==null?void 0:d.id)||null,designDate:new Date().toISOString(),designCode:"",productName:"",spaceType:"",difficultyLevel:"Intermediate",status:"draft",referenceImages:[],newRefFiles:[],components:[{componentName:"New Component",materials:[{...w}]}],pros:"",cons:"",mistakes:"",visualLogic:"",variations:"",sequenceOfOperations:[{stepNumber:1,description:""}]}),[b,L]=f.useState(0),[_,R]=f.useState(!1),[Y,F]=f.useState("");f.useEffect(()=>{o?(console.log("geting "),m(s=>({...s,...o,newRefFiles:[]}))):d!=null&&d.name&&i==="create"&&m(s=>({...s,designerName:(d==null?void 0:d.name)||""}))},[d==null?void 0:d.name,o,i]);const g=(s,a)=>{m(t=>({...t,[s]:a}))},T=async s=>{var l;if(!((l=s.target.files)!=null&&l.length))return;const a=Array.from(s.target.files),t=a.map(c=>({url:URL.createObjectURL(c)}));m(c=>({...c,newRefFiles:[...c.newRefFiles||[],...a],referenceImages:[...c.referenceImages||[],...t]}))},H=async s=>{const a=[...r.referenceImages];a.splice(s,1),r.referenceImages[s].url.startsWith("blob:"),m(l=>({...l,referenceImages:a,newRefFiles:l.newRefFiles.filter(c=>!0)})),b>=a.length&&L(Math.max(0,a.length-1))},E=s=>{r.referenceImages.length<=1||L(a=>s==="prev"?a===0?r.referenceImages.length-1:a-1:a===r.referenceImages.length-1?0:a+1)},I=(s,a)=>{let t=[...r.sequenceOfOperations];t[s].description=a,s===t.length-1&&a.trim()!==""&&t.push({stepNumber:t.length+1,description:""}),a.trim()===""&&s!==t.length-1&&(t.splice(s,1),t.forEach((l,c)=>l.stepNumber=c+1)),m(l=>({...l,sequenceOfOperations:t}))},K=()=>{m(s=>({...s,sequenceOfOperations:[...s.sequenceOfOperations,{stepNumber:s.sequenceOfOperations.length+1,description:""}]}))},W=()=>{m(s=>({...s,components:[...s.components,{componentName:"New Component",materials:[{...w}]}]}))},G=s=>{const a=[...r.components];a.splice(s,1),m(t=>({...t,components:a}))},J=(s,a)=>{const t=[...r.components];t[s].componentName=a,m(l=>({...l,components:t}))},x=(s,a,t,l)=>{const c=[...r.components];c[s].materials[a]={...c[s].materials[a],[t]:l};const n=c[s].materials,h=n[a];a===n.length-1&&!$(h)&&n.push({...w}),$(h)&&a!==n.length-1&&n.splice(a,1),m(Z=>({...Z,components:c}))},Q=(s,a)=>{const t=[...r.components];t[s]&&t[s].materials&&(t[s].materials.splice(a,1),t[s].materials.length===0&&t[s].materials.push({...w}),m(l=>({...l,components:t})))},M=async(s,a,t)=>{const l=[...r.components];l[s].materials[a].tempFile=t,l[s].materials[a].image={url:URL.createObjectURL(t)},x(s,a,"tempFile",t),m(c=>({...c,components:l}))},X=async(s,a)=>{const t=[...r.components];t[s].materials[a].image=null,t[s].materials[a].tempFile=void 0,x(s,a,"image",null),m(l=>({...l,components:t}))};if(V)return e.jsxs("div",{className:"max-h-full overflow-y-auto bg-gray-100 text-gray-800 font-sans",children:[e.jsxs("header",{className:"bg-white border-b border-gray-300 px-8 py-3 sticky top-0 z-50 shadow-sm flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:()=>B(-1),className:"bg-blue-100 hover:bg-slate-300 flex items-center justify-between w-8 h-8 border border-[#a6aab8] text-sm cursor-pointer rounded-md px-2",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsx("div",{className:"bg-blue-600 p-2 rounded text-white",children:e.jsx("i",{className:"fas fa-drafting-compass text-lg"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 leading-none",children:i==="create"?"New Specification":"Edit Specification"}),e.jsxs("p",{className:"text-xs text-gray-500 font-medium",children:["Design Lab Control â€¢ ",r.designCode]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[D&&e.jsxs(j,{variant:"outline",onClick:D,disabled:O,className:"h-9 text-sm border-gray-300 text-gray-600 hover:bg-gray-50",children:[e.jsx("i",{className:"fas fa-undo mr-2"})," Reset"]}),(i==="create"&&z||i==="edit"&&U)&&e.jsxs(j,{onClick:()=>C(r),isLoading:O,className:"h-9 text-sm bg-blue-700 hover:bg-blue-800 text-white shadow-md",children:[e.jsx("i",{className:"fas fa-save mr-2"})," ",i==="create"?"Create Design":"Save Changes"]})]})]}),e.jsxs("div",{className:"max-w-full mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-300",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h3",{className:"text-sm font-bold text-gray-500 uppercase mb-4 tracking-wider",children:"Basic Details"}),!p&&e.jsx("div",{children:e.jsxs("label",{className:"block text-xs font-bold text-gray-500 mb-1",children:["Design Code: "," ",e.jsx("span",{className:"text-blue-700 text-sm",children:r==null?void 0:r.designCode})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-13 gap-6 items-end",children:[e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 mb-1",children:"Designer Name"}),e.jsx("input",{className:"w-full p-2.5 border border-gray-300 rounded text-sm font-bold text-gray-700",value:r.designerName})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 mb-1",children:"Design Date"}),e.jsx("input",{type:"date",className:"w-full p-2.5 bg-white border border-gray-300 rounded text-sm font-medium focus:ring-2 focus:ring-blue-500 outline-none",value:r.designDate.split("T")[0],name:"designDate",onChange:s=>g("designDate",s.target.value)})]}),e.jsxs("div",{className:`${p?"md:col-span-4":"md:col-span-3"}`,children:[e.jsx("label",{className:"block text-xs font-bold text-blue-700 mb-1",children:"Product / Design Name"}),e.jsx("input",{className:"w-full p-2.5 bg-white border border-gray-300 rounded text-sm font-bold text-gray-900 focus:ring-2 focus:ring-blue-500 outline-none",placeholder:"Enter Name...",name:"productName",value:r.productName,onChange:s=>g("productName",s.target.value)})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-xs font-bold text-blue-700 mb-1",children:"Space Type"}),e.jsxs("select",{className:"w-full p-2.5 bg-white border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500 outline-none",value:r.spaceType,name:"productName",onChange:s=>g("spaceType",s.target.value),children:[e.jsx("option",{value:"",children:"Select..."}),te.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{className:`${p?"md:col-span-2":"md:col-span-3"}`,children:[e.jsx("label",{className:"block text-xs font-bold text-blue-700 mb-1",children:"Difficulty"}),e.jsx("select",{className:"w-full p-2.5 bg-white border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500 outline-none",value:r.difficultyLevel,name:"difficultyLevel",onChange:s=>g("difficultyLevel",s.target.value),children:re.map(s=>e.jsx("option",{value:s,children:s},s))})]})]})]}),e.jsxs(N,{children:[e.jsxs(v,{className:"flex justify-between items-center",children:[e.jsxs(y,{children:[e.jsx("i",{className:"fas fa-images text-blue-600"})," Reference Images"]}),e.jsxs("label",{className:"cursor-pointer bg-white border border-blue-600 text-blue-600 hover:bg-blue-50 px-4 py-2 rounded font-bold text-xs uppercase transition-colors flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-upload"}),"Upload Images",e.jsx("input",{type:"file",multiple:!0,accept:"image/*",className:"hidden",onChange:T})]})]}),e.jsx(S,{children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"relative w-full h-[400px] bg-gray-300 rounded-lg overflow-hidden flex items-center justify-center group",children:r.referenceImages.length>0?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:r.referenceImages[b].url,className:"h-full max-w-full object-contain",onClick:()=>{F(r.referenceImages[b].url),R(!0)}}),e.jsx("button",{onClick:s=>{s.stopPropagation(),E("prev")},className:"absolute left-4 bg-black/50 text-white p-3 rounded-full hover:bg-black/80 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("i",{className:"fas fa-chevron-left"})}),e.jsx("button",{onClick:s=>{s.stopPropagation(),E("next")},className:"absolute right-4 bg-black/50 text-white p-3 rounded-full hover:bg-black/80 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("i",{className:"fas fa-chevron-right"})}),e.jsxs("span",{className:"absolute bottom-4 right-4 bg-black/70 text-white px-3 py-1 rounded text-xs font-bold",children:[b+1," / ",r.referenceImages.length]})]}):e.jsxs("label",{className:"w-full h-full flex flex-col items-center justify-center cursor-pointer text-gray-400 ",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-gray-100 flex items-center justify-center mb-4 group-hover:scale-110 transition-transform shadow-sm",children:e.jsx("i",{className:"fas fa-cloud-upload-alt text-3xl"})}),e.jsx("p",{className:"text-lg font-semibold text-gray-600 ",children:"Click to Upload Images"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"(Upload 2-5 images for best results)"}),e.jsx("input",{type:"file",multiple:!0,accept:"image/*",className:"hidden",onChange:T})]})}),r.referenceImages.length>0&&e.jsx("div",{className:"w-full overflow-x-auto pb-2 flex justify-center",children:e.jsx("div",{className:"flex gap-3",children:r.referenceImages.map((s,a)=>e.jsxs("div",{className:"relative group/thumb",children:[e.jsx("img",{src:s.url,onClick:()=>L(a),className:`h-[80px] w-[120px] object-cover rounded border-2 cursor-pointer transition-all ${b===a?"border-blue-600 opacity-100 shadow-md":"border-transparent opacity-60 hover:opacity-100"}`}),e.jsx("button",{onClick:t=>{t.stopPropagation(),H(a)},className:"absolute !cursor-pointer -top-1 -right-2 bg-white text-red-500 rounded-full w-5 h-5 flex items-center justify-center shadow-md opacity-0 group-hover/thumb:opacity-100 transition-opacity border border-gray-200 z-10",title:"Delete Image",children:e.jsx("i",{className:"fas fa-trash text-[10px]"})})]},a))})})]})})]}),e.jsxs(N,{children:[e.jsxs(v,{className:"flex justify-between items-center",children:[e.jsxs(y,{children:[e.jsx("i",{className:"fas fa-cubes text-blue-400"})," Design Components"]}),e.jsxs(j,{onClick:W,className:"bg-blue-600 hover:bg-blue-500 border-none text-white text-xs h-8",children:[e.jsx("i",{className:"fas fa-plus mr-2"})," Add Component"]})]}),e.jsx("div",{className:"p-6 bg-gray-50 space-y-8",children:r.components.map((s,a)=>e.jsxs("div",{className:"bg-white border border-gray-300 rounded-xl overflow-hidden shadow-sm",children:[e.jsxs("div",{className:"px-6 py-3 border-b border-gray-200 bg-gray-100 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsx("div",{className:"w-8 h-8 rounded bg-blue-600 text-white flex items-center justify-center text-sm font-bold",children:a+1}),e.jsx("input",{className:"bg-transparent text-lg font-bold text-gray-800 border-b-2 border-transparent hover:border-gray-300 focus:border-blue-600 outline-none px-1 w-1/2 transition-all placeholder-gray-400",placeholder:"Component Name...",value:s.componentName,onChange:t=>J(a,t.target.value)})]}),e.jsx("button",{onClick:()=>G(a),className:"text-gray-400 hover:text-red-600 p-2",children:e.jsx("i",{className:"fas fa-trash-alt text-lg"})})]}),e.jsxs("div",{className:"p-2",children:[e.jsxs("div",{className:"flex gap-3 px-4 py-2 text-xs font-bold text-gray-500 uppercase border-b border-gray-100",children:[e.jsx("div",{className:"w-[90px] text-center",children:"Img"}),e.jsx("div",{className:"flex-[2] text-center",children:"Material Name"}),e.jsx("div",{className:"flex-[2] text-center ",children:"Vendor"}),e.jsx("div",{className:"w-[80px] text-center ",children:"Rate"}),e.jsx("div",{className:"w-[80px] text-center ",children:"Unit"}),e.jsx("div",{className:"w-[80px] text-center ",children:"Labour"}),e.jsx("div",{className:"flex-[3] text-center ",children:"Specs / Notes"}),e.jsx("div",{className:"w-[40px] text-center",children:"Del"})]}),e.jsx("div",{className:"divide-y divide-gray-50",children:s.materials.map((t,l)=>{var c;return e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 hover:bg-blue-50 transition-colors group",children:[e.jsx("div",{className:"flex flex-col items-center gap-2",children:e.jsx("div",{className:"w-[90px] h-[90px] shrink-0 relative rounded-lg overflow-hidden group/img",children:(c=t.image)!=null&&c.url?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:t.image.url,alt:"Material",className:"w-full h-full object-cover bg-gray-100"}),e.jsxs("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover/img:opacity-100 transition-all duration-200 flex items-center justify-center gap-2 backdrop-blur-[1px]",children:[e.jsx("div",{className:"absolute inset-0 z-0 cursor-pointer",onClick:()=>{F(t.image.url),R(!0)}}),e.jsxs("label",{className:"relative z-10 w-8 h-8 flex items-center justify-center bg-white text-gray-600 rounded-full shadow-lg cursor-pointer hover:text-blue-600 hover:scale-110 transition-transform",title:"Change Image",children:[e.jsx("i",{className:"fas fa-sync-alt text-xs"}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:n=>{var h;return((h=n.target.files)==null?void 0:h[0])&&M(a,l,n.target.files[0])}})]}),e.jsx("button",{onClick:n=>{n.stopPropagation(),X(a,l)},className:"relative z-10 w-8 h-8 flex items-center justify-center bg-white text-red-500 rounded-full shadow-lg cursor-pointer hover:bg-red-50 hover:scale-110 transition-transform",title:"Remove Image",children:e.jsx("i",{className:"fas fa-trash text-xs"})})]})]}):e.jsxs("label",{className:"w-full h-full flex flex-col items-center justify-center cursor-pointer bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-400 hover:bg-blue-50/50 text-gray-400 hover:text-blue-500 transition-all group/upload",children:[e.jsx("div",{className:"w-8 h-8 flex items-center justify-center rounded-full bg-white shadow-sm mb-1 group-hover/upload:scale-110 transition-transform",children:e.jsx("i",{className:"fas fa-plus text-xs"})}),e.jsx("span",{className:"text-[9px] font-medium uppercase tracking-wide",children:"Add"}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:n=>{var h;return((h=n.target.files)==null?void 0:h[0])&&M(a,l,n.target.files[0])}})]})})}),e.jsx("div",{className:"flex-[2]",children:e.jsx("input",{className:"w-full p-2 text-sm border border-gray-300 rounded focus:border-blue-500 outline-none",placeholder:"Name",value:t.materialName,onChange:n=>x(a,l,"materialName",n.target.value)})}),e.jsx("div",{className:"flex-[2] relative group/vendor",children:e.jsx("input",{className:"w-full p-2 text-sm bg-gray-50 border border-gray-300 rounded outline-none",placeholder:"Vendor",value:t.vendorName||"",onChange:n=>x(a,l,"vendorName",n.target.value)})}),e.jsx("div",{className:"w-[80px]",children:e.jsx("input",{type:"number",className:"w-full p-2 text-sm text-right border border-gray-300 rounded outline-none",placeholder:"0",value:t.rate,onChange:n=>x(a,l,"rate",n.target.value)})}),e.jsx("div",{className:"w-[80px]",children:e.jsx("select",{className:"w-full p-2 text-sm border border-gray-300 rounded outline-none bg-white",value:t.unit,onChange:n=>x(a,l,"unit",n.target.value),children:le.map(n=>e.jsx("option",{value:n,children:n},n))})}),e.jsx("div",{className:"w-[80px]",children:e.jsx("input",{type:"number",className:"w-full p-2 text-sm text-right border border-gray-300 rounded outline-none",placeholder:"0",value:t.labourCost,onChange:n=>x(a,l,"labourCost",n.target.value)})}),e.jsx("div",{className:"flex-[3]",children:e.jsx("input",{className:"w-full p-2 text-sm border border-gray-300 rounded outline-none",placeholder:"Specs...",value:t.specsNotes,onChange:n=>x(a,l,"specsNotes",n.target.value)})}),e.jsx("div",{className:"w-[40px] text-center",children:l!==s.materials.length-1&&e.jsx("button",{onClick:()=>Q(a,l),className:"text-gray-300 hover:text-red-500",children:e.jsx("i",{className:"fas fa-times-circle text-xl"})})})]},l)})})]})]},a))})]}),e.jsxs(N,{children:[e.jsx(v,{children:e.jsxs(y,{children:[e.jsx("i",{className:"fas fa-brain text-purple-600"})," Logic, Pros & Cons"]})}),e.jsx(S,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-700 uppercase mb-1 block",children:"Pros"}),e.jsx("textarea",{className:"w-full p-3 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-200 outline-none text-sm",rows:3,value:r.pros,name:"pros",onChange:s=>g("pros",s.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-700 uppercase mb-1 block",children:"Cons"}),e.jsx("textarea",{className:"w-full p-3 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-200 outline-none text-sm",rows:3,value:r.cons,name:"cons",onChange:s=>g("cons",s.target.value)})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-700 uppercase mb-1 block",children:"Mistakes to Avoid"}),e.jsx("textarea",{className:"w-full p-3 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-200 outline-none text-sm",rows:3,value:r.mistakes,name:"mistakes",onChange:s=>g("mistakes",s.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-700 uppercase mb-1 block",children:"Visual Logic"}),e.jsx("textarea",{className:"w-full p-3 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-200 outline-none text-sm",rows:3,value:r.visualLogic,name:"visualLogic",onChange:s=>g("visualLogic",s.target.value)})]})]})]})})]}),e.jsxs(N,{children:[e.jsxs(v,{className:"flex justify-between",children:[e.jsxs(y,{children:[e.jsx("i",{className:"fas fa-list-ol text-teal-600"})," Sequence of Operations"]}),e.jsx(j,{onClick:K,children:"Add Row"})]}),e.jsx(S,{children:e.jsx("div",{className:"space-y-3",children:r.sequenceOfOperations.map((s,a)=>e.jsxs("div",{className:"flex items-start gap-4 group",children:[e.jsx("div",{className:"mt-2 w-8 h-8 rounded-full bg-teal-100 text-teal-700 font-bold flex items-center justify-center shrink-0 border border-teal-200 shadow-sm",children:a+1}),e.jsx("div",{className:"flex-1",children:e.jsx("textarea",{className:"w-full bg-white border border-gray-300 rounded-lg p-3 text-sm shadow-sm focus:border-teal-500 focus:ring-1 focus:ring-teal-200 outline-none  overflow-hidden min-h-[46px]",rows:3,placeholder:"Describe step...",value:s.description,onInput:t=>{t.currentTarget.style.height="auto",t.currentTarget.style.height=t.currentTarget.scrollHeight+"px"},onChange:t=>I(a,t.target.value)})})]},a))})})]})]}),_&&e.jsxs("div",{className:"fixed inset-0 z-[9999] bg-black/95 backdrop-blur-sm flex items-center justify-center p-6",onClick:()=>R(!1),children:[e.jsx("button",{className:"absolute top-5 right-5 text-white/70 hover:text-white text-3xl transition-colors",children:e.jsx("i",{className:"fas fa-times"})}),e.jsx("img",{src:Y,className:"max-h-[90vh] max-w-[90vw] object-contain rounded shadow-2xl border border-white/20",onClick:s=>s.stopPropagation()})]})]})};export{oe as D};
