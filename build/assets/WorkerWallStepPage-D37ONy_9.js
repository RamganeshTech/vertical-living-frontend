import{u as q,r as c,j as e}from"./index-DmIvND9E.js";import{W as z,N as m}from"./constants-4IFJeChr.js";import{a as D,b as G,c as T}from"./workerWallPaintingApi-HEt3cTRG.js";import{d as Y}from"./downloadFile-aQHxe2Id.js";import{t as x}from"./toast-BSC5QTk1.js";import{B as C}from"./Button-CcLxO5cH.js";import"./useQuery-BHdcKCtG.js";import"./useMutation-CAeBxy3I.js";import"./roleCheck-DZRqXPrB.js";function se(){var v,w,y,k;const{projectId:u,stepId:I,stepNumber:o}=q(),[n,U]=c.useState(null),[d,F]=c.useState(null),[L,b]=c.useState(!1),[h,g]=c.useState(null),{data:i,isLoading:P,refetch:j}=D(u,I),{mutateAsync:S,isPending:W}=G(),{mutateAsync:A,isPending:E}=T(),p=z.find(s=>s.stepNumber===Number(o)),R=()=>{b(!1)},B=()=>{b(!1)},M=(s,l)=>{g({url:s,alt:l})},N=()=>{g(null)};if(P)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-blue-600 text-lg font-medium",children:"Loading step details..."})]})});if(!p)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"âŒ"}),e.jsx("h2",{className:"text-2xl font-bold text-blue-800 mb-2",children:"Step Not Found"}),e.jsx("p",{className:"text-blue-600",children:"The requested step could not be found."})]})});const _=async()=>{var s,l;try{if(!n||n.length===0){alert("Please select files for initial upload.");return}const t=new FormData;for(let a=0;a<n.length;a++)t.append("files",n[a]);await S({projectId:u,stepNumber:o,formData:t}),j(),x({description:"images uploaded successfully",title:"Success"})}catch(t){x({title:"Error",description:((l=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:l.message)||(t==null?void 0:t.message)||"Failed to upload image",variant:"destructive"})}},$=async s=>{var l,t;try{if(!d||d.length===0){alert("Please select files for correction upload.");return}const a=new FormData;for(let r=0;r<d.length;r++)a.append("files",d[r]);await A({projectId:u,stepNumber:o,correctionRound:s,formData:a}),j(),x({description:"images uploaded successfully",title:"Success"})}catch(a){x({title:"Error",description:((t=(l=a==null?void 0:a.response)==null?void 0:l.data)==null?void 0:t.message)||"Failed to upload image",variant:"destructive"})}},f=({src:s,alt:l})=>e.jsxs("div",{className:"relative group cursor-pointer",onClick:()=>M(s,l),children:[L&&e.jsx("div",{className:" pointer-events-none absolute z-20 inset-0 bg-gray-900 animate-pulse rounded-lg flex items-center justify-center",children:e.jsx("div",{className:"w-8 h-8 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"})}),e.jsx("img",{src:s,alt:l,loading:"lazy",className:"w-full h-32 sm:h-40 md:h-48 object-cover rounded-lg border-2 border-blue-200 shadow-sm hover:shadow-lg transition-all duration-300 hover:border-blue-400",onLoadStart:()=>b(!0),onLoad:R,onError:B}),e.jsx("button",{onClick:t=>{t.stopPropagation(),Y({src:s,alt:l})},className:"absolute cursor-pointer bottom-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300 bg-blue-600 text-white p-2 rounded-full shadow hover:bg-blue-700",title:"Download",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v2a2 2 0 002 2h12a2 2 0 002-2v-2M8 12l4 4m0 0l4-4m-4 4V4"})})})]});return e.jsxs("div",{className:"min-h-[80%] bg-gray-50 rounded-xl",children:[h&&e.jsx("div",{className:"fixed inset-0 bg-black/70 bg-opacity-75 flex items-center justify-center z-50 p-4",onClick:N,children:e.jsxs("div",{className:"relative max-w-4xl max-h-full",children:[e.jsx("button",{onClick:N,className:"absolute -top-10 right-0 text-white hover:text-blue-300 transition-colors",children:e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("img",{src:h.url||m,alt:h.alt,className:"max-w-full max-h-full object-contain rounded-lg",onClick:s=>s.stopPropagation()})]})}),e.jsx("div",{className:"w-full h-full ",children:e.jsxs("div",{className:"bg-white border-2 border-gray-300 rounded-xl shadow-lg overflow-hidden",children:[e.jsxs("div",{className:"bg-white px-2 py-3 sm:px-6 sm:py-4",children:[e.jsxs("h1",{className:"text-2xl sm:text-3xl font-semibold text-blue-600 mb-2",children:[" ",`${o})`," "," ",p.label]}),e.jsxs("p",{className:"text-blue-600 hidden",children:["Step ",o]})]}),e.jsx("div",{className:"sm:max-h-[calc(100vh-150px)] max-h-[calc(100vh-85px)]  overflow-y-auto custom-scrollbar",children:e.jsxs("div",{className:"p-2 sm:p-6 space-y-8",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-2 sm:p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-blue-800 mb-4 flex items-center",children:[e.jsx("span",{className:"mr-2",children:"ðŸ“‹"}),"Step Requirements"]}),e.jsx("ul",{className:"space-y-2",children:p.rules.map((s,l)=>e.jsxs("li",{className:"flex items-start text-blue-700",children:[e.jsx("span",{className:"text-blue-500 mr-3 mt-0.5",children:"âœ…"}),e.jsx("span",{children:s})]},l))})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-2 sm:p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-blue-800 mb-4 flex items-center",children:[e.jsx("span",{className:"mr-2",children:"ðŸ“¤"}),"Your Initial Uploads"]}),(w=(v=i==null?void 0:i.data)==null?void 0:v.initialUploads)!=null&&w.length?e.jsx("div",{className:"max-w-full overflow-x-auto custom-scrollbar",children:e.jsx("div",{className:"flex gap-4 w-max",children:i.data.initialUploads.map((s,l)=>e.jsx(e.Fragment,{children:e.jsx(f,{src:(s==null?void 0:s.url)||m,alt:`Initial Upload ${l+1}`},l)}))})}):e.jsxs("div",{className:"text-center py-8 text-blue-500",children:[e.jsx("div",{className:"text-4xl mb-2",children:"ðŸ“"}),e.jsx("p",{className:"font-medium",children:"No initial uploads yet."})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-blue-200",children:[e.jsx("label",{className:"block text-sm font-medium text-blue-700 mb-2",children:"Upload Initial Files:"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx("input",{type:"file",multiple:!0,onChange:s=>U(s.target.files),className:"flex-1 text-sm text-blue-600 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 file:cursor-pointer border border-blue-200 rounded-lg"}),e.jsx(C,{isLoading:W,onClick:()=>_(),className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors duration-200 shadow-sm hover:shadow-md",children:"Upload Files"})]})]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-2 sm:p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-blue-800 mb-4 flex items-center",children:[e.jsx("span",{className:"mr-2",children:"ðŸ”„"}),"Correction Rounds"]}),(k=(y=i==null?void 0:i.data)==null?void 0:y.correctionRounds)!=null&&k.length?e.jsx("div",{className:"space-y-6",children:i.data.correctionRounds.map(s=>{var l,t;return e.jsxs("div",{className:"bg-white border border-blue-200 rounded-lg p-2 sm:p-6 shadow-sm",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("h3",{className:"text-lg font-bold text-blue-800",children:["Correction Round ",s==null?void 0:s.roundNumber]})}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:[e.jsxs("h4",{className:"font-semibold text-blue-800 mb-2",children:[e.jsx("i",{className:"fas fa-circle-info mr-1 sm:mr-2 "}),"Admin Note:"]}),e.jsxs("p",{className:"text-blue-700",children:[s.adminNote," "]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"font-semibold text-blue-800 mb-3",children:"Admin Reference Images:"}),s!=null&&s.adminUploads.length?e.jsx("div",{className:"max-w-full overflow-x-auto custom-scrollbar",children:e.jsx("div",{className:"flex gap-4 w-max",children:(l=s==null?void 0:s.adminUploads)==null?void 0:l.map((a,r)=>e.jsx(e.Fragment,{children:e.jsx(f,{src:a.url||m,alt:`Admin Upload ${r+1}`},r)}))})}):e.jsxs("div",{className:"text-center py-8 text-blue-500",children:[e.jsx("div",{className:"text-4xl mb-2",children:"ðŸ“"}),e.jsx("p",{className:"font-medium",children:"No Admin uploads"})]})]}),((t=s.workerCorrectedUploads)==null?void 0:t.length)>0?e.jsxs("div",{className:"mb-6 border-t border-gray-200",children:[e.jsx("h4",{className:"font-semibold text-blue-800 mb-3",children:"Your Correction Uploads:"}),e.jsx("div",{className:"max-w-full overflow-x-auto custom-scrollbar",children:e.jsx("div",{className:"flex gap-4 w-max",children:s.workerCorrectedUploads.map((a,r)=>e.jsx(e.Fragment,{children:e.jsx(f,{src:a.url||m,alt:`Worker Correction ${r+1}`},r)}))})})]}):e.jsxs("div",{className:"text-center py-8 border-t border-gray-200 text-blue-500",children:[e.jsx("div",{className:"text-4xl mb-2",children:"ðŸ“"}),e.jsx("p",{className:"font-medium",children:"No Worker correction uploads"})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 border border-blue-200",children:[e.jsx("label",{className:"block text-sm font-medium text-blue-700 mb-2",children:"Upload Correction Files:"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx("input",{type:"file",multiple:!0,onChange:a=>F(a.target.files),className:"flex-1 text-sm text-blue-600 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-medium file:bg-blue-100 file:text-blue-700 hover:file:bg-blue-200 file:cursor-pointer border border-blue-200 rounded-lg"}),e.jsx(C,{isLoading:E,onClick:()=>$(s==null?void 0:s.roundNumber),className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors duration-200 shadow-sm hover:shadow-md",children:"Upload Corrections"})]})]})]},s.roundNumber)})}):e.jsxs("div",{className:"text-center py-8 text-blue-500",children:[e.jsx("div",{className:"text-4xl mb-2",children:"âœ…"}),e.jsx("p",{className:"font-medium",children:"No corrections requested yet."}),e.jsx("p",{className:"text-sm mt-1",children:"Your work is on track!"})]})]})]})})]})})]})}export{se as default};
