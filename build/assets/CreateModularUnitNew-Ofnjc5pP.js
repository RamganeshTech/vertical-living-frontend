import{u as ce,b as le,r as n,j as e}from"./index-C1DtYOG4.js";import{t as h}from"./toast-BSC5QTk1.js";import{b as de,c as ne,d as oe}from"./modularUnitNewApi-J3flvKTO.js";import{C as L,b as k,d as M,a as V}from"./Card-CK78z7_O.js";import{L as c}from"./Label-CtYe-41D.js";import{I as o}from"./Input-CHqrZBuN.js";import{B as x}from"./Button-D6HVPia8.js";import{T}from"./TextArea-Bj5dO7Eq.js";import"./useQuery-DD9aZBjN.js";import"./useMutation-BgVKkKtF.js";import"./useInfiniteQuery-4I03x6LQ.js";import"./roleCheck-vyRiFK58.js";const me=({mode:l,unitId:f})=>{const b=ce(),{organizationId:$}=le(),{mutate:B,isPending:z}=de(),{mutateAsync:H,isPending:O}=ne(),{data:i,isLoading:W}=oe(l==="edit"&&f?f:""),y={productName:"",serialNo:"",category:"",description:"",dimention:{height:0,width:0,depth:0},totalAreaSqFt:"",materialsNeeded:"",fabricationCost:"",timeRequired:"",attributes:[]},[a,u]=n.useState(y),[C,G]=n.useState([]),[w,I]=n.useState([]),[q,K]=n.useState([]),[F,S]=n.useState([]),[P,_]=n.useState([]),[R,A]=n.useState([]),[J,Q]=n.useState(!1),[X,Y]=n.useState(!1),[Z,ee]=n.useState(!1),[j,U]=n.useState("");n.useEffect(()=>{var t,s,r,d,p,D;l==="edit"&&i&&(u({productName:i.productName||"",serialNo:i.serialNo||"",category:i.category||"",description:i.description||"",dimention:{height:((t=i.dimention)==null?void 0:t.height)||0,width:((s=i.dimention)==null?void 0:s.width)||0,depth:((r=i.dimention)==null?void 0:r.depth)||0},totalAreaSqFt:((d=i.totalAreaSqFt)==null?void 0:d.toString())||"",materialsNeeded:i.materialsNeeded||"",fabricationCost:((p=i.fabricationCost)==null?void 0:p.toString())||"",timeRequired:((D=i.timeRequired)==null?void 0:D.toString())||"",attributes:i.attributes||[]}),i.productImages&&I(i.productImages.map(g=>g.url)),i["2dImages"]&&S(i["2dImages"].map(g=>g.url)),i["3dImages"]&&A(i["3dImages"].map(g=>g.url)))},[l,i]);const m=(t,s)=>{u(r=>({...r,[t]:s}))},N=(t,s)=>{u(r=>({...r,dimention:{...r.dimention,[t]:s}}))},te=t=>{const s=Array.from(t.target.files||[]);G(s);const r=s.map(d=>URL.createObjectURL(d));I(r),l==="edit"&&Q(!0)},se=t=>{const s=Array.from(t.target.files||[]);K(s);const r=s.map(d=>URL.createObjectURL(d));S(r),l==="edit"&&Y(!0)},ae=t=>{const s=Array.from(t.target.files||[]);_(s);const r=s.map(d=>URL.createObjectURL(d));A(r),l==="edit"&&ee(!0)},E=()=>{j.trim()&&(u(t=>({...t,attributes:[...t.attributes,j.trim()]})),U(""))},ie=t=>{u(s=>({...s,attributes:s.attributes.filter((r,d)=>d!==t)}))},re=async t=>{var r,d;if(t.preventDefault(),!a.productName.trim()){h({title:"Error",description:"Product name is required",variant:"destructive"});return}if(!a.category){h({title:"Error",description:"Category is required",variant:"destructive"});return}if(!a.fabricationCost||Number(a.fabricationCost)<=0){h({title:"Error",description:"Valid fabrication cost is required",variant:"destructive"});return}const s={...a,dimention:{height:a.dimention.height||void 0,width:a.dimention.width||void 0,depth:a.dimention.depth||void 0},totalAreaSqFt:a.totalAreaSqFt||void 0,fabricationCost:a.fabricationCost||void 0,timeRequired:a.timeRequired||void 0};try{l==="create"?(await B({organizationId:$,formValues:s,productImages:C,images2d:q,images3d:P}),h({title:"Success",description:"Product created successfully!"}),u(y)):(await H({unitId:f,formValues:s,productImages:C,images2d:q,images3d:P,replaceProductImages:J,replace2dImages:X,replace3dImages:Z}),h({title:"Success",description:"Product updated successfully!"}))}catch(p){h({title:"Error",description:((d=(r=p==null?void 0:p.response)==null?void 0:r.data)==null?void 0:d.message)||`Failed to ${l} product`,variant:"destructive"})}};if(l==="edit"&&W)return e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx("i",{className:"fas fa-spinner fa-spin text-4xl text-gray-400"})});const v=z||O;return e.jsx("div",{className:"min-h-full bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-full mx-auto",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(x,{variant:"outline",size:"sm",onClick:()=>b(-1),className:"flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-arrow-left"}),"Back"]}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:l==="create"?"Create New Product":"Edit Product"})]})}),e.jsxs("form",{onSubmit:re,className:"space-y-6",children:[e.jsxs(L,{children:[e.jsx(k,{children:e.jsxs(M,{className:"flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-images text-blue-600"}),"Product Images"]})}),e.jsx(V,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"productImages",className:"text-sm font-medium",children:[e.jsx("i",{className:"fas fa-image mr-1 text-pink-600"}),"Product Images"]}),e.jsx(o,{id:"productImages",type:"file",accept:"image/*",multiple:!0,onChange:te,className:"cursor-pointer text-xs"}),w.length>0&&e.jsx("div",{className:"grid grid-cols-3 gap-2 mt-2",children:w.map((t,s)=>e.jsx("div",{className:"relative aspect-square rounded overflow-hidden border",children:e.jsx("img",{src:t,alt:`Product ${s+1}`,className:"w-full h-full object-cover"})},s))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"images2d",className:"text-sm font-medium",children:[e.jsx("i",{className:"fas fa-draw-polygon mr-1 text-cyan-600"}),"2D Images"]}),e.jsx(o,{id:"images2d",type:"file",accept:"image/*",multiple:!0,onChange:se,className:"cursor-pointer text-xs"}),F.length>0&&e.jsx("div",{className:"grid grid-cols-3 gap-2 mt-2",children:F.map((t,s)=>e.jsx("div",{className:"relative aspect-square rounded overflow-hidden border border-cyan-200",children:e.jsx("img",{src:t,alt:`2D ${s+1}`,className:"w-full h-full object-cover"})},s))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"images3d",className:"text-sm font-medium",children:[e.jsx("i",{className:"fas fa-cube mr-1 text-indigo-600"}),"3D Images"]}),e.jsx(o,{id:"images3d",type:"file",accept:"image/*",multiple:!0,onChange:ae,className:"cursor-pointer text-xs"}),R.length>0&&e.jsx("div",{className:"grid grid-cols-3 gap-2 mt-2",children:R.map((t,s)=>e.jsx("div",{className:"relative aspect-square rounded overflow-hidden border border-indigo-200",children:e.jsx("img",{src:t,alt:`3D ${s+1}`,className:"w-full h-full object-cover"})},s))})]})]})})]}),e.jsxs(L,{children:[e.jsx(k,{children:e.jsxs(M,{className:"flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-info-circle text-blue-600"}),"Product Details"]})}),e.jsxs(V,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"productName",children:["Product Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(o,{id:"productName",placeholder:"Enter product name",value:a.productName,onChange:t=>m("productName",t.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"fabricationCost",children:["Fabrication Cost (â‚¹) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(o,{id:"fabricationCost",type:"number",placeholder:"Enter fabrication cost",value:a.fabricationCost,onChange:t=>m("fabricationCost",t.target.value),required:!0})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"category",children:["Category ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(o,{id:"Category",placeholder:"Enter Category",value:a.category,onChange:t=>m("category",t.target.value)})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-ruler-combined text-purple-600"}),"Dimensions (mm)"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{htmlFor:"height",className:"text-xs text-gray-600",children:"Height"}),e.jsx(o,{id:"height",type:"number",placeholder:"H",value:a.dimention.height||"",onChange:t=>N("height",+t.target.value),className:"text-sm"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{htmlFor:"width",className:"text-xs text-gray-600",children:"Width"}),e.jsx(o,{id:"width",type:"number",placeholder:"W",value:a.dimention.width||"",onChange:t=>N("width",+t.target.value),className:"text-sm"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{htmlFor:"depth",className:"text-xs text-gray-600",children:"Depth"}),e.jsx(o,{id:"depth",type:"number",placeholder:"D",value:a.dimention.depth||"",onChange:t=>N("depth",+t.target.value),className:"text-sm"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"timeRequired",children:"Time Required (days)"}),e.jsx(o,{id:"timeRequired",type:"number",placeholder:"Enter time required",value:a.timeRequired,onChange:t=>m("timeRequired",t.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"totalAreaSqFt",children:"Total Area (sq ft)"}),e.jsx(o,{id:"totalAreaSqFt",type:"number",placeholder:"Enter total area",value:a.totalAreaSqFt,onChange:t=>m("totalAreaSqFt",t.target.value)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"materialsNeeded",children:"Materials Needed"}),e.jsx(T,{id:"materialsNeeded",placeholder:"Enter materials needed",value:a.materialsNeeded,onChange:t=>m("materialsNeeded",t.target.value),rows:2,className:"text-sm"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-tags text-orange-600"}),"Attributes"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{placeholder:"Add attribute (e.g., modern, wooden)",value:j,onChange:t=>U(t.target.value),onKeyPress:t=>{t.key==="Enter"&&(t.preventDefault(),E())},className:"text-sm flex-1"}),e.jsx(x,{type:"button",onClick:E,variant:"outline",size:"sm",className:"px-3",children:e.jsx("i",{className:"fas fa-plus"})})]}),a.attributes.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1.5 mt-2",children:a.attributes.map((t,s)=>e.jsxs("span",{className:"px-2 py-1 bg-blue-50 text-blue-700 rounded-full text-xs flex items-center gap-1.5",children:[t,e.jsx("button",{type:"button",onClick:()=>ie(s),className:"hover:text-red-600 transition-colors",children:e.jsx("i",{className:"fas fa-times text-[10px]"})})]},s))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"description",children:"Description"}),e.jsx(T,{id:"description",placeholder:"Enter product description",value:a.description,onChange:t=>m("description",t.target.value),rows:3,className:"text-sm"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-4 sticky bottom-0 bg-white p-4  rounded-lg shadow-lg",children:[e.jsxs(x,{type:"button",variant:"outline",onClick:()=>b(-1),disabled:v,children:[e.jsx("i",{className:"fas fa-times mr-2"}),"Cancel"]}),e.jsx(x,{type:"submit",isLoading:v,className:"min-w-[150px]",children:v?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin mr-2"}),l==="create"?"Creating...":"Updating..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:`fas ${l==="create"?"fa-plus":"fa-save"} mr-2`}),l==="create"?"Create Product":"Update Product"]})})]})]})]})})},we=()=>e.jsxs("main",{className:"max-h-full overflow-y-auto",children:[e.jsx(me,{mode:"create"}),";"]});export{we as default};
