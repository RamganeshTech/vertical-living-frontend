import{d as M,j as e,r as p,c as Y,e as q,b as J,O as Q,B as A,t as O}from"./index-DyM6T-eT.js";import{B as X}from"./Breadcrumb-BBilgyXa.js";import{u as B}from"./useDebounce-DXaYFH0W.js";import{u as Z,a as ee}from"./billAccountApi-xPLOM1M4.js";import{d as E}from"./dateFormator-BGKi5rfZ.js";import{S as se}from"./index-xda8XS2f.js";import{S as te}from"./StageGuide-DzUcb6ZB.js";import"./index-CkRxYNyB.js";const ae=({bill:l,index:m,handleView:r,handleDelete:g,deletePending:d})=>{var x,u,h;const{role:n,permission:o}=M(),f=n==="owner"||((x=o==null?void 0:o.billing)==null?void 0:x.delete);return e.jsxs("div",{className:"grid cursor-pointer grid-cols-14 gap-4 px-6 py-4 border-b border-gray-100 hover:bg-[#f9fcff] transition-colors items-center last:border-b-0",onClick:()=>r(l._id),children:[e.jsx("div",{className:"col-span-1 text-center text-gray-600 font-medium",children:m+1}),e.jsx("div",{className:"col-span-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-user text-blue-600 text-sm"}),e.jsx("span",{className:"font-medium text-gray-900 truncate",children:l.vendorName||"N/A"})]})}),e.jsx("div",{className:"col-span-2",children:e.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-semibold",children:l.billNumber||"N/A"})}),e.jsxs("div",{className:"col-span-2 text-gray-600 text-sm",children:[e.jsx("i",{className:"fas fa-calendar-alt text-gray-400 mr-2"}),E(l.billDate)]}),e.jsxs("div",{className:"col-span-2 text-gray-600 text-sm",children:[e.jsx("i",{className:"fas fa-calendar-alt text-gray-400 mr-2"}),E(l.createdAt)]}),e.jsxs("div",{className:"col-span-2 font-semibold text-green-600",children:["â‚¹",((u=l.grandTotal)==null?void 0:u.toFixed(2))||"0.00"]}),e.jsx("div",{className:"col-span-1 text-center",children:e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium",children:((h=l.items)==null?void 0:h.length)||0})}),e.jsx("div",{className:"col-span-1 flex justify-center gap-2",children:f&&e.jsx("button",{onClick:v=>{v.stopPropagation(),g(l._id)},disabled:d,className:"p-2 cursor-pointer text-red-600 hover:bg-red-100 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Delete Bill",children:d?e.jsx("i",{className:"fas fa-spinner fa-spin"}):e.jsx("i",{className:"fas fa-trash"})})})]})},re=({isOpen:l,onClose:m,sections:r,heading:g,subHeading:d})=>{const n=p.useRef(null);return p.useEffect(()=>{const o=f=>{f.key==="Escape"&&m()};return document.addEventListener("keydown",o),()=>document.removeEventListener("keydown",o)},[m]),e.jsxs(e.Fragment,{children:[l&&e.jsx("div",{className:"fixed inset-0 bg-black/10 bg-opacity-30 z-40",onClick:m}),e.jsxs("div",{ref:n,className:`fixed left-1/2 top-[90px] -translate-x-1/2 z-50 max-w-6xl bg-white rounded-lg shadow-xl transition-all duration-300 transform ${l?"translate-y-0 opacity-100 visible":"-translate-y-5 opacity-0 invisible"}`,children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-b-[#9a9c9e] px-6 py-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:g}),d&&e.jsx("p",{className:"text-sm text-gray-500",children:d})]}),e.jsx("button",{onClick:m,className:"text-gray-500 hover:text-gray-700 cursor-pointer",title:"Close",children:e.jsx("i",{className:"fas fa-xmark text-xl"})})]}),e.jsx("div",{className:"p-6 max-h-[400px] max-w-full overflow-x-auto overflow-y-auto",style:{whiteSpace:"nowrap"},children:r.map((o,f)=>e.jsxs("div",{className:"inline-block align-top mr-6 vertical-section",style:{verticalAlign:"top",whiteSpace:"normal"},children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-500 mb-3",children:o.title}),e.jsx("div",{className:"flex flex-col gap-2",children:o.items.map((x,u)=>e.jsxs("button",{onClick:x.onClick,className:"flex cursor-pointer items-center px-2 py-1.5 rounded-md text-sm text-gray-700 hover:bg-gray-100 transition w-44 text-left",children:[e.jsx("i",{className:`${x.icon} mr-2 text-[14px] w-4`}),e.jsx("span",{children:x.label})]},u))})]},f))})]})]})},le={Invoice:"invoice","Retail Invoice":"retailinvoice","Sales Order":"salesorder","Purchase Orders":"purchaseorder",Expense:"expense","Design Bills":"billtemplate","Vendor Payments":"vendorpayment",Customer:"customer",Vendor:"vendor"},be=()=>{var $,I;const l=Y(),m=q(),{organizationId:r}=J(),g=p.useRef(null),{role:d,permission:n}=M(),o=d==="owner"||(($=n==null?void 0:n.billing)==null?void 0:$.list),f=d==="owner"||((I=n==null?void 0:n.billing)==null?void 0:I.create),x=[{label:"Account",path:`/organizations/${r}/projects/accounting`},{label:"Bill",path:`/organizations/${r}/projects/billmain`}],u=[{title:"Sales Transactions",items:[{label:"Invoice",path:`/organizations/${r}/projects/invoicemain`,icon:"fas fa-file-invoice text-blue-600",onClick:()=>l(`/organizations/${r}/projects/invoicemain`)},{label:"Retail Invoice",path:`/organizations/${r}/projects/retailinvoicemain`,icon:"fas fa-receipt text-blue-600",onClick:()=>l(`/organizations/${r}/projects/retailinvoicemain`)},{label:"Sales Order",path:`/organizations/${r}/projects/salesordermain`,icon:"fas fa-shopping-cart text-blue-600",onClick:()=>l(`/organizations/${r}/projects/salesordermain`)},{label:"Purchase Orders",path:`/organizations/${r}/projects/purchasemain`,icon:"fas fa-wallet text-blue-600",onClick:()=>l(`/organizations/${r}/projects/purchasemain`)}]},{title:"Expense Transactions",items:[{label:"Expense",path:`/organizations/${r}/projects/expensemain`,icon:"fas fa-money-bill text-blue-600",onClick:()=>l(`/organizations/${r}/projects/expensemain`)},{label:"Design Bills",path:`/organizations/${r}/projects/billnew`,icon:"fas fa-file-pdf text-blue-600",onClick:()=>l(`/organizations/${r}/projects/billnew`)},{label:"Vendor Payments",path:`/organizations/${r}/projects/vendorpaymentmain`,icon:"fas fa-credit-card text-blue-600",onClick:()=>l(`/organizations/${r}/projects/vendorpaymentmain`)}]},{title:"Office Records",items:[{label:"Customer",path:`/organizations/${r}/projects/customermain`,icon:"fas fa-users text-blue-600",onClick:()=>l(`/organizations/${r}/projects/customermain`)},{label:"Vendor",path:`/organizations/${r}/projects/vendormain`,icon:"fas fa-user text-blue-600",onClick:()=>l(`/organizations/${r}/projects/vendormain`)}]}],h=p.useMemo(()=>d==="owner"?u:u.map(s=>{const t=s.items.filter(b=>{const i=le[b.label];if(!i)return!0;const j=n==null?void 0:n[i];return j&&Object.values(j).some(W=>W===!0)});return{...s,items:t}}).filter(s=>s.items.length>0),[d,n,u]),[v,F]=p.useState(!1),P=m.pathname.includes("/billsingle")||m.pathname.includes("/create"),[a,c]=p.useState({search:"",vendorId:"",date:"",billToDate:"",billFromDate:"",minAmount:0,maxAmount:1e6,createdFromDate:"",createdToDate:"",sortBy:"createdAt",sortOrder:"desc"}),L=B(a.search,700),R=B(a.minAmount,800),V=B(a.maxAmount,800),{data:N,fetchNextPage:S,hasNextPage:y,isFetchingNextPage:w,isLoading:_,isError:G,error:C,refetch:z}=Z({organizationId:r||"",vendorId:a.vendorId||void 0,limit:20,date:a.date||void 0,billToDate:a.billToDate||void 0,billFromDate:a.billFromDate||void 0,minAmount:R,maxAmount:V,createdFromDate:a.createdFromDate||void 0,createdToDate:a.createdToDate||void 0,search:L||void 0,sortBy:a.sortBy||void 0,sortOrder:a.sortOrder||void 0}),D=ee();p.useEffect(()=>{const s=g.current;if(!s)return;const t=()=>{const{scrollTop:b,scrollHeight:i,clientHeight:j}=s;i-b-j<100&&y&&!w&&(console.log("ðŸ“œ Loading more bill..."),S())};return s.addEventListener("scroll",t),()=>s.removeEventListener("scroll",t)},[y,w,S]);const H=async s=>{var t,b;try{await D.mutateAsync({billId:s}),z(),O({title:"Success",description:"Bill deleted successfully"})}catch(i){O({title:"Error",description:((b=(t=i==null?void 0:i.response)==null?void 0:t.data)==null?void 0:b.message)||(i==null?void 0:i.message)||"Failed to delete the bill",variant:"destructive"})}},K=s=>{l(`billsingle/${s}`)},T=Object.values(a).filter(s=>s!==""&&s!=="createdAt"&&s!=="desc").length,U=()=>{c({search:"",vendorId:"",date:"",minAmount:0,maxAmount:1e6,billToDate:"",billFromDate:"",createdFromDate:"",createdToDate:"",sortBy:"createdAt",sortOrder:"desc"})},k=(N==null?void 0:N.pages.flatMap(s=>s.data))||[];return P?e.jsx(Q,{}):e.jsxs("div",{className:"space-y-0 h-full",children:[e.jsx(re,{isOpen:v,onClose:()=>F(!1),heading:"Accounts",sections:h}),e.jsxs("header",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-receipt mr-3 text-blue-600"}),"Bill Accounts"]}),e.jsx(X,{paths:x})]}),e.jsxs("div",{className:"flex gap-2",children:[h.length>0&&e.jsxs(A,{onClick:()=>F(!0),title:"invoices, expense...",children:[e.jsx("i",{className:"fas fa-bars text-lg mr-2"})," Menu"]}),f&&e.jsxs(A,{onClick:()=>l("create"),children:[e.jsx("i",{className:"fas fa-plus mr-2"}),"Create Bill"]}),e.jsx("div",{className:"w-full sm:w-auto flex justify-end sm:block",children:e.jsx(te,{organizationId:r,stageName:"billing"})})]})]}),_?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("i",{className:"fas fa-spinner fa-spin text-blue-600 text-4xl"})}):G?e.jsxs("div",{className:"max-w-xl sm:min-w-[80%] mx-auto mt-4 p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2 text-xl sm:text-3xl",children:"âš ï¸ Error Occurred"}),e.jsx("p",{className:"text-red-500 mb-4 text-lg sm:text-xl",children:(C==null?void 0:C.message)||"Failed to load bills"}),e.jsx(A,{onClick:()=>z(),className:"bg-red-600 text-white px-4 py-2",children:"Retry"})]}):e.jsxs("main",{className:"flex gap-2 !max-h-[90%]",children:[e.jsx("div",{className:"xl:w-80 flex-shrink-0 !max-h-[100%] overflow-y-auto",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-filter mr-2 text-blue-600"}),"Filters"]}),T>0&&e.jsxs("button",{onClick:U,className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:["Clear All (",T,")"]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx("i",{className:"fas fa-search mr-2"}),"Search"]}),e.jsx("input",{type:"text",autoFocus:!0,placeholder:"Bill number, vendor name...",value:a.search,onChange:s=>c(t=>({...t,search:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx("i",{className:"fas fa-calendar mr-2"}),"From CreatedAt Date"]}),e.jsx("input",{type:"date",value:a.createdFromDate,onChange:s=>{c(t=>({...t,createdFromDate:s.target.value}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx("i",{className:"fas fa-calendar mr-2"}),"To CreatedAt Date"]}),e.jsx("input",{type:"date",value:a.createdToDate,onChange:s=>{c(t=>({...t,createdToDate:s.target.value}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx("i",{className:"fas fa-calendar mr-2"}),"From Bill Date"]}),e.jsx("input",{type:"date",value:a.billFromDate,onChange:s=>{c(t=>({...t,billFromDate:s.target.value}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx("i",{className:"fas fa-calendar mr-2"}),"To Bill Date"]}),e.jsx("input",{type:"date",value:a.billToDate,onChange:s=>{c(t=>({...t,billToDate:s.target.value}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-4",children:[e.jsx("i",{className:"fas fa-coins mr-2 text-gray-400"}),"Amount Range"]}),e.jsx("div",{className:"px-2 mb-3",children:e.jsx(se,{range:!0,min:0,max:1e6,step:500,value:[Number(a.minAmount),Number(a.maxAmount)],onChange:s=>{const[t,b]=s;c(i=>({...i,minAmount:t,maxAmount:b}))},trackStyle:[{backgroundColor:"#3b82f6",height:6}],handleStyle:[{borderColor:"#3b82f6",backgroundColor:"#fff",boxShadow:"0 2px 6px rgba(59, 130, 246, 0.4)",width:18,height:18,marginTop:-6,opacity:1},{borderColor:"#3b82f6",backgroundColor:"#fff",boxShadow:"0 2px 6px rgba(59, 130, 246, 0.4)",width:18,height:18,marginTop:-6,opacity:1}],railStyle:{backgroundColor:"#e5e7eb",height:6}})}),e.jsxs("div",{className:"flex justify-between items-center gap-2 text-sm",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-xs text-gray-500 block mb-1",children:"Min"}),e.jsxs("div",{className:"bg-blue-50 px-2 py-1.5 rounded border border-blue-100 font-semibold text-blue-700 text-center text-xs",children:["â‚¹",Number(a.minAmount).toLocaleString("en-IN")]})]}),e.jsx("div",{className:"text-gray-300",children:"â€”"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-xs text-gray-500 block mb-1",children:"Max"}),e.jsxs("div",{className:"bg-blue-50 px-2 py-1.5 rounded border border-blue-100 font-semibold text-blue-700 text-center text-xs",children:["â‚¹",Number(a.maxAmount).toLocaleString("en-IN")]})]})]}),e.jsxs("div",{className:"flex gap-2 items-center mt-3",children:[e.jsx("input",{type:"number",value:a.minAmount,onChange:s=>c(t=>({...t,minAmount:+s.target.value})),placeholder:"Min",className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500",min:"0"}),e.jsx("input",{type:"number",value:a.maxAmount,onChange:s=>c(t=>({...t,maxAmount:+s.target.value})),placeholder:"Max",className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500",min:"0"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sort By"}),e.jsxs("select",{value:a.sortBy,onChange:s=>{c(t=>({...t,sortBy:s.target.value}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"createdAt",children:"Created Date"}),e.jsx("option",{value:"billDate",children:"Bill Date"}),e.jsx("option",{value:"dueDate",children:"Due Date"}),e.jsx("option",{value:"grandTotal",children:"Grand Total"}),e.jsx("option",{value:"vendorName",children:"Vendor Name"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sort Order"}),e.jsxs("select",{value:a.sortOrder,onChange:s=>{c(t=>({...t,sortOrder:s.target.value}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"desc",children:"Descending"}),e.jsx("option",{value:"asc",children:"Ascending"})]})]})]})]})}),o&&e.jsxs(e.Fragment,{children:[" ",k.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[300px] w-full bg-white rounded-xl text-center p-6",children:[e.jsx("i",{className:"fas fa-file-bill text-5xl text-blue-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-1",children:"No Bills Found"}),e.jsxs("p",{className:"text-sm text-gray-500",children:[a.search||a.vendorId||a.date?"Try adjusting your filters to find bills.":"Looks like there are no bills yet.",e.jsx("br",{}),"Click on ",e.jsx("strong",{children:"Create Bill"})," to get started ðŸš€"]})]}):e.jsxs("div",{ref:g,className:"flex-1 !max-h-[100%] overflow-y-auto",children:[e.jsx("div",{className:"bg-white rounded-t-xl border border-gray-200 sticky top-0 z-10",children:e.jsxs("div",{className:"grid grid-cols-14 gap-4 px-6 py-4 bg-gradient-to-r from-blue-50 to-indigo-50 font-semibold text-gray-700 text-sm",children:[e.jsx("div",{className:"col-span-1 text-center",children:"S.No"}),e.jsx("div",{className:"col-span-3",children:"Vendor Name"}),e.jsx("div",{className:"col-span-2",children:"Bill Number"}),e.jsx("div",{className:"col-span-2",children:"Bill Date"}),e.jsx("div",{className:"col-span-2",children:"Created At"}),e.jsx("div",{className:"col-span-2",children:"Grand Total"}),e.jsx("div",{className:"col-span-1 text-center",children:"Items"}),e.jsx("div",{className:"col-span-1 text-center",children:"Actions"})]})}),e.jsx("div",{className:"bg-white rounded-b-xl border-x border-b border-gray-200",children:k.map((s,t)=>e.jsx(ae,{bill:s,index:t,handleView:K,handleDelete:H,deletePending:D.isPending&&D.variables.billId===s._id},s._id))}),w&&e.jsx("div",{className:"flex justify-center py-8",children:e.jsxs("div",{className:"flex items-center gap-2 text-blue-600",children:[e.jsx("i",{className:"fas fa-spinner fa-spin text-2xl"}),e.jsx("span",{className:"text-sm font-medium",children:"Loading more bills..."})]})}),!y&&k.length>0&&e.jsx("div",{className:"flex justify-center py-6",children:e.jsxs("p",{className:"text-gray-400 text-sm font-medium",children:[e.jsx("i",{className:"fas fa-check-circle mr-2"}),"You've reached the end of the list"]})})]})]})]})]})};export{be as default};
