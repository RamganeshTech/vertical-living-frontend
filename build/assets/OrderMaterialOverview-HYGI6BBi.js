import{u as oe,o as me,r as d,j as e,B as o,N as xe,S as q,i as H,k as Q,l as F,m as G,t as c}from"./index-DBgPBgiq.js";import{C as ue}from"./Card-wZG4gXZm.js";import{A as ge,S as he}from"./AssignStaff-Cn1HeimW.js";import{R as pe}from"./ResetStageButton-OANuO7IW.js";import{S as fe}from"./ShareDocumentWhatsapp-D8nqMXmt.js";import be from"./MaterialOverviewLoading-MdxxUrUT.js";import{u as je,a as Ne,b as ye,c as ve,d as we,e as Se,f as Ie}from"./orderMaterialHistoryApi-EAu8LXoi.js";import{G as Ce}from"./GenerateWhatsappLink-BKDXB46I.js";import"./getAllUsersApi-2Erfs-tQ.js";import"./documentationApi-qRakpMcq.js";import"./Skeleton-DujftK8I.js";const V=["nos","pieces","litre","kg","meter","feet","inch","sqft","packet","roll","sheet"],He=()=>{var A,P,U,E,T;const{projectId:n,organizationId:D}=oe(),{isMobile:z,openMobileSidebar:B}=me(),{data:a,isLoading:v,isError:b,error:m,refetch:w}=je(n),{mutateAsync:R,isPending:W}=Ne(),{mutateAsync:Y,isPending:$}=ye(),{mutateAsync:J,isPending:K}=ve(),{mutateAsync:X,isPending:Z}=we(),[x,ee]=d.useState(null),[u,S]=d.useState(""),[I,C]=d.useState(1),[g,_]=d.useState(""),[j,N]=d.useState(null),[k,h]=d.useState(""),[L,p]=d.useState(1),[y,f]=d.useState(""),M=(a==null?void 0:a.selectedUnits)||[],se=(a==null?void 0:a.totalCost)||0,O=M.length>0,{mutateAsync:te,isPending:ae}=Se(),{mutateAsync:le,isPending:re}=Ie(),ie=async s=>{var i,l;try{if(!u.trim())return;await Y({projectId:n,unitId:s,subItemName:u,quantity:I,unit:g}),S(""),C(1),_(""),c({title:"Success",description:"item created successfully"})}catch(t){c({title:"error",description:((l=(i=t==null?void 0:t.response)==null?void 0:i.data)==null?void 0:l.message)||"failed to create item",variant:"destructive"})}},ne=async s=>{var i,l;try{if(!j)return;await X({projectId:n,unitId:s,subItemId:j,subItemName:k,quantity:L,unit:y}),N(null),h(""),p(1),f(""),c({title:"Success",description:"item updated successfully"})}catch(t){c({title:"error",description:((l=(i=t==null?void 0:t.response)==null?void 0:i.data)==null?void 0:l.message)||"failed to update item",variant:"destructive"})}},de=async(s,i)=>{var l,t;try{await J({projectId:n,unitId:s,subItemId:i}),c({title:"Success",description:"item deleted successfully"})}catch(r){c({title:"error",description:((t=(l=r==null?void 0:r.response)==null?void 0:l.data)==null?void 0:t.message)||"failed to deleted item",variant:"destructive"})}},ce=async()=>{var s,i;try{await le({projectId:n}),c({description:"Completion status updated successfully",title:"Success"})}catch(l){c({title:"Error",description:((i=(s=l==null?void 0:l.response)==null?void 0:s.data)==null?void 0:i.message)||l.message||"Failed to update completion status",variant:"destructive"})}};return v?e.jsx(be,{}):(console.log("ordering matieral ",a),e.jsxs("div",{className:"w-full h-full flex flex-col",children:[e.jsxs("div",{className:"flex-shrink-0 flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-4",children:[e.jsxs("h2",{className:"text-2xl sm:text-2xl lg:text-2xl xl:text-3xl font-semibold text-blue-600 flex items-center",children:[z&&e.jsx("button",{onClick:B,className:"mr-3 p-2 rounded-md border-gray-300 hover:bg-gray-100",title:"Open Menu",children:e.jsx("i",{className:"fa-solid fa-bars"})}),e.jsx("i",{className:"fa-solid fa-cart-shopping mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Ordering Material"}),e.jsx("span",{className:"sm:hidden",children:"Order Material"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full sm:w-auto",children:[e.jsxs(o,{isLoading:re,onClick:ce,className:"bg-green-600 hover:bg-green-700 text-white w-full sm:w-auto whitespace-nowrap",children:[e.jsx("i",{className:"fa-solid fa-circle-check mr-2"}),"Mark as Complete"]}),e.jsx(pe,{projectId:n,stageNumber:8,stagePath:"orderingmaterial"}),!m&&e.jsx(fe,{projectId:n,stageNumber:"8",className:"w-full sm:w-fit",isStageCompleted:a==null?void 0:a.status}),e.jsx(ge,{stageName:"OrderMaterialHistoryModel",projectId:n,organizationId:D,currentAssignedStaff:(a==null?void 0:a.assignedTo)||null})]})]}),b&&e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"max-w-xl p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2",children:"⚠️ Error Occurred"}),e.jsx("p",{className:"text-red-500 text-sm mb-4",children:((P=(A=m==null?void 0:m.response)==null?void 0:A.data)==null?void 0:P.message)||"Failed to load ordering material"}),e.jsx(o,{isLoading:v,onClick:()=>w(),className:"bg-red-600 text-white hover:bg-red-700",children:"Retry"})]})}),!b&&e.jsxs("div",{className:"flex-1 min-h-0 overflow-y-auto space-y-4 sm:space-y-6",children:[e.jsxs(ue,{className:"p-4 w-full shadow border-l-4 border-blue-600 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-3 text-blue-700 text-sm font-medium mb-2",children:[e.jsx("i",{className:"fa-solid fa-clock text-blue-500 text-lg"}),e.jsx("span",{children:"Stage Timings"})]}),e.jsx(he,{completedAt:(U=a==null?void 0:a.timer)==null?void 0:U.completedAt,stageName:"orderingmaterial",formId:a==null?void 0:a._id,projectId:n,deadLine:(E=a==null?void 0:a.timer)==null?void 0:E.deadLine,startedAt:(T=a==null?void 0:a.timer)==null?void 0:T.startedAt,refetchStageMutate:w,deadLineMutate:te,isPending:ae})]}),!b&&e.jsxs("section",{className:"bg-white rounded-3xl shadow-[0_10px_40px_-15px_rgba(0,0,0,0.1)] overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-100 relative",children:[e.jsx("div",{className:"absolute top-0 left-0 h-full w-1.5 bg-gradient-to-b from-blue-400 to-indigo-500"}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 pl-3",children:[e.jsx("div",{children:e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Your Orders"})}),O&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-500 text-sm",children:"Total:"}),e.jsxs("span",{className:"text-xl font-bold text-blue-600",children:["₹",se.toFixed(2)]})]})]})]}),e.jsx("div",{className:"py-2 overflow-y-auto custom-scrollbar ",children:O?e.jsx("div",{className:"grid gap-5",children:M.map((s,i)=>{var l;return e.jsxs("div",{className:"group relative p-5 bg-white rounded-xl border border-gray-100 hover:border-blue-100 transition-all shadow-[0_3px_10px_rgba(0,0,0,0.02)] hover:shadow-[0_6px_20px_rgba(0,0,0,0.04)]",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-5",children:[e.jsxs("div",{className:"relative w-full md:w-32 h-32 bg-gray-50 rounded-lg overflow-hidden",children:[e.jsx("img",{src:s.image||xe,alt:s.customId||"Product image",className:"w-full h-full object-contain p-3"}),e.jsxs("div",{className:"absolute top-2 right-2 bg-blue-600 text-white text-xs font-bold px-2.5 py-1 rounded-full shadow-sm",children:["×",s.quantity]})]}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-1.5",children:s.unitName}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("span",{className:"flex cursor-pointer gap-1 items-center px-3 py-1.5 text-sm font-medium text-blue-600 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors",children:[" Total Sub Items : ",e.jsx("span",{className:"",children:((l=s==null?void 0:s.subItems)==null?void 0:l.length)||0})]}),e.jsxs("button",{onClick:()=>ee(x===s._id?null:s._id),className:"flex cursor-pointer items-center gap-2 px-3 py-1.5 text-sm font-medium text-blue-600 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors",children:[e.jsxs("span",{className:"hidden sm:inline",children:[x===s._id?"Hide":"Show"," Sub Items"]}),e.jsx("i",{className:`fa ${x===s._id?"fa-chevron-up":"fa-chevron-down"} transition-transform`})]})]})]}),e.jsx("div",{className:"flex items-center gap-2 mb-3",children:e.jsx("span",{className:"px-2.5 py-1 bg-gray-100 text-gray-700 text-xs font-medium rounded-full",children:s.category||"Generic"})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Unit Price"}),e.jsxs("p",{className:"font-medium",children:["₹",s.singleUnitCost.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Quantity"}),e.jsx("p",{className:"font-medium",children:s.quantity})]})]})]}),e.jsx("div",{className:"mt-4 pt-3 border-t border-gray-100",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Item Total"}),e.jsxs("p",{className:"text-lg font-bold text-blue-600",children:["₹",(s.singleUnitCost*s.quantity).toFixed(2)]})]})})]})]}),x===s._id&&e.jsxs("div",{className:"mt-6 pt-4 border-t border-gray-200 bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("i",{className:"fa-solid fa-list text-blue-600"}),e.jsx("h4",{className:"font-semibold text-gray-800",children:"Sub Items"})]}),s.subItems&&s.subItems.length>0?e.jsx("div",{className:"space-y-3 mb-4",children:s.subItems.map(t=>e.jsx("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between bg-white p-3 rounded-lg border border-gray-200 gap-3",children:j===t._id?e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 flex-1",children:[e.jsx("input",{type:"text",value:k,onChange:r=>h(r.target.value),placeholder:"Item name",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),e.jsx("input",{type:"number",value:L,onChange:r=>p(Number(r.target.value)),placeholder:"Qty",className:"w-full sm:w-20 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),e.jsx("div",{className:"relative cursor-pointer z-50",children:e.jsxs(q,{value:y,onValueChange:r=>f(r),children:[e.jsx(H,{className:"w-full sm:w-28 rounded-lg border-gray-300 focus:ring-2 focus:ring-blue-500",children:e.jsx(Q,{placeholder:"Unit",selectedValue:y})}),e.jsx(F,{children:V.map(r=>e.jsx(G,{value:r,children:r},r))})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(o,{variant:"primary",isLoading:Z,onClick:()=>ne(s._id),className:"px-3 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors flex items-center gap-1",children:[e.jsx("i",{className:"fa fa-save"}),e.jsx("span",{className:"hidden sm:inline",children:"Save"})]}),e.jsxs("button",{onClick:()=>{N(null),h(""),p(1),f("")},className:"px-3 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg transition-colors flex items-center gap-1",children:[e.jsx("i",{className:"fa fa-times"}),e.jsx("span",{className:"hidden sm:inline",children:"Cancel"})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-cube text-gray-400"}),e.jsx("span",{className:"font-medium text-gray-800",children:t.subItemName})]}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[e.jsx("span",{className:"font-medium",children:t.quantity})," ",t.unit]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>{N(t._id),h(t.subItemName),p(t.quantity),f(t.unit)},className:"px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors flex items-center gap-1",children:[e.jsx("i",{className:"fa fa-pencil"}),e.jsx("span",{className:"hidden sm:inline",children:"Edit"})]}),e.jsxs(o,{isLoading:K,onClick:()=>de(s._id,t._id),className:"px-3 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors flex items-center gap-1",children:[e.jsx("i",{className:"fa fa-trash"}),e.jsx("span",{className:"hidden sm:inline",children:"Delete"})]})]})]})},t._id))}):e.jsxs("div",{className:"text-center py-6 text-gray-500",children:[e.jsx("i",{className:"fa-solid fa-inbox text-2xl mb-2"}),e.jsx("p",{className:"text-sm",children:"No sub-items added yet"})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border-2 border-dashed border-gray-300",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("i",{className:"fa-solid fa-plus text-green-600"}),e.jsx("h5",{className:"font-medium text-gray-800",children:"Add New Sub Item"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx("input",{type:"text",value:u,onChange:t=>S(t.target.value),placeholder:"Sub Item Name",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),e.jsx("input",{type:"number",value:I,onChange:t=>C(Number(t.target.value)),placeholder:"Quantity",min:"1",className:"w-full sm:w-24 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),e.jsx("div",{className:"relative z-[999] ",children:e.jsxs(q,{value:g,onValueChange:t=>_(t),children:[e.jsx(H,{className:"w-full sm:w-32 rounded-lg border-gray-300 focus:ring-2 focus:ring-blue-500",children:e.jsx(Q,{placeholder:"Select unit",selectedValue:g})}),e.jsx(F,{className:"max-h-48 overflow-y-auto custom-scrollbar",children:V.map(t=>e.jsx(G,{value:t,children:t},t))})]})}),e.jsxs(o,{isLoading:$,onClick:()=>ie(s._id),disabled:!u.trim()||!g,className:"px-4 py-2 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-lg transition-colors flex items-center justify-center gap-2 whitespace-nowrap",children:[e.jsx("i",{className:"fa fa-plus"}),e.jsx("span",{className:"hidden sm:inline",children:"Add Item"})]})]})]})]})]},s._id||i)})}):e.jsxs("div",{className:"py-16 text-center",children:[e.jsx("div",{className:"mx-auto w-24 h-24 bg-blue-50 rounded-full flex items-center justify-center mb-5",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-blue-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})})}),e.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-2",children:"No Order History"}),e.jsx("p",{className:"text-gray-500 max-w-md mx-auto mb-6",children:"Your completed orders will appear here"})]})})]}),e.jsx("section",{className:"mt-4",children:e.jsx(Ce,{projectId:n,context:"order material",stage:"ordermaterial",data:a==null?void 0:a.generatedLink,isPending:W,generateLink:R})})]})]}))};export{He as default};
