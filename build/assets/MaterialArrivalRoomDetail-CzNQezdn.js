import{b as Y,a as Z,r as m,j as e,B as x,I as S,t as p}from"./index-Dre-3JFT.js";import{f as ee,g as te,h as se}from"./materialArrivalApi-D4npgdJc.js";import{i as d}from"./constants-BAzBevij.js";import{T as ae}from"./TextArea-BQUZo-0N.js";import{R as re}from"./RoomDetailLoading-CE4dlACF.js";import"./useQuery-Bz5JFwsG.js";import"./roleCheck-CIuNrpTb.js";import"./Skeleton-BL_1k5Uu.js";const ue=()=>{var z,B,T,M,P,V,O;const{projectId:h,roomKey:l,organizationId:G}=Y(),J=Z(),[E,I]=m.useState(null),[F,D]=m.useState(null),[g,y]=m.useState(null),[u,f]=m.useState({}),[v,N]=m.useState({}),[R,b]=m.useState(!1),[$,C]=m.useState(null),{data:L,isLoading:_,isError:K,error:k,refetch:w}=ee(h,l),{mutateAsync:q}=te(),{mutateAsync:U}=se();if(!l)return;if(_)return e.jsx(re,{});if(K)return e.jsxs("div",{className:"max-w-xl mx-auto mt-4 p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2",children:"⚠️ Error Occurred"}),e.jsx("p",{className:"text-red-500 text-sm mb-4",children:((B=(z=k==null?void 0:k.response)==null?void 0:z.data)==null?void 0:B.message)||"Failed to load data"}),e.jsx(x,{onClick:()=>w(),className:"bg-red-600 text-white px-4 py-2",children:"Retry"})]});const A=L||[],W=(t,a)=>{f(s=>({...s,[t]:a}))},H=async()=>{var t,a;try{const s=d[l];if(!s||s.length===0)throw new Error("No required fields defined for this section.");const i=s[0],r=u[i];if(!r||r.toString().trim()==="")throw new Error(`The field "${i}" is required.`);if(s.every(c=>{const n=u[c];return!n||n.toString().trim()===""}))throw new Error("At least one field must be filled.");const o=new FormData;o.append("itemData",JSON.stringify(u)),F&&o.append("upload",F),await q({projectId:h,roomKey:l,formData:o}),p({title:"Success",description:"Item updated successfully"}),y(null),f({}),D(null),w()}catch(s){p({title:"Error",description:((a=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:a.message)||s.message||"Failed to update",variant:"destructive"})}},Q=async()=>{var t,a;try{const s=d[l];if(!s||s.length===0)throw new Error("No required fields defined for this section.");const i=s[0],r=v[i];if(!r||r.toString().trim()==="")throw new Error(`The field "${i}" is required.`);if(s.every(c=>{const n=v[c];return!n||n.toString().trim()===""}))throw new Error("At least one field must be filled.");const o=new FormData;o.append("itemData",JSON.stringify(v)),E&&o.append("upload",E),await q({projectId:h,roomKey:l,formData:o}),p({title:"Success",description:"Item added successfully"}),b(!1),N({}),w(),I(null)}catch(s){p({title:"Error",description:((a=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:a.message)||s.message||"Failed to add item",variant:"destructive"})}},X=async t=>{try{await U({projectId:h,roomKey:l,itemId:t}),p({title:"Deleted",description:"Item removed"}),w()}catch(a){p({title:"Error",description:(a==null?void 0:a.message)||"Failed",variant:"destructive"})}};return e.jsxs("div",{className:"w-full h-full",children:[e.jsxs("div",{className:"w-full flex justify-between items-center",children:[e.jsxs("h2",{className:"text-xl font-bold text-blue-800 capitalize",children:[e.jsx("span",{className:"text-black font-semibold",children:"Section:"})," ",l]}),e.jsx(x,{variant:"primary",className:"h-10",onClick:()=>J(`/${G}/projectdetails/${h}/materialarrival`),children:"Go Back"})]}),e.jsx("div",{className:"w-full overflow-x-auto roundex-lg mt-2 custom-scrollbar",children:e.jsxs("div",{style:{minWidth:`${(((T=d[l])==null?void 0:T.length)+1)*190}px`},children:[e.jsxs("div",{className:"grid gap-2 bg-blue-100 text-blue-800 text-xs font-semibold uppercase px-4 py-2",style:{gridTemplateColumns:`repeat(${((M=d[l])==null?void 0:M.length)+1}, minmax(120px, 1fr))`},children:[(P=d[l])==null?void 0:P.map((t,a)=>e.jsx("div",{className:"text-center",children:t==="verifiedByAccountant"?"Verified":t},a)),e.jsx("div",{className:"text-center",children:"Actions"})]}),A==null?void 0:A.map((t,a)=>{var s,i;return e.jsxs("div",{className:"grid gap-2 px-4 py-2 items-center hover:bg-gray-50",style:{gridTemplateColumns:`repeat(${((s=d[l])==null?void 0:s.length)+1}, minmax(120px, 1fr))`},children:[(i=d[l])==null?void 0:i.map((r,j)=>{var o;return r==="image"?e.jsx("div",{className:"flex justify-center items-center",children:g===a?e.jsx(S,{type:"file",accept:"image/*",onChange:c=>{var n;return D(((n=c.target.files)==null?void 0:n[0])||null)},className:"text-xs"}):(o=t==null?void 0:t.upload)!=null&&o.url?e.jsx("div",{className:"w-10 h-10 cursor-pointer",onClick:()=>C(t.upload.url),children:e.jsx("img",{src:t.upload.url,alt:"Preview",className:"w-full h-full object-cover rounded border shadow"})}):e.jsx("span",{className:"text-xs text-gray-500",children:"No Image"})},j):r==="verifiedByAccountant"?e.jsx("div",{className:"text-center",children:g===a?e.jsx("input",{type:"checkbox",checked:!!u[r],onChange:c=>f(n=>({...n,[r]:c.target.checked}))}):t[r]?e.jsx("i",{className:"fas fa-check text-blue-600 text-lg"}):e.jsx("i",{className:"fas fa-times text-red-500 text-lg"})},j):r==="remarks"?g===a?e.jsx(ae,{value:u[r]||"",className:"text-sm",onChange:c=>f(n=>({...n,remarks:c.target.value}))},r):e.jsx("div",{className:"text-sm text-center px-2 overflow-x-auto max-w-[150px] custom-scrollbar whitespace-nowrap",children:t[r]}):e.jsx("div",{className:"text-sm text-center px-2 max-w-[140px] overflow-auto whitespace-nowrap",children:g===a?e.jsx(S,{className:"text-xs w-full",value:u[r]||"",onChange:c=>W(r,c.target.value)}):t[r]||"-"},j)}),e.jsx("div",{className:"flex justify-center gap-2 text-lg",children:g===a?e.jsxs(e.Fragment,{children:[e.jsx(x,{size:"sm",onClick:H,children:"Save"}),e.jsx(x,{size:"sm",variant:"ghost",onClick:()=>y(null),children:"Cancel"})]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-pen text-blue-600 cursor-pointer",onClick:()=>{f(t),y(a)}}),e.jsx("i",{className:"fas fa-trash text-red-500 cursor-pointer",onClick:()=>X(t._id)})]})})]},t._id)}),R&&e.jsxs("div",{className:"grid gap-2 px-4 py-2  bg-blue-50 items-center",style:{gridTemplateColumns:`repeat(${((V=d[l])==null?void 0:V.length)+1}, minmax(120px, 1fr))`},children:[(O=d[l])==null?void 0:O.map((t,a)=>t==="image"?e.jsx("input",{type:"file",accept:"image/*",className:"text-xs w-full",onChange:s=>{var i;return I(((i=s.target.files)==null?void 0:i[0])||null)}},a):t==="verifiedByAccountant"?e.jsx("input",{type:"checkbox",checked:!!v[t],onChange:s=>N(i=>({...i,[t]:s.target.checked}))},a):e.jsx(S,{className:"text-xs text-center w-full",placeholder:t,value:v[t]||"",onChange:s=>N(i=>({...i,[t]:s.target.value}))},a)),e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx(x,{size:"sm",onClick:Q,children:"Add"}),e.jsx(x,{size:"sm",variant:"ghost",onClick:()=>b(!1),children:"Cancel"})]})]}),!R&&e.jsx("div",{className:"py-4 px-4",children:e.jsx(x,{onClick:()=>b(!0),children:"Add Item"})})]})}),$&&e.jsx("div",{onClick:()=>C(null),className:"fixed inset-0 bg-black/70 bg-opacity-60 z-50 flex items-center justify-center",children:e.jsxs("div",{onClick:t=>t.stopPropagation,className:"relative bg-white rounded p-4 sm:p-8 shadow-lg max-w-[90vw] max-h-[80vh]",children:[e.jsx("i",{className:"fas fa-times absolute top-[0px] right-1 sm:top-2 sm:right-3 text-xl sm:text-2xl cursor-pointer text-gray-700 hover:text-red-500",onClick:()=>C(null)}),e.jsx("img",{src:$,alt:"Full View",className:"max-h-[70vh] max-w-[100%] sm:max-w-full object-contain rounded"})]})})]})};export{ue as default};
