import{r as l,j as e,X as Qe,u as De,a as _e,b as Ve,R as qe,B as Ue,M as We,t as Pe}from"./index-MXS_gbde.js";import{b as He,c as Be,d as ze}from"./quoteVariantApi-DV1NXuB1.js";import{S as te}from"./SearchSelect-CSYESWNf.js";import{C as fe}from"./Card-L4jLwmC3.js";import{c as Ke,u as Xe}from"./labourRateconfigApi-C3VsaBeF.js";import{S as $e}from"./SearchSelectNew-C8k-FWEO.js";const re=(C,E,d)=>{const u=String(C).toLowerCase().replace("mm","").trim(),G=E.find(F=>String(F.thickness).toLowerCase().replace("mm","").trim()===u);return(G==null?void 0:G.rs)!==void 0?G.rs:d==="laminate"?Ye:0},Je=l.forwardRef((C,E)=>{const{data:d,index:u,brandOptions:G,innerOptions:F,outerOptions:ye,innerLaminateRatesByBrand:se,outerLaminateRatesByBrand:ae,brandRatesByName:K,labourCost:ne,selectedBrand:L,selectedInnerBrand:Q,selectedOuterBrand:N,onFurnitureChange:X,globalProfitPercent:$,onProfitOverride:O}=C,[j,oe]=l.useState(L),[P,me]=l.useState(Q),[B,xe]=l.useState(N),[h,le]=l.useState((d==null?void 0:d.coreMaterials)||[]),[w,ce]=l.useState((d==null?void 0:d.fittingsAndAccessories)||[]),[M,D]=l.useState((d==null?void 0:d.glues)||[]),[_,J]=l.useState((d==null?void 0:d.nonBrandMaterials)||[]),ie=l.useRef(L),I=l.useRef(Q),pe=l.useRef(N);l.useEffect(()=>{ie.current!==L&&(oe(L),ie.current=L)},[L]),l.useEffect(()=>{I.current!==Q&&(me(Q),I.current=Q)},[Q]),l.useEffect(()=>{pe.current!==N&&(xe(N),pe.current=N)},[N]),l.useEffect(()=>{le((d==null?void 0:d.coreMaterials)||[]),ce((d==null?void 0:d.fittingsAndAccessories)||[]),D((d==null?void 0:d.glues)||[]),J((d==null?void 0:d.nonBrandMaterials)||[])},[d]);const de=(r,m)=>{var n,x,y,c,i;const b=j?K[j]||[]:[],g=P?se[P]||[]:[],f=B?ae[B]||[]:[],R=re(r.plywoodNos.thickness,b,"plywood"),S=re(((n=r.innerLaminate)==null?void 0:n.thickness)||0,g,"laminate"),p=re(((x=r.outerLaminate)==null?void 0:x.thickness)||0,f,"laminate"),ue=32,Ne=(((y=r.plywoodNos)==null?void 0:y.quantity)||0)*R*ue,je=(((c=r.innerLaminate)==null?void 0:c.quantity)||0)*S*ue,ve=(((i=r.outerLaminate)==null?void 0:i.quantity)||0)*p*ue,he=Ne+je+ve,we=he*((r.profitOnMaterial||0)/100),ee=m.length,T=m[0],ge=((T==null?void 0:T.carpenters)||0)*((T==null?void 0:T.days)||0)*ne*(1+((T==null?void 0:T.profitOnLabour)||0)/100),a=ee>0?ge/ee:0,t=ee>0?(d.fabricationCost||0)/ee:0,s=1+((d.furnitureProfit??$)||0)/100;return(he+we+a+t)*s},V=h.reduce((r,m)=>r+de(m,h),0),Y=1+((d.furnitureProfit??$)||0)/100,A=(r,m=!1)=>{const b=m?r.cost||0:(r.quantity||0)*(r.cost||0),g=b*((r.profitOnMaterial||0)/100);return(b+g)*Y},Z=w.reduce((r,m)=>r+A(m),0),q=M.reduce((r,m)=>r+A(m,!0),0),U=_.reduce((r,m)=>r+A(m),0),W=V+Z+q+U;l.useImperativeHandle(E,()=>({getUpdatedFurniture:()=>{const r=h.map(S=>({...S,rowTotal:Math.round(de(S,h))})),m=Math.round(V),b=Math.round(Z),g=Math.round(q),f=Math.round(U),R=Math.round(W);return{...d,plywoodBrand:j,innerLaminateBrand:P,outerLaminateBrand:B,furnitureProfit:d.furnitureProfit,coreMaterials:r,coreMaterialsTotal:m,fittingsAndAccessoriesTotal:b,gluesTotal:g,nonBrandMaterialsTotal:f,furnitureTotal:R,totals:{core:V,fittings:Z,glues:q,nbms:U,furnitureTotal:W}}}})),l.useEffect(()=>{X()},[j,P,B]);const k=(r,m,b)=>e.jsxs("div",{className:"mt-6",children:[e.jsxs("h3",{className:"font-semibold text-md mb-2 text-gray-800",children:[r," - Total: ₹",Math.round(b==="Fittings"?Z:b==="Glues"?q:U).toLocaleString("en-IN")]}),e.jsxs("table",{className:"min-w-full text-sm bg-white shadow-sm border border-gray-200",children:[e.jsx("thead",{className:"bg-blue-50 text-sm font-semibold text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 border-r",children:"Item Name"}),e.jsx("th",{className:"px-6 py-3 border-r",children:"Description"}),e.jsx("th",{className:"px-6 py-3 border-r",children:"Quantity"}),e.jsx("th",{className:"px-6 py-3 border-r",children:"Cost"}),e.jsx("th",{className:"px-6 py-3 border-r",children:"Profit %"}),e.jsx("th",{className:"px-6 py-3",children:"Total"})]})}),e.jsx("tbody",{children:m.map((g,f)=>e.jsxs("tr",{className:"border-t hover:bg-gray-50",children:[e.jsx("td",{className:"p-2 border-r text-center",children:g.itemName||"—"}),e.jsx("td",{className:"p-2 border-r text-center",children:g.description||"—"}),e.jsx("td",{className:"p-2 border-r text-center",children:g.quantity}),e.jsxs("td",{className:"p-2 border-r text-center",children:["₹",g.cost]}),e.jsx("td",{className:"p-2 border-r text-center",children:e.jsx("input",{type:"number",value:g.profitOnMaterial||0,onChange:R=>{const S=parseFloat(R.target.value)||0;if(b==="Fittings"){const p=[...w];p[f].profitOnMaterial=S,ce(p)}else if(b==="Glues"){const p=[...M];p[f].profitOnMaterial=S,D(p)}else{const p=[..._];p[f].profitOnMaterial=S,J(p)}X()},className:"w-16 text-center border border-blue-200 rounded py-1 font-semibold"})}),e.jsxs("td",{className:"p-2 text-center font-bold text-green-700",children:["₹",Math.round(A(g,b==="Glues")).toLocaleString("en-IN")]})]},f))})]})]});return e.jsxs("div",{className:"shadow-lg p-6 my-6 border rounded-xl bg-white",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h2",{className:"text-2xl font-bold text-blue-700",children:["Product ",u+1,": ",d.furnitureName]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("section",{className:"flex flex-col items-end",children:[e.jsx("label",{className:"text-[10px] font-bold text-blue-500 uppercase tracking-tighter",children:"Product Profit Override (%)"}),e.jsxs("div",{className:"flex items-center bg-blue-50 px-3 py-1 rounded-lg border border-blue-100 shadow-sm",children:[e.jsx("input",{type:"number",className:"w-14 text-right font-black bg-transparent outline-none text-blue-800",value:d.furnitureProfit??"",placeholder:$.toString(),onChange:r=>{const m=r.target.value===""?0:parseFloat(r.target.value);O(m)}}),e.jsx("span",{className:"ml-1 text-blue-600 font-black text-sm",children:"%"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-[10px] font-bold text-green-500 uppercase",children:"Grand Product Total"}),e.jsxs("p",{className:"text-2xl font-black text-green-600",children:["₹",Math.round(W).toLocaleString("en-IN")]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-6 mb-6 p-4 bg-gray-50 rounded-xl border border-gray-100 shadow-inner",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-extrabold text-gray-400 uppercase mb-1 block",children:"Plywood Brand"}),e.jsx(te,{options:G,onSelect:oe,selectedValue:j||""})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-extrabold text-blue-400 uppercase mb-1 block",children:"Inner Laminate Brand"}),e.jsx(te,{options:F,onSelect:me,selectedValue:P||""})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-extrabold text-orange-400 uppercase mb-1 block",children:"Outer Laminate Brand"}),e.jsx(te,{options:ye,onSelect:xe,selectedValue:B||""})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"border border-gray-200 bg-white rounded-lg shadow-sm p-3",children:[e.jsxs("h3",{className:"text-[11px] font-bold text-gray-500 uppercase mb-2 flex justify-between",children:["Plywood Rates: ",e.jsx("span",{className:"text-blue-600",children:j||"None"})]}),e.jsx("div",{className:"max-h-[150px] overflow-y-auto border-t border-gray-100 pt-2",children:e.jsx("table",{className:"min-w-full text-[11px]",children:e.jsx("tbody",{children:(j?K[j]:[]).map((r,m)=>e.jsxs("tr",{className:"border-b border-gray-50 last:border-0 hover:bg-gray-50",children:[e.jsxs("td",{className:"py-1 text-gray-600 font-medium",children:[r.thickness," mm"]}),e.jsxs("td",{className:"py-1 text-right font-bold text-green-700",children:["₹",r.rs.toFixed(2)]})]},m))})})})]}),e.jsxs("div",{className:"border border-blue-100 bg-white rounded-lg shadow-sm p-3",children:[e.jsxs("h3",{className:"text-[11px] font-bold text-blue-500 uppercase mb-2 flex justify-between",children:["Inner Rates: ",e.jsx("span",{className:"text-blue-700",children:P||"None"})]}),e.jsx("div",{className:"max-h-[150px] overflow-y-auto border-t border-blue-50 pt-2",children:e.jsx("table",{className:"min-w-full text-[11px]",children:e.jsx("tbody",{children:(P?se[P]:[]).map((r,m)=>e.jsxs("tr",{className:"border-b border-gray-50 last:border-0 hover:bg-blue-50/30",children:[e.jsxs("td",{className:"py-1 text-gray-600 font-medium",children:[r.thickness," mm"]}),e.jsxs("td",{className:"py-1 text-right font-bold text-blue-700",children:["₹",r.rs.toFixed(2)]})]},m))})})})]}),e.jsxs("div",{className:"border border-orange-100 bg-white rounded-lg shadow-sm p-3",children:[e.jsxs("h3",{className:"text-[11px] font-bold text-orange-500 uppercase mb-2 flex justify-between",children:["Outer Rates: ",e.jsx("span",{className:"text-orange-700",children:B||"None"})]}),e.jsx("div",{className:"max-h-[150px] overflow-y-auto border-t border-orange-50 pt-2",children:e.jsx("table",{className:"min-w-full text-[11px]",children:e.jsx("tbody",{children:(B?ae[B]:[]).map((r,m)=>e.jsxs("tr",{className:"border-b border-gray-50 last:border-0 hover:bg-orange-50/30",children:[e.jsxs("td",{className:"py-1 text-gray-600 font-medium",children:[r.thickness," mm"]}),e.jsxs("td",{className:"py-1 text-right font-bold text-orange-700",children:["₹",r.rs.toFixed(2)]})]},m))})})})]})]}),e.jsx("div",{className:"overflow-x-auto rounded-lg border border-gray-200 shadow-sm",children:e.jsxs("table",{className:"min-w-full text-sm text-center",children:[e.jsxs("thead",{className:"bg-blue-50 text-gray-600 font-bold",children:[e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 border-r border-gray-200",rowSpan:2,children:"Image"}),e.jsx("th",{className:"px-4 py-3 border-r border-gray-200",rowSpan:2,children:"Item Name"}),e.jsx("th",{className:"px-4 py-1 border-r border-gray-200",colSpan:2,children:"Plywood"}),e.jsx("th",{className:"px-4 py-1 border-r border-gray-200",colSpan:4,children:"Laminate"}),e.jsx("th",{className:"px-4 py-3 border-r border-gray-200",rowSpan:2,children:"Carpenters/Day"}),e.jsx("th",{className:"px-4 py-3 border-r border-gray-200",rowSpan:2,children:"Days"}),e.jsx("th",{className:"px-4 py-3 border-r border-gray-200",rowSpan:2,children:"Profit % Material"}),e.jsx("th",{className:"px-4 py-3 border-r border-gray-200",rowSpan:2,children:"Profit % Labour"}),e.jsx("th",{className:"px-4 py-3 border-r border-gray-200",rowSpan:2,children:"Remarks"}),e.jsx("th",{className:"px-4 py-3",rowSpan:2,children:"Row Total"})]}),e.jsxs("tr",{className:"border-t border-gray-200 bg-blue-50/50",children:[e.jsx("th",{className:"px-2 py-2 text-[10px] uppercase border-r border-gray-200",children:"Qty"}),e.jsx("th",{className:"px-2 py-2 text-[10px] uppercase border-r border-gray-200",children:"Thk"}),e.jsx("th",{className:"px-2 py-2 text-[10px] uppercase border-r border-gray-200",children:"Inner Qty"}),e.jsx("th",{className:"px-2 py-2 text-[10px] uppercase border-r border-gray-200",children:"Inner Thk"}),e.jsx("th",{className:"px-2 py-2 text-[10px] uppercase border-r border-gray-200",children:"Outer Qty"}),e.jsx("th",{className:"px-2 py-2 text-[10px] uppercase border-r border-gray-200",children:"Outer Thk"})]})]}),e.jsx("tbody",{children:h.map((r,m)=>{var b,g,f,R;return e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50/50 transition-colors",children:[m===0&&e.jsx("td",{rowSpan:h.length,className:"p-2 border-r border-gray-100 bg-white",children:e.jsx("img",{src:r.imageUrl||Qe,className:"h-12 mx-auto rounded shadow-sm"})}),e.jsx("td",{className:"p-2 border-r border-gray-100 font-medium",children:r.itemName||"—"}),e.jsx("td",{className:"p-2 border-r border-gray-100 bg-gray-50 text-gray-500 font-mono",children:r.plywoodNos.quantity}),e.jsx("td",{className:"p-2 border-r border-gray-100 bg-gray-50 text-gray-500 font-mono",children:r.plywoodNos.thickness}),e.jsx("td",{className:"p-2 border-r border-gray-100 bg-gray-50 text-gray-500 font-mono",children:((b=r.innerLaminate)==null?void 0:b.quantity)||0}),e.jsx("td",{className:"p-2 border-r border-gray-100 bg-gray-50 text-gray-500 font-mono",children:((g=r.innerLaminate)==null?void 0:g.thickness)||0}),e.jsx("td",{className:"p-2 border-r border-gray-100 bg-gray-50 text-gray-500 font-mono",children:((f=r.outerLaminate)==null?void 0:f.quantity)||0}),e.jsx("td",{className:"p-2 border-r border-gray-100 bg-gray-50 text-gray-500 font-mono",children:((R=r.outerLaminate)==null?void 0:R.thickness)||0}),m===0&&e.jsxs(e.Fragment,{children:[e.jsx("td",{rowSpan:h.length,className:"p-2 border-r border-gray-100 bg-gray-50 text-gray-500 font-mono",children:r.carpenters}),e.jsx("td",{rowSpan:h.length,className:"p-2 border-r border-gray-100 bg-gray-50 text-gray-500 font-mono",children:r.days})]}),e.jsx("td",{className:"p-2 border-r border-gray-100",children:e.jsx("input",{type:"number",value:r.profitOnMaterial,onChange:S=>{const p=[...h];p[m].profitOnMaterial=parseFloat(S.target.value)||0,le(p),X()},className:"w-16 border border-blue-100 rounded text-center py-1 font-semibold focus:ring-1 focus:ring-blue-400 outline-none"})}),m===0&&e.jsx("td",{rowSpan:h.length,className:"p-2 border-r border-gray-100",children:e.jsx("input",{type:"number",value:r.profitOnLabour,onChange:S=>{const p=[...h];p[0].profitOnLabour=parseFloat(S.target.value)||0,le(p),X()},className:"w-16 border border-blue-100 rounded text-center py-1 font-semibold focus:ring-1 focus:ring-blue-400 outline-none"})}),e.jsx("td",{className:"p-2 border-r border-gray-100 text-gray-400 text-[11px] italic",children:r.remarks||"—"}),e.jsxs("td",{className:"p-2 font-bold text-green-600",children:["₹",Math.round(de(r,h)).toLocaleString("en-IN")]})]},m)})})]})}),k("Fittings & Accessories",w,"Fittings"),k("Glues",M,"Glues"),k("Non-Branded Materials",_,"NBMs")]})}),Ye=0,nt=()=>{var T,Me,ge;const{organizationId:C,quoteId:E}=De(),d=_e(),{data:u,isLoading:G}=He(C,E);let{data:F,isLoading:ye}=Be(C,"plywood"),{data:se}=Be(C,"inner laminate"),{data:ae}=Be(C,"outer laminate");const[K,ne]=l.useState({categoryId:"",categoryName:""});let{data:L=0}=Ke({organizationId:C,categoryId:K.categoryId}),{data:Q=[]}=Xe(C);const N=(Q||[]).map(a=>({value:a._id,label:a.name})),{mutateAsync:X,isPending:$}=ze(),O=l.useRef([]),[j,oe]=l.useState(null),[P,me]=l.useState(null),[B,xe]=l.useState(null),[h,le]=l.useState(0),[w,ce]=l.useState(0);l.useEffect(()=>{u&&(le((u==null?void 0:u.globalTransportation)||0),ce((u==null?void 0:u.globalProfitPercent)||0),J((u==null?void 0:u.commonProfitOverride)||0))},[u]);const[M,D]=l.useState([]),[_,J]=l.useState(0);l.useEffect(()=>{u!=null&&u.commonMaterials&&D(u.commonMaterials)},[u]);const{role:ie,permission:I}=Ve(),pe=ie==="owner"||((T=I==null?void 0:I.quotevariant)==null?void 0:T.create),de=ie==="owner"||((Me=I==null?void 0:I.quotevariant)==null?void 0:Me.edit),V=a=>{if(!a)return{};const t={};return a.forEach(o=>{var c,i;const s=(o==null?void 0:o.data)||{},n=(c=s.Brand??s.brand)==null?void 0:c.trim(),x=(i=String(s["thickness (mm)"]||s.thickness||s.Thickness))==null?void 0:i.trim(),y=parseFloat(s.Rs||s.rs||s.rS);n&&x&&y&&(t[n]||(t[n]=[]),t[n].push({thickness:x,rs:y}))}),t},be=l.useMemo(()=>V(F),[F]),Y=l.useMemo(()=>V(se),[se]),A=l.useMemo(()=>V(ae),[ae]),Z=l.useMemo(()=>Object.keys(be),[be]),q=l.useMemo(()=>Object.keys(Y),[Y]),U=l.useMemo(()=>Object.keys(A),[A]),W=l.useMemo(()=>{if(!F)return{};const a={};return F.forEach(t=>{const o=(t==null?void 0:t.data)||{},s=o.Brand??o.brand,n=o["thickness (mm)"]||o.thickness||o.Thickness;let x=o.Rs||o.rs;if(s&&n&&x){const y=String(s).trim(),c=String(n).trim(),i=parseFloat(x);a[y]||(a[y]=[]),a[y].push({thickness:c,rs:i})}}),a},[F]),k=l.useMemo(()=>Object.keys(W),[W]),[r,m]=l.useState([]),[b,g]=l.useState(0),[f,R]=l.useState(0),S=(a,t)=>{m(o=>{const s=[...o],n=s[a];return s[a]={...n,furnitureProfit:t,coreMaterials:n.coreMaterials.map(x=>({...x,profitOnMaterial:0,profitOnLabour:0})),fittingsAndAccessories:n.fittingsAndAccessories.map(x=>({...x,profitOnMaterial:0})),nonBrandMaterials:n.nonBrandMaterials.map(x=>({...x,profitOnMaterial:0}))},s}),setTimeout(()=>p(),0)},p=()=>{const t=O.current.map(n=>n.current).filter(n=>n!==null).map(n=>n.getUpdatedFurniture()).reduce((n,x)=>n+x.totals.furnitureTotal,0),o=M.reduce((n,x)=>n+(x.rowTotal||0),0),s=Math.round(t+o);g(s),R(ve())},ue=a=>{const t=N.find(o=>o.value===a);ne(t?{categoryId:t.value,categoryName:t.label}:{categoryId:"",categoryName:""})},{profitDifference:Ne,profitPercentage:je}=l.useMemo(()=>{const a=b-f,t=f>0?a/f*100:0;return{profitDifference:Math.round(a),profitPercentage:t}},[b,f]),ve=()=>{const a=O.current.map(s=>s.current).filter(s=>s!==null).map(s=>s.getUpdatedFurniture()),t=32;let o=0;return a.forEach(s=>{const n=s.plywoodBrand?W[s.plywoodBrand]||[]:[],x=s.innerLaminateBrand?Y[s.innerLaminateBrand]||[]:[],y=s.outerLaminateBrand?A[s.outerLaminateBrand]||[]:[],c=s.coreMaterials,i=c[0],H=((i==null?void 0:i.carpenters)||0)*((i==null?void 0:i.days)||0)*L,Se=c.length>0?H/c.length:0,Ce=c.length>0?(s.fabricationCost||0)/c.length:0;c.forEach(v=>{var Le,Oe,ke,Re;const z=re(v.plywoodNos.thickness,n,"plywood"),Fe=re(((Le=v.innerLaminate)==null?void 0:Le.thickness)||0,x,"laminate"),Ie=re(((Oe=v.outerLaminate)==null?void 0:Oe.thickness)||0,y,"laminate"),Ae=v.plywoodNos.quantity*(z*t),Ee=(((ke=v.innerLaminate)==null?void 0:ke.quantity)||0)*(Fe*t),Ge=(((Re=v.outerLaminate)==null?void 0:Re.quantity)||0)*(Ie*t);o+=Ae+Ee+Ge+Se+Ce});const Te=v=>(v.quantity||0)*(v.cost||0);o+=s.fittingsAndAccessories.reduce((v,z)=>v+Te(z),0),o+=s.glues.reduce((v,z)=>v+(z.cost||0),0),o+=s.nonBrandMaterials.reduce((v,z)=>v+Te(z),0)}),o+=M.reduce((s,n)=>s+(n.quantity||0)*(n.cost||0),0),Math.round(o)},he=(a,t)=>{const s=r.reduce((c,i)=>c+i.coreMaterials.length+i.fittingsAndAccessories.length+i.glues.length+i.nonBrandMaterials.length,0)+M.length,n=s>0?h/s:0,y=1+(_??w)/100;D(c=>{const i=[...c],H=i[a],Se=(H.quantity||0)*(H.cost||0),Ce=t>0?1+t/100:y;return i[a]={...H,profitOnMaterial:t,rowTotal:Math.round(Se*Ce+n)},i}),setTimeout(()=>p(),0)},we=()=>e.jsx("div",{className:"overflow-x-auto rounded-xl border border-gray-200 shadow-sm",children:e.jsxs("table",{className:"min-w-full text-sm bg-white",children:[e.jsx("thead",{className:"bg-blue-50 text-blue-800 font-bold uppercase text-[11px]",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Item Name"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Description"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Quantity"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Cost"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Profit %"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Total"})]})}),e.jsx("tbody",{children:M.map((a,t)=>{var o,s;return e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-blue-50/20 transition-colors",children:[e.jsx("td",{className:"p-3 border-r border-gray-100 text-center font-medium text-gray-700",children:a.itemName||"—"}),e.jsx("td",{className:"p-3 border-r border-gray-100 text-center text-gray-500",children:a.description||"—"}),e.jsx("td",{className:"p-3 border-r border-gray-100 text-center  text-gray-500",children:a.quantity}),e.jsxs("td",{className:"p-3 border-r border-gray-100 text-center  text-gray-500",children:["₹",(o=a.cost)==null?void 0:o.toLocaleString("en-IN")]}),e.jsx("td",{className:"p-3 border-r border-gray-100 text-center ",children:e.jsx("input",{type:"number",value:a.profitOnMaterial||0,onKeyDown:n=>{(n.key==="-"||n.key==="e")&&n.preventDefault()},onChange:n=>{const x=Math.max(0,parseFloat(n.target.value)||0);he(t,x)},className:"w-16 text-center border border-blue-200 rounded py-1 font-semibold  outline-none focus:ring-1 focus:ring-blue-400"})}),e.jsxs("td",{className:"p-3 text-center font-black text-green-700 bg-green-50/20",children:["₹",(s=a.rowTotal)==null?void 0:s.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})]})]},t)})})]})});l.useEffect(()=>{if(console.log("is it getting called here "),!r.length)return;const t=r.reduce((c,i)=>c+i.coreMaterials.length+i.fittingsAndAccessories.length+i.glues.length+i.nonBrandMaterials.length,0)+M.length,o=t>0?h/t:0,s=r.map(c=>{if(c.coreMaterials.length===0)return c;const i=w??c.furnitureProfit??0;return{...c,furnitureProfit:i}}),x=1+(_??w)/100,y=M.map(c=>{const i=(c.quantity||0)*(c.cost||0),H=(c.profitOnMaterial||0)>0?i*(1+(c.profitOnMaterial||0)/100):i*x;return{...c,rowTotal:H+o}});m(s),D(y),setTimeout(()=>p(),0)},[h,w,L,M.length,_]);const ee=async()=>{var a,t;try{if(!C||!E||!u||!j){Pe({title:"Missing info",description:"Please ensure brand and all details are selected",variant:"destructive"});return}const o=O.current.map(c=>c.current).filter(c=>c!==null).map(c=>c.getUpdatedFurniture()),s=o.reduce((c,i)=>c+i.totals.furnitureTotal,0),n=M.map(c=>({...c,rowTotal:Math.round(c.rowTotal||0)})),x=n.reduce((c,i)=>c+i.rowTotal,0),y=Math.round(s+x)||0;await X({quoteId:E,organizationId:C,data:{quoteId:E,organizationId:C,projectId:u.projectId,brandName:j,innerLaminateBrand:P,outerLaminateBrand:B,commonMaterials:n,globalTransportation:h,globalProfitPercent:w,furnitures:o,grandTotal:y,notes:"Generated with brand variant"}}),Pe({title:"success",description:"Successfully created, check it in the Quote for clients section"})}catch(o){Pe({title:"Error",description:((t=(a=o==null?void 0:o.response)==null?void 0:a.data)==null?void 0:t.message)??"Operation failed",variant:"destructive"})}};return l.useEffect(()=>{if(!(u!=null&&u.furnitures))return;const a=u.furnitures.map(t=>({furnitureName:t.furnitureName,coreMaterials:t.coreMaterials||[],fittingsAndAccessories:t.fittingsAndAccessories||[],glues:t.glues||[],nonBrandMaterials:t.nonBrandMaterials||[],totals:{core:t.coreMaterialsTotal||0,fittings:t.fittingsAndAccessoriesTotal||0,glues:t.gluesTotal||0,nbms:t.nonBrandMaterialsTotal||0,furnitureTotal:t.furnitureTotal||0},plywoodBrand:j,innerLaminateBrand:P,outerLaminateBrand:B}));m(a)},[u]),O.current.length!==r.length&&(O.current=r.map((a,t)=>O.current[t]??qe.createRef())),l.useEffect(()=>{O.current=r.map((a,t)=>O.current[t]??l.createRef())},[r]),l.useEffect(()=>{!j&&(k==null?void 0:k.length)>0&&oe(k[0])},[k]),l.useEffect(()=>{var a,t;K.categoryId===""&&(N==null?void 0:N.length)>0&&ne({categoryId:(a=N[0])==null?void 0:a.value,categoryName:(t=N[0])==null?void 0:t.label})},[N]),e.jsxs("div",{className:"p-2 max-h-full overflow-y-auto",children:[e.jsxs("header",{className:"bg-white border-b border-gray-200 pb-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("button",{onClick:()=>d(-1),className:"flex items-center justify-center w-8 h-8 bg-gray-50 hover:bg-gray-100 border border-gray-300 rounded-md transition-colors flex-shrink-0",children:e.jsx("i",{className:"fas fa-arrow-left text-gray-600 text-sm"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900 truncate",children:((ge=u==null?void 0:u.projectId)==null?void 0:ge.projectName)||"Project"}),e.jsx("p",{className:"text-md text-gray-500",children:u!=null&&u.quoteNo?`Quote: #${u==null?void 0:u.quoteNo}`:""})]})]}),(pe||de)&&e.jsx(Ue,{onClick:ee,disabled:$,className:"flex-shrink-0",children:$?"Generating...":"Generate Quote for Client"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 bg-gray-50 p-3 rounded-xl border border-gray-200",children:[e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"text-[10px] font-bold text-gray-500 uppercase",children:"Plywood Brand"}),e.jsx(te,{options:k,placeholder:"Select Plywood",onSelect:oe,selectedValue:j||""})]}),e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"text-[10px] font-bold text-blue-600 uppercase",children:"Inner Laminate"}),e.jsx(te,{options:q,placeholder:"Select Inner Brand",onSelect:me,selectedValue:P||""})]}),e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"text-[10px] font-bold text-orange-600 uppercase",children:"Outer Laminate"}),e.jsx(te,{options:U,placeholder:"Select Outer Brand",onSelect:xe,selectedValue:B||""})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 whitespace-nowrap",children:"Select Salary Category"}),e.jsx($e,{options:N,placeholder:"Choose Labour Category",searchPlaceholder:"Search by name...",value:K.categoryId,onValueChange:ue,searchBy:"name",displayFormat:"detailed",className:"flex-1"})]})]}),e.jsxs("div",{className:" grid grid-cols-4 gap-2",children:[e.jsx(fe,{className:"px-2 py-4 border-l-4 border-blue-600",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-md text-gray-600",children:["Project Cost "," "," ",e.jsx("span",{className:"font-bold",children:"(without profit)"})]}),e.jsxs("p",{className:"text-md font-bold text-blue-600",children:["₹",f.toLocaleString("en-IN")]})]})}),e.jsx(fe,{className:"px-2 py-4 border-l-4 border-green-600",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-md text-gray-600",children:["Client Quote Amount "," "," ",e.jsx("span",{className:"font-bold",children:"(with profit)"})]}),e.jsxs("p",{className:"text-md font-bold text-green-600",children:["₹",b.toLocaleString("en-IN")]})]})}),e.jsx(fe,{className:"px-2 py-4 border-l-4 border-violet-600",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-md text-gray-600",children:"Profit Amount"}),e.jsxs("p",{className:"text-md font-bold text-violet-600",children:["₹",Ne.toLocaleString("en-IN")," ",e.jsxs("span",{className:"text-black !text-[12px] ml-[5px] font-semibold",children:["(",je.toFixed(2),"%)"]})]})]})}),e.jsx(fe,{className:"px-2 py-4 border-l-4 border-orange-600",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-md text-gray-600",children:"Single Labour Cost"}),e.jsxs("p",{className:"text-md font-bold text-orange-600",children:["₹",L]})]})})]})]}),G||ye?e.jsx(We,{}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-6",children:[r.map((a,t)=>e.jsx(Je,{index:t,data:a,labourCost:L,ref:O.current[t],brandRatesByName:be,innerLaminateRatesByBrand:Y,outerLaminateRatesByBrand:A,selectedBrand:j,selectedInnerBrand:P,selectedOuterBrand:B,brandOptions:Z,innerOptions:q,outerOptions:U,globalTransportation:h,globalProfitPercent:w,onFurnitureChange:p,onProfitOverride:o=>S(t,o)},t)),M.length>0&&e.jsxs("div",{className:"mt-10 bg-white border-2 border-dashed border-blue-200 rounded-2xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-blue-100 p-2 rounded-lg",children:e.jsx("i",{className:"fas fa-tools text-blue-600 text-xl"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Common Site Materials"}),e.jsx("p",{className:"text-xs text-gray-500 italic",children:"Quantities are fixed. Only Profit % can be adjusted for variants."})]})]}),e.jsxs("div",{className:"text-right flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-blue-50 px-3 py-1 rounded-lg border border-blue-100 shadow-sm",children:[e.jsx("label",{className:"text-[10px] font-bold text-blue-500 uppercase tracking-tighter",children:"Common Profit Overlay"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"number",className:"w-12 text-right font-black bg-transparent outline-none text-blue-800",value:_??w,placeholder:"0",onChange:a=>{const t=a.target.value===""?0:parseFloat(a.target.value);J(t),D(o=>o.map(s=>({...s,profitOnMaterial:0})))}}),e.jsx("span",{className:"text-blue-600 font-black ml-1 text-sm",children:"%"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-bold text-blue-500 uppercase",children:"Section Total"}),e.jsxs("p",{className:"text-2xl font-black text-blue-700",children:["₹",M.reduce((a,t)=>a+(t.rowTotal||0),0).toLocaleString("en-IN")]})]})]})]}),we()]}),e.jsx("div",{className:"flex items-center justify-between gap-4 bg-white border border-blue-100 p-4 rounded-xl shadow-sm mt-8",children:e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-[10px] font-extrabold text-blue-500 uppercase tracking-tighter",children:"Global Transport Cost"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-gray-400 mr-1 text-sm font-bold",children:"₹"}),e.jsx("span",{className:"font-bold text-gray-800",children:h.toLocaleString("en-IN")})]})]}),e.jsx("div",{className:"h-10 w-px bg-gray-100"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-[10px] font-extrabold text-green-500 uppercase tracking-tighter",children:"Global Profit Margin (%)"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"number",className:"w-16 text-right font-black focus:outline-none text-green-700 bg-green-50 rounded px-2 py-1 border border-green-100",value:w,onChange:a=>{const t=parseFloat(a.target.value)||0;ce(t),J(t),m(o=>o.map(s=>({...s,furnitureProfit:t,coreMaterials:s.coreMaterials.map(n=>({...n,profitOnMaterial:0,profitOnLabour:0})),fittingsAndAccessories:s.fittingsAndAccessories.map(n=>({...n,profitOnMaterial:0})),glues:s.glues.map(n=>({...n,profitOnMaterial:0})),nonBrandMaterials:s.nonBrandMaterials.map(n=>({...n,profitOnMaterial:0}))}))),D(o=>o.map(s=>({...s,profitOnMaterial:0})))}}),e.jsx("span",{className:"text-green-500 ml-1 font-bold text-sm",children:"%"})]}),e.jsx("p",{className:"text-[9px] text-gray-400 italic",children:"Overrides all product margins"})]})]})}),e.jsx("section",{className:"mt-10 text-right",children:e.jsxs("div",{className:"inline-block bg-green-50 border border-green-200 rounded-md px-6 py-4",children:[e.jsx("p",{className:"text-md font-medium text-gray-700 mb-1",children:"Total Estimate"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700",children:["₹",b.toLocaleString("en-IN")]})]})})]})})]})};export{Ye as DEFAULT_LAMINATE_RATE_PER_SQFT,nt as default};
