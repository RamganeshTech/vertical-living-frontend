import{a as K,u as M,r as h,j as e,B as c,S as Q,h as X,i as Y,k as Z,l as ee,t as m}from"./index-Bq7s2LOU.js";import{j as se,e as te,k as ae,l as ie,m as ne,n as le}from"./workScheduleApi-DTeQIItk.js";import{R as de}from"./RoomDetailLoading-RuD7GRwS.js";import"./Skeleton-CG3o2pT1.js";const xe=()=>{var w,D,I,_,A;const{sectionId:j,projectId:u,organizationId:F}=K(),P=M();if(!j)return;const{data:i,isLoading:L,refetch:g,isError:z,error:N}=se(u),{data:o,isLoading:U}=te(u),{mutateAsync:R,isPending:W}=ae(),S=ie(),k=ne(),C=le(),[y,v]=h.useState(!1),[n,p]=h.useState({taskName:"",description:"",date:"",status:"not_started",assignedTo:""}),[B,f]=h.useState(null),[l,x]=h.useState(null),[b,G]=h.useState("pending"),[V,T]=h.useState(!1),$=()=>T(!0),O=async()=>{var s,r;try{if(!u||!(i!=null&&i._id))throw new Error("Invalid project or schedule ID");await R({projectId:u,dailyScheduleId:i._id,payload:{status:b}}),m({title:"Success",description:"Work Schedule status updated successfully."}),T(!1),g()}catch(d){m({title:"Error",description:((r=(s=d==null?void 0:d.response)==null?void 0:s.data)==null?void 0:r.message)||d.message||"Failed to update status.",variant:"destructive"})}},q=async()=>{var s,r,d;try{if(!((s=n.taskName)!=null&&s.trim()))throw new Error("task Name field is mandatory");const a=new FormData;a.append("taskName",n.taskName),a.append("description",n.description),a.append("date",n.date),a.append("status",n.status),a.append("assignedTo",n.assignedTo),await S.mutateAsync({dailyScheduleId:j,formData:a,projectId:u}),v(!1),p({taskName:"",description:"",date:"",status:"not_started",assignedTo:""}),m({title:"Success",description:"Item Saved"}),g()}catch(a){m({variant:"destructive",title:"Error",description:((d=(r=a==null?void 0:a.response)==null?void 0:r.data)==null?void 0:d.message)||(a==null?void 0:a.message)||"failed to save"})}},H=async s=>{var r,d,a;try{if(!((r=l.taskName)!=null&&r.trim()))throw new Error("task Name field is mandatory");const t=new FormData;t.append("taskName",l.taskName),t.append("description",l.description),t.append("date",l.date),t.append("status",l.status),t.append("assignedTo",l.assignedTo),await k.mutateAsync({dailyScheduleId:j,taskId:s,formData:t,projectId:u}),f(null),x(null),m({title:"Success",description:"Item updated"}),g()}catch(t){m({variant:"destructive",title:"Error",description:((a=(d=t==null?void 0:t.response)==null?void 0:d.data)==null?void 0:a.message)||(t==null?void 0:t.message)||"Update failed"})}},J=async s=>{var r,d;try{await C.mutateAsync({dailyScheduleId:j,taskId:s,projectId:u}),m({title:"Deleted",description:"Item removed"}),g()}catch(a){m({title:"Error",description:((d=(r=a==null?void 0:a.response)==null?void 0:r.data)==null?void 0:d.message)||(a==null?void 0:a.message)||"Failed to delete",variant:"destructive"})}};return L?e.jsx(de,{}):(z&&((D=(w=N==null?void 0:N.response)==null?void 0:w.data)!=null&&D.message,c),U?e.jsx("p",{children:"getting the worksrs"}):e.jsxs("div",{className:"max-w-full",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-blue-700 mb-4 px-4",children:"🗓️ Daily Tasks"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"flex gap-2",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-gray-700 font-medium",children:"Status:"}),V?e.jsxs(e.Fragment,{children:[e.jsxs(Q,{value:b,onValueChange:s=>G(s),children:[e.jsx(X,{children:e.jsx(Y,{placeholder:"Select status",selectedValue:b})}),e.jsx(Z,{children:["pending","completed"].map(s=>e.jsx(ee,{value:s,children:s},s))})]}),e.jsx(c,{size:"sm",variant:"primary",disabled:W,onClick:O,children:"Save"})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:`inline-block px-3 py-1 text-xs font-semibold rounded-full ${(i==null?void 0:i.status)==="completed"?"bg-green-200 text-green-700":"bg-yellow-100 text-yellow-800"}`,children:i==null?void 0:i.status}),e.jsx(c,{size:"sm",onClick:$,children:e.jsx("i",{className:"fas fa-pencil"})})]})]})}),e.jsx(c,{variant:"primary",className:"h-10",onClick:()=>P(`/${F}/projectdetails/${u}/workmainschedule`),children:"Go Back"})]})]}),e.jsx("div",{className:"rounded-lg overflow-x-auto shadow-sm",children:e.jsxs("div",{className:"min-w-[1100px]",children:[e.jsxs("div",{className:"grid grid-cols-7 bg-blue-100 px-4 py-3 font-semibold text-blue-800 text-center text-sm",children:[e.jsx("div",{children:"S.No"}),e.jsx("div",{children:"Task Name"}),e.jsx("div",{children:"Description"}),e.jsx("div",{children:"Date"}),e.jsx("div",{children:"Status"}),e.jsx("div",{children:"Assigned To"}),e.jsx("div",{children:"Actions"})]}),((I=i==null?void 0:i.tasks)==null?void 0:I.length)>0?i.tasks.map((s,r)=>{var d,a;return e.jsxs("div",{className:"grid grid-cols-7 gap-1 items-center px-4 py-2 text-center hover:bg-blue-50 transition border-b border-[#81838556]",children:[e.jsx("div",{children:r+1}),B===r?e.jsxs(e.Fragment,{children:[e.jsx("input",{className:"border-b px-2 py-1  w-full text-sm text-center",value:l.taskName,onChange:t=>x({...l,taskName:t.target.value})}),e.jsx("input",{className:"border-b px-2 py-1  w-full text-sm text-center",value:l.description,onChange:t=>x({...l,description:t.target.value})}),e.jsx("input",{type:"date",className:"border-b px-2 py-1  w-full text-sm text-center",value:l.date,onChange:t=>x({...l,date:t.target.value})}),e.jsxs("select",{className:"border-b px-2 py-1 text-sm text-center w-full",value:l.status,onChange:t=>x({...l,status:t.target.value}),children:[e.jsx("option",{value:"not_started",children:"Not Started"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"completed",children:"Completed"})]}),e.jsxs("select",{className:"border-b px-2 py-1  text-sm text-center w-full",value:l.assignedTo,onChange:t=>x({...l,assignedTo:t.target.value}),children:[e.jsx("option",{value:"",children:"Select"}),o==null?void 0:o.map(t=>e.jsx("option",{value:t._id,children:t.workerName},t._id))]}),e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx(c,{isLoading:k.isPending,className:"px-3 py-1 bg-green-500 hover:bg-green-600 text-white text-sm rounded",onClick:()=>H(s._id),children:"Save"}),e.jsx("button",{className:"px-3 py-1 bg-gray-400 hover:bg-gray-500 text-white text-sm rounded",onClick:()=>{f(null),x(null)},children:"Cancel"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{children:s.taskName||"N/A"}),e.jsx("div",{children:s.description||"N/A"}),e.jsx("div",{children:s.date||"N/A"}),e.jsx("div",{className:"capitalize",children:((d=s==null?void 0:s.status)==null?void 0:d.replace("_"," "))||"N/A"}),e.jsx("div",{children:((a=o==null?void 0:o.find(t=>{var E;return(t==null?void 0:t._id)===((E=s==null?void 0:s.assignedTo)==null?void 0:E._id)}))==null?void 0:a.workerName)||"Not Assigned"}),e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx("button",{className:"px-3 py-1 bg-blue-500 hover:bg-blue-600 text-white text-sm rounded",onClick:()=>{f(r),x(s)},children:"Edit"}),e.jsx(c,{isLoading:C.isPending,onClick:()=>J(s._id),children:"Delete"})]})]})]},s._id)}):y?null:e.jsxs("div",{className:"text-center text-gray-600 py-6",children:["No tasks created yet.",e.jsx("br",{}),e.jsxs(c,{variant:"primary",className:"mt-3 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm rounded",onClick:()=>v(!0),children:[e.jsx("i",{className:"fas fa-plus mr-1"}),"Add First Task"]})]}),y&&e.jsxs("div",{className:"grid grid-cols-7 items-center gap-2 px-4 py-3 text-center bg-white",children:[e.jsx("div",{children:(_=i==null?void 0:i.tasks)!=null&&_.length?i.tasks.length+1:1}),e.jsx("input",{className:"border-b px-2 py-1  w-full text-sm",value:n.taskName,onChange:s=>p({...n,taskName:s.target.value})}),e.jsx("input",{className:"border-b px-2 py-1  w-full text-sm",value:n.description,onChange:s=>p({...n,description:s.target.value})}),e.jsx("input",{type:"date",className:"border-b px-2 py-1  w-full text-sm text-center",value:n.date,onChange:s=>p({...n,date:s.target.value})}),e.jsxs("select",{className:"border-b px-2 py-1  text-sm text-center w-full",value:n.status,onChange:s=>p({...n,status:s.target.value}),children:[e.jsx("option",{value:"not_started",children:"Not Started"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"completed",children:"Completed"})]}),e.jsxs("select",{className:"border-b px-2 py-1 text-sm text-center w-full",value:n.assignedTo,onChange:s=>p({...n,assignedTo:s.target.value}),children:[e.jsx("option",{value:"",children:"Select"}),o==null?void 0:o.map(s=>e.jsx("option",{value:s==null?void 0:s._id,children:s.workerName},s==null?void 0:s._id))]}),e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx(c,{variant:"primary",isLoading:S.isPending,onClick:q,children:"Add"}),e.jsx(c,{variant:"secondary",className:"",onClick:()=>v(!1),children:"Cancel"})]})]})]})}),!y&&((A=i==null?void 0:i.tasks)==null?void 0:A.length)>0&&e.jsx("div",{className:"text-left mt-6",children:e.jsxs(c,{size:"md",variant:"primary",onClick:()=>v(!0),children:[e.jsx("i",{className:"fas fa-plus mr-1"}),"Add Task"]})})]}))};export{xe as default};
