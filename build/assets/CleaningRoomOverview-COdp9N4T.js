import{b as K,a as Q,r as m,j as e,B as i,h as W,I as X,t as o}from"./index-JxDlpqED.js";import{c as Y,d as Z,e as ee,f as se,g as ae}from"./cleaningStageApi-B017ReCo.js";import{c as g}from"./Card-k7cnv6-m.js";import te from"./MaterialOverviewLoading-BSabl9op.js";import{T as le}from"./TextArea-CjhXTMqe.js";import{d as U}from"./downloadFile-BMKz69vB.js";import"./Skeleton-DUWdTQlJ.js";function ue(){var S,E,I,P,D,R;const{projectId:n,roomId:c,organizationId:z}=K(),L=Q(),{data:a,isLoading:A,refetch:u,isError:M,error:h}=Y(n,c),[y,b]=m.useState(null),{mutateAsync:T,isPending:f}=Z(),{mutateAsync:$,isPending:p}=ee(),{mutateAsync:B,isPending:O}=se(),{mutateAsync:_,isPending:w}=ae(),[x,G]=m.useState((a==null?void 0:a.completelyCleaned)||!1),[j,N]=m.useState((a==null?void 0:a.notes)||""),[C,v]=m.useState(!1),[d,k]=m.useState(null),V=s=>{var l;(l=s.target.files)!=null&&l.length&&k(s.target.files)},q=async()=>{var s,l;try{if(!d)throw new Error("select the files before uploading");const t=new FormData;for(let r=0;r<d.length;r++)t.append("files",d[r]);await T({projectId:n,roomId:c,formData:t}),o({title:"Success",description:"Files uploaded successfully."}),k(null),u()}catch(t){o({title:"Error",description:((l=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:l.message)||t.message,variant:"destructive"})}},F=async s=>{var l,t;try{await $({projectId:n,roomId:c,fileId:s}),o({title:"Deleted",description:"File deleted successfully."}),u()}catch(r){o({title:"Error",description:((t=(l=r==null?void 0:r.response)==null?void 0:l.data)==null?void 0:t.message)||r.message,variant:"destructive"})}},H=async()=>{var s,l;try{if(!j.trim())throw new Error("please enter some notes");await _({projectId:n,roomId:c,notes:j}),o({title:"Notes updated!",description:"Room notes saved."}),v(!1)}catch(t){o({title:"Error",description:((l=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:l.message)||(t==null?void 0:t.message)||"Failed to update",variant:"destructive"})}},J=async()=>{var s,l;try{await B({projectId:n,roomId:c,completelyCleaned:!x}),o({title:"Updated",description:`Marked as ${x?"not cleaned":"completely cleaned"}.`}),G(!x),u()}catch(t){o({title:"Error",description:((l=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:l.message)||t.message,variant:"destructive"})}};return A?e.jsx(te,{}):(M&&((E=(S=h==null?void 0:h.response)==null?void 0:S.data)!=null&&E.message,i),e.jsxs("div",{className:"w-full h-full max-h-full overflow-y-auto custom-scrollbar-none sm:custom-scrollbar",children:[e.jsxs("div",{className:"mb-4 flex justify-between items-center w-full",children:[e.jsxs("h2",{className:"text-md sm:text-2xl font-semibold mb-4 text-blue-700 flex items-center",children:[e.jsx("i",{className:"fas fa-broom mr-2"})," ",a==null?void 0:a.roomName," - Details"]}),e.jsxs("div",{className:"flex gap-1 items-center",children:[e.jsx(i,{isLoading:O,onClick:J,className:"bg-blue-600 hover:bg-blue-700 text-white text-sm !p-2 lg:p-4 ",children:x?"Mark as Not Cleaned":"Mark as Cleaned"}),e.jsx(i,{variant:"primary",className:"",onClick:()=>L(`/${z}/projectdetails/${n}/cleaning`),children:"Go Back"})]})]}),e.jsxs("div",{className:"mb-2 grid grid-cols-1 md:grid-cols-2 gap-1 items-center place-content-center",children:[e.jsxs(g,{className:"p-2 border-gray-100 border-2",children:[e.jsxs("div",{className:"w-full justify-between flex items-center",children:[e.jsx("h3",{className:"text-md font-semibold  text-blue-700",children:"Notes"}),!C&&e.jsxs(i,{onClick:()=>{N(a==null?void 0:a.notes),v(!0)},className:"bg-blue-600 text-white hover:bg-blue-700",children:["Edit ",e.jsx("i",{className:"fas fa-pencil ml-2 "})]})]}),C?e.jsxs(e.Fragment,{children:[e.jsx(le,{rows:4,className:"w-full border rounded p-2",value:j,onChange:s=>N(s.target.value),placeholder:"Enter notes here..."}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx(i,{onClick:H,disabled:w,className:"bg-blue-600 text-white hover:bg-blue-700",children:w?"Saving...":"Save"}),e.jsx(i,{onClick:()=>{v(!1),N((a==null?void 0:a.notes)??"")},variant:"outline",className:"border-gray-400",children:"Cancel"})]})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"relative overflow-x-auto overflow-y-auto break-words h-[6rem] max-h-[6rem] leading-5 custom-scrollbar",children:[" ",e.jsx("p",{className:"text-gray-700 mb-2 ",children:(I=a==null?void 0:a.notes)!=null&&I.trim()?a==null?void 0:a.notes:"No notes present."})]})})]}),e.jsxs(g,{className:"p-2 h-full border-gray-100 border-2",children:[e.jsx(W,{className:"block mb-2 font-semibold !text-blue-700",children:"Upload Images or PDFs:"}),e.jsx(X,{type:"file",multiple:!0,accept:"image/*,application/pdf",onChange:V,disabled:f,className:"border-b w-full"}),e.jsx(i,{onClick:q,isLoading:f,className:"mt-3 bg-blue-600 text-white hover:bg-blue-700",children:f?"Uploading...":`Upload ${d?d.length:""} file(s)`})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 h-[95%] sm:h-[65%]",children:[e.jsxs(g,{className:"p-2 lg:p-4 max-h-full overflow-y-auto custom-scrollbar border-1 border-[#8485887a]",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3 text-blue-700",children:"Images"}),((P=a==null?void 0:a.uploads)==null?void 0:P.filter(s=>s.type==="image").length)===0?e.jsx("p",{className:"text-gray-400 text-sm",children:"No images uploaded."}):e.jsx("div",{className:"grid grid-cols-2 gap-4",children:(D=a==null?void 0:a.uploads)==null?void 0:D.filter(s=>s.type==="image").map(s=>e.jsxs("div",{className:"relative group rounded overflow-hidden",children:[e.jsx("img",{src:s.url,alt:s.originalName,className:"w-full h-40 object-cover transition-transform duration-300 group-hover:scale-105"}),e.jsx("div",{className:"absolute inset-x-0 bottom-0 h-3/4 bg-gradient-to-t from-black/70 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),e.jsx(i,{size:"sm",variant:"danger",isLoading:p,onClick:()=>F(s._id),disabled:p,className:"absolute  top-2 right-2 bg-red-600 text-white border-none rounded-full w-7 h-7 flex items-center justify-center text-sm opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:e.jsx("i",{className:"fas fa-trash"})}),e.jsxs("div",{className:"absolute bottom-2 right-2 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:[e.jsx(i,{size:"sm",variant:"primary",onClick:()=>b(s.url),children:e.jsx("i",{className:"fas fa-eye"})}),e.jsx(i,{size:"sm",variant:"primary",onClick:()=>U({src:s==null?void 0:s.url,alt:(s==null?void 0:s.originalName)||"file.pdf"}),children:e.jsx("i",{className:"fa-solid fa-download"})})]})]},s.url))})]}),e.jsxs(g,{className:"p-4 max-h-full overflow-y-auto border-1 border-[#8485887a] custom-scrollbar",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3 text-blue-700",children:"PDFs"}),((R=a.uploads)==null?void 0:R.filter(s=>s.type==="pdf").length)===0?e.jsx("p",{className:"text-gray-400 text-sm",children:"No PDFs uploaded."}):e.jsx("ul",{className:"space-y-2",children:a==null?void 0:a.uploads.filter(s=>s.type==="pdf").map(s=>e.jsxs("li",{className:"flex items-center justify-between shadow-md p-2 rounded h-full",children:[e.jsx("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 underline truncate max-w-[50%]",children:s.originalName}),e.jsxs("div",{className:"space-x-1",children:[e.jsx(i,{size:"sm",variant:"primary",onClick:()=>U({src:s==null?void 0:s.url,alt:(s==null?void 0:s.originalName)||"file.pdf"}),children:e.jsx("i",{className:"fa-solid fa-download"})}),e.jsx(i,{size:"sm",isLoading:p,onClick:()=>F(s._id),disabled:p,variant:"danger",className:"bg-red-600 text-white rounded px-2 py-1 text-xs",children:e.jsx("i",{className:"fas fa-trash-can"})})]})]},s.url))})]})]}),y&&e.jsx("div",{onClick:()=>b(null),className:"fixed inset-0 z-50 bg-black/70 bg-opacity-60 flex items-center justify-center",children:e.jsxs("div",{onClick:s=>s.stopPropagation(),className:"relative bg-white rounded py-8 px-4 max-w-[90vw] max-h-[80vh] shadow-lg",children:[e.jsx("i",{className:"fas fa-times absolute top-2 right-3 text-xl text-gray-700 hover:text-red-500 cursor-pointer",onClick:()=>b(null)}),e.jsx("img",{src:y,alt:"Full View",className:"max-h-[70vh] w-auto object-contain rounded"})]})})]}))}export{ue as default};
