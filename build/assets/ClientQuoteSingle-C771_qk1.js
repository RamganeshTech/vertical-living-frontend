import{j as e,u as q,a as z,k as V,r as c,R as U,B as v,M as H,t as o}from"./index-BAM0eJUz.js";import{C as J}from"./ClientFurnitures-aDFHDaph.js";import{d as K,e as X}from"./clientQuoteApi-B0Dnhpm6.js";import{L as Y}from"./Label-C8i6KaZe.js";import{S as Z,a as ee,b as te,c as se,d as ae}from"./Select-C6lfB9t-.js";import{a as re,b as ne}from"./quoteVariantApi-SI_JgpSl.js";import{d as le}from"./downloadFile-BbGV_BaX.js";import{C as ie}from"./ClientQuoteType4-D-xVHWxj.js";import"./requirementFormApi-_wh_iBu9.js";import"./projectApi-D7-uwdh2.js";import"./orgApi-DGTdT7vR.js";const ce=({data:l,isBlured:i})=>{const h=(l==null?void 0:l.sqftRateWork)||[];return e.jsx("div",{className:"w-full bg-white rounded-3xl border border-slate-200 shadow-sm overflow-hidden",children:e.jsxs("div",{className:"p-8",children:[e.jsxs("table",{className:"w-full border-separate border-spacing-y-3",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-[10px] uppercase font-black text-slate-400 tracking-[0.15em]",children:[e.jsx("th",{className:"text-left px-6 pb-2",children:"Work Type"}),e.jsx("th",{className:"text-right px-6 pb-2",children:"Subtotal"})]})}),e.jsx("tbody",{children:h.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:2,className:"py-20 text-center text-slate-400 font-bold italic",children:"No items listed in this quote."})}):h.map((g,b)=>e.jsxs("tr",{className:"bg-slate-50/50 hover:bg-slate-50 transition-colors rounded-xl overflow-hidden",children:[e.jsx("td",{className:"px-6 py-5 rounded-l-2xl",children:e.jsx("div",{className:`transition-all duration-500 ${i?"blur-sm select-none":""}`,children:e.jsx("p",{className:"font-bold text-slate-800 text-lg leading-tight",children:g.workType||"General Work"})})}),e.jsx("td",{className:"px-6 py-5 text-right rounded-r-2xl border-l border-white/50",children:e.jsx("div",{className:`transition-all duration-500 ${i?"blur-sm select-none":""}`,children:e.jsxs("p",{className:"text-xl font-black text-slate-900",children:["₹",(g.totalCost||0).toLocaleString("en-IN")]})})})]},b))})]}),e.jsx("footer",{className:"mt-6 flex justify-end",children:e.jsxs("div",{className:"w-full max-w-md border-t-2 border-dashed border-slate-400 pt-6 px-6 flex items-center justify-between",children:[e.jsx("div",{className:"text-left",children:e.jsx("p",{className:"text-lg font-black text-slate-800 uppercase tracking-widest leading-none mb-1",children:"Total Estimate"})}),e.jsx("div",{className:`transition-all duration-500 ${i?"blur-md select-none":""}`,children:e.jsxs("p",{className:"text-4xl font-black text-blue-600 tracking-tight",children:["₹",((l==null?void 0:l.grandTotal)||0).toLocaleString("en-IN")]})})]})})]})})},Ne=0,ye=()=>{var T,S,C;const{organizationId:l,quoteId:i,quoteType:h}=q(),g=z(),{role:b,permission:x}=V(),f=b==="owner"||((T=x==null?void 0:x.clientquote)==null?void 0:T.create),j=b==="owner"||((S=x==null?void 0:x.clientquote)==null?void 0:S.edit),{data:a,isLoading:P}=K(l,i),N=h==="sqft_rate",{mutateAsync:L,isPending:w}=X(),{mutateAsync:M,isPending:A}=re(),{mutateAsync:E,isPending:I}=ne(),m=c.useRef([]),[k,y]=c.useState(null),[n,Q]=c.useState(!0),[d,B]=c.useState("type 4"),[u,O]=c.useState([]),[p,R]=c.useState((a==null?void 0:a.grandTotal)||0),_=d==="type 4";c.useEffect(()=>{R(a==null?void 0:a.grandTotal)},[a]);const F=async()=>{var s,t;try{if(!l||!i||!a){o({title:"Missing info",description:"Please ensure quote and all details are not missing",variant:"destructive"});return}if(!confirm("Are you sure want to send this quotation to payment?"))return;await L({organizationId:l,id:i}),o({title:"success",description:"Quote Selected and stored in the payment stage"})}catch(r){o({title:"Error",description:((t=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:t.message)??"Operation failed"})}},G=async()=>{var s,t;try{await E({quoteId:i}),o({title:"success",description:"Successfully created, check it in the Order Material page of this project"})}catch(r){o({title:"Error",description:((t=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:t.message)??"Operation failed",variant:"destructive"})}},$=async()=>{var s,t;try{if(!a.projectId._id||!i||!d){o({title:"Missing info",description:"Please ensure brand and all details are selected",variant:"destructive"});return}const r=await M({quoteId:i,type:d,projectId:a.projectId._id,quoteType:h,isBlurred:n});await le({src:r.url,alt:r.fileName}),o({title:"success",description:"pdf generated successfully"})}catch(r){o({title:"Error",description:((t=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:t.message)||"Operation failed",variant:"destructive"})}},W=async()=>{var s,t;try{Q(r=>!r)}catch(r){o({title:"Error",description:((t=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:t.message)??"Operation failed"})}};c.useEffect(()=>{if(!(a!=null&&a.furnitures))return;const s=a.furnitures.map(t=>({_id:t._id,furnitureName:t.furnitureName,scopeOfWork:t==null?void 0:t.scopeOfWork,dimention:t==null?void 0:t.dimention,coreMaterials:t.coreMaterials||[],fittingsAndAccessories:t.fittingsAndAccessories||[],glues:t.glues||[],nonBrandMaterials:t.nonBrandMaterials||[],totals:{core:t.coreMaterialsTotal||0,fittings:t.fittingsAndAccessoriesTotal||0,glues:t.gluesTotal||0,nbms:t.nonBrandMaterialsTotal||0,furnitureTotal:t.furnitureTotal||0},plywoodBrand:t.plywoodBrand||"",innerLaminateBrand:t.innerLaminateBrand||"",outerLaminateBrand:t.outerLaminateBrand||"",fabricationCost:t.fabricationCost||0}));O(s)},[a]),m.current.length!==u.length&&(m.current=u.map((s,t)=>m.current[t]??U.createRef())),c.useEffect(()=>{console.log("furnitureRefs Array",m),m.current=u.map((s,t)=>m.current[t]??c.createRef())},[u]);const D=[{value:"type 1",label:"Detailed Quote for Architects"},{value:"type 2",label:"Type 2"},{value:"type 3",label:"Type 3"},{value:"type 4",label:"Type 4"}];return e.jsxs("div",{className:"p-2 max-h-full overflow-y-auto",children:[e.jsx("header",{className:"sticky -top-2 z-50  bg-white border-b border-gray-200 py-4 space-y-3",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("button",{onClick:()=>g(-1),className:"flex cursor-pointer items-center justify-center w-8 h-8 bg-gray-50 hover:bg-gray-100 border border-gray-300 rounded-md transition-colors flex-shrink-0",children:e.jsx("i",{className:"fas fa-arrow-left text-gray-600 text-sm"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900 truncate",children:(a==null?void 0:a.mainQuoteName)||"Quote"}),e.jsx("p",{className:"text-md text-gray-500",children:a!=null&&a.quoteNo?`Quote: #${a==null?void 0:a.quoteNo}`:""})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[(f||j)&&e.jsxs(v,{onClick:G,isLoading:I,variant:"primary",className:"shadow-sm px-5",children:[e.jsx("i",{className:"fas fa-plus-circle mr-2"}),"Create Order from Quote"]}),e.jsx("div",{className:"h-10 w-[1px] bg-gray-200 hidden md:block"}),e.jsxs("div",{className:"text-right flex flex-col justify-center",children:[e.jsx("span",{className:"text-[10px] uppercase font-bold text-gray-400 tracking-widest leading-none mb-1",children:"Total Cost"}),e.jsx("div",{className:"flex items-baseline gap-1",children:e.jsxs("span",{className:"text-lg font-extrabold text-green-600",children:["₹",p==null?void 0:p.toLocaleString("en-in")]})})]}),e.jsx("div",{className:"h-10 w-[1px] bg-gray-200 hidden lg:block"}),e.jsxs("div",{className:"flex items-center gap-2",children:[(f||j)&&!N&&e.jsx(v,{onClick:F,disabled:w,variant:"outline",className:"border-blue-600 text-blue-600 hover:bg-blue-50",children:w?"Sending...":"Send to Payment"}),d!=="type 4"&&(f||j)&&e.jsxs(v,{onClick:$,isLoading:A,variant:"secondary",children:[e.jsx("i",{className:"fas fa-file-pdf mr-2"}),"Generate PDF"]})]}),e.jsxs("div",{className:"flex items-center gap-4 pl-2 border-l border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer group",children:[e.jsx("input",{type:"checkbox",checked:n,onChange:W,className:"sr-only",id:"blurinput"}),e.jsx("div",{className:`w-11 h-6 rounded-full transition-all duration-200 ${n?"bg-gray-300":"bg-blue-600"}`,children:e.jsx("div",{className:`absolute top-[2px] left-[2px] w-5 h-5 bg-white rounded-full transition-transform duration-200 ${n?"translate-x-0":"translate-x-5"}`})})]}),e.jsx(Y,{htmlFor:"blurinput",className:"text-xs font-bold text-gray-600 cursor-pointer whitespace-nowrap",children:"Show Stats"})]}),!N&&e.jsx("div",{className:"w-full !min-w-24",children:e.jsxs(Z,{onValueChange:s=>B(s),value:d,children:[e.jsx(ee,{className:"h-10 w-full text-xs font-semibold bg-gray-50 border-gray-300",children:e.jsx(te,{placeholder:"Template Type"})}),e.jsx(se,{children:D.map(s=>e.jsx(ae,{value:s.value,className:"text-xs",children:s.label},s.value))})]})})]})]})]})}),N?e.jsx(e.Fragment,{children:e.jsx(ce,{data:a,isBlured:n})}):e.jsxs(e.Fragment,{children:["  ",_?e.jsx(ie,{data:a,furnitures:u,isBlurred:n}):P?e.jsx(H,{}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-6",children:[u.map((s,t)=>e.jsx(J,{index:t,data:s,ref:m.current[t],templateType:d,isBlurred:n,onImageClick:y},t)),d!=="type 2"&&((C=a==null?void 0:a.commonMaterials)==null?void 0:C.length)>0&&e.jsxs("div",{className:"mt-10 bg-white border border-gray-200 rounded-lg p-4 shadow-md",children:[e.jsxs("h3",{className:"font-semibold text-md mb-2 text-gray-800 flex items-center gap-2",children:["Common Site Materials",e.jsxs("span",{className:"text-sm  ml-1",children:["(Total: ₹",a.commonMaterials.reduce((s,t)=>s+(t.rowTotal||0),0).toLocaleString("en-IN"),")"]})]}),e.jsx("div",{className:"overflow-x-auto rounded-md border border-gray-100",children:d!=="type 3"&&e.jsxs("table",{className:"min-w-full text-sm bg-white shadow-sm",children:[e.jsx("thead",{className:"bg-blue-50 text-sm font-semibold text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Item Name"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Description"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Quantity"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{children:a.commonMaterials.map((s,t)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50/50 transition-colors",children:[e.jsx("td",{className:"text-center border p-2",children:e.jsx("span",{className:n?"blur-sm select-none":"",children:(s==null?void 0:s.itemName)||"—"})}),e.jsx("td",{className:"text-center border p-2",children:e.jsx("span",{className:n?"blur-sm select-none":"",children:(s==null?void 0:s.description)||"—"})}),e.jsx("td",{className:"text-center border p-2",children:e.jsx("span",{className:n?"blur-sm select-none":"",children:(s==null?void 0:s.quantity)||0})}),e.jsx("td",{className:"text-center border p-2 text-green-700 font-bold",children:e.jsxs("span",{className:n?"blur-sm select-none":"",children:["₹",(s.rowTotal||0).toLocaleString("en-IN")]})}),e.jsx("td",{className:"text-center border p-2 text-gray-400",children:"—"})]},t))})]})})]}),e.jsx("div",{className:"mt-10 text-right",children:e.jsxs("div",{className:"inline-block bg-green-50 border border-green-200 rounded-md px-6 py-4",children:[e.jsx("p",{className:"text-md font-medium text-gray-700 mb-1",children:"Total Estimate"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700",children:["₹",p==null?void 0:p.toLocaleString("en-in")]})]})})]})}),k&&e.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/80 p-4 animate-in fade-in duration-200",onClick:()=>y(null),children:e.jsxs("div",{className:"relative max-w-4xl max-h-[90vh]",children:[e.jsx("button",{className:"absolute -top-10 right-0 text-white text-3xl hover:text-gray-300 transition-colors",onClick:()=>y(null),children:e.jsx("i",{className:"fas fa-times"})}),e.jsx("img",{src:k,className:"rounded-lg shadow-2xl max-w-full max-h-[85vh] object-contain border-4 border-white/10",alt:"Enlarged view",onClick:s=>s.stopPropagation()})]})})]})]})};export{Ne as DEFAULT_LAMINATE_RATE_PER_SQFT,ye as default};
