import{u as ns,f as cs,a as ds,e as os,b as ms,r as b,j as e,O as us}from"./index-BYTWf4fI.js";import{t as i}from"./toast-BSC5QTk1.js";import{B as u}from"./Button-aRmNljle.js";import{C as fe,a as xs}from"./Card-ClDlfbss.js";import{A as hs,S as ps}from"./AssignStaff-BoiFqKj-.js";import{R as gs}from"./ResetStageButton-BmBEDvOW.js";import{S as fs}from"./ShareDocumentWhatsapp-MNjlQsH4.js";import bs from"./MaterialOverviewLoading-DkmRHaSw.js";import{c as Ns,a as js,d as vs,e as ys,f as ws,g as Ss,h as Is,i as Cs,j as ks,k as Ps,l as Os,m as As,n as Es,b as Ls}from"./orderMaterialHistoryApi-BV7DbLkp.js";import{I as v}from"./Input-ChgExZu6.js";import{d as be}from"./downloadFile-DFN4JXcx.js";import{u as Ms}from"./shopLibDetailApi-a7jW2KyM.js";import{S as Ds}from"./SearchSelectNew-DeQkLtVy.js";import{I as _s}from"./ImageGalleryMain-BTDqHC1K.js";import{S as qs}from"./StageGuide-CqeeYR2U.js";import"./useMutation-sTZCeqmg.js";import"./roleCheck-DhBlwT6t.js";import"./getAllUsersApi-6pby7Q0j.js";import"./useQuery-DFVFWtWl.js";import"./documentationApi-IPlGDOAX.js";import"./requirementFormApi-ByKCnAIy.js";import"./Skeleton-Bc8D3KPj.js";import"./constants-4IFJeChr.js";import"./index-CofIYY6b.js";const Ne=["nos","pieces","litre","dozens","kg","mm","cm","meter","feet","inch","sqft","sqmm","packet","roll","sheet","set","coil","pair"],ot=()=>{var W,V,$,K,Q,Y,J,Z,X,ee,se,te,ae,re,le,ie,ne,ce,de,oe,me,ue,xe,he,pe,ge;const{projectId:c,organizationId:I}=ns(),{isMobile:je,openMobileSidebar:ve}=cs(),O=ds(),M=os(),{role:D,permission:N}=ms(),_=D==="owner"||((W=N==null?void 0:N.ordermaterial)==null?void 0:W.delete),h=D==="owner"||((V=N==null?void 0:N.ordermaterial)==null?void 0:V.create),g=D==="owner"||(($=N==null?void 0:N.ordermaterial)==null?void 0:$.edit),{data:t,isLoading:z,isError:q,error:A,refetch:y}=Ns(c),{mutateAsync:ye,isPending:we}=js(),{mutateAsync:Se,isPending:Ie}=vs(),{mutateAsync:Ce}=ys(),{mutateAsync:ke,isPending:R}=ws(),{mutateAsync:Pe}=Ss(),{mutateAsync:Oe,isPending:U}=Is(),Ae=Cs(),{mutateAsync:Ee,isPending:Le}=ks(),{mutateAsync:Me,isPending:De}=Ps(),{mutateAsync:_e}=Os(),{mutateAsync:qe}=As(),{data:w}=Ms(I),{mutateAsync:Ue,isPending:Te}=Es(),{mutateAsync:Ge,isPending:Be}=Ls(),[ze,T]=b.useState(!1),[n,C]=b.useState({}),[F,G]=b.useState(!1),[o,S]=b.useState({}),[E,Re]=b.useState({selectedId:null,shopName:null});b.useEffect(()=>{if(E.selectedId){const s=w==null?void 0:w.find(a=>a._id===E.selectedId);console.log("shop",s),s&&S(s)}},[E.selectedId,w]);const Fe=(K=w||[])==null?void 0:K.map(s=>({value:s._id,label:s.shopName})),[d,f]=b.useState(null),[m,L]=b.useState({name:"",quantity:1,unit:""}),k=b.useRef(null),He=async s=>{var a,r;try{const l=s.target.files;if(!l||l.length===0)return;const x=Array.from(l).filter(p=>p.type.startsWith("image/"));if(x.length!==l.length){i({title:"Invalid file type",description:"Only images are allowed (JPG, PNG, etc.)",variant:"destructive"});return}await Oe({files:x,projectId:c}),i({description:"Successfully uploaded images",title:"Success"})}catch(l){i({title:"Error",description:((r=(a=l==null?void 0:l.response)==null?void 0:a.data)==null?void 0:r.message)||l.message||"Failed to upload images",variant:"destructive"})}},We=async()=>{var s,a;try{await Me({projectId:c}),i({description:"Completion status updated successfully",title:"Success"}),O("../materialarrival")}catch(r){i({title:"Error",description:((a=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:a.message)||r.message||"Failed to update completion status",variant:"destructive"})}},Ve=async()=>{var s,a;try{if(!window.confirm("Are you sure need to perform this operation?"))return;await Ue({projectId:c}),i({description:"All Sub Items successfully",title:"Success"})}catch(r){i({title:"Error",description:((a=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:a.message)||r.message||"Failed to delete sub items",variant:"destructive"})}},$e=async()=>{var s,a;try{await Se({projectId:c}),i({description:"All Sub Items successfully",title:"Success"})}catch(r){i({title:"Error",description:((a=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:a.message)||r.message||"Failed to delete sub items",variant:"destructive"})}},Ke=async s=>{var a,r;try{await Ge({projectId:c,orderItemId:s,organizationId:I}),i({description:"Sent to Procurement",title:"Success"})}catch(l){i({title:"Error",description:((r=(a=l==null?void 0:l.response)==null?void 0:a.data)==null?void 0:r.message)||l.message||"Failed to update completion status",variant:"destructive"})}},Qe=async()=>{var s,a;try{if(n!=null&&n.phoneNumber&&!/^\d{10}$/.test(n==null?void 0:n.phoneNumber.trim()))throw new Error("Phone number should contain exactly 10 digit numbers");await _e({projectId:c,updates:n}),T(!1),i({title:"Success",description:"Delivery Details Updated"}),y()}catch(r){i({variant:"destructive",title:"Error",description:((a=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:a.message)||(r==null?void 0:r.message)||"Update failed"})}},Ye=async()=>{var s,a;try{if(o.phoneNumber&&!/^\d{10}$/.test(o.phoneNumber.trim()))throw new Error("Phone number should contain exactly 10 digit numbers");await qe({projectId:c,updates:o}),i({title:"Success",description:"Shop Details Updated"}),G(!1),y()}catch(r){i({variant:"destructive",title:"Error",description:((a=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:a.message)||(r==null?void 0:r.message)||"Update failed"})}},Je=async s=>{var a,r;try{await Ae.mutateAsync({projectId:c,imageId:s}),y==null||y(),i({title:"Success",description:"deleted successfully"})}catch(l){i({title:"Error",description:((r=(a=l==null?void 0:l.response)==null?void 0:a.data)==null?void 0:r.message)||"failed to delete",variant:"destructive"})}};b.useEffect(()=>{d&&k.current&&(k.current.focus(),k.current.select())},[d]);const Ze=c==null?void 0:c.replace(/[^a-zA-Z0-9]/g,"").slice(-3).toLowerCase(),Xe=new Date().getFullYear(),H=(((Y=(Q=t==null?void 0:t.orderedItems)==null?void 0:Q.map(s=>s==null?void 0:s.orderMaterialNumber))==null?void 0:Y.filter(Boolean))||[]).map(s=>{const a=s.split("-").pop();return parseInt(a,10)||0}),es=((H.length?Math.max(...H):0)+1).toString().padStart(3,"0"),ss=((J=t==null?void 0:t.currentOrder)==null?void 0:J.orderMaterialNumber)||`ORD-${Ze}-${Xe}-${es}`||null,P=async(s,a,r)=>{var l,x,p;try{const j=(l=t.currentOrder.subItems)==null?void 0:l.find(is=>is._id===s);if(!j)return;const ls={projectId:c,subItemId:s,subItemName:a==="name"?r:j.subItemName,quantity:a==="quantity"?Number(r)?Number(r):1:j.quantity,unit:a==="unit"?r:j.unit};await Pe(ls),i({title:"Success",description:"Item updated successfully"})}catch(j){console.log("filed",j),i({title:"Error",description:((p=(x=j==null?void 0:j.response)==null?void 0:x.data)==null?void 0:p.message)||"Failed to update item",variant:"destructive"})}},B=async s=>{var r,l;if(!g&&!h)return;const a=s;if(!a&&!(a!=null&&a.name.trim()))return i({title:"Error",description:"Material Name is mandatory",variant:"destructive"});try{await Ce({projectId:c,subItemName:a.name,quantity:a.quantity??1,unit:a.unit}),L({name:"",quantity:1,unit:""}),i({title:"Success",description:"Item created successfully"})}catch(x){i({title:"Error",description:((l=(r=x==null?void 0:x.response)==null?void 0:r.data)==null?void 0:l.message)||"Failed to create item",variant:"destructive"})}},ts=async s=>{var a,r;try{await ke({projectId:c,subItemId:s}),i({title:"Success",description:"Item deleted successfully"})}catch(l){i({title:"Error",description:((r=(a=l==null?void 0:l.response)==null?void 0:a.data)==null?void 0:r.message)||"Failed to delete item",variant:"destructive"})}},as=async s=>{var a,r;try{const l=await ye({projectId:c,organizationId:I,orderItemId:s});await be({src:l==null?void 0:l.pdfUrl,alt:"Order Material"}),i({title:"Success",description:"Pdf Generated successfully"}),y()}catch(l){i({title:"Error",description:((r=(a=l==null?void 0:l.response)==null?void 0:a.data)==null?void 0:r.message)||(l==null?void 0:l.message)||"Failed to generate link",variant:"destructive"})}},rs=async s=>{var a,r,l,x;try{await be({src:(a=s==null?void 0:s.pdfLink)==null?void 0:a.url,alt:(r=s==null?void 0:s.pdfLink)==null?void 0:r.pdfName}),i({title:"Success",description:"PDF Downloaded successfully"})}catch(p){i({title:"Error",description:((x=(l=p==null?void 0:p.response)==null?void 0:l.data)==null?void 0:x.message)||(p==null?void 0:p.message)||"Failed to generate PDF",variant:"destructive"})}};return M.pathname.includes("siteorders")||M.pathname.includes("shoplib")||M.pathname.includes("singleorder")?e.jsx(us,{}):z?e.jsx(bs,{}):e.jsxs("div",{className:"w-full h-full flex flex-col",children:[e.jsxs("header",{className:"flex-shrink-0 flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-4",children:[e.jsxs("h2",{className:"text-2xl sm:text-2xl lg:text-2xl xl:text-3xl font-semibold text-blue-600 flex items-center",children:[je&&e.jsx("button",{onClick:ve,className:"mr-3 p-2 rounded-md border-gray-300 hover:bg-gray-100",title:"Open Menu",children:e.jsx("i",{className:"fa-solid fa-bars"})}),e.jsx("i",{className:"fa-solid fa-cart-shopping mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Ordering Material"}),e.jsx("span",{className:"sm:hidden",children:"Order Material"})]}),(h||g)&&e.jsxs(e.Fragment,{children:[" ",e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full sm:w-auto",children:[e.jsxs(u,{isLoading:De,onClick:We,className:"bg-green-600 hover:bg-green-700 text-white w-full sm:w-auto whitespace-nowrap",children:[e.jsx("i",{className:"fa-solid fa-circle-check mr-2"}),"Mark as Complete"]}),e.jsx(gs,{projectId:c,stageNumber:8,stagePath:"orderingmaterial"}),!A&&e.jsx(fs,{projectId:c,stageNumber:"8",className:"w-full sm:w-fit",isStageCompleted:t==null?void 0:t.status}),e.jsx(hs,{stageName:"OrderMaterialHistoryModel",projectId:c,organizationId:I,currentAssignedStaff:(t==null?void 0:t.assignedTo)||null})]})]}),e.jsx("div",{className:"w-full sm:w-auto flex justify-end sm:block",children:e.jsx(qs,{organizationId:I,stageName:"ordermaterial"})})]}),q&&e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"max-w-xl p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2",children:"⚠️ Error Occurred"}),e.jsx("p",{className:"text-red-500 text-sm mb-4",children:((X=(Z=A==null?void 0:A.response)==null?void 0:Z.data)==null?void 0:X.message)||"Failed to load ordering material"}),e.jsx(u,{isLoading:z,onClick:()=>y(),className:"bg-red-600 text-white hover:bg-red-700",children:"Retry"})]})}),!q&&e.jsxs("div",{className:"flex-1 min-h-0 overflow-y-auto space-y-4 sm:space-y-6",children:[e.jsxs(fe,{className:"p-4 w-full shadow border-l-4 border-blue-600 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-3 text-blue-700 text-sm font-medium mb-2",children:[e.jsx("i",{className:"fa-solid fa-clock text-blue-500 text-lg"}),e.jsx("span",{children:"Stage Timings"})]}),e.jsx(ps,{completedAt:(ee=t==null?void 0:t.timer)==null?void 0:ee.completedAt,stageName:"orderingmaterial",formId:t==null?void 0:t._id,projectId:c,deadLine:(se=t==null?void 0:t.timer)==null?void 0:se.deadLine,startedAt:(te=t==null?void 0:t.timer)==null?void 0:te.startedAt,refetchStageMutate:y,deadLineMutate:Ee,isPending:Le})]}),!q&&e.jsxs("section",{className:"bg-white rounded-3xl shadow-[0_10px_40px_-15px_rgba(0,0,0,0.1)] overflow-hidden",children:[e.jsxs("section",{className:"border-l-4 border-blue-600 rounded-lg p-4 shadow-sm relative bg-white",children:[e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsx("div",{children:e.jsxs("h2",{className:"text-base sm:text-lg font-bold mb-3 text-blue-700 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-store"}),"Shop Details"]})}),F?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Assignee"}),e.jsx(Ds,{options:Fe,placeholder:"Select Shop",searchPlaceholder:"Search by shop name...",value:E.selectedId||"",onValueChange:s=>{const a=w==null?void 0:w.find(r=>r._id===s);Re({selectedId:a._id,shopName:a.shopName})},searchBy:"name",displayFormat:"detailed",className:"w-full"})]}):e.jsxs("div",{className:"gap-2 flex",children:[e.jsxs(u,{onClick:()=>O("shoplib"),children:[e.jsx("i",{className:"fas fa-shop mr-2"}),"Shop Library"]}),(g||h)&&e.jsxs("button",{onClick:()=>{S(t==null?void 0:t.shopDetails),G(!0)},className:" text-blue-600 text-xs sm:text-sm underline hover:text-blue-800",children:[e.jsx("i",{className:"fa-solid fa-edit mr-1"}),"Edit"]})]})]}),F?e.jsxs("div",{className:"space-y-3",children:[e.jsx(v,{placeholder:"Shop Name",value:(o==null?void 0:o.shopName)||"",onChange:s=>S({...o,shopName:s.target.value}),className:"w-full"}),e.jsx(v,{placeholder:"Contact Person",value:(o==null?void 0:o.contactPerson)||"",onChange:s=>S({...o,contactPerson:s.target.value}),className:"w-full"}),e.jsx(v,{placeholder:"Phone Number",value:(o==null?void 0:o.phoneNumber)||"",type:"tel",maxLength:10,onChange:s=>S({...o,phoneNumber:s.target.value}),className:"w-full"}),e.jsx(v,{placeholder:"Address",value:(o==null?void 0:o.address)||"",onChange:s=>S({...o,address:s.target.value}),className:"w-full"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mt-3  justify-end ",children:[e.jsxs(u,{onClick:Ye,className:"w-full sm:w-auto",children:[e.jsx("i",{className:"fa-solid fa-save mr-2"}),"Save"]}),e.jsxs(u,{variant:"outline",onClick:()=>G(!1),className:"w-full sm:w-auto",children:[e.jsx("i",{className:"fa-solid fa-times mr-2"}),"Cancel"]})]})]}):e.jsxs("div",{className:"space-y-2 text-sm sm:text-base",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Shop Name:"})," ",((ae=t==null?void 0:t.shopDetails)==null?void 0:ae.shopName)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Contact Person:"})," ",((re=t==null?void 0:t.shopDetails)==null?void 0:re.contactPerson)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Phone:"})," ",((le=t==null?void 0:t.shopDetails)==null?void 0:le.phoneNumber)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Address:"})," ",((ie=t==null?void 0:t.shopDetails)==null?void 0:ie.address)||"-"]})]})]}),e.jsxs("div",{className:"border-l-4 mt-4 border-blue-600 rounded-lg p-4 shadow-sm relative bg-white",children:[e.jsxs("h2",{className:"text-base sm:text-lg font-bold mb-3 text-blue-700 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-truck"}),"Delivery Location"]}),ze?e.jsxs("div",{className:"space-y-3",children:[e.jsx(v,{placeholder:"Site Name",value:(n==null?void 0:n.siteName)||"",onChange:s=>C({...n,siteName:s.target.value}),className:"w-full"}),e.jsx(v,{placeholder:"Site Supervisor",value:(n==null?void 0:n.siteSupervisor)||"",onChange:s=>C({...n,siteSupervisor:s.target.value}),className:"w-full"}),e.jsx(v,{placeholder:"Phone Number",type:"tel",maxLength:10,value:(n==null?void 0:n.phoneNumber)||"",onChange:s=>C({...n,phoneNumber:s.target.value}),className:"w-full"}),e.jsx(v,{placeholder:"Address",value:(n==null?void 0:n.address)||"",onChange:s=>C({...n,address:s.target.value}),className:"w-full"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mt-3  justify-end ",children:[e.jsxs(u,{onClick:Qe,className:"w-full sm:w-auto",children:[e.jsx("i",{className:"fa-solid fa-save mr-2"}),"Save"]}),e.jsxs(u,{variant:"outline",onClick:()=>T(!1),className:"w-full sm:w-auto",children:[e.jsx("i",{className:"fa-solid fa-times mr-2"}),"Cancel"]})]})]}):e.jsxs("div",{className:"space-y-2 text-sm sm:text-base",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Site Name:"})," ",((ne=t==null?void 0:t.deliveryLocationDetails)==null?void 0:ne.siteName)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Supervisor:"})," ",((ce=t==null?void 0:t.deliveryLocationDetails)==null?void 0:ce.siteSupervisor)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Phone:"})," ",((de=t==null?void 0:t.deliveryLocationDetails)==null?void 0:de.phoneNumber)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Address:"})," ",((oe=t==null?void 0:t.deliveryLocationDetails)==null?void 0:oe.address)||"-"]}),(g||h)&&e.jsxs("button",{onClick:()=>{C(t==null?void 0:t.deliveryLocationDetails),T(!0)},className:"absolute top-3 right-4 text-blue-600 text-xs sm:text-sm underline hover:text-blue-800",children:[e.jsx("i",{className:"fa-solid fa-edit mr-1"}),"Edit"]})]})]}),e.jsx("section",{className:"w-full",children:e.jsxs("section",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 border-b pb-2 flex items-center",children:[e.jsx("i",{className:"fas fa-folder-open mr-2 text-blue-500"})," Images"]}),e.jsxs("div",{className:"flex items-center justify-between w-full relative",children:[(g||h)&&e.jsx(v,{type:"file",multiple:!0,accept:"image/*",placeholder:"select files",onChange:He,disabled:U,className:U?"pr-10 opacity-70 cursor-not-allowed w-full mb-4":"mb-4"}),U&&e.jsx("div",{className:"absolute inset-y-0 right-2 flex items-center",children:e.jsxs("svg",{className:"animate-spin h-5 w-5 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4l3.5-3.5L12 0v4a8 8 0 100 16v4l3.5-3.5L12 20v-4a8 8 0 01-8-8z"})]})})]}),e.jsx("div",{className:"mb-6",children:((me=t==null?void 0:t.images)==null?void 0:me.length)>0?e.jsx(_s,{..._?{handleDeleteFile:s=>Je(s)}:{},imageFiles:t==null?void 0:t.images,height:150,minWidth:150,maxWidth:200}):e.jsx("div",{className:"text-gray-500 text-sm italic bg-gray-50 p-8 rounded-lg text-center border-2 border-dashed border-gray-200",children:"No Images uploaded yet."})})]})}),e.jsxs("div",{className:"p-6 border-b mt-4 border-gray-100 relative",children:[e.jsx("div",{className:"absolute top-0 left-0 h-full w-1.5 bg-blue-600 "}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 pl-3",children:[e.jsx("div",{children:e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Your Orders"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(u,{variant:"primary",className:"",onClick:()=>O("siteorders"),children:[e.jsx("i",{className:"fas fa-box-archive !mr-2"}),"View Public Orders"]}),_&&e.jsxs(u,{variant:"danger",className:"bg-red-600 text-white",isLoading:Te,onClick:Ve,children:[e.jsx("i",{className:"fas fa-trash !mr-2"}),"Delete All SubItems"]})]})]})]}),e.jsxs("div",{className:"mt-6 pt-4 border-t-2 border-blue-200 bg-gradient-to-r from-white to-white rounded-lg p-4",children:[e.jsxs("div",{className:"mb-3 ",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-list text-blue-600"}),e.jsx("h4",{className:"font-semibold text-blue-800 text-xl",children:"Create Material Order"}),e.jsx("span",{className:"text-sm text-gray-500",children:"(Click to edit, changes save by clicking Enter)"})]}),e.jsxs("p",{className:"ml-6 text-sm text-gray-500",children:["Order Id: "," ",e.jsx("span",{className:"text-lg text-black font-medium",children:ss})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border-2 border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"grid grid-cols-17 gap-0 bg-gradient-to-r from-blue-100 to-blue-100 border-b-2 border-blue-200",children:[e.jsx("div",{className:"col-span-3 px-4 py-3 text-sm font-medium text-gray-700 border-r border-gray-200",children:"Ref ID"}),e.jsx("div",{className:"col-span-8 px-4 py-3 text-sm font-medium text-gray-700 border-r border-gray-200",children:"Material Name"}),e.jsx("div",{className:"col-span-2 px-4 py-3 text-sm font-medium text-gray-700 border-r border-gray-200",children:"Quantity"}),e.jsx("div",{className:"col-span-3 px-4 py-3 text-sm font-medium text-gray-700 border-r border-gray-200",children:"Unit"}),e.jsx("div",{className:"col-span-1 px-4 py-3 text-sm font-medium text-gray-700",children:"Action"})]}),t.currentOrder.subItems&&((ue=t.currentOrder)==null?void 0:ue.subItems.length)>0&&t.currentOrder.subItems.map(s=>e.jsxs("div",{className:"grid grid-cols-17 gap-0 border-b border-gray-100 hover:bg-gray-50",children:[e.jsx("div",{className:"col-span-3 border-r border-blue-200",children:e.jsx("div",{className:"w-full px-4 py-3 border-none outline-none focus:bg-blue-50",children:(s==null?void 0:s.refId)||"N/A"})}),e.jsx("div",{className:"col-span-8 border-r border-blue-200",children:(d==null?void 0:d.subItemId)===s._id&&(d==null?void 0:d.field)==="name"?e.jsx("input",{ref:k,type:"text",defaultValue:s.subItemName,className:"w-full px-4 py-3 border-none outline-none focus:bg-blue-50",onBlur:a=>{P(s._id,"name",a.target.value),f(null)},onKeyDown:a=>{if(a.key==="Enter"){const r=a.target.value;P(s._id,"name",r),f(null)}a.key==="Escape"&&f(null)}}):e.jsx("div",{className:"px-4 py-3 cursor-pointer hover:bg-blue-50 transition-colors",onClick:()=>{(h||g)&&f({subItemId:s._id,field:"name"})},children:s.subItemName})}),e.jsx("div",{className:"col-span-2 border-r border-blue-200",children:(d==null?void 0:d.subItemId)===s._id&&(d==null?void 0:d.field)==="quantity"?e.jsx("input",{ref:k,type:"number",defaultValue:s.quantity,min:"0",className:"w-full px-4 py-3 border-none outline-none focus:bg-blue-50",onBlur:a=>{P(s._id,"quantity",a.target.value),f(null)},onKeyDown:a=>{a.key==="Enter"&&(P(s._id,"quantity",a.currentTarget.value),f(null)),a.key==="Escape"&&f(null)}}):e.jsx("div",{className:"px-4 py-3 cursor-pointer hover:bg-blue-50 transition-colors",onClick:()=>{(h||g)&&f({subItemId:s._id,field:"quantity"})},children:s.quantity})}),e.jsx("div",{className:"col-span-3 border-r border-blue-200",children:(d==null?void 0:d.subItemId)===s._id&&(d==null?void 0:d.field)==="unit"?e.jsx("div",{className:"p-2 relative z-50",children:e.jsxs("select",{defaultValue:s.unit,onChange:a=>{P(s._id,"unit",a.target.value),f(null)},className:"w-full relative z-[50] px-3 py-2 border border-gray-200 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-sm",children:[e.jsx("option",{value:"",disabled:!0,children:"Selected unit"}),Ne.map(a=>e.jsx("option",{value:a,children:a},a))]})}):e.jsx("div",{className:"px-4 py-3 cursor-pointer hover:bg-blue-50 transition-colors",onClick:()=>{(h||g)&&f({subItemId:s._id,field:"unit"})},children:s.unit})}),_&&e.jsx("div",{className:"col-span-1 flex items-center justify-center",children:e.jsx(u,{variant:"danger",onClick:()=>ts(s._id),disabled:R,isLoading:R,className:"p-2 bg-red-600 text-white  hover:bg-red-50 rounded transition-colors disabled:opacity-50",title:"Delete item",children:e.jsx("i",{className:"fa fa-trash text-sm"})})})]},s._id)),e.jsxs("div",{className:"grid grid-cols-17 gap-0 bg-green-50 border-b border-gray-100",children:[e.jsx("div",{className:"col-span-3 border-r border-gray-200",children:e.jsx("div",{className:"w-full px-4 py-3 border-none outline-none focus:bg-blue-50",children:"Ref Id"})}),e.jsx("div",{className:"col-span-8 border-r border-gray-200",children:e.jsx("input",{type:"text",placeholder:"Enter matterial name...",value:(m==null?void 0:m.name)||"",onChange:s=>{L(a=>({...a,name:s.target.value}))},onBlur:()=>{var s;(s=m==null?void 0:m.name)!=null&&s.trim()&&m.quantity&&m.unit&&B(m)},onKeyDown:s=>{s.key==="Enter"&&B(m)},className:"w-full px-4 py-3 bg-transparent border-none outline-none placeholder-gray-400"})}),e.jsx("div",{className:"col-span-2 border-r border-gray-200",children:e.jsx("input",{type:"number",placeholder:"Qty",min:"0",value:(m==null?void 0:m.quantity)||1,onChange:s=>{L(a=>({...a,quantity:Number(s.target.value)||1}))},className:"w-full px-4 py-3 bg-transparent border-none outline-none placeholder-gray-400"})}),e.jsx("div",{className:"col-span-3 border-r border-gray-200",children:e.jsx("div",{className:"p-2",children:e.jsxs("select",{value:(m==null?void 0:m.unit)||"",onChange:async s=>{const a={...m,unit:s.target.value};L(r=>({...r,unit:s.target.value})),await B(a)},className:"w-full relative z-[50] px-3 py-2 border border-gray-200 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-sm",children:[e.jsx("option",{value:"",children:"Selected unit"}),Ne.map(s=>e.jsx("option",{value:s,children:s},s))]})})})]}),(!t.currentOrder.subItems||((he=(xe=t.currentOrder)==null?void 0:xe.subItems)==null?void 0:he.length)===0)&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("i",{className:"fa-solid fa-inbox text-2xl mb-2"}),e.jsx("p",{className:"text-sm",children:"No sub-items yet. Start typing in the row above to add items."})]})]})]})]}),e.jsxs("section",{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"Orders"}),e.jsx("p",{className:"text-sm text-gray-600",children:"view your orders"})]}),h&&e.jsx(u,{onClick:$e,isLoading:Ie,className:"min-w-[140px] bg-blue-600 hover:bg-blue-700 text-white font-medium",size:"lg",children:"Submit Order"})]}),t!=null&&t.orderedItems&&((pe=t==null?void 0:t.orderedItems)==null?void 0:pe.length)>0?e.jsx("div",{className:"flex flex-col gap-2",children:(ge=t==null?void 0:t.orderedItems)==null?void 0:ge.map(s=>e.jsx(fe,{className:"border-green-200 bg-green-50 shadow ",children:e.jsx(xs,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx("i",{className:"fas fa-check-circle text-7reen-600"})}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-blue-700 ",children:[e.jsx("span",{className:"!text-sm text-gray-600",children:"Order Id: "})," ",s.orderMaterialNumber]}),e.jsx("span",{className:"text-sm text-gray-900",children:"Order Material"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full sm:w-auto ",children:[e.jsxs(u,{variant:"outline",onClick:()=>O(`singleorder/${s._id}`),className:"border-green-300 text-blue-700 hover:bg-blue-100 hover:border-blue-400",children:[e.jsx("i",{className:"fas mr-2 fa-external-link-alt"}),"View"]}),(h||g)&&e.jsx(u,{variant:"outline",onClick:()=>as(s._id),isLoading:we,className:"border-green-300 text-blue-700 hover:bg-blue-100 hover:border-blue-400",children:"Generate Pdf"}),e.jsx(u,{variant:"secondary",onClick:()=>rs(s),className:"border-blue-300 text-blue-700 hover:bg-blue-100 hover:border-blue-400",children:"Download PDF"}),(h||g)&&e.jsx(u,{variant:"outline",onClick:()=>Ke(s._id),disabled:s==null?void 0:s.isSyncWithProcurement,title:s!=null&&s.isSyncWithProcurement?"already sent to procurement":"",isLoading:Be,className:"border-green-300 text-blue-700 disabled:cursor-not-allowed hover:bg-blue-100 hover:border-blue-400",children:"Send To Procurement"})]})]})})},s._id))}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col items-center  justify-center min-h-[300px] w-full bg-white rounded-xl text-center p-6",children:[e.jsx("i",{className:"fa-solid fa-box text-5xl text-blue-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-1",children:"No Orders Found"})]})})]})]})]})};export{Ne as ORDERMATERIAL_UNIT_OPTIONS,ot as default};
