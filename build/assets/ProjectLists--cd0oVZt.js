import{r as d,j as e,B as M,t as A,V as H,$ as J,d as K,F as q}from"./index-D5hl8ps7.js";import{S as F}from"./constants-FaVgBbKC.js";import{a as Q,b as W,c as X,u as Y}from"./projectApi-TvlVKMR-.js";import{b as V}from"./validation-lCXOhVkV.js";import{d as _}from"./dateFormator-B0AlGPNQ.js";import{a as Z}from"./currentActiveStageApi-BV4Uxb6h.js";const E=({message:t,onClick:N})=>{const[v,w]=d.useState(!0),[a,i]=d.useState("in"),n=()=>{i("out")},f=()=>{a==="out"&&(w(!1),N())};return v?e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        @keyframes bounceScaleIn {
          0% { transform: scale(0); }
          60% { transform: scale(1.1); }
          80% { transform: scale(0.95); }
          100% { transform: scale(1); }
        }
        @keyframes bounceScaleOut {
          0% { transform: scale(1); }
          20% { transform: scale(1.1); }
          100% { transform: scale(0); }
        }
      `}),e.jsx("div",{className:"fixed inset-0 bg-[#0a0a0a10] z-[1099] flex items-center justify-center px-4",onClick:()=>n(),children:e.jsxs("div",{onClick:o=>o.stopPropagation(),style:{animation:a==="in"?"bounceScaleIn 0.2s ease-out forwards":"bounceScaleOut 0.2s ease-in forwards"},onAnimationEnd:f,className:"bg-[#2f303a] text-gray-800 rounded-2xl !w-[30%] shadow-lg !px-6 max-w-lg sm:!px-3 sm:py-2 sm:w-full text-center !space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center border-b border-red-500 pb-2",children:[e.jsx("span",{className:"text-white text-lg",children:"Error occured"}),e.jsx("span",{className:"cursor-pointer",onClick:n,children:e.jsx("i",{className:"fa-solid fa-xmark text-red-500 text-lg"})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white text-lg",children:t[0].toUpperCase()+t.slice(1)}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:n,className:"cursor-pointer inline-block bg-red-500 hover:bg-red-800 duration-200 px-5 py-1 rounded-md text-white",children:"OK"})})]})]})})]}):null},ee=["none","low","medium","high"],te=["Active","Delayed","In Progress","In Testing","On Track","On Hold","Approved","Cancelled","Planning","Invoice"],se={Active:"bg-green-100 text-green-800",Delayed:"bg-red-100 text-red-800","In Progress":"bg-blue-100 text-blue-800","In Testing":"bg-yellow-100 text-yellow-800","On Track":"bg-emerald-100 text-emerald-800","On Hold":"bg-gray-100 text-gray-800",Approved:"bg-indigo-100 text-indigo-800",Cancelled:"bg-rose-100 text-rose-800",Planning:"bg-purple-100 text-purple-800",Invoice:"bg-pink-100 text-pink-800"},ae=({onClose:t,refetch:N,setShowForm:v,organizationId:w,isEditing:a,setEditForm:i,editForm:n,editProjectId:f})=>{var h,L,R,B;const[o,m]=d.useState({projectName:"",description:"",duration:0,tags:[],startDate:new Date,endDate:null,dueDate:null,priority:"none",status:"Active"}),[u,C]=d.useState({}),l=(s,I)=>{let{name:D,value:c}=s.target;if(D==="tags"){I(P=>({...P,tags:Array.from(new Set([...P.tags,c]))}));return}if(D.includes("Date")){const P=c?new Date(c):null;I(U=>{const S={...U,[D]:P};if(S.startDate&&S.dueDate){const z=S.dueDate.getTime()-S.startDate.getTime();z>=0?S.duration=Math.ceil(z/(1e3*3600*24)):S.duration=0}return S});return}I(P=>({...P,[D]:c}))},{mutateAsync:j,isPending:g,error:r,isError:k,reset:p}=Q(),{mutateAsync:O,isPending:b,error:y,isError:T,reset:$}=W(),x=async s=>{var I,D;s.preventDefault(),s.stopPropagation();try{const c=a?V(n):V(o);C(c),Object.keys(c).length===0&&(a&&f?b||(await O({projectId:f,formData:n}),A({title:"Success",description:"Project Edited Successfully"})):g||(await j({projectData:o,orgsId:w}),A({title:"Success",description:"Project Created Successfully"})),N(),v(!1))}catch(c){A({title:"Error",description:((D=(I=c==null?void 0:c.response)==null?void 0:I.data)==null?void 0:D.message)||(c==null?void 0:c.message)||"Operation Failed",variant:"destructive"})}};return e.jsx(e.Fragment,{children:e.jsxs("div",{onClick:s=>s.stopPropagation(),className:"bg-white w-full h-full overflow-y-auto custom-scrollbar max-w-3xl mx-auto rounded-2xl shadow-2xl p-4 sm:p-6 md:p-8 border border-gray-200 relative",children:[!g&&k&&e.jsx(E,{message:((L=(h=r==null?void 0:r.response)==null?void 0:h.data)==null?void 0:L.message)||(r==null?void 0:r.message)||"Something went wrong",onClick:()=>p()}),!b&&T&&e.jsx(E,{message:((B=(R=y==null?void 0:y.response)==null?void 0:R.data)==null?void 0:B.message)||(y==null?void 0:y.message)||"Something went wrong",onClick:()=>$()}),e.jsxs("div",{className:"flex justify-between items-center mb-4 sm:mb-6",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-blue-700 flex items-center gap-2",children:a?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa-solid fa-edit"})," Edit Project"]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa-solid fa-plus"})," Create Project"]})}),e.jsx("button",{onClick:t,className:"text-gray-500 hover:text-red-500 text-xl",children:e.jsx("i",{className:"fa-solid fa-xmark"})})]}),e.jsxs("form",{onSubmit:x,className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Project Name"}),e.jsx("input",{autoFocus:!0,name:"projectName",value:a?n.projectName:o.projectName,onChange:s=>l(s,a?i:m),type:"text",placeholder:"Enter name",className:"input outline-none w-full border border-gray-300 rounded-md px-3 py-2"}),u.projectName&&e.jsx("p",{className:"text-red-600 text-xs mt-1",children:u.projectName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Duration (days)"}),e.jsx("input",{disabled:!0,type:"number",name:"duration",onChange:s=>l(s,a?i:m),value:a?n.duration:o.duration,placeholder:"Ex: 15",className:"input outline-none w-full border border-gray-300 rounded-md px-3 py-2 bg-gray-100 cursor-not-allowed"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{rows:3,name:"description",onChange:s=>l(s,a?i:m),value:a?n.description:o.description,placeholder:"Brief project overview",className:"input outline-none w-full border border-gray-300 rounded-md px-3 py-2 resize-none"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Start Date"}),e.jsx("input",{type:"date",onChange:s=>l(s,a?i:m),value:a?n.startDate?n.startDate.toISOString().split("T")[0]:"":o.startDate?o.startDate.toISOString().split("T")[0]:"",name:"startDate",className:"input outline-none w-full border border-gray-300 rounded-md px-3 py-2"}),u.startDate&&e.jsx("p",{className:"text-red-600 text-xs mt-1",children:u.startDate})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"End Date"}),e.jsx("input",{type:"date",name:"endDate",onChange:s=>l(s,a?i:m),value:a?n.endDate?n.endDate.toISOString().split("T")[0]:"":o.endDate?o.endDate.toISOString().split("T")[0]:"",className:"input outline-none w-full border border-gray-300 rounded-md px-3 py-2"}),u.endDate&&e.jsx("p",{className:"text-red-600 text-xs mt-1",children:u.endDate})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Due Date"}),e.jsx("input",{type:"date",name:"dueDate",onChange:s=>l(s,a?i:m),value:a?n.dueDate?n.dueDate.toISOString().split("T")[0]:"":o.dueDate?o.dueDate.toISOString().split("T")[0]:"",className:"input outline-none w-full border border-gray-300 rounded-md px-3 py-2"}),u.dueDate&&e.jsx("p",{className:"text-red-600 text-xs mt-1",children:u.dueDate})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Priority"}),e.jsx("select",{name:"priority",onChange:s=>l(s,a?i:m),value:a?n.priority:o.priority,className:"input w-full border border-gray-300 rounded-md px-3 py-2",children:ee.map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsx("select",{name:"status",onChange:s=>l(s,a?i:m),value:a?n.status:o.status,className:"input w-full border border-gray-300 rounded-md px-3 py-2",children:te.map(s=>e.jsx("option",{value:s,children:s},s))})]})]}),e.jsx("div",{className:"text-end",children:e.jsx(M,{isLoading:g||b,type:"submit",disabled:g||b,className:"bg-blue-600 text-white px-6 w-full sm:w-40 py-2 rounded-xl hover:bg-blue-700 transition-all",children:g||b?e.jsx("div",{className:"mx-auto w-5 h-5 border-2 border-white border-t-transparent rounded-full"}):a?"Edit Project":"Create Project"})})]})]})})},re=d.memo(ae),ne=({project:t,onEdit:N,organizationId:v,refetch:w})=>{const{setProjectId:a}=H(),{mutateAsync:i,isPending:n}=X(),{data:f,isLoading:o}=Z(t==null?void 0:t._id),m=r=>{a(r)},u=r=>{switch(r){case"high":return"bg-red-100 text-red-500";case"medium":return"bg-yellow-100 text-yellow-600";case"low":return"bg-green-100 text-green-600";default:return"bg-white shadow-sm"}},C=d.useMemo(()=>{var r;return(r=t.projectInformation)!=null&&r.startDate?_(t.projectInformation.startDate):null},[]),l=d.useMemo(()=>{var r;return(r=t.projectInformation)!=null&&r.endDate?_(t.projectInformation.endDate):null},[]),j=d.useMemo(()=>{var r;return(r=t.projectInformation)!=null&&r.dueDate?_(t.projectInformation.dueDate):null},[]),g=async()=>{var r,k;try{if(!window.confirm("Are you sure you want to delete this project?"))return;await i(t._id),A({title:"Success",description:"Project Deleted Successfully"}),w()}catch(p){A({title:"Error",description:((k=(r=p==null?void 0:p.response)==null?void 0:r.data)==null?void 0:k.message)||(p==null?void 0:p.message)||"Failed to Delete",variant:"destructive"})}};return e.jsxs("div",{className:"p-2 sm:p-5 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xl font-semibold text-[#1f2d3d]",children:[e.jsx("i",{className:"fa-solid fa-folder-open text-blue-600"}),t.projectName]}),e.jsxs("span",{className:`text-sm px-3 py-1 rounded-full font-medium ${u(t.projectInformation.priority)}`,children:[t.projectInformation.priority," priority"]})]}),e.jsxs("div",{className:"text-sm text-gray-700 grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-3 gap-y-1 sm:gap-y-2 gap-x-4",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("i",{className:"fa-solid fa-calendar-day text-gray-500"}),e.jsx("strong",{children:"Start:"})," ",C||"N/A"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("i",{className:"fa-solid fa-calendar-check text-gray-500"}),e.jsx("strong",{children:"End:"})," ",l||"N/A"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("i",{className:"fa-solid fa-calendar-check text-gray-500"}),e.jsx("strong",{children:"Due:"})," ",j||"N/A"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("i",{className:"fa-solid fa-hourglass-half text-gray-500"}),e.jsxs("strong",{children:["Duration: ",t.projectInformation.duration," days"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("i",{className:"fa-solid fa-hourglass-half text-gray-500"}),e.jsxs("strong",{children:["Status: ",e.jsx("span",{className:`${se[t.projectInformation.status]} !bg-transparent`,children:t.projectInformation.status})," "]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Progress"}),e.jsx("div",{className:"mt-1 w-full h-3 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-blue-600",style:{width:`${t.completionPercentage}%`}})}),e.jsxs("div",{className:"text-sm text-right text-gray-600 mt-1",children:[t.completionPercentage,"% Complete"]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-2 text-sm text-blue-600",children:[e.jsx(J,{to:`/${v}/projectdetails/${t._id}/${f}`,onClick:()=>m(t._id),className:`hover:underline ${o?"cursor-block":"cursor-pointer"}  flex items-center gap-1`,children:o?e.jsx("i",{className:"fa fa-spinner animate-spin text-blue-600"}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa-solid fa-eye"})," View"]})}),e.jsxs(M,{isLoading:n,variant:"outline",onClick:g,className:"hover:underline cursor-pointer flex items-center gap-1 text-red-500 !border-0",children:[e.jsx("i",{className:"fa-solid fa-trash"}),"Delete"]}),e.jsxs("button",{onClick:()=>N(t,t._id),className:"hover:underline cursor-pointer flex items-center gap-1 text-amber-500",children:[e.jsx("i",{className:"fa-solid fa-pencil"}),"edit"]})]})]})},le=d.memo(ne);function oe(t){return{projectName:t.projectName,description:t.description??"",duration:t.projectInformation.duration??0,tags:t.projectInformation.tags??[],startDate:t.projectInformation.startDate?new Date(t.projectInformation.startDate):null,endDate:t.projectInformation.endDate?new Date(t.projectInformation.endDate):null,dueDate:t.projectInformation.dueDate?new Date(t.projectInformation.dueDate):null,priority:t.projectInformation.priority??"none",status:t.projectInformation.status??"Active"}}const G=()=>e.jsxs("div",{className:"animate-pulse bg-white border-l-8 border-blue-600 shadow-md rounded-xl p-4 flex flex-col justify-between min-h-[250px] w-full max-w-[500px]",children:[e.jsx("div",{className:"h-5 w-1/2 bg-gray-200 rounded mb-4"}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"h-4 w-4 bg-gray-300 rounded-full"}),e.jsx("div",{className:"h-3 w-1/3 bg-gray-300 rounded"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"h-4 w-4 bg-gray-300 rounded-full"}),e.jsx("div",{className:"h-3 w-1/3 bg-gray-300 rounded"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"h-4 w-4 bg-gray-300 rounded-full"}),e.jsx("div",{className:"h-3 w-1/3 bg-gray-300 rounded"})]}),e.jsx("div",{className:"h-3 bg-gray-300 rounded w-full mb-4"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"h-3 w-1/4 bg-gray-300 rounded"}),e.jsx("div",{className:"h-3 w-1/4 bg-gray-300 rounded"}),e.jsx("div",{className:"h-3 w-1/4 bg-gray-300 rounded"})]})]}),ge=()=>{var T,$;const{organizationId:t}=K(),{openMobileSidebar:N,isMobile:v}=H(),{role:w}=q(x=>x.authStore),[a,i]=d.useState(!1),[n,f]=d.useState(!1),[o,m]=d.useState({projectName:"",description:"",duration:0,tags:[],startDate:new Date,endDate:null,dueDate:null,priority:"none",status:"Active"}),[u,C]=d.useState(null);let{data:l,refetch:j,isPending:g,error:r,isLoading:k}=Y(t);const p=["owner","CTO","staff"],O=d.useCallback((x,h)=>{const L=oe(x);m(L),C(h),f(!0),i(!0)},[]),b=d.useCallback(()=>{i(!1),f(!1)},[]),y=d.useCallback((x,h)=>{O(x,h)},[O]);return k?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4",children:[1,2,3,4].map(x=>e.jsx(G,{},x))}):e.jsxs("div",{className:"w-[100%] flex flex-col h-full min-h-0 ",children:[e.jsxs("header",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex ",children:[v&&e.jsx("button",{onClick:N,className:"mr-3 p-2 rounded-md border-none border-gray-300 hover:bg-gray-100",title:"Open Menu",children:e.jsx("i",{className:"fa-solid fa-bars"})}),e.jsxs("h2",{className:"text-2xl sm:text-3xl font-bold text-[#1f2d3d] flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-diagram-project text-blue-600 text-2xl"}),e.jsx("p",{children:F.PROJECTS})]})]}),p.includes(w)&&e.jsx("div",{onClick:()=>{i(!a)},className:"bg-blue-600  cursor-pointer !h-[40px] !w-[40px] flex justify-center items-center rounded-full",children:e.jsx("i",{className:`fa-solid fa-plus text-white transition-transform duration-300 ${a?"rotate-135":"rotate-0"}`})})]}),e.jsx("hr",{className:"my-2 border-b-1 border-gray-300"}),!r&&!g&&((l==null?void 0:l.length)??0)===0&&e.jsxs("div",{className:"flex h-full flex-col items-center justify-center w-full py-16 text-center text-gray-500",children:[e.jsx("div",{className:"text-6xl mb-4",children:"📂"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"No Projects Found"}),e.jsx("p",{className:"text-sm text-gray-400 mb-4 max-w-md",children:"Looks like you haven’t added any projects yet. Click the “+” button to get started and create your first project."}),e.jsx("button",{onClick:()=>i(!0),className:"bg-blue-600 cursor-pointer hover:bg-blue-700 text-white px-4 py-2 rounded-md transition",children:"Create New Project"})]}),r&&e.jsxs("div",{className:"max-w-xl sm:min-w-[80%]  mx-auto mt-4 p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2 text-xl sm:text-3xl",children:"⚠️ Error Occurred"}),e.jsx("p",{className:"text-red-500  mb-4 text-lg sm:text-xl",children:(($=(T=r==null?void 0:r.response)==null?void 0:T.data)==null?void 0:$.message)||"Failed to load the projects"}),e.jsx(M,{onClick:()=>j(),className:"bg-red-600 text-white px-4 py-2",children:"Retry"})]}),!r&&e.jsxs("div",{className:"h-full flex-1 !overflow-y-auto custom-scrollbar grid md:grid-cols-2 gap-6",children:[g&&[...Array(6)].map((x,h)=>e.jsx(d.Fragment,{children:e.jsx(G,{})},h)),!g&&(l==null?void 0:l.length)>0&&(l==null?void 0:l.map((x,h)=>e.jsx(e.Fragment,{children:e.jsx("div",{className:"h-[256px] sm:!h-[270px] md:!h-[330px] lg:!h-[282px] flex flex-col shadow-md rounded-xl overflow-hidden border-l-8 border-blue-600 bg-white",children:e.jsx(le,{refetch:j,onEdit:y,index:h,project:x,organizationId:t})},x._id)})))]}),a&&e.jsx("div",{onClick:b,className:"fixed inset-0 z-50 bg-black/40 backdrop-blur-sm flex items-center justify-center p-4",children:e.jsx(re,{onClose:b,refetch:j,setShowForm:i,organizationId:t,isEditing:n,setEditForm:m,editForm:o,editProjectId:u})})]})};export{ge as default};
