import{u as N}from"./useQuery-CsoXJJPn.js";import{c as d,d as g}from"./index-DLaY3p7d.js";import{u as h}from"./useMutation-BqZ7KIEa.js";import{u as E}from"./useInfiniteQuery-CNErvLuT.js";import{g as w}from"./roleCheck-BlurDUv2.js";const f="/department/accounting/billpdf",b=async({organizationId:e,page:t,limit:n,search:a,createdFromDate:o,createdToDate:i,sortBy:s,sortOrder:p,api:u})=>{const l=new URLSearchParams;l.append("organizationId",e),t&&l.append("page",t.toString()),n&&l.append("limit",n.toString()),a&&l.append("search",a),o&&l.append("createdFromDate",o),i&&l.append("createdToDate",i),s&&l.append("sortBy",s),p&&l.append("sortOrder",p);const{data:r}=await u.get(`${f}/template/all?${l.toString()}`);if(!r.ok)throw new Error(r.message);return r},_=async({id:e,organizationId:t,api:n})=>{const{data:a}=await n.get(`${f}/template/${e}/${t}`);return a.data},A=async({organizationId:e,templateName:t,layout:n,api:a})=>{const o=new FormData;o.append("organizationId",e),o.append("templateName",t);const i=[],s=n.map(u=>({...u,components:u.components.map(l=>{const r={...l};return r.type==="image"&&r.value&&r.value[0]instanceof File&&(i.push(r.value[0]),r.value=[`__FILE_${i.length-1}__`]),r})}));o.append("layout",JSON.stringify(s)),i.forEach(u=>{o.append("files",u)});const{data:p}=await a.post(`${f}/template`,o,{headers:{"Content-Type":"multipart/form-data"}});return p},S=async({id:e,organizationId:t,layout:n,templateName:a,api:o})=>{const i=new FormData;i.append("organizationId",t),a&&i.append("templateName",a);const s=[],p=n.map(l=>({...l,components:l.components.map(r=>{const c={...r};return c.type==="image"&&c.value&&c.value[0]instanceof File&&(s.push(c.value[0]),c.value=[`__FILE_${s.length-1}__`]),c})}));i.append("layout",JSON.stringify(p)),s.forEach(l=>{i.append("files",l)});const{data:u}=await o.put(`${f}/template/${e}`,i,{headers:{"Content-Type":"multipart/form-data"}});return u},v=async({organizationId:e,projectId:t,customerName:n,templateId:a,layout:o,api:i})=>{const s=new FormData;s.append("organizationId",e),t&&s.append("projectId",t),n&&s.append("customerName",n),a&&s.append("templateId",a);const p=[],u=JSON.parse(JSON.stringify(o)).map(r=>(r.components=r.components.map(c=>(c.type==="image"&&c.value[0]instanceof File&&(p.push(c.value[0]),c.value=[`__FILE_${p.length-1}__`]),c)),r));s.append("layout",JSON.stringify(u)),p.forEach(r=>{s.append("files",r)});const{data:l}=await i.post(`${f}/bill`,s,{headers:{"Content-Type":"multipart/form-data"}});return l},$=async({id:e,organizationId:t,layout:n,customerName:a,projectId:o,billNumber:i,api:s})=>{const p=new FormData;p.append("organizationId",t),a&&p.append("customerName",a),o&&p.append("projectId",o),i&&p.append("billNumber",i);const u=[],l=n.map(c=>({...c,components:c.components.map(m=>m.type==="image"&&typeof m.value[0]!="string"?(u.push(m.value[0]),{...m,value:[`__FILE_${u.length-1}__`]}):m)}));p.append("layout",JSON.stringify(l)),u.forEach(c=>p.append("files",c));const{data:r}=await s.put(`${f}/bill/${e}`,p,{headers:{"Content-Type":"multipart/form-data"}});return r},q=async({organizationId:e,projectId:t,page:n,limit:a,search:o,createdFromDate:i,createdToDate:s,sortBy:p,sortOrder:u,api:l})=>{const r=new URLSearchParams;t&&r.append("projectId",t),n&&r.append("page",n.toString()),a&&r.append("limit",a.toString()),o&&r.append("search",o),i&&r.append("createdFromDate",i),s&&r.append("createdToDate",s),p&&r.append("sortBy",p),u&&r.append("sortOrder",u);const{data:c}=await l.get(`${f}/billall/${e}?${r.toString()}`);return c},F=async({id:e,api:t})=>{const{data:n}=await t.get(`${f}/bill/${e}`);return n.data},P=async({id:e,organizationId:t,api:n})=>{const{data:a}=await n.delete(`${f}/bill/delete/${e}/${t}`);return a},y=["owner","staff","CTO","client"],K=({organizationId:e,limit:t=10,search:n,createdFromDate:a,createdToDate:o,sortBy:i,sortOrder:s})=>{const p=["owner","staff","CTO"],{role:u}=d(),l=w(u);return E({queryKey:["billnew","templates",e,t,n,a,o,i,s],queryFn:async({pageParam:r=1})=>{if(!u||!p.includes(u))throw new Error("Not allowed");if(!l)throw new Error("API instance not found");return await b({organizationId:e,page:r,limit:t,search:n,createdFromDate:a,createdToDate:o,sortBy:i,sortOrder:s,api:l})},getNextPageParam:r=>{if(r.pagination.hasNextPage)return r.pagination.page+1},initialPageParam:1,enabled:!!u&&!!e})},Q=({id:e,organizationId:t})=>{const{role:n}=d(),a=w(n);return N({queryKey:["billnew","template",e,t],queryFn:async()=>{if(!n)throw new Error("Not allowed");if(!a)throw new Error("API instance not found");return await _({id:e,organizationId:t,api:a})},enabled:!!e&&!!t&&!!n})},U=()=>{const{role:e}=d(),t=w(e),n=g();return h({mutationFn:async a=>{if(!e||!y.includes(e))throw new Error("Not allowed");if(!t)throw new Error("API not found");return await A({...a,api:t})},onSuccess:(a,{organizationId:o})=>{n.invalidateQueries({queryKey:["billnew","templates",o]})}})},O=()=>{const{role:e}=d(),t=w(e),n=g();return h({mutationFn:async a=>{if(!e||!y.includes(e))throw new Error("Not allowed");if(!t)throw new Error("API not found");return await S({...a,api:t})},onSuccess:(a,{id:o,organizationId:i})=>{n.invalidateQueries({queryKey:["billnew","templates",i]}),n.invalidateQueries({queryKey:["billnew","template",o]})}})},R=()=>{const{role:e}=d(),t=w(e),n=g();return h({mutationFn:async a=>{if(!e||!y.includes(e))throw new Error("Not allowed");if(!t)throw new Error("API not found");return await v({...a,api:t})},onSuccess:(a,{organizationId:o})=>{n.invalidateQueries({queryKey:["billnew","bills",o]})}})},D=()=>{const{role:e}=d(),t=w(e),n=g();return h({mutationFn:async a=>{if(!e||!y.includes(e))throw new Error("Not allowed");if(!t)throw new Error("API not found");return await $({...a,api:t})},onSuccess:(a,{id:o,organizationId:i})=>{n.invalidateQueries({queryKey:["billnew","bills",i]}),n.invalidateQueries({queryKey:["billnew","bill",o]})}})},J=({organizationId:e,projectId:t,limit:n=10,search:a,createdFromDate:o,createdToDate:i,sortBy:s,sortOrder:p})=>{const{role:u}=d(),l=w(u);return E({queryKey:["billnew","bills",e,t,n,a,o,i,s,p],queryFn:async({pageParam:r=1})=>{if(!u)throw new Error("Not allowed");if(!l)throw new Error("API not found");return await q({organizationId:e,projectId:t,page:r,limit:n,search:a,createdFromDate:o,createdToDate:i,sortBy:s,sortOrder:p,api:l})},getNextPageParam:r=>{if(r.pagination.hasNextPage)return r.pagination.page+1},initialPageParam:1,enabled:!!e&&!!u})},x=({id:e})=>{const{role:t}=d(),n=w(t);return N({queryKey:["billnew","bill",e],queryFn:async()=>{if(!t||!y.includes(t))throw new Error("Not allowed");if(!n)throw new Error("API not found");return await F({id:e,api:n})},enabled:!!e&&!!t})},G=()=>{const{role:e}=d(),t=w(e),n=g();return h({mutationFn:async({id:a,organizationId:o})=>{if(!e||!y.includes(e))throw new Error("Not allowed");if(!t)throw new Error("API not found");return await P({id:a,organizationId:o,api:t})},onSuccess:(a,{organizationId:o})=>{n.invalidateQueries({queryKey:["billnew","bills",o]})}})};export{Q as a,U as b,O as c,J as d,G as e,x as f,R as g,D as h,K as u};
