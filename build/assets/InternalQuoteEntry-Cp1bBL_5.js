import{c as b,e as C,q as Q,d as A,g as w,a as I,b as v,j as e,B as y,t as g,u as E,r as N,M as k,O as _}from"./index-MXS_gbde.js";import{u as q}from"./projectApi-BH0dGL_K.js";import{e as F,f as S}from"./quoteVariantApi-DV1NXuB1.js";import{C as M,a as O}from"./Card-L4jLwmC3.js";import{d as P,f as R}from"./dateFormator-BGKi5rfZ.js";import{S as T}from"./StageGuide-DLy2p25i.js";import{C as D}from"./CreateQuoteModal-CZVd6h3V.js";const L=async({organizationId:t,projectId:a,mainQuoteName:r,quoteCategory:n,quoteType:s,api:i})=>{const{data:l}=await i.post("/quote/quotegenerate/createmainquote",{organizationId:t,projectId:a,mainQuoteName:r,quoteCategory:n,quoteType:s});if(!l.ok)throw new Error(l.message);return l.data},$=async({api:t,organizationId:a,id:r,projectId:n,formData:s})=>{const i=await t.put(`/quote/quotegenerate/editquote/${a}/${n}/${r}`,s);if(!i.data.ok)throw new Error(i.data.message||"Failed to create quote.");return i.data.data},G=async({api:t,id:a})=>{const{data:r}=await t.get(`/quote/quotegenerate/getsinglequote/${a}`);if(!r.ok)throw new Error((r==null?void 0:r.message)||"Failed to fetch materials");return r.data},z=()=>{const{role:t}=b(),a=w(t),r=["owner","staff","CTO"];return C({mutationFn:async({organizationId:n,projectId:s,mainQuoteName:i,quoteCategory:l,quoteType:d})=>{if(!t||!r.includes(t))throw new Error("Unauthorized access");if(!a)throw new Error("API configuration missing");return await L({organizationId:n,quoteType:d,projectId:s,mainQuoteName:i,quoteCategory:l,api:a})},onSuccess:(n,{organizationId:s})=>{Q.invalidateQueries({queryKey:["quote-material-items",s]})}})},te=()=>{const t=["owner","staff","CTO"],{role:a}=b(),r=w(a);return C({mutationFn:async({organizationId:n,projectId:s,formData:i,id:l})=>{if(!a||!t.includes(a))throw new Error("Not allowed to create quotes");if(!r)throw new Error("API instance for role not found");return await $({api:r,organizationId:n,projectId:s,formData:i,id:l})},onSuccess:(n,{organizationId:s})=>{Q.invalidateQueries({queryKey:["quote-material-items",s]})}})},ae=({organizationId:t,id:a})=>{const r=["owner","staff","CTO"],{role:n}=b(),s=w(n);return A({queryKey:["material-item",t,a],queryFn:async()=>{if(!n||!r.includes(n))throw new Error("Not allowed to create quotes");if(!s)throw new Error("API instance for role not found");return await G({api:s,id:a})},enabled:!!t&&!!a})},B=({quote:t,organizationId:a})=>{var x,m,f;const r=I(),{mutateAsync:n,isPending:s}=F(),{role:i,permission:l}=v(),d=i==="owner"||((x=l==null?void 0:l.internalquote)==null?void 0:x.delete),u=async h=>{var j,o;try{await n({id:h,organizationId:a}),g({title:"Success",description:"Items deleted successfully"})}catch(c){g({title:"Error",description:((o=(j=c==null?void 0:c.response)==null?void 0:j.data)==null?void 0:o.message)??"Operation failed"})}};return e.jsx(M,{className:"w-full border-l-4 border-blue-600 shadow-md bg-white hover:shadow-lg transition-all",children:e.jsxs(O,{className:"p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"my-1",children:[e.jsxs("h3",{className:"text-sm font-bold text-blue-700  ",children:["Quote Name: ",e.jsx("span",{className:"text-black",children:(t==null?void 0:t.mainQuoteName)||"Quote"})]}),e.jsxs("p",{className:"text-sm font-semibold text-blue-700  ",children:["Project: ",e.jsx("span",{className:"text-black",children:((m=t==null?void 0:t.projectId)==null?void 0:m.projectName)||"Project"})]}),e.jsxs("span",{className:"text-[12px] font-semibold text-gray-500",children:["Quote No: ",e.jsx("span",{className:"text-black",children:t.quoteNo||"N/A"})]})]}),e.jsxs("p",{className:"text-xs text-gray-500 ",children:["Created on: ",P(t.createdAt)," -  ",R(t.createdAt)]})]}),e.jsx("i",{className:"fas fa-file-alt text-gray-400 text-xl"})]}),e.jsxs("p",{className:"text-sm text-gray-500 italic",children:[e.jsx("strong",{children:"Furnitures: "})," ",((f=t.furnitures)==null?void 0:f.length)||0]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsxs(y,{size:"sm",variant:"secondary",onClick:()=>{r(`single/${t._id}/${t.quoteCategory}`)},children:[e.jsx("i",{className:"fas fa-eye mr-1"})," Edit"]}),d&&e.jsxs(y,{size:"sm",isLoading:s,variant:"danger",className:"bg-red-600 text-white",onClick:()=>u(t._id),children:[e.jsx("i",{className:"fas fa-trash mr-1"})," Delete"]})]})]})})},K=({})=>{var j;const{organizationId:t}=E(),[a,r]=N.useState({projectId:"",projectName:"",createdAt:""}),{role:n,permission:s}=v(),i=n==="owner"||((j=s==null?void 0:s.internalquote)==null?void 0:j.list),{data:l}=q(t),d=l==null?void 0:l.map(o=>({_id:o._id,projectName:o.projectName})),{data:u,isLoading:x}=S(t,{createdAt:a.createdAt,projectId:a.projectId,quoteNo:""}),m=u==null?void 0:u.filter(o=>o.furnitures.length),f=()=>{r({projectId:"",projectName:"",createdAt:""})},h=Object.values(a).filter(Boolean).length;return e.jsx("div",{children:e.jsxs("main",{className:"flex gap-2 !max-h-[80vh]",children:[e.jsx("div",{className:"xl:w-80 flex-shrink-0",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-filter mr-2 text-blue-600"}),"Filters"]}),h>0&&e.jsxs("button",{onClick:f,className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:["Clear All (",h,")"]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Created Date"}),e.jsx("input",{type:"date",onChange:o=>r(c=>({...c,createdAt:o.target.value})),value:a.createdAt,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Project"}),e.jsx("select",{value:(a==null?void 0:a.projectId)||"",onChange:o=>{const c=d==null?void 0:d.find(p=>p._id===o.target.value);c&&r(p=>({...p,projectId:c._id,projectName:c.projectName}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:d==null?void 0:d.map(o=>e.jsx("option",{value:o._id,children:o.projectName},o._id))})]})]})]})}),i&&e.jsx("section",{className:"w-full max-h-full  gap-2  overflow-y-auto  min-h-full",children:x?e.jsx(k,{}):m!=null&&m.length?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:m==null?void 0:m.map(o=>e.jsx(e.Fragment,{children:e.jsx(B,{quote:o,organizationId:t},o._id)}))}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center text-gray-700",children:[e.jsx("i",{className:"fas fa-file-circle-exclamation text-gray-300 text-7xl mb-4"}),e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"No Quotes Found"}),e.jsxs("p",{className:"text-base text-gray-500 leading-relaxed max-w-md",children:["You haven't generated any quote variants yet.",e.jsx("br",{}),"Please create a quote by clicking the + Product section to view brand-wise breakdowns here."]})]})})]})})},V=t=>t.filter(a=>{var r,n;return!!((r=a.itemName)!=null&&r.trim())||!!((n=a.description)!=null&&n.trim())}),U=()=>{var o;const t=I(),{organizationId:a}=E(),{data:r=[]}=q(a),n=z(),[s,i]=N.useState({mainQuoteName:"",quoteCategory:"residential",quoteType:"basic",projectId:""}),{role:l,permission:d}=v(),u=l==="owner"||((o=d==null?void 0:d.internalquote)==null?void 0:o.create),[x,m]=N.useState(!1),f=async()=>{if(!s.mainQuoteName||!s.projectId||!s.quoteType)return g({title:"Error",description:"Please fill all fields",variant:"destructive"});try{const c=await n.mutateAsync({organizationId:a,projectId:s.projectId,mainQuoteName:s.mainQuoteName,quoteType:s.quoteType,quoteCategory:s.quoteCategory});console.log("response",c),t(`single/${c._id}/${c.quoteType}`),m(!1),h()}catch(c){g({title:"Error",description:c.message,variant:"destructive"})}},h=()=>{i({mainQuoteName:"",quoteCategory:"",quoteType:"",projectId:""})};return location.pathname.includes("internalquotenew")||location.pathname.includes("single")?e.jsx(_,{}):e.jsxs("div",{className:"h-full mx-auto max-h-full",children:[e.jsxs("header",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 py-1 border-b-1 border-[#818283]",children:[e.jsx("div",{children:e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-file mr-3 text-blue-600"}),"Internal Quote Entry"]})}),e.jsxs("div",{className:"flex gap-6 items-center ",children:[u&&e.jsxs(y,{className:"flex items-center",onClick:()=>{m(!0)},children:[e.jsx("i",{className:"fas fa-add mr-1",children:" "})," Create"]}),e.jsx("div",{className:"w-full sm:w-auto flex justify-end sm:block",children:e.jsx(T,{organizationId:a,stageName:"materialquote"})})]})]}),x&&e.jsx(D,{formData:s,projectsData:r,setModalOpen:m,setFormData:i,handleSubmit:f}),e.jsx("section",{className:"my-4",children:e.jsx(K,{})})]})},se=Object.freeze(Object.defineProperty({__proto__:null,default:U,filterValidSimpleRows:V},Symbol.toStringTag,{value:"Module"}));export{se as I,te as a,V as f,ae as u};
