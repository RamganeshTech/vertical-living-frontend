import{u as Fe,r as j,f as lt,j as e,B as Q,i as $e,ai as Ve,aj as it,a as He,R as Ke,t as me,k as ct,M as dt}from"./index-BAM0eJUz.js";import{u as mt,a as xt,b as ut,c as pt,f as Oe}from"./InternalQuoteEntry-CBtnEMHM.js";import{c as gt,u as ht}from"./labourRateconfigApi-Dm8CpgW0.js";import{S as Le}from"./SearchSelectNew-IGAHiELy.js";import{C as Je}from"./CreateQuoteModal-C4nTcKOM.js";import{u as ft}from"./projectApi-D7-uwdh2.js";import{I as Ie}from"./Input-1UBXZqEj.js";import{u as bt,a as Nt}from"./rateConfigLabourwithMaterialApi-BALcMkIx.js";import{u as xe}from"./useDebounce-DSMcRuVp.js";import"./quoteVariantApi-SI_JgpSl.js";import"./Card-CdxfjEr-.js";import"./dateFormator-BGKi5rfZ.js";import"./StageGuide-e28gQ0h1.js";import"./Label-C8i6KaZe.js";import"./Select-C6lfB9t-.js";const fe={plywood:1,innerLaminate:1,outerLaminate:1},yt=()=>({itemName:"",materialUsed:"plywood",plywoodNos:{quantity:0,thickness:0},innerLaminate:{quantity:0,thickness:0},outerLaminate:{quantity:0,thickness:0},carpenters:0,days:0,profitOnMaterial:0,profitOnLabour:0,rowTotal:0,remarks:""}),_e=()=>({itemName:"",brandName:"",brandId:"",description:"",quantity:0,cost:0,rowTotal:0}),Pe=(a,U,A=0,D=0)=>{if(a.length===0)return[];const r=a.length,W=D/r,M=a[0],C=M.carpenters*M.days*U*(1+(M.profitOnLabour||0)/100)/r,k=1+A/100;return a.map(w=>{var Z,J,B;const O=((Z=w.plywoodNos)==null?void 0:Z.quantity)||0,re=((J=w.innerLaminate)==null?void 0:J.quantity)||0,_=((B=w.outerLaminate)==null?void 0:B.quantity)||0,V=O*fe.plywood+re*fe.innerLaminate+_*fe.outerLaminate,F=(w.profitOnMaterial||0)>0,L=V*(1+(w.profitOnMaterial||0)/100),I=F?L+C+W:(V+C+W)*k;return{...w,rowTotal:I}})},jt=({data:a,isEditing:U,labourCost:A,duplicateFurniture:D,updateFurniture:r,removeFurniture:W})=>{var R,le,N;const{organizationId:M}=Fe(),[T,P]=j.useState({}),[C,k]=j.useState({}),w=j.useRef({}),{role:O}=lt(),re=["owner","CTO","staff"],_=$e(O),V=async(d,o)=>{if(o)try{if(!O||!re.includes(O))throw new Error("Not allowed to fetch this data");if(!_)throw new Error("API instance not found for role");const s=(await it({api:_,organizationId:M,categoryName:"Accessories/Hardware",itemName:o})).map(t=>{var m,b,g,q,v,S,$,G,X;const n=((m=t.data)==null?void 0:m.Brand)||((b=t.data)==null?void 0:b.brand)||t.data.BrandName||"Unknown",i=((g=t.data)==null?void 0:g.image)||((q=t.data)==null?void 0:q.Image)||((v=t.data)==null?void 0:v.img)||((S=t.data)==null?void 0:S.images)||(($=t.data)==null?void 0:$.Images)||"";return{label:n,value:t!=null&&t._id?String(t._id):"",rate:((G=t.data)==null?void 0:G.Rs)||((X=t.data)==null?void 0:X.rs)||0,imageUrl:i}});P(t=>({...t,[d]:s}))}catch(x){console.error("Error fetching fitting brands:",x)}},F=async(d,o)=>{if(o)try{if(!O||!re.includes(O))throw new Error("Not allowed");if(!_)throw new Error("API instance not found");const s=(await Ve({api:_,organizationId:M,itemName:o})).map(t=>{var m,b,g,q,v,S,$,G,X,ne,Se,ae,se,Te,ue,ke;const n=((m=t.data)==null?void 0:m.Brand)||((b=t.data)==null?void 0:b.BrandName)||((g=t.data)==null?void 0:g.brand)||((q=t.data)==null?void 0:q.brandName)||((v=t.data)==null?void 0:v["Brands light name"])||((S=t.data)==null?void 0:S["Brand "])||(($=t.data)==null?void 0:$["Brands "])||"Unknown",i=((G=t.data)==null?void 0:G.image)||((X=t.data)==null?void 0:X.Image)||((ne=t.data)==null?void 0:ne.img)||((Se=t.data)==null?void 0:Se.images)||((ae=t.data)==null?void 0:ae.Images)||"";return{label:`${n} (${((se=t.categoryName)==null?void 0:se.trim())||"No Cat"})`,value:t!=null&&t._id?String(t._id):"",rate:((Te=t.data)==null?void 0:Te.Rs)||((ue=t.data)==null?void 0:ue.rs)||((ke=t==null?void 0:t.data)==null?void 0:ke.RS)||0,brandOnly:n,imageUrl:i}});k(t=>({...t,[d]:s}))}catch(x){console.error("Error fetching all category items:",x)}};j.useEffect(()=>{var x,s;const d={},o={};(x=a.fittingsAndAccessories)==null||x.forEach((t,n)=>{t.brandId&&t.brandName&&(d[n]=[{label:t.brandName,value:String(t.brandId),rate:t.cost,imageUrl:t.imageUrl}])}),(s=a.nonBrandMaterials)==null||s.forEach((t,n)=>{t.brandId&&t.brandName&&(o[n]=[{label:t.brandName,value:String(t.brandId),brandOnly:t.brandName,rate:t.cost,imageUrl:t.imageUrl}],t.itemName&&F(n,t.itemName))}),P(t=>({...t,...d})),k(t=>({...t,...o}))},[]);const L=d=>{const o=d.coreMaterials.reduce((n,i)=>n+i.rowTotal,0),x=d.fittingsAndAccessories.reduce((n,i)=>n+i.rowTotal,0),s=d.glues.reduce((n,i)=>n+i.rowTotal,0),t=d.nonBrandMaterials.reduce((n,i)=>n+i.rowTotal,0);return{core:o,fittings:x,glues:s,nbms:t,furnitureTotal:o+x+s+t}},I=(d,o,x)=>{const s=[...a.coreMaterials];o==="imageUrl"?(U&&(s[d].newImageFile=x),s[d].imageUrl=x,s[d].previewUrl=URL.createObjectURL(x)):o==="plywoodNos"||o==="innerLaminate"||o==="outerLaminate"?s[d][o]={...s[d][o]||{},...x}:s[d][o]=x;const t=Pe(s,A,a.furnitureProfit||0),n=1+(a.furnitureProfit||0)/100,i=b=>b.map(g=>{const q=(g.quantity||0)*(g.cost||0),v=g.profitOnMaterial||0,S=v>0?q*(1+v/100):q*n;return{...g,rowTotal:S}}),m={...a,coreMaterials:t,fittingsAndAccessories:i(a.fittingsAndAccessories),glues:i(a.glues),nonBrandMaterials:i(a.nonBrandMaterials)};m.totals=L(m),r==null||r(m)},Z=d=>{const o=1+(a.furnitureProfit||0)/100,x=t=>t.map(n=>{const i=(n.quantity||0)*(n.cost||0),b=(n.profitOnMaterial||0)>0?i*(1+(n.profitOnMaterial||0)/100):i*o;return{...n,rowTotal:b}}),s={...a,coreMaterials:d,fittingsAndAccessories:x(a.fittingsAndAccessories),glues:x(a.glues),nonBrandMaterials:x(a.nonBrandMaterials)};s.totals=L(s),r==null||r(s)},J=(d,o,x)=>{const s=x?a.coreMaterials.map(S=>({...S,profitOnMaterial:0,profitOnLabour:0})):a.coreMaterials,t=x?a.fittingsAndAccessories.map(S=>({...S,profitOnMaterial:0})):a.fittingsAndAccessories,n=x?a.glues.map(S=>({...S,profitOnMaterial:0})):a.glues,i=x?a.nonBrandMaterials.map(S=>({...S,profitOnMaterial:0})):a.nonBrandMaterials,m=Pe(s,A,d,o),b=m.reduce((S,$)=>S+$.rowTotal,0),g=m.length>0?b/m.length:0,q=(S,$=!1)=>S.map(G=>{if($||G.itemName==="Glue")return{...G,cost:g,rowTotal:g};const X=G.quantity*G.cost,ne=G.profitOnMaterial||0;return{...G,rowTotal:ne>0?X*(1+ne/100):X*(1+d/100)}}),v={...a,furnitureProfit:d,fabricationCost:o,coreMaterials:m,fittingsAndAccessories:q(t),glues:q(n,!0),nonBrandMaterials:q(i)};v.totals=L(v),r==null||r(v)},B=(d,o,x,s)=>{const t=[...a[d]];if(t[o][x]=s,d!=="glues"){const b=(t[o].quantity||0)*(t[o].cost||0),g=b*((t[o].profitOnMaterial||0)/100);t[o].rowTotal=Math.round(b+g)}else{const b=t[o].cost||0,g=b*((t[o].profitOnMaterial||0)/100);t[o].rowTotal=Math.round(b+g)}const n=o===t.length-1,i=t[o].itemName||t[o].description||t[o].quantity||t[o].cost;n&&i&&t.push(_e());const m={...a,[d]:t};m.totals=L(m),r&&r(m)},ee=()=>{var d;return e.jsxs("div",{className:"mt-4",children:[e.jsxs("h3",{className:"font-semibold text-md mb-2",children:["Core Materials - Total: ₹",(d=a==null?void 0:a.totals)==null?void 0:d.core.toLocaleString("en-IN")]}),e.jsx("div",{className:"overflow-x-auto  rounded-md",children:e.jsxs("table",{className:"min-w-full text-sm bg-white shadow-sm",children:[e.jsxs("thead",{className:"bg-blue-50 text-sm font-semibold text-gray-600",children:[e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Image"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Item Name"}),e.jsx("th",{className:"text-center px-6 py-1 text-xs font-medium text-gray-500 uppercase tracking-wider border-x border-gray-200",colSpan:2,children:"Plywood"}),e.jsx("th",{className:"text-center px-6 py-1 text-xs font-medium text-gray-500 uppercase tracking-wider border-x border-gray-200",colSpan:4,children:"Laminate"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"No. of Carpenters / Day"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"No. of Days"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Profit % Material"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Profit % Labour"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Remarks"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Total"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Actions"})]}),e.jsxs("tr",{className:"",children:[e.jsx("th",{className:"px-2 py-2 text-[10px] uppercase text-gray-500 border-r border-gray-200",children:"Thk"}),e.jsx("th",{className:"px-2 py-2 text-[10px] uppercase text-gray-500 border-r border-gray-200",children:"Qty"}),e.jsx("th",{className:"px-2 py-2 text-[10px]  text-gray-500 uppercase border-r border-gray-200",children:"Outer Thk"}),e.jsx("th",{className:"px-2 py-2 text-[10px]  text-gray-500 uppercase border-r border-gray-200",children:"Outer Qty"}),e.jsx("th",{className:"px-2 py-2 text-[10px]  text-gray-500 uppercase border-r border-gray-200",children:"Inner Thk"}),e.jsx("th",{className:"px-2 py-2 text-[10px]  text-gray-500 uppercase border-r border-gray-200",children:"Inner Qty"})]})]}),e.jsx("tbody",{children:a.coreMaterials.map((o,x)=>e.jsxs("tr",{className:"group relative border-none !border-b-1 px-4 py-2 transition-all duration-150 hover:bg-gray-50",children:[x===0&&e.jsxs("td",{rowSpan:a.coreMaterials.length,children:[e.jsx("input",{type:"file",className:"w-full px-2 py-3 text-center outline-none",onChange:s=>{var t;return I(0,"imageUrl",(t=s.target.files)==null?void 0:t[0])}}),(o.previewUrl||o.imageUrl)&&e.jsx("div",{className:"mt-2 relative group",children:e.jsx("img",{src:o.previewUrl||o.imageUrl,className:"h-16 w-16 object-cover mt-2 mx-auto rounded-lg border shadow-sm",alt:"Product"})})]}),e.jsx("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{value:o.itemName,placeholder:"TV Unit | Wardrobe",onChange:s=>I(x,"itemName",s.target.value),className:"w-full px-2 py-1 text-center outline-none"})}),["plywoodNos","outerLaminate","innerLaminate"].map(s=>["thickness","quantity"].map(t=>e.jsx("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",placeholder:`${t==="quantity"?"QTY":"THK"}`,value:o[s][t]||"",onChange:n=>{Number(n.target.value)>=0&&I(x,s,{...o[s],[t]:Math.max(0,Number(n.target.value))})},className:"w-full px-2 py-1 text-center outline-none"})},`${s}-${t}`))),x===0&&e.jsxs(e.Fragment,{children:[e.jsx("td",{rowSpan:a.coreMaterials.length,className:"px-1 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",placeholder:"no of carpentors",value:o.carpenters||"",onChange:s=>I(x,"carpenters",Math.max(0,Number(s.target.value))),className:"w-full px-[2px] py-1 text-center outline-none"})}),e.jsx("td",{rowSpan:a.coreMaterials.length,className:"px-1 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",placeholder:"no of days",value:o.days||"",onChange:s=>I(x,"days",Math.max(0,Number(s.target.value))),className:"w-full px-[2px] py-1 text-center outline-none"})})]}),e.jsx("td",{className:"px-1 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",placeholder:"profit percent",value:o.profitOnMaterial||"",onChange:s=>I(x,"profitOnMaterial",Math.max(0,Number(s.target.value))),className:"w-full px-[2px] py-1 text-center outline-none"})}),x===0&&e.jsx(e.Fragment,{children:e.jsx("td",{rowSpan:a.coreMaterials.length,className:"px-1 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",placeholder:"profit percent",value:o.profitOnLabour||"",onChange:s=>I(x,"profitOnLabour",Math.max(0,Number(s.target.value))),className:"w-full px-[2px] py-1 text-center outline-none"})})}),e.jsx("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{value:o.remarks,placeholder:"remarks",onChange:s=>I(x,"remarks",s.target.value),className:"w-full px-2 py-1 text-center outline-none"})}),e.jsxs("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:["₹",o.rowTotal.toLocaleString("en-IN",{minimumFractionDigits:0,maximumFractionDigits:2})]}),e.jsx("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx(Q,{variant:"danger",onClick:()=>{const s=[...a.coreMaterials];s.splice(x,1);const t=Pe(s,A,a.furnitureProfit||0);Z(t)},className:"px-1 text-xs bg-red-600 text-white",children:"Remove"})})]},x))})]})}),e.jsx("div",{className:"mt-2 text-right",children:e.jsx(Q,{onClick:()=>{const o=[...a.coreMaterials,yt()],x=Pe(o,A,a.furnitureProfit||0),s={...a,coreMaterials:x};s.totals=L(s),r==null||r(s)},children:"+ Add Core Material"})})]})},te=(d,o)=>{var t;const x=o==="fittingsAndAccessories",s=o==="nonBrandMaterials";return e.jsxs("div",{className:"mt-6",children:[e.jsxs("h3",{className:"font-semibold text-md mb-2",children:[d," - Total: ₹",(t=a==null?void 0:a.totals[o==="fittingsAndAccessories"?"fittings":o==="nonBrandMaterials"?"nbms":"glues"])==null?void 0:t.toLocaleString("en-IN",{minimumFractionDigits:0,maximumFractionDigits:2})]}),e.jsx("div",{className:"overflow-x-auto rounded-md pb-[200px] -mb-[200px]",children:e.jsxs("table",{className:"min-w-full text-sm bg-white shadow-sm border-separate border-spacing-0",children:[e.jsx("thead",{className:"bg-blue-50 text-sm font-semibold text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Item Name"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Description"}),(x||s)&&e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Brand"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Quantity"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cost"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Profit %"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"!overflow-visible",children:a[o].map((n,i)=>e.jsxs("tr",{className:"group relative border-none !border-b-1 px-4 !py-2 transition-all duration-150 hover:bg-gray-50 hover:z-[100] focus-within:z-[100]",children:[e.jsx("td",{className:"p-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{value:n.itemName||"",placeholder:"Item Name",onChange:m=>{const b=m.target.value;B(o,i,"itemName",b),w.current[i]&&clearTimeout(w.current[i]),w.current[i]=setTimeout(()=>{o==="fittingsAndAccessories"?V(i,b):o==="nonBrandMaterials"&&F(i,b)},600)},className:"w-full px-2 py-1 text-center outline-none"})}),e.jsx("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{value:n.description,placeholder:"description",onChange:m=>B(o,i,"description",m.target.value),className:"w-full px-2 py-1 text-center outline-none"})}),(x||s)&&e.jsx("td",{className:"p-2 border border-gray-200 min-w-[200px] !static lg:!relative",children:e.jsx("div",{className:"relative w-full !overflow-visible z-[70]",children:e.jsx(Le,{options:o==="fittingsAndAccessories"?T[i]:C[i]||[],value:(n==null?void 0:n.brandId)||"",placeholder:n!=null&&n.itemName?"Select Brand":"Type item first",onFocus:()=>{var b,g;const m=o;m==="fittingsAndAccessories"&&(!T[i]||((b=T[i])==null?void 0:b.length)<=1)?V(i,n.itemName):m==="nonBrandMaterials"&&(!C[i]||((g=C[i])==null?void 0:g.length)<=1)&&F(i,n.itemName)},className:"!overflow-visible relative z-[110]",onValueChange:m=>{const g=(o==="fittingsAndAccessories"?T[i]:C[i]||[]).find(q=>String(q.value)===String(m));if(g){B(o,i,"brandId",g==null?void 0:g.value);const v=o==="nonBrandMaterials"&&(g==null?void 0:g.brandOnly)||(g==null?void 0:g.label);console.log("Selected Object:",g),console.log("Kind being processed:",o),B(o,i,"brandName",v),B(o,i,"cost",g==null?void 0:g.rate),B(o,i,"imageUrl",(g==null?void 0:g.imageUrl)||"")}}})})}),e.jsx("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",placeholder:"enter quantity",value:n.quantity||"",onChange:m=>{Number(m.target.value)>=0&&B(o,i,"quantity",Math.max(0,Number(m.target.value)))},className:"w-full px-2 py-1 text-center outline-none"})}),e.jsx("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",value:n.cost||"",placeholder:"enter cost",onChange:m=>B(o,i,"cost",Math.max(0,Number(m.target.value))),className:"w-full px-2 py-1 text-center outline-none"})}),e.jsx("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",placeholder:"enter profit",value:(n.profitOnMaterial??0)||"",onChange:m=>B(o,i,"profitOnMaterial",Math.max(0,Number(m.target.value))),className:"w-full px-2 py-1 text-center outline-none"})}),e.jsxs("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:["₹",n.rowTotal.toLocaleString("en-IN",{minimumFractionDigits:0,maximumFractionDigits:2})]}),e.jsx("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx(Q,{variant:"danger",onClick:()=>{const m=[...a[o]];m.splice(i,1);const b={...a,[o]:m};b.totals=L(b),r&&r(b)},className:"px-1 text-xs bg-red-600 text-white",children:"Remove"})})]},i))})]})}),e.jsx("div",{className:"mt-2 text-right",children:e.jsxs(Q,{onClick:()=>{const n=[...a[o],_e()],i={...a,[o]:n};i.totals=L(i),r&&r(i)},children:["+ Add ",d," Item"]})})]})};return e.jsxs("div",{className:"shadow-md p-4 my-4 border rounded-lg bg-white",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-xs font-bold text-gray-400 uppercase",children:"Product Name:"}),e.jsx("input",{value:a.furnitureName,onChange:d=>r==null?void 0:r({...a,furnitureName:d.target.value}),className:"text-xl font-semibold text-gray-700 border-b border-transparent hover:border-gray-300 focus:border-blue-500 outline-none bg-transparent"})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 p-1.5 bg-gray-50/50 rounded-lg w-fit",children:[e.jsx("label",{className:"text-[10px] font-bold text-gray-500 uppercase tracking-wider ml-1",children:"Dimensions (ft)"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center bg-blue-50 border border-blue-100 rounded-md px-2 py-0.5",children:[e.jsx("span",{className:"text-[10px] font-bold text-blue-500 mr-1",children:"H"}),e.jsx("input",{type:"number",value:((R=a.dimention)==null?void 0:R.height)||0,onChange:d=>r==null?void 0:r({...a,dimention:{...a.dimention,height:Number(d.target.value)}}),className:"w-12 bg-transparent text-sm font-medium text-blue-700 outline-none text-center"})]}),e.jsxs("div",{className:"flex items-center bg-green-50 border border-green-100 rounded-md px-2 py-0.5",children:[e.jsx("span",{className:"text-[10px] font-bold text-green-500 mr-1",children:"W"}),e.jsx("input",{type:"number",value:((le=a.dimention)==null?void 0:le.width)||0,onChange:d=>r==null?void 0:r({...a,dimention:{...a.dimention,width:Number(d.target.value)}}),className:"w-12 bg-transparent text-sm font-medium text-green-700 outline-none text-center"})]}),e.jsxs("div",{className:"flex items-center bg-purple-50 border border-purple-100 rounded-md px-2 py-0.5",children:[e.jsx("span",{className:"text-[10px] font-bold text-purple-500 mr-1",children:"D"}),e.jsx("input",{type:"number",value:((N=a.dimention)==null?void 0:N.depth)||0,onChange:d=>r==null?void 0:r({...a,dimention:{...a.dimention,depth:Number(d.target.value)}}),className:"w-12 bg-transparent text-sm font-medium text-purple-700 outline-none text-center"})]})]})]})]}),e.jsxs("div",{className:"flex gap-2 self-start",children:[D&&e.jsx(Q,{size:"sm",onClick:D,className:"bg-blue-600 text-white",children:"Duplicate Product"}),W&&e.jsx(Q,{variant:"danger",size:"sm",onClick:W,className:"bg-red-600 text-white",children:"Remove Product"})]})]}),ee(),te("Fittings","fittingsAndAccessories"),te("Glues","glues"),te("Non-Branded Materials","nonBrandMaterials"),e.jsxs("div",{className:"mt-6 flex flex-wrap items-center justify-end gap-4 border-t pt-4",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-orange-50 px-3 py-1 rounded-lg border border-orange-100 shadow-sm",children:[e.jsx("label",{className:"text-[11px] font-bold text-orange-600 uppercase tracking-tight",children:"Fabrication Cost"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-orange-600 mr-1 text-sm",children:"₹"}),e.jsx("input",{type:"number",className:"w-20 text-right font-bold bg-transparent outline-none text-orange-800",value:a.fabricationCost??"",placeholder:"0",onChange:d=>J(a.furnitureProfit||0,Math.max(0,Number(d.target.value)),!1)})]})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-blue-50 px-3 py-1 rounded-lg border border-blue-100 shadow-sm",children:[e.jsx("label",{className:"text-[11px] font-bold text-blue-600 uppercase tracking-tight",children:"Product Profit Overlay"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"number",className:"w-12 text-right font-bold bg-transparent outline-none text-blue-800",value:a.furnitureProfit??"",placeholder:"0",onChange:d=>J(Math.max(0,Number(d.target.value)),a.fabricationCost||0,!0)}),e.jsx("span",{className:"text-blue-600 font-bold ml-1 text-sm",children:"%"})]})]}),e.jsxs("div",{className:"text-right text-xl text-green-700 font-bold ml-4",children:["Product Total: ₹",Math.round(a.totals.furnitureTotal).toLocaleString("en-IN")]})]})]})},vt=({data:a,id:U,organizationId:A,projectData:D})=>{var o,x;const r=He(),{data:W}=bt(A),M=((o=W==null?void 0:W[0])==null?void 0:o._id)||null,{data:T}=Nt(A,M),P=Ke.useMemo(()=>!T||!Array.isArray(T)?[]:T.map(s=>{var t,n;return{_id:s._id,workType:((t=s.data)==null?void 0:t["work type"])||s.categoryName||"Unknown Work",rs:Number((n=s.data)==null?void 0:n.Rs)||0,categoryId:s.categoryId}}),[T]),C={workType:"",workId:null,sqftRate:0,sections:[],totalArea:0,profit:0,totalCost:0},[k,w]=j.useState(()=>{const s=a==null?void 0:a.sqftRateWork;return s&&s.length>0?s:[C]}),[O,re]=j.useState((a==null?void 0:a.globalProfitPercent)||0),[_,V]=j.useState(!1),[F,L]=j.useState(null),[I,Z]=j.useState({mainQuoteName:(a==null?void 0:a.mainQuoteName)||"",quoteCategory:(a==null?void 0:a.quoteCategory)||"",quoteType:(a==null?void 0:a.quoteType)||"sqft_rate",projectId:((x=a==null?void 0:a.projectId)==null?void 0:x._id)||(a==null?void 0:a.projectId)}),J=xe(k,500),B=xe(O,500);j.useEffect(()=>{if(k.filter(n=>n.workId!==null).length===0)return;(async()=>{await d(!1)})()},[J,B]);const{mutateAsync:ee,isPending:te}=mt(),R=(s,t)=>{const n=s.map(i=>{var v;const m=((v=i.sections)==null?void 0:v.reduce((S,$)=>S+($.totalArea||0),0))||0,b=m*(i.sqftRate||0),g=t!==void 0?t:i.profit??O,q=b+b*g/100;return{...i,totalArea:m,profit:g,totalCost:q}});w(n)},le=s=>{re(s);const t=k.map(n=>({...n,profit:s}));R(t,s)},N=(s,t)=>{const n=[...k];n[s].profit=t,R(n)},d=async(s=!1)=>{const t=k.filter(i=>i.workId!==null),n=t.reduce((i,m)=>i+(m.totalCost||0),0);try{await ee({id:U,organizationId:A,projectId:I.projectId,formData:{sqftRateWork:t,grandTotal:n,globalProfitPercent:O,notes:"Updated via frontend"}}),s&&me({title:"Success",description:"Quote saved successfully"})}catch(i){me({title:"Error",description:i.message,variant:"destructive"})}};return e.jsxs("div",{className:"max-h-full overflow-y-auto flex flex-col h-full bg-slate-50",children:[e.jsx("header",{className:"bg-white border-b px-6 py-4 shadow-sm sticky top-0 z-40",children:e.jsxs("div",{className:"max-w-[1600px] mx-auto flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>r(-1),className:"p-2.5 hover:bg-slate-100 text-slate-600 rounded-xl border border-slate-200 transition-colors",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h1",{className:"text-2xl font-black text-slate-900",children:a==null?void 0:a.mainQuoteName}),e.jsx("button",{onClick:()=>{Z(()=>({mainQuoteName:a==null?void 0:a.mainQuoteName,quoteCategory:a==null?void 0:a.quoteCategory,quoteType:a==null?void 0:a.quoteType,projectId:a==null?void 0:a.projectId})),V(!0)},className:"p-1.5 hidden text-blue-600 hover:bg-blue-50 rounded-md transition-colors",children:e.jsx("i",{className:"fas fa-edit text-sm"})})]}),e.jsxs("p",{className:"text-[10px] text-slate-400 font-bold uppercase tracking-[0.2em]",children:["Sqft Rate Mode • ",a.quoteNo]})]})]}),e.jsxs("div",{className:"flex items-center gap-10",children:[e.jsxs("div",{className:"bg-blue-50/50 border border-blue-100 p-2 px-4 rounded-2xl flex items-center gap-3",children:[e.jsx("p",{className:"text-[10px] font-black text-blue-600 uppercase tracking-tighter",children:"Global Profit"}),e.jsxs("div",{className:"flex items-center bg-white border border-blue-200 rounded-lg px-2 shadow-sm",children:[e.jsx("input",{type:"number",className:"w-10 bg-transparent text-center font-black text-blue-700 outline-none h-8",value:O,onChange:s=>le(Math.max(0,Number(s.target.value)))}),e.jsx("span",{className:"text-blue-300 font-bold text-[10px]",children:"%"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"flex items-center justify-end gap-2 mb-1",children:te?e.jsxs("span",{className:"text-[10px] text-blue-500 animate-pulse font-bold uppercase flex items-center",children:[e.jsx("i",{className:"fas fa-sync fa-spin mr-1"})," Syncing..."]}):e.jsxs("span",{className:"text-[10px] text-slate-400 font-bold uppercase flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle mr-1 text-green-500"})," Saved"]})}),e.jsx("p",{className:"text-[10px] font-black text-slate-400 uppercase mb-0.5",children:"Grand Total Estimate"}),e.jsxs("p",{className:"text-3xl font-black text-green-600 leading-none",children:["₹",k.reduce((s,t)=>s+(t.totalCost||0),0).toLocaleString("en-IN")]})]}),e.jsx("div",{className:"flex gap-3",children:e.jsx(Q,{onClick:()=>d(!0),isLoading:te,className:"bg-blue-600 hover:bg-blue-700 shadow-lg shadow-blue-100 min-w-[140px]",children:"Save Changes"})})]})]})}),e.jsx("main",{className:"flex-1 p-8 overflow-visible",children:e.jsxs("div",{className:"bg-white rounded-[2rem] shadow-sm border border-slate-200 p-8 overflow-visible max-w-[1400px] mx-auto",children:[e.jsx("div",{className:"overflow-visible",children:e.jsxs("table",{className:"w-full border-separate border-spacing-y-2",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-[11px] uppercase font-black text-slate-800 tracking-wider",children:[e.jsxs("th",{className:"text-left px-4 w-[35%]",children:["Work Type ",e.jsx("span",{className:"text-slate-900",children:"*"})]}),e.jsx("th",{className:"text-left px-4",children:"Rate/Sqft"}),e.jsx("th",{className:"text-left px-4",children:"Area (Sqft)"}),e.jsx("th",{className:"text-left px-4",children:"Profit %"}),e.jsx("th",{className:"text-right px-4",children:"Subtotal"}),e.jsx("th",{className:"w-10"})]})}),e.jsx("tbody",{children:k.map((s,t)=>e.jsxs("tr",{className:"group relative z-10 hover:z-20",children:[e.jsx("td",{className:"px-2 py-1",children:e.jsx("div",{className:"relative min-w-[280px]",children:e.jsx(Le,{options:P.map(n=>({value:n._id,label:n.workType})),value:s.workId,onValueChange:n=>{const i=P.find(b=>b._id===n),m=[...k];m[t]={...m[t],workId:n,workType:(i==null?void 0:i.workType)||"",sqftRate:(i==null?void 0:i.rs)||0,profit:O},t===m.length-1&&n&&m.push({...C,profit:O}),R(m)}})})}),e.jsx("td",{className:"px-4 py-1",children:e.jsxs("div",{className:"flex items-center gap-1 font-bold text-slate-600",children:[e.jsx("span",{className:"text-[10px] opacity-40",children:"₹"}),s.sqftRate]})}),e.jsx("td",{className:"px-4 py-1",children:e.jsxs("button",{onClick:()=>L(t),className:"flex items-center gap-2 bg-blue-50 text-blue-700 px-3 py-2 rounded-xl border border-blue-100 hover:bg-blue-600 hover:text-white transition-all font-bold text-sm",children:[e.jsx("i",{className:"fas fa-calculator text-[10px] opacity-50"}),s.totalArea.toFixed(2)]})}),e.jsx("td",{className:"px-4 py-1",children:e.jsxs("div",{className:"relative w-20",children:[e.jsx(Ie,{type:"number",className:"h-9 font-black text-center pr-6 border-slate-200 focus:border-blue-400",value:s.profit!==void 0?s.profit:"",onChange:n=>N(t,Math.max(0,Number(n.target.value)))}),e.jsx("span",{className:"absolute right-2 top-1/2 -translate-y-1/2 text-[10px] font-bold text-slate-400",children:"%"})]})}),e.jsxs("td",{className:"px-4 py-1 text-right font-black text-slate-900",children:["₹",s.totalCost.toLocaleString("en-in")]}),e.jsx("td",{className:"px-4 py-1",children:e.jsx("button",{onClick:()=>{const n=k.filter((i,m)=>m!==t);n.length===0&&n.push({workType:"",workId:null,sqftRate:0,sections:[],totalArea:0,profit:O,totalCost:0}),w(n)},className:"text-red-500 cursor-pointer transition-opacity",children:e.jsx("i",{className:"fas fa-trash-alt"})})})]},t))})]})}),e.jsx("div",{className:"flex justify-end mt-6",children:e.jsxs(Q,{variant:"ghost",className:"text-blue-600 hover:bg-blue-50 font-bold border-2 border-dashed border-blue-100 rounded-xl",onClick:()=>{w([...k,{workType:"",workId:null,sqftRate:0,sections:[],totalArea:0,profit:void 0,totalCost:0}])},children:[e.jsx("i",{className:"fas fa-plus-circle mr-2"})," Add Work"]})})]})}),_&&e.jsx(Je,{isEditing:!0,formData:I,projectsData:D,setModalOpen:V,setFormData:Z,handleSubmit:()=>V(!1)}),F!==null&&e.jsx(wt,{work:k[F],onClose:()=>{R(k),L(null)},onUpdate:s=>{const t=[...k];t[F].sections=s,w(t)}})]})},wt=({work:a,onClose:U,onUpdate:A})=>{const D=a.sections||[],r=()=>{A([...D,{height:0,width:0,multiplier:1,totalArea:0}])};Ke.useEffect(()=>{D.length===0&&A([{height:0,width:0,multiplier:1,totalArea:0}])},[]);const W=(M,T,P)=>{const C=[...D];C[M][T]=P,C[M].totalArea=C[M].height*C[M].width*(C[M].multiplier||1),M===C.length-1&&P>0&&C.push({height:0,width:0,multiplier:1,totalArea:0}),A(C)};return e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-slate-900/60 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"bg-white rounded-[2rem] w-full max-w-3xl shadow-2xl animate-in zoom-in-95 duration-200",children:[e.jsxs("div",{className:"p-8 border-b flex justify-between items-center bg-blue-600 rounded-t-[2rem]",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-black text-xl leading-none mb-1",children:"Area Measurement"}),e.jsx("p",{className:"text-blue-100 text-[10px] font-bold uppercase tracking-widest",children:a.workType||"Calculation"})]}),e.jsx("button",{onClick:U,className:"w-10 h-10 flex items-center justify-center text-white/60 hover:text-white hover:bg-white/10 rounded-full transition-all",children:e.jsx("i",{className:"fas fa-times text-xl"})})]}),e.jsxs("div",{className:"p-8 overflow-visible",children:[e.jsxs("table",{className:"w-full border-separate border-spacing-y-3",children:[e.jsx("thead",{className:"text-slate-400 text-[10px] uppercase font-black tracking-widest",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-2",children:"Height / Length"}),e.jsx("th",{className:"text-left px-2",children:"Width / Breadth"}),e.jsx("th",{className:"text-left px-2",children:"Multiplier"}),e.jsx("th",{className:"text-right px-2",children:"Total Area"}),e.jsx("th",{className:"w-10"})]})}),e.jsx("tbody",{children:D.map((M,T)=>e.jsxs("tr",{className:"group",children:[e.jsx("td",{className:"px-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ie,{type:"number",value:M.height,onChange:P=>W(T,"height",Math.max(0,Number(P.target.value))),className:"h-11 w-full font-bold pl-8"}),e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-[10px] font-bold text-slate-300",children:"H"})]})}),e.jsx("td",{className:"px-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ie,{type:"number",value:M.width,onChange:P=>W(T,"width",Math.max(0,Number(P.target.value))),className:"h-11 w-full font-bold pl-8"}),e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-[10px] font-bold text-slate-300",children:"W"})]})}),e.jsx("td",{className:"px-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ie,{type:"number",value:M.multiplier,onChange:P=>W(T,"multiplier",Math.max(0,Number(P.target.value))),className:"h-11 w-full font-bold pl-8"}),e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-[10px] font-bold text-slate-300",children:"X"})]})}),e.jsxs("td",{className:"px-2 text-right",children:[e.jsx("span",{className:"text-lg font-black text-blue-600",children:M.totalArea.toFixed(2)}),e.jsx("span",{className:"text-[10px] font-bold text-slate-300 ml-1",children:"SQFT"})]}),e.jsx("td",{className:"px-2 text-right",children:e.jsx("button",{onClick:()=>A(D.filter((P,C)=>C!==T)),className:"w-8 h-8 flex items-center justify-center text-slate-300 hover:text-red-500 transition-colors",children:e.jsx("i",{className:"fas fa-trash-alt"})})})]},T))})]}),e.jsx("div",{className:"flex justify-end mt-6",children:e.jsxs(Q,{variant:"outline",size:"sm",className:"border-blue-200 text-blue-600 font-bold px-4",onClick:r,children:[e.jsx("i",{className:"fas fa-plus mr-2"})," Add Measurement"]})})]}),e.jsxs("div",{className:"p-8 border-t bg-slate-50 flex justify-between items-center rounded-b-[2rem]",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"bg-white p-3 rounded-2xl border border-slate-200 shadow-sm",children:[e.jsx("p",{className:"text-[9px] font-black text-slate-400 uppercase tracking-tighter leading-none mb-1",children:"Total Square Footage"}),e.jsxs("p",{className:"text-2xl font-black text-slate-900 leading-none",children:[D.reduce((M,T)=>M+T.totalArea,0).toFixed(2)," ",e.jsx("span",{className:"text-sm font-bold text-slate-400",children:"Sqft"})]})]})}),e.jsx(Q,{onClick:U,className:"bg-blue-600 hover:bg-blue-700 px-10 h-12 rounded-xl shadow-lg shadow-blue-100 font-bold",children:"Apply & Save"})]})]})})},Qt=()=>{var Ue,Ee,Qe;const a=He(),{organizationId:U,id:A,quoteType:D}=Fe(),{data:r,isLoading:W,refetch:M}=xt({organizationId:U,id:A}),[T,P]=j.useState(!1),{data:C=[]}=ft(U),k=ut(),[w,O]=j.useState({mainQuoteName:"",quoteCategory:"residential",quoteType:"basic",projectId:""}),re=async()=>{if(console.log("Submitting Form Data:",w),!w.mainQuoteName||!w.projectId||!w.quoteCategory)return me({title:"Error",description:"Please fill all fields",variant:"destructive"});try{console.log("Calling API..."),await k.mutateAsync({organizationId:U,id:A,projectId:w.projectId,mainQuoteName:w.mainQuoteName,quoteCategory:w.quoteCategory,quoteType:w.quoteType}),P(!1),me({title:"Success",description:"Updated successfully"}),M()}catch(c){me({title:"Error",description:c.message,variant:"destructive"})}},[_,V]=j.useState({}),F=j.useRef({}),{role:L,permission:I}=ct(),Z=["owner","CTO","staff"],J=$e(L),B=async(c,l)=>{if(l)try{if(!L||!Z.includes(L))throw new Error("Not allowed");if(!J)throw new Error("API instance not found");const u=(await Ve({api:J,organizationId:U,itemName:l})).map(f=>{var K,Y,oe,ie,ce,H,ge,be,he,Ne,ye,je,ve,we,Me,Ce;const h=((K=f.data)==null?void 0:K.Brand)||((Y=f.data)==null?void 0:Y.BrandName)||((oe=f.data)==null?void 0:oe.brand)||((ie=f.data)==null?void 0:ie.brandName)||((ce=f.data)==null?void 0:ce["Brands light name"])||((H=f.data)==null?void 0:H["Brand "])||((ge=f.data)==null?void 0:ge["Brands "])||"Unknown",y=((be=f.data)==null?void 0:be.image)||((he=f.data)==null?void 0:he.Image)||((Ne=f.data)==null?void 0:Ne.img)||((ye=f.data)==null?void 0:ye.images)||((je=f.data)==null?void 0:je.Images)||"";return{label:`${h} (${((ve=f.categoryName)==null?void 0:ve.trim())||"No Cat"})`,value:f!=null&&f._id?String(f._id):"",rate:((we=f.data)==null?void 0:we.Rs)||((Me=f.data)==null?void 0:Me.rs)||((Ce=f==null?void 0:f.data)==null?void 0:Ce.RS)||0,brandOnly:h,imageUrl:y}});V(f=>({...f,[c]:u}))}catch(p){console.error("Error fetching all category items:",p)}};j.useEffect(()=>{var l;const c={};(l=r==null?void 0:r.commonMaterials)==null||l.forEach((p,u)=>{p.brandId&&p.brandName&&(c[u]=[{label:p.brandName,value:String(p.brandId),brandOnly:p.brandName,rate:p.cost,imageUrl:p.imageUrl}],p.itemName&&B(u,p.itemName))}),V(p=>({...p,...c}))},[]),j.useEffect(()=>{if(D==="basic"&&r!=null&&r.furnitures&&Array.isArray(r.furnitures)){const c=r.furnitures.map(l=>({...l,coreMaterials:l.coreMaterials.map(p=>({...p,innerLaminate:p.innerLaminate||{quantity:0,thickness:0},outerLaminate:p.outerLaminate||{quantity:0,thickness:0}})),totals:{core:l.coreMaterialsTotal||0,fittings:l.fittingsAndAccessoriesTotal||0,glues:l.gluesTotal||0,nbms:l.nonBrandMaterialsTotal||0,furnitureTotal:l.furnitureTotal||0}}));d(c)}},[r]);const[ee,te]=j.useState(0),[R,le]=j.useState(0);j.useEffect(()=>{r&&(te((r==null?void 0:r.globalTransportation)||0),le((r==null?void 0:r.globalProfitPercent)||0),b((r==null?void 0:r.commonProfitOverride)||0))},[r]);const[N,d]=j.useState([]),[o,x]=j.useState(!1),[s,t]=j.useState(""),[n,i]=j.useState([]),[m,b]=j.useState(0);j.useEffect(()=>{r!=null&&r.commonMaterials&&i(r.commonMaterials)},[r]);const g=c=>{b(c),i(l=>l.map(p=>({...p,profitOnMaterial:0})))},q=()=>N.reduce((l,p)=>l+p.coreMaterials.length+p.fittingsAndAccessories.length+p.glues.length+p.nonBrandMaterials.length,0)+n.length,v=(c,l,p)=>{i(u=>{const f=[...u],h={...f[c],[l]:p},y=Number(h.quantity)||0,K=Number(h.cost)||0,Y=Number(h.profitOnMaterial)||0,oe=y*K,ie=1+Y/100,ce=1+R/100;return h.rowTotal=oe*ie*ce,f[c]=h,c===f.length-1&&(h.itemName||h.cost>0)&&f.push(pe()),console.log("updated",f),console.log("State updated successfully for:",l,p),f})},S=c=>{i(l=>l.filter((p,u)=>u!==c))},$=()=>e.jsx("div",{className:"overflow-x-auto rounded-md  pb-[200px] -mb-[200px] !overflow-y-visible",children:e.jsxs("table",{className:"min-w-full text-sm bg-white shadow-sm border-separate border-spacing-0 !overflow-visible",children:[e.jsx("thead",{className:"bg-blue-50 text-sm font-semibold text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Item Name"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Description"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Brand"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Quantity"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Cost"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Profit %"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"!overflow-visible",children:(n.length>0?n:[pe()]).map((c,l)=>{var p;return e.jsxs("tr",{className:"group relative border-none !border-b-1 px-4 !py-2 transition-all duration-150 hover:bg-gray-50 hover:z-[100] focus-within:z-[100]",children:[e.jsx("td",{className:"p-2 border-r border-gray-100",children:e.jsx("input",{value:c.itemName||"",onChange:u=>{const f=u.target.value;v(l,"itemName",f),F.current[l]&&clearTimeout(F.current[l]),F.current[l]=setTimeout(()=>{B(l,f)},600)},className:"w-full text-center outline-none bg-transparent",placeholder:"e.g. Screws"})}),e.jsx("td",{className:"p-2 border-r border-gray-100",children:e.jsx("input",{value:c.description||"",onChange:u=>v(l,"description",u.target.value),className:"w-full text-center outline-none bg-transparent",placeholder:"details"})}),e.jsx("td",{className:"p-2 border border-gray-200 min-w-[200px] !static lg:!relative",children:e.jsx("div",{className:"relative w-full !overflow-visible z-[70]",children:e.jsx(Le,{options:_[l]||[],value:(c==null?void 0:c.brandId)||"",placeholder:c!=null&&c.itemName?"Select Brand":"Type item first",onFocus:()=>{(!_[l]||_[l].length<=1)&&B(l,c.itemName)},className:"!overflow-visible relative z-[110]",onValueChange:u=>{const f=_[l]||[];console.log("options",f);const h=f.find(y=>String(y.value)===String(u));if(console.log("selected",h),h){const y=(h==null?void 0:h.brandOnly)||(h==null?void 0:h.label);v(l,"brandId",h==null?void 0:h.value),v(l,"brandName",y),v(l,"cost",h==null?void 0:h.rate),v(l,"imageUrl",(h==null?void 0:h.imageUrl)||"")}}})})}),e.jsx("td",{className:"p-2 border-r border-gray-100",children:e.jsx("input",{type:"number",value:c.quantity||"",onChange:u=>v(l,"quantity",Math.max(0,Number(u.target.value))),className:"w-full text-center outline-none bg-transparent"})}),e.jsx("td",{className:"p-2 border-r border-gray-100",children:e.jsx("input",{type:"number",value:c.cost||"",onChange:u=>v(l,"cost",Math.max(0,Number(u.target.value))),className:"w-full text-center outline-none bg-transparent"})}),e.jsx("td",{className:"p-2 border-r border-gray-100",children:e.jsx("input",{type:"number",value:c.profitOnMaterial||"",onChange:u=>v(l,"profitOnMaterial",Math.max(0,Number(u.target.value))),className:"w-full text-center outline-none bg-transparent",placeholder:"0"})}),e.jsxs("td",{className:"p-2 border-r border-gray-100 font-bold text-gray-700 text-center",children:["₹",(p=c.rowTotal)==null?void 0:p.toLocaleString("en-IN",{maximumFractionDigits:2})]}),e.jsx("td",{className:"p-2 text-center",children:e.jsx(Q,{variant:"danger",size:"sm",onClick:()=>S(l),children:"Remove"})})]},l)})})]})}),G=L==="owner"||((Ue=I==null?void 0:I.internalquote)==null?void 0:Ue.create),X=L==="owner"||((Ee=I==null?void 0:I.internalquote)==null?void 0:Ee.edit),[ne,Se]=j.useState({categoryId:"",categoryName:""});let{data:ae=0}=gt({organizationId:U,categoryId:ne.categoryId}),{data:se=[]}=ht(U);j.useEffect(()=>{if(se&&(se==null?void 0:se.length)>0&&!ne.categoryId){const c=se[0];Se({categoryId:c._id,categoryName:c.name})}},[se]),j.useEffect(()=>{const c=q(),l=c>0?ee/c:0;d(f=>f.map(h=>{if(h.coreMaterials.length===0)return h;const y=R??(h.furnitureProfit||0),K=1+y/100,Y=h.coreMaterials[0],ce=(Y.carpenters||0)*(Y.days||0)*ae*(1+(Y.profitOnLabour||0)/100)/h.coreMaterials.length,H=h.coreMaterials.map(E=>{var We,Ge,ze;const z=(((We=E.plywoodNos)==null?void 0:We.quantity)||0)*fe.plywood,de=(((Ge=E.innerLaminate)==null?void 0:Ge.quantity)||0)*fe.innerLaminate,qe=(((ze=E.outerLaminate)==null?void 0:ze.quantity)||0)*fe.outerLaminate,ot=(z+de+qe)*(1+(E.profitOnMaterial||0)/100);return{...E,rowTotal:(ot+ce)*K+l}}),ge=H.reduce((E,z)=>E+z.rowTotal,0),be=H.length>0?ge/H.length:0,he=(E,z=!1)=>E.map(de=>{if(z)return{...de,rowTotal:be+l};const qe=z?be:(de.quantity||0)*(de.cost||0),De=1+(de.profitOnMaterial||0)/100;return{...de,rowTotal:qe*De*K+l}}),Ne=he(h.fittingsAndAccessories),ye=he(h.glues,!0),je=he(h.nonBrandMaterials),ve=H.reduce((E,z)=>E+z.rowTotal,0),we=Ne.reduce((E,z)=>E+z.rowTotal,0),Me=ye.reduce((E,z)=>E+z.rowTotal,0),Ce=je.reduce((E,z)=>E+z.rowTotal,0);return{...h,furnitureProfit:y,coreMaterials:H,fittingsAndAccessories:Ne,glues:ye,nonBrandMaterials:je,totals:{core:Math.round(ve),fittings:Math.round(we),glues:Math.round(Me),nbms:Math.round(Ce),furnitureTotal:Math.round(ve+we+Me+Ce)}}}));const u=1+(m??R)/100;i(f=>f.map(h=>{const y=(h.quantity||0)*(h.cost||0),K=1+(h.profitOnMaterial||0)/100;return{...h,rowTotal:y*K*u+l}}))},[ee,R,ae,m]);const{mutateAsync:Te,isPending:ue}=pt(),ke=(N==null?void 0:N.reduce((c,l)=>{var p;return c+(((p=l==null?void 0:l.totals)==null?void 0:p.furnitureTotal)||0)},0))||0,Xe=(n==null?void 0:n.reduce((c,l)=>c+((l==null?void 0:l.rowTotal)||0),0))||0,Ae=(N==null?void 0:N.length)>0?ke+Xe:0,Be=async(c=!0)=>{var l,p;try{const u=new FormData,f=N.map((y,K)=>{const Y=y.coreMaterials.map((oe,ie)=>{const{previewUrl:ce,newImageFile:H,...ge}=oe;return H&&u.append(`images[${K}][${ie}]`,H),{...ge,imageUrl:oe.imageUrl||null}});return{furnitureName:y.furnitureName,dimention:y.dimention,furnitureProfit:y.furnitureProfit,coreMaterials:Y,fittingsAndAccessories:Oe(y.fittingsAndAccessories),glues:Oe(y.glues),nonBrandMaterials:Oe(y.nonBrandMaterials),coreMaterialsTotal:y.totals.core,fittingsAndAccessoriesTotal:y.totals.fittings,gluesTotal:y.totals.glues,nonBrandMaterialsTotal:y.totals.nbms,furnitureTotal:y.totals.furnitureTotal}}),h=n.filter(y=>y.brandId||y.itemName&&y.cost>0);u.append("furnitures",JSON.stringify(f)),u.append("commonMaterials",JSON.stringify(h)),u.append("commonProfitOverride",m.toString()),u.append("grandTotal",Ae.toString()),u.append("notes","Updated via frontend"),u.append("globalTransportation",ee.toString()),u.append("globalProfitPercent",R.toString()),await Te({organizationId:U,projectId:r.projectId,formData:u,id:A}),c&&me({title:"Updated!",description:"Quote edited successfully."})}catch(u){me({title:"Error",description:((p=(l=u==null?void 0:u.response)==null?void 0:l.data)==null?void 0:p.message)||(u==null?void 0:u.message)||"Failed to Update the Quote",variant:"destructive"})}},Ye=xe(N,700),Ze=xe(n,700),et=xe(ee,700),tt=xe(R,700),at=xe(m,700);j.useEffect(()=>{if(!(r!=null&&r.projectId)||N.length===0)return;(async()=>{console.log("Auto-saving quote..."),await Be(!1)})()},[Ye,Ze,et,tt,at]);const Re=c=>{d(l=>[...l,{furnitureName:c,dimention:{height:0,width:0,depth:0},coreMaterials:[nt()],fittingsAndAccessories:[pe()],glues:[pe()],nonBrandMaterials:[pe()],totals:{core:0,fittings:0,glues:0,nbms:0,furnitureTotal:0}}])},st=c=>{d(l=>l.filter((p,u)=>u!==c))},rt=c=>{const l=JSON.parse(JSON.stringify(N[c]));d([...N,l])},nt=()=>({itemName:"",materialUsed:"plywood",plywoodNos:{quantity:0,thickness:0},innerLaminate:{quantity:0,thickness:0},outerLaminate:{quantity:0,thickness:0},carpenters:0,days:0,profitOnMaterial:0,profitOnLabour:0,rowTotal:0,remarks:""}),pe=()=>({itemName:"",brandId:"",brandName:"",description:"",quantity:0,cost:0,rowTotal:0});return W?e.jsx(dt,{}):e.jsxs(e.Fragment,{children:[(r==null?void 0:r.quoteType)==="sqft_rate"?e.jsx(vt,{data:r,id:A,organizationId:U,projectData:C}):e.jsxs("div",{className:"max-h-full overflow-y-auto",children:[e.jsxs("header",{className:"flex sticky top-0 z-110 !bg-white flex-col md:flex-row md:items-center md:justify-between gap-4 py-1 border-b-1 border-[#818283]",children:[e.jsxs("div",{className:"flex items-center gap-4 ",children:[e.jsx("button",{onClick:()=>a(-1),className:"p-2.5 hover:bg-slate-100 text-slate-600 rounded-xl border border-slate-200 transition-colors",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h1",{className:"text-2xl font-black text-slate-900",children:r==null?void 0:r.mainQuoteName}),e.jsx("button",{onClick:()=>{O(()=>({mainQuoteName:r==null?void 0:r.mainQuoteName,quoteCategory:r==null?void 0:r.quoteCategory,quoteType:r==null?void 0:r.quoteType,projectId:r==null?void 0:r.projectId})),P(!0)},className:"p-1.5 text-blue-600 hover:bg-blue-50 rounded-md transition-colors",children:e.jsx("i",{className:"fas fa-edit text-sm"})})]}),e.jsx("div",{children:e.jsx("p",{className:"text-[10px] text-slate-400 font-bold uppercase tracking-[0.2em]",children:((Qe=r==null?void 0:r.projectId)==null?void 0:Qe.projectName)||"Project"})}),e.jsxs("p",{className:"text-[10px] text-slate-400 font-bold uppercase tracking-[0.2em]",children:["Basic Quote • ",r==null?void 0:r.quoteNo]})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-6",children:[ue&&e.jsxs("span",{className:"text-[10px] text-blue-500 animate-pulse font-bold uppercase",children:[e.jsx("i",{className:"fas fa-sync fa-spin mr-1"})," Auto-saving..."]}),!ue&&e.jsxs("span",{className:"text-[10px] text-gray-400 font-bold uppercase",children:[e.jsx("i",{className:"fas fa-check-circle mr-1"})," All changes saved"]}),(N==null?void 0:N.length)>0&&e.jsxs("div",{className:"flex items-center gap-10",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 tracking-wide",children:"Single Labour Cost"}),e.jsxs("p",{className:"text-[15px] font-semibold text-gray-900",children:["₹",ae==null?void 0:ae.toLocaleString("en-IN")]})]}),e.jsx("div",{className:"h-8 w-px bg-gray-300"}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-widest",children:"Grand Total"}),e.jsxs("p",{className:"text-xl font-bold text-green-600",children:["₹",Ae==null?void 0:Ae.toLocaleString("en-IN")]})]})]}),G&&e.jsxs(Q,{className:"flex items-center",onClick:()=>x(!0),children:[e.jsx("i",{className:"fas fa-add mr-1"}),"Create Product"]})]})]}),o&&e.jsx("div",{className:"fixed inset-0 z-100 flex items-center justify-center bg-black/70 bg-opacity-40 backdrop-blur-sm transition",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg p-6 w-full max-w-md relative animate-scaleIn",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-800",children:"Add New Quote"}),e.jsx("input",{className:"w-full border border-gray-300 rounded px-3 py-2 mb-4 outline-none focus:ring-2 focus:ring-blue-400",placeholder:"Enter Product Name",value:s,autoFocus:!0,onChange:c=>t(c.target.value),onKeyDown:c=>{if(c.key==="Enter"){if(!s.trim())return;Re(s),t(""),x(!1)}}}),e.jsxs("div",{className:"flex justify-end gap-3 mt-4",children:[e.jsx(Q,{variant:"secondary",onClick:()=>x(!1),children:"Cancel"}),e.jsx(Q,{onClick:()=>{s.trim()&&(Re(s),t(""),x(!1))},children:"Create"})]})]})}),(N==null?void 0:N.length)===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[300px] w-full bg-white rounded-xl   text-center p-6",children:[e.jsx("i",{className:"fas fa-box-open text-5xl text-blue-300 mb-4"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Cick on the Create button to start creating the quote",e.jsx("br",{}),e.jsxs(Q,{onClick:()=>x(!0),className:"mx-4 my-2",children:[e.jsx("i",{className:"fas fa-plus mr-1 "}),"Create Product"]})]})]}),(N==null?void 0:N.length)>0&&e.jsx("section",{className:"shadow max-h-[86%]",children:N==null?void 0:N.map((c,l)=>e.jsx(jt,{index:l,labourCost:ae,data:c,duplicateFurniture:()=>rt(l),updateFurniture:p=>{const u=[...N];u[l]={...p},d(u)},removeFurniture:()=>st(l),isEditing:!0},l))}),N.length>0&&e.jsxs("div",{className:"bg-gray-50 p-6 rounded-xl border border-gray-200 mt-8 mb-6 shadow-inner",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-800 flex items-center",children:[e.jsx("i",{className:"fas fa-boxes mr-3 text-orange-500"}),"General/Common Site Materials - Total: ₹",n.reduce((c,l)=>c+(l.rowTotal||0),0).toLocaleString("en-IN",{maximumFractionDigits:2})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-orange-50 px-3 py-1 rounded-lg border border-orange-100 shadow-sm",children:[e.jsx("label",{className:"text-[11px] font-bold text-orange-600 uppercase tracking-tight",children:"Common Profit Overlay"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"number",className:"w-12 text-right font-bold bg-transparent outline-none text-orange-800",value:m??R,placeholder:"0",onKeyDown:c=>{(c.key==="-"||c.key==="e")&&c.preventDefault()},onChange:c=>{const l=c.target.value===""?0:parseFloat(c.target.value);g(l)}}),e.jsx("span",{className:"text-orange-600 font-bold ml-1 text-sm",children:"%"})]})]}),e.jsxs("div",{className:"text-right text-xl text-green-700 font-bold",children:["Total: ₹",n.reduce((c,l)=>c+(l.rowTotal||0),0).toLocaleString("en-IN",{maximumFractionDigits:2})]})]})]}),$(),e.jsx("div",{className:"mt-3 text-right",children:e.jsx(Q,{onClick:()=>i([...n,pe()]),variant:"secondary",size:"sm",children:"+ Add Common Item"})})]}),N.length!==0&&e.jsxs("div",{className:"flex items-center justify-between gap-4 bg-white border border-blue-100 p-3 rounded-xl shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-[9px] font-extrabold text-blue-500 uppercase tracking-tighter",children:"Transport Cost"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-gray-400 mr-1 text-sm",children:"₹"}),e.jsx("input",{type:"number",className:"w-20 font-semibold focus:outline-none text-gray-800",value:ee,onChange:c=>te(Math.max(0,Number(c.target.value)))})]})]}),e.jsx("div",{className:"h-8 w-px bg-gray-100"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-[9px] font-extrabold text-green-500 uppercase tracking-tighter",children:"Global Profit Margin"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"number",className:"w-12 text-right font-semibold focus:outline-none text-gray-800",value:R,onChange:c=>{le(Math.max(0,Number(c.target.value))),b(Math.max(0,Number(c.target.value))),d(l=>l.map(p=>({...p,furnitureProfit:0,coreMaterials:p.coreMaterials.map(u=>({...u,profitOnMaterial:0,profitOnLabour:0})),fittingsAndAccessories:p.fittingsAndAccessories.map(u=>({...u,profitOnMaterial:0})),nonBrandMaterials:p.nonBrandMaterials.map(u=>({...u,profitOnMaterial:0}))}))),i(l=>l.map(p=>({...p,profitOnMaterial:0})))}}),e.jsx("span",{className:"text-gray-400 ml-1 text-sm",children:"%"})]})]})]}),e.jsx("div",{className:"mt-1 text-right flex gap-2 justify-end",children:(G||X)&&e.jsx(Q,{variant:"primary",isLoading:ue,onClick:()=>Be(!0),className:"px-6 py-2 bg-blue-600 text-white rounded",children:"Save Quote"})})]})]}),T&&e.jsx(Je,{isEditing:!0,formData:w,projectsData:C,setModalOpen:P,setFormData:O,handleSubmit:re,isSubmitting:k.isPending})]})};export{Qt as default};
