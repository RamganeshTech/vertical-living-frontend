import{f as _,b as le,h as T,i as D,s as B,j as s,u as re,r as f,ae as G,B as ne,t as K}from"./index-BAM0eJUz.js";import{d as oe}from"./downloadFile-BbGV_BaX.js";import{r as ie}from"./index-C8BdbktQ.js";import{S as ce,f as de}from"./ShortListMain-CkHPlJB3.js";const ue=async({organizationId:t,formData:l,api:n})=>{const{data:a}=await n.post(`/shortlist/referencedesign/${t}/uploaddesign`,l);if(!a.ok)throw new Error(a.message);return a},fe=async({organizationId:t,api:l,search:n})=>{const{data:a}=await l.get(`/shortlist/referencedesign/getdesigns/${t}`,{params:{search:n}});if(!a.ok)throw new Error(a.message);return a.data},xe=async({organizationId:t,api:l,imageId:n,tags:a})=>{const{data:o}=await l.patch(`/shortlist/referencedesign/updatetag/${t}/${n}`,{tags:a});if(!o.ok)throw new Error(o.message);return o.data},he=async({organizationId:t,imageId:l,api:n})=>{const{data:a}=await n.delete(`/shortlist/referencedesign/deletedesign/${t}/${l}`);if(!a.ok)throw new Error(a.message);return a},je=()=>{const t=["owner","staff","CTO"],{role:l}=_(),n=D(l);return T({mutationFn:async({organizationId:a,formData:o})=>{if(!l||!t.includes(l))throw new Error("Not authorized");if(!n)throw new Error("API instance missing");return await ue({organizationId:a,formData:o,api:n})},onSuccess:(a,{organizationId:o})=>{B.invalidateQueries({queryKey:["referenceDesigns",o]})}})},Ne=({organizationId:t,search:l})=>{const n=["owner","staff","CTO","client"],{role:a}=_(),o=D(a);return console.log("search",l),le({queryKey:["referenceDesigns",t,l],queryFn:async()=>{if(!a||!n.includes(a))throw new Error("Not authorized");if(!o)throw new Error("API instance missing");return await fe({organizationId:t,api:o,search:l})},enabled:!!t,retry:!1,refetchOnWindowFocus:!1})},ge=()=>{const t=["owner","staff","CTO"],{role:l}=_(),n=D(l);return T({mutationFn:async({organizationId:a,imageId:o,tags:p})=>{if(!l||!t.includes(l))throw new Error("Not authorized");if(!n)throw new Error("API instance missing");return await xe({organizationId:a,imageId:o,tags:p,api:n})}})},ke=()=>{const t=["owner","staff","CTO"],{role:l}=_(),n=D(l);return T({mutationFn:async({organizationId:a,imageId:o})=>{if(!l||!t.includes(l))throw new Error("Not authorized");if(!n)throw new Error("API instance missing");return await he({organizationId:a,imageId:o,api:n})},onSuccess:(a,{organizationId:o})=>{B.invalidateQueries({queryKey:["referenceDesigns",o]})}})};function we({images:t,onDelete:l,onDownload:n,isDeleting:a=!1,refetch:o,className:p="",minWidth:N=100,maxWidth:R=100,heightClass:k=0,isComments:x,showTags:E,editingId:S,tempComment:d,setEditingId:b,setTempComment:g,onUpdateComment:w}){var W,m;const{organizationId:O}=re(),[i,y]=f.useState(null),[v,M]=f.useState(!1),[Q,q]=f.useState(null),[J,V]=f.useState({}),[$,F]=f.useState(!1),[I,H]=f.useState([]),{mutateAsync:X,isPending:L}=ge(),Y=async()=>{try{if(!r)return;await X({organizationId:O,imageId:r._id,tags:I}),r.tags=I,F(!1),K({title:"Success",description:"tags updated successfully"})}catch(e){console.error("Failed to update tags",e),K({title:"Error",description:(e==null?void 0:e.response.data.message)||(e==null?void 0:e.message)||"operation failed",variant:"destructive"})}},Z=(e,c,P)=>{const u=P/c,te=Math.max(150,Math.min(400,200*u));V(ae=>({...ae,[e]:te}))},U=e=>{y(e),M(!0)},j=()=>{M(!1),y(null)},A=()=>{i!==null&&y((i-1+t.length)%t.length)},z=()=>{i!==null&&y((i+1)%t.length)};f.useEffect(()=>{const e=c=>{c.key==="Escape"?j():c.key==="ArrowRight"?z():c.key==="ArrowLeft"&&A()};return v&&(document.addEventListener("keydown",e),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",e),document.body.style.overflow="unset"}},[v,z,A,j]);const C=async e=>{if(l)try{await l(e),o&&await o(),t.length<=1?j():i!==null&&i>=t.length-1&&y(Math.max(0,t.length-2))}catch(c){console.error("Error deleting image:",c)}},ee=e=>{n({src:e==null?void 0:e.url,alt:(e==null?void 0:e.originalName)||"image"})},se=()=>{j()},r=i!==null&&i>=0&&i<t.length?t[i]:null;return f.useEffect(()=>{r&&v&&(H(r.tags||[]),F(!1))},[r,v]),s.jsxs(s.Fragment,{children:[s.jsx("div",{className:`gap-1 flex flex-wrap ${p}`,children:t.map((e,c)=>{const P=J[e._id]||200;return s.jsx(s.Fragment,{children:s.jsxs("div",{className:`relative cursor-pointer bg-gray-100 overflow-hidden mb-1 break-inside-avoid ${x?"flex flex-col":""}`,style:{flex:`0 1 ${N}px`,minWidth:`${N}px`,maxWidth:`${R}px`,height:x?`${(k||P)+40}px`:`${k||P}px`},onClick:()=>U(c),children:[s.jsx("img",{src:(e==null?void 0:e.url)||G,alt:(e==null?void 0:e.originalName)||`Image ${c+1}`,className:`w-full cursor-pointer ${x?"":"h-full"} object-cover`,loading:"lazy",onLoad:u=>{const h=u.target;Z(e._id,h.naturalWidth,h.naturalHeight)}}),x&&s.jsx("div",{className:"text-xs border-t border-gray-200 bg-gray-50 p-1 h-full border overflow-y-auto custom-scrollbar",onMouseEnter:()=>q(e._id),onMouseLeave:()=>q(null),onClick:u=>{u.stopPropagation(),b==null||b(e._id),g==null||g(h=>({...h,[e._id]:e.comment||""}))},children:S===e._id?s.jsx("input",{autoFocus:!0,value:(d==null?void 0:d[e._id])||"",onChange:u=>g==null?void 0:g(h=>({...h,[e._id]:u.target.value})),onBlur:()=>w==null?void 0:w(e._id,(d==null?void 0:d[e._id])||""),onKeyDown:u=>{u.key==="Enter"&&(u.preventDefault(),w==null||w(e._id,(d==null?void 0:d[e._id])||""))},className:"w-full border p-1 rounded text-xs"}):s.jsx("div",{className:"cursor-pointer p-1 hover:bg-gray-100 rounded",children:s.jsxs("div",{className:"flex items-start gap-1",children:[s.jsx("i",{className:"fas fa-comment text-gray-400 mt-0.5"}),s.jsx("p",{className:"whitespace-pre-wrap break-words text-gray-700 text-xs",children:e.comment||s.jsx("span",{className:"italic text-gray-400",children:"Add a comment"})}),Q===e._id&&s.jsx("i",{className:"fas fa-pen ml-auto text-gray-400 text-xs mt-1"})]})})})]},e._id)})})}),v&&r&&ie.createPortal(s.jsxs("div",{className:"fixed inset-0 z-[9999] bg-black/70 flex items-center justify-center",onClick:se,style:{margin:0,padding:0},children:[s.jsxs("div",{className:"absolute top-6 right-6 z-[10000] flex items-center gap-4",children:[s.jsx("button",{onClick:e=>{e.stopPropagation(),ee(r)},className:"bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-all duration-200",title:"Download",children:s.jsx("i",{className:"fas fa-download text-lg"})}),l&&s.jsx("button",{onClick:e=>{e.stopPropagation(),C(r._id)},className:"bg-black/50 hover:bg-red-600/70 text-white rounded-full p-3 transition-all duration-200",title:"Delete",disabled:a,children:s.jsx("i",{className:`fas ${a?"fa-spinner fa-spin":"fa-trash-can"} text-lg`})}),s.jsx("button",{onClick:e=>{e.stopPropagation(),j()},className:"bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-all duration-200",title:"Close",children:s.jsx("i",{className:"fas fa-times text-xl"})})]}),s.jsx("button",{onClick:e=>{e.stopPropagation(),A()},className:"absolute left-6 top-1/2 transform -translate-y-1/2 z-[10000] bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-all duration-200",children:s.jsx("i",{className:"fas fa-chevron-left text-2xl"})}),s.jsx("button",{onClick:e=>{e.stopPropagation(),z()},className:"absolute right-6 top-1/2 transform -translate-y-1/2 z-[10000] bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-all duration-200",children:s.jsx("i",{className:"fas fa-chevron-right text-2xl"})}),s.jsxs("div",{className:"relative flex flex-col items-center justify-center",style:{width:"70vw",height:"70vh",maxWidth:"70vw",maxHeight:"70vh"},onClick:e=>e.stopPropagation(),children:[s.jsx("img",{src:(r==null?void 0:r.url)||G,alt:r.originalName||`Image ${i!==null?i+1:1}`,className:"max-w-full max-h-full object-contain"}),E&&s.jsxs("div",{className:"mt-4 w-full max-w-lg flex flex-col items-center",children:[s.jsxs("div",{className:"flex items-center justify-between w-full mb-2",children:[s.jsx("span",{className:"text-white/70 text-xs font-medium uppercase tracking-widest",children:"Tags"}),E&&s.jsx("button",{onClick:()=>F(!$),className:"text-blue-400 cursor-pointer hover:text-blue-300 text-xs font-bold transition-colors",children:$?"Cancel":"Edit Tags"})]}),$?s.jsxs("div",{className:"w-full bg-white/90 p-3 rounded-lg border border-white/20",children:[s.jsx(ce,{tags:I,setState:H,suggestionFetcher:e=>de({query:e,organizationId:O})}),s.jsx("div",{className:"flex justify-end mt-2",children:s.jsx(ne,{size:"sm",disabled:L,onClick:Y,className:"bg-blue-600 hover:bg-blue-700 text-white h-7 text-[10px]",children:L?"Saving...":"Save Changes"})})]}):s.jsx("div",{className:"flex flex-wrap justify-center gap-2",children:r!=null&&r.tags&&((W=r==null?void 0:r.tags)==null?void 0:W.length)>0?(m=r==null?void 0:r.tags)==null?void 0:m.map((e,c)=>s.jsxs("span",{className:"bg-blue-600/80 text-white text-[10px] uppercase tracking-wider font-bold px-3 py-1 rounded-full border border-blue-400/50",children:[s.jsx("i",{className:"fas fa-tag mr-1.5 opacity-70"}),e]},c)):s.jsx("span",{className:"text-white/30 text-[10px] italic",children:"No tags assigned"})})]}),x&&s.jsx("div",{className:"absolute bottom-0 w-full bg-black/40 text-white text-xs p-1",children:(r==null?void 0:r.comment)||"No comments yet"})]}),s.jsxs("div",{className:"absolute bottom-6 left-1/2 transform -translate-x-1/2 text-white text-sm bg-black/50 px-4 py-2 rounded-full",children:[i!==null?i+1:1," of ",t.length]})]}),document.body)]})}function Ee({imageFiles:t=[],height:l,refetch:n,handleDeleteFile:a,className:o="",minWidth:p,maxWidth:N,isComments:R=!1,editingId:k,showTags:x,tempComment:E,setEditingId:S,setTempComment:d,onUpdateComment:b}){return s.jsx(s.Fragment,{children:s.jsx(we,{images:t,onDelete:a,onDownload:oe,refetch:n,isDeleting:!1,className:o,heightClass:l,minWidth:p,maxWidth:N,isComments:R,showTags:x,editingId:k,tempComment:E,setEditingId:S,setTempComment:d,onUpdateComment:b})})}export{Ee as I,je as a,ke as b,Ne as u};
