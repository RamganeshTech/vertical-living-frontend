import{r as S,b as $,a as Y,f as ie,c as F,u as K,j as e,L as G,m as z,n as H,o as Q,p as V,t as J,v as q,R as re}from"./index-e8sHY52i.js";import{M as le,f as ce,C as R}from"./constants-swM5MxG6.js";import{b as X}from"./CTOApi-BsPn1B5e.js";import{b as Z}from"./clientApi-CBK23Ntw.js";import{b as ee}from"./staffApi-CyBpF8MY.js";import{b as te}from"./userApi-C5LD4l7-.js";import{b as se}from"./workerApi-DslyJDjj.js";import{B}from"./Button-45UYJ-Fj.js";import{t as U}from"./toast-BSC5QTk1.js";import{u as ae}from"./stageSelectionApi-DlcsoTso.js";function de(c,d){S.useEffect(()=>{const x=s=>{s.ctrlKey&&s.key==="]"?(s.preventDefault(),d()):s.ctrlKey&&s.key==="["&&(s.preventDefault(),c())};window.addEventListener("keydown",x)},[d,c])}const fe=(c,d,x,s,m)=>{const A=s==null?void 0:s.some(f=>f.toLowerCase()==="projectdetails");let N={},i={},r={};if(A){let f=["DOCUMENTATION","WORKERS","INVITECLIENT","PREREQUIRETIES","REQUIREMENTFORM","SITEMEASUREMENT","SAMPLEDESIGN","TECHNICALCONSULTANT","SELECTSTAGE","PAYMENTCONFIRMATION","ORDERMATERIALS","MATERIALARRIVED","WORKSCHEDULE","INSTALLATION","QUALITYCHECK","CLEANINGSANITATION","PROJECTDELIVERY"];const u=f.indexOf("TECHNICALCONSULTANT")+1;c==="Manual Flow"?f.splice(u,0,"MATERIALSELECTION","COSTESTIMATION"):c==="Modular Units"&&f.splice(u,0,"MODULARUNIT"),c!=null&&(f=f.filter(t=>t!=="SELECTSTAGE"));for(const t of f)d[t]&&m[t]&&x[t]&&(N[t]=d[t],i[t]=m[t],r[t]=x[t])}else N=d,i=m,r=x;return{filteredLabels:N,filteredIcons:i,filteredPaths:r}},ue=({labels:c,icons:d,path:x})=>{const[s,m]=S.useState(!0),{projectId:A}=$(),N=Y(),i=ie(),r=i.pathname.split("/"),{organizationId:f}=$(),g=F(),{role:u}=K(n=>n.authStore),[t,j]=S.useState(""),{data:T,isLoading:D}=ae(A),{mutateAsync:I,isPending:L}=X(),{mutateAsync:O,isPending:E}=Z(),{mutateAsync:P,isPending:C}=ee(),{mutateAsync:b,isPending:h}=te(),{mutateAsync:y,isPending:v}=se(),M=()=>{m(!1)},o=()=>{m(!0)};S.useEffect(()=>{const l=i.pathname.split("/")[4];j(s?()=>le[l]:()=>ce[l])},[i.pathname,s]),de(o,M);const a=!D&&T;let{filteredLabels:p,filteredIcons:oe,filteredPaths:w}=fe(a,c,x,r,d);const _=r[2]==="projectdetails",ne=()=>{_&&N(`/organizations/${f}/projects`)},W=async()=>{var n,l;try{u==="CTO"?await I():u==="client"?await O():u==="staff"?await P():u==="owner"?await b():u==="worker"&&await y(),g(z()),g(H()),g(Q()),g(V()),g(J()),g(q()),U({title:"Success",description:"logout successfull"}),(!L||!E||!C||!h||!v)&&N("/")}catch(k){U({title:"Error",description:((l=(n=k==null?void 0:k.response)==null?void 0:n.data)==null?void 0:l.message)||"Failed to logout",variant:"destructive"})}};return e.jsx(e.Fragment,{children:s?e.jsxs("aside",{className:"relative flex flex-col bg-[#2f303a] w-[17%] min-h-screen max-h-screen text-[#9ca3af] select-none transition-all duration-300",children:[e.jsxs("div",{className:"flex flex-col flex-grow overflow-y-auto overflow-x-hidden custom-scrollbar p-2",children:[e.jsxs("div",{onClick:ne,className:`flex ${_?"cursor-pointer":""} justify-between items-center border-b-1 py-2`,children:[e.jsx("span",{className:"text-xl",children:R.COMPANY_NAME}),e.jsx("div",{className:"w-[30px] h-[30px]",children:e.jsx("img",{className:"w-full h-full",src:R.COMPANY_LOGO,alt:"LOGO"})})]}),e.jsxs("section",{className:"py-2 space-y-2",children:[" ",Object.entries(p).map(([n,l])=>w[n]&&e.jsx(G,{to:w[n],className:"outline-none",children:e.jsxs("div",{onClick:()=>j(l),className:`cursor-pointer flex justify-between max-w-[95%] py-4 px-4 ${t===l?"bg-[#3a3b45] rounded-xl text-white":"rounded-xl hover:bg-[#3a3b45]"} `,children:[e.jsx("span",{className:"text-lg",children:l}),e.jsx("span",{children:e.jsx("i",{className:"fa-solid fa-chevron-right"})})]})},l))]})]}),e.jsxs("div",{className:"flex flex-col p-2 border-t border-[#3a3b45]",children:[r[1]!=="login"&&e.jsxs(B,{isLoading:L||E||C||h||v,onClick:W,className:"flex items-center gap-2 px-4 py-3 rounded-lg !bg-[#3a3b45] !text-[#9ca3af] hover:!bg-[#464751] hover:!text-white transition",children:[e.jsx("i",{className:"fa-solid fa-right-from-bracket"}),e.jsx("span",{children:"Logout"})]}),e.jsx("button",{title:"Ctrl+] to close",onClick:M,className:"mt-2 flex items-center justify-center outline-none border border-blue-600 text-blue-500 hover:bg-[#3a3b45] rounded-lg w-full py-2",children:e.jsx("i",{className:"fa-solid fa-chevron-left"})})]})]}):e.jsxs("aside",{className:"flex flex-col relative justify-between bg-[#2f303a] w-[6%]  max-h-full  text-[#9ca3af] transition-all duration-300 ",children:[e.jsx("div",{className:"max-h-[95%] overflow-y-auto overflow-x-hidden custom-scrollbar",children:e.jsx("div",{className:"flex items-center flex-col justify-between w-full",children:Object.entries(oe).map(([n,l])=>w[n]?e.jsx(G,{to:w[n],className:`${w[n]?"":"cursor-not-allowed"}`,children:e.jsx("div",{onClick:()=>j(n),className:`cursor-pointer flex justify-between max-w-[95%] py-4 px-4 ${(t==null?void 0:t.toLowerCase())===n.toLowerCase()?"bg-[#3a3b45] rounded-xl text-white":"rounded-xl hover:bg-[#3a3b45]"} `,children:e.jsx("i",{className:`${l} ${(t==null?void 0:t.toLowerCase())===n.toLowerCase()?"text-[#4a86f7]":"text-[#9ca3af]"} `})})}):e.jsx("div",{className:"cursor-not-allowed flex justify-between max-w-[95%] py-4 px-4",children:e.jsx("i",{className:`${l}`})}))})}),e.jsxs("div",{className:"flex flex-col items-center p-2 border-t border-[#3a3b45]",children:[r[1]!=="login"&&e.jsx(B,{isLoading:L||E||C||h||v,title:"logout",onClick:W,className:"w-[40px] h-[40px] flex items-center justify-center !bg-[#3a3b45] !text-[#9ca3af] hover:!text-red-500 transition",children:e.jsx("i",{className:"fa-solid fa-right-from-bracket"})}),e.jsx("button",{title:"Ctrl+[ to open",onClick:o,className:"mt-2 cursor-pointer outline-none border-[#9ca3af] h-[40px] w-[40px] flex items-center justify-center border rounded-lg",children:e.jsx("i",{className:"fa-solid fa-chevron-right text-[#4a86f7]"})})]})]})})},Ee=S.memo(ue),Ce=({isOpen:c,onClose:d,labels:x,path:s})=>{const m=Y(),{organizationId:A,projectId:N}=$(),i=F(),{role:r}=K(o=>o.authStore),{data:f,isLoading:g}=ae(N),{mutateAsync:u,isPending:t}=X(),{mutateAsync:j,isPending:T}=Z(),{mutateAsync:D,isPending:I}=ee(),{mutateAsync:L,isPending:O}=te(),{mutateAsync:E,isPending:P}=se(),C=async()=>{var o,a;try{r==="CTO"?await u():r==="client"?await j():r==="staff"?await D():r==="owner"?await L():r==="worker"&&await E(),i(z()),i(H()),i(Q()),i(V()),i(J()),i(q()),U({title:"Success",description:"logout successfull"}),(!t||!T||!I||!O||!P)&&m("/")}catch(p){U({title:"Error",description:((a=(o=p==null?void 0:p.response)==null?void 0:o.data)==null?void 0:a.message)||"Failed to logout",variant:"destructive"})}};let b=Object.entries(x);const h=location.pathname.split("/"),y=h[2]==="projectdetails";if(h.includes("projectdetails")&&!g){const o=f;b=b.filter(([a])=>{if(o){if(o==="Modular Units")return a!=="MATERIALSELECTION"&&a!=="COSTESTIMATION"&&a!=="SELECTSTAGE";if(o==="Manual Flow")return a!=="MODULARUNIT"&&a!=="SELECTSTAGE"}else return a!=="MODULARUNIT"&&a!=="MATERIALSELECTION"&&a!=="COSTESTIMATION";return!0})}const M=()=>{y&&m(`/organizations/${A}/projects`)};return e.jsxs(e.Fragment,{children:[c&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40",onClick:d}),e.jsxs("aside",{className:`fixed top-0 left-0 z-50 h-screen bg-white w-[75%] flex flex-col transition-transform duration-300 ${c?"translate-x-0":"-translate-x-full"}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsxs("div",{onClick:M,className:`flex items-center gap-3 ${y?"cursor-pointer":""}`,children:[e.jsx("img",{src:R.COMPANY_LOGO,alt:"Logo",className:"w-10 h-10 rounded-full object-cover"}),e.jsx("span",{className:"text-lg font-semibold",children:R.COMPANY_NAME})]}),e.jsx("button",{onClick:d,className:"text-xl text-gray-700",children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsx("nav",{className:"flex flex-col flex-grow overflow-y-auto p-4",children:b.map(([o,a],p)=>e.jsxs(re.Fragment,{children:[s[o]?e.jsx(G,{to:s[o],onClick:d,className:"text-gray-800 hover:bg-gray-100 p-3 rounded block",children:a}):e.jsx("span",{className:"text-gray-400 p-3 rounded cursor-not-allowed block",children:a}),p<b.length-1&&e.jsx("hr",{className:"border-t border-gray-200 my-1"})]},o))}),e.jsx("div",{className:"border-t border-gray-200 p-4",children:h[1]!=="login"&&e.jsxs(B,{className:"w-full flex items-center justify-center gap-2",isLoading:t||T||I||O||P,onClick:C,children:[e.jsx("i",{className:"fas fa-sign-out-alt"})," Logout"]})})]})]})};export{Ce as M,Ee as S};
