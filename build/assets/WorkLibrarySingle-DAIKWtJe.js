import{u as G,b as H,r as p,j as s}from"./index-4xXsHyrq.js";import{B as x}from"./Button-BmD7QJLN.js";import{L as g}from"./Label-DzCIp4JP.js";import{I as h}from"./Input-Dg780vof.js";import{C as O,a as P,b as R,c as U}from"./Card-CJaK8Drj.js";import{c as q,d as J}from"./workLibraryApi-CpZNQ4Nb.js";import{t as T}from"./toast-BSC5QTk1.js";import K from"./MaterialOverviewLoading-CX4w9Avf.js";import"./useQuery-CnKlDwE3.js";import"./useMutation-DAR9sTyS.js";import"./roleCheck-DDX7kp9U.js";import"./Skeleton-CZeX8ICI.js";const ns=()=>{var N,v;const{id:j}=G(),y=H(),{data:f,isLoading:C,error:o}=q(j),w=J(),[a,r]=p.useState(null),[S,I]=p.useState([]),[_,M]=p.useState([]);p.useEffect(()=>{f&&r(f)},[f]);const b=(t,i)=>{r(e=>({...e,[t]:i}))},k=(t,i,e)=>{const l=[...a.tasks];l[t][i]=e,r(n=>({...n,tasks:l}))},D=(t,i,e,l)=>{const n=[...a.tasks];n[t].subtasks[i][e]=l,r(m=>({...m,tasks:n}))},W=()=>{r(t=>({...t,tasks:[...t.tasks,{title:"",description:"",category:"",subtasks:[]}]}))},L=t=>{const i=a.tasks[t];i._id&&M(l=>[...l,i._id]);const e=[...a.tasks];e.splice(t,1),r(l=>({...l,tasks:e}))},A=t=>{const i=[...a.tasks];i[t].subtasks.push({title:"",description:"",estimatedTimeInMinutes:null}),r(e=>({...e,tasks:i}))},E=(t,i)=>{const e=a.tasks[t],l=e.subtasks[i];l._id&&e._id&&I(m=>[...m,{taskId:e._id,subtaskId:l._id}]);const n=[...a.tasks];n[t].subtasks.splice(i,1),r(m=>({...m,tasks:n}))},B=async()=>{var t,i;try{const e=[],l=[],n=[],m=[];for(const d of a.tasks)if(d._id){e.push({_id:d._id,title:d.title,estimatedTimeInMinutes:Number(d.estimatedTimeInMinutes)||0});const u=d.subtasks.filter(c=>!c._id),z=d.subtasks.filter(c=>c._id);u.length&&m.push({taskId:d._id,subtasks:u.map(c=>({title:c.title,estimatedTimeInMinutes:Number(c.estimatedTimeInMinutes)||0}))}),n.push(...z.map(c=>({taskId:d._id,subtaskId:c._id,title:c.title,estimatedTimeInMinutes:Number(c.estimatedTimeInMinutes)||0})))}else l.push({title:d.title,estimatedTimeInMinutes:Number(d.estimatedTimeInMinutes)||0,subtasks:d.subtasks.map(u=>({title:u.title,estimatedTimeInMinutes:Number(u.estimatedTimeInMinutes)||0}))});const F={workName:a==null?void 0:a.workName,description:a==null?void 0:a.description,tags:(a==null?void 0:a.tags)??[],addTasks:l,deleteTaskIds:_,updateTasks:e,addSubtasks:m,deleteSubtaskIds:S,updateSubtasks:n};await w.mutateAsync({workId:j,formData:F}),T({title:"Success",description:"Workflow updated successfully"})}catch(e){T({title:"Error",description:((i=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:i.message)||(e==null?void 0:e.message)||"Failed to update",variant:"destructive"})}};return C?s.jsx(K,{}):!f||o?s.jsxs("div",{className:"flex flex-col items-center  justify-center min-h-[300px] w-full bg-white rounded-xl text-center p-6",children:[s.jsx("i",{className:"fas fa-note text-5xl text-blue-300 mb-4"}),s.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-1",children:"No WorkFlow Found"}),s.jsx("p",{className:"text-sm text-gray-500",children:((v=(N=o==null?void 0:o.response)==null?void 0:N.data)==null?void 0:v.message)||(o==null?void 0:o.message)||"something went wrong"})]}):s.jsxs("div",{className:"p-2 max-h-full overflow-y-auto mx-auto space-y-10",children:[s.jsx("header",{className:"flex items-center justify-between w-full bg-white border-b border-gray-200 px-4 py-3 rounded-md",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("button",{onClick:()=>y(-1),className:"flex items-center gap-2 px-3 py-1.5 bg-gray-100 hover:bg-gray-200 text-gray-800 text-sm font-medium rounded-md transition-colors",children:[s.jsx("i",{className:"fas fa-arrow-left text-sm"}),s.jsx("span",{children:"Back"})]}),s.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Workflow Details"})]})}),s.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx(g,{children:"Work Name"}),s.jsx(h,{value:(a==null?void 0:a.workName)||"",onChange:t=>b("workName",t.target.value)})]}),s.jsxs("div",{children:[s.jsx(g,{children:"Description"}),s.jsx(h,{value:(a==null?void 0:a.description)||"",onChange:t=>b("description",t.target.value)})]})]}),s.jsxs("div",{className:"flex justify-between items-center !mb-3",children:[s.jsx("h2",{className:"text-lg font-semibold",children:"Tasks"}),s.jsxs(x,{onClick:W,children:[s.jsx("i",{className:"fa-solid fa-plus mr-2"})," Add Task"]})]}),s.jsx("div",{className:"space-y-6",children:a==null?void 0:a.tasks.map((t,i)=>s.jsxs(O,{className:"border-l-4 border-blue-600",children:[s.jsxs(P,{className:"flex flex-row justify-between items-center space-y-0",children:[s.jsxs(R,{className:"text-lg",children:["Task ",i+1]}),s.jsxs(x,{size:"sm",className:"bg-red-600 text-white hover:bg-red-700",onClick:()=>L(i),children:[s.jsx("i",{className:"fa-solid fa-trash mr-1"}),"Delete Task"]})]}),s.jsxs(U,{className:"space-y-4",children:[s.jsxs("div",{className:"grid md:grid-cols-2 gap-3",children:[s.jsxs("div",{children:[s.jsx(g,{children:"Task Title"}),s.jsx(h,{value:(t==null?void 0:t.title)||"",onChange:e=>k(i,"title",e.target.value)})]}),s.jsxs("div",{children:[s.jsx(g,{children:"Estimated Time (min)"}),s.jsx(h,{type:"number",value:(t==null?void 0:t.estimatedTimeInMinutes)||0,onChange:e=>k(i,"estimatedTimeInMinutes",e.target.value)})]})]}),s.jsxs("div",{className:"flex justify-between items-center mt-4",children:[s.jsx("h3",{className:"text-sm font-semibold",children:"Subtasks"}),s.jsxs(x,{onClick:()=>A(i),children:[s.jsx("i",{className:"fa-solid fa-circle-plus mr-2"}),"Add Subtask"]})]}),s.jsx("div",{className:"space-y-3",children:t==null?void 0:t.subtasks.map((e,l)=>s.jsxs("div",{className:"flex gap-3 bg-gray-50 p-3 rounded-lg relative",children:[s.jsx("div",{className:"flex flex-1",children:s.jsx(h,{value:(e==null?void 0:e.title)||"",onChange:n=>D(i,l,"title",n.target.value)})}),s.jsx(x,{size:"icon",className:"bg-red-600 hover:bg-red-600 text-white",onClick:()=>E(i,l),children:s.jsx("i",{className:"fa-solid fa-trash"})})]},e==null?void 0:e._id))})]})]},t._id))}),s.jsx("div",{className:"flex justify-end mt-6",children:s.jsxs(x,{onClick:B,children:[s.jsx("i",{className:"fa-solid fa-floppy-disk mr-2"})," Save All Changes"]})})]})};export{ns as default};
