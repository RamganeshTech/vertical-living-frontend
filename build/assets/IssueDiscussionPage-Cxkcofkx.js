import{u as U,a as Q,b as Ve,r as g,s as v,j as e}from"./index-BnxfhzlG.js";import{u as W}from"./useMutation-BcezwzYU.js";import{u as Ye}from"./useInfiniteQuery-DjbdwBFi.js";import{g as B}from"./roleCheck-B2ZABSQw.js";import{u as K}from"./getAllUsersApi-CoFTnnsm.js";import{B as P}from"./Button-B-Uk6Apc.js";import{I as He}from"./Input-C3kx_rpa.js";import{T as H}from"./TextArea-BT85ksZY.js";import{L as F}from"./Label-C_jR9mb1.js";import{S as ye}from"./SearchSelectNew-B7ZcgmKh.js";import{u as Je}from"./useCurrentSupervisor-Dgta637b.js";import{t as T}from"./toast-BSC5QTk1.js";import{I as ve}from"./ImageGalleryMain-C70UobwN.js";import{N as ke}from"./constants-Dsaf8__L.js";import{d as Xe}from"./dateFormator-BGKi5rfZ.js";import"./useQuery-DQ8spYHd.js";import"./downloadFile-3m7eWOIo.js";import"./index-TNW1rgHM.js";const Ze=async({organizationId:c,projectId:i,selectStaff:p,selectStaffRole:x,issue:n,responseType:d,isMessageRequired:u,dropdownOptions:f,files:N,api:I})=>{const b=new FormData;c&&b.append("organizationId",c),i&&b.append("projectId",i),p&&b.append("selectStaff",p),x&&b.append("selectStaffRole",x),n&&b.append("issue",n),d&&b.append("responseType",d),u&&b.append("isMessageRequired",String(u)),f&&b.append("dropdownOptions",JSON.stringify(f)),N&&N.length>0&&N.forEach(L=>b.append("files",L));const{data:R}=await I.post("/issuediscussion/createissue",b,{headers:{"Content-Type":"multipart/form-data"}});if(!R.ok)throw new Error(R.message||"Failed to create issue");return R.data},es=async({projectId:c,convoId:i,responseContent:p,optionalMessage:x,files:n,api:d})=>{const u=new FormData;p&&u.append("responseContent",p),x&&u.append("optionalMessage",x),n&&n.length>0&&n.forEach(N=>u.append("files",N));const{data:f}=await d.post(`/issuediscussion/providesolution/${c}/${i}`,u,{headers:{"Content-Type":"multipart/form-data"}});if(!f.ok)throw new Error(f.message||"Failed to provide solution");return f.data},ss=async({projectId:c,convoId:i,forwardToStaff:p,forwardToStaffRole:x,api:n})=>{const{data:d}=await n.put(`/issuediscussion/forward/${c}/${i}`,{forwardToStaff:p,forwardToStaffRole:x});if(!d.ok)throw new Error(d.error||"Failed to forward issue");return d.data},ts=async({projectId:c,page:i,limit:p,status:x,assignedToMe:n,api:d})=>{const u=new URLSearchParams({page:i.toString(),limit:p.toString()});x&&u.append("status",x),n!==void 0&&u.append("assignedToMe",n.toString());const{data:f}=await d.get(`/issuediscussion/getall/${c}?${u}`);if(!f.ok)throw new Error(f.message||"Failed to fetch discussions");return f.data},as=async({projectId:c,convoId:i,api:p})=>{const{data:x}=await p.delete(`/issuediscussion/deletemessage/${c}/${i}`);if(!x.ok)throw new Error(x.message||"Failed to delete conversation");return x},rs=()=>{const c=["owner","staff","CTO","worker"],{role:i}=U(),p=B(i),x=Q();return W({mutationFn:async({organizationId:n,projectId:d,selectStaff:u,selectStaffRole:f,issue:N,responseType:I,isMessageRequired:b,dropdownOptions:R,files:L})=>{if(!i||!c.includes(i))throw new Error("Not allowed to make this API call");if(!p)throw new Error("API instance not found for role");return await Ze({organizationId:n,projectId:d,selectStaff:u,selectStaffRole:f,issue:N,responseType:I,isMessageRequired:b,dropdownOptions:R,files:L,api:p})},onSuccess:(n,d)=>{x.invalidateQueries({queryKey:["discussions",d.projectId]}),x.invalidateQueries({queryKey:["user-raised-issues"]})},onError:n=>{console.error("Failed to create issue:",n)}})},ls=()=>{const c=["owner","staff","CTO","worker"],{role:i}=U(),p=B(i),x=Q();return W({mutationFn:async({convoId:n,responseContent:d,optionalMessage:u,files:f,projectId:N})=>{if(!i||!c.includes(i))throw new Error("Not allowed to make this API call");if(!p)throw new Error("API instance not found for role");return await es({projectId:N,convoId:n,responseContent:d,optionalMessage:u,files:f,api:p})},onSuccess:(n,d)=>{x.invalidateQueries({queryKey:["discussions",d.projectId]}),x.invalidateQueries({queryKey:["user-assigned-issues"]})},onError:n=>{console.error("Failed to provide solution:",n)}})},is=()=>{const c=["owner","staff","CTO","worker"],{role:i}=U(),p=B(i),x=Q();return W({mutationFn:async({projectId:n,convoId:d,forwardToStaff:u,forwardToStaffRole:f})=>{if(!i||!c.includes(i))throw new Error("Not allowed to make this API call");if(!p)throw new Error("API instance not found for role");return await ss({projectId:n,convoId:d,forwardToStaff:u,forwardToStaffRole:f,api:p})},onSuccess:(n,d)=>{x.invalidateQueries({queryKey:["discussions",d.projectId]}),x.invalidateQueries({queryKey:["user-assigned-issues"]})},onError:n=>{console.error("Failed to forward issue:",n)}})},ns=({projectId:c,status:i,assignedToMe:p,limit:x=20})=>{const n=["owner","staff","CTO","worker"],{role:d}=U(),u=B(d);return Ye({queryKey:["discussions",c,i,p],queryFn:async({pageParam:f=1})=>{if(!d||!n.includes(d))throw new Error("Not allowed to make this API call");if(!u)throw new Error("API instance not found for role");return await ts({projectId:c,page:f,limit:x,status:i,assignedToMe:p,api:u})},getNextPageParam:f=>{const N=Math.ceil(f.totalConversations/f.limit);if(f.page<N)return f.page+1},getPreviousPageParam:f=>{if(f.page>1)return f.page-1},enabled:!!d&&n.includes(d)&&!!c,initialPageParam:1})},os=()=>{const c=["owner","staff","CTO","worker"],{role:i}=U(),p=B(i),x=Q();return W({mutationFn:async({convoId:n,projectId:d})=>{if(!i||!c.includes(i))throw new Error("Not allowed to make this API call");if(!p)throw new Error("API instance not found for role");return await as({projectId:d,convoId:n,api:p})},onSuccess:(n,d)=>{x.invalidateQueries({queryKey:["discussions",d.projectId]}),console.log("Conversation deleted successfully")},onError:n=>{console.error("Failed to delete conversation:",n)}})};function Cs(){var re,le,ie,ne,oe,de,ce,me,xe,pe,fe,ue,he,ge,be,je,Ne,we;const{projectId:c,organizationId:i}=Ve(),{mutateAsync:p,isPending:x}=rs(),{mutateAsync:n,isPending:d}=ls(),{mutateAsync:u,isPending:f,variables:N}=os(),{mutateAsync:I,isPending:b}=is(),{data:R,isLoading:L,hasNextPage:Se,fetchNextPage:Re}=ns({projectId:c,limit:50}),{data:Fe=[]}=K(i,"staff"),{data:Ce=[]}=K(i,"owner"),{data:Oe=[]}=K(i,"worker"),{data:Te=[]}=K(i,"CTO"),[G,q]=g.useState([]),[t,_]=g.useState(null),[z,V]=g.useState(!1),[w,D]=g.useState({responseType:"text",isMessageRequired:!1,dropdownOptions:[]}),[y,C]=g.useState({issue:"",selectedStaff:"",selectStaffRole:"",dropdownOptions:"",files:[]}),[j,E]=g.useState({content:"",files:[],message:""}),[Y,De]=g.useState(!1),[Pe,J]=g.useState(""),[ds,X]=g.useState(""),k=Je(),[$,S]=g.useState(null),Z=g.useRef(null),ee=g.useRef(null),se=g.useRef(null),[O,A]=g.useState({isOpen:!1,type:null,url:""});g.useEffect(()=>{if(!v||!i||!c)return;console.log("[Socket] Joining discussion room for project:",c),v.emit("join_project_discussion",{projectId:c,organizationId:i}),v.on("recent_discussions",r=>{console.log("[Socket] Received recent discussions:",r)});const s=r=>{console.log("[Socket] New issue created:",r),q(o=>o.some(ze=>ze._id===r.conversation._id)?o:[r.conversation,...o])},a=r=>{console.log("=== RESPONSE HANDLER CALLED ==="),console.log("Full data received:",r),console.log("ConvoId from data:",r.convoId),console.log("Has conversation?",!!r.conversation),console.log("Has response?",!!r.response),console.log("==============================="),console.log("[Socket] Response added:",r),q(o=>o.map(h=>h._id===r.convoId?(console.log("data from the upate",r),r.conversation?r.conversation:{...h,response:r.response,status:"responded"}):h)),console.log("selectedIssue id",t==null?void 0:t._id),console.log("data.convoId",r.convoId),_(o=>(console.log("Current selected:",o==null?void 0:o._id),console.log("Response for:",r.convoId),o?o._id===r.convoId?(console.log("âœ… Same issue - updating"),r.conversation||{...o,response:r.response,status:"responded"}):(console.log("âŒ Different issue - keeping current"),o):(console.log("âœ… Auto-selecting issue that got response"),r.conversation||null)))},l=r=>{console.log("[Socket] Issue deleted:",r),q(o=>o.filter(h=>h._id!==r.convoId)),_(o=>(console.log("Current selected issue:",o==null?void 0:o._id),console.log("Deleted issue:",r.convoId),(o==null?void 0:o._id)===r.convoId?(console.log("âœ… Deleted issue was selected - clearing selection"),null):(console.log("âŒ Deleted issue was not selected - keeping selection"),o)))},m=r=>{console.log("[Socket] Issue forwarded:",r),q(o=>o.map(h=>h._id===r.convoId?(console.log("âœ… Updating forwarded issue"),r.conversation):h)),_(o=>!o||o._id!==r.convoId?o:(console.log("âœ… Updating selected forwarded issue"),r.conversation))};return v.on("new_issue_created",s),v.on("issue_response_added",a),v.on("issue_deleted",l),v.on("issue_forwarded",m),()=>{console.log("[Socket] Leaving discussion room"),v.emit("leave_project_discussion",{projectId:c}),v.off("new_issue_created",s),v.off("issue_response_added",a),v.off("issue_deleted",l),v.off("issue_forwarded",m),v.off("recent_discussions")}},[i,c,k==null?void 0:k.id]),g.useEffect(()=>{if(R!=null&&R.pages){const s=R.pages.flatMap(a=>a.discussions||[]);q(s)}},[R]),g.useEffect(()=>{var s;(s=se.current)==null||s.scrollIntoView({behavior:"smooth"})},[G]);const _e=(Fe||[]).map(s=>({value:s._id,label:s.staffName,email:s.email,role:s.role})),Ee=(Ce||[]).map(s=>({value:s._id,label:s.username,email:s.email,role:s.role})),Ae=(Oe||[]).map(s=>({value:s._id,label:s.username,email:s.email,role:s.role})),Ie=(Te||[]).map(s=>({value:s._id,label:s.username,email:s.email,role:s.role})),M=[..._e,...Ee,...Ae,...Ie],te=M.filter(s=>{var a,l;return s.value!==(k==null?void 0:k.id)&&s.value!==((l=(a=t==null?void 0:t.issue)==null?void 0:a.raisedBy)==null?void 0:l._id)}),Le=s=>{const a=M==null?void 0:M.find(l=>(l==null?void 0:l.value)===s);console.log("selectedAssignee",a),C(l=>({...l,selectedStaff:a==null?void 0:a.value,selectStaffRole:a==null?void 0:a.role}))},qe=async s=>{const a=te.find(l=>l.value===s);J(a==null?void 0:a.value),X((a==null?void 0:a.role)||""),await Be(a==null?void 0:a.value,a==null?void 0:a.role)},Me=async()=>{var s,a,l,m;try{if(!y.issue.trim()||!y.selectedStaff){S("Please fill all required fields");return}if(w.responseType==="dropdown"&&w.dropdownOptions.length===0){S("Please add at least one dropdown option");return}S(null),await p({organizationId:i,projectId:c,selectStaff:y.selectedStaff,selectStaffRole:y.selectStaffRole,issue:y.issue,responseType:w.responseType,isMessageRequired:w.isMessageRequired,files:y.files??[],dropdownOptions:w.responseType==="dropdown"?w.dropdownOptions:void 0}),C({issue:"",selectedStaff:"",dropdownOptions:"",selectStaffRole:"",files:[]}),D({responseType:"text",isMessageRequired:!1,dropdownOptions:[]}),V(!1),T({title:"Success",description:"Ticket created successfully"})}catch(r){T({title:"Error",description:((a=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:a.message)||(r==null?void 0:r.message)||"Failed to create the ticket",variant:"destructive"}),S(((m=(l=r==null?void 0:r.response)==null?void 0:l.data)==null?void 0:m.message)||(r==null?void 0:r.message)||"Failed to create ticket")}},Ue=async s=>{var a,l;try{await u({convoId:s,projectId:c}),(t==null?void 0:t._id)===s&&_(null),T({title:"Success",description:"Ticket Deleted successfully"})}catch(m){T({title:"Error",description:((l=(a=m==null?void 0:m.response)==null?void 0:a.data)==null?void 0:l.message)||(m==null?void 0:m.message)||"Failed to delete the ticket",variant:"destructive"})}},Be=async(s,a)=>{var l,m;if(!s||!a){alert("Please select a staff");return}try{await I({projectId:c,convoId:t._id,forwardToStaff:s,forwardToStaffRole:a}),J(""),X(""),b&&T({title:"Success",description:"Ticket Forwarded successfully"})}catch(r){T({title:"Error",description:((m=(l=r==null?void 0:r.response)==null?void 0:l.data)==null?void 0:m.message)||(r==null?void 0:r.message)||"Failed to forward the Ticket",variant:"destructive"})}},$e=async()=>{var s,a,l,m,r,o;try{if(!t)return;if(t.issue.responseType==="dropdown"&&!j.content){S("Please select an option");return}if(t.issue.responseType==="text"&&!((s=j.content)!=null&&s.trim())){S("Please enter a response");return}if(t.issue.responseType==="file"&&j.files.length===0){S("Please upload at least one file");return}if(t.issue.isMessageRequired&&!((a=j.message)!=null&&a.trim())){S("Please add a message");return}S(null),await n({convoId:t._id,responseContent:j.content,optionalMessage:j.message,files:j.files.length>0?j.files:void 0,projectId:c}),E({content:"",files:[],message:""}),T({title:"Success",description:"Resolved successfully"})}catch(h){T({title:"Error",description:((m=(l=h==null?void 0:h.response)==null?void 0:l.data)==null?void 0:m.message)||(h==null?void 0:h.message)||"Failed to Resolve the ticket",variant:"destructive"}),S(((o=(r=h==null?void 0:h.response)==null?void 0:r.data)==null?void 0:o.message)||(h==null?void 0:h.message)||"Failed to resolve the ticket")}},Ke=s=>{if(C(a=>({...a,dropdownOptions:s})),s.includes(",")){const a=s.split(",").map(l=>l.trim()).filter(l=>l&&!w.dropdownOptions.includes(l));a.length>0&&(D(l=>({...l,dropdownOptions:[...l.dropdownOptions,...a]})),C(l=>({...l,dropdownOptions:""})))}},Qe=()=>{const s=y.dropdownOptions.trim();s&&!w.dropdownOptions.includes(s)&&(D(a=>({...a,dropdownOptions:[...a.dropdownOptions,s]})),C(a=>({...a,dropdownOptions:""})))},We=s=>{const a=Array.from(s.target.files||[]),l=a.filter(m=>{const r=m.type.startsWith("image/"),o=m.type==="application/pdf";return r||o});l.length!==a.length&&S("Only images and PDFs are allowed"),E(m=>({...m,files:[...m.files,...l]}))},Ge=s=>{const a=Array.from(s.target.files||[]),l=a.filter(m=>{const r=m.type.startsWith("image/"),o=m.type==="application/pdf";return r||o});l.length!==a.length&&S("Only images and PDFs are allowed"),C(m=>({...m,files:[...m.files,...l]}))},ae=t&&!t.response&&t.issue.selectStaff._id===(k==null?void 0:k.id);return e.jsxs("main",{className:"h-full max-h-full !overflow-y-auto bg-gradient-to-br from-blue-50 to-white p-2",children:[e.jsxs("header",{className:" flex justify-between w-full pb-2 border-b border-b-[#aaaaaa] mb-2",children:[e.jsxs("h1",{className:"text-3xl font-bold text-blue-600",children:[e.jsx("i",{className:"fa-solid fa-ticket mr-3"}),"Ticket Operations"]}),e.jsxs(P,{onClick:()=>{_(null),V(!z)},className:"bg-blue-600 hover:bg-blue-700 text-white",disabled:x,children:[e.jsx("i",{className:"fas fa-plus mr-1"}),"Raise Ticket"]})]}),e.jsxs("main",{className:"flex flex-col h-full max-h-[92%] lg:flex-row gap-4",children:[e.jsxs("div",{className:"w-full lg:w-1/2 flex flex-col border-r border-blue-200",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto space-y-3 pr-2",children:[L?e.jsxs("div",{className:"flex flex-col items-center justify-center h-40",children:[e.jsx("i",{className:"fas fa-spinner fa-spin text-blue-600 text-3xl mb-2"}),e.jsx("p",{className:"text-gray-600",children:"Loading tickets..."})]}):G.length===0?e.jsx("section",{className:"flex items-center justify-center h-[95%]",children:e.jsxs("div",{className:"text-center py-12 text-gray-500 ",children:[e.jsx("i",{className:"fas fa-inbox text-5xl mb-3 opacity-50"}),e.jsx("p",{className:"text-lg",children:"No Tickets yet"}),e.jsx("p",{className:"text-sm",children:"Create your first Ticket to get started"})]})}):G.map(s=>{var a;return e.jsx("div",{onClick:()=>_(s),className:`group relative rounded-xl cursor-pointer border-2 transition-all duration-300 ${(t==null?void 0:t._id)===s._id?"bg-gradient-to-br from-blue-50 to-indigo-50 border-blue-500 shadow-lg":"bg-white border-gray-200 hover:border-blue-300 hover:shadow-md"}`,children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx("i",{className:"fas fa-user text-white text-sm"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-xs text-gray-500 font-medium",children:"Assigned to"}),e.jsx("p",{className:"text-sm font-bold text-gray-800 truncate",children:((a=s.issue.selectStaff)==null?void 0:a.name)||"Unknown Staff"})]})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("span",{className:`text-xs px-3 py-1.5 rounded-full font-semibold flex items-center gap-1.5 whitespace-nowrap ${s.response?"bg-gradient-to-r from-green-500 to-emerald-500 text-white shadow-sm":"bg-gradient-to-r from-amber-400 to-orange-400 text-white shadow-sm"}`,children:s.response?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-check-circle"}),e.jsx("span",{children:"Done"})]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-clock"}),e.jsx("span",{children:"Pending"})]})}),e.jsx(P,{size:"sm",className:"bg-red-500 hover:bg-red-600 text-white px-2.5 py-1.5 rounded-lg shadow-md hover:shadow-lg transition-all opacity-0 group-hover:opacity-100",onClick:l=>{l.stopPropagation(),Ue(s._id)},isLoading:f&&N.convoId===s._id,children:e.jsx("i",{className:"fas fa-trash text-xs"})})]})]}),e.jsx("div",{className:"mb-3 pl-10",children:e.jsx("p",{className:"text-sm text-gray-700 line-clamp-2 leading-relaxed",children:s.issue.issue})}),e.jsxs("div",{className:"flex gap-2 items-center flex-wrap pl-10",children:[e.jsxs("span",{className:"bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-xs font-semibold flex items-center gap-1.5 border border-blue-200",children:[s.issue.responseType==="dropdown"&&e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-list-ul"}),e.jsx("span",{children:"Dropdown"})]}),s.issue.responseType==="text"&&e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-align-left"}),e.jsx("span",{children:"Text"})]}),s.issue.responseType==="file"&&e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-file-upload"}),e.jsx("span",{children:"File"})]})]}),s.issue.isMessageRequired&&e.jsxs("span",{className:"bg-purple-100 text-purple-700 px-3 py-1 rounded-full text-xs font-semibold flex items-center gap-1.5 border border-purple-200",children:[e.jsx("i",{className:"fas fa-comment-dots"}),e.jsx("span",{children:"Additional Message Required"})]}),s.issue.files&&s.issue.files.length>0&&e.jsxs("span",{className:"bg-indigo-100 text-indigo-700 px-3 py-1 rounded-full text-xs font-semibold flex items-center gap-1.5 border border-indigo-200",children:[e.jsx("i",{className:"fas fa-paperclip"}),e.jsx("span",{children:s.issue.files.length})]}),e.jsxs("span",{className:"text-xs text-gray-500 ml-auto flex items-center gap-1",children:[e.jsx("i",{className:"far fa-calendar-alt"}),new Date(s.createdAt).toLocaleDateString("en-US",{month:"short",day:"numeric"})]})]})]})},s._id)}),e.jsx("div",{ref:se})]}),Se&&e.jsxs(P,{onClick:()=>Re(),className:"w-full mt-3 bg-blue-100 hover:bg-blue-200 text-blue-700 border border-blue-300",children:[e.jsx("i",{className:"fas fa-arrow-down mr-2"}),"Load More Discussions"]})]}),e.jsxs("div",{className:"w-full lg:w-1/2 flex flex-col bg-white rounded-lg border border-blue-200  overflow-y-auto",children:[z&&e.jsxs("div",{className:" bg-white rounded-xl h-full shadow-lg border border-blue-200 overflow-y-scroll",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-white rounded-lg flex items-center justify-center",children:e.jsx("i",{className:"fas fa-plus-circle text-blue-600 text-xl"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:"Create New Ticket"}),e.jsx("p",{className:"text-xs text-blue-100",children:"Fill in the details to raise a new ticket"})]})]})}),e.jsxs("div",{className:"p-6 space-y-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(F,{className:"text-gray-700 font-semibold flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-user-check text-blue-600"}),"Select Staff to Respond"]}),e.jsx(ye,{options:M,placeholder:"Choose staff member",searchPlaceholder:"Search by name...",value:y.selectedStaff,onValueChange:s=>{Le(s)},searchBy:"name",displayFormat:"detailed",className:"w-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(F,{className:"text-gray-700 font-semibold flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-comment-dots text-blue-600"}),"Ticket Description"]}),e.jsx(H,{value:y.issue,onChange:s=>C(a=>({...a,issue:s.target.value})),placeholder:"Describe the ticket in detail...",className:"w-full min-h-24 border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 rounded-lg"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(F,{className:"text-gray-700 font-semibold flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-reply text-blue-600"}),"Response Method"]}),e.jsxs("select",{value:w.responseType,onChange:s=>D(a=>({...a,responseType:s.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white",children:[e.jsx("option",{value:"text",children:"ðŸ’¬ Text Response"}),e.jsx("option",{value:"dropdown",children:"ðŸ“‹ Dropdown Selection"}),e.jsx("option",{value:"file",children:"ðŸ“Ž File Upload (Image/PDF)"})]})]}),w.responseType==="dropdown"&&e.jsxs("div",{className:"space-y-3 p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs(F,{className:"text-gray-700 font-semibold flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-list text-blue-600"}),"Dropdown Options"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(He,{value:y.dropdownOptions,onChange:s=>Ke(s.target.value),onKeyDown:s=>{s.key==="Enter"&&(D(a=>({...a,dropdownOptions:[...a.dropdownOptions,s.target.value]})),C(a=>({...a,dropdownOptions:""})))},placeholder:"Enter options: Option 1, Option 2, Option 3",className:"flex-1 border-blue-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200"}),e.jsx(P,{onClick:Qe,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 shadow-md hover:shadow-lg transition-all",children:e.jsx("i",{className:"fas fa-plus"})})]}),e.jsxs("p",{className:"text-xs text-blue-700 flex items-center gap-1",children:[e.jsx("i",{className:"fas fa-info-circle"}),"Type comma-separated values and press Add or Enter"]}),w.dropdownOptions.length>0&&e.jsx("div",{className:"space-y-2 mt-3",children:w.dropdownOptions.map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between bg-white p-3 rounded-lg border border-blue-200 hover:shadow-md transition-shadow group",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-bold",children:a+1}),e.jsx("span",{className:"text-sm text-gray-700 font-medium",children:s})]}),e.jsx("button",{onClick:()=>D(l=>({...l,dropdownOptions:l.dropdownOptions.filter((m,r)=>r!==a)})),className:"text-red-500 hover:text-white hover:bg-red-500 p-2 rounded-lg transition-all opacity-0 group-hover:opacity-100",children:e.jsx("i",{className:"fas fa-trash text-sm"})})]},a))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(F,{className:"text-gray-700 font-semibold flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-paperclip text-blue-600"}),"Upload Files (Images/PDFs)",e.jsx("span",{className:"text-xs font-normal text-gray-500",children:"(Optional)"})]}),e.jsx("input",{ref:ee,type:"file",multiple:!0,accept:"image/*,.pdf",onChange:Ge,className:"hidden"}),e.jsx("div",{onClick:()=>{var s;return(s=ee.current)==null?void 0:s.click()},className:"w-full p-6 border-2 border-dashed border-blue-300 rounded-xl hover:border-blue-500 hover:bg-blue-50 transition-all cursor-pointer group",children:e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"fas fa-cloud-upload-alt text-4xl text-blue-400 group-hover:text-blue-600 mb-2 transition-colors"}),e.jsx("p",{className:"text-blue-600 font-medium group-hover:text-blue-700",children:"Click to upload files"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Support: JPG, PNG, PDF (Max 10MB)"})]})}),y.files.length>0&&e.jsxs("div",{className:"space-y-2 p-4 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("i",{className:"fas fa-check-circle text-green-600"}),e.jsxs("p",{className:"text-sm font-semibold text-gray-700",children:["Uploaded Files (",y.files.length,")"]})]}),e.jsx("div",{className:"max-h-48 overflow-y-auto space-y-2",children:y.files.map((s,a)=>e.jsxs("div",{className:"flex items-center gap-3 bg-white p-3 rounded-lg border border-gray-200 hover:border-blue-300 hover:shadow-md transition-all group",children:[s.type.startsWith("image")?e.jsx("img",{src:URL.createObjectURL(s)||ke,alt:s.name,className:"w-12 h-12 object-cover rounded-lg cursor-pointer hover:opacity-80 ring-2 ring-gray-200",onClick:()=>{A({isOpen:!0,type:"image",url:URL.createObjectURL(s)})}}):e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center",children:e.jsx("i",{className:"fas fa-file-pdf text-red-600 text-xl"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-gray-800 truncate font-medium",children:s.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[(s.size/1024).toFixed(2)," KB"]})]}),e.jsx("button",{onClick:()=>C(l=>({...l,files:l.files.filter((m,r)=>r!==a)})),className:"text-red-500 hover:text-white hover:bg-red-500 p-2 rounded-lg transition-all opacity-0 group-hover:opacity-100",title:"Delete file",children:e.jsx("i",{className:"fas fa-trash text-sm"})})]},a))})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:[e.jsx("input",{type:"checkbox",id:"messageRequired",checked:w.isMessageRequired,onChange:s=>D(a=>({...a,isMessageRequired:s.target.checked})),className:"w-5 h-5 accent-blue-600 cursor-pointer"}),e.jsxs("label",{htmlFor:"messageRequired",className:"text-sm text-gray-700 cursor-pointer font-medium flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-exclamation-circle text-amber-600"}),"Require additional message with response"]})]}),$&&e.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 text-red-700 rounded-lg flex items-start gap-3",children:[e.jsx("i",{className:"fas fa-exclamation-triangle text-xl mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Error"}),e.jsx("p",{className:"text-sm",children:$})]})]})]}),e.jsxs("div",{className:"bg-gray-50 px-6 py-4 border-t border-gray-200 flex gap-3",children:[e.jsx(P,{onClick:Me,disabled:x,className:"flex-1 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-semibold py-3 rounded-lg shadow-md hover:shadow-lg transition-all disabled:opacity-50",children:x?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin mr-2"}),"Creating Ticket..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-check-circle mr-2"}),"Create Ticket"]})}),e.jsxs(P,{onClick:()=>V(!1),className:"flex-1 bg-white hover:bg-gray-100 text-gray-700 font-semibold py-3 rounded-lg border-2 border-gray-300 hover:border-gray-400 transition-all",children:[e.jsx("i",{className:"fas fa-times-circle mr-2"}),"Cancel"]})]})]}),t?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-500 text-white p-4 rounded-t-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center",children:e.jsx("i",{className:"fas fa-clipboard-list text-blue-600 text-xl"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-white",children:"Ticket Details"}),e.jsxs("p",{className:"text-xs text-blue-100 flex items-center gap-1",children:[e.jsx("i",{className:"far fa-calendar-alt mr-1"}),new Date(t.createdAt).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),e.jsx("span",{className:"mx-1",children:"â€¢"}),new Date(t.createdAt).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})]})]})]}),e.jsx("div",{className:`px-3 py-1.5 rounded-lg font-semibold text-sm flex items-center gap-2 ${t.response?"bg-green-500 text-white":"bg-amber-500 text-white"}`,children:t.response?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-check-circle"}),e.jsx("span",{children:"Resolved"})]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-clock"}),e.jsx("span",{children:"Pending"})]})})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx("i",{className:"fas fa-user text-purple-600 text-xl"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Raised By"}),e.jsx("p",{className:"text-gray-900 font-semibold",children:((re=t.issue.raisedBy)==null?void 0:re.name)||"Unknown"}),e.jsx("p",{className:"text-xs text-gray-500",children:(le=t.issue.raisedBy)==null?void 0:le.email})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("i",{className:"fas fa-user-check text-blue-600 text-xl"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Assigned To"}),e.jsx("p",{className:"text-gray-900 font-semibold",children:((ie=t.issue.selectStaff)==null?void 0:ie.name)||"Unknown"}),e.jsx("p",{className:"text-xs text-gray-500",children:(ne=t.issue.selectStaff)==null?void 0:ne.email})]})]})})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"px-3 py-1 bg-indigo-100 text-indigo-700 rounded-full text-sm font-medium",children:[t.issue.responseType==="dropdown"&&e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-list mr-2"}),"Dropdown Response"]}),t.issue.responseType==="text"&&e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-keyboard mr-2"}),"Text Response"]}),t.issue.responseType==="file"&&e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-file-upload mr-2"}),"File Upload Response"]})]})}),t.issue.selectStaff._id===(k==null?void 0:k.id)&&!t.response&&e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("i",{className:"fas fa-share text-amber-600"}),e.jsx("h3",{className:"font-semibold text-amber-900",children:"Forward Ticket"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"forwardstff",type:"checkbox",checked:Y,onChange:()=>De(s=>!s),className:"w-4 h-4 text-blue-600 rounded"}),e.jsx(F,{htmlFor:"forwardstff",className:"cursor-pointer text-sm text-gray-700",children:"Enable forwarding (only if other staff is available)"})]}),Y&&e.jsx(ye,{options:te,placeholder:"Choose staff to forward",searchPlaceholder:"Search by name...",value:Pe,onValueChange:s=>{qe(s)},searchBy:"name",displayFormat:"detailed",className:"w-full",enabled:Y})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("i",{className:"fas fa-info-circle text-blue-600"}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"Ticket Description"})]}),e.jsx("p",{className:"text-gray-700 leading-relaxed whitespace-pre-wrap",children:t.issue.issue})]}),((oe=t==null?void 0:t.issue)==null?void 0:oe.files)&&((ce=(de=t==null?void 0:t.issue)==null?void 0:de.files)==null?void 0:ce.length)>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("i",{className:"fas fa-paperclip text-blue-600"}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"Ticket Attachments"}),e.jsxs("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full",children:[(me=t==null?void 0:t.issue)==null?void 0:me.files.length," file",((xe=t==null?void 0:t.issue)==null?void 0:xe.files.length)>1?"s":""]})]}),((pe=t==null?void 0:t.issue)==null?void 0:pe.files.some(s=>s.type==="image"))&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("i",{className:"fas fa-images text-purple-600"}),e.jsx("h4",{className:"font-semibold text-gray-800 text-sm",children:"Images"}),e.jsx("span",{className:"text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded-full",children:(fe=t==null?void 0:t.issue)==null?void 0:fe.files.filter(s=>s.type==="image").length})]}),e.jsx(ve,{imageFiles:(ue=t==null?void 0:t.issue)==null?void 0:ue.files.filter(s=>s.type==="image"),height:150,minWidth:150,maxWidth:200})]}),((he=t==null?void 0:t.issue)==null?void 0:he.files.some(s=>s.type==="pdf"))&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("i",{className:"fas fa-file-pdf text-red-600"}),e.jsx("h4",{className:"font-semibold text-gray-800 text-sm",children:"Documents"}),e.jsx("span",{className:"text-xs bg-red-100 text-red-700 px-2 py-1 rounded-full",children:(ge=t==null?void 0:t.issue)==null?void 0:ge.files.filter(s=>s.type==="pdf").length})]}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:(be=t==null?void 0:t.issue)==null?void 0:be.files.filter(s=>s.type==="pdf").map((s,a)=>e.jsxs("div",{className:"flex items-center gap-4 bg-gradient-to-r from-red-50 to-orange-50 p-4 rounded-lg border border-red-200 hover:shadow-md transition-all group",children:[e.jsx("div",{onClick:()=>{A({isOpen:!0,type:"pdf",url:s.url})},className:"w-14 h-14 bg-red-100 rounded-lg flex items-center justify-center cursor-pointer hover:bg-red-200 transition-colors",children:e.jsx("i",{className:"fas fa-file-pdf text-red-600 text-2xl"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900 truncate",children:s.originalName||`Document ${a+1}.pdf`}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[e.jsx("i",{className:"far fa-calendar mr-1"}),Xe(s.uploadedAt)]})]}),e.jsxs("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"px-3 py-2 bg-white text-red-600 rounded-lg hover:bg-red-600 hover:text-white transition-colors font-medium text-sm group-hover:shadow-md",title:"Open in new tab",children:[e.jsx("i",{className:"fas fa-external-link-alt mr-1"}),"Open"]})]},a))})]})]}),t.response&&e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-emerald-50 rounded-lg shadow-sm border border-blue-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx("i",{className:"fas fa-check text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-blue-900 text-lg",children:"Response Provided"}),e.jsxs("p",{className:"text-xs text-blue-700",children:[e.jsx("i",{className:"far fa-clock mr-1"}),new Date(t.response.createdAt).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 mb-4",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Responded By"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx("i",{className:"fas fa-user text-blue-600 text-sm"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:((je=t.response.responsededBy)==null?void 0:je.name)||"Unknown"}),e.jsx("p",{className:"text-xs text-gray-500",children:(Ne=t.response.responsededBy)==null?void 0:Ne.email})]})]})]}),t.response.dropdownResponse&&e.jsxs("div",{className:"bg-white rounded-lg p-4 mb-4",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Selected Option"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-check-circle text-green-600"}),e.jsx("p",{className:"font-bold text-gray-900",children:t.response.dropdownResponse})]})]}),t.response.textResponse&&e.jsxs("div",{className:"bg-white rounded-lg p-4 mb-4",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Response Message"}),e.jsx("p",{className:"text-gray-700 leading-relaxed whitespace-pre-wrap",children:t.response.textResponse})]}),t.response.fileResponse&&t.response.fileResponse.length>0&&e.jsxs("div",{className:"bg-white rounded-lg p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("i",{className:"fas fa-paperclip text-gray-600"}),e.jsx("p",{className:"font-semibold text-gray-900",children:"Attached Files"}),e.jsx("span",{className:"text-xs bg-gray-100 text-gray-700 px-2 py-1 rounded-full",children:t.response.fileResponse.length})]}),t.response.fileResponse.some(s=>s.type==="image")&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("i",{className:"fas fa-images text-purple-600"}),e.jsx("h5",{className:"font-semibold text-gray-800 text-sm",children:"Images"}),e.jsx("span",{className:"text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded-full",children:t.response.fileResponse.filter(s=>s.type==="image").length})]}),e.jsx(ve,{imageFiles:t.response.fileResponse.filter(s=>s.type==="image"),height:120,minWidth:120,maxWidth:140})]}),t.response.fileResponse.some(s=>s.type==="pdf")&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("i",{className:"fas fa-file-pdf text-red-600"}),e.jsx("h5",{className:"font-semibold text-gray-800 text-sm",children:"Documents"}),e.jsx("span",{className:"text-xs bg-red-100 text-red-700 px-2 py-1 rounded-full",children:t.response.fileResponse.filter(s=>s.type==="pdf").length})]}),e.jsx("div",{className:"space-y-3",children:t.response.fileResponse.filter(s=>s.type==="pdf").map((s,a)=>e.jsxs("div",{className:"flex items-center gap-3 bg-gradient-to-r from-red-50 to-orange-50 p-3 rounded-lg border border-red-200 hover:shadow-md transition-all group",children:[e.jsx("div",{onClick:()=>{A({isOpen:!0,type:"pdf",url:s.url})},className:"w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center cursor-pointer hover:bg-red-200 transition-colors",children:e.jsx("i",{className:"fas fa-file-pdf text-red-600 text-xl"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900 truncate",children:s.originalName||`Document ${a+1}`}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:new Date(s.uploadedAt).toLocaleDateString()})]}),e.jsxs("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"px-3 py-1.5 bg-white text-red-600 rounded-lg hover:bg-red-600 hover:text-white transition-colors text-sm font-medium",title:"Open in new tab",children:[e.jsx("i",{className:"fas fa-external-link-alt mr-1"}),"Open"]})]},a))})]})]}),t.response.optionalMessage&&e.jsxs("div",{className:"bg-white rounded-lg p-4",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Additional Message"}),e.jsx("p",{className:"text-gray-700 leading-relaxed whitespace-pre-wrap",children:t.response.optionalMessage})]})]}),ae&&!t.response&&e.jsxs("div",{className:"bg-white rounded-lg shadow-lg border border-blue-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx("i",{className:"fas fa-reply text-white"})}),e.jsx("h3",{className:"font-bold text-blue-900 text-lg",children:"Provide Your Response"})]}),e.jsxs("div",{className:"space-y-5",children:[t.issue.responseType==="text"&&e.jsxs("div",{children:[e.jsxs(F,{className:"text-gray-700 font-semibold mb-2 block",children:[e.jsx("i",{className:"fas fa-keyboard mr-2 text-blue-600"}),"Your Response"]}),e.jsx(H,{value:j.content||"",onChange:s=>E(a=>({...a,content:s.target.value})),placeholder:"Type your detailed response here...",className:"w-full min-h-32 border-gray-300 focus:border-blue-500 focus:ring-blue-500"})]}),t.issue.responseType==="dropdown"&&e.jsxs("div",{children:[e.jsxs(F,{className:"text-gray-700 font-semibold mb-2 block",children:[e.jsx("i",{className:"fas fa-list mr-2 text-blue-600"}),"Select Your Response"]}),e.jsxs("select",{value:j.content||"",onChange:s=>E(a=>({...a,content:s.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"-- Choose an option --"}),(we=t.issue.dropdownOptions)==null?void 0:we.map((s,a)=>e.jsx("option",{value:s,children:s},a))]})]}),t.issue.responseType==="file"&&e.jsxs("div",{children:[e.jsxs(F,{className:"text-gray-700 font-semibold mb-2 block",children:[e.jsx("i",{className:"fas fa-upload mr-2 text-blue-600"}),"Upload Response Files"]}),e.jsx("input",{ref:Z,type:"file",multiple:!0,accept:"image/*,.pdf",onChange:We,className:"hidden"}),e.jsxs("div",{onClick:()=>{var s;return(s=Z.current)==null?void 0:s.click()},className:"w-full p-8 border-2 border-dashed border-blue-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-all cursor-pointer text-center group",children:[e.jsx("i",{className:"fas fa-cloud-upload-alt text-4xl text-blue-400 group-hover:text-blue-600 mb-3"}),e.jsx("p",{className:"text-blue-600 font-semibold group-hover:text-blue-700",children:"Click to upload files"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Supports Images and PDF documents"})]}),j.files.length>0&&e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-700",children:"Uploaded Files"}),e.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full",children:j.files.length})]}),e.jsx("div",{className:"max-h-64 overflow-y-auto space-y-2",children:j.files.map((s,a)=>e.jsxs("div",{className:"flex items-center gap-3 bg-gray-50 p-3 rounded-lg border border-gray-200 hover:bg-gray-100 transition-colors",children:[s.type.startsWith("image")?e.jsx("img",{src:URL.createObjectURL(s),alt:s.name,className:"w-14 h-14 object-cover rounded-lg cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>{A({isOpen:!0,type:"image",url:URL.createObjectURL(s)})}}):e.jsx("div",{className:"w-14 h-14 bg-red-100 rounded-lg flex items-center justify-center",children:e.jsx("i",{className:"fas fa-file-pdf text-red-600 text-xl"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900 truncate",children:s.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[(s.size/1024).toFixed(2)," KB"]})]}),e.jsx("button",{onClick:()=>E(l=>({...l,files:l.files.filter((m,r)=>r!==a)})),className:"text-red-500 hover:text-white hover:bg-red-500 p-2 rounded-lg transition-colors",title:"Remove file",children:e.jsx("i",{className:"fas fa-trash"})})]},a))})]})]}),t.issue.isMessageRequired&&e.jsxs("div",{children:[e.jsxs(F,{className:"text-gray-700 font-semibold mb-2 block",children:[e.jsx("i",{className:"fas fa-comment mr-2 text-blue-600"}),"Additional Message ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(H,{value:j.message||"",onChange:s=>E(a=>({...a,message:s.target.value})),placeholder:"Add any additional comments or explanations...",className:"w-full min-h-24 border-gray-300 focus:border-blue-500 focus:ring-blue-500"})]}),$&&e.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 text-red-700 rounded-lg flex items-start gap-3",children:[e.jsx("i",{className:"fas fa-exclamation-triangle mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Error"}),e.jsx("p",{className:"text-sm",children:$})]})]}),e.jsx(P,{onClick:$e,disabled:d,className:"w-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-bold py-3 rounded-lg shadow-lg hover:shadow-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:d?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin mr-2"}),"Submitting Response..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-paper-plane mr-2"}),"Submit Response"]})})]})]}),!ae&&!t.response&&e.jsx("div",{className:"bg-amber-50 border-l-4 border-amber-500 p-6 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("i",{className:"fas fa-info-circle text-amber-600 text-xl mt-1"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-amber-900",children:"Not Assigned"}),e.jsx("p",{className:"text-sm text-amber-700 mt-1",children:"You are not assigned to respond to this ticket. Only the assigned staff member can provide a response."})]})]})}),t.response&&e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-6 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("i",{className:"fas fa-check-circle text-blue-600 text-xl mt-1"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-blue-900",children:"Ticket Resolved"}),e.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"This ticket has been successfully resolved."})]})]})})]})]})}):z?null:e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"fas fa-hand-pointer text-5xl mb-4 opacity-50"}),e.jsx("p",{className:"font-semibold",children:"Select a ticket to view details"}),e.jsx("p",{className:"text-sm",children:"Click on any ticket from the left panel"})]})})]}),O.isOpen&&e.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",onClick:()=>A({isOpen:!1,type:null,url:""}),children:e.jsxs("div",{className:"bg-white rounded-lg max-w-3xl w-full max-h-[90vh] overflow-auto flex flex-col",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 sticky top-0 bg-white",children:[e.jsxs("h3",{className:"font-bold text-gray-800",children:[e.jsx("i",{className:`fas ${O.type==="pdf"?"fa-file-pdf text-red-500":"fa-image text-blue-500"} mr-2`}),O.type==="pdf"?"PDF Preview":"Image Preview"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("a",{href:O.url,target:"_blank",rel:"noopener noreferrer",className:"px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white rounded text-sm font-medium flex items-center gap-1",children:[e.jsx("i",{className:"fas fa-external-link-alt"}),"Open in New Tab"]}),e.jsxs("button",{onClick:()=>A({isOpen:!1,type:null,url:""}),className:"px-3 py-1 bg-gray-300 hover:bg-gray-400 text-gray-800 rounded text-sm font-medium",children:[e.jsx("i",{className:"fas fa-times"}),"Close"]})]})]}),e.jsxs("div",{className:"flex-1 flex items-center justify-center p-4 bg-gray-50",children:[O.type==="image"&&e.jsx("img",{src:O.url||ke,alt:"Preview",className:"max-w-full max-h-full object-contain rounded-lg shadow-lg"}),O.type==="pdf"&&e.jsx("iframe",{src:O.url,className:"w-full h-full rounded-lg",title:"PDF Preview"})]})]})})]})]})}export{Cs as default};
