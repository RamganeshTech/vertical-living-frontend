import{c as S,q as O,M as T,i as d,P as D,r as y,j as e,$ as I,a1 as M,a0 as A,_ as R,Z as _}from"./index-B0GkKy4g.js";import{g as F}from"./roleCheck-BEAfMS_i.js";import{u as $}from"./useMutation-BZsHp3-C.js";import{B as N}from"./Button-BiqmKnns.js";import{t as j}from"./toast-BSC5QTk1.js";const U=async({api:i,profileData:m})=>{try{const{data:a}=await i.put("/profile/update-profile",m);if(a.ok)return a;throw new Error((a==null?void 0:a.message)||"Profile update failed.")}catch(a){throw a}},q=()=>{const{role:i}=S(),m=F(i),a=["owner","client","staff","CTO","worker"];return $({mutationFn:async({name:b,email:n,phoneNo:s})=>{if(!i)throw new Error("Not authorized.");if(!a.includes(i))throw new Error("Role not allowed.");if(!m)throw new Error("API not found.");return await U({api:m,profileData:{name:b,email:n,phoneNo:s}})},onSuccess:()=>{O.invalidateQueries({queryKey:["user-profile"]})}})},v={owner:{label:"Owner",color:"bg-blue-100 text-blue-800 border-blue-200",icon:"ðŸ‘‘"},staff:{label:"Staff",color:"bg-blue-100 text-blue-800 border-blue-200",icon:"ðŸ‘¥"},CTO:{label:"CTO",color:"bg-blue-100 text-blue-800 border-blue-200",icon:"ðŸš€"},client:{label:"Client",color:"bg-blue-100 text-blue-800 border-blue-200",icon:"ðŸ¤"},worker:{label:"Worker",color:"bg-blue-100 text-blue-800 border-blue-200",icon:"âš¡"}};function K(){const{openMobileSidebar:i,isMobile:m}=T(),{role:a,_id:b}=d(t=>t.authStore),n=D(),s=a==="owner"?d(t=>t.userProfileStore):a==="staff"?d(t=>t.staffProfileStore):a==="CTO"?d(t=>t.CTOProfileStore):a==="client"?d(t=>t.clientProfileStore):a==="worker"?d(t=>t.workerProfileStore):null,u=()=>s?"userName"in s?s.userName:"staffName"in s?s.staffName:"CTOName"in s?s.CTOName:"clientName"in s?s.clientName:"workerName"in s?s.workerName:"-":"-",[r,w]=y.useState({name:u(),email:(s==null?void 0:s.email)||"",phoneNo:(s==null?void 0:s.phoneNo)||""}),{mutateAsync:k,isPending:p}=q(),[o,h]=y.useState(!1),g=t=>{w(f=>({...f,[t.target.name]:t.target.value}))},C=async()=>{var t,f;try{const l=await k({name:r.name,email:r.email,phoneNo:r.phoneNo});j({title:"Success",description:"Completion status updated successfully"});const x={email:r.email,phoneNo:r.phoneNo,role:a,isauthenticated:!0};switch(a){case"owner":n(_({...x,userId:l.data._id,userName:r.name}));break;case"staff":n(R({...x,staffId:l.data._id,staffName:r.name}));break;case"CTO":n(A({...x,CTOId:l.data._id,CTOName:r.name}));break;case"client":n(M({...x,clientId:l.data._id,clientName:r.name}));break;case"worker":n(I({...x,workerId:l.data._id,workerName:r.name}));break;default:throw new Error("Unknown role")}h(!1)}catch(l){j({title:"Error",description:((f=(t=l==null?void 0:l.response)==null?void 0:t.data)==null?void 0:f.message)||l.message||"Failed to update profile data",variant:"destructive"})}},P=()=>{w({name:u(),email:"",phoneNo:""}),h(!1)},c=v[a]||v.worker,E=u().charAt(0).toUpperCase();return e.jsxs("div",{className:"max-h-screen overflow-y-auto bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 sticky top-0 z-10",children:e.jsx("div",{className:"px-3 sm:px-4 md:px-6 lg:px-8 py-3 sm:py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4 min-w-0 flex-1",children:[m&&e.jsx("button",{onClick:i,className:"p-2 rounded-lg border border-gray-700 hover:bg-gray-300 transition-colors lg:hidden flex-shrink-0",title:"Open Menu",children:e.jsx("i",{className:"w-4 h-4 sm:w-5 sm:h-5 fas fa-bars !text-gray-600"})}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0",children:[e.jsx("div",{className:"p-1.5 sm:p-2 bg-gray-100 rounded-lg flex-shrink-0",children:e.jsx("i",{className:"w-5 h-5 sm:w-6 sm:h-6 fas fa-user text-gray-600"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h1",{className:"text-lg sm:text-xl md:text-2xl font-bold text-gray-900 truncate",children:"My Profile"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 hidden sm:block",children:"Manage your personal information"})]})]})]}),!o&&e.jsxs(N,{onClick:()=>h(!0),className:"flex items-center gap-1.5 sm:gap-2 px-3 sm:px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-xs sm:text-sm font-medium flex-shrink-0",children:[e.jsx("i",{className:"w-3 h-3 sm:w-4 sm:h-4 fas fa-pen"}),e.jsx("span",{className:"hidden sm:inline",children:"Edit Profile"}),e.jsx("span",{className:"sm:hidden",children:"Edit"})]})]})})}),e.jsx("div",{className:"px-3 sm:px-4 md:px-6 lg:px-8 py-4 sm:py-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-blue-700 px-4 sm:px-6 py-6 sm:py-8 text-white",children:e.jsxs("div",{className:"flex flex-col items-center gap-4 sm:gap-6 md:flex-row",children:[e.jsx("div",{className:"w-20 h-20 sm:w-24 sm:h-24 bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center text-2xl sm:text-3xl font-bold text-white border-2 sm:border-3 border-white/30 shadow-lg flex-shrink-0",children:E}),e.jsxs("div",{className:"text-center md:text-left flex-1 min-w-0",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl font-bold mb-2 sm:mb-3 break-words",children:u()}),e.jsxs("div",{className:"flex items-center justify-center md:justify-start gap-2 sm:gap-3 mb-2 flex-wrap",children:[e.jsx("span",{className:"text-lg sm:text-xl",children:c.icon}),e.jsx("span",{className:"px-3 sm:px-4 py-1.5 sm:py-2 rounded-full text-xs sm:text-sm font-semibold bg-white/90 text-gray-800 border border-white/30",children:c.label})]}),e.jsxs("p",{className:"text-white/80 text-xs sm:text-sm break-all",children:["ID: ",b]})]})]})}),e.jsxs("div",{className:"p-4 sm:p-6 md:p-8",children:[o&&e.jsxs("div",{className:"mb-4 sm:mb-6 p-3 sm:p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-800",children:[e.jsx("i",{className:"w-3 h-3 sm:w-4 sm:h-4 fas fa-pencil"}),e.jsx("span",{className:"font-medium text-sm sm:text-base",children:"Edit Mode"})]}),e.jsx("p",{className:"text-blue-700 text-xs sm:text-sm mt-1",children:"Make your changes and click save when you're done."})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-2 sm:mb-3",children:[e.jsx("i",{className:"w-3 h-3 sm:w-4 sm:h-4 fas fa-user inline mr-2"}),"Full Name"]}),e.jsx("input",{type:"text",name:"name",value:r.name,onChange:g,disabled:!o,className:`w-full px-3 sm:px-4 py-2.5 sm:py-3 border rounded-lg transition-all duration-200 text-sm sm:text-base ${o?"border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 bg-white":"border-gray-200 bg-gray-50 text-gray-700"} disabled:cursor-not-allowed`,placeholder:"Enter your full name"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-2 sm:mb-3",children:[e.jsx("i",{className:"w-3 h-3 sm:w-4 sm:h-4 fas fa-envelope inline mr-2"}),"Email Address"]}),e.jsx("input",{type:"email",name:"email",value:r.email,onChange:g,disabled:!o,className:`w-full px-3 sm:px-4 py-2.5 sm:py-3 border rounded-lg transition-all duration-200 text-sm sm:text-base ${o?"border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 bg-white":"border-gray-200 bg-gray-50 text-gray-700"} disabled:cursor-not-allowed`,placeholder:"Enter your email address"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-2 sm:mb-3",children:[e.jsx("i",{className:"w-3 h-3 sm:w-4 sm:h-4 fas fa-phone inline mr-2"}),"Phone Number"]}),e.jsx("input",{type:"tel",name:"phoneNo",value:r.phoneNo,onChange:g,disabled:!o,className:`w-full px-3 sm:px-4 py-2.5 sm:py-3 border rounded-lg transition-all duration-200 text-sm sm:text-base ${o?"border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 bg-white":"border-gray-200 bg-gray-50 text-gray-700"} disabled:cursor-not-allowed`,placeholder:"Enter your phone number"})]})]}),o&&e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mt-6 sm:mt-8 pt-4 sm:pt-6 border-t border-gray-200",children:[e.jsxs(N,{isLoading:p,onClick:C,disabled:p,className:"flex items-center justify-center gap-2 px-4 sm:px-6 py-2.5 sm:py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium text-sm sm:text-base order-1 sm:order-none",children:[e.jsx("i",{className:"w-3 h-3 sm:w-4 sm:h-4 fas fa-save"}),"Save Changes"]}),e.jsx("button",{onClick:P,disabled:p,className:"px-4 sm:px-6 py-2.5 sm:py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium text-sm sm:text-base order-2 sm:order-none",children:"Cancel"})]})]})]}),e.jsxs("div",{className:"mt-4 sm:mt-6 bg-white rounded-xl shadow-sm border border-gray-200 p-4 sm:p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 mb-3 sm:mb-4",children:[e.jsx("i",{className:"w-4 h-4 sm:w-5 sm:h-5 fas fa-shield text-gray-600"}),e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-900",children:"Account Summary"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-1 sm:gap-2 items-start sm:items-center py-2",children:[e.jsx("span",{className:"text-gray-600 font-medium text-sm sm:text-base",children:"User ID:"}),e.jsx("span",{className:"text-gray-900 font-mono text-xs sm:text-sm bg-gray-100 px-2 py-1 rounded break-all",children:b||"N/A"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-1 sm:gap-2 items-start sm:items-center py-2",children:[e.jsx("span",{className:"text-gray-600 font-medium text-sm sm:text-base",children:"Role:"}),e.jsxs("span",{className:`px-2 sm:px-3 py-1 rounded-full text-xs sm:text-sm font-medium ${c.color} w-fit`,children:[c.icon," ",c.label]})]})]})]})]})})]})}export{K as default};
