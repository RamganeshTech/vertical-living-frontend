import{r as w,a as _,j as e,b as B,d as $,f as E,O as T}from"./index-e8sHY52i.js";import{u as z,a as Y,b as q,c as G,d as K}from"./materialSelectionApi-Bpqk8wOj.js";import{t as c}from"./toast-BSC5QTk1.js";import{B as g}from"./Button-45UYJ-Fj.js";import{c as V}from"./Card-DGP_bFuc.js";import{A as W,S as H}from"./AssignStaff-DLV2QBAB.js";import{D as J}from"./Dialog-D4gNvWOk.js";import{I as Q}from"./Input-BH7aLFkl.js";import{L as U}from"./Label-BjppT9Cq.js";import X from"./MaterialOverviewLoading-Dup0y_YN.js";import{R as Z}from"./ResetStageButton-CRxBbJsE.js";import{S as ee}from"./ShareDocumentWhatsapp-wLKTdZ9m.js";import"./roleCheck-DbhaipVR.js";import"./useQuery-CqjHwNP0.js";import"./useMutation-BqjQ-Xv_.js";import"./getAllUsersApi-CSaJikjA.js";import"./Skeleton-C9CSd2lw.js";import"./documentationApi-C447Be6X.js";const se=({room:t,projectId:u,roomType:m})=>{var i;const o=_(),{mutateAsync:f,isPending:s}=z(),p=async r=>{var l,j;r.stopPropagation();try{if(!confirm("Are you sure you need to delete the room?"))return;await f({projectId:u,roomId:t._id}),c({title:"Success",description:"Room deleted successfully"})}catch(h){c({title:"Error",description:((j=(l=h==null?void 0:h.response)==null?void 0:l.data)==null?void 0:j.message)||"Failed to delete the room",variant:"destructive"})}},a=m==="customRoom"?t.items:t.roomFields;return e.jsxs("div",{onClick:()=>o(`materialroom/${t._id}/${m}`),className:"border-l-4 border-blue-600 cursor-pointer shadow-sm hover:shadow-md transition-all duration-200 rounded-lg p-4 bg-white flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:t.name}),e.jsxs("p",{className:"text-sm text-blue-500",children:["No of Fields: ",(i=Object.keys(a||{}))==null?void 0:i.length]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsx("button",{onClick:r=>{r.stopPropagation(),o(`materialroom/${t._id}/${m}`)},className:"text-sm text-blue-600 underline hover:no-underline cursor-pointer",children:"View →"}),e.jsxs(g,{variant:"danger",size:"sm",onClick:p,disabled:s,className:"flex items-center gap-1 px-2 py-1 text-sm hover:text-white",children:[e.jsx("i",{className:"fas fa-trash"})," Delete"]})]})]})},L=w.memo(se),te=({onClose:t,projectId:u,refetch:m})=>{const[o,f]=w.useState(""),{mutateAsync:s,isPending:p}=Y(),a=async()=>{var i,r;if(!o.trim()){c({title:"Error",description:"Room name is required",variant:"destructive"});return}try{await s({projectId:u,name:o}),c({title:"Success",description:"Room created successfully ✅"}),t(),m()}catch(l){c({title:"Error",description:((r=(i=l==null?void 0:l.response)==null?void 0:i.data)==null?void 0:r.message)||l.message||"Failed to create room",variant:"destructive"})}};return e.jsx("div",{onClick:t,className:"fixed inset-0 bg-black/70 bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{onClick:i=>i.stopPropagation(),className:"bg-white rounded-lg w-full max-w-sm p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsxs(U,{htmlFor:"roomName",className:"text-sm text-gray-700",children:["Room Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(Q,{id:"roomName",value:o,onChange:i=>f(i.target.value),placeholder:"e.g., Master Bedroom, Kitchen",className:"mt-1"})]}),e.jsx(g,{onClick:a,disabled:p,className:"w-full bg-blue-600 text-white hover:bg-blue-700 transition rounded-xl",children:"Create Room"})]})})};function we(){var C,R,S,A,M,k,P;const{projectId:t,organizationId:u}=B(),{isMobile:m,openMobileSidebar:o}=$(),f=E(),{data:s,isLoading:p,error:a,refetch:i}=q(t),{mutateAsync:r,isPending:l}=G(),{mutateAsync:j,isPending:h}=K(),[v,b]=w.useState(!1);if(p)return e.jsx(X,{});const O=!((C=s==null?void 0:s.customRooms)!=null&&C.length)&&!((R=s==null?void 0:s.rooms)!=null&&R.length),y=f.pathname.includes("/materialroom"),D=async()=>{var n,F;try{await j({projectId:t}),c({description:"Completion status updated successfully",title:"Success"})}catch(N){c({title:"Error",description:((F=(n=N==null?void 0:N.response)==null?void 0:n.data)==null?void 0:F.message)||N.message||"Failed to update completion status",variant:"destructive"})}},{rooms:d,customRooms:x}=s||{},I=((d==null?void 0:d.length)||0)+((x==null?void 0:x.length)||0);return e.jsx("div",{className:"flex flex-col h-full w-full  py-4",children:y?e.jsx(T,{}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4 mb-4",children:[e.jsxs("h2",{className:"text-2xl sm:text-3xl font-semibold text-blue-600 flex items-center",children:[m&&e.jsx("button",{onClick:o,className:"mr-3 p-2 rounded-md border-gray-300 hover:bg-gray-100",title:"Open Menu",children:e.jsx("i",{className:"fa-solid fa-bars"})}),e.jsx("i",{className:"fas fa-box mr-2"})," Material Selection"]}),e.jsxs("div",{className:"!w-[100%] sm:!w-[100%] lg:!w-[50%] xl:!w-[65%]  flex flex-col sm:flex-row gap-3 justify-end",children:[e.jsxs("div",{className:"flex flex-wrap  md:flex-nowrap gap-2 justify-end",children:[e.jsxs(g,{isLoading:h,onClick:D,className:"bg-green-600 hover:bg-green-700 text-white flex-1 sm:flex-initial min-w-max",children:[e.jsx("i",{className:"fa-solid fa-circle-check mr-2"}),"Mark Complete"]}),!y&&e.jsx(g,{variant:"primary",onClick:()=>b(!0),className:"bg-blue-600 text-white flex-1 sm:flex-initial min-w-max",children:"+ Add Room"})]}),e.jsxs("div",{className:"flex flex-wrap md:flex-nowrap gap-2 justify-end",children:[e.jsx(Z,{projectId:t,stageNumber:5,stagePath:"materialconfirmation",className:"flex-1 sm:flex-initial min-w-max"}),!a&&e.jsx(ee,{projectId:t,stageNumber:"5",className:"w-full sm:w-fit",isStageCompleted:s==null?void 0:s.status}),e.jsx(W,{stageName:"MaterialRoomConfirmationModel",projectId:t,organizationId:u,currentAssignedStaff:(s==null?void 0:s.assignedTo)||null,className:"flex-1 sm:flex-initial min-w-max"})]})]})]}),a&&e.jsxs("div",{className:"max-w-xl mx-auto p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center mb-4",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2",children:"⚠️ Error Occurred"}),e.jsx("p",{className:"text-red-500 text-sm mb-4",children:((A=(S=a==null?void 0:a.response)==null?void 0:S.data)==null?void 0:A.message)||(a==null?void 0:a.message)||"Failed to load room data"}),e.jsx(g,{onClick:()=>i(),className:"bg-red-600 text-white px-4 py-2",children:"Retry"})]}),e.jsx("div",{className:"flex-grow min-h-0 flex flex-col",children:!a&&e.jsxs(e.Fragment,{children:[e.jsxs(V,{className:"p-4 mb-4 w-full shadow border-l-4 border-blue-600 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-3 text-blue-700 text-sm font-medium mb-2",children:[e.jsx("i",{className:"fa-solid fa-clock text-blue-500 text-lg"}),e.jsx("span",{children:"Stage Timings"})]}),e.jsx(H,{completedAt:(M=s==null?void 0:s.timer)==null?void 0:M.completedAt,stageName:"materialconfirmation",projectId:t,formId:s==null?void 0:s._id,deadLine:(k=s==null?void 0:s.timer)==null?void 0:k.deadLine,startedAt:(P=s==null?void 0:s.timer)==null?void 0:P.startedAt,refetchStageMutate:i,deadLineMutate:r,isPending:l})]}),e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("h2",{className:"text-xl sm:text-2xl font-semibold",children:["Total Rooms: ",I]})}),v&&e.jsx(J,{open:v,onOpenChange:b,children:e.jsx(te,{refetch:i,onClose:()=>b(!1),projectId:t})}),e.jsx("div",{className:"flex-grow min-h-[100%] py-2 sm:!min-h-0  overflow-y-auto",children:O?e.jsx("div",{className:"h-full flex items-center justify-center py-8",children:e.jsxs("div",{className:"text-center max-w-md mx-auto",children:[e.jsx("i",{className:"fas fa-door-open text-5xl sm:text-6xl text-blue-300 mb-4"}),e.jsx("h2",{className:"text-xl sm:text-2xl font-semibold text-gray-700 mb-2",children:"No Rooms Added Yet"}),e.jsx("p",{className:"text-gray-500 mb-6",children:"Add rooms to start selecting materials"}),e.jsxs("button",{onClick:()=>b(!0),className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[e.jsx("i",{className:"fas fa-plus mr-2"})," Add Your First Room"]})]})}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[d==null?void 0:d.map(n=>e.jsx(L,{roomType:"predefinedRoom",room:n,projectId:t},n._id)),x==null?void 0:x.map(n=>e.jsx(L,{roomType:"customRoom",room:n,projectId:t},n._id))]})})]})})]})})}export{we as default};
