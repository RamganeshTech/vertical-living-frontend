import{a as K,g as U,b as $,r as c,c as q,j as e,O as J}from"./index-By5P0A7l.js";import{c as Q,d as V,e as W,f as X}from"./commonOrderHistoryMaterialApi-BoumGo1T.js";import{B as o}from"./Button-DLUK8O0t.js";import{I as P}from"./Input-DKpmFZl7.js";import{C as Y,b as Z,d as ee,a as te}from"./Card-CFqBlVQz.js";import{t as se}from"./toast-BSC5QTk1.js";import{L as ae}from"./Label-TAdUzpu-.js";import{S as re}from"./StageGuide-D14I8_Im.js";import"./roleCheck-YGaMnK_P.js";import"./useQuery-Cc7pLKfK.js";import"./useMutation-7YLqc7VE.js";const je=()=>{var v,y,C,w;const{organizationId:d}=K(),{openMobileSidebar:k,isMobile:E}=U(),S=$(),[m,x]=c.useState(""),[p,n]=c.useState(!1),[i,u]=c.useState(null),[f,g]=c.useState(""),{role:l,permission:a}=q(),I=l==="owner"||((v=a==null?void 0:a.commonorder)==null?void 0:v.delete),D=l==="owner"||((y=a==null?void 0:a.commonorder)==null?void 0:y.list),L=l==="owner"||((C=a==null?void 0:a.commonorder)==null?void 0:C.create),_=l==="owner"||((w=a==null?void 0:a.commonorder)==null?void 0:w.edit),{data:r,isLoading:A,error:z,refetch:h}=Q(d),{mutateAsync:F,isPending:M}=V(),{mutateAsync:O,isPending:R}=W(),{mutateAsync:T,isPending:B}=X(),N=location.pathname.split("/");if(N[N.length-1]!=="commonorder")return e.jsx(J,{context:{openMobileSidebar:k,isMobile:E}});const b=async()=>{m.trim()||se({title:"Error",description:"Project Name is mandatory",variant:"destructive"});try{await F({organizationId:d,payload:{projectName:m}}),x(""),n(!1),await h()}catch(t){console.error(t)}},G=async t=>{if(window.confirm("Are you sure?"))try{await O({id:t}),await h()}catch(s){console.error(s)}},H=async()=>{if(!(!f.trim()||!i))try{await T({id:i,payload:{projectName:f}}),u(null),g(""),await h()}catch(t){console.error(t)}};return e.jsxs("div",{className:"max-w-full mx-auto p-2 space-y-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("h1",{className:"text-2xl font-bold text-blue-600",children:[e.jsx("i",{className:"fas fa-layer-group mr-2"}),"Common Projects"]}),e.jsxs("div",{className:"flex gap-3 items-center",children:[!p&&L&&e.jsxs(o,{variant:"primary",onClick:()=>n(!0),children:[e.jsx("i",{className:"fas fa-plus mr-2"}),"Create New Project"]}),e.jsx("div",{className:"w-full sm:w-auto flex justify-end sm:block",children:e.jsx(re,{organizationId:d,stageName:"commonorder"})})]})]}),p&&e.jsx("div",{onClick:()=>n(!1),className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:e.jsxs("div",{onClick:t=>t.stopPropagation(),className:"w-100 flex rounded-2xl bg-white flex-col p-6 gap-3 max-w-xl items-start",children:[e.jsx(ae,{className:"text-2xl",children:"Create Project"}),e.jsx(P,{placeholder:"Enter project name",value:m,onChange:t=>x(t.target.value),autoFocus:!0,onKeyDown:t=>{t.key==="Enter"&&b()}}),e.jsxs("div",{className:"flex w-full  gap-2 justify-end",children:[e.jsxs(o,{variant:"primary",onClick:b,isLoading:M,children:[e.jsx("i",{className:"fas fa-save mr-2"}),"Save"]}),e.jsx(o,{variant:"secondary",onClick:()=>{n(!1),x("")},children:"Cancel"})]})]})}),A&&e.jsx("p",{children:"Loading projects..."}),z&&e.jsx("p",{className:"text-red-500",children:"Something went wrong while loading projects."}),(r==null?void 0:r.length)===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center text-gray-500",children:[e.jsx("i",{className:"fas fa-folder-open text-5xl text-blue-300 mb-4"}),e.jsx("h2",{className:"text-xl font-semibold",children:"No Projects Found"}),e.jsx("p",{children:"Create a project to start managing materials more efficiently."})]}),D&&e.jsx("div",{className:"grid gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:r==null?void 0:r.map(t=>{var j;return e.jsx("div",{onClick:()=>S(`${t._id}`),className:"group transition-transform duration-200 hover:scale-[1.02] cursor-pointer",children:e.jsxs(Y,{className:"h-full bg-white border border-gray-200 shadow-sm border-l-4 border-l-blue-600 rounded-xl overflow-hidden",children:[e.jsx(Z,{className:"p-4 pb-2",children:i===t._id?e.jsx("div",{className:"space-y-2",onClick:s=>s.stopPropagation(),children:e.jsx(P,{value:f,onChange:s=>g(s.target.value),autoFocus:!0,className:"h-9 text-sm border-blue-200 focus:ring-2 focus:ring-blue-500 rounded-lg",placeholder:"Project Name"})}):e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"flex justify-between items-start gap-2",children:e.jsx(ee,{className:"text-lg font-bold text-gray-800 line-clamp-1",children:t.projectName||"Untitled Project"})}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[e.jsx("i",{className:"fas fa-boxes text-xs text-blue-500"}),e.jsxs("span",{className:"text-xs font-semibold",children:[((j=t==null?void 0:t.orderedItems)==null?void 0:j.length)||0," Ordered Items"]})]})]})}),e.jsx(te,{className:"p-4 pt-2",children:e.jsx("div",{className:"flex items-center justify-end gap-2 pt-3",children:i===t._id?e.jsxs("div",{className:"flex gap-2 w-full",onClick:s=>s.stopPropagation(),children:[e.jsx(o,{size:"sm",className:"flex-1 bg-green-600 hover:bg-green-700 text-white rounded-lg h-8",onClick:s=>{s.stopPropagation(),H()},isLoading:B,children:"Save"}),e.jsx(o,{size:"sm",variant:"ghost",className:"h-8 rounded-lg",onClick:s=>{s.stopPropagation(),u(null)},children:"Cancel"})]}):e.jsxs(e.Fragment,{children:[_&&e.jsxs("button",{title:"Edit Name",onClick:s=>{s.stopPropagation(),u(t._id),g(t.projectName||"")},className:"h-8 px-3 flex items-center gap-2 text-xs font-bold text-amber-600 bg-amber-50 hover:bg-amber-100 rounded-lg transition-colors",children:[e.jsx("i",{className:"fas fa-edit"}),"Edit"]}),I&&e.jsx("button",{title:"Delete Project",onClick:s=>{s.stopPropagation(),G(t._id)},className:"h-8 w-8 flex items-center justify-center text-rose-500 hover:bg-rose-50 rounded-lg transition-colors",children:R?e.jsx("i",{className:"fas fa-spinner animate-spin"}):e.jsx("i",{className:"fas fa-trash-alt"})}),e.jsx("button",{className:"h-8 w-8 flex items-center justify-center text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",children:e.jsx("i",{className:"fas fa-chevron-right"})})]})})})]})},t._id)})})]})};export{je as default};
