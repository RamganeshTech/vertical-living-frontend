import{e as F,l as $,M as W,a as d,j as e,W as q,Z as T}from"./index-ftjmZ4WH.js";import{B as j}from"./Button-BhpUbe89.js";import{I as m}from"./Input-sieJTkC7.js";import{L as u}from"./Label-De7Bg4nO.js";import{C as g,a as y,b as A,c as L,d as _}from"./Card-BB2WhPtT.js";import{c as z}from"./workerApi-1AWmHd2n.js";import{t as x}from"./toast-BSC5QTk1.js";import"./useMutation-CSGCjuCw.js";function K(){const i=F(),[P]=$(),l=P.get("invite"),w=W(),[s,k]=d.useState({email:"",password:"",confirmPassword:"",phoneNo:"",workerName:""}),[f,C]=d.useState(!1),[p,R]=d.useState(!1),[t,v]=d.useState({}),[h,S]=d.useState(null),N=z();d.useEffect(()=>{if(!l){x({title:"Invalid Invitation",description:"No invitation token found. Please use a valid invitation link.",variant:"destructive"}),setTimeout(()=>{i("/")},3e3);return}try{const a=JSON.parse(atob(l));S(a)}catch{x({title:"Invalid Invitation",description:"The invitation link is corrupted or invalid.",variant:"destructive"}),setTimeout(()=>{i("/")},3e3)}},[l,i]);const I=()=>{const a={};return s.workerName.trim()?s.workerName.trim().length<2&&(a.workerName="workerName must be at least 2 characters"):a.workerName="workerName is required",s.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s.email)||(a.email="Please enter a valid email address"):a.email="Email is required",s.phoneNo.trim()?/^\d{10}$/.test(s.phoneNo.trim())||(a.phoneNo="Please enter a valid phone number"):a.phoneNo="Phone number is required",s.password.trim()?s.password.length<6&&(a.password="Password must be at least 6 characters"):a.password="Password is required",s.confirmPassword.trim()?s.password!==s.confirmPassword&&(a.confirmPassword="Passwords do not match"):a.confirmPassword="Please confirm your password",v(a),Object.keys(a).length===0},c=a=>{const{name:n,value:b}=a.target;k(o=>({...o,[n]:b})),t[n]&&v(o=>({...o,[n]:""}))},E=async a=>{var n,b;try{if(a.preventDefault(),!l){x({title:"Error",description:"Invalid invitation token",variant:"destructive"});return}if(!I())return;const o=await N.mutateAsync({invite:l,payload:{email:s.email,password:s.password,phoneNo:s.phoneNo,workerName:s.workerName}}),r=o==null?void 0:o.data;w(q({role:r==null?void 0:r.role,isauthenticated:!0,_id:r==null?void 0:r._id})),w(T({workerId:r==null?void 0:r._id,workerName:r==null?void 0:r.workerName,email:r==null?void 0:r.email,phoneNo:r==null?void 0:r.phoneNo,role:r==null?void 0:r.role,isauthenticated:!0})),x({title:"Success",description:"Registration successful! You can now login with your credentials."}),setTimeout(()=>{i("/organizations")},2e3)}catch(o){x({title:"Registration Failed",description:((b=(n=o==null?void 0:o.response)==null?void 0:n.data)==null?void 0:b.message)||"Failed to register. Please try again.",variant:"destructive"})}};return l?e.jsxs("div",{className:"min-h-full bg-gradient-to-br from-blue-50 via-white to-blue-50 flex items-center justify-center p-4",children:[e.jsx(j,{variant:"primary",onClick:()=>i(-1),className:"!absolute top-[5%] sm:top-[2%] z-10 right-[5%] sm:right-[10%]",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsx("div",{className:"relative w-full max-w-lg",children:e.jsxs(g,{className:"bg-white/80 backdrop-blur-lg border-0 shadow-2xl",children:[e.jsxs(A,{className:"text-center pb-6",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg",children:e.jsx("i",{className:"fas fa-hard-hat text-white text-2xl"})}),e.jsx(L,{className:"text-2xl sm:text-3xl font-bold bg-gradient-to-r from-blue-900 to-blue-800 bg-clip-text text-transparent",children:"Join as Worker"}),e.jsxs(_,{className:"text-blue-700 text-base",children:[(h==null?void 0:h.specifiedRole)&&e.jsxs("span",{className:"inline-block bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium mb-2",children:["Role: ",h.specifiedRole]}),e.jsx("br",{}),"Complete your registration to join the project"]})]}),e.jsxs(y,{className:"space-y-6",children:[e.jsxs("form",{onSubmit:E,className:"space-y-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"workerName",className:"text-blue-800 font-medium",children:"workerName *"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("i",{className:"fas fa-user text-blue-400"})}),e.jsx(m,{id:"workerName",name:"workerName",type:"text",value:s.workerName,onChange:c,placeholder:"Enter your workerName",className:`pl-10 border-2 transition-all duration-200 ${t.workerName?"border-red-300 focus:border-red-500":"border-blue-200 focus:border-blue-500"} bg-white/70 backdrop-blur-sm`,error:t.workerName})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"email",className:"text-blue-800 font-medium",children:"Email Address *"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("i",{className:"fas fa-envelope text-blue-400"})}),e.jsx(m,{id:"email",name:"email",type:"email",value:s.email,onChange:c,placeholder:"Enter your email address",className:`pl-10 border-2 transition-all duration-200 ${t.email?"border-red-300 focus:border-red-500":"border-blue-200 focus:border-blue-500"} bg-white/70 backdrop-blur-sm`,error:t.email})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"phoneNo",className:"text-blue-800 font-medium",children:"Phone Number *"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("i",{className:"fas fa-phone text-blue-400"})}),e.jsx(m,{id:"phoneNo",name:"phoneNo",type:"tel",maxLength:10,value:s.phoneNo,onChange:c,placeholder:"Enter your phone number",className:`pl-10 border-2 transition-all duration-200 ${t.phoneNo?"border-red-300 focus:border-red-500":"border-blue-200 focus:border-blue-500"} bg-white/70 backdrop-blur-sm`,error:t.phoneNo})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"password",className:"text-blue-800 font-medium",children:"Password *"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("i",{className:"fas fa-lock text-blue-400"})}),e.jsx(m,{id:"password",name:"password",type:f?"text":"password",value:s.password,onChange:c,placeholder:"Create a password",className:`pl-10 pr-12 border-2 transition-all duration-200 ${t.password?"border-red-300 focus:border-red-500":"border-blue-200 focus:border-blue-500"} bg-white/70 backdrop-blur-sm`,error:t.password}),e.jsx("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center text-blue-400 hover:text-blue-600 transition-colors",onClick:()=>C(!f),children:e.jsx("i",{className:`fas ${f?"fa-eye-slash":"fa-eye"}`})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"confirmPassword",className:"text-blue-800 font-medium",children:"Confirm Password *"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("i",{className:"fas fa-lock text-blue-400"})}),e.jsx(m,{id:"confirmPassword",name:"confirmPassword",type:p?"text":"password",value:s.confirmPassword,onChange:c,placeholder:"Confirm your password",className:`pl-10 pr-12 border-2 transition-all duration-200 ${t.confirmPassword?"border-red-300 focus:border-red-500":"border-blue-200 focus:border-blue-500"} bg-white/70 backdrop-blur-sm`,error:t.confirmPassword}),e.jsx("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center text-blue-400 hover:text-blue-600 transition-colors",onClick:()=>R(!p),children:e.jsx("i",{className:`fas ${p?"fa-eye-slash":"fa-eye"}`})})]})]}),e.jsxs("div",{className:"bg-blue-50 rounded-xl p-3",children:[e.jsxs("p",{className:"text-xs text-blue-600 mb-1",children:[e.jsx("i",{className:"fas fa-info-circle mr-1"}),"Password Requirements:"]}),e.jsxs("ul",{className:"text-xs text-gray-600 space-y-1",children:[e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:`fas fa-check mr-2 ${s.password.length>=6?"text-green-500":"text-gray-400"}`}),"At least 6 characters long"]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:`fas fa-check mr-2 ${s.password===s.confirmPassword&&s.confirmPassword?"text-green-500":"text-gray-400"}`}),"Passwords match"]})]})]}),e.jsx(j,{type:"submit",className:"w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-semibold py-3 rounded-xl shadow-lg hover:shadow-xl transition-all duration-200 transform hover:scale-[1.02]",isLoading:N.isPending,children:N.isPending?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin mr-2"}),"Registering..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-user-check mr-2"}),"Complete Registration"]})})]}),e.jsx("div",{className:"text-center pt-4 border-t border-blue-100",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Already have an account?"," ",e.jsx("button",{type:"button",className:"text-blue-600 hover:text-blue-700 hover:underline font-medium transition-colors",onClick:()=>i("/workerlogin"),children:"Sign in here"})]})})]})]})})]}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-blue-50 flex items-center justify-center p-4",children:e.jsx(g,{className:"bg-white/80 backdrop-blur-lg border-0 shadow-2xl max-w-md w-full",children:e.jsxs(y,{className:"pt-8 text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-red-500 to-red-600 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg",children:e.jsx("i",{className:"fas fa-exclamation-triangle text-white text-2xl"})}),e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-red-600 mb-2",children:"Invalid Invitation"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Please use a valid invitation link to register. Redirecting you to the home page..."}),e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-600"})})]})})})}export{K as default};
