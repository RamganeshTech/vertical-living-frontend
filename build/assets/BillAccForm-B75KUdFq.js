import{c as z,r as x,j as e}from"./index-ImEMNTCY.js";import{B as v}from"./Button-DA5f_eiE.js";import{u as G}from"./vendorAccApi-O2_ocm8w.js";import{S as M}from"./SearchSelectNew-lRJMa0Wi.js";import{L as T}from"./Label-Cji2EFXP.js";const Y=({mode:f,initialData:l,onSubmit:k,isSubmitting:N,organizationId:B})=>{var A,F;const w=z(),[j,Q]=x.useState(f),{data:p}=G(B),C={vendorId:"",vendorName:"",billNumber:"",accountsPayable:"",subject:"",billDate:new Date().toISOString().split("T")[0],dueDate:new Date(Date.now()+10*24*60*60*1e3).toISOString().split("T")[0],items:[{itemName:"",rate:0,quantity:1,totalCost:0}],discountPercentage:0,taxPercentage:0,notes:""},[h,I]=x.useState(!1),[a,m]=x.useState(C),[i,V]=x.useState({totalAmount:0,discountAmount:0,taxAmount:0,grandTotal:0});x.useEffect(()=>{l&&(m({vendorId:(l==null?void 0:l.vendorId)||"",vendorName:(l==null?void 0:l.vendorName)||"",billNumber:l.billNumber||"",accountsPayable:l.accountsPayable||"",subject:l.subject||"",billDate:l.billDate?new Date(l.billDate).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],dueDate:l.dueDate?new Date(l.dueDate).toISOString().split("T")[0]:new Date(Date.now()+10*24*60*60*1e3).toISOString().split("T")[0],items:l.items||[{itemName:"",rate:0,quantity:1,totalCost:0}],discountPercentage:l.discountPercentage||0,taxPercentage:l.taxPercentage||0,notes:l.notes||""}),f==="view"&&I(!0))},[l]),x.useEffect(()=>{const s=a.items.reduce((d,u)=>d+(u.totalCost||0),0),t=s*a.discountPercentage/100,r=s-t,n=r*a.taxPercentage/100,c=r+n;V({totalAmount:s,discountAmount:t,taxAmount:n,grandTotal:c})},[a.items,a.discountPercentage,a.taxPercentage]);const q=(A=p||[])==null?void 0:A.map(s=>({value:s._id,label:s.vendorName,email:s.email})),b=s=>{const{name:t,value:r}=s.target;m(n=>({...n,[t]:r}))},P=s=>{const{name:t,value:r}=s.target,n=parseFloat(r)||0;m(c=>({...c,[t]:n<0?0:n}))},E=()=>{m(s=>({...s,items:[...s.items,{itemName:"",quantity:1,rate:0,totalCost:0}]}))},O=s=>{m(t=>({...t,items:t.items.filter((r,n)=>n!==s)}))},y=(s,t,r)=>{m(n=>{const c=[...n.items],d={...c[s]};if(t==="itemName"){const u=d.itemName;d.itemName=r;const _=s===n.items.length-1,L=u.trim()==="",$=r.trim()!=="";_&&L&&$&&c.push({itemName:"",quantity:1,rate:0,totalCost:0})}else if(t==="quantity"||t==="rate"){const u=typeof r=="string"?parseFloat(r)||0:r;d[t]=u<0?0:u,d.totalCost=d.quantity*d.rate}return c[s]=d,{...n,items:c}})},R=s=>{const t=[];return s.vendorName.trim()||t.push("Vendor name is required"),s.items.forEach((r,n)=>{r.itemName.trim()||t.push(`Item ${n+1}: Item name is required`),r.rate<=0&&t.push(`Item ${n+1}: Rate must be greater than 0`)}),t},D=s=>{const t=p==null?void 0:p.find(r=>r._id===s);m(r=>({...r,vendorId:s||"",vendorName:(t==null?void 0:t.vendorName)||""}))},U=async s=>{s.preventDefault();const t=a.items.filter(d=>d.itemName.trim()!==""),r={...a,items:t},n=R(r);if(n.length>0){alert(n.join(`
`));return}const c={...r,organizationId:"",totalAmount:i.totalAmount,discountAmount:i.discountAmount,taxAmount:i.taxAmount,grandTotal:i.grandTotal};await k(c),m(C)},o=j==="view",g=j==="create",S=j==="edit";return e.jsxs("div",{className:"max-w-full mx-auto space-y-2",children:[e.jsx("header",{className:"flex justify-between items-center",children:e.jsxs("div",{className:"flex justify-between items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>w(-1),className:"bg-blue-100 hover:bg-slate-300 flex items-center justify-between w-8 h-8 border border-[#a6aab8] text-sm cursor-pointer rounded-md px-2 ",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-receipt mr-3 text-blue-600"}),g?"Create Bill":S?"Update Bill":"View Bill"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:g?"Fill in the details to create a new Bill":S?"Update the Bill details":"Bill details"})]})]})}),e.jsxs("form",{onSubmit:U,className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx("i",{className:"fas fa-file-alt mr-2 text-blue-600"}),"Bill Details"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(T,{children:"Vendor"}),e.jsx(M,{options:q,placeholder:"Select Vendor",searchPlaceholder:"Search Vendor...",value:(a==null?void 0:a.vendorId)||void 0,onValueChange:s=>D(s),searchBy:"name",displayFormat:"simple",className:"w-full"})]}),e.jsxs("div",{className:"",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"checkbox",className:"cursor-pointer",checked:h,id:"enableName",onChange:()=>I(s=>!s)}),e.jsx(T,{htmlFor:"enableName",className:"cursor-pointer",children:"Click the check box to enter the name manually, if not available from the drop down"})]}),e.jsx("input",{type:"text",name:"vendorName",value:h?a==null?void 0:a.vendorName:"",onChange:s=>{h&&b(s)},disabled:o||!h,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",placeholder:"Enter Vendor name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Remarks"}),e.jsx("input",{type:"text",name:"subject",value:a.subject,onChange:b,disabled:o,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",placeholder:"Enter Remarks"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bill Date"}),e.jsx("input",{type:"date",name:"billDate",value:a.billDate,onChange:b,disabled:o,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Due Date"}),e.jsx("input",{type:"date",name:"dueDate",value:a.dueDate,onChange:b,disabled:o,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-list mr-2 text-blue-600"}),"Items ",e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),!o&&e.jsxs(v,{type:"button",onClick:E,variant:"primary",children:[e.jsx("i",{className:"fas fa-plus mr-2"}),"Add Item"]})]}),((F=a==null?void 0:a.items)==null?void 0:F.length)===0&&f==="view"?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("i",{className:"fas fa-inbox text-4xl mb-2"}),e.jsx("p",{children:"No items added yet."})]}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-3 mb-2 px-4 py-3 bg-gray-100 rounded-lg font-semibold text-gray-700 text-sm",children:[e.jsx("div",{className:"col-span-1 text-center",children:"#"}),e.jsxs("div",{className:"col-span-4 text-center",children:["Item Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"col-span-2 text-center",children:"Quantity"}),e.jsxs("div",{className:"col-span-2 text-center",children:["Rate ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"col-span-2 text-center",children:"Total"}),e.jsx("div",{className:"col-span-1 text-center",children:"Action"})]}),e.jsx("div",{className:"space-y-2",children:a.items.map((s,t)=>e.jsxs("div",{className:"grid grid-cols-12 gap-3 px-4 py-3 bg-white border border-gray-200 rounded-lg hover:border-blue-300 transition-colors items-center",children:[e.jsx("div",{className:"col-span-1 text-center text-gray-600 font-medium",children:t+1}),e.jsx("div",{className:"col-span-4",children:e.jsx("input",{type:"text",value:s.itemName,onChange:r=>y(t,"itemName",r.target.value),disabled:o,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed text-sm",placeholder:"Enter item name"})}),e.jsx("div",{className:"col-span-2",children:e.jsx("input",{type:"number",value:s.quantity,onChange:r=>y(t,"quantity",r.target.value),disabled:o,min:"0",step:"1",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed text-sm",placeholder:"0"})}),e.jsx("div",{className:"col-span-2",children:e.jsx("input",{type:"number",value:s.rate,onChange:r=>y(t,"rate",r.target.value),disabled:o,min:"0",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed text-sm",placeholder:"0.00"})}),e.jsxs("div",{className:"col-span-2 text-center font-semibold text-gray-900",children:["₹",s.totalCost.toFixed(2)]}),e.jsx("div",{className:"col-span-1 text-center",children:!o&&e.jsx("button",{type:"button",onClick:()=>O(t),disabled:a.items.length===1,className:"text-red-600 cursor-pointer hover:text-red-800 disabled:text-gray-400 disabled:cursor-not-allowed p-2 rounded-full hover:bg-red-50 transition-colors",title:a.items.length===1?"Cannot delete last item":"Delete item",children:e.jsx("i",{className:"fas fa-trash"})})})]},t))}),e.jsxs("div",{className:"grid grid-cols-12 gap-3 px-4 py-3 bg-blue-50 rounded-lg mt-4 font-semibold text-gray-800",children:[e.jsx("div",{className:"col-span-9 text-right",children:"Subtotal:"}),e.jsxs("div",{className:"col-span-2 text-right text-blue-600 text-lg",children:["₹",i.totalAmount.toFixed(2)]}),e.jsx("div",{className:"col-span-1"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx("i",{className:"fas fa-calculator mr-2 text-blue-600"}),"Discount & Tax"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Discount Percentage (%)"}),e.jsx("input",{type:"number",name:"discountPercentage",value:a.discountPercentage,onChange:P,disabled:o,min:"0",max:"100",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tax Percentage (%)"}),e.jsx("input",{type:"number",name:"taxPercentage",value:a.taxPercentage,onChange:P,disabled:o,min:"0",max:"100",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",placeholder:"0.00"})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl shadow-sm p-6 border border-blue-100",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx("i",{className:"fas fa-receipt mr-2 text-blue-600"}),"Bill Summary"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-blue-200",children:[e.jsx("span",{className:"text-gray-700 font-medium",children:"Subtotal:"}),e.jsxs("span",{className:"text-xl font-semibold text-gray-900",children:["₹",i.totalAmount.toFixed(2)]})]}),a.discountPercentage>0&&e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-blue-200",children:[e.jsxs("span",{className:"text-gray-700 font-medium",children:["Discount (",a.discountPercentage,"%):"]}),e.jsxs("span",{className:"text-xl font-semibold text-green-600",children:["-₹",i.discountAmount.toFixed(2)]})]}),a.taxPercentage>0&&e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-blue-200",children:[e.jsxs("span",{className:"text-gray-700 font-medium",children:["Tax (",a.taxPercentage,"%):"]}),e.jsxs("span",{className:"text-xl font-semibold text-gray-900",children:["₹",i.taxAmount.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center py-3 bg-blue-100 px-4 rounded-lg",children:[e.jsx("span",{className:"text-lg font-bold text-gray-900",children:"Grand Total:"}),e.jsxs("span",{className:"text-2xl font-bold text-blue-600",children:["₹",i.grandTotal.toFixed(2)]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx("i",{className:"fas fa-comment-alt mr-2 text-blue-600"}),"Additional Information"]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("textarea",{name:"notes",value:a.notes,onChange:b,disabled:o,rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed resize-none",placeholder:"Add any notes for the Vendor..."})]})})]}),!o&&e.jsxs("div",{className:"flex justify-end gap-4 pt-6",children:[e.jsxs(v,{type:"button",onClick:()=>w(-1),className:"bg-gray-500 text-white px-6 py-2",disabled:N,children:[e.jsx("i",{className:"fas fa-times mr-2"}),"Cancel"]}),e.jsx(v,{type:"submit",className:"bg-blue-600 text-white px-6 py-2",disabled:N,children:N?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin mr-2"}),g?"Creating...":"Updating..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:`fas ${g?"fa-plus":"fa-save"} mr-2`}),g?"Create Bill":"Update Bill"]})})]})]})]})};export{Y as B};
