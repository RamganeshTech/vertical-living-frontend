import{d as W,j as e,B as R,b as H,c as q,r as v,aa as J,ab as K,O as Q,M as X,t as L}from"./index-DyM6T-eT.js";import{C as Y,a as Z}from"./Card-CnQJFMCV.js";import{d as ee}from"./dateFormator-BGKi5rfZ.js";import{u as se}from"./projectApi-CMY3yoCw.js";import{S as te}from"./index-xda8XS2f.js";import{u as h}from"./useDebounce-DXaYFH0W.js";import{S as ae}from"./StageGuide-DzUcb6ZB.js";import"./index-CkRxYNyB.js";const re=({procurementNumber:f,shopDetails:r,totalCost:t,itemCount:l,projectName:x,fromDeptName:i,createdAt:g,isConfirmedRate:o,isSyncWithPaymentsSection:d,onView:w,onDelete:p,deletePending:j})=>{var b;const{role:N,permission:m}=W(),y=N==="owner"||((b=m==null?void 0:m.procurement)==null?void 0:b.delete),P=d||o?"border-green-500 bg-green-50/10":"border-blue-500 bg-white";return e.jsx(Y,{onClick:w,className:`w-full cursor-pointer group hover:shadow-md transition-all duration-200 border-l-[5px] ${P} shadow-sm overflow-hidden bg-white`,children:e.jsxs(Z,{className:"p-0",children:[e.jsxs("div",{className:"p-3 flex justify-between items-start border-b border-gray-50 pb-2",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] uppercase font-bold text-gray-400 tracking-wider",children:"Procurement No"}),e.jsx("h3",{className:"text-lg font-bold text-gray-800 font-mono tracking-tight leading-none group-hover:text-blue-600 transition-colors",children:f||"N/A"})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1.5",children:[typeof d=="boolean"&&d===!0&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded text-[9px] font-bold bg-purple-100 text-purple-700 uppercase tracking-wide border border-purple-200",children:[e.jsx("i",{className:"fas fa-file-invoice-dollar text-[8px]"})," In Payment"]}),typeof d=="boolean"&&d===!1&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded text-[9px] font-bold bg-gray-100 text-gray-500 uppercase tracking-wide border border-gray-200",children:[e.jsx("i",{className:"fas fa-hourglass-start text-[8px]"})," Pre-Payment"]}),o?e.jsxs("span",{className:"inline-flex items-center gap-1 text-[10px] font-bold text-green-600",children:[e.jsx("i",{className:"fas fa-check-circle"})," Rates Added"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 text-[10px] font-bold text-orange-500",children:[e.jsx("i",{className:"fas fa-exclamation-circle"})," Rates Pending"]})]})]}),e.jsxs("div",{className:"px-3 py-2 space-y-1.5 grid grid-cols-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-700",children:[e.jsx("div",{className:"w-4 flex justify-center",children:e.jsx("i",{className:"fas fa-folder text-gray-400 text-[10px]"})}),e.jsx("span",{className:"font-semibold truncate w-full",title:x,children:x||"Unknown Project"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx("div",{className:"w-4 flex justify-center",children:e.jsx("i",{className:"fas fa-share-alt text-gray-400 text-[10px]"})}),e.jsxs("span",{className:"truncate",children:["From ",e.jsx("span",{className:"font-medium",children:i})]})]}),(r==null?void 0:r.contactPerson)&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx("div",{className:"w-4 flex justify-center",children:e.jsx("i",{className:"fas fa-user-tie text-blue-400 text-[10px]"})}),e.jsx("span",{className:"font-medium truncate text-blue-700",children:(r==null?void 0:r.contactPerson)||"Vendor Unassigned"})]}),(r==null?void 0:r.shopName)&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx("div",{className:"w-4 flex justify-center",children:e.jsx("i",{className:"fas fa-shop text-blue-400 text-[10px]"})}),e.jsx("span",{className:"font-medium truncate text-blue-700",children:(r==null?void 0:r.shopName)||"Vendor Unassigned"})]}),g&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx("div",{className:"w-4 flex justify-center",children:e.jsx("i",{className:"fas fa-calendar  text-gray-400 text-[10px]"})}),e.jsx("span",{className:"font-medium truncate text-gray-700",children:ee(g)})]})]}),e.jsxs("div",{className:"mt-1 bg-gray-50 px-3 py-2 border-t border-gray-100 flex items-center justify-between",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex flex-col leading-none",children:[e.jsx("span",{className:"text-[9px] font-bold text-gray-400 uppercase",children:"Items"}),e.jsx("span",{className:"text-xs font-bold text-gray-700",children:l})]}),e.jsxs("div",{className:"flex flex-col leading-none border-l border-gray-200 pl-4",children:[e.jsx("span",{className:"text-[9px] font-bold text-gray-400 uppercase",children:"Total"}),e.jsx("span",{className:"text-xs font-bold text-blue-700",children:t>0?`â‚¹ ${t.toLocaleString()}`:"-"})]})]}),y&&e.jsx(R,{size:"sm",variant:"ghost",isLoading:j,onClick:u=>{u.stopPropagation(),p(u)},className:"h-7 w-7 p-0 rounded-full hover:bg-red-100 text-gray-400 hover:text-red-600 transition-colors",children:e.jsx("i",{className:"fas fa-trash-alt text-xs"})})]})]})})},fe=()=>{var F,M,_,D;const{organizationId:f}=H(),r=q(),[t,l]=v.useState({projectId:"",projectName:"",search:"",isSyncWithPaymentsSection:null,isConfirmedRate:!1,fromDate:"",toDate:"",minAmount:0,maxAmount:1e5}),{data:x}=se(f),i=x==null?void 0:x.map(s=>({_id:s._id,projectName:s.projectName})),{role:g,permission:o}=W(),d=g==="owner"||((F=o==null?void 0:o.procurement)==null?void 0:F.create),w=g==="owner"||((M=o==null?void 0:o.procurement)==null?void 0:M.list),p=h(t.search,800),j=h(t.minAmount,800),N=h(t.maxAmount,800),m=h(t.fromDate,800),y=h(t.toDate,800),P=v.useMemo(()=>({projectId:t.projectId,isSyncWithPaymentsSection:t.isSyncWithPaymentsSection,isConfirmedRate:t.isConfirmedRate,search:p,minAmount:j,maxAmount:N,fromDate:m,toDate:y}),[t.projectId,t.isSyncWithPaymentsSection,t.isConfirmedRate,p,j,N,m,y]),b=v.useRef(null),{data:u,error:C,refetch:E,fetchNextPage:I,hasNextPage:S,isFetchingNextPage:k,isLoading:T,isError:O}=J(f,P),A=(u==null?void 0:u.pages.flatMap(s=>s.items))||[],{mutateAsync:$,isPending:U,variables:G}=K(),V=async({id:s})=>{var a,n;try{await $({id:s}),L({title:"Success",description:"Deleted Successfully"})}catch(c){L({variant:"destructive",title:"Error",description:((n=(a=c==null?void 0:c.response)==null?void 0:a.data)==null?void 0:n.message)||(c==null?void 0:c.message)||"Failed to delete"})}};v.useEffect(()=>{const s=b.current;if(!s)return;const a=()=>{const{scrollTop:n,scrollHeight:c,clientHeight:B}=s;c-n-B<100&&S&&!k&&(console.log("ðŸ“œ Loading more accounting records..."),I())};return s.addEventListener("scroll",a),()=>s.removeEventListener("scroll",a)},[S,k,I]);const z=()=>{l({projectId:"",projectName:"",search:"",isSyncWithPaymentsSection:null,isConfirmedRate:!1,minAmount:0,maxAmount:1e6,fromDate:"",toDate:""})};return location.pathname.includes("sub")||location.pathname.includes("create")?e.jsx(Q,{}):e.jsxs("div",{className:"p-2 space-y-6 max-w-full h-full ",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-box-open mr-3 text-blue-600"}),"Procurement Department"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage the Projects Material Items"})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[d&&e.jsxs(R,{onClick:()=>r("create"),children:[e.jsx("i",{className:"fas fa-plus mr-2"}),"Create"]}),e.jsx("div",{className:"w-full sm:w-auto flex justify-end sm:block",children:e.jsx(ae,{organizationId:f,stageName:"procurement"})})]})]}),T?e.jsx(X,{}):O?e.jsxs("div",{className:"max-w-xl sm:min-w-[80%]  mx-auto mt-4 p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2 text-xl sm:text-3xl",children:"âš ï¸ Error Occurred"}),e.jsx("p",{className:"text-red-500  mb-4 text-lg sm:text-xl",children:((D=(_=C==null?void 0:C.response)==null?void 0:_.data)==null?void 0:D.message)||"Failed to load data"}),e.jsx(R,{onClick:()=>E(),className:"bg-red-600 text-white px-4 py-2",children:"Retry"})]}):e.jsxs("main",{className:"flex gap-2 h-[88%] ",children:[e.jsx("div",{className:"xl:w-80 flex-shrink-0 max-h-full overflow-y-auto",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-filter mr-2 text-blue-600"}),"Filters"]}),e.jsx("button",{onClick:z,className:"text-sm text-blue-600 cursor-pointer hover:text-blue-800 font-medium",children:"Clear All"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Search"}),e.jsx("input",{type:"text",placeholder:"No, Shop Name, Site...",value:t.search,onChange:s=>l(a=>({...a,search:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Project"}),e.jsxs("select",{value:t.projectId||"",onChange:s=>{const a=i==null?void 0:i.find(n=>n._id===s.target.value);l(n=>({...n,projectId:s.target.value,projectName:(a==null?void 0:a.projectName)||""}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white",children:[e.jsx("option",{value:"",children:"All Projects"}),i==null?void 0:i.map(s=>e.jsx("option",{value:s._id,children:s.projectName},s._id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date Range"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs text-gray-500 mb-1",children:"From"}),e.jsx("input",{type:"date",value:t.fromDate,onChange:s=>l(a=>({...a,fromDate:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs text-gray-500 mb-1",children:"To"}),e.jsx("input",{type:"date",value:t.toDate,onChange:s=>l(a=>({...a,toDate:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Payment Status"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("label",{className:`cursor-pointer flex items-center justify-center px-3 py-2 border rounded-lg transition-all duration-200 ${t.isSyncWithPaymentsSection===!1?"bg-blue-50 border-blue-300 text-blue-700 ring-1 ring-blue-200 shadow-sm":"bg-white border-gray-200 text-gray-600 hover:bg-gray-50"}`,children:[e.jsx("input",{type:"radio",name:"payment_status",className:"w-3 h-3 text-blue-600 focus:ring-blue-500 border-gray-300",checked:t.isSyncWithPaymentsSection===!1,onChange:()=>l(s=>({...s,isSyncWithPaymentsSection:!1}))}),e.jsx("span",{className:"ml-2 text-xs font-semibold",children:"Pending"})]}),e.jsxs("label",{className:`cursor-pointer flex items-center justify-center px-3 py-2 border rounded-lg transition-all duration-200 ${t.isSyncWithPaymentsSection===!0?"bg-blue-50 border-blue-300 text-blue-700 ring-1 ring-blue-200 shadow-sm":"bg-white border-gray-200 text-gray-600 hover:bg-gray-50"}`,children:[e.jsx("input",{type:"radio",name:"payment_status",className:"w-3 h-3 text-blue-600 focus:ring-blue-500 border-gray-300",checked:t.isSyncWithPaymentsSection===!0,onChange:()=>l(s=>({...s,isSyncWithPaymentsSection:!0}))}),e.jsx("span",{className:"ml-2 text-xs font-semibold",children:"Sent"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Total Cost Range"}),e.jsx("div",{className:"px-2 mb-3 pt-2",children:e.jsx(te,{range:!0,min:0,max:1e5,step:500,value:[Number(t.minAmount),Number(t.maxAmount)],onChange:s=>{const[a,n]=s;l(c=>({...c,minAmount:a,maxAmount:n}))},trackStyle:[{backgroundColor:"#3b82f6",height:6}],handleStyle:[{borderColor:"#3b82f6",backgroundColor:"#fff",width:18,height:18,marginTop:-6,opacity:1},{borderColor:"#3b82f6",backgroundColor:"#fff",width:18,height:18,marginTop:-6,opacity:1}],railStyle:{backgroundColor:"#e5e7eb",height:6}})}),e.jsxs("div",{className:"flex justify-between items-center gap-2 text-sm",children:[e.jsxs("div",{className:"bg-blue-50 px-2 py-1 rounded text-blue-700 text-xs font-bold",children:["â‚¹",t.minAmount]}),e.jsxs("div",{className:"bg-blue-50 px-2 py-1 rounded text-blue-700 text-xs font-bold",children:["â‚¹",t.maxAmount]})]}),e.jsxs("div",{className:"flex gap-2 items-center mt-3",children:[e.jsx("input",{type:"number",value:t.minAmount,onChange:s=>l(a=>({...a,minAmount:+s.target.value})),placeholder:"Min",className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500",min:"0"}),e.jsx("input",{type:"number",value:t.maxAmount,onChange:s=>l(a=>({...a,maxAmount:+s.target.value})),placeholder:"Max",className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500",min:"0"})]})]})]})]})}),w&&e.jsx(e.Fragment,{children:A.length===0?e.jsxs("div",{className:"flex flex-col items-center  justify-center min-h-[300px] w-full bg-white rounded-xl text-center p-6",children:[e.jsx("i",{className:"fas fa-box-open text-5xl text-blue-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-1",children:"No Procurements Found"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Looks like there are no Procurements yet for this project.",e.jsx("br",{}),"Once you have ",e.jsx("strong",{children:" generated the Pdf "}),"  items will be listed here  to get started ðŸš€"]})]}):e.jsxs("div",{ref:b,className:"flex-1 max-h-[100%]  overflow-y-auto",children:[e.jsx("div",{className:"grid gap-6 grid-cols-1 sm:grid-cols-2 xl:grid-cols-2 ",children:A.map(s=>{var a,n;return e.jsx(re,{procurementNumber:(s==null?void 0:s.procurementNumber)||(s==null?void 0:s.refPdfId),fromDeptName:s==null?void 0:s.fromDeptName,fromDeptNumber:s==null?void 0:s.fromDeptNumber,isConfirmedRate:s==null?void 0:s.isConfirmedRate,isSyncWithPaymentsSection:s==null?void 0:s.isSyncWithPaymentsSection,projectName:(a=s==null?void 0:s.projectId)==null?void 0:a.projectName,shopDetails:s==null?void 0:s.shopDetails,itemCount:((n=s==null?void 0:s.selectedUnits)==null?void 0:n.length)||0,totalCost:(s==null?void 0:s.totalCost)||0,createdAt:s==null?void 0:s.createdAt,onView:()=>r(`sub/${s._id}`),onDelete:()=>V({id:s._id}),deletePending:U&&G.id===s._id},s._id)})}),k?e.jsxs("div",{className:"flex flex-col items-center gap-2 text-blue-600",children:[e.jsx("i",{className:"fas fa-spinner fa-spin text-2xl"}),e.jsx("span",{className:"text-sm font-medium",children:"Loading more items..."})]}):S?e.jsx("div",{className:"h-4 w-full"}):A.length>0&&e.jsx("div",{className:"flex mt-4 justify-center py-6 bg-gray-50 border-t border-gray-100",children:e.jsxs("p",{className:"text-gray-400 text-sm font-medium flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle mr-2"}),"All records loaded"]})})]})})]})]})};export{fe as default};
