import{a as I,u as $,r as o,b as F,j as e}from"./index-Dkf7SbMA.js";import{t as c}from"./toast-BSC5QTk1.js";import{B as f}from"./Button-ClgICMLF.js";import{I as A}from"./Input-BRDEoxOp.js";import{c as B,d as P}from"./subContractNewApi-CzH8jLWx.js";import{S as T}from"./SubContractForm-DCtJUsXe.js";import{L as V}from"./Label-DXAdVnik.js";import{S as z,a as R,b as U,c as G,d as M}from"./Select-CPbUX6hy.js";import"./useQuery-h0LZ4b8f.js";import"./useMutation-DtRxugN4.js";import"./useInfiniteQuery-BUWQcrvt.js";import"./roleCheck-CXq1v0D5.js";import"./Card-BI-_ii1r.js";import"./projectApi-DzFbt4lZ.js";import"./SearchSelectNew-DPrs09Io.js";import"./ImageGalleryMain-DWzO9-7s.js";import"./constants-4IFJeChr.js";import"./downloadFile-C340hrAB.js";import"./index-CwzFm0RL.js";const ie=()=>{var x;const h=I(),{organizationId:b,subContractId:d}=$(),{data:t,isLoading:j,isError:v,refetch:m}=B({subContractId:d}),[C,u]=o.useState(!1),[i,S]=o.useState(""),[r,y]=o.useState((t==null?void 0:t.status)||"pending"),{role:w,permission:n}=F(),N=w==="owner"||((x=n==null?void 0:n.subcontract)==null?void 0:x.list);o.useEffect(()=>{if(t){const s=`https://houseofram.in/subcontract/share/${t._id}?token=${t.token}`;S(s),t!=null&&t.status&&y(t.status)}},[t]);const k=()=>{navigator.clipboard.writeText(i),u(!0),c({title:"Copied!",description:"Link copied to clipboard"}),setTimeout(()=>u(!1),2e3)},{mutateAsync:L}=P(),l={pending:{triggerClass:"bg-yellow-50 border-yellow-300 text-yellow-700",valueClass:"text-yellow-700 font-medium",itemClass:"text-yellow-700 hover:bg-yellow-50 hover:text-yellow-800 font-medium",dotColor:"bg-yellow-500",label:"Pending"},accepted:{triggerClass:"!bg-green-50 border-green-300 text-green-700",valueClass:"text-green-700 font-medium",itemClass:"text-green-700 hover:bg-green-50 hover:text-green-800 font-medium",dotColor:"bg-green-500",label:"Accepted"},rejected:{triggerClass:"!bg-red-50 border-red-300 text-red-700",valueClass:"text-red-700 font-medium",itemClass:"text-red-700 hover:bg-red-50 hover:text-red-800 font-medium",dotColor:"bg-red-500",label:"Rejected"}},E=async s=>{var g,p;try{await L({subContractId:d,status:s}),m(),c({title:"Success",description:"status successfully"})}catch(a){c({title:"Error",description:((p=(g=a==null?void 0:a.response)==null?void 0:g.data)==null?void 0:p.message)||(a==null?void 0:a.message)||"Failed to upload files",variant:"destructive"})}};if(j)return e.jsx("div",{children:"Loading subcontract details..."});if(v||!t)return e.jsx("div",{children:"Error loading data. Please try again."});if(N)return e.jsxs("div",{className:"space-y-6 max-h-full overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between gap-2 items-center",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(f,{variant:"outline",size:"icon",onClick:()=>h(-1),children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Sub Contract Details"})]}),e.jsxs(z,{value:r,onValueChange:s=>{E(s)},children:[e.jsx(R,{className:`w-full ${l[r].triggerClass}`,children:e.jsx(U,{placeholder:"Select Status",selectedValue:r.toString(),className:l[r].valueClass})}),e.jsx(G,{children:["pending","accepted","rejected"].map(s=>e.jsx(M,{value:s,className:l[s].itemClass,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${l[s].dotColor}`}),l[s].label]})},s))})]})]}),e.jsxs("div",{className:"max-w-full mx-auto space-y-8",children:[e.jsx(T,{organizationId:b,mode:"view",initialData:t,refetch:m}),i&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(V,{children:"Form Link"}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-2",children:[e.jsx(A,{value:i,readOnly:!0,className:"bg-blue-50 text-blue-800 flex-1"}),e.jsx(f,{onClick:k,className:"w-full sm:w-auto",children:e.jsx("i",{className:`fas ${C?"fa-check":"fa-copy"}`})})]})]})]})]})};export{ie as default};
