import{a as T,d as V,u as $,r as p,k as q,j as e,O as J,B as S,t as F}from"./index-BAM0eJUz.js";import{u as g}from"./useDebounce-DSMcRuVp.js";import{u as K,a as Q}from"./cutlistApi-DKkfWc2n.js";import{u as U}from"./projectApi-D7-uwdh2.js";import{d as W}from"./dateFormator-BGKi5rfZ.js";import"./useInfiniteQuery-BGz0VllC.js";const ae=()=>{var k;const j=T(),f=V(),{organizationId:N}=$(),b=p.useRef(null),{role:P,permission:o}=q(),_=P==="owner"||((k=o==null?void 0:o.cutlist)==null?void 0:k.create),A=f.pathname.includes("/cutlistsingle")||f.pathname.includes("/create"),{data:d}=U(N),c=d==null?void 0:d.map(t=>({_id:t._id,projectName:t.projectName})),[r,i]=p.useState({search:"",projectId:"",projectName:"",startDate:"",endDate:""}),E=g(r.search,700),L=g(r.startDate,800),R=g(r.endDate,800),{data:x,fetchNextPage:v,hasNextPage:y,isFetchingNextPage:m,isLoading:M,isError:z,error:u,refetch:C}=K({organizationId:N||"",projectId:r.projectId||void 0,limit:10,startDate:L,endDate:R,search:E}),h=Q();p.useEffect(()=>{const t=b.current;if(!t)return;const s=()=>{const{scrollTop:a,scrollHeight:l,clientHeight:n}=t;l-a-n<100&&y&&!m&&v()};return t.addEventListener("scroll",s),()=>t.removeEventListener("scroll",s)},[y,m,v]);const O=async t=>{var s,a;try{await h.mutateAsync(t),F({title:"Success",description:"Cutlist removed successfully"}),C()}catch(l){F({title:"Error",description:((a=(s=l==null?void 0:l.response)==null?void 0:s.data)==null?void 0:a.message)||(l==null?void 0:l.message)||"Failed to delete cutlist",variant:"destructive"})}},B=t=>{j(`cutlistsingle/${t}`)},G=()=>{i({search:"",projectId:"",projectName:"",startDate:"",endDate:""})},w=(x==null?void 0:x.pages.flatMap(t=>t.data))||[],D=Object.values(r).filter(t=>t!=="").length;return A?e.jsx(J,{}):e.jsxs("div",{className:"space-y-4 h-full p-2",children:[e.jsxs("header",{className:"flex justify-between items-center",children:[e.jsx("div",{children:e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-th-list mr-3 text-blue-600"}),"Cutlist Management"]})}),e.jsx("div",{className:"flex gap-2",children:_&&e.jsxs(S,{onClick:()=>j("create"),children:[e.jsx("i",{className:"fas fa-plus mr-2"}),"Create New Cutlist"]})})]}),M?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("i",{className:"fas fa-spinner fa-spin text-blue-600 text-4xl"})}):z?e.jsxs("div",{className:"mx-auto mt-4 p-4 bg-red-50 border border-red-200 rounded-lg text-center",children:[e.jsx("p",{className:"text-red-500 text-lg",children:(u==null?void 0:u.message)||"Failed to load cutlists"}),e.jsx(S,{onClick:()=>C(),className:"mt-4",children:"Retry"})]}):e.jsxs("main",{className:"flex gap-4 h-[calc(100vh-90px)]",children:[e.jsxs("aside",{className:"w-80 flex-shrink-0 bg-white rounded-xl shadow-sm p-6 border border-gray-100 overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center",children:[e.jsx("i",{className:"fas fa-filter mr-2 text-blue-600"})," Filters"]}),D>0&&e.jsxs("button",{onClick:G,className:"text-sm text-blue-600 hover:text-blue-800",children:["Clear All (",D,")"]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Search Cutlists"}),e.jsx("input",{type:"text",placeholder:"Cutlist #, Client Name...",value:r.search,onChange:t=>i(s=>({...s,search:t.target.value})),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Project"}),e.jsxs("select",{value:(r==null?void 0:r.projectId)||"",onChange:t=>{const s=c==null?void 0:c.find(a=>a._id===t.target.value);i(s?a=>({...a,projectId:s._id,projectName:s.projectName}):a=>({...a,projectId:"",projectName:""}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white",children:[e.jsx("option",{value:"",children:"All Projects"}),c==null?void 0:c.map(t=>e.jsx("option",{value:t._id,children:t.projectName},t._id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date Range"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500 mb-1 block",children:"From"}),e.jsx("input",{type:"date",value:r.startDate,onChange:t=>i(s=>({...s,startDate:t.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500 mb-1 block",children:"To"}),e.jsx("input",{type:"date",value:r.endDate,onChange:t=>i(s=>({...s,endDate:t.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm"})]})]})]})]})]}),e.jsx("section",{className:"flex-1 flex flex-col min-w-0",children:w.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full bg-white rounded-xl border border-dashed border-gray-300",children:[e.jsx("i",{className:"fas fa-clipboard-list text-5xl text-gray-300 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-500",children:"No Cutlists Found"})]}):e.jsxs("div",{ref:b,className:"overflow-y-auto rounded-xl border border-gray-200 bg-white",children:[e.jsxs("div",{className:"sticky top-0 z-20 bg-blue-50 grid grid-cols-11 gap-4 px-6 py-4 font-semibold text-gray-700 text-sm border-b border-gray-200",children:[e.jsx("div",{className:"col-span-1 text-center",children:"S.No"}),e.jsx("div",{className:"col-span-2 text-center",children:"Cutlist No"}),e.jsx("div",{className:"col-span-2 text-center",children:"Date"})," ",e.jsx("div",{className:"col-span-2 text-center",children:"Project"})," ",e.jsx("div",{className:"col-span-2 text-center",children:"Client Name"}),e.jsx("div",{className:"col-span-2 text-center",children:"Actions"})]}),e.jsx("div",{className:"divide-y divide-gray-100",children:w.map((t,s)=>{var a,l,n,I;return e.jsxs("div",{onClick:()=>B(t._id.toString()),className:"grid grid-cols-11 gap-4 px-6 py-4 items-center hover:bg-blue-50/50 cursor-pointer transition-colors text-sm",children:[e.jsx("div",{className:"col-span-1 text-gray-500 text-center",children:s+1}),e.jsx("div",{className:"col-span-2 font-medium text-blue-600 text-center",children:t.cutlistNo}),e.jsx("div",{className:"col-span-2 text-gray-600 text-center",children:t.createdAt?W(t.createdAt):"—"}),e.jsx("div",{className:"col-span-2 text-gray-600 truncate  text-center",title:(a=t.projectId)==null?void 0:a.projectName,children:((l=t.projectId)==null?void 0:l.projectName)||"—"}),e.jsx("div",{className:"col-span-2 font-medium text-gray-800 text-center",children:t.clientName||"—"}),e.jsx("div",{className:"col-span-2 flex justify-center gap-4",children:!t.isLocked&&e.jsx("button",{onClick:H=>{H.stopPropagation(),O(t._id.toString())},className:"text-red-500 cursor-pointer text-center hover:text-red-700 p-1 rounded-md hover:bg-red-50 transition-all",children:h.isPending&&h.variables===((n=t._id)==null?void 0:n.toString())?e.jsx("i",{className:"fas fa-spinner animate-spin"}):e.jsx("i",{className:"fas fa-trash-alt"})})})]},(I=t._id)==null?void 0:I.toString())})}),m&&e.jsxs("div",{className:"p-4 text-center text-blue-600",children:[e.jsx("i",{className:"fas fa-spinner fa-spin mr-2"})," Loading more..."]})]})})]})]})};export{ae as default};
