import{u as $,b as H,a as V,r as J,j as e,M as Q,B as y,I as T,t as f}from"./index-CUvv9ev0.js";import{u as U,a as X,b as Y,c as Z}from"./materialLabourRateConfigApi-D_07w6qj.js";function se({categoryId:x}){var w,N,k,R;const{organizationId:m,id:S}=$(),M=H();console.log("categoryId",x);const{data:A}=U(m),{data:u,isLoading:I,refetch:F}=X(m,x),{mutateAsync:O,isPending:P}=Y(),{mutateAsync:W,isPending:z}=Z(),{role:b,permission:o}=V(),j=b==="owner"||((w=o==null?void 0:o.materialwithlabourratequote)==null?void 0:w.create),q=b==="owner"||((N=o==null?void 0:o.materialwithlabourratequote)==null?void 0:N.delete),v=b==="owner"||((k=o==null?void 0:o.materialwithlabourratequote)==null?void 0:k.edit),[c,g]=J.useState([{data:{}}]);if(I)return e.jsx(Q,{});const n=(R=A||[])==null?void 0:R.find(t=>t._id===x);if(!n)return e.jsx("p",{children:"Category not found"});const B=(t,r,s)=>{var C,L;const a=[...c];a[t].data[r]=s;const i=(L=(C=n.fields)==null?void 0:C[0])==null?void 0:L.key,h=t===a.length-1,l=r===i,d=(s==null?void 0:s.toString().trim())!=="",K=a.length>0&&Object.values(a[a.length-1].data).every(p=>p===void 0||p==="");if(h&&l&&d&&!K&&a.push({data:{}}),!d&&l&&c.length>1){const p=a[a.length-1];Object.values(p.data).every(E=>E===void 0||E==="")&&a.pop()}g(a)},D=()=>g([...c,{data:{}}]),_=t=>{const r=[...c];r.splice(t,1),g(r)},G=async()=>{var t,r,s,a;try{const i=(r=(t=n.fields)==null?void 0:t[0])==null?void 0:r.key,h=c.map(l=>l.data).filter(l=>{const d=l[i];return d!=null&&d.toString().trim()!==""});if(h.length===0)return f({title:"Error",description:"Nothing to save",variant:"destructive"});await O({categoryId:S,items:h,organizationId:m}),f({title:"Success",description:"field created successfully"}),g([{data:{}}]),F()}catch(i){f({title:"Error",description:((a=(s=i==null?void 0:i.response)==null?void 0:s.data)==null?void 0:a.message)??"Operation failed"})}};return e.jsxs("div",{className:"space-y-4  ",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-end sm:items-center sticky top-0 bg-white z-10",children:[!x&&e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("button",{onClick:()=>M(-1),className:"bg-slate-50 hover:bg-slate-300 flex items-center justify-between w-8 h-8 border border-[#a6aab8] text-sm cursor-pointer rounded-md px-2 ",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:n.name}),e.jsx("span",{className:"block  text-gray-500",children:"* Enter the rupees per head (Every field will be added for single labour cost)"})]})]}),e.jsxs("div",{className:"flex gap-2 mt-3 sm:mt-0  absolute top-[-73px] right-[43px]  ",children:[(v||j)&&e.jsx(y,{onClick:D,variant:"primary",className:"",children:"+ Add Row"}),(v||j)&&e.jsxs(y,{onClick:G,isLoading:P,className:"bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx("i",{className:"fas fa-file mr-2"})," Save Items"]})]})]}),e.jsx("div",{className:"overflow-x-auto ",children:e.jsxs("table",{className:"min-w-full bg-white text-sm",children:[e.jsx("thead",{className:"bg-blue-50 text-sm font-semibold text-gray-600 px-6 py-1 sm:py-3",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-6 py-1 sm:py-3  text-xs font-medium text-gray-500 uppercase tracking-wider",children:"S.NO"}),n.fields.map(t=>e.jsx("th",{className:"text-center px-6 py-1 sm:py-3  text-xs font-medium text-gray-500 uppercase tracking-wider",children:t.key},t.key)),e.jsx("th",{className:"text-center px-6 py-1 sm:py-3  text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsxs("tbody",{children:[u==null?void 0:u.map((t,r)=>{var s;return e.jsxs("tr",{className:`group relative border-none !border-b-1 px-4 py-2  cursor-pointer transition-all duration-200
     hover:bg-gray-50 hover:border-gray-300
  `,children:[e.jsx("td",{className:"border border-gray-100 font-medium text-center p-4  text-sm text-gray-700 group-hover:text-gray-900 transition-colors duration-200",children:r+1||"—"}),(s=n==null?void 0:n.fields)==null?void 0:s.map(a=>e.jsx("td",{className:"border border-gray-100 font-medium text-center  text-sm text-gray-700 group-hover:text-gray-900 transition-colors duration-200",children:(t==null?void 0:t.data[a==null?void 0:a.key])??"—"},a==null?void 0:a.key)),q&&e.jsx("td",{className:"text-center p-4 border border-gray-100",children:e.jsxs(y,{size:"sm",variant:"danger",isLoading:z,className:"group text-white bg-red-600",onClick:()=>W({itemId:t==null?void 0:t._id,organizationId:m}),children:[e.jsx("i",{className:"fas fa-trash mr-2"}),e.jsx("span",{className:"",children:"Delete"})]})})]},`existing-${t==null?void 0:t._id}`)}),c.map((t,r)=>e.jsxs("tr",{className:`group relative border-none !border-b-1 px-4 py-2  cursor-pointer transition-all duration-200\r
                                hover:bg-gray-50 hover:border-gray-300`,children:[e.jsx("td",{className:`border border-gray-100 px-4 font-medium text-center  \r
                                    text-sm text-gray-700 group-hover:text-gray-900 \r
                                    transition-colors duration-200`,children:u.length+r+1}),n.fields.map(s=>e.jsx("td",{className:"border border-gray-100 px-4 font-medium text-center  text-sm text-gray-700 group-hover:text-gray-900 transition-colors duration-200",children:e.jsx(T,{type:s.type==="number"?"number":"text",placeholder:s.key,className:"w-full rounded-md ",value:t.data[s.key]||"",onChange:a=>B(r,s.key,s.type==="number"?Number(a.target.value):a.target.value)})},s.key)),e.jsx("td",{className:"text-center p-4 border border-gray-100",children:e.jsxs(y,{size:"sm",variant:"ghost",className:"group text-white bg-red-600 hover:bg-red-600",onClick:()=>_(r),children:[e.jsx("i",{className:"fas fa-xmark mr-2"})," Remove"]})})]},`new-${r}`))]})]})})]})}export{se as default};
