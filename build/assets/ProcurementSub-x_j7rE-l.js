import{a as de,b as me,c as xe,r as f,j as e}from"./index-By5P0A7l.js";import{C as X,a as Z}from"./Card-CFqBlVQz.js";import{I as p}from"./Input-DKpmFZl7.js";import{B as d}from"./Button-DLUK8O0t.js";import{d as pe,e as he,f as ue,g as fe,h as ge,i as Ne,j as je,k as be}from"./procurementApi-DZ_kvy0s.js";import ye from"./MaterialOverviewLoading-9Ck4pGPe.js";import{t as c}from"./toast-BSC5QTk1.js";import{d as ve}from"./downloadFile-DR20oZne.js";import{I as we}from"./InfoToolTip-D1i2VzLk.js";import{d as Pe}from"./dateFormator-BGKi5rfZ.js";import{B as Se}from"./Badge-BHW6q2S6.js";import{T as ke}from"./TextArea-Bw4XrQML.js";import"./useQuery-Cc7pLKfK.js";import"./useMutation-7YLqc7VE.js";import"./useInfiniteQuery-DQF0m-E9.js";import"./roleCheck-YGaMnK_P.js";import"./Skeleton-FCBR4RgB.js";const Ye=()=>{var W,q,M,_,B,O,Q,Y,H,V,F,J,K;const{id:n,organizationId:j}=de(),b=me(),{data:s,isLoading:D,refetch:h}=pe(n),{mutateAsync:L}=he(),{mutateAsync:T}=ue(),{mutateAsync:g,isPending:m}=fe(),{mutateAsync:u,isPending:o}=ge(),{mutateAsync:A,isPending:E}=Ne(),{mutateAsync:$,isPending:S}=je(),{role:y,permission:N}=xe(),ee=y==="owner"||((W=N==null?void 0:N.procurement)==null?void 0:W.list),I=y==="owner"||((q=N==null?void 0:N.procurement)==null?void 0:q.edit),se=encodeURIComponent(s==null?void 0:s.generatedLink),v=`https://houseofram.in/${j}/procurement/public?token=${se}&orderId=${n}`,[G,U]=f.useState(!1),[R,k]=f.useState(!1),[l,w]=f.useState({}),[z,C]=f.useState(!1),[r,P]=f.useState({}),te=async()=>{var t,i;try{if(l!=null&&l.phoneNumber&&!/^\d{10}$/.test(l==null?void 0:l.phoneNumber.trim()))throw new Error("Phone number should contain exactly 10 digit numbers");await T({id:n,payload:l}),k(!1),c({title:"Success",description:"Delivery Details Updated"})}catch(a){c({variant:"destructive",title:"Error",description:((i=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:i.message)||(a==null?void 0:a.message)||"Update failed"})}},ae=async()=>{var t,i;try{if(r.phoneNumber&&!/^\d{10}$/.test(r.phoneNumber.trim()))throw new Error("Phone number should contain exactly 10 digit numbers");await L({id:n,payload:r}),c({title:"Success",description:"Shop Details Updated"}),C(!1)}catch(a){c({variant:"destructive",title:"Error",description:((i=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:i.message)||(a==null?void 0:a.message)||"Update failed"})}},ne=async()=>{var t,i;try{await g({id:n}),c({title:"Success",description:"Pdf Generated successfully"})}catch(a){c({title:"Error",description:((i=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:i.message)||(a==null?void 0:a.message)||"Failed to generate link",variant:"destructive"})}},le=async()=>{var t,i;try{await u({orderId:n}),h(),c({title:"Success",description:"Link Generated successfully"})}catch(a){c({title:"Error",description:((i=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:i.message)||(a==null?void 0:a.message)||"Failed to generate link",variant:"destructive"})}},ie=async()=>{if(v)try{await navigator.clipboard.writeText(v),U(!0),setTimeout(()=>U(!1),1500)}catch{c({title:"Error",description:"Failed to copy link",variant:"destructive"})}},re=()=>{var x;if(!v)return;const t=`Hey, please check this items link:

${v}`,i=(x=s==null?void 0:s.shopDetails)==null?void 0:x.phoneNumber;let a="";i?a=`https://wa.me/${i.replace(/\D/g,"")}?text=${encodeURIComponent(t)}`:a=`https://wa.me/?text=${encodeURIComponent(t)}`,window.open(a,"_blank")},ce=async t=>{var i,a;try{await A({id:n,pdfId:t}),c({title:"Success",description:"PDF deleted"})}catch(x){c({variant:"destructive",title:"Error",description:((a=(i=x==null?void 0:x.response)==null?void 0:i.data)==null?void 0:a.message)||(x==null?void 0:x.message)||"failed to delete"})}},oe=async()=>{var t,i;try{if(s!=null&&s.isSyncWithPaymentsSection)return c({variant:"destructive",title:"Error",description:"already sent to payments section"});await $({id:s._id}),h==null||h(),c({title:"Success",description:"Procurement order sent to Payments Section"})}catch(a){c({variant:"destructive",title:"Error",description:((i=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:i.message)||(a==null?void 0:a.message)||"operation failed"})}};if(D)return e.jsx(ye,{});if(ee)return console.log("data",s),console.log("data procuremnet",s.procurementNumber),e.jsxs("div",{className:"p-1 max-w-full max-h-full overflow-y-auto space-y-8",children:[e.jsx("header",{className:"flex gap-2 items-center",children:e.jsxs("section",{className:"flex flex-1 justify-between items-center",children:[e.jsxs("div",{className:"flex gap-2 justify-between items-center",children:[e.jsx("div",{onClick:()=>b(-1),className:"bg-blue-50 hover:bg-slate-300 flex items-center justify-between w-8 h-8 border border-[#a6aab8] text-sm cursor-pointer rounded-md px-2 ",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsxs("h1",{className:"text-2xl sm:text-3xl font-bold text-blue-700",children:[e.jsx("span",{className:"!text-gray-600 text-2xl",children:"Procurement No:"})," "," ",s!=null&&s.procurementNumber?s.procurementNumber:s!=null&&s.refPdfId?(M=s.refPdfId)==null?void 0:M.replace(/-pdf$/,""):"N/A"]})]}),e.jsx("div",{className:"flex gap-2 items-center ",children:e.jsxs("div",{className:"flex gap-1 items-center",children:[e.jsx(we,{content:"Click the button to send the details to  payments dept",position:"bottom",className:""}),e.jsx(d,{variant:"primary",disabled:s.isSyncWithPaymentsSection,isLoading:S,className:"disabled:cursor-not-allowed",onClick:oe,children:"Send To Payments"}),!s.isSyncWithPaymentsSection&&e.jsx(Ce,{data:s,refetch:h})]})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 min-h-[140px] divide-y md:divide-y-0 md:divide-x divide-gray-100",children:[e.jsxs("div",{className:"p-4 flex flex-col relative group transition-all hover:bg-slate-50/50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-50 flex items-center justify-center text-blue-600",children:e.jsx("i",{className:"fa-solid fa-store text-sm"})}),e.jsx("h4",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Shop Details"}),!z&&I&&e.jsx("button",{onClick:()=>{P(s==null?void 0:s.shopDetails),C(!0)},className:"ml-auto cursor-pointer text-gray-400 hover:text-blue-600 transition-colors",title:"Edit Shop Details",children:e.jsx("i",{className:"fa-solid fa-pen-to-square text-sm"})})]}),z?e.jsxs("div",{className:"space-y-2 animate-in fade-in zoom-in-95 duration-200",children:[e.jsx(p,{placeholder:"Shop Name",value:(r==null?void 0:r.shopName)||"",onChange:t=>P({...r,shopName:t.target.value}),className:"h-8 text-xs"}),e.jsx(p,{placeholder:"Contact Person",value:(r==null?void 0:r.contactPerson)||"",onChange:t=>P({...r,contactPerson:t.target.value}),className:"h-8 text-xs"}),e.jsx(p,{placeholder:"Phone",value:(r==null?void 0:r.phoneNumber)||"",onChange:t=>{/^\d*$/.test(t.target.value)&&P({...r,phoneNumber:t.target.value})},className:"h-8 text-xs",maxLength:10}),e.jsx(ke,{placeholder:"Address",value:(r==null?void 0:r.address)||"",onChange:t=>P({...r,address:t.target.value}),className:" text-xs"}),e.jsxs("div",{className:"flex gap-2 pt-1",children:[e.jsx(d,{size:"sm",onClick:()=>{ae(),C(!1)},className:"h-7 text-xs px-3 bg-blue-600",children:"Save"}),e.jsx(d,{size:"sm",variant:"outline",onClick:()=>C(!1),className:"h-7 text-xs px-3",children:"Cancel"})]})]}):e.jsxs("div",{className:"flex flex-col gap-1.5 mt-1",children:[e.jsx("p",{className:"font-bold text-gray-900 text-base leading-tight truncate",children:((_=s==null?void 0:s.shopDetails)==null?void 0:_.shopName)||e.jsx("span",{className:"text-gray-400 italic",children:"No Shop Name"})}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx("i",{className:"fa-solid fa-user text-gray-400 w-3"}),e.jsx("span",{className:"truncate",children:((B=s==null?void 0:s.shopDetails)==null?void 0:B.contactPerson)||"-"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx("i",{className:"fa-solid fa-phone text-gray-400 w-3"}),e.jsx("span",{className:"font-mono",children:((O=s==null?void 0:s.shopDetails)==null?void 0:O.phoneNumber)||"-"})]}),e.jsxs("div",{className:"flex items-start gap-2 text-xs text-gray-500 mt-1",children:[e.jsx("i",{className:"fa-solid fa-location-dot text-gray-400 w-3 mt-0.5"}),e.jsx("p",{className:"line-clamp-2 leading-snug",children:((Q=s==null?void 0:s.shopDetails)==null?void 0:Q.address)||"-"})]})]})]}),e.jsxs("div",{className:"p-4 flex flex-col relative group transition-all hover:bg-slate-50/50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-orange-50 flex items-center justify-center text-orange-600",children:e.jsx("i",{className:"fa-solid fa-truck-fast text-sm"})}),e.jsx("h4",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Delivery Details"}),!R&&I&&e.jsx("button",{onClick:()=>{w(s==null?void 0:s.deliveryLocationDetails),k(!0)},className:"ml-auto cursor-pointer text-gray-400 hover:text-orange-600 transition-colors",title:"Edit Delivery Details",children:e.jsx("i",{className:"fa-solid fa-pen-to-square text-sm"})})]}),R?e.jsxs("div",{className:"space-y-2 animate-in fade-in zoom-in-95 duration-200",children:[e.jsx(p,{placeholder:"Site Name",value:(l==null?void 0:l.siteName)||"",onChange:t=>w({...l,siteName:t.target.value}),className:"h-8 text-xs"}),e.jsx(p,{placeholder:"Supervisor",value:(l==null?void 0:l.siteSupervisor)||"",onChange:t=>w({...l,siteSupervisor:t.target.value}),className:"h-8 text-xs"}),e.jsx(p,{placeholder:"Phone",value:(l==null?void 0:l.phoneNumber)||"",onChange:t=>{/^\d*$/.test(t.target.value)&&w({...l,phoneNumber:t.target.value})},className:"h-8 text-xs",maxLength:10}),e.jsx(p,{placeholder:"Address",value:(l==null?void 0:l.address)||"",onChange:t=>w({...l,address:t.target.value}),className:"w-full"}),e.jsxs("div",{className:"flex gap-2 pt-1",children:[e.jsx(d,{size:"sm",onClick:()=>{te(),k(!1)},className:"h-7 text-xs px-3 bg-blue-600",children:"Save"}),e.jsx(d,{size:"sm",variant:"outline",onClick:()=>k(!1),className:"h-7 text-xs px-3",children:"Cancel"})]})]}):e.jsxs("div",{className:"flex flex-col gap-1.5 mt-1",children:[e.jsx("p",{className:"font-bold text-gray-900 text-base leading-tight truncate",children:((Y=s==null?void 0:s.deliveryLocationDetails)==null?void 0:Y.siteName)||e.jsx("span",{className:"text-gray-400 italic",children:"No Site Name"})}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx("i",{className:"fa-solid fa-helmet-safety text-gray-400 w-3"}),e.jsx("span",{children:((H=s==null?void 0:s.deliveryLocationDetails)==null?void 0:H.siteSupervisor)||"No Supervisor"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx("i",{className:"fa-solid fa-mobile-screen text-gray-400 w-3"}),e.jsx("span",{className:"font-mono",children:((V=s==null?void 0:s.deliveryLocationDetails)==null?void 0:V.phoneNumber)||"-"})]}),e.jsxs("div",{className:"flex items-start gap-2 text-xs text-gray-500 mt-1",children:[e.jsx("i",{className:"fa-solid fa-map-pin text-gray-400 w-3 mt-0.5"}),e.jsx("p",{className:"line-clamp-2 leading-snug",children:((F=s==null?void 0:s.deliveryLocationDetails)==null?void 0:F.address)||"No Address"})]})]})]}),e.jsxs("div",{className:"px-4  flex flex-col justify-center border-dashed border-l border-gray-200 bg-gray-50/30",children:[e.jsxs("div",{className:"mb-2 flex gap-[3px]",children:[e.jsx("span",{className:"text-[10px] text-gray-400 uppercase font-semibold",children:"From:"}),e.jsx(Se,{className:"mbg-blue-100 uppercase text-[10px] !px-1 !font-bold",children:(s==null?void 0:s.fromDeptName)||"Order Material"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] text-gray-400 uppercase font-semibold",children:"Order Number"}),e.jsxs("h2",{className:"text-2xl font-mono font-bold text-gray-800 tracking-tight leading-none",children:["#",(s==null?void 0:s.fromDeptNumber)||"N/A"]})]}),(s==null?void 0:s.quoteNumber)&&(s==null?void 0:s.quoteNumber)>1&&e.jsx("div",{className:"",children:e.jsxs("span",{className:"text-[10px] text-gray-400 uppercase font-semibold",children:["Quote Number: ",s==null?void 0:s.quoteNumber," "]})}),e.jsx("div",{className:"mt-4 pt-3 border-t border-gray-100 border-dashed",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Rate Status"}),s!=null&&s.isConfirmedRate?e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2 py-1 rounded-full text-[10px] font-bold bg-green-100 text-green-700 border border-green-200",children:[e.jsx("i",{className:"fa-solid fa-check-circle"})," Confirmed"]}):e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2 py-1 rounded-full text-[10px] font-bold bg-yellow-100 text-yellow-700 border border-yellow-200",children:[e.jsx("i",{className:"fa-solid fa-clock"})," Pending"]})]})})]}),e.jsxs("div",{className:"p-4 flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("i",{className:"fa-regular fa-calendar-check text-gray-400"}),e.jsx("h4",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Timeline"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center text-xs",children:[e.jsx("span",{className:"text-gray-500",children:"Created"}),e.jsx("span",{className:"font-medium text-gray-900 font-mono bg-gray-100 px-1.5 py-0.5 rounded",children:Pe(s==null?void 0:s.createdAt)})]}),(s==null?void 0:s.shopQuoteNumber)&&e.jsxs("div",{className:"flex justify-between items-center text-xs",children:[e.jsx("span",{className:"text-gray-500",children:"Shop Quote #"}),e.jsx("span",{className:"font-medium text-gray-700",children:s.shopQuoteNumber})]})]})]}),e.jsx("div",{className:"mt-auto",children:e.jsxs("div",{className:`p-2 rounded-lg border flex items-center gap-3 ${s!=null&&s.isSendToPayment?"bg-purple-50 border-purple-100":"bg-gray-50 border-gray-100"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${s!=null&&s.isSendToPayment?"bg-purple-100 text-purple-600":"bg-gray-200 text-gray-400"}`,children:e.jsx("i",{className:`fa-solid ${s!=null&&s.isSendToPayment?"fa-file-invoice-dollar":"fa-hourglass"}`})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] uppercase font-bold text-gray-400",children:"Payment Process"}),e.jsx("span",{className:`text-xs font-bold ${s!=null&&s.isSendToPayment?"text-purple-700":"text-gray-500"}`,children:s!=null&&s.isSendToPayment?"Sent to Payment":"Not Sent Yet"})]})]})})]})]})}),e.jsx(X,{children:e.jsx(Z,{className:"py-6 space-y-5",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center",children:[e.jsx("h3",{className:"text-lg font-bold text-indigo-700 mb-2 sm:mb-0",children:"Items List ðŸ“‹"}),e.jsx("div",{children:!(s!=null&&s.generatedLink)&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-red-50 border border-red-200 rounded-full shadow-sm",children:[e.jsx("i",{className:"fas fa-exclamation-circle text-red-500 text-lg"}),e.jsx("span",{className:"text-sm font-bold text-red-600 tracking-wide",children:"Action: Generate & Share Link"})]})})]}),e.jsx("div",{className:"overflow-x-auto rounded border border-gray-200",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-100",children:[e.jsx("thead",{className:"bg-gray-50 text-sm text-gray-700 font-medium",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-5 py-2 text-center",children:"S.No"}),e.jsx("th",{className:"px-5 py-2 text-center",children:"Item Name"}),e.jsx("th",{className:"px-5 py-2 text-center",children:"Quantity"}),e.jsx("th",{className:"px-5 py-2 text-center",children:"Unit"}),e.jsx("th",{className:"px-5 py-2 text-center",children:"Rate"}),e.jsx("th",{className:"px-5 py-2 text-center",children:"Total"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-100 text-sm",children:s.selectedUnits.map((t,i)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-5 py-2 text-center",children:i+1}),e.jsx("td",{className:"px-5 py-2 text-center",children:t.subItemName}),e.jsx("td",{className:"px-5 py-2 text-center",children:t.quantity}),e.jsx("td",{className:"px-5 py-2 text-center",children:t.unit}),e.jsx("td",{className:"px-5 py-2 text-center",children:t.rate}),e.jsx("td",{className:"px-5 py-2 text-center",children:t.totalCost})]},i))})]})}),e.jsxs("div",{className:"flex !ml-auto w-fit mr-[20px] sm:flex-row items-start sm:items-center gap-2",children:[e.jsx("h3",{className:"text-lg font-bold text-blue-700",children:"Total Cost "}),e.jsx("div",{className:"flex  items-center gap-3 text-sm",children:e.jsxs("p",{className:"text-base font-semibold text-gray-800",children:["â‚¹ ",(s==null?void 0:s.totalCost)||0]})})]})]})})}),e.jsx("section",{className:"w-full",children:e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 shadow-sm w-full ",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("h3",{className:"text-lg font-semibold text-blue-800 flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-link"})," Generate Shareable Link"]})}),s!=null&&s.generatedLink?e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 items-center",children:[e.jsx(p,{readOnly:!0,value:v,className:"flex-1 text-sm cursor-default"}),e.jsxs(d,{onClick:ie,variant:"outline",className:"flex gap-2",children:[e.jsx("i",{className:`fas ${G?"fa-check-circle":"fa-copy"}`}),G?"Copied":"Copy"]}),e.jsxs(d,{onClick:re,className:"bg-green-500 hover:bg-green-600 text-white flex gap-2",children:[e.jsx("i",{className:"fab fa-whatsapp"}),"Share"]})]}):e.jsx(d,{onClick:le,disabled:o,className:"bg-blue-600 hover:bg-blue-700 text-white",children:o?"Generating...":"Generate Link"})]})}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"Export Procurement Material"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Generate a PDF document of your Procurements"})]}),e.jsx(d,{onClick:ne,disabled:m,className:"min-w-[140px] bg-blue-600 hover:bg-blue-700 text-white font-medium",size:"lg",children:m?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-file-pdf"}),"Generate PDF"]})})]}),s!=null&&s.procurementPdfs&&((J=s==null?void 0:s.procurementPdfs)==null?void 0:J.length)>0?(K=s==null?void 0:s.procurementPdfs)==null?void 0:K.map(t=>e.jsx(X,{className:"border-green-200 bg-green-50 ",children:e.jsx(Z,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx("i",{className:"fas fa-check-circle text-green-600"})}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-green-900 mb-1",children:[e.jsx("span",{className:"text-sm text-black",children:"Pdf Reference Id: "}),t.refUniquePdf||"N/A"]}),e.jsx("p",{className:"text-sm text-green-700",children:"Your Procurement PDF is ready to view or download"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full sm:w-auto ",children:[e.jsxs(d,{variant:"outline",onClick:()=>window.open(t.url,"_blank"),className:"border-green-300 text-blue-700 hover:bg-blue-100 hover:border-blue-400",children:[e.jsx("i",{className:"fas mr-2 fa-external-link-alt"}),"View in New Tab"]}),e.jsx(d,{variant:"secondary",onClick:()=>ve({src:t.url,alt:"Procurement"}),className:"border-blue-300 text-blue-700 hover:bg-blue-100 hover:border-blue-400",children:"Download PDF"}),e.jsx(d,{variant:"danger",isLoading:E,onClick:()=>ce(t._id),className:"border-red-300 bg-red-600 text-white hover:bg-red-600 hover:border-red-400",children:"Delete PDF"})]})]})})},t._id)):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col items-center  justify-center min-h-[300px] w-full bg-white rounded-xl text-center p-6",children:[e.jsx("i",{className:"fa-solid fa-file-lines text-5xl text-blue-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-1",children:"No Pdf Found"}),e.jsx("p",{className:"text-sm text-gray-500",children:"No PDF Generated"})]})})]})})]})},Ce=({data:n,refetch:j})=>{const[b,s]=f.useState(900),{mutateAsync:D,isPending:h}=be();f.useEffect(()=>{if(n!=null&&n.isSyncWithPaymentsSection)return;const m=()=>{var y;const E=((y=new Date(n==null?void 0:n.createdAt))==null?void 0:y.getTime())+2*60*1e3,$=new Date().getTime(),S=Math.floor((E-$)/1e3);return S<=0?(s(0),!1):(s(S),!0)};if(!m())return;const o=setInterval(()=>{m()||clearInterval(o)},1e3);return()=>clearInterval(o)},[n==null?void 0:n.createdAt,n==null?void 0:n.isSyncWithPaymentsSection]);const L=m=>{const u=Math.floor(m/60),o=m%60;return`${u.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`},T=async()=>{var m,u;try{if(n!=null&&n.isSyncWithPaymentsSection||b===0)return c({variant:"destructive",title:"Action Restricted",description:"Automation has already processed this record."});await D({id:n._id}),j==null||j(),c({title:"Automation Disabled",description:"This procurement will no longer be automatically moved to payments."})}catch(o){c({variant:"destructive",title:"Error",description:((u=(m=o==null?void 0:o.response)==null?void 0:m.data)==null?void 0:u.message)||(o==null?void 0:o.message)||"Operation failed"})}},g=(n==null?void 0:n.isSyncWithPaymentsSection)||b===0;return e.jsx(d,{variant:"danger",disabled:g,isLoading:h,className:`min-w-[140px] flex items-center justify-center gap-2 transition-all ${g?"bg-gray-400 opacity-70":"bg-red-600 hover:bg-red-700"}`,onClick:T,children:e.jsxs("div",{className:"flex items-center justify-between w-full gap-3",children:[e.jsx("span",{children:g?"Automation Done":"Cancel Automation"}),!g&&e.jsx("span",{className:"bg-white/20 px-2 py-0.5 rounded text-xs font-mono border-l border-white/30",children:L(b)})]})})};export{Ye as default};
