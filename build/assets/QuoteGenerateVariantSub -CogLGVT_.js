import{j as e,u as te,a as se,b as ae,c as Y,d as re,r as y,B as ne,M as ce,t as J,e as le}from"./index-ogMTmcqi.js";import{R as K}from"./FurnitureForm-BoSojjkt.js";import{N as ie}from"./constants-BoN4q75_.js";const oe=({data:x,index:C,selectedBrandRates:z,selectedLaminateRates:f,selectedBrand:D,selectedLaminateBrand:F})=>{console.log("data",x);const I=(t,m,n)=>{const b=String(t).toLowerCase().replace("mm","").trim(),N=m.find(T=>String(T.thickness).toLowerCase().replace("mm","").trim()===b);return console.log("ðŸ”  rrrr Input thickness:",b),console.log("ðŸ“¦ rrrr Available rates:",m),console.log("âœ… rrrr Matched:",N),(N==null?void 0:N.rs)!==void 0?N.rs:n==="laminate"?X:0},B=t=>{if(!D&&!F)return t.rowTotal||0;const n=I(t.plywoodNos.thickness,z,"plywood"),b=I(t.laminateNos.thickness,f,"laminate");console.log("ply Rate",n),console.log("lami Rate",b);const N=32,T=t.plywoodNos.quantity*(n*N),L=t.laminateNos.quantity*(b*N);console.log("plyCost",T),console.log("lamiCost",L);const E=T+L;console.log("baseMaterialCost",E);const q=E*(t.profitOnMaterial/100);console.log("profitOnMaterial",q);const s=t.carpenters*t.days*K.labour;console.log("labour cost",s);const a=s*(t.profitOnLabour/100);console.log("profiit on labour",a);const r=E+q+s+a;return Math.round(r)},A=t=>t.quantity*t.cost,Q=x.coreMaterials.reduce((t,m)=>t+B(m),0),o=x.fittingsAndAccessories.reduce((t,m)=>t+A(m),0),G=x.glues.reduce((t,m)=>t+A(m),0),p=x.nonBrandMaterials.reduce((t,m)=>t+A(m),0),P=Q+o+G+p,M=()=>e.jsxs("div",{className:"mt-6",children:[e.jsxs("h3",{className:"font-semibold text-md text-gray-800 mb-2",children:["Core Materials (Total: â‚¹",Q.toLocaleString("en-IN"),")"]}),e.jsx("div",{className:"overflow-x-auto rounded-md",children:e.jsxs("table",{className:"min-w-full text-sm bg-white shadow-sm",children:[e.jsxs("thead",{className:"bg-blue-50 text-sm font-semibold text-gray-600",children:[e.jsxs("tr",{children:[e.jsx("th",{rowSpan:2,className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Image"}),e.jsx("th",{rowSpan:2,className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Item Name"}),e.jsx("th",{colSpan:2,className:"text-center px-6 py-1 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Plywood"}),e.jsx("th",{colSpan:2,className:"text-center px-6 py-1 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Laminate"}),e.jsx("th",{rowSpan:2,className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"No. of Carpenters / Day"}),e.jsx("th",{rowSpan:2,className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"No. of Days"}),e.jsx("th",{rowSpan:2,className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Profit % Material"}),e.jsx("th",{rowSpan:2,className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Profit % Labour"}),e.jsx("th",{rowSpan:2,className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Remarks"}),e.jsx("th",{rowSpan:2,className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),e.jsx("th",{rowSpan:2,className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]}),e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-6 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Qty"}),e.jsx("th",{className:"text-center px-6 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Thk"}),e.jsx("th",{className:"text-center px-6 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Qty"}),e.jsx("th",{className:"text-center px-6 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Thk"})]})]}),e.jsx("tbody",{children:(x.coreMaterials.length>0?x.coreMaterials:[v()]).map((t,m)=>{var b,N,T,L;const n=B(t);return e.jsxs("tr",{className:"group border",children:[e.jsx("td",{className:"text-center border-r-1 p-2",children:t!=null&&t.imageUrl?e.jsx("img",{src:(t==null?void 0:t.imageUrl)||ie,className:"h-10 mx-auto"}):e.jsx(e.Fragment,{children:"â€”"})}),e.jsx("td",{className:"text-center border-r-1 p-2",children:(t==null?void 0:t.itemName)||"â€”"}),e.jsx("td",{className:"text-center border-r-1 p-2",children:((b=t==null?void 0:t.plywoodNos)==null?void 0:b.quantity)??0}),e.jsx("td",{className:"text-center border-r-1 p-2",children:((N=t==null?void 0:t.plywoodNos)==null?void 0:N.thickness)??0}),e.jsx("td",{className:"text-center border-r-1 p-2",children:((T=t==null?void 0:t.laminateNos)==null?void 0:T.quantity)??0}),e.jsx("td",{className:"text-center border-r-1 p-2",children:((L=t==null?void 0:t.laminateNos)==null?void 0:L.thickness)??0}),e.jsx("td",{className:"text-center border-r-1 p-2",children:(t==null?void 0:t.carpenters)||0}),e.jsx("td",{className:"text-center border-r-1 p-2",children:(t==null?void 0:t.days)||0}),e.jsx("td",{className:"text-center border-r-1 p-2",children:(t==null?void 0:t.profitOnMaterial)||0}),e.jsx("td",{className:"text-center border-r-1 p-2",children:(t==null?void 0:t.profitOnLabour)||0}),e.jsx("td",{className:"text-center border-r-1 p-2",children:(t==null?void 0:t.remarks)||"â€”"}),e.jsxs("td",{className:"text-center border-r-1 p-2 text-green-700 font-bold",children:["â‚¹",n==null?void 0:n.toLocaleString("en-IN")]}),e.jsx("td",{className:"text-center border-r-1 p-2",children:"â€”"})]},m)})})]})})]}),j=(t,m)=>e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"font-semibold text-md mb-2 text-gray-800",children:t}),e.jsxs("table",{className:"min-w-full text-sm bg-white shadow-sm",children:[e.jsx("thead",{className:"bg-blue-50 text-sm font-semibold text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Item Name"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Description"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Quantity"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Cost"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{children:(m.length>0?m:[R()]).map((n,b)=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"text-center border p-2",children:(n==null?void 0:n.itemName)||"â€”"}),e.jsx("td",{className:"text-center border p-2",children:(n==null?void 0:n.description)||"â€”"}),e.jsx("td",{className:"text-center border p-2",children:(n==null?void 0:n.quantity)||0}),e.jsx("td",{className:"text-center border p-2",children:(n==null?void 0:n.cost)||0}),e.jsxs("td",{className:"text-center border p-2 text-green-700 font-bold",children:["â‚¹",A(n).toLocaleString("en-IN")]}),e.jsx("td",{className:"text-center border p-2",children:"â€”"})]},b))})]})]}),v=()=>({itemName:"",plywoodNos:{quantity:0,thickness:0},laminateNos:{quantity:0,thickness:0},carpenters:0,days:0,profitOnMaterial:0,profitOnLabour:0,remarks:"",rowTotal:0,imageUrl:void 0,previewUrl:""}),R=()=>({itemName:"",description:"",quantity:0,cost:0,rowTotal:0});return e.jsxs("div",{className:"shadow-md p-4 my-4 border rounded-lg bg-white",children:[e.jsxs("div",{className:" flex justify-between items-center",children:[e.jsxs("h2",{className:"text-xl font-semibold  text-blue-600",children:["Furniture ",C+1,": ",x.furnitureName]}),e.jsxs("div",{className:"text-right text-xl font-bold text-green-700",children:["Furniture Total: â‚¹",P.toLocaleString("en-IN")]})]}),M(),j("Fittings & Accessories",x.fittingsAndAccessories),j("Glues",x.glues),j("Non-Branded Materials",x.nonBrandMaterials)]})},X=10,ue=()=>{var E,q;const{organizationId:x,quoteId:C}=te(),z=se(),{data:f,isLoading:D}=ae(x,C);let{data:F,isLoading:I}=Y(x,"plywood"),{data:B}=Y(x,"Laminate");console.log("laminateBrands",B);const{mutateAsync:A,isPending:Q}=re(),[o,G]=y.useState(null),[p,P]=y.useState(null),M=y.useMemo(()=>{if(!F)return{};const s={};return F.forEach(a=>{const r=(a==null?void 0:a.data)||{},c=r.Brand??r.brand,d=r["thickness (mm)"]||r.thickness||r.Thickness;let u=r.Rs||r.rs;if(c&&d&&u){const h=String(c).trim(),S=String(d).trim(),g=parseFloat(u);s[h]||(s[h]=[]),s[h].push({thickness:S,rs:g})}}),s},[F]),j=y.useMemo(()=>Object.keys(M),[M]),v=y.useMemo(()=>{if(!B)return{};const s={};return B.forEach(a=>{const r=(a==null?void 0:a.data)||{},c=r.Brand??r.brand,d=r["thickness (mm)"]||r.thickness||r.Thickness,u=r.Rs||r.rs;if(c&&d&&u){const h=String(c).trim(),S=String(d).trim(),g=parseFloat(u);s[h]||(s[h]=[]),s[h].push({thickness:S,rs:g})}}),s},[B]),R=y.useMemo(()=>Object.keys(v),[v]),[t,m]=y.useState([]),n=s=>{var c;if(!o)return 0;const a=String(s).toLowerCase().replace("mm","").trim(),r=(c=M[o])==null?void 0:c.find(d=>String(d.thickness).toLowerCase().replace("mm","").trim()===a);return(r==null?void 0:r.rs)||0},b=s=>{var d;if(!p)return X;const a=u=>String(u).replace(/mm/gi,"").replace(/\s+/g,"").trim().toLowerCase(),r=a(s),c=(d=v[p])==null?void 0:d.find(u=>a(u.thickness)===r);return(c==null?void 0:c.rs)??X},N=y.useMemo(()=>{if(t.length===0)return 0;const s=32,a=c=>{const d=c.coreMaterials.reduce((g,i)=>{if(!o&&!p)return g+(i.rowTotal||0);{const k=n(i.plywoodNos.thickness),V=b(i.laminateNos.thickness),H=i.plywoodNos.quantity*k*s,_=i.laminateNos.quantity*V*s,U=H+_,W=U*(i.profitOnMaterial/100),O=i.carpenters*i.days*K.labour,$=O*(i.profitOnLabour/100),w=U+W+O+$;return g+Math.round(w)}},0),u=c.fittingsAndAccessories.reduce((g,i)=>g+i.quantity*i.cost,0),h=c.glues.reduce((g,i)=>g+i.quantity*i.cost,0),S=c.nonBrandMaterials.reduce((g,i)=>g+i.quantity*i.cost,0);return Math.round(d+u+h+S)};return t.reduce((c,d)=>c+a(d),0)},[t,o,p]),T=()=>t.map(s=>{const a=s.coreMaterials||[],r=l=>{if(!o&&!p)return l.rowTotal||0;const V=n(l.plywoodNos.thickness),H=b(l.laminateNos.thickness),_=32,U=l.plywoodNos.quantity*V*_,W=l.laminateNos.quantity*H*_,O=U+W,$=O*(l.profitOnMaterial/100),w=l.carpenters*l.days*K.labour,Z=w*(l.profitOnLabour/100),ee=O+$+w+Z;return Math.round(ee)},c=l=>l.quantity*l.cost,d=a.map(l=>({...l,rowTotal:r(l)})),u=s.fittingsAndAccessories.reduce((l,k)=>l+c(k),0),h=s.glues.reduce((l,k)=>l+c(k),0),S=s.nonBrandMaterials.reduce((l,k)=>l+c(k),0),g=d.reduce((l,k)=>l+k.rowTotal,0),i=g+u+h+S;return{...s,coreMaterials:d,coreMaterialsTotal:g,fittingsAndAccessoriesTotal:u,gluesTotal:h,nonBrandMaterialsTotal:S,furnitureTotal:i,totals:{core:g,fittings:u,glues:h,nbms:S,furnitureTotal:i}}}),L=async()=>{var s,a;try{if(!x||!C||!f||!o){J({title:"Missing info",description:"Please ensure brand and all details are selected",variant:"destructive"});return}const r=T(),c=r.reduce((u,h)=>u+h.furnitureTotal,0),d=await A({quoteId:C,organizationId:x,data:{quoteId:C,organizationId:x,projectId:f.projectId,brandName:o,laminateBrand:p,furnitures:r,grandTotal:c,notes:"Generated with brand variant"}});le({src:d.url,alt:d.fileName}),J({title:"success",description:"scuesssfully vrated"})}catch(r){J({title:"Error",description:((a=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:a.message)??"Operation failed"})}};return y.useEffect(()=>{if(!(f!=null&&f.furnitures))return;const s=f.furnitures.map(a=>({furnitureName:a.furnitureName,coreMaterials:a.coreMaterials||[],fittingsAndAccessories:a.fittingsAndAccessories||[],glues:a.glues||[],nonBrandMaterials:a.nonBrandMaterials||[],totals:{core:a.coreMaterialsTotal||0,fittings:a.fittingsAndAccessoriesTotal||0,glues:a.gluesTotal||0,nbms:a.nonBrandMaterialsTotal||0,furnitureTotal:a.furnitureTotal||0}}));m(s)},[f]),y.useEffect(()=>{!o&&(j==null?void 0:j.length)>0&&G(j[0])},[j]),y.useEffect(()=>{!p&&(R==null?void 0:R.length)>0&&P(R[0])},[R]),e.jsxs("div",{className:"p-2 max-h-full overflow-y-auto",children:[e.jsxs("header",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("div",{onClick:()=>z(-1),className:"bg-slate-50 hover:bg-slate-300 flex items-center justify-between w-8 h-8 border border-[#a6aab8] text-sm cursor-pointer rounded-md px-2 ",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsxs("h1",{className:"text-2xl font-bold",children:["Quote #",(f==null?void 0:f.quoteNo)||"View"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{children:e.jsx(ne,{isLoading:Q,onClick:()=>{L()},children:"Generate Quote"})}),e.jsxs("div",{children:[e.jsx("label",{className:"font-medium text-gray-700",children:"Select plywood Brand:"}),e.jsxs("select",{value:o||"",onChange:s=>G(s.target.value),className:"border border-gray-300 px-3 py-2 rounded text-sm",children:[e.jsx("option",{value:"",children:"-- Choose Brand --"}),j.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"font-medium text-gray-700",children:"Select Laminate Brand:"}),e.jsxs("select",{value:p||"",onChange:s=>P(s.target.value),className:"border border-gray-300 px-3 py-2 rounded text-sm",children:[e.jsx("option",{value:"",children:"-- Choose Laminate Brand --"}),R.map(s=>e.jsx("option",{value:s,children:s},s))]})]})]})]}),o&&((E=M[o])==null?void 0:E.length)>0&&e.jsxs("div",{className:"mt-6 border border-gray-200 bg-white rounded-md shadow-sm p-4",children:[e.jsxs("h3",{className:"text-md font-semibold text-gray-800 mb-2",children:["Available Thickness & Rates for ",e.jsx("span",{className:"text-blue-600",children:o})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm text-left border border-gray-100",children:[e.jsx("thead",{className:"bg-blue-50 text-xs text-gray-600 uppercase tracking-wider",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 border-r",children:"Thickness"}),e.jsx("th",{className:"px-4 py-2",children:"Rate (â‚¹/sqft)"})]})}),e.jsx("tbody",{children:M[o].map((s,a)=>e.jsxs("tr",{className:"border-t border-gray-100",children:[e.jsx("td",{className:"px-4 py-2 border-r text-gray-700 font-medium",children:s.thickness}),e.jsxs("td",{className:"px-4 py-2 text-green-800 font-bold",children:["â‚¹",s.rs.toFixed(2)]})]},a))})]})})]}),p&&((q=v[p])==null?void 0:q.length)>0&&e.jsxs("div",{className:"mt-4 border bg-white rounded-md shadow-sm p-4",children:[e.jsxs("h3",{className:"text-md font-semibold text-gray-800 mb-2",children:["Laminate Rates for ",e.jsx("span",{className:"text-blue-600",children:p})]}),e.jsxs("table",{className:"min-w-full text-sm border",children:[e.jsx("thead",{className:"bg-blue-50 text-xs text-gray-600 uppercase",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 border-r",children:"Thickness"}),e.jsx("th",{className:"px-4 py-2",children:"Rate (â‚¹/sqft)"})]})}),e.jsx("tbody",{children:v[p].map((s,a)=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-2 border-r font-medium",children:s.thickness}),e.jsxs("td",{className:"px-4 py-2 text-green-800 font-bold",children:["â‚¹",s.rs.toFixed(2)]})]},a))})]})]}),D||I?e.jsx(ce,{}):e.jsx(e.Fragment,{children:e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-6",children:[t.map((s,a)=>e.jsx(oe,{index:a,data:s,selectedBrandRates:o?M[o]||[]:[],selectedLaminateRates:p?v[p]||[]:[],selectedBrand:o,selectedLaminateBrand:p},a)),e.jsx("div",{className:"mt-10 text-right",children:e.jsxs("div",{className:"inline-block bg-green-50 border border-green-200 rounded-md px-6 py-4",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-700 mb-1",children:["Total Estimate ",o?`(Based on ${o})`:""]}),e.jsxs("p",{className:"text-2xl font-bold text-green-700",children:["â‚¹",N.toLocaleString("en-IN")]})]})})]})})})]})};export{X as DEFAULT_LAMINATE_RATE_PER_SQFT,ue as default};
