import{u as v,j as h}from"./index-Dkf7SbMA.js";import{u as I}from"./designLabApi-CvnqPqeB.js";import{D as b}from"./DesignLabForm-BgJMPBWr.js";import{t as p}from"./toast-BSC5QTk1.js";import"./useQuery-h0LZ4b8f.js";import"./useMutation-DtRxugN4.js";import"./useInfiniteQuery-BUWQcrvt.js";import"./roleCheck-CXq1v0D5.js";import"./Button-ClgICMLF.js";const q=()=>{const{organizationId:a}=v(),{mutateAsync:m,isPending:l}=I(),u=async r=>{var c;try{const t=new FormData;if(!r.productName||!((c=r==null?void 0:r.productName)!=null&&c.trim())){p({title:"Error",description:"Enter the product name",variant:"destructive"});return}const o=[],d=r.components.map(e=>{const i=e.materials.filter(n=>{var s;return((s=n.materialName)==null?void 0:s.trim())||n.rate!==""&&n.rate!==0||n.image});return{...e,materials:i}}),f=r.sequenceOfOperations.filter(e=>e.description&&e.description.trim()!=="").map((e,i)=>({...e,stepNumber:i+1})),g={...r,organizationId:a,sequenceOfOperations:f,referenceImages:[],components:d.map(e=>({...e,materials:e.materials.map(i=>({...i,vendorId:i.vendorId===""?void 0:i.vendorId}))}))};r.newRefFiles.forEach(e=>{t.append("files",e),o.push({target:"reference"})}),d.forEach((e,i)=>{e.materials.forEach((n,s)=>{n.tempFile&&(t.append("files",n.tempFile),o.push({target:"material",componentIndex:i,materialIndex:s}))})}),t.append("data",JSON.stringify(g)),t.append("fileMapping",JSON.stringify(o)),t.append("organizationId",a),await m({organizationId:a,formData:t}),p({title:"Success",description:"Design created successfully"})}catch(t){console.error(t),p({title:"Error",description:t.message||"Failed to create design",variant:"destructive"})}};return h.jsx(b,{mode:"create",organizationId:a,onSubmit:u,isLoading:l})};export{q as default};
