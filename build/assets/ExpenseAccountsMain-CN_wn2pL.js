import{b as O,j as e,a as G,f as H,u as U,r as D,O as Y,B as E,t as S}from"./index-MXS_gbde.js";import{B as q}from"./Breadcrumb-BaXmUmlW.js";import{d as J,e as K}from"./expenseApi-DANU4EuY.js";import{d as B}from"./dateFormator-BGKi5rfZ.js";import{S as Q}from"./index-ChZfhTVA.js";import{u as A}from"./useDebounce-D0G-FEVR.js";import{S as W}from"./StageGuide-DLy2p25i.js";import"./index-BDg928G7.js";const X=({expense:n,index:x,onView:o,onDelete:m,isDeleting:u})=>{var h;const{role:p,permission:d}=O(),c=p==="owner"||((h=d==null?void 0:d.expense)==null?void 0:h.delete);return e.jsxs("div",{onClick:o,className:"grid  cursor-pointer grid-cols-16 gap-4 px-6 py-4 border-b border-gray-100  hover:bg-[#f9fcff] transition-colors items-center",children:[e.jsx("div",{className:"col-span-1 text-center text-sm font-medium text-gray-600",children:x+1}),e.jsx("div",{className:"col-span-2 text-center",children:e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-md bg-blue-50 text-blue-700 text-xs font-mono font-semibold",children:n.expenseNumber})}),e.jsx("div",{className:"col-span-3 text-center",children:e.jsx("p",{className:"font-medium text-gray-900",children:n.vendorName})}),e.jsx("div",{className:"col-span-2 text-center",children:e.jsxs("span",{className:"text-lg font-bold text-green-600",children:["â‚¹",n.amount.toLocaleString()]})}),e.jsxs("div",{className:"col-span-2 text-center text-sm text-gray-600",children:[e.jsx("i",{className:"fas fa-calendar-alt text-gray-400 mr-2"}),B(n.expenseDate)]}),e.jsx("div",{className:"col-span-2 text-center",children:e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full bg-purple-50 text-purple-700 text-xs font-medium",children:n.payThrough?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-credit-card mr-1"}),n.payThrough]}):"-"})}),e.jsxs("div",{className:"col-span-2 text-center text-sm text-gray-500",children:[e.jsx("i",{className:"fas fa-calendar-alt text-gray-400 mr-2"}),B(n.createdAt)]}),e.jsx("div",{className:"col-span-2 flex justify-center gap-2",children:c&&e.jsx("button",{onClick:m,disabled:u,className:"p-2 text-red-600 cursor-pointer hover:bg-red-50 rounded-lg transition-colors disabled:opacity-50",title:"Delete Expense",children:e.jsx("i",{className:`fas ${u?"fa-spinner fa-spin":"fa-trash"}`})})})]})},oe=()=>{var T,F;const n=G(),x=H(),{organizationId:o}=U(),m=D.useRef(null),u=x.pathname.includes("/expensesingle")||x.pathname.includes("/create"),p=[{label:"Account",path:`/organizations/${o}/projects/accounting`},{label:"Bills",path:`/organizations/${o}/projects/billmain`},{label:"Expenses",path:`/organizations/${o}/projects/expensemain`}],{role:d,permission:c}=O(),h=d==="owner"||((T=c==null?void 0:c.expense)==null?void 0:T.list),P=d==="owner"||((F=c==null?void 0:c.expense)==null?void 0:F.create),[a,r]=D.useState({search:"",vendorId:"",expenseDateToDate:"",expenseDateFromDate:"",createdFromDate:"",createdToDate:"",minAmount:0,maxAmount:1e6,payThrough:"",sortBy:"createdAt",sortOrder:"desc"}),C=A(a.minAmount,800),w=A(a.maxAmount,800),L=A(a.search,500),{data:g,fetchNextPage:k,hasNextPage:f,isFetchingNextPage:b,isLoading:I,isError:M,error:j,refetch:z}=J({organizationId:o||"",search:L,vendorId:a.vendorId||void 0,expenseDateToDate:a.expenseDateToDate||void 0,expenseDateFromDate:a.expenseDateFromDate||void 0,createdFromDate:a.createdFromDate||void 0,createdToDate:a.createdToDate||void 0,minAmount:C?Number(C):void 0,maxAmount:w?Number(w):void 0,payThrough:a.payThrough||void 0,sortBy:a.sortBy,sortOrder:a.sortOrder,limit:20}),N=K();D.useEffect(()=>{const s=m.current;if(!s)return;const t=()=>{const{scrollTop:i,scrollHeight:l,clientHeight:$}=s;l-i-$<100&&f&&!b&&(console.log("ðŸ“œ Loading more expenses..."),k())};return s.addEventListener("scroll",t),()=>s.removeEventListener("scroll",t)},[f,b,k]);const R=async s=>{var t,i;try{await N.mutateAsync({id:s,_organizationId:o||""}),S({title:"Success",description:"Expense deleted successfully"})}catch(l){S({title:"Error",description:((i=(t=l==null?void 0:l.response)==null?void 0:t.data)==null?void 0:i.message)||(l==null?void 0:l.message)||"Failed to delete the expense",variant:"destructive"})}},V=s=>{n(`expensesingle/${s}`)},v=Object.values(a).filter(s=>s!==""&&s!==0&&s!==1e5&&s!=="createdAt"&&s!=="desc").length,_=()=>{r({search:"",vendorId:"",expenseDateToDate:"",expenseDateFromDate:"",createdFromDate:"",createdToDate:"",minAmount:0,maxAmount:1e6,payThrough:"",sortBy:"createdAt",sortOrder:"desc"})},y=(g==null?void 0:g.pages.flatMap(s=>s.data))||[];return u?e.jsx(Y,{}):e.jsxs("div",{className:"space-y-4 h-full",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-receipt mr-3 text-blue-600"}),"Expense Accounts"]}),e.jsx(q,{paths:p})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[P&&e.jsxs(E,{onClick:()=>n("create"),children:[e.jsx("i",{className:"fas fa-plus mr-2"}),"Create Expense"]}),e.jsx("div",{className:"w-full sm:w-auto flex justify-end sm:block",children:e.jsx(W,{organizationId:o,stageName:"expense"})})]})]}),I?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("i",{className:"fas fa-spinner fa-spin text-blue-600 text-4xl"})}):M?e.jsxs("div",{className:"max-w-xl sm:min-w-[80%] mx-auto mt-4 p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2 text-xl sm:text-3xl",children:"âš ï¸ Error Occurred"}),e.jsx("p",{className:"text-red-500 mb-4 text-lg sm:text-xl",children:(j==null?void 0:j.message)||"Failed to load expenses"}),e.jsx(E,{onClick:()=>z(),className:"bg-red-600 text-white px-4 py-2",children:"Retry"})]}):e.jsxs("main",{className:"flex gap-2 !max-h-[88%]",children:[e.jsx("div",{className:"xl:w-80 flex-shrink-0 !max-h-[90%] overflow-y-auto ",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-filter mr-2 text-blue-600"}),"Filters"]}),v>0&&e.jsxs("button",{onClick:_,className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:["Clear All (",v,")"]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx("i",{className:"fas fa-search mr-2"}),"Search"]}),e.jsx("input",{type:"text",autoFocus:!0,placeholder:"Search by vendor name...",value:a.search,onChange:s=>r(t=>({...t,search:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx("i",{className:"fas fa-calendar mr-2"}),"From CreatedAt Date"]}),e.jsx("input",{type:"date",value:a.createdFromDate,onChange:s=>{r(t=>({...t,createdFromDate:s.target.value}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx("i",{className:"fas fa-calendar mr-2"}),"To CreatedAt Date"]}),e.jsx("input",{type:"date",value:a.createdToDate,onChange:s=>{r(t=>({...t,createdToDate:s.target.value}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx("i",{className:"fas fa-calendar mr-2"}),"From Date of Payment"]}),e.jsx("input",{type:"date",value:a.expenseDateFromDate,onChange:s=>{r(t=>({...t,expenseDateFromDate:s.target.value}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx("i",{className:"fas fa-calendar mr-2"}),"To Date of Payment"]}),e.jsx("input",{type:"date",value:a.expenseDateToDate,onChange:s=>{r(t=>({...t,expenseDateToDate:s.target.value}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Amount Range"}),e.jsx("div",{className:"px-2 mb-3",children:e.jsx(Q,{range:!0,min:0,max:1e6,step:500,value:[Number(a.minAmount),Number(a.maxAmount)],onChange:s=>{const[t,i]=s;r(l=>({...l,minAmount:t,maxAmount:i}))},trackStyle:[{backgroundColor:"#3b82f6",height:6}],handleStyle:[{borderColor:"#3b82f6",backgroundColor:"#fff",boxShadow:"0 2px 6px rgba(59, 130, 246, 0.4)",width:18,height:18,marginTop:-6},{borderColor:"#3b82f6",backgroundColor:"#fff",boxShadow:"0 2px 6px rgba(59, 130, 246, 0.4)",width:18,height:18,marginTop:-6}],railStyle:{backgroundColor:"#e5e7eb",height:6}})}),e.jsxs("div",{className:"flex justify-between items-center gap-2 text-sm",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-xs text-gray-500 block mb-1",children:"Min"}),e.jsxs("div",{className:"bg-blue-50 px-3 py-2 rounded-lg font-semibold text-blue-700 text-center",children:["â‚¹",Number(a.minAmount).toLocaleString("en-IN")]})]}),e.jsx("div",{className:"text-gray-400 mt-5",children:"â€”"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-xs text-gray-500 block mb-1",children:"Max"}),e.jsxs("div",{className:"bg-blue-50 px-3 py-2 rounded-lg font-semibold text-blue-700 text-center",children:["â‚¹",Number(a.maxAmount).toLocaleString("en-IN")]})]})]}),e.jsxs("div",{className:"flex gap-3 items-center mt-3",children:[e.jsx("input",{type:"number",value:a.minAmount,onChange:s=>r(t=>({...t,minAmount:+s.target.value})),placeholder:"Min Amount",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",min:"0",step:"500"}),e.jsx("input",{type:"number",value:a.maxAmount,onChange:s=>r(t=>({...t,maxAmount:+s.target.value})),placeholder:"Max Amount",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",min:"0",step:"500"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx("i",{className:"fas fa-credit-card mr-2"}),"Payment Method"]}),e.jsxs("select",{value:a.payThrough,onChange:s=>r(t=>({...t,payThrough:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"All Methods"}),e.jsx("option",{value:"Cash",children:"Cash"}),e.jsx("option",{value:"Bank Transfer",children:"Bank Transfer"}),e.jsx("option",{value:"Credit Card",children:"Credit Card"}),e.jsx("option",{value:"Debit Card",children:"Debit Card"}),e.jsx("option",{value:"Check",children:"Check"}),e.jsx("option",{value:"UPI",children:"UPI"}),e.jsx("option",{value:"Other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx("i",{className:"fas fa-sort mr-2"}),"Sort By"]}),e.jsxs("select",{value:a.sortBy,onChange:s=>r(t=>({...t,sortBy:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"createdAt",children:"Created Date"}),e.jsx("option",{value:"expenseDate",children:"Payment Date"}),e.jsx("option",{value:"amount",children:"Amount"}),e.jsx("option",{value:"vendorName",children:"Vendor Name"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sort Order"}),e.jsxs("select",{value:a.sortOrder,onChange:s=>r(t=>({...t,sortOrder:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"desc",children:"Descending"}),e.jsx("option",{value:"asc",children:"Ascending"})]})]})]})]})}),h&&e.jsxs(e.Fragment,{children:["        ",y.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[300px] w-full bg-white rounded-xl text-center p-6",children:[e.jsx("i",{className:"fas fa-receipt text-5xl text-blue-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-1",children:"No Expenses Found"}),e.jsxs("p",{className:"text-sm text-gray-500",children:[v>0?"Try adjusting your filters to find expenses.":"Looks like there are no expenses yet.",e.jsx("br",{}),"Click on ",e.jsx("strong",{children:'"Add Expense"'})," to get started ðŸš€"]})]}):e.jsxs("div",{ref:m,className:"flex-1 max-h-[100%] overflow-y-auto",children:[e.jsx("div",{className:"bg-white rounded-t-xl border border-gray-200 sticky top-0 z-10",children:e.jsxs("div",{className:"grid grid-cols-16 gap-4 px-6 py-4 bg-gradient-to-r from-blue-50 to-indigo-50 font-semibold text-gray-700 text-sm",children:[e.jsx("div",{className:"col-span-1 text-center",children:"S.No"}),e.jsx("div",{className:"col-span-2 text-center",children:"Expense #"}),e.jsx("div",{className:"col-span-3 text-center",children:"Vendor Name"}),e.jsx("div",{className:"col-span-2 text-center",children:"Amount"}),e.jsx("div",{className:"col-span-2 text-center",children:"Expense Date"}),e.jsx("div",{className:"col-span-2 text-center",children:"Paid Through"}),e.jsx("div",{className:"col-span-2 text-center",children:"Created At"}),e.jsx("div",{className:"col-span-2 text-center",children:"Actions"})]})}),e.jsx("div",{className:"bg-white rounded-b-xl border-x border-b border-gray-200",children:y.map((s,t)=>e.jsx(X,{expense:s,index:t,onView:()=>V(s._id),onDelete:i=>{i.stopPropagation(),R(s._id)},isDeleting:N.isPending&&N.variables.id===s._id},s._id))}),b&&e.jsx("div",{className:"flex justify-center py-8",children:e.jsxs("div",{className:"flex items-center gap-2 text-blue-600",children:[e.jsx("i",{className:"fas fa-spinner fa-spin text-2xl"}),e.jsx("span",{className:"text-sm font-medium",children:"Loading more expenses..."})]})}),!f&&y.length>0&&e.jsx("div",{className:"flex justify-center py-6",children:e.jsxs("p",{className:"text-gray-400 text-sm font-medium",children:[e.jsx("i",{className:"fas fa-check-circle mr-2"}),"You've reached the end of the list"]})})]})]})]})]})};export{oe as default};
