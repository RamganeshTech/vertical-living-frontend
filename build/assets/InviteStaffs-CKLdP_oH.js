import{r as c,j as e,u as se,af as te,a as ae,k as re,aD as f,B as i,t as n}from"./index-BAM0eJUz.js";import{m as le,n as ie,o as ne}from"./orgApi-DGTdT7vR.js";import{L as v}from"./Label-C8i6KaZe.js";import{I as o}from"./Input-1UBXZqEj.js";import{c as oe}from"./commonAuthApi-CB1-7Whz.js";const ce=({isOpen:d,onClose:x,title:j,children:N})=>(c.useEffect(()=>{const m=t=>{t.key==="Escape"&&x()};return window.addEventListener("keydown",m),()=>window.removeEventListener("keydown",m)},[x]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`fixed inset-0 bg-black/30 backdrop-blur-sm z-[100] transition-opacity duration-300 ${d?"opacity-100":"opacity-0 pointer-events-none"}`,onClick:x}),e.jsx("div",{className:`fixed top-0 right-0 h-full w-full max-w-md bg-white shadow-2xl z-[101] transform transition-transform duration-300 ease-in-out ${d?"translate-x-0":"translate-x-full"}`,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100",children:[e.jsx("h2",{className:"text-xl font-bold text-blue-900",children:j}),e.jsx("button",{onClick:x,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx("i",{className:"fa-solid fa-xmark text-gray-500"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6 custom-scrollbar",children:N})]})})]})),fe=()=>{var P,D,F,$;const{organizationId:d}=se(),{openMobileSidebar:x,isMobile:j}=te(),N=ae(),{role:m,permission:t,ownerId:G}=re(),R=m==="owner"||((P=t==null?void 0:t.invitestaff)==null?void 0:P.delete),T=m==="owner"||((D=t==null?void 0:t.invitestaff)==null?void 0:D.list),C=m==="owner"||((F=t==null?void 0:t.invitestaff)==null?void 0:F.create),L=m==="owner"||(($=t==null?void 0:t.invitestaff)==null?void 0:$.edit),[g,q]=c.useState(""),[B,E]=c.useState(!1),[w,U]=c.useState(""),[y,_]=c.useState(""),[k,W]=c.useState(""),[J,S]=c.useState(!1),[r,b]=c.useState({name:"",email:"",phoneNo:"",password:"",role:"staff"}),{data:l,isLoading:Q,error:Y,isError:H}=le(d),z=oe(),K=ie(),I=ne(),h=l==null?void 0:l.filter(s=>{var a,u,p;return(w===""||((a=s.staffName)==null?void 0:a.toLowerCase().includes(w.toLowerCase())))&&(y===""||((u=s.email)==null?void 0:u.toLowerCase().includes(y.toLowerCase())))&&(k===""||((p=s.phoneNo)==null?void 0:p.toString().includes(k)))}),V=async(s,a)=>{if(window.confirm(`Are you sure you want to remove ${a} from this organization?`))try{await K.mutateAsync({staffId:s,orgId:d}),n({title:"Success",description:`${a} has been removed from the organization`})}catch(u){n({title:"Error",description:u.message||"Failed to remove staff member",variant:"destructive"})}},O=async()=>{try{const s=await I.mutateAsync({organizationId:d,role:"staff"});q((s==null?void 0:s.inviteLink)||s),n({title:"Success",description:"Invitation link generated successfully"})}catch(s){n({title:"Error",description:s.message||"Failed to generate invitation link",variant:"destructive"})}},A=async()=>{try{await navigator.clipboard.writeText(g),E(!0),n({title:"Success",description:"Link copied to clipboard"}),setTimeout(()=>E(!1),2e3)}catch{n({title:"Error",description:"Failed to copy link",variant:"destructive"})}},X=()=>{const s=`You're invited to join in the organization! Click this link to register: ${g}`,a=`https://wa.me/?text=${encodeURIComponent(s)}`;window.open(a,"_blank")},Z=async s=>{var p,M;s.preventDefault();const a={organizationId:d,role:r.role,expiresAt:new Date(Date.now()+5*24*60*60*1e3).toISOString(),ownerId:G},u=btoa(JSON.stringify(a));try{await z.mutateAsync({...r,invite:u}),S(!1),b({name:"",email:"",phoneNo:"",password:"",role:"staff"}),n({title:"Success",description:"Staff created successfully"})}catch(ee){n({title:"Error",description:((M=(p=ee.response)==null?void 0:p.data)==null?void 0:M.message)||"Failed to create staff",variant:"destructive"})}};return Q?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-blue-100",children:[e.jsx("div",{className:"bg-white/80 backdrop-blur-sm border-b border-blue-100 sticky top-0 z-10",children:e.jsx("div",{className:"max-w-7xl   mx-auto px-4 sm:px-6 py-4 sm:py-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 sm:space-x-4",children:[e.jsx(f,{className:"h-8 w-24 sm:h-10 sm:w-32"}),e.jsx("div",{className:"hidden sm:block h-6 w-px bg-gray-300"}),e.jsx(f,{className:"h-10 w-10 sm:h-12 sm:w-12 rounded-xl"}),e.jsx(f,{className:"h-6 w-32 sm:h-8 sm:w-48"})]}),e.jsx(f,{className:"h-8 w-20 sm:h-10 sm:w-24"})]})})}),e.jsx("div",{className:"max-w-7xl mx-auto p-4 sm:p-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 lg:gap-8",children:[e.jsx(f,{className:"h-64 w-full rounded-2xl"}),e.jsx("div",{className:"lg:col-span-2",children:e.jsx(f,{className:"h-96 w-full rounded-2xl"})})]})})]}):Y||H||!l?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-blue-100 flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center bg-white p-6 sm:p-8 rounded-2xl shadow-lg max-w-md w-full",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-100 to-blue-200 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("i",{className:"fas fa-building text-blue-500 text-2xl"})}),e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-red-600 mb-2",children:"Organization Not Found"}),e.jsx("p",{className:"text-blue-600 mb-4 text-sm sm:text-base",children:"The organization you're looking for doesn't exist or you don't have access to it."}),e.jsxs(i,{onClick:()=>N("/organizations"),variant:"primary",className:"bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white rounded-xl",children:[e.jsx("i",{className:"fas fa-arrow-left mr-2"}),"Back to Organizations"]})]})}):e.jsxs("div",{className:"min-h-full max-h-full overflow-y-auto min-w-full bg-gradient-to-br from-blue-50 to-white gap-6",children:[e.jsx("header",{className:"bg-white border-b border-gray-200 sticky top-0 z-10 shadow-sm",children:e.jsx("div",{className:"bg-white border-b border-gray-200 sticky top-0 z-10 shadow-sm",children:e.jsx("div",{className:"max-w-full mx-auto px-2 lg:px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[j&&e.jsx("button",{onClick:x,className:"mr-3 p-2 rounded-md border border-gray-300 hover:bg-gray-100",title:"Open Menu",children:e.jsx("i",{className:"fa-solid fa-bars"})}),e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-blue-900",children:"Staff Management"}),e.jsx("div",{className:"hidden sm:block h-8 w-px bg-gray-300"}),e.jsx("div",{className:"bg-blue-100 p-2 rounded-xl",children:e.jsx("i",{className:"fas fa-user text-blue-600 text-xl"})})]}),e.jsxs("section",{className:"flex gap-2 items-center",children:[e.jsxs("div",{className:"text-gray-600 text-sm bg-gray-100 px-3 py-2 rounded-lg",children:[e.jsx("i",{className:"fas fa-users mr-2"}),l==null?void 0:l.length," ",(l==null?void 0:l.length)>1?"Members":"Member"]}),e.jsx("button",{onClick:()=>S(!0),className:"w-10 h-10 bg-blue-600 hover:bg-blue-700 text-white rounded-full flex items-center justify-center shadow-lg transition-transform hover:scale-105",title:"Add New Staff",children:e.jsx("i",{className:"fa-solid fa-plus text-lg"})})]})]})})})}),e.jsx(ce,{isOpen:J,onClose:()=>S(!1),title:"Quick Create Staff",children:e.jsxs("form",{onSubmit:Z,className:"space-y-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Full Name"}),e.jsx(o,{required:!0,placeholder:"Enter staff name",value:r.name,onChange:s=>b({...r,name:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Email Address"}),e.jsx(o,{required:!0,type:"email",placeholder:"staff@company.com",value:r.email,onChange:s=>b({...r,email:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Phone Number"}),e.jsx(o,{required:!0,placeholder:"e.g. 9876543210",value:r.phoneNo,onChange:s=>b({...r,phoneNo:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Password"}),e.jsx(o,{required:!0,type:"password",placeholder:"Set initial password",value:r.password,onChange:s=>b({...r,password:s.target.value})})]}),e.jsx(i,{type:"submit",className:"w-full h-12 mt-4 text-base bg-blue-600 hover:bg-blue-700",isLoading:z.isPending,children:"Register Staff"}),e.jsx("p",{className:"text-xs text-center text-gray-500 mt-4",children:"Staff will be assigned to the current organization automatically."})]})}),e.jsxs("div",{className:"w-full flex flex-col  p-4 gap-6 h-full",children:[e.jsxs("div",{className:"bg-white w-full max-w-full mx-auto p-6 sm:p-8 rounded-xl shadow-lg",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h2",{className:"text-2xl sm:text-3xl font-bold text-blue-900 flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-user-plus text-blue-600 text-lg"}),"Invite Staffs"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Generate an invitation link for your staff."})]}),e.jsx("div",{className:`grid grid-cols-1  md:grid-cols-3 md:gap-6 ${g?"items-start":"items-end"}`,children:e.jsx("div",{className:"md:col-span-2  mt-6 md:mt-0 space-y-3",children:g?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(v,{className:"block text-sm font-medium text-gray-700 mb-1",children:"Invitation Link"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{value:g,readOnly:!0,className:"flex-1 text-sm bg-blue-50 border border-blue-200 text-blue-800 rounded-md h-10"}),e.jsx(i,{onClick:A,className:"h-10 px-3 bg-blue-600 hover:bg-blue-700 text-white rounded-md",children:e.jsx("i",{className:`fas ${B?"fa-check":"fa-copy"}`})})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs(i,{onClick:X,className:"flex-1 bg-green-600 hover:bg-green-700 text-white py-2 rounded-md text-sm font-medium flex items-center justify-center gap-2",children:[e.jsx("i",{className:"fab fa-whatsapp"}),"WhatsApp"]}),e.jsxs(i,{onClick:A,className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-md text-sm font-medium flex items-center justify-center gap-2",children:[e.jsx("i",{className:"fas fa-copy"}),"Copy"]})]}),(C||L)&&e.jsxs(i,{onClick:O,className:"w-full bg-purple-600 hover:bg-purple-700 text-white py-2 rounded-md text-sm font-medium flex items-center justify-center gap-2",children:[e.jsx("i",{className:"fas fa-sync-alt"}),"Generate New Link"]})]}):e.jsx(e.Fragment,{children:(C||L)&&e.jsxs(i,{onClick:O,isLoading:I.isPending,className:"w-full md:w-auto bg-blue-600 hover:bg-blue-700 text-white px-5 py-2 rounded-md text-sm font-medium flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-link"}),"Generate Invitation Link"]})})})})]}),T&&e.jsxs("div",{className:"bg-white p-6 py-2 w-full !min-h-[65vh] sm:!min-h-[70vh] lg:!min-h-[85vh] rounded-2xl shadow-lg overflow-y-auto max-h-[90%] custom-scrollbar",children:[e.jsxs("h2",{className:"text-2xl font-bold text-blue-900 mb-4 flex items-center",children:[e.jsx("i",{className:"fas fa-users mr-2"})," Staff Members (",h==null?void 0:h.length,")"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 mb-4",children:[e.jsx(o,{placeholder:"Search by Name",value:w,onChange:s=>U(s.target.value)}),e.jsx(o,{placeholder:"Search by Email",value:y,onChange:s=>_(s.target.value)}),e.jsx(o,{placeholder:"Search by Phone",value:k,onChange:s=>W(s.target.value)})]}),e.jsxs("div",{className:"hidden md:grid grid-cols-3 font-semibold text-gray-700 border-b border-gray-300 pb-3 text-sm uppercase tracking-wide",children:[e.jsx("p",{className:"text-left px-4",children:"S. No"}),e.jsx("p",{className:"text-left",children:"Staff Details"}),e.jsx("p",{className:"text-center",children:"Action"})]}),h==null?void 0:h.map((s,a)=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3  items-start md:items-center border-b border-gray-200 py-4 px-2 hover:bg-gray-50 transition",children:[e.jsx("div",{className:"text-gray-600 md:text-left px-4 font-medium",children:a+1}),e.jsx("div",{className:"space-y-0.5 ",children:e.jsx("p",{className:"font-semibold text-gray-900 text-base",children:s.staffName})}),R&&e.jsx("div",{className:"mt-2 md:mt-0 md:text-center",children:e.jsxs(i,{variant:"danger",size:"sm",onClick:()=>V(s._id,s.staffName),className:"flex items-center gap-2 bg-red-100 hover:bg-red-200 text-red-600 px-3 py-1 rounded-md font-semibold text-sm transition",children:[e.jsx("i",{className:"fas fa-trash-alt"}),"Delete"]})})]},s._id))]})]})]})};export{fe as default};
