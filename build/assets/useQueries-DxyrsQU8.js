var I=i=>{throw TypeError(i)};var q=(i,e,s)=>e.has(i)||I("Cannot "+s);var n=(i,e,s)=>(q(i,e,"read from private field"),s?s.call(i):e.get(i)),b=(i,e,s)=>e.has(i)?I("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,s),c=(i,e,s,t)=>(q(i,e,"write to private field"),t?t.call(i,s):e.set(i,s),s),y=(i,e,s)=>(q(i,e,"access private method"),s);import{S as V,F as k,G as _,Q as K,s as j,H as W,J as X,r as w,K as Y,L as Z,N as $,P as ee,T,U as D,V as se,W as te}from"./index-hYGmCEO1.js";function G(i,e){const s=new Set(e);return i.filter(t=>!s.has(t))}function re(i,e,s){const t=i.slice(0);return t[e]=s,t}var v,f,m,Q,p,g,C,S,x,a,P,H,L,B,A,J,ie=(J=class extends V{constructor(e,s,t){super();b(this,a);b(this,v);b(this,f);b(this,m);b(this,Q);b(this,p);b(this,g);b(this,C);b(this,S);b(this,x,[]);c(this,v,e),c(this,Q,t),c(this,m,[]),c(this,p,[]),c(this,f,[]),this.setQueries(s)}onSubscribe(){this.listeners.size===1&&n(this,p).forEach(e=>{e.subscribe(s=>{y(this,a,B).call(this,e,s)})})}onUnsubscribe(){this.listeners.size||this.destroy()}destroy(){this.listeners=new Set,n(this,p).forEach(e=>{e.destroy()})}setQueries(e,s){c(this,m,e),c(this,Q,s),k.batch(()=>{const t=n(this,p),u=y(this,a,L).call(this,n(this,m));c(this,x,u),u.forEach(o=>o.observer.setOptions(o.defaultedQueryOptions));const r=u.map(o=>o.observer),h=r.map(o=>o.getCurrentResult()),d=r.some((o,E)=>o!==t[E]);t.length===r.length&&!d||(c(this,p,r),c(this,f,h),this.hasListeners()&&(G(t,r).forEach(o=>{o.destroy()}),G(r,t).forEach(o=>{o.subscribe(E=>{y(this,a,B).call(this,o,E)})}),y(this,a,A).call(this)))})}getCurrentResult(){return n(this,f)}getQueries(){return n(this,p).map(e=>e.getCurrentQuery())}getObservers(){return n(this,p)}getOptimisticResult(e,s){const t=y(this,a,L).call(this,e),u=t.map(r=>r.observer.getOptimisticResult(r.defaultedQueryOptions));return[u,r=>y(this,a,H).call(this,r??u,s),()=>y(this,a,P).call(this,u,t)]}},v=new WeakMap,f=new WeakMap,m=new WeakMap,Q=new WeakMap,p=new WeakMap,g=new WeakMap,C=new WeakMap,S=new WeakMap,x=new WeakMap,a=new WeakSet,P=function(e,s){return s.map((t,u)=>{const r=e[u];return t.defaultedQueryOptions.notifyOnChangeProps?r:t.observer.trackResult(r,h=>{s.forEach(d=>{d.observer.trackProp(h)})})})},H=function(e,s){return s?((!n(this,g)||n(this,f)!==n(this,S)||s!==n(this,C))&&(c(this,C,s),c(this,S,n(this,f)),c(this,g,_(n(this,g),s(e)))),n(this,g)):e},L=function(e){const s=new Map(n(this,p).map(u=>[u.options.queryHash,u])),t=[];return e.forEach(u=>{const r=n(this,v).defaultQueryOptions(u),h=s.get(r.queryHash);h?t.push({defaultedQueryOptions:r,observer:h}):t.push({defaultedQueryOptions:r,observer:new K(n(this,v),r)})}),t},B=function(e,s){const t=n(this,p).indexOf(e);t!==-1&&(c(this,f,re(n(this,f),t,s)),y(this,a,A).call(this))},A=function(){var e;if(this.hasListeners()){const s=n(this,g),t=y(this,a,P).call(this,n(this,f),n(this,x)),u=y(this,a,H).call(this,t,(e=n(this,Q))==null?void 0:e.combine);s!==u&&k.batch(()=>{this.listeners.forEach(r=>{r(n(this,f))})})}},J);function ae({queries:i,...e},s){const t=j(),u=W(),r=X(),h=w.useMemo(()=>i.map(l=>{const R=t.defaultQueryOptions(l);return R._optimisticResults=u?"isRestoring":"optimistic",R}),[i,t,u]);h.forEach(l=>{Y(l),Z(l,r)}),$(r);const[d]=w.useState(()=>new ie(t,h,e)),[o,E,N]=d.getOptimisticResult(h,e.combine),U=!u&&e.subscribed!==!1;w.useSyncExternalStore(w.useCallback(l=>U?d.subscribe(k.batchCalls(l)):ee,[d,U]),()=>d.getCurrentResult(),()=>d.getCurrentResult()),w.useEffect(()=>{d.setQueries(h,e)},[h,e,d]);const z=o.some((l,R)=>T(h[R],l))?o.flatMap((l,R)=>{const O=h[R];if(O){const F=new K(t,O);if(T(O,l))return D(O,F,r);se(l,u)&&D(O,F,r)}return[]}):[];if(z.length>0)throw Promise.all(z);const M=o.find((l,R)=>{const O=h[R];return O&&te({result:l,errorResetBoundary:r,throwOnError:O.throwOnError,query:t.getQueryCache().get(O.queryHash),suspense:O.suspense})});if(M!=null&&M.error)throw M.error;return E(N())}export{ae as u};
