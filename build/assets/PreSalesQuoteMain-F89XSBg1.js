import{j as e,B as j,t as u,u as _,a as z,d as B,r as m,O as G,M as I}from"./index-BAM0eJUz.js";import{u as w}from"./useDebounce-DSMcRuVp.js";import{S as H}from"./StageGuide-e28gQ0h1.js";import{d as T}from"./dateFormator-BGKi5rfZ.js";import{u as $,a as V,b as J,c as K,C as U}from"./CreatePreSalesQuoteModal-BcsPeec9.js";import"./useInfiniteQuery-BGz0VllC.js";import"./Input-1UBXZqEj.js";const W=({data:l,index:p,onView:b})=>{var g;const i=$(),x=V(),h=async(s,c)=>{var o,d;s.stopPropagation();try{await i.mutateAsync(c),u({title:"Success",description:"Quote deleted successfully"})}catch(a){u({title:"Error",description:((d=(o=a==null?void 0:a.response)==null?void 0:o.data)==null?void 0:d.message)||(a==null?void 0:a.message)||"Failed to delete the quote",variant:"destructive"})}},f=async(s,c)=>{var o,d;s.stopPropagation();try{await x.mutateAsync(c),u({title:"Success",description:"Quote cloned successfully"})}catch(a){u({title:"Error",description:((d=(o=a==null?void 0:a.response)==null?void 0:o.data)==null?void 0:d.message)||(a==null?void 0:a.message)||"Failed to clone the quote",variant:"destructive"})}};return e.jsxs("div",{onClick:b,className:"grid grid-cols-11 border-b-gray-200 gap-4 px-6 py-4 hover:bg-blue-50/30 transition-colors cursor-pointer items-center group",children:[e.jsx("div",{className:"col-span-1 text-center text-gray-400 font-medium text-sm",children:p+1}),e.jsx("div",{className:"col-span-2",children:e.jsx("span",{className:"font-mono text-xs font-bold text-blue-700 bg-blue-50 px-2 py-1 rounded border border-blue-100",children:l.quoteNo||"QT-0000"})}),e.jsx("div",{className:"col-span-2",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold text-gray-900 truncate text-sm",children:(l==null?void 0:l.mainQuoteName)||"N/A"}),e.jsxs("span",{className:"text-[10px] text-gray-500 italic",children:["Created: ",T(l.createdAt)]})]})}),e.jsxs("div",{className:"col-span-2 text-center text-sm font-medium text-gray-600",children:[l.carpetArea||0," sqft"]}),e.jsxs("div",{className:"col-span-2 text-center font-bold text-gray-800 text-sm",children:["₹",((g=l.totalAmount)==null?void 0:g.toLocaleString("en-IN"))||"0"]}),e.jsxs("div",{className:"col-span-2 text-center flex justify-center gap-6",children:[e.jsx(j,{variant:"secondary",size:"sm",disabled:x.isPending,onClick:s=>f(s,l._id),children:x!=null&&x.isPending?e.jsx("i",{className:"fas fa-circle-notch fa-spin text-xs"}):e.jsx("i",{className:"fas fa-clone text-xs"})}),e.jsx(j,{variant:"danger",disabled:i.isPending,onClick:s=>h(s,l._id),size:"sm",children:i!=null&&i.isPending?e.jsx("i",{className:"fas fa-circle-notch fa-spin text-xs"}):e.jsx("i",{className:"fas fa-trash-alt text-xs"})})]})]})},re=()=>{const{organizationId:l}=_(),p=z(),b=B(),i=m.useRef(null),[x,h]=m.useState(!1),[f,g]=m.useState({mainQuoteName:""}),[s,c]=m.useState({status:"",search:"",startDate:"",endDate:""}),o=w(s.search,800),d=w(s.startDate,800),a=w(s.endDate,800),P=m.useMemo(()=>({status:s.status,startDate:d,endDate:a,search:o}),[s.status,o,d,a]),{data:N,fetchNextPage:S,hasNextPage:C,isFetchingNextPage:v,isLoading:Q,isError:F,error:y,refetch:E}=J(l,P),{mutateAsync:A,isPending:k}=K(),M=async()=>{var t,r;f.mainQuoteName||u({title:"Error",description:"Please enter  quote name",variant:"destructive"});try{const n=await A({organizationId:l,mainQuoteName:f.mainQuoteName,status:"draft"});console.log("response",n),p(`single/${n.data._id}`),h(!1),g({mainQuoteName:""})}catch(n){u({title:"Error",description:((r=(t=n==null?void 0:n.response)==null?void 0:t.data)==null?void 0:r.message)||(n==null?void 0:n.message)||"failed to create",variant:"destructive"})}};m.useEffect(()=>{const t=i.current;if(!t)return;const r=()=>{const{scrollTop:n,scrollHeight:q,clientHeight:R}=t;q-n-R<100&&C&&!v&&S()};return t.addEventListener("scroll",r),()=>t.removeEventListener("scroll",r)},[C,v,S]);const L=[s.status,s.startDate,s.endDate].filter(Boolean).length+(s.search?1:0),O=()=>{c({status:"",search:"",startDate:"",endDate:""})},D=(N==null?void 0:N.pages.flatMap(t=>t.data))||[];return b.pathname.includes("single")||b.pathname.includes("create")?e.jsx(G,{}):e.jsxs("div",{className:"p-2 space-y-4 h-full relative",children:[x&&e.jsx(U,{formData:f,setFormData:g,isEditing:!1,setModalOpen:h,handleSubmit:M,isSubmitting:k}),e.jsxs("header",{className:"flex justify-between items-center pb-2",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-file-invoice mr-3 text-blue-600"}),"Pre-Sales Quotations"]}),e.jsx("p",{className:"text-gray-600 mt-1 text-sm",children:"Generate and manage initial technical audits and client estimations"})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(H,{organizationId:l,stageName:"presales"}),e.jsxs(j,{variant:"primary",onClick:()=>h(!0),children:[e.jsx("i",{className:"fas fa-plus mr-2"}),"Create Quote"]})]})]}),Q?e.jsx(I,{}):F?e.jsxs("div",{className:"max-w-xl mx-auto mt-4 p-6 bg-red-50 border border-red-200 rounded-xl text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2 text-xl",children:"⚠️ Error Occurred"}),e.jsx("p",{className:"text-red-500 mb-4",children:(y==null?void 0:y.message)||"Failed to load data"}),e.jsx(j,{onClick:()=>E(),className:"bg-red-600 text-white px-4 py-2",children:"Retry"})]}):e.jsxs("main",{className:"flex gap-4 h-[calc(100%-90px)]",children:[e.jsx("div",{className:"xl:w-72 w-64 flex-shrink-0 overflow-y-auto custom-scrollbar",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-5 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-filter mr-2 text-blue-600"}),"Filters"]}),L>0&&e.jsx("button",{onClick:O,className:"text-sm text-blue-600 cursor-pointer hover:text-blue-800 font-medium",children:"Clear All"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Search"}),e.jsx("input",{type:"text",placeholder:"Search Client Name, No",value:s.search,onChange:t=>c(r=>({...r,search:t.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date Range"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"date",value:s.startDate,onChange:t=>c(r=>({...r,startDate:t.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm"}),e.jsx("input",{type:"date",value:s.endDate,onChange:t=>c(r=>({...r,endDate:t.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm"})]})]})]})]})}),e.jsx("div",{className:"flex-1 flex flex-col min-w-0",children:D.length===0?e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center bg-white rounded-xl border border-gray-200 text-center p-6",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-50 rounded-full flex items-center justify-center mb-4",children:e.jsx("i",{className:"fas fa-calculator text-3xl text-blue-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"No Quotations Found"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Create your first pre-sales audit to see it here."})]}):e.jsxs("div",{ref:i,className:"flex-1 bg-white rounded-xl shadow-sm border border-gray-200 overflow-y-auto custom-scrollbar flex flex-col",children:[e.jsx("div",{className:"sticky top-0 z-10 bg-white border-b border-blue-200 shadow-sm",children:e.jsxs("div",{className:"grid grid-cols-11 gap-4 px-6 py-4 bg-gradient-to-r from-blue-50 to-indigo-50 font-semibold text-gray-700 text-sm uppercase tracking-wider",children:[e.jsx("div",{className:"col-span-1 text-center",children:"#"}),e.jsx("div",{className:"col-span-2",children:"Quote No"}),e.jsx("div",{className:"col-span-2",children:"Quote Name"}),e.jsx("div",{className:"col-span-2 text-center",children:"Area (sqft)"}),e.jsx("div",{className:"col-span-2 text-center",children:"Amount"}),e.jsx("div",{className:"col-span-2 text-center",children:"Action"})]})}),e.jsx("div",{className:"divide-y divide-gray-100",children:D.map((t,r)=>e.jsx(W,{data:t,index:r,onView:()=>p(`single/${t._id}`)},t._id))}),v&&e.jsxs("div",{className:"flex justify-center py-6 bg-gray-50",children:[e.jsx("i",{className:"fas fa-spinner fa-spin text-blue-600 mr-2"}),e.jsx("span",{className:"text-sm",children:"Loading more..."})]})]})})]})]})};export{re as default};
