import{b as m,d as z,h,e as f,g as p,u as K,a as T,r as g,j as e,B as u,t as d}from"./index-DCvjwNGU.js";import{C as v}from"./Card-D6Sc2MI-.js";import{d as _}from"./dateFormator-BKpEn5i3.js";import B from"./MaterialOverviewLoading-DwCp8CV2.js";import"./Skeleton-C14joy6B.js";const G=async(n,a)=>(await a.get(`/paymentconfirmation/getschedule/${n}`)).data.data,H=async({projectId:n,dueDate:a,api:i})=>(await i.put(`/paymentconfirmation/dueDate/${n}`,{dueDate:a})).data.data,J=async({projectId:n,status:a,api:i})=>(await i.put(`/paymentconfirmation/clientapprovalstatus/${n}`,{status:a})).data.data,V=async({projectId:n,notes:a,api:i})=>(await i.put(`/paymentconfirmation/clientnotes/${n}`,{notes:a})).data.data,W=async({projectId:n,status:a,api:i})=>(await i.put(`/paymentconfirmation/mdapprovalstatus/${n}`,{status:a})).data.data,X=async({projectId:n,notes:a,api:i})=>(await i.put(`/paymentconfirmation/mdnotes/${n}`,{notes:a})).data.data,Y=n=>{const a=["owner","staff","CTO","client"],{role:i}=m(),s=p(i);return z({queryKey:["payment-schedule",n],queryFn:async()=>{if(!i||!a.includes(i))throw new Error("Not allowed to fetch payment schedule");if(!s)throw new Error("API instance missing");return await G(n,s)},enabled:!!n&&!!i,retry:!1,refetchOnMount:!1})},Z=()=>{const n=["CTO","owner","staff"],{role:a}=m(),i=p(a),s=h();return f({mutationFn:async({projectId:l,dueDate:r})=>{if(!a||!n.includes(a))throw new Error("Not allowed");if(!i)throw new Error("API instance missing");return await H({projectId:l,dueDate:r,api:i})},onSuccess:(l,{projectId:r})=>{s.invalidateQueries({queryKey:["payment-confirmation",r]})}})},ee=()=>{const n=["client","owner","staff","CTO"],{role:a}=m(),i=p(a),s=h();return f({mutationFn:async({projectId:l,status:r})=>{if(!a||!n.includes(a))throw new Error("Not allowed");if(!i)throw new Error("API instance missing");return await J({projectId:l,status:r,api:i})},onSuccess:(l,{projectId:r})=>{s.invalidateQueries({queryKey:["payment-schedule",r]})}})},te=()=>{const n=["client","owner","staff","CTO"],{role:a}=m(),i=p(a),s=h();return f({mutationFn:async({projectId:l,notes:r})=>{if(!a||!n.includes(a))throw new Error("Not allowed");if(!i)throw new Error("API instance missing");return await V({projectId:l,notes:r,api:i})},onSuccess:(l,{projectId:r})=>{s.invalidateQueries({queryKey:["payment-schedule",r]})}})},se=()=>{const n=["owner","staff","CTO"],{role:a}=m(),i=p(a),s=h();return f({mutationFn:async({projectId:l,status:r})=>{if(!a||!n.includes(a))throw new Error("Not allowed");if(!i)throw new Error("API instance missing");return await W({projectId:l,status:r,api:i})},onSuccess:(l,{projectId:r})=>{s.invalidateQueries({queryKey:["payment-schedule",r]})}})},ae=()=>{const n=["owner","staff","CTO"],{role:a}=m(),i=p(a),s=h();return f({mutationFn:async({projectId:l,notes:r})=>{if(!a||!n.includes(a))throw new Error("Not allowed");if(!i)throw new Error("API instance missing");return await X({projectId:l,notes:r,api:i})},onSuccess:(l,{projectId:r})=>{s.invalidateQueries({queryKey:["payment-schedule",r]})}})},F=["pending","approved","rejected"],ce=()=>{var P,k;const{projectId:n,organizationId:a}=K(),i=T(),{data:s,isLoading:l,error:r,refetch:N}=Y(n),y=ee(),j=te(),w=se(),S=ae(),[C,q]=g.useState(""),[D,O]=g.useState(""),[E,A]=g.useState(s==null?void 0:s.dueDate),[U,b]=g.useState(!1),M=Z(),R=async()=>{var t,o;try{await M.mutateAsync({projectId:n,dueDate:E}),N(),d({title:"Success",description:"Due date updated successfully."}),b(!1)}catch(c){d({title:"Error",description:((o=(t=c==null?void 0:c.response)==null?void 0:t.data)==null?void 0:o.message)||c.message||"Failed to update due date.",variant:"destructive"})}},$=t=>{y.mutate({projectId:n,status:t},{onSuccess:()=>d({title:"Success",description:"Client approval status updated."}),onError:o=>{var c,x;return d({title:"Error",description:((x=(c=o==null?void 0:o.response)==null?void 0:c.data)==null?void 0:x.message)||o.message||"Failed to update client status",variant:"destructive"})}})},I=t=>{w.mutate({projectId:n,status:t},{onSuccess:()=>d({title:"Success",description:"MD approval status updated."}),onError:o=>{var c,x;return d({title:"Error",description:((x=(c=o==null?void 0:o.response)==null?void 0:c.data)==null?void 0:x.message)||o.message||"Failed to update MD status",variant:"destructive"})}})},L=()=>{j.mutate({projectId:n,notes:C},{onSuccess:()=>d({title:"Success",description:"Client note updated."}),onError:t=>{var o,c;return d({title:"Error",description:((c=(o=t==null?void 0:t.response)==null?void 0:o.data)==null?void 0:c.message)||t.message||"Failed to update notes",variant:"destructive"})}})},Q=()=>{S.mutate({projectId:n,notes:D},{onSuccess:()=>d({title:"Success",description:"MD note updated."}),onError:t=>{var o,c;return d({title:"Error",description:((c=(o=t==null?void 0:t.response)==null?void 0:o.data)==null?void 0:c.message)||t.message||"Failed to update notes",variant:"destructive"})}})};return l?e.jsx("p",{children:e.jsx(B,{})}):r?e.jsxs("div",{className:"max-w-xl mx-auto mt-12 p-6 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 text-xl font-semibold mb-2",children:"⚠️ Oops! An Error Occurred"}),e.jsx("p",{className:"text-red-500 text-sm mb-4",children:((k=(P=r==null?void 0:r.response)==null?void 0:P.data)==null?void 0:k.message)||(r==null?void 0:r.message)||"Failed to load, please try again"}),e.jsx(u,{onClick:()=>N(),isLoading:l,className:"bg-red-600 text-white hover:bg-red-700",children:"Retry"})]}):e.jsxs("div",{className:"w-full max-w-full max-h-full overflow-y-auto custom-scrollbar mx-auto space-y-6 px-4 py-6",children:[e.jsxs("div",{className:"w-full justify-between flex",children:[e.jsxs("h2",{className:"text-2xl font-bold text-blue-800 flex items-center gap-2",children:[e.jsx("i",{className:"fa-regular fa-calendar-check text-blue-600"}),e.jsx("span",{className:"hidden sm:inline",children:"  Step 2: Payment Schedule Approval"}),e.jsx("span",{className:"inline sm:hidden",children:"  Payment Schedule"})]}),e.jsx(u,{variant:"primary",onClick:()=>i(`/${a}/projectdetails/${n}/paymentconfirmation`),children:"Back"})]}),e.jsx(v,{className:"p-4 border border-gray-200 shadow-sm rounded mb-6",children:e.jsxs("div",{className:"flex justify-between items-center flex-wrap gap-4",children:[e.jsxs("h3",{className:"font-semibold text-blue-700 text-lg flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-calendar-days"})," Payment Due Date"]}),U?e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("input",{type:"date",value:E,onChange:t=>A(t.target.value),className:"border rounded px-3 py-1 text-sm"}),e.jsxs(u,{size:"sm",onClick:R,isLoading:M.isPending,className:"bg-green-600 hover:bg-green-700 text-white px-3 py-1",children:[e.jsx("i",{className:"fa-solid fa-check mr-2"}),"Save"]}),e.jsxs(u,{size:"sm",onClick:()=>{var t;A((t=s==null?void 0:s.dueDate)==null?void 0:t.slice(0,10)),b(!1)},variant:"outline",className:"px-3 py-1",children:[e.jsx("i",{className:"fa-solid fa-xmark mr-1"}),"Cancel"]})]}):e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-md font-medium text-gray-800",children:s!=null&&s.dueDate?_(s==null?void 0:s.dueDate):"Not set"}),e.jsxs(u,{size:"sm",onClick:()=>b(!0),className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1",children:[e.jsx("i",{className:"fa-regular fa-pen-to-square mr-2"}),"Edit"]})]})]})}),e.jsxs(v,{className:"p-5 space-y-4 shadow-md border border-gray-200",children:[e.jsxs("div",{className:"flex sm:justify-between sm:items-center sm:flex-row flex-col sm:mb-0  mb-1 items-start",children:[e.jsxs("h3",{className:"text-lg font-semibold text-blue-700 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-user"})," Client Approval"]}),e.jsx("div",{className:"flex items-center gap-2",children:F.map(t=>{var o;return e.jsx(u,{isLoading:y.isPending&&((o=y.variables)==null?void 0:o.status)===t,size:"sm",onClick:()=>$(t),className:`text-white text-xs ${s.clientApprovalStatus===t?"bg-blue-800":"bg-blue-600 hover:bg-blue-700"}`,children:t.toUpperCase()},t)})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Current Status:"}),e.jsx("div",{className:"rounded bg-gray-100 px-4 py-2 text-sm text-blue-900 border",children:s.clientApprovalStatus.toUpperCase()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mt-4 mb-1",children:"Existing Notes:"}),e.jsx("div",{className:"bg-gray-50 p-3 text-sm rounded border text-gray-800",children:s.clientNotes||"No notes added yet"})]}),e.jsxs("div",{children:[e.jsx("textarea",{className:"w-full mt-3 p-2 border rounded-md text-sm",placeholder:"Add client notes...",value:C,onChange:t=>q(t.target.value),rows:3}),e.jsxs(u,{onClick:L,isLoading:j.isPending,className:"bg-blue-600 hover:bg-blue-700 text-white mt-2",children:[e.jsx("i",{className:"fa-regular fa-floppy-disk mr-2"}),"Save Client Notes"]})]})]}),e.jsxs(v,{className:"p-5 space-y-4 shadow-md border border-gray-200",children:[e.jsxs("div",{className:"flex sm:justify-between sm:items-center sm:flex-row flex-col sm:mb-0  mb-1 items-start",children:[e.jsxs("h3",{className:"text-lg font-semibold text-blue-700 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-user-tie"})," MD Approval"]}),e.jsx("div",{className:"flex items-center gap-2",children:F.map(t=>{var o;return e.jsx(u,{isLoading:w.isPending&&((o=w.variables)==null?void 0:o.status)===t,size:"sm",onClick:()=>I(t),className:`text-white text-xs ${s.mdApprovalStatus===t?"bg-blue-800":"bg-blue-600 hover:bg-blue-700"}`,children:t.toUpperCase()},t)})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Current Status:"}),e.jsx("div",{className:"rounded bg-gray-100 px-4 py-2 text-sm text-blue-900 border",children:s.mdApprovalStatus.toUpperCase()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mt-4 mb-1",children:"Existing Notes:"}),e.jsx("div",{className:"bg-gray-50 p-3 text-sm rounded border text-gray-800",children:s.mdNotes||"No notes added yet"})]}),e.jsxs("div",{children:[e.jsx("textarea",{className:"w-full mt-3 p-2 border rounded-md text-sm",placeholder:"Add MD notes...",value:D,onChange:t=>O(t.target.value),rows:3}),e.jsxs(u,{onClick:Q,isLoading:S.isPending,className:"bg-blue-600 hover:bg-blue-700 text-white mt-2",children:[e.jsx("i",{className:"fa-regular fa-floppy-disk mr-2"}),"Save MD Notes"]})]})]})]})};export{ce as default};
