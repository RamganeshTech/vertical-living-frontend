import{r as l,j as e,N as ue,u as pe,a as he,b as fe,R as ge}from"./index-BZjlY-2Z.js";import{a as Ne,b as de,c as be}from"./quoteVariantApi-CJs8RJxN.js";import{B as je}from"./Button-BGBzZFjk.js";import ye from"./MaterialOverviewLoading-C38kMtqM.js";import{t as ie}from"./toast-BSC5QTk1.js";import{d as Se}from"./downloadFile-Ck0ndJgl.js";import{C as ae}from"./Card-CmzT6E3j.js";import{e as Te}from"./labourRateconfigApi-H3o7UAb9.js";import"./useQuery-Coz1VCY2.js";import"./useMutation-BRRIqsxx.js";import"./roleCheck-DuKNZHKs.js";import"./Skeleton-BnQtABYA.js";const ne=({options:a,placeholder:q="Select an option",searchPlaceholder:L="Search...",onSelect:u,selectedValue:w,className:E=""})=>{const[W,R]=l.useState(!1),[P,j]=l.useState(""),[O,p]=l.useState(null),k=l.useRef(null),y=a.filter(f=>f.toLowerCase().includes(P.toLowerCase()));l.useEffect(()=>{const f=F=>{k.current&&!k.current.contains(F.target)&&R(!1)};return document.addEventListener("mousedown",f),()=>document.removeEventListener("mousedown",f)},[]),l.useEffect(()=>{if(w){const f=a.find(F=>F===w);p(f||null)}else p(null)},[w,a]);const B=f=>{p(f),u(f),R(!1),j("")},V=()=>{R(!0),j("")},$=f=>{j(f.target.value)};return e.jsxs("div",{className:`relative ${E}`,ref:k,children:[e.jsxs("div",{className:"w-full p-3 border border-gray-300 rounded-lg bg-white cursor-pointer hover:border-gray-400 transition-colors",onClick:V,children:[O?e.jsx("span",{className:"text-gray-800",children:O}):e.jsx("span",{className:"text-gray-500",children:q}),e.jsx("span",{className:"absolute right-3 top-3 text-gray-400",children:"▼"})]}),W&&e.jsxs("div",{className:"absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-auto",children:[e.jsx("div",{className:"p-2 border-b border-gray-200",children:e.jsx("input",{type:"text",placeholder:L,value:P,onChange:$,className:"w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0})}),e.jsx("div",{className:"py-1",children:y.length>0?y.map(f=>e.jsx("div",{className:`px-4 py-2 cursor-pointer hover:bg-gray-100 transition-colors ${O===f?"bg-blue-50 text-blue-600":""}`,onClick:()=>B(f),children:f},f)):e.jsx("div",{className:"px-4 py-2 text-gray-500 text-center",children:"No options found"})})]})]})},J=(a,q,L)=>{const u=String(a).toLowerCase().replace("mm","").trim(),w=q.find(E=>String(E.thickness).toLowerCase().replace("mm","").trim()===u);return(w==null?void 0:w.rs)!==void 0?w.rs:L==="laminate"?Me:0},ve=l.forwardRef(({data:a,index:q,brandOptions:L,laminateBrandOptions:u,laminateRatesByBrand:w,brandRatesByName:E,labourCost:W,selectedBrand:R,selectedLaminateBrand:P,onFurnitureChange:j},O)=>{var o,h;const[p,k]=l.useState(null),[y,B]=l.useState(null),V=p?E[p]||[]:[],$=y?w[y]||[]:[],f=l.useRef(P),F=l.useRef(R),[b,_]=l.useState((a==null?void 0:a.coreMaterials)||[]),[C,D]=l.useState((a==null?void 0:a.fittingsAndAccessories)||[]),[A,U]=l.useState((a==null?void 0:a.glues)||[]),[z,H]=l.useState((a==null?void 0:a.nonBrandMaterials)||[]);l.useEffect(()=>{_((a==null?void 0:a.coreMaterials)||[])},[a==null?void 0:a.coreMaterials]),l.useEffect(()=>{F.current!==R&&(k(R),F.current=R)},[R]),l.useEffect(()=>{f.current!==P&&(B(P),f.current=P)},[P]),l.useEffect(()=>{!p&&(L==null?void 0:L.length)>0&&k(L[0])},[L]),l.useEffect(()=>{!y&&(u==null?void 0:u.length)>0&&B(u[0])},[u]);const ce=()=>{let s=0;const r=p?E[p]||[]:[],n=y?w[y]||[]:[],i=b,x=i[0],M=((x==null?void 0:x.carpenters)||0)*((x==null?void 0:x.days)||0)*W,S=i.length>0?M/i.length:0;for(const T of i){const I=J(T.plywoodNos.thickness,r,"plywood"),K=J(T.laminateNos.thickness,n,"laminate"),xe=T.plywoodNos.quantity*32*I,me=T.laminateNos.quantity*32*K;s+=xe+me+S}const v=T=>(T.quantity||0)*(T.cost||0),N=T=>T.cost||0,d=a.fittingsAndAccessories.reduce((T,I)=>T+v(I),0),g=a.glues.reduce((T,I)=>T+N(I),0),Q=a.nonBrandMaterials.reduce((T,I)=>T+v(I),0);return s+=d+g+Q,Math.round(s)},G=(t,s)=>{if(!y&&!y)return t.rowTotal||0;const n=J(t.plywoodNos.thickness,V,"plywood"),i=J(t.laminateNos.thickness,$,"laminate");console.log("ply Rate",n),console.log("lami Rate",i);const x=32,M=t.plywoodNos.quantity*(n*x),S=t.laminateNos.quantity*(i*x);console.log("plyCost",M),console.log("lamiCost",S);const v=M+S;console.log("baseMaterialCost",v);const N=v*(t.profitOnMaterial/100);console.log("profitOnMaterial",N);const d=s.length,g=s[0],I=g.carpenters*g.days*W*(1+(g.profitOnLabour||0)/100)/d,K=v+N+I;return Math.round(K)},X=b.reduce((t,s)=>t+G(s,b),0),Y=C.reduce((t,s)=>{const r=(s.quantity||0)*(s.cost||0),n=r*((s.profitOnMaterial||0)/100);return t+r+n},0),Z=A.reduce((t,s)=>{const r=s.cost||0,n=r*((s.profitOnMaterial||0)/100);return t+r+n},0),ee=z.reduce((t,s)=>{const r=(s.quantity||0)*(s.cost||0),n=r*((s.profitOnMaterial||0)/100);return t+r+n},0),le=X+Y+Z+ee;l.useImperativeHandle(O,()=>({getUpdatedFurniture:()=>{const t=b.map(N=>({...N,rowTotal:G(N,b)})),s=[...C],r=[...A],n=[...z],i=s.reduce((N,d)=>{const g=(d.quantity||0)*(d.cost||0),Q=g*((d.profitOnMaterial||0)/100);return N+g+Q},0),x=r.reduce((N,d)=>{const g=d.cost||0,Q=g*((d.profitOnMaterial||0)/100);return N+g+Q},0),M=n.reduce((N,d)=>{const g=(d.quantity||0)*(d.cost||0),Q=g*((d.profitOnMaterial||0)/100);return N+g+Q},0),S=t.reduce((N,d)=>N+(d.rowTotal||0),0),v=S+i+x+M;return{furnitureName:a.furnitureName,plywoodBrand:p,laminateBrand:y,coreMaterials:b.map(N=>({...N,rowTotal:G(N,b)})),fittingsAndAccessories:s,glues:r,nonBrandMaterials:n,coreMaterialsTotal:S,fittingsAndAccessoriesTotal:i,gluesTotal:x,nonBrandMaterialsTotal:M,furnitureTotal:v,totals:{core:S,fittings:i,glues:x,nbms:M,furnitureTotal:v}}}}));const oe=(t,s)=>{const r=[...b];if(r[t]={...r[t],profitOnMaterial:s||0},_(r),t!==0){j==null||j();return}const n=s,i=(x,M=!1)=>x.map(S=>{const v=M?S.cost||0:(S.quantity||0)*(S.cost||0),N=v*((n||0)/100);return{...S,profitOnMaterial:n,rowTotal:Math.round(v+N)}});D(x=>i(x)),U(x=>i(x,!0)),H(x=>i(x)),j==null||j()},te=t=>{if(!b[0])return;const s=[...b];s[0]={...s[0],profitOnLabour:t||0},_(s),j==null||j()},se=(t,s,r)=>{if(t==="Fittings & Accessories"){const n=[...C],i=(n[s].quantity||0)*(n[s].cost||0),x=i*((r||0)/100);n[s]={...n[s],profitOnMaterial:r,rowTotal:Math.round(i+x)},D(n)}if(t==="Glues"){const n=[...A],i=n[s].cost||0,x=i*((r||0)/100);n[s]={...n[s],profitOnMaterial:r,rowTotal:Math.round(i+x)},U(n)}if(t==="Non-Branded Materials"){const n=[...z],i=(n[s].quantity||0)*(n[s].cost||0),x=i*((r||0)/100);n[s]={...n[s],profitOnMaterial:r,rowTotal:Math.round(i+x)},H(n)}j==null||j()};l.useEffect(()=>{j==null||j()},[p,y,b,a.fittingsAndAccessories,a.glues]);const re=()=>e.jsxs("div",{className:"mt-6",children:[e.jsxs("h3",{className:"font-semibold text-md text-gray-800 mb-2",children:["Core Materials (Total: ₹",X.toLocaleString("en-IN"),")"]}),e.jsx("div",{className:"overflow-x-auto rounded-md",children:e.jsxs("table",{className:"min-w-full text-sm bg-white shadow-sm",children:[e.jsxs("thead",{className:"bg-blue-50 text-sm font-semibold text-gray-600",children:[e.jsxs("tr",{children:[e.jsx("th",{rowSpan:2,className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Image"}),e.jsx("th",{rowSpan:2,className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Item Name"}),e.jsx("th",{colSpan:2,className:"text-center px-6 py-1 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Plywood"}),e.jsx("th",{colSpan:2,className:"text-center px-6 py-1 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Laminate"}),e.jsx("th",{rowSpan:2,className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"No. of Carpenters / Day"}),e.jsx("th",{rowSpan:2,className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"No. of Days"}),e.jsx("th",{rowSpan:2,className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Profit % Material"}),e.jsx("th",{rowSpan:2,className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Profit % Labour"}),e.jsx("th",{rowSpan:2,className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Remarks"}),e.jsx("th",{rowSpan:2,className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),e.jsx("th",{rowSpan:2,className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]}),e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-6 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Qty"}),e.jsx("th",{className:"text-center px-6 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Thk"}),e.jsx("th",{className:"text-center px-6 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Qty"}),e.jsx("th",{className:"text-center px-6 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Thk"})]})]}),e.jsx("tbody",{children:(b==null?void 0:b.length)>0&&(b==null?void 0:b.map((t,s)=>{var n,i,x,M,S,v,N,d;const r=G(t,b);return e.jsxs("tr",{className:"group border",children:[s===0&&e.jsx("td",{rowSpan:(n=a==null?void 0:a.coreMaterials)==null?void 0:n.length,className:"text-center border-r-1 p-2",children:t!=null&&t.imageUrl?e.jsx("img",{src:(t==null?void 0:t.imageUrl)||ue,className:"h-10 mx-auto"}):e.jsx(e.Fragment,{children:"—"})}),e.jsx("td",{className:"text-center border-r-1 p-2",children:(t==null?void 0:t.itemName)||"—"}),e.jsx("td",{className:"text-center border-r-1 p-2",children:((i=t==null?void 0:t.plywoodNos)==null?void 0:i.quantity)??0}),e.jsx("td",{className:"text-center border-r-1 p-2",children:((x=t==null?void 0:t.plywoodNos)==null?void 0:x.thickness)??0}),e.jsx("td",{className:"text-center border-r-1 p-2",children:((M=t==null?void 0:t.laminateNos)==null?void 0:M.quantity)??0}),e.jsx("td",{className:"text-center border-r-1 p-2",children:((S=t==null?void 0:t.laminateNos)==null?void 0:S.thickness)??0}),s===0&&e.jsxs(e.Fragment,{children:[e.jsx("td",{rowSpan:(v=a==null?void 0:a.coreMaterials)==null?void 0:v.length,className:"text-center border-r-1 p-2",children:(t==null?void 0:t.carpenters)||0}),e.jsx("td",{rowSpan:(N=a==null?void 0:a.coreMaterials)==null?void 0:N.length,className:"text-center border-r-1 p-2",children:(t==null?void 0:t.days)||0})]}),e.jsx("td",{className:"text-center border-r-1 p-2",children:e.jsx("input",{type:"number",value:b[s].profitOnMaterial,onChange:g=>oe(s,parseFloat(g.target.value)),className:"w-16 text-center border border-gray-300 rounded px-2 py-1 text-sm"})}),s===0&&e.jsx("td",{rowSpan:(d=a==null?void 0:a.coreMaterials)==null?void 0:d.length,className:"text-center border-r-1 p-2",children:e.jsx("input",{type:"number",value:b[0].profitOnLabour,onChange:g=>te(parseFloat(g.target.value)),className:"w-16 text-center border border-gray-300 rounded px-2 py-1 text-sm"})}),e.jsx("td",{className:"text-center border-r-1 p-2",children:(t==null?void 0:t.remarks)||"—"}),e.jsxs("td",{className:"text-center border-r-1 p-2 text-green-700 font-bold",children:["₹",r==null?void 0:r.toLocaleString("en-IN")]}),e.jsx("td",{className:"text-center border-r-1 p-2",children:"—"})]},s)}))})]})})]}),m=t=>t==="Fittings & Accessories"?Math.round(Y):t==="Glues"?Math.round(Z):t==="Non-Branded Materials"?Math.round(ee):0,c=(t,s)=>e.jsxs("div",{className:"mt-4",children:[e.jsxs("h3",{className:"font-semibold text-md mb-2 text-gray-800",children:[t,"(Total: ₹",m(t).toLocaleString("en-IN"),")"]}),e.jsxs("table",{className:"min-w-full text-sm bg-white shadow-sm",children:[e.jsx("thead",{className:"bg-blue-50 text-sm font-semibold text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Item Name"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Description"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Quantity"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Cost"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Profit On Materials"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{children:s.length>0&&s.map((r,n)=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"text-center border p-2",children:(r==null?void 0:r.itemName)||"—"}),e.jsx("td",{className:"text-center border p-2",children:(r==null?void 0:r.description)||"—"}),e.jsx("td",{className:"text-center border p-2",children:(r==null?void 0:r.quantity)||0}),e.jsx("td",{className:"text-center border p-2",children:(r==null?void 0:r.cost)||0}),e.jsx("td",{className:"text-center border p-2",children:e.jsx("input",{type:"number",value:r.profitOnMaterial||0,onChange:i=>se(t,n,parseFloat(i.target.value)),className:"w-16 text-center border border-gray-300 rounded px-2 py-1 text-sm"})}),e.jsxs("td",{className:"text-center border p-2 text-green-700 font-bold",children:["₹",(r.rowTotal||0).toLocaleString("en-IN")]}),e.jsx("td",{className:"text-center border p-2",children:"—"})]},n))})]})]});return e.jsxs("div",{className:"shadow-md p-4 my-4 border rounded-lg bg-white",children:[e.jsxs("div",{className:" flex justify-between items-center",children:[e.jsxs("h2",{className:"text-xl font-semibold  text-blue-600",children:["Product ",q+1,": ",a.furnitureName]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-right text-xl font-bold text-green-700",children:["Product Total: ₹",le.toLocaleString("en-IN")]}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Raw Cost (no profit)"}),e.jsxs("p",{className:"text-lg font-semibold text-blue-700",children:["₹",ce().toLocaleString("en-IN")]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"font-medium text-gray-700",children:"Select Plwyood Brand:"}),e.jsx(ne,{options:L,placeholder:"-- Choose Plwyood Brand --",searchPlaceholder:"Search Plywood brands...",onSelect:k,selectedValue:p||"",className:"mt-1"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"font-medium text-gray-700",children:"Select Laminate Brand:"}),e.jsx(ne,{options:u,placeholder:"-- Choose Laminate Brand --",searchPlaceholder:"Search laminate brands...",onSelect:B,selectedValue:y||"",className:"mt-1"})]})]}),e.jsxs("div",{children:[p&&((o=E[p])==null?void 0:o.length)>0&&e.jsxs("div",{className:"mt-6 border border-gray-200 bg-white rounded-md shadow-sm p-4",children:[e.jsxs("h3",{className:"text-md font-semibold text-gray-800 mb-2",children:["Available Thickness & Rates for ",e.jsx("span",{className:"text-blue-600",children:p})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm text-left border border-gray-100",children:[e.jsx("thead",{className:"bg-blue-50 text-xs text-gray-600 uppercase tracking-wider",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 border-r",children:"Thickness"}),e.jsx("th",{className:"px-4 py-2",children:"Rate (₹/sqft)"})]})}),e.jsx("tbody",{children:E[p].map((t,s)=>e.jsxs("tr",{className:"border-t border-gray-100",children:[e.jsx("td",{className:"px-4 py-2 border-r text-gray-700 font-medium",children:t.thickness}),e.jsxs("td",{className:"px-4 py-2 text-green-800 font-bold",children:["₹",t.rs.toFixed(2)]})]},s))})]})})]}),y&&((h=w[y])==null?void 0:h.length)>0&&e.jsxs("div",{className:"mt-4 border bg-white rounded-md shadow-sm p-4",children:[e.jsxs("h3",{className:"text-md font-semibold text-gray-800 mb-2",children:["Laminate Rates for ",e.jsx("span",{className:"text-blue-600",children:y})]}),e.jsxs("table",{className:"min-w-full text-sm border",children:[e.jsx("thead",{className:"bg-blue-50 text-xs text-gray-600 uppercase",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 border-r",children:"Thickness"}),e.jsx("th",{className:"px-4 py-2",children:"Rate (₹/sqft)"})]})}),e.jsx("tbody",{children:w[y].map((t,s)=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-2 border-r font-medium",children:t.thickness}),e.jsxs("td",{className:"px-4 py-2 text-green-800 font-bold",children:["₹",t.rs.toFixed(2)]})]},s))})]})]})]})]}),re(),c("Fittings & Accessories",C),c("Glues",A),c("Non-Branded Materials",z)]})}),Me=0,Qe=()=>{var te,se,re;const{organizationId:a,quoteId:q}=pe(),L=he(),{data:u,isLoading:w}=Ne(a,q);let{data:E,isLoading:W}=de(a,"plywood"),{data:R}=de(a,"Laminate"),{data:P=0}=Te(a);const{mutateAsync:j,isPending:O}=be(),p=l.useRef([]),[k,y]=l.useState(null),[B,V]=l.useState(null),{role:$,permission:f}=fe(),F=$==="owner"||((te=f==null?void 0:f.materialquote)==null?void 0:te.create),b=$==="owner"||((se=f==null?void 0:f.materialquote)==null?void 0:se.edit),_=l.useMemo(()=>{if(!E)return{};const m={};return E.forEach(c=>{const o=(c==null?void 0:c.data)||{},h=o.Brand??o.brand,t=o["thickness (mm)"]||o.thickness||o.Thickness;let s=o.Rs||o.rs;if(h&&t&&s){const r=String(h).trim(),n=String(t).trim(),i=parseFloat(s);m[r]||(m[r]=[]),m[r].push({thickness:n,rs:i})}}),m},[E]),C=l.useMemo(()=>Object.keys(_),[_]),D=l.useMemo(()=>{if(!R)return{};const m={};return R.forEach(c=>{const o=(c==null?void 0:c.data)||{},h=o.Brand??o.brand,t=o["thickness (mm)"]||o.thickness||o.Thickness,s=o.Rs||o.rs;if(h&&t&&s){const r=String(h).trim(),n=String(t).trim(),i=parseFloat(s);m[r]||(m[r]=[]),m[r].push({thickness:n,rs:i})}}),m},[R]),A=l.useMemo(()=>Object.keys(D),[D]),[U,z]=l.useState([]),[H,ce]=l.useState(0),[G,X]=l.useState(0),Y=()=>{const m=p.current.map(o=>o.current).filter(o=>o!==null).map(o=>o.getUpdatedFurniture());console.log("updatedFurnitures",m);const c=m.reduce((o,h)=>o+h.totals.furnitureTotal,0);console.log("total",c),ce(c),X(le())},{profitDifference:Z,profitPercentage:ee}=l.useMemo(()=>{const m=H-G,c=G>0?m/G*100:0;return{profitDifference:Math.round(m),profitPercentage:c}},[H,G]),le=()=>{const m=p.current.map(h=>h.current).filter(h=>h!==null).map(h=>h.getUpdatedFurniture()),c=32;let o=0;return m.forEach(h=>{const t=h.plywoodBrand?_[h.plywoodBrand]||[]:[],s=h.laminateBrand?D[h.laminateBrand]||[]:[],r=h.coreMaterials,n=r[0],i=((n==null?void 0:n.carpenters)||0)*((n==null?void 0:n.days)||0)*P,x=r.length>0?i/r.length:0;r.forEach(d=>{const g=J(d.plywoodNos.thickness,t,"plywood"),Q=J(d.laminateNos.thickness,s,"laminate"),T=d.plywoodNos.quantity*(g*c),I=d.laminateNos.quantity*(Q*c),K=T+I;o+=K+x});const M=d=>d.quantity*d.cost,S=h.fittingsAndAccessories.reduce((d,g)=>d+M(g),0),v=h.glues.reduce((d,g)=>d+(g.cost||0),0),N=h.nonBrandMaterials.reduce((d,g)=>d+M(g),0);o+=S+v+N}),Math.round(o)},oe=async()=>{var m,c;try{if(!a||!q||!u||!k){ie({title:"Missing info",description:"Please ensure brand and all details are selected",variant:"destructive"});return}const o=p.current.map(s=>s.current).filter(s=>s!==null).map(s=>s.getUpdatedFurniture()),h=o.reduce((s,r)=>s+r.totals.furnitureTotal,0),t=await j({quoteId:q,organizationId:a,data:{quoteId:q,organizationId:a,projectId:u.projectId,brandName:k,laminateBrand:B,furnitures:o,grandTotal:h,notes:"Generated with brand variant"}});Se({src:t.url,alt:t.fileName}),ie({title:"success",description:"Successfully created, check it in the Quote for clients section"})}catch(o){ie({title:"Error",description:((c=(m=o==null?void 0:o.response)==null?void 0:m.data)==null?void 0:c.message)??"Operation failed"})}};return l.useEffect(()=>{if(!(u!=null&&u.furnitures))return;const m=u.furnitures.map(c=>({furnitureName:c.furnitureName,coreMaterials:c.coreMaterials||[],fittingsAndAccessories:c.fittingsAndAccessories||[],glues:c.glues||[],nonBrandMaterials:c.nonBrandMaterials||[],totals:{core:c.coreMaterialsTotal||0,fittings:c.fittingsAndAccessoriesTotal||0,glues:c.gluesTotal||0,nbms:c.nonBrandMaterialsTotal||0,furnitureTotal:c.furnitureTotal||0},plywoodBrand:k,laminateBrand:B}));z(m)},[u]),p.current.length!==U.length&&(p.current=U.map((m,c)=>p.current[c]??ge.createRef())),l.useEffect(()=>{console.log("furnitureRefs Array",p),p.current=U.map((m,c)=>p.current[c]??l.createRef())},[U]),l.useEffect(()=>{!k&&(C==null?void 0:C.length)>0&&y(C[0])},[C]),l.useEffect(()=>{!B&&(A==null?void 0:A.length)>0&&V(A[0])},[A]),e.jsxs("div",{className:"p-2 max-h-full overflow-y-auto",children:[e.jsxs("header",{className:"bg-white border-b border-gray-200 pb-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("button",{onClick:()=>L(-1),className:"flex items-center justify-center w-8 h-8 bg-gray-50 hover:bg-gray-100 border border-gray-300 rounded-md transition-colors flex-shrink-0",children:e.jsx("i",{className:"fas fa-arrow-left text-gray-600 text-sm"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900 truncate",children:((re=u==null?void 0:u.projectId)==null?void 0:re.projectName)||"Project"}),e.jsx("p",{className:"text-md text-gray-500",children:u!=null&&u.quoteNo?`Quote: #${u==null?void 0:u.quoteNo}`:""})]})]}),(F||b)&&e.jsx(je,{onClick:oe,disabled:O,className:"flex-shrink-0",children:O?"Generating...":"Generate Quote for Client"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 whitespace-nowrap",children:"Plywood Brand:"}),e.jsx(ne,{options:C,placeholder:"Select Plywood Brand",searchPlaceholder:"Search brands...",onSelect:y,selectedValue:k||"",className:"flex-1"})]})}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 whitespace-nowrap",children:"Laminate Brand:"}),e.jsx(ne,{options:A,placeholder:"Select Laminate Brand",searchPlaceholder:"Search brands...",onSelect:V,selectedValue:B||"",className:"flex-1"})]})})]}),e.jsxs("div",{className:" grid grid-cols-4 gap-2",children:[e.jsx(ae,{className:"px-2 py-4 border-l-4 border-blue-600",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-md text-gray-600",children:["Project Cost "," "," ",e.jsx("span",{className:"font-bold",children:"(without profit)"})]}),e.jsxs("p",{className:"text-md font-bold text-blue-600",children:["₹",G.toLocaleString("en-IN")]})]})}),e.jsx(ae,{className:"px-2 py-4 border-l-4 border-green-600",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-md text-gray-600",children:["Client Quote Amount "," "," ",e.jsx("span",{className:"font-bold",children:"(with profit)"})]}),e.jsxs("p",{className:"text-md font-bold text-green-600",children:["₹",H.toLocaleString("en-IN")]})]})}),e.jsx(ae,{className:"px-2 py-4 border-l-4 border-violet-600",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-md text-gray-600",children:"Profit Amount"}),e.jsxs("p",{className:"text-md font-bold text-violet-600",children:["₹",Z.toLocaleString("en-IN")," ",e.jsxs("span",{className:"text-black !text-[12px] ml-[5px] font-semibold",children:["(",ee.toFixed(2),"%)"]})]})]})}),e.jsx(ae,{className:"px-2 py-4 border-l-4 border-orange-600",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-md text-gray-600",children:"Single Labour Cost"}),e.jsxs("p",{className:"text-md font-bold text-orange-600",children:["₹",P]})]})})]})]}),w||W?e.jsx(ye,{}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-6",children:[U.map((m,c)=>e.jsx(ve,{index:c,data:m,labourCost:P,ref:p.current[c],laminateRatesByBrand:D,brandRatesByName:_,selectedBrand:k,selectedLaminateBrand:B,brandOptions:C,laminateBrandOptions:A,onFurnitureChange:Y},c)),e.jsx("div",{className:"mt-10 text-right",children:e.jsxs("div",{className:"inline-block bg-green-50 border border-green-200 rounded-md px-6 py-4",children:[e.jsx("p",{className:"text-md font-medium text-gray-700 mb-1",children:"Total Estimate"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700",children:["₹",H.toLocaleString("en-IN")]})]})})]})})]})};export{Me as DEFAULT_LAMINATE_RATE_PER_SQFT,Qe as default};
