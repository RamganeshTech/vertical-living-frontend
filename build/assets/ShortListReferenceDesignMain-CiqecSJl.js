import{g as f,q as E,u as B,b as J,r as g,j as e}from"./index-BYTWf4fI.js";import{u as z}from"./useQuery-DFVFWtWl.js";import{u as I}from"./useMutation-sTZCeqmg.js";import{g as u}from"./roleCheck-DhBlwT6t.js";import{t as m}from"./toast-BSC5QTk1.js";import{I as K}from"./ImageGalleryMain-BTDqHC1K.js";import M from"./MaterialOverviewLoading-DkmRHaSw.js";import{C as Q,b as U,d as _,a as H}from"./Card-ClDlfbss.js";import{B as D}from"./Button-aRmNljle.js";import{S as V,f as X}from"./ShortListMain-WU-EGUb_.js";import{S as Y}from"./StageGuide-CqeeYR2U.js";import"./constants-4IFJeChr.js";import"./downloadFile-DFN4JXcx.js";import"./index-CofIYY6b.js";import"./Skeleton-Bc8D3KPj.js";const Z=async({organizationId:r,formData:s,api:t})=>{const{data:n}=await t.post(`/shortlist/referencedesign/${r}/uploaddesign`,s);if(!n.ok)throw new Error(n.message);return n},ee=async({organizationId:r,api:s})=>{const{data:t}=await s.get(`/shortlist/referencedesign/getdesigns/${r}`);if(!t.ok)throw new Error(t.message);return t.data},se=async({organizationId:r,imageId:s,api:t})=>{const{data:n}=await t.delete(`/shortlist/referencedesign/deletedesign/${r}/${s}`);if(!n.ok)throw new Error(n.message);return n},te=()=>{const r=["owner","staff","CTO"],{role:s}=f(),t=u(s);return I({mutationFn:async({organizationId:n,formData:o})=>{if(!s||!r.includes(s))throw new Error("Not authorized");if(!t)throw new Error("API instance missing");return await Z({organizationId:n,formData:o,api:t})},onSuccess:(n,{organizationId:o})=>{E.invalidateQueries({queryKey:["referenceDesigns",o]})}})},ae=({organizationId:r})=>{const s=["owner","staff","CTO","client"],{role:t}=f(),n=u(t);return z({queryKey:["referenceDesigns",r],queryFn:async()=>{if(!t||!s.includes(t))throw new Error("Not authorized");if(!n)throw new Error("API instance missing");return await ee({organizationId:r,api:n})},enabled:!!r,retry:!1,refetchOnWindowFocus:!1})},re=()=>{const r=["owner","staff","CTO"],{role:s}=f(),t=u(s);return I({mutationFn:async({organizationId:n,imageId:o})=>{if(!s||!r.includes(s))throw new Error("Not authorized");if(!t)throw new Error("API instance missing");return await se({organizationId:n,imageId:o,api:t})},onSuccess:(n,{organizationId:o})=>{E.invalidateQueries({queryKey:["referenceDesigns",o]})}})},ne=["image/jpeg","image/jpg","image/png","image/webp"];function be(){var j,b,v,N;const{organizationId:r}=B(),{data:s,refetch:t,isFetching:n}=ae({organizationId:r}),{role:o,permission:l}=J(),P=o==="owner"||((j=l==null?void 0:l.referencedesign)==null?void 0:j.delete),C=o==="owner"||((b=l==null?void 0:l.referencedesign)==null?void 0:b.list),R=o==="owner"||((v=l==null?void 0:l.referencedesign)==null?void 0:v.create),F=o==="owner"||((N=l==null?void 0:l.referencedesign)==null?void 0:N.create),{mutateAsync:S,isPending:A}=te(),{mutateAsync:G}=re(),p=g.useRef(null),[h,x]=g.useState(!1),[w,k]=g.useState([]),O=i=>{const d=Array.from(i.target.files||[]).filter(a=>ne.includes(a.type));if(d.length===0){m({title:"Error",description:"Please select valid image files (JPG, JPEG, PNG, WEBP)",variant:"destructive"});return}y(d)},y=async i=>{var c,d;try{const a=new FormData;i.forEach($=>{a.append("files",$)}),a.append("tags",JSON.stringify(w)),await S({organizationId:r,formData:a}),m({title:"Success",description:"Image(s) uploaded successfully."})}catch(a){m({title:"Error",description:((d=(c=a==null?void 0:a.response)==null?void 0:c.data)==null?void 0:d.message)||(a==null?void 0:a.message)||"Failed to upload images",variant:"destructive"})}},T=async i=>{var c,d;try{await G({organizationId:r,imageId:i}),m({title:"Success",description:"Image deleted"})}catch(a){m({title:"Error",description:((d=(c=a==null?void 0:a.response)==null?void 0:c.data)==null?void 0:d.message)||(a==null?void 0:a.message)||"Failed to upload images",variant:"destructive"})}},q=i=>{i.preventDefault(),i.stopPropagation(),x(!1)},L=i=>{i.preventDefault(),i.stopPropagation()},W=async i=>{i.preventDefault(),i.stopPropagation(),x(!1);const c=Array.from(i.dataTransfer.files);await y(c)};return e.jsxs("div",{className:"w-full max-h-full mx-auto p-2 overflow-y-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6",children:[e.jsxs("h1",{className:"text-2xl font-semibold text-gray-800",children:[e.jsx("i",{className:"fa-solid fa-object-group text-2xl text-blue-600 mr-2"}),"Reference Designs"]}),e.jsx("div",{className:"w-full sm:w-auto flex justify-end sm:block",children:e.jsx(Y,{organizationId:r,stageName:"referencedesign"})})]}),e.jsxs("div",{className:"mb-5",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Enter Categories"}),e.jsx(V,{tags:w,setState:k,suggestionFetcher:X})]}),(R||F)&&e.jsxs(Q,{className:"",children:[e.jsx(U,{children:e.jsxs(_,{className:"flex items-center justify-between",children:[h?"Drop files here...":"Drag and drop image files here or ",e.jsx(D,{variant:"outline",size:"sm",className:"text-blue-600 bg-transparent",children:A?e.jsxs(e.Fragment,{children:["Loading ",e.jsx("i",{className:"fas fa-spinner ml-2 animate-spin"})]}):"Upload reference images, and can be used to compare in the projects"})]})}),e.jsxs(H,{children:[e.jsx("div",{className:`border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors ${h?"border-blue-400 bg-blue-50":"border-gray-300"}`,onClick:()=>{var i;return(i=p.current)==null?void 0:i.click()},onDragLeave:q,onDragOver:L,onDrop:W,children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-lg font-medium",children:"Drag & drop plan/reference images here or"}),e.jsx(D,{variant:"outline",children:"Browse"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Accepted: JPG/PNG/WebP â€¢ Images auto-saved locally"})]})}),e.jsx("input",{ref:p,type:"file",multiple:!0,accept:"image/*",className:"hidden",onChange:O})]})]}),C&&e.jsxs("div",{className:"mt-5",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-700 mb-3",children:"Images"}),n?e.jsx("div",{className:"text-center text-gray-600",children:e.jsx(M,{})}):s!=null&&s.referenceImages.length?e.jsx(K,{imageFiles:(s==null?void 0:s.referenceImages)||[],refetch:t,height:190,minWidth:156,maxWidth:200,...P?{handleDeleteFile:T}:{}}):e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[300px] w-full bg-white rounded-xl   text-center p-6",children:[e.jsx("i",{className:"fas fa-image text-5xl text-blue-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-1",children:"No Images Found"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Please upload images"})]})]})]})}export{be as default};
