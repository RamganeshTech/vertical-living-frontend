import{a as T,b as D,j as e,B as f,u as F,r as I,c as P,d as z,e as L,f as B,O as E,S as M}from"./index-BO7-A9Kz.js";import{S as x,a as u,b as h,c as j,d as c}from"./Select-DdgOLbVu.js";import{C as G,b as R,c as q,d as H,a as U}from"./Card-f5wWE5lT.js";import Y from"./MaterialOverviewLoading-NvLxL-Rh.js";import"./Skeleton-C-bZXmQ3.js";const $=({task:t})=>{const l=T(),{mutateAsync:i}=D(),p=async r=>{window.confirm("Are you sure you want to delete this task?")&&await i({mainTaskId:r})},d=r=>{l(`single/${r}`)};return e.jsxs(G,{className:"p-0 border-l-4 border-blue-600",children:[e.jsxs(R,{children:[e.jsx(q,{children:t.title}),e.jsx(H,{className:"text-xs mt-1",children:t.description})]}),e.jsxs(U,{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm",children:[e.jsx("i",{className:"fa-solid fa-calendar-days mr-2 text-blue-600"}),"Due: ",new Date(t.due).toLocaleString()]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("i",{className:"fa-solid fa-layer-group mr-2 text-purple-600"}),"Subtasks: ",t.tasks.length]}),e.jsxs("p",{className:"text-sm capitalize",children:[e.jsx("i",{className:"fa-solid fa-star mr-2 text-yellow-500"}),"Priority: ",t.priority]}),e.jsxs("p",{className:"text-sm capitalize",children:[e.jsx("i",{className:"fa-solid fa-building mr-2 text-indigo-500"}),"Department: ",t.department]}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsxs(f,{size:"sm",onClick:()=>d(t._id),className:"",children:[e.jsx("i",{className:"fa-solid fa-eye mr-1"}),"View"]}),e.jsxs(f,{size:"sm",onClick:()=>p(t._id),className:"bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded-md text-sm",children:[e.jsx("i",{className:"fa-solid fa-trash mr-1"}),"Delete"]})]})]})]},t._id)},J=["queued","in_progress","paused","done"],K=["low","medium","high"],Q=["site","procurement","design","accounts"],le=()=>{var w,C,S,k,_;const{organizationId:t}=F(),[l,i]=I.useState({}),p=T(),d=P(),{data:r,isLoading:g,isError:v,error:b,refetch:V}=z(l),{data:N}=L(t),{data:o}=B(t,"staff"),O=((w=o||[])==null?void 0:w.map(s=>({value:s._id,label:s.staffName,email:s.email})))||[],m=N==null?void 0:N.map(s=>({_id:s._id,projectName:s.projectName})),A=()=>i({}),y=Object.values(l).filter(Boolean).length;return d.pathname.includes("single")||d.pathname.includes("addtask")?e.jsx(E,{}):e.jsxs("div",{className:"p-2 h-full ",children:[e.jsxs("header",{className:"flex justify-between items-center w-full",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-dolly mr-3 text-blue-600"}),"Tasks"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage & Assign Tasks to your team members"})]}),e.jsx(f,{onClick:()=>{p("addtask")},className:"bg-blue-600  cursor-pointer ",children:"Add Task"})]}),e.jsxs("section",{className:"py-2 flex w-full gap-6 flex-col lg:flex-row items-start h-[90%]",children:[e.jsx("div",{className:"lg:w-1/3 xl:w-1/4 w-full",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-filter mr-2 text-blue-600"}),"Filters"]}),y>0&&e.jsxs("button",{onClick:A,className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:["Clear All (",y,")"]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs(x,{value:l.status,onValueChange:s=>i(a=>({...a,status:s})),children:[e.jsx(u,{className:"bg-white w-full",children:e.jsx(h,{placeholder:"Select status",selectedValue:l.status})}),e.jsx(j,{children:J.map(s=>e.jsx(c,{value:s,children:s},s))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Priority"}),e.jsxs(x,{value:l.priority,onValueChange:s=>i(a=>({...a,priority:s})),children:[e.jsx(u,{className:"bg-white w-full",children:e.jsx(h,{placeholder:"Select priority",selectedValue:l.priority})}),e.jsx(j,{children:K.map(s=>e.jsx(c,{value:s,children:s},s))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Department"}),e.jsxs(x,{value:l.department,onValueChange:s=>i(a=>({...a,department:s})),children:[e.jsx(u,{className:"bg-white w-full",children:e.jsx(h,{placeholder:"Select department",selectedValue:l.department})}),e.jsx(j,{children:Q.map(s=>e.jsx(c,{value:s,children:s},s))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Assignee"}),e.jsx(M,{options:O,placeholder:"Select assignee",searchPlaceholder:"Search by name...",value:l.assigneeId||"",onValueChange:s=>{const a=o==null?void 0:o.find(n=>n._id===s);i(n=>({...n,assigneeId:s||null,assigneeName:(a==null?void 0:a.staffName)||""}))},searchBy:"name",displayFormat:"detailed",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Project"}),e.jsxs("select",{value:l.projectId||"",onChange:s=>{const a=m.find(n=>n._id===s.target.value);i(n=>({...n,projectId:a==null?void 0:a._id,projectName:a==null?void 0:a.projectName}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All Projects"}),m==null?void 0:m.map(s=>e.jsx("option",{value:s._id,children:s.projectName},s._id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Overdue"}),e.jsxs(x,{value:((C=l.overdue)==null?void 0:C.toString())||"",onValueChange:s=>{i(a=>({...a,overdue:s==="true"}))},children:[e.jsx(u,{className:"bg-white w-full",children:e.jsx(h,{placeholder:"Overdue?",selectedValue:(S=l.overdue)==null?void 0:S.toString()})}),e.jsxs(j,{children:[e.jsx(c,{value:"false",children:"No"}),e.jsx(c,{value:"true",children:"Yes"})]})]})]})]})]})}),e.jsxs("div",{className:"flex-1 w-full overflow-y-auto  h-[100%]",children:[g&&e.jsx(Y,{}),v&&e.jsxs("div",{className:"max-w-xl sm:min-w-[80%]  mx-auto mt-4 p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2 text-xl sm:text-3xl",children:"⚠️ Error Occurred"}),e.jsx("p",{className:"text-red-500  mb-4 text-lg sm:text-xl",children:((_=(k=b==null?void 0:b.response)==null?void 0:k.data)==null?void 0:_.message)||"Failed to load data"}),e.jsx(f,{onClick:()=>V(),className:"bg-red-600 text-white px-4 py-2",children:"Retry"})]}),!g&&!v&&(r==null?void 0:r.length)===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[300px] w-full bg-white rounded-xl   text-center p-6",children:[e.jsx("i",{className:"fas fa-box-open text-5xl text-blue-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-1",children:"No Tasks Found"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Looks like there are no tasks assigned yet ",e.jsx("br",{}),"Click on ",e.jsx("strong",{children:'"Add task"'})," to get started 🚀"]})]}),e.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-4",children:r==null?void 0:r.map(s=>e.jsx($,{task:s},s._id))})]})]})]})};export{le as StaffTasksListMain,le as default};
