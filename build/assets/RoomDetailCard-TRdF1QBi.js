import{r as y,j as e,b as U,a as z}from"./index-e8sHY52i.js";import{e as _,f as M,g as B,h as G,i as Q,j as T}from"./materialSelectionApi-Bpqk8wOj.js";import{I as j}from"./Input-BH7aLFkl.js";import{B as n}from"./Button-45UYJ-Fj.js";import{t as o}from"./toast-BSC5QTk1.js";import{R as O}from"./RoomDetailLoading-DV2_SN_S.js";import{E as V}from"./EmptyState-dFZoKmTu.js";import{d as K}from"./downloadFile-MOPhhG62.js";import"./roleCheck-DbhaipVR.js";import"./useQuery-CqjHwNP0.js";import"./useMutation-BqjQ-Xv_.js";import"./Skeleton-C9CSd2lw.js";const $=({projectId:x,roomId:u,initialFiles:k,refetch:S})=>{const[p,R]=y.useState([]),[v,A]=y.useState(k.filter(s=>s.type==="pdf")),[b,d]=y.useState(k.filter(s=>s.type==="image")),[N,r]=y.useState(null),{mutateAsync:f,isPending:P}=_(),{mutateAsync:C,isPending:I}=M(),q=s=>{s.target.files&&R(Array.from(s.target.files))},E=async()=>{var F,m;if(p.length===0)return;const s=new FormData;p.forEach(t=>s.append("files",t));try{const t=await f({projectId:x,roomId:u,formData:s}),c=t.filter(h=>h.type==="pdf"),w=t.filter(h=>h.type==="image");A(h=>[...h,...c]),d(h=>[...h,...w]),R([]),o({title:"Success",description:"file uploaded successfully"}),S()}catch(t){o({title:"error",description:((m=(F=t==null?void 0:t.response)==null?void 0:F.data)==null?void 0:m.message)||"failed to upload file",variant:"destructive"})}},D=async(s,F)=>{var m,t;try{await C({projectId:x,roomId:u,fileId:s}),F==="pdf"?A(c=>c.filter(w=>w._id!==s)):d(c=>c.filter(w=>w._id!==s)),o({title:"Success",description:"deleted successfully"}),S()}catch(c){o({title:"error",description:((t=(m=c==null?void 0:c.response)==null?void 0:m.data)==null?void 0:t.message)||"failed to upload file",variant:"destructive"})}};return e.jsxs("div",{className:"space-y-6 ",children:[e.jsx("h3",{className:"text-xl font-semibold text-blue-700",children:"Uploads"}),e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsx(j,{type:"file",multiple:!0,onChange:q,accept:"image/*,application/pdf"}),e.jsx(n,{onClick:E,isLoading:P,className:"bg-blue-600 text-white",children:"Upload"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 pt-4",children:[e.jsxs("div",{className:"p-2",children:[e.jsx("h4",{className:"font-semibold text-red-700 mb-2",children:"ðŸ“„ PDF Files"}),e.jsxs("ul",{className:"space-y-2 max-h-[180px] h-[180px] rounded-lg shadow-lg p-2 overflow-y-auto custom-scrollbar-none",children:[v.length===0&&e.jsx("div",{className:"min-h-[180px] rounded-lg  flex items-center justify-center",children:e.jsx("p",{className:"text-sm text-gray-500",children:"No PDFs uploaded."})}),v.map(s=>e.jsxs("li",{className:"flex justify-between items-center bg-red-50 p-2 rounded-xl",children:[e.jsx("span",{className:"text-sm",children:s.originalName}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{size:"sm",variant:"primary",onClick:()=>K({src:s==null?void 0:s.url,alt:(s==null?void 0:s.originalName)||"file.pdf"}),children:e.jsx("i",{className:"fa-solid fa-download"})}),e.jsx(n,{onClick:()=>D(s._id,"pdf"),size:"sm",isLoading:I,variant:"primary",children:e.jsx("i",{className:"fa-solid fa-trash"})})]})]},s._id))]})]}),e.jsxs("div",{className:"p-2",children:[e.jsx("h4",{className:"font-semibold text-green-700 mb-2",children:"ðŸ–¼ï¸ Image Files"}),e.jsxs("ul",{className:"space-y-2 max-h-[180px] h-[180px] shadow-lg rounded-lg p-2 overflow-y-auto custom-scrollbar",children:[b.length===0&&e.jsx("div",{className:"min-h-[180px] rounded-lg  flex items-center justify-center",children:e.jsx("p",{className:"text-sm text-gray-500",children:"No Images uploaded."})}),b.map(s=>e.jsxs("li",{className:"flex justify-between items-center bg-green-50 p-2 rounded-xl",children:[e.jsx("span",{className:"text-sm truncate",children:s.originalName}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{size:"sm",variant:"primary",onClick:()=>r(s==null?void 0:s.url),children:e.jsx("i",{className:"fas fa-eye"})}),e.jsx(n,{size:"sm",variant:"primary",onClick:()=>K({src:s==null?void 0:s.url,alt:(s==null?void 0:s.originalName)||"file.pdf"}),children:e.jsx("i",{className:"fa-solid fa-download"})}),e.jsx(n,{onClick:()=>D(s._id,"image"),size:"sm",isLoading:I,variant:"primary",children:e.jsx("i",{className:"fa-solid fa-trash"})})]})]},s._id))]})]})]}),N&&e.jsx("div",{onClick:()=>r(null),className:"fixed inset-0 bg-black/70 z-50 p-8 bg-opacity-60 flex items-center justify-center",children:e.jsxs("div",{onClick:s=>s.stopPropagation(),className:"relative bg-white rounded py-8 px-4 max-w-[90vw] max-h-[80vh] shadow-lg",children:[e.jsx("i",{className:"fas fa-times absolute top-2 right-3 text-xl text-gray-700 hover:text-red-500 cursor-pointer",onClick:()=>r(null)}),e.jsx("img",{src:N,alt:"Full View",className:"max-h-[70vh] w-auto object-contain rounded"})]})})]})};function re(){const{projectId:x,roomId:u,roomType:k}=U(),S=z();if(!x||!u)return null;const{data:p,isLoading:R,refetch:v}=B({projectId:x,roomId:u,roomType:k}),[A,b]=y.useState(null),[d,N]=y.useState({quantity:0,unit:"",remarks:""}),[r,f]=y.useState({itemKey:"",quantity:0,unit:"",remarks:""}),[P,C]=y.useState(!1),{mutateAsync:I,isPending:q}=G(),{mutateAsync:E,isPending:D}=Q(),{mutateAsync:s,isPending:F}=T();if(R)return e.jsx(O,{});if(!p)return e.jsx(V,{message:"Room not found",color:"primary",customIconClass:"box",icon:"custom"});const m="items"in p,t=m?p.items.map(a=>[a.itemKey,a]):Object.entries(p.roomFields),c=(a,i)=>{b(a),N({quantity:i.quantity||0,unit:i.unit||"",remarks:i.remarks||""})},w=async()=>{var a,i;try{if(!r.itemKey.trim())throw new Error("Item field is mandatory");await I({projectId:x,roomId:u,item:r}),C(!1),o({description:"Field added successfully",title:"Success"}),v()}catch(l){o({title:"Error",description:((i=(a=l==null?void 0:l.response)==null?void 0:a.data)==null?void 0:i.message)||l.message||"Failed to add field",variant:"destructive"})}},h=async a=>{var i,l;try{await E({projectId:x,roomId:u,fieldKey:a,updates:d}),b(null),o({description:"Field updated successfully",title:"Success"}),v()}catch(g){o({title:"Error",description:((l=(i=g==null?void 0:g.response)==null?void 0:i.data)==null?void 0:l.message)||g.message||"Failed to update field",variant:"destructive"})}},L=async a=>{var i,l;try{confirm("Are you sure you want to delete this field?")&&await s({projectId:x,roomId:u,fieldKey:a}),o({description:"Field deleted successfully",title:"Success"}),v()}catch(g){o({title:"Error",description:((l=(i=g==null?void 0:g.response)==null?void 0:i.data)==null?void 0:l.message)||g.message||"Failed to delete field",variant:"destructive"})}};return e.jsxs("div",{className:"flex flex-col h-full w-full overflow-y-auto custom-scrollbar",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-blue-600",children:p.name}),e.jsx("p",{className:"text-gray-500 text-sm sm:text-base",children:"Room Material Items"})]}),e.jsx(n,{variant:"primary",className:"h-10 text-sm sm:text-base",onClick:()=>S(-1),children:"Go Back"})]}),e.jsx("section",{className:"w-full min-h-[100%] flex flex-col",children:e.jsx("div",{className:"overflow-x-auto min-w-full flex-grow min-h-0",children:e.jsxs("div",{className:"min-w-[700px] w-full flex flex-col border-2 border-gray-100 rounded-lg",children:[e.jsxs("div",{className:"rounded-md grid grid-cols-5 bg-gray-100 text-sm font-semibold text-gray-700 px-2 sm:px-4 py-3 sticky top-0 z-10",children:[e.jsx("div",{className:"truncate text-center",children:"Item"}),e.jsx("div",{className:"truncate text-center",children:"Quantity"}),e.jsx("div",{className:"truncate text-center",children:"Unit"}),e.jsx("div",{className:"truncate text-center",children:"Remarks"}),e.jsx("div",{className:"truncate text-center",children:"Actions"})]}),e.jsxs("div",{className:"flex-grow min-h-0 overflow-y-auto custom-scrollbar",children:[t==null?void 0:t.map(([a,i])=>e.jsxs("div",{className:"grid text-center mx-auto grid-cols-5 items-center px-2 sm:px-4 py-3 text-sm hover:bg-gray-50 border-b border-gray-100",children:[e.jsx("div",{className:"font-medium text-gray-700 truncate pr-2",children:a}),A===a?e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsx(j,{type:"number",value:d.quantity,onChange:l=>N({...d,quantity:+l.target.value}),className:"w-full text-sm"})}),e.jsx("div",{children:e.jsx(j,{value:d.unit,onChange:l=>N({...d,unit:l.target.value}),className:"w-full text-sm"})}),e.jsx("div",{children:e.jsx(j,{value:d.remarks,onChange:l=>N({...d,remarks:l.target.value}),className:"w-full text-sm"})}),e.jsxs("div",{className:"flex gap-1 sm:gap-2 mx-auto",children:[e.jsx(n,{variant:"primary",isLoading:D,onClick:()=>h(a),className:"text-xs sm:text-sm p-1 sm:p-2",children:e.jsx("i",{className:"fas fa-check"})}),e.jsx(n,{variant:"secondary",onClick:()=>b(null),className:"text-xs sm:text-sm p-1 sm:p-2",children:e.jsx("i",{className:"fas fa-xmark"})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"truncate pr-2",children:i.quantity??"N/A"}),e.jsx("div",{className:"truncate pr-2",children:i.unit||"N/A"}),e.jsx("div",{className:"max-h-[70px] overflow-y-auto custom-scrollbar cursor-grab pr-2",children:i.remarks||"N/A"}),e.jsxs("div",{className:"flex gap-1 sm:gap-2 mx-auto",children:[e.jsx(n,{variant:"primary",onClick:()=>c(a,i),className:"text-xs sm:text-sm p-1 sm:p-2",children:e.jsx("i",{className:"fas fa-pencil "})}),m&&e.jsx(n,{variant:"danger",isLoading:F,onClick:()=>L(a),className:"text-xs sm:text-sm p-1 sm:p-2",children:e.jsx("i",{className:"fas fa-trash-can"})})]})]})]},a)),m&&e.jsx(e.Fragment,{children:P?e.jsxs("div",{className:"grid text-center grid-cols-5 items-center px-2 sm:px-4 py-3 border-b border-gray-100",children:[e.jsx("div",{children:e.jsx(j,{value:r.itemKey,onChange:a=>f({...r,itemKey:a.target.value}),placeholder:"Item",className:"w-full text-sm"})}),e.jsx("div",{children:e.jsx(j,{type:"number",value:r.quantity,onChange:a=>f({...r,quantity:+a.target.value}),placeholder:"Quantity",className:"w-full text-sm"})}),e.jsx("div",{children:e.jsx(j,{value:r.unit,onChange:a=>f({...r,unit:a.target.value}),placeholder:"Unit",className:"w-full text-sm"})}),e.jsx("div",{children:e.jsx(j,{value:r.remarks,onChange:a=>f({...r,remarks:a.target.value}),placeholder:"Remarks",className:"w-full text-sm"})}),e.jsxs("div",{className:"flex gap-1 sm:gap-2 mx-auto",children:[e.jsx(n,{variant:"primary",isLoading:q,onClick:async()=>{await w(),f({itemKey:"",quantity:0,unit:"",remarks:""})},className:"text-xs sm:text-sm p-1 sm:p-2",children:e.jsx("i",{className:"fas fa-check"})}),e.jsx(n,{variant:"secondary",onClick:()=>{C(!1),f({itemKey:"",quantity:0,unit:"",remarks:""})},className:"text-xs sm:text-sm p-1 sm:p-2",children:e.jsx("i",{className:"fas fa-xmark"})})]})]}):e.jsx("div",{className:`flex ${t.length?"justify-left":"justify-center"} p-4`,children:e.jsxs(n,{variant:"primary",onClick:()=>C(!0),children:[e.jsx("i",{className:"fas fa-plus mr-2"})," Add Field"]})})}),m&&t.length===0&&!P&&e.jsx("div",{className:"text-center py-6 text-gray-500",children:"No items present. Add a new field."})]})]})})}),e.jsx("section",{className:"mt-4",children:e.jsx($,{projectId:x,roomId:u,initialFiles:p.uploads,refetch:v})})]})}export{re as default};
