import{r as P,u as B,a as W,x as le,s as Y,p as z,j as e,i as G,B as _,K as H,M as Q,N as V,P as J,Q as X,T as q,t as k,R as ce}from"./index-DCvjwNGU.js";import{M as de,e as fe,C as $}from"./constants-B0HHjZgX.js";import{d as Z}from"./CTOApi-AkDY_w8c.js";import{b as ee}from"./clientApi-CnzEZxWn.js";import{d as se}from"./staffApi-DJYqjbVF.js";import{d as te}from"./userApi-DCPB7NEZ.js";import{d as oe}from"./workerApi-BsYkx3Cf.js";import{u as ae}from"./stageSelectionApi-Dm1a4loN.js";function ue(d,f){P.useEffect(()=>{const N=t=>{t.ctrlKey&&t.key==="]"?(t.preventDefault(),f()):t.ctrlKey&&t.key==="["&&(t.preventDefault(),d())};window.addEventListener("keydown",N)},[f,d])}const xe=(d,f,N,t,u)=>{const w=t==null?void 0:t.some(s=>s.toLowerCase()==="projectdetails");let x={},l={},n={};if(w){let s=["DOCUMENTATION","WORKERS","INVITECLIENT","PREREQUISTIES","REQUIREMENTFORM","SITEMEASUREMENT","SAMPLEDESIGN","WORKSCHEDULE","TECHNICALCONSULTANT","SELECTSTAGE","PAYMENTCONFIRMATION","ORDERMATERIALS","MATERIALARRIVED","INSTALLATION","QUALITYCHECK","CLEANINGSANITATION","PROJECTDELIVERY"];const p=s.indexOf("TECHNICALCONSULTANT")+1;d==="Manual Flow"?s.splice(p,0,"MATERIALSELECTION","COSTESTIMATION"):d==="Modular Units"&&s.splice(p,0,"MODULARUNIT","EXTERNAL"),d!=null&&(s=s.filter(i=>i!=="SELECTSTAGE"));for(const i of s)f[i]&&u[i]&&N[i]&&(x[i]=f[i],l[i]=u[i],n[i]=N[i])}else x=f,l=u,n=N;let A=1,m=!1;const g={};for(const s of Object.keys(x))s==="REQUIREMENTFORM"&&(m=!0),m?(g[s]=`${A} ${x[s]}`,A++):g[s]=x[s];return{filteredLabels:g,filteredIcons:l,filteredPaths:n}},me=({labels:d,icons:f,path:N})=>{const[t,u]=P.useState(!1),{projectId:w}=B(),x=W(),l=le(),n=l.pathname.split("/"),{organizationId:A}=B(),m=Y(),{role:g}=z(o=>o.authStore),[s,h]=P.useState(""),{data:p,isLoading:i}=ae(w),{mutateAsync:v,isPending:C}=Z(),{mutateAsync:y,isPending:T}=ee(),{mutateAsync:M,isPending:S}=se(),{mutateAsync:E,isPending:j}=te(),{mutateAsync:R,isPending:U}=oe(),D=()=>{u(!1)},r=()=>{u(!0)};P.useEffect(()=>{const c=l.pathname.split("/")[4];h(t?()=>de[c]:()=>fe[c])},[l.pathname,t]),ue(r,D);const a=!i&&p;let{filteredLabels:L,filteredIcons:ne,filteredPaths:I}=xe(a,d,N,n,f);const F=n[2]==="projectdetails",ie=n[1]==="login",re=()=>{F&&x(`/organizations/${A}/projects`),ie&&x("/organizations")},K=async()=>{var o,c;try{g==="CTO"?await v():g==="client"?await y():g==="staff"?await M():g==="owner"?await E():g==="worker"&&await R(),m(H()),m(Q()),m(V()),m(J()),m(X()),m(q()),k({title:"Success",description:"logout successfull"}),(!C||!T||!S||!j||!U)&&x("/")}catch(b){k({title:"Error",description:((c=(o=b==null?void 0:b.response)==null?void 0:o.data)==null?void 0:c.message)||"Failed to logout",variant:"destructive"})}};return e.jsx(e.Fragment,{children:t?e.jsxs("aside",{onMouseLeave:()=>u(!1),className:"relative flex flex-col bg-[#2f303a] w-[17%] min-h-screen max-h-screen text-[#9ca3af] select-none transition-all duration-300",children:[e.jsxs("div",{className:"flex flex-col flex-grow overflow-y-auto overflow-x-hidden custom-scrollbar p-2 large-scrollbar",children:[e.jsxs("div",{onClick:re,className:`flex ${F?"cursor-pointer":""} justify-between items-center border-b-1 py-2`,children:[e.jsx("span",{className:"text-xl",children:$.COMPANY_NAME}),e.jsx("div",{className:"w-[30px] h-[30px]",children:e.jsx("img",{className:"w-full h-full",src:$.COMPANY_LOGO,alt:"LOGO"})})]}),e.jsxs("section",{className:"py-2 space-y-2",children:[" ",Object.entries(L).map(([o,c])=>{const b=s===c;return I[o]&&e.jsx(G,{to:I[o],className:"outline-none",children:e.jsxs("div",{onClick:()=>h(c),className:`cursor-pointer flex justify-between max-w-[95%] py-4 px-4 ${s===c?"bg-[#3a3b45] rounded-xl text-white":"rounded-xl hover:bg-[#3a3b45]"} `,ref:O=>{b&&O&&O.scrollIntoView({behavior:"smooth",block:"center"})},children:[e.jsx("span",{className:"text-lg",children:c}),e.jsx("span",{children:e.jsx("i",{className:"fa-solid fa-chevron-right"})})]})},c)})]})]}),e.jsxs("div",{className:"flex flex-col p-2 border-t border-[#3a3b45]",children:[n[1]!=="login"&&e.jsxs(_,{isLoading:C||T||S||j||U,onClick:K,className:"flex items-center gap-2 px-4 py-3 rounded-lg !bg-[#3a3b45] !text-[#9ca3af] hover:!bg-[#464751] hover:!text-white transition",children:[e.jsx("i",{className:"fa-solid fa-right-from-bracket"}),e.jsx("span",{children:"Logout"})]}),e.jsx("button",{title:"Ctrl+] to close",onClick:D,className:"mt-2 flex items-center justify-center outline-none border border-blue-600 text-blue-500 hover:bg-[#3a3b45] rounded-lg w-full py-2",children:e.jsx("i",{className:"fa-solid fa-chevron-left"})})]})]}):e.jsxs("aside",{onMouseEnter:()=>u(!0),className:"flex flex-col relative justify-between bg-[#2f303a] w-[6%]  max-h-full  text-[#9ca3af] transition-all duration-300 ",children:[e.jsx("div",{className:"max-h-[95%] overflow-y-auto overflow-x-hidden custom-scrollbar ",children:e.jsx("div",{className:"flex items-center flex-col justify-between w-full",children:Object.entries(ne).map(([o,c])=>{const b=(s==null?void 0:s.toLowerCase())===o.toLowerCase();return I[o]?e.jsx(G,{to:I[o],className:`${I[o]?"":"cursor-not-allowed"}`,children:e.jsx("div",{onClick:()=>h(o),className:`cursor-pointer flex justify-between max-w-[95%] py-4 px-4 ${(s==null?void 0:s.toLowerCase())===o.toLowerCase()?"bg-[#3a3b45] rounded-xl text-white":"rounded-xl hover:bg-[#3a3b45]"} `,ref:O=>{b&&O&&O.scrollIntoView({behavior:"smooth",block:"center"})},children:e.jsx("i",{className:`${c} ${(s==null?void 0:s.toLowerCase())===o.toLowerCase()?"text-[#4a86f7]":"text-[#9ca3af]"} `})})},o):e.jsx("div",{className:"cursor-not-allowed flex justify-between max-w-[95%] py-4 px-4",children:e.jsx("i",{className:`${c}`})})})})}),e.jsxs("div",{className:"flex flex-col items-center p-2 border-t border-[#3a3b45]",children:[n[1]!=="login"&&e.jsx(_,{isLoading:C||T||S||j||U,title:"logout",onClick:K,className:"w-[40px] h-[40px] flex items-center justify-center !bg-[#3a3b45] !text-[#9ca3af] hover:!text-red-500 transition",children:e.jsx("i",{className:"fa-solid fa-right-from-bracket"})}),e.jsx("button",{title:"Ctrl+[ to open",onClick:r,className:"mt-2 cursor-pointer outline-none border-[#9ca3af] h-[40px] w-[40px] flex items-center justify-center border rounded-lg",children:e.jsx("i",{className:"fa-solid fa-chevron-right text-[#4a86f7]"})})]})]})})},Ee=P.memo(me),we=({isOpen:d,onClose:f,labels:N,path:t})=>{const u=W(),{organizationId:w,projectId:x}=B(),l=Y(),{role:n}=z(r=>r.authStore),{data:A,isLoading:m}=ae(x),{mutateAsync:g,isPending:s}=Z(),{mutateAsync:h,isPending:p}=ee(),{mutateAsync:i,isPending:v}=se(),{mutateAsync:C,isPending:y}=te(),{mutateAsync:T,isPending:M}=oe(),S=async()=>{var r,a;try{n==="CTO"?await g():n==="client"?await h():n==="staff"?await i():n==="owner"?await C():n==="worker"&&await T(),l(H()),l(Q()),l(V()),l(J()),l(X()),l(q()),k({title:"Success",description:"logout successfull"}),(!s||!p||!v||!y||!M)&&u("/")}catch(L){k({title:"Error",description:((a=(r=L==null?void 0:L.response)==null?void 0:r.data)==null?void 0:a.message)||"Failed to logout",variant:"destructive"})}};let E=Object.entries(N);const j=location.pathname.split("/"),R=j[2]==="projectdetails";if(j.includes("projectdetails")&&!m){const r=A;E=E.filter(([a])=>{if(r){if(r==="Modular Units")return a!=="MATERIALSELECTION"&&a!=="COSTESTIMATION"&&a!=="SELECTSTAGE";if(r==="Manual Flow")return a!=="MODULARUNIT"&&a!=="SELECTSTAGE"}else return a!=="MODULARUNIT"&&a!=="MATERIALSELECTION"&&a!=="COSTESTIMATION";return!0})}const D=()=>{R&&u(`/organizations/${w}/projects`)};return e.jsxs(e.Fragment,{children:[d&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40",onClick:f}),e.jsxs("aside",{className:`fixed top-0 left-0 z-50 h-screen bg-white w-[75%] flex flex-col transition-transform duration-300 ${d?"translate-x-0":"-translate-x-full"}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsxs("div",{onClick:D,className:`flex items-center gap-3 ${R?"cursor-pointer":""}`,children:[e.jsx("img",{src:$.COMPANY_LOGO,alt:"Logo",className:"w-10 h-10 rounded-full object-cover"}),e.jsx("span",{className:"text-lg font-semibold",children:$.COMPANY_NAME})]}),e.jsx("button",{onClick:f,className:"text-xl text-gray-700",children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsx("nav",{className:"flex flex-col flex-grow overflow-y-auto p-4",children:E.map(([r,a],L)=>e.jsxs(ce.Fragment,{children:[t[r]?e.jsx(G,{to:t[r],onClick:f,className:"text-gray-800 hover:bg-gray-100 p-3 rounded block",children:a}):e.jsx("span",{className:"text-gray-400 p-3 rounded cursor-not-allowed block",children:a}),L<E.length-1&&e.jsx("hr",{className:"border-t border-gray-200 my-1"})]},r))}),e.jsx("div",{className:"border-t border-gray-200 p-4",children:j[1]!=="login"&&e.jsxs(_,{className:"w-full flex items-center justify-center gap-2",isLoading:s||p||v||y||M,onClick:S,children:[e.jsx("i",{className:"fas fa-sign-out-alt"})," Logout"]})})]})]})};export{we as M,Ee as S};
