import{b as le,u as ie,r as u,j as e}from"./index-mTWK40SB.js";import{C as E,d as U}from"./Card-BPbh2zyJ.js";import{I as d}from"./Input-Blzs3gka.js";import{B as o}from"./Button-D17pPJux.js";import{u as ne,a as ce,b as re,c as oe,d as de,e as me,f as xe,g as ue}from"./procurementApi-DKzniIRk.js";import he from"./MaterialOverviewLoading-DOIh6gsj.js";import{t as c}from"./toast-BSC5QTk1.js";import{d as pe}from"./downloadFile-DmnOOrMZ.js";import"./useQuery-COMoCVsy.js";import"./useMutation-BbI9x9IC.js";import"./roleCheck-B4W0Vc_0.js";import"./Skeleton-CWzlSvu7.js";const ke=()=>{var v,y,w,P,C,D,S,k,L,I,A;const{id:m,organizationId:G}=le(),T=ie(),{data:s,isLoading:$}=ne(m),{mutateAsync:z}=ce(),{mutateAsync:R}=re(),{mutateAsync:_,isPending:q}=oe(),{mutateAsync:B,isPending:g}=de(),{mutateAsync:M,isPending:K}=me(),{mutateAsync:O,isPending:Q}=xe(),{mutateAsync:V,isPending:Y}=ue(),[H,j]=u.useState(!1),[N,J]=u.useState((s==null?void 0:s.totalCost)||0),[W,p]=u.useState(!1),[i,h]=u.useState({}),[X,f]=u.useState(!1),[n,x]=u.useState({}),Z=async()=>{var t,l;try{if(i!=null&&i.phoneNumber&&!/^\d{10}$/.test(i==null?void 0:i.phoneNumber.trim()))throw new Error("Phone number should contain exactly 10 digit numbers");await R({id:m,payload:i}),p(!1),c({title:"Success",description:"Delivery Details Updated"})}catch(a){c({variant:"destructive",title:"Error",description:((l=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:l.message)||(a==null?void 0:a.message)||"Update failed"})}},F=async()=>{var t,l;try{if(n.phoneNumber&&!/^\d{10}$/.test(n.phoneNumber.trim()))throw new Error("Phone number should contain exactly 10 digit numbers");await z({id:m,payload:n}),c({title:"Success",description:"Shop Details Updated"}),f(!1)}catch(a){c({variant:"destructive",title:"Error",description:((l=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:l.message)||(a==null?void 0:a.message)||"Update failed"})}},b=async()=>{var t,l;try{await _({id:m,payload:{totalCost:N}}),j(!1),c({title:"Success",description:"Cost Updated Successfully"})}catch(a){c({variant:"destructive",title:"Error",description:((l=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:l.message)||(a==null?void 0:a.message)||"Update failed"})}},ee=async()=>{var t,l;try{await B({id:m}),c({title:"Success",description:"Pdf Generated successfully"})}catch(a){c({title:"Error",description:((l=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:l.message)||(a==null?void 0:a.message)||"Failed to generate link",variant:"destructive"})}},se=async t=>{var l,a;try{await M({id:m,pdfId:t}),c({title:"Success",description:"PDF deleted"})}catch(r){c({variant:"destructive",title:"Error",description:((a=(l=r==null?void 0:r.response)==null?void 0:l.data)==null?void 0:a.message)||(r==null?void 0:r.message)||"failed to delete"})}},te=async()=>{var t,l;try{await O({id:m}),c({title:"Success",description:"Details sent to Logistics Department"})}catch(a){c({variant:"destructive",title:"Error",description:((l=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:l.message)||(a==null?void 0:a.message)||"operation failed"})}},ae=async()=>{var t,l,a;try{await V({fromDept:"procurement",organizationId:G,projectId:s==null?void 0:s.projectId,totalCost:s==null?void 0:s.totalCost,upiId:((t=s==null?void 0:s.shopDetails)==null?void 0:t.upiId)||null}),c({title:"Success",description:"Details sent to Accounts Department"})}catch(r){c({variant:"destructive",title:"Error",description:((a=(l=r==null?void 0:r.response)==null?void 0:l.data)==null?void 0:a.message)||(r==null?void 0:r.message)||"operation failed"})}};return $?e.jsx(he,{}):e.jsxs("div",{className:"p-1 max-w-full max-h-full overflow-y-auto space-y-8",children:[e.jsx("header",{className:"flex gap-2 items-center",children:e.jsxs("section",{className:"flex flex-1 justify-between items-center",children:[e.jsxs("div",{className:"flex gap-2 justify-between items-center",children:[e.jsx("div",{onClick:()=>T(-1),className:"bg-blue-50 hover:bg-slate-300 flex items-center justify-between w-8 h-8 border border-[#a6aab8] text-sm cursor-pointer rounded-md px-2 ",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsxs("h1",{className:"text-2xl sm:text-3xl font-bold text-blue-700",children:[e.jsx("span",{className:"text-black text-2xl",children:"Ref Id:"})," ",s!=null&&s.refPdfId?s==null?void 0:s.refPdfId.replace(/-pdf$/,""):"N/A"]})]}),e.jsxs("div",{className:"flex gap-2 items-center ",children:[e.jsxs("div",{className:"flex flex-col items-start space-y-1",children:[e.jsx(o,{variant:"primary",isLoading:Y,onClick:ae,children:"Send To Accounts Dept"}),e.jsxs("span",{className:"text-xs text-blue-500 mx-auto",children:[e.jsx("strong",{children:"*"})," Click the button to send the ",e.jsx("br",{})," details to  accounts dept"]})]}),e.jsxs("div",{className:"flex flex-col items-start space-y-1",children:[e.jsx(o,{variant:"primary",isLoading:Q,onClick:te,children:"Send To Logistics Dept"}),e.jsxs("span",{className:"text-xs text-blue-500 mx-auto",children:[e.jsx("strong",{children:"*"})," Click the button to send the ",e.jsx("br",{})," details to  logistics dept"]})]})]})]})}),e.jsxs("div",{className:"border-l-4 border-blue-600 rounded-lg p-4 shadow-sm relative bg-white",children:[e.jsxs("h2",{className:"text-base sm:text-lg font-bold mb-3 text-blue-700 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-store"}),"Shop Details"]}),X?e.jsxs("div",{className:"space-y-3",children:[e.jsx(d,{placeholder:"Shop Name",value:(n==null?void 0:n.shopName)||"",onChange:t=>x({...n,shopName:t.target.value}),className:"w-full"}),e.jsx(d,{placeholder:"Contact Person",value:(n==null?void 0:n.contactPerson)||"",onChange:t=>x({...n,contactPerson:t.target.value}),className:"w-full"}),e.jsx(d,{placeholder:"Phone Number",value:(n==null?void 0:n.phoneNumber)||"",type:"tel",maxLength:10,onChange:t=>{const l=t.target.value;/^\d*$/.test(l)&&x({...n,phoneNumber:l})},className:"w-full"}),e.jsx(d,{placeholder:"upi Id",value:(n==null?void 0:n.upiId)||"",onChange:t=>x({...n,upiId:t.target.value}),className:"w-full"}),e.jsx(d,{placeholder:"Address",value:(n==null?void 0:n.address)||"",onChange:t=>x({...n,address:t.target.value}),className:"w-full"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mt-3  justify-end ",children:[e.jsxs(o,{onClick:F,className:"w-full sm:w-auto",children:[e.jsx("i",{className:"fa-solid fa-save mr-2"}),"Save"]}),e.jsxs(o,{variant:"outline",onClick:()=>f(!1),className:"w-full sm:w-auto",children:[e.jsx("i",{className:"fa-solid fa-times mr-2"}),"Cancel"]})]})]}):e.jsxs("div",{className:"space-y-2 text-sm sm:text-base",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Shop Name:"})," ",((v=s==null?void 0:s.shopDetails)==null?void 0:v.shopName)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Contact Person:"})," ",((y=s==null?void 0:s.shopDetails)==null?void 0:y.contactPerson)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Phone:"})," ",((w=s==null?void 0:s.shopDetails)==null?void 0:w.phoneNumber)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Upi Id:"})," ",((P=s==null?void 0:s.shopDetails)==null?void 0:P.upiId)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Address:"})," ",((C=s==null?void 0:s.shopDetails)==null?void 0:C.address)||"-"]}),e.jsxs("button",{onClick:()=>{x(s==null?void 0:s.shopDetails),f(!0)},className:"absolute top-3 right-4 text-blue-600 text-xs sm:text-sm underline hover:text-blue-800",children:[e.jsx("i",{className:"fa-solid fa-edit mr-1"}),"Edit"]})]})]}),e.jsxs("div",{className:"border-l-4 mt-4 border-blue-600 rounded-lg p-4 shadow-sm relative bg-white",children:[e.jsxs("h2",{className:"text-base sm:text-lg font-bold mb-3 text-blue-700 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-truck"}),"Delivery Location"]}),W?e.jsxs("div",{className:"space-y-3",children:[e.jsx(d,{placeholder:"Site Name",value:(i==null?void 0:i.siteName)||"",onChange:t=>h({...i,siteName:t.target.value}),className:"w-full"}),e.jsx(d,{placeholder:"Site Supervisor",value:(i==null?void 0:i.siteSupervisor)||"",onChange:t=>h({...i,siteSupervisor:t.target.value}),className:"w-full"}),e.jsx(d,{placeholder:"Phone Number",type:"tel",maxLength:10,value:(i==null?void 0:i.phoneNumber)||"",onChange:t=>{const l=t.target.value;/^\d*$/.test(l)&&h({...i,phoneNumber:l})},className:"w-full"}),e.jsx(d,{placeholder:"Address",value:(i==null?void 0:i.address)||"",onChange:t=>h({...i,address:t.target.value}),className:"w-full"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mt-3 justify-end ",children:[e.jsxs(o,{onClick:Z,className:"w-full sm:w-auto",children:[e.jsx("i",{className:"fa-solid fa-save mr-2"}),"Save"]}),e.jsxs(o,{variant:"outline",onClick:()=>p(!1),className:"w-full sm:w-auto",children:[e.jsx("i",{className:"fa-solid fa-times mr-2"}),"Cancel"]})]})]}):e.jsxs("div",{className:"space-y-2 text-sm sm:text-base",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Site Name:"})," ",((D=s==null?void 0:s.deliveryLocationDetails)==null?void 0:D.siteName)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Supervisor:"})," ",((S=s==null?void 0:s.deliveryLocationDetails)==null?void 0:S.siteSupervisor)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Phone:"})," ",((k=s==null?void 0:s.deliveryLocationDetails)==null?void 0:k.phoneNumber)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Address:"})," ",((L=s==null?void 0:s.deliveryLocationDetails)==null?void 0:L.address)||"-"]}),e.jsxs("button",{onClick:()=>{h(s==null?void 0:s.deliveryLocationDetails),p(!0)},className:"absolute top-3 right-4 text-blue-600 text-xs sm:text-sm underline hover:text-blue-800",children:[e.jsx("i",{className:"fa-solid fa-edit mr-1"}),"Edit"]})]})]}),e.jsx(E,{children:e.jsx(U,{className:"py-6 space-y-5",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center",children:[e.jsx("h3",{className:"text-lg font-bold text-indigo-700 mb-2 sm:mb-0",children:"Items List ðŸ“‹"}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2",children:[e.jsx("h3",{className:"text-lg font-bold text-blue-700",children:"Total Cost "}),e.jsx("div",{className:"flex items-center gap-3 text-sm",children:H?e.jsxs(e.Fragment,{children:[e.jsx(d,{type:"number",className:"w-32",value:N,onChange:t=>J(Number(t.target.value)),onKeyDown:t=>{t.key==="Enter"&&b()}}),e.jsx(o,{size:"sm",isLoading:q,onClick:b,children:"Save"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-base font-semibold text-gray-800",children:["â‚¹ ",s.totalCost]}),e.jsxs(o,{size:"sm",variant:"secondary",onClick:()=>j(!0),children:[e.jsx("i",{className:"fas fa-pen mr-1"}),"Edit"]})]})})]})]}),e.jsx("div",{className:"overflow-x-auto rounded border border-gray-200",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-100",children:[e.jsx("thead",{className:"bg-gray-50 text-sm text-gray-700 font-medium",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-5 py-2 text-left",children:"Item Name"}),e.jsx("th",{className:"px-5 py-2 text-left",children:"Quantity"}),e.jsx("th",{className:"px-5 py-2 text-left",children:"Unit"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-100 text-sm",children:s.selectedUnits.map((t,l)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-5 py-2",children:t.subItemName}),e.jsx("td",{className:"px-5 py-2",children:t.quantity}),e.jsx("td",{className:"px-5 py-2",children:t.unit})]},l))})]})})]})})}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"Export Procurement Material"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Generate a PDF document of your Procurements"})]}),e.jsx(o,{onClick:ee,disabled:g,className:"min-w-[140px] bg-blue-600 hover:bg-blue-700 text-white font-medium",size:"lg",children:g?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-file-pdf"}),"Generate PDF"]})})]}),s!=null&&s.procurementPdfs&&((I=s==null?void 0:s.procurementPdfs)==null?void 0:I.length)>0?(A=s==null?void 0:s.procurementPdfs)==null?void 0:A.map(t=>e.jsx(E,{className:"border-green-200 bg-green-50 ",children:e.jsx(U,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx("i",{className:"fas fa-check-circle text-green-600"})}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-green-900 mb-1",children:[e.jsx("span",{className:"text-sm text-black",children:"Pdf Reference Id: "}),t.refUniquePdf||"N/A"]}),e.jsx("p",{className:"text-sm text-green-700",children:"Your Procurement PDF is ready to view or download"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full sm:w-auto ",children:[e.jsxs(o,{variant:"outline",onClick:()=>window.open(t.url,"_blank"),className:"border-green-300 text-blue-700 hover:bg-blue-100 hover:border-blue-400",children:[e.jsx("i",{className:"fas mr-2 fa-external-link-alt"}),"View in New Tab"]}),e.jsx(o,{variant:"secondary",onClick:()=>pe({src:t.url,alt:"Procurement"}),className:"border-blue-300 text-blue-700 hover:bg-blue-100 hover:border-blue-400",children:"Download PDF"}),e.jsx(o,{variant:"danger",isLoading:K,onClick:()=>se(t._id),className:"border-red-300 bg-red-600 text-white hover:bg-red-600 hover:border-red-400",children:"Delete PDF"})]})]})})},t._id)):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col items-center  justify-center min-h-[300px] w-full bg-white rounded-xl text-center p-6",children:[e.jsx("i",{className:"fa-solid fa-file-lines text-5xl text-blue-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-1",children:"No Pdf Found"}),e.jsx("p",{className:"text-sm text-gray-500",children:"No PDF Generated"})]})})]})})]})};export{ke as default};
