import{r as c,j as e,S as ge,$ as We,u as He,b as ze,a as $e,R as Ke,B as Je,M as Xe,t as ke}from"./index-CUvv9ev0.js";import{b as Ye,c as Oe,d as Ze}from"./quoteVariantApi-DXhk0qe8.js";import{C as Ie}from"./Card-CHHq377-.js";import{c as et,u as tt}from"./labourRateconfigApi-C3xWGadp.js";const be=(L,$,m)=>{const d=String(L).toLowerCase().replace("mm","").trim(),v=$.find(N=>String(N.thickness).toLowerCase().replace("mm","").trim()===d);return(v==null?void 0:v.rs)!==void 0?v.rs:m==="laminate"?at:0},rt=c.forwardRef((L,$)=>{const{data:m,index:d,brandOptions:v,innerOptions:N,outerOptions:Q,innerLaminateRatesByBrand:ie,outerLaminateRatesByBrand:de,brandRatesByName:fe,labourCost:Le,selectedBrand:j,selectedInnerBrand:C,selectedOuterBrand:f,onFurnitureChange:ue,globalProfitPercent:me,onProfitOverride:E}=L,[A,K]=c.useState(j),[q,J]=c.useState(C),[D,X]=c.useState(f),[ye,re]=c.useState(null),[Ne,ae]=c.useState(null),[je,ne]=c.useState(null),[b,xe]=c.useState((m==null?void 0:m.coreMaterials)||[]),[S,pe]=c.useState((m==null?void 0:m.fittingsAndAccessories)||[]),[M,Y]=c.useState((m==null?void 0:m.glues)||[]),[Z,se]=c.useState((m==null?void 0:m.nonBrandMaterials)||[]),ve=c.useRef(j),_=c.useRef(C),Se=c.useRef(f);c.useEffect(()=>{ve.current!==j&&(K(j),ve.current=j)},[j]),c.useEffect(()=>{_.current!==C&&(J(C),_.current=C)},[C]),c.useEffect(()=>{Se.current!==f&&(X(f),Se.current=f)},[f]);const V=c.useRef(!1);c.useEffect(()=>{if(!v.length)return;const r=m.plywoodBrandId,o=v.find(u=>u.label===j||u.value===j);if(!V.current&&r){const u=v.find(x=>x.value===r);K((u==null?void 0:u.label)||null),re(r)}else V.current&&j&&(K((o==null?void 0:o.label)||j),re((o==null?void 0:o.value)||null))},[j,v,m.plywoodBrandId]),c.useEffect(()=>{if(!N.length)return;const r=m.innerLaminateBrandId,o=N.find(u=>u.label===C||u.value===C);if(!V.current&&r){const u=N.find(x=>x.value===r);J((u==null?void 0:u.label)||null),ae(r)}else V.current&&C&&(J((o==null?void 0:o.label)||C),ae((o==null?void 0:o.value)||null))},[C,N,m.innerLaminateBrandId]),c.useEffect(()=>{if(!Q.length)return;const r=m.outerLaminateBrandId,o=Q.find(u=>u.label===f||u.value===f);if(!V.current&&r){const u=Q.find(x=>x.value===r);X((u==null?void 0:u.label)||null),ne(r)}else V.current&&f&&(X((o==null?void 0:o.label)||f),ne((o==null?void 0:o.value)||null))},[f,Q,m.outerLaminateBrandId]),c.useEffect(()=>{if(v.length>0&&N.length>0&&Q.length>0){const r=setTimeout(()=>{V.current=!0},300);return()=>clearTimeout(r)}},[v.length,N.length,Q.length]);const oe=(r,o)=>{if(!r){o==="plywood"?(K(null),re(null)):o==="inner"?(J(null),ae(null)):(X(null),ne(null));return}const x=(o==="plywood"?v:o==="inner"?N:Q).find(w=>w.value===r);o==="plywood"?(K((x==null?void 0:x.label)||r),re((x==null?void 0:x.value)||null)):o==="inner"?(J((x==null?void 0:x.label)||r),ae((x==null?void 0:x.value)||null)):(X((x==null?void 0:x.label)||r),ne((x==null?void 0:x.value)||null))};c.useEffect(()=>{xe((m==null?void 0:m.coreMaterials)||[]),pe((m==null?void 0:m.fittingsAndAccessories)||[]),Y((m==null?void 0:m.glues)||[]),se((m==null?void 0:m.nonBrandMaterials)||[])},[m]);const ee=(r,o)=>{var g,i,p,R,H;const u=A?fe[A]||[]:[],x=q?ie[q]||[]:[],w=D?de[D]||[]:[],P=be(r.plywoodNos.thickness,u,"plywood"),I=be(((g=r.innerLaminate)==null?void 0:g.thickness)||0,x,"laminate"),y=be(((i=r.outerLaminate)==null?void 0:i.thickness)||0,w,"laminate"),we=32,Te=(((p=r.plywoodNos)==null?void 0:p.quantity)||0)*P*we,Pe=(((R=r.innerLaminate)==null?void 0:R.quantity)||0)*I*we,Re=(((H=r.outerLaminate)==null?void 0:H.quantity)||0)*y*we,Be=Te+Pe+Re,Me=Be*((r.profitOnMaterial||0)/100),le=o.length,F=o[0],t=((F==null?void 0:F.carpenters)||0)*((F==null?void 0:F.days)||0)*Le*(1+((F==null?void 0:F.profitOnLabour)||0)/100),l=le>0?t/le:0,s=le>0?(m.fabricationCost||0)/le:0,h=1+((m.furnitureProfit??me)||0)/100;return(Be+Me+l+s)*h},U=b.reduce((r,o)=>r+ee(o,b),0),Ce=1+((m.furnitureProfit??me)||0)/100,k=(r,o=!1)=>{const u=o?r.cost||0:(r.quantity||0)*(r.cost||0),x=u*((r.profitOnMaterial||0)/100);return(u+x)*Ce},O=S.reduce((r,o)=>r+k(o),0),W=M.reduce((r,o)=>r+k(o,!0),0),G=Z.reduce((r,o)=>r+k(o),0),T=U+O+W+G;c.useImperativeHandle($,()=>({getUpdatedFurniture:()=>{const r=b.map(I=>({...I,rowTotal:Math.round(ee(I,b))})),o=Math.round(U),u=Math.round(O),x=Math.round(W),w=Math.round(G),P=Math.round(T);return{...m,plywoodBrand:A,innerLaminateBrand:q,outerLaminateBrand:D,plywoodBrandId:ye,innerLaminateBrandId:Ne,outerLaminateBrandId:je,furnitureProfit:m.furnitureProfit,coreMaterials:r,coreMaterialsTotal:o,fittingsAndAccessoriesTotal:u,gluesTotal:x,nonBrandMaterialsTotal:w,furnitureTotal:P,totals:{core:U,fittings:O,glues:W,nbms:G,furnitureTotal:T}}}})),c.useEffect(()=>{ue()},[A,q,D]);const te=(r,o,u)=>e.jsxs("div",{className:"mt-6",children:[e.jsxs("h3",{className:"font-semibold text-md mb-2 text-gray-800",children:[r," - Total: ₹",Math.round(u==="Fittings"?O:u==="Glues"?W:G).toLocaleString("en-IN")]}),e.jsxs("table",{className:"min-w-full text-sm bg-white shadow-sm border border-gray-200",children:[e.jsx("thead",{className:"bg-blue-50 text-sm font-semibold text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 border-r",children:"Item Name"}),e.jsx("th",{className:"px-6 py-3 border-r",children:"Description"}),e.jsx("th",{className:"px-6 py-3 border-r",children:"Quantity"}),e.jsx("th",{className:"px-6 py-3 border-r",children:"Cost"}),e.jsx("th",{className:"px-6 py-3 border-r",children:"Profit %"}),e.jsx("th",{className:"px-6 py-3",children:"Total"})]})}),e.jsx("tbody",{children:o.map((x,w)=>e.jsxs("tr",{className:"border-t hover:bg-gray-50",children:[e.jsx("td",{className:"p-2 border-r text-center",children:x.itemName||"—"}),e.jsx("td",{className:"p-2 border-r text-center",children:x.description||"—"}),e.jsx("td",{className:"p-2 border-r text-center",children:x.quantity}),e.jsxs("td",{className:"p-2 border-r text-center",children:["₹",x.cost]}),e.jsx("td",{className:"p-2 border-r text-center",children:e.jsx("input",{type:"number",value:x.profitOnMaterial||0,onChange:P=>{const I=parseFloat(P.target.value)||0;if(u==="Fittings"){const y=[...S];y[w].profitOnMaterial=I,pe(y)}else if(u==="Glues"){const y=[...M];y[w].profitOnMaterial=I,Y(y)}else{const y=[...Z];y[w].profitOnMaterial=I,se(y)}ue()},className:"w-16 text-center border border-blue-200 rounded py-1 font-semibold"})}),e.jsxs("td",{className:"p-2 text-center font-bold text-green-700",children:["₹",Math.round(k(x,u==="Glues")).toLocaleString("en-IN")]})]},w))})]})]});return e.jsxs("div",{className:"shadow-lg p-6 my-6 border rounded-xl bg-white",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h2",{className:"text-2xl font-bold text-blue-700",children:["Product ",d+1,": ",m.furnitureName]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("section",{className:"flex flex-col items-end",children:[e.jsx("label",{className:"text-[10px] font-bold text-blue-500 uppercase tracking-tighter",children:"Product Profit Override (%)"}),e.jsxs("div",{className:"flex items-center bg-blue-50 px-3 py-1 rounded-lg border border-blue-100 shadow-sm",children:[e.jsx("input",{type:"number",className:"w-14 text-right font-black bg-transparent outline-none text-blue-800",value:m.furnitureProfit??"",placeholder:me.toString(),onChange:r=>{const o=r.target.value===""?0:parseFloat(r.target.value);E(o)}}),e.jsx("span",{className:"ml-1 text-blue-600 font-black text-sm",children:"%"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-[10px] font-bold text-green-500 uppercase",children:"Grand Product Total"}),e.jsxs("p",{className:"text-2xl font-black text-green-600",children:["₹",Math.round(T).toLocaleString("en-IN")]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-6 mb-6 p-4 bg-gray-50 rounded-xl border border-gray-100 shadow-inner",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-extrabold text-gray-400 uppercase mb-1 block",children:"Plywood Brand"}),e.jsx(ge,{options:v,onValueChange:r=>oe(r,"plywood"),value:ye||""})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-extrabold text-blue-400 uppercase mb-1 block",children:"Inner Laminate Brand"}),e.jsx(ge,{options:N,onValueChange:r=>oe(r,"inner"),value:Ne||""})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-extrabold text-orange-400 uppercase mb-1 block",children:"Outer Laminate Brand"}),e.jsx(ge,{options:Q,onValueChange:r=>oe(r,"outer"),value:je||""})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"border border-gray-200 bg-white rounded-lg shadow-sm p-3",children:[e.jsxs("h3",{className:"text-[11px] font-bold text-gray-500 uppercase mb-2 flex justify-between",children:["Plywood Rates: ",e.jsx("span",{className:"text-blue-600",children:A||"None"})]}),e.jsx("div",{className:"max-h-[150px] overflow-y-auto border-t border-gray-100 pt-2",children:e.jsx("table",{className:"min-w-full text-[11px]",children:e.jsx("tbody",{children:(A?fe[A]:[]).map((r,o)=>e.jsxs("tr",{className:"border-b border-gray-50 last:border-0 hover:bg-gray-50",children:[e.jsxs("td",{className:"py-1 text-gray-600 font-medium",children:[r.thickness," mm"]}),e.jsxs("td",{className:"py-1 text-right font-bold text-green-700",children:["₹",r.rs.toFixed(2)]})]},o))})})})]}),e.jsxs("div",{className:"border border-blue-100 bg-white rounded-lg shadow-sm p-3",children:[e.jsxs("h3",{className:"text-[11px] font-bold text-blue-500 uppercase mb-2 flex justify-between",children:["Inner Rates: ",e.jsx("span",{className:"text-blue-700",children:q||"None"})]}),e.jsx("div",{className:"max-h-[150px] overflow-y-auto border-t border-blue-50 pt-2",children:e.jsx("table",{className:"min-w-full text-[11px]",children:e.jsx("tbody",{children:(q?ie[q]:[]).map((r,o)=>e.jsxs("tr",{className:"border-b border-gray-50 last:border-0 hover:bg-blue-50/30",children:[e.jsxs("td",{className:"py-1 text-gray-600 font-medium",children:[r.thickness," mm"]}),e.jsxs("td",{className:"py-1 text-right font-bold text-blue-700",children:["₹",r.rs.toFixed(2)]})]},o))})})})]}),e.jsxs("div",{className:"border border-orange-100 bg-white rounded-lg shadow-sm p-3",children:[e.jsxs("h3",{className:"text-[11px] font-bold text-orange-500 uppercase mb-2 flex justify-between",children:["Outer Rates: ",e.jsx("span",{className:"text-orange-700",children:D||"None"})]}),e.jsx("div",{className:"max-h-[150px] overflow-y-auto border-t border-orange-50 pt-2",children:e.jsx("table",{className:"min-w-full text-[11px]",children:e.jsx("tbody",{children:(D?de[D]:[]).map((r,o)=>e.jsxs("tr",{className:"border-b border-gray-50 last:border-0 hover:bg-orange-50/30",children:[e.jsxs("td",{className:"py-1 text-gray-600 font-medium",children:[r.thickness," mm"]}),e.jsxs("td",{className:"py-1 text-right font-bold text-orange-700",children:["₹",r.rs.toFixed(2)]})]},o))})})})]})]}),e.jsx("div",{className:"overflow-x-auto rounded-lg border border-gray-200 shadow-sm",children:e.jsxs("table",{className:"min-w-full text-sm text-center",children:[e.jsxs("thead",{className:"bg-blue-50 text-gray-600 font-bold",children:[e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 border-r border-gray-200",rowSpan:2,children:"Image"}),e.jsx("th",{className:"px-4 py-3 border-r border-gray-200",rowSpan:2,children:"Item Name"}),e.jsx("th",{className:"px-4 py-1 border-r border-gray-200",colSpan:2,children:"Plywood"}),e.jsx("th",{className:"px-4 py-1 border-r border-gray-200",colSpan:4,children:"Laminate"}),e.jsx("th",{className:"px-4 py-3 border-r border-gray-200",rowSpan:2,children:"Carpenters/Day"}),e.jsx("th",{className:"px-4 py-3 border-r border-gray-200",rowSpan:2,children:"Days"}),e.jsx("th",{className:"px-4 py-3 border-r border-gray-200",rowSpan:2,children:"Profit % Material"}),e.jsx("th",{className:"px-4 py-3 border-r border-gray-200",rowSpan:2,children:"Profit % Labour"}),e.jsx("th",{className:"px-4 py-3 border-r border-gray-200",rowSpan:2,children:"Remarks"}),e.jsx("th",{className:"px-4 py-3",rowSpan:2,children:"Row Total"})]}),e.jsxs("tr",{className:"border-t border-gray-200 bg-blue-50/50",children:[e.jsx("th",{className:"px-2 py-2 text-[10px] uppercase border-r border-gray-200",children:"Thk"}),e.jsx("th",{className:"px-2 py-2 text-[10px] uppercase border-r border-gray-200",children:"Qty"}),e.jsx("th",{className:"px-2 py-2 text-[10px] uppercase border-r border-gray-200",children:"Outer Thk"}),e.jsx("th",{className:"px-2 py-2 text-[10px] uppercase border-r border-gray-200",children:"Outer Qty"}),e.jsx("th",{className:"px-2 py-2 text-[10px] uppercase border-r border-gray-200",children:"Inner Thk"}),e.jsx("th",{className:"px-2 py-2 text-[10px] uppercase border-r border-gray-200",children:"Inner Qty"})]})]}),e.jsx("tbody",{children:b.map((r,o)=>{var u,x,w,P;return e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50/50 transition-colors",children:[o===0&&e.jsx("td",{rowSpan:b.length,className:"p-2 border-r border-gray-100 bg-white",children:e.jsx("img",{src:r.imageUrl||We,className:"h-12 mx-auto rounded shadow-sm"})}),e.jsx("td",{className:"p-2 border-r border-gray-100 font-medium",children:r.itemName||"—"}),e.jsx("td",{className:"p-2 border-r border-gray-100 bg-gray-50 text-gray-500 font-mono",children:r.plywoodNos.thickness}),e.jsx("td",{className:"p-2 border-r border-gray-100 bg-gray-50 text-gray-500 font-mono",children:r.plywoodNos.quantity}),e.jsx("td",{className:"p-2 border-r border-gray-100 bg-gray-50 text-gray-500 font-mono",children:((u=r.outerLaminate)==null?void 0:u.thickness)||0}),e.jsx("td",{className:"p-2 border-r border-gray-100 bg-gray-50 text-gray-500 font-mono",children:((x=r.outerLaminate)==null?void 0:x.quantity)||0}),e.jsx("td",{className:"p-2 border-r border-gray-100 bg-gray-50 text-gray-500 font-mono",children:((w=r.innerLaminate)==null?void 0:w.thickness)||0}),e.jsx("td",{className:"p-2 border-r border-gray-100 bg-gray-50 text-gray-500 font-mono",children:((P=r.innerLaminate)==null?void 0:P.quantity)||0}),o===0&&e.jsxs(e.Fragment,{children:[e.jsx("td",{rowSpan:b.length,className:"p-2 border-r border-gray-100 bg-gray-50 text-gray-500 font-mono",children:r.carpenters}),e.jsx("td",{rowSpan:b.length,className:"p-2 border-r border-gray-100 bg-gray-50 text-gray-500 font-mono",children:r.days})]}),e.jsx("td",{className:"p-2 border-r border-gray-100",children:e.jsx("input",{type:"number",value:r.profitOnMaterial,onChange:I=>{const y=[...b];y[o].profitOnMaterial=parseFloat(I.target.value)||0,xe(y),ue()},className:"w-16 border border-blue-100 rounded text-center py-1 font-semibold focus:ring-1 focus:ring-blue-400 outline-none"})}),o===0&&e.jsx("td",{rowSpan:b.length,className:"p-2 border-r border-gray-100",children:e.jsx("input",{type:"number",value:r.profitOnLabour,onChange:I=>{const y=[...b];y[0].profitOnLabour=parseFloat(I.target.value)||0,xe(y),ue()},className:"w-16 border border-blue-100 rounded text-center py-1 font-semibold focus:ring-1 focus:ring-blue-400 outline-none"})}),e.jsx("td",{className:"p-2 border-r border-gray-100 text-gray-400 text-[11px] italic",children:r.remarks||"—"}),e.jsxs("td",{className:"p-2 font-bold text-green-600",children:["₹",Math.round(ee(r,b)).toLocaleString("en-IN")]})]},o)})})]})}),te("Fittings & Accessories",S,"Fittings"),te("Glues",M,"Glues"),te("Non-Branded Materials",Z,"NBMs")]})}),at=0,ct=()=>{var Me,le,F;const{organizationId:L,quoteId:$}=He(),m=ze(),{data:d,isLoading:v}=Ye(L,$);let{data:N,isLoading:Q}=Oe(L,"plywood"),{data:ie}=Oe(L,"inner laminate"),{data:de}=Oe(L,"outer laminate");console.log("materialBrands",N),console.log("innerLaminateBrands",ie),console.log("outerLaminateBrands",de);const[fe,Le]=c.useState({categoryId:"",categoryName:""});let{data:j=0}=et({organizationId:L,categoryId:fe.categoryId}),{data:C=[]}=tt(L);const f=(C||[]).map(a=>({value:a._id,label:a.name})),{mutateAsync:ue,isPending:me}=Ze(),E=c.useRef([]),[A,K]=c.useState(null),[q,J]=c.useState(null),[D,X]=c.useState(null),[ye,re]=c.useState(null),[Ne,ae]=c.useState(null),[je,ne]=c.useState(null),[b,xe]=c.useState(0),[S,pe]=c.useState(0);c.useEffect(()=>{d&&(xe((d==null?void 0:d.globalTransportation)||0),pe((d==null?void 0:d.globalProfitPercent)||0),se((d==null?void 0:d.commonProfitOverride)||0))},[d]);const[M,Y]=c.useState([]),[Z,se]=c.useState(0);c.useEffect(()=>{d!=null&&d.commonMaterials&&Y(d.commonMaterials)},[d]);const{role:ve,permission:_}=$e(),Se=ve==="owner"||((Me=_==null?void 0:_.quotevariant)==null?void 0:Me.create),V=ve==="owner"||((le=_==null?void 0:_.quotevariant)==null?void 0:le.edit),oe=a=>{if(!a)return{};const t={};return a.forEach(l=>{var i,p;const s=(l==null?void 0:l.data)||{},n=(i=s.Brand??s.brand)==null?void 0:i.trim(),h=(p=String(s["thickness (mm)"]||s.thickness||s.Thickness))==null?void 0:p.trim(),g=parseFloat(s.Rs||s.rs||s.rS);n&&h&&g&&(t[n]||(t[n]=[]),t[n].push({thickness:h,rs:g,id:l._id}))}),t},ee=c.useMemo(()=>oe(N),[N]),U=c.useMemo(()=>oe(ie),[ie]),he=c.useMemo(()=>oe(de),[de]),Ce=c.useMemo(()=>Object.keys(ee).map(a=>{var t;return{label:a,value:((t=ee[a][0])==null?void 0:t.id)||a}}),[ee]),k=c.useMemo(()=>Object.keys(U).map(a=>{var t;return{label:a,value:((t=U[a][0])==null?void 0:t.id)||a}}),[U]),O=c.useMemo(()=>Object.keys(he).map(a=>{var t;return{label:a,value:((t=he[a][0])==null?void 0:t.id)||a}}),[he]),W=c.useMemo(()=>{if(!N)return{};const a={};return N.forEach(t=>{const l=(t==null?void 0:t.data)||{},s=l.Brand??l.brand,n=l["thickness (mm)"]||l.thickness||l.Thickness;let h=l.Rs||l.rs;if(s&&n&&h){const g=String(s).trim(),i=String(n).trim(),p=parseFloat(h);a[g]||(a[g]=[]),a[g].push({thickness:i,rs:p,id:t._id})}}),a},[N]),G=c.useMemo(()=>Object.keys(W).map(a=>{var t;return{label:a,value:((t=W[a][0])==null?void 0:t.id)||a}}),[W]),[T,te]=c.useState([]),[r,o]=c.useState(0),[u,x]=c.useState(0),w=(a,t)=>{te(l=>{const s=[...l],n=s[a];return s[a]={...n,furnitureProfit:t,coreMaterials:n.coreMaterials.map(h=>({...h,profitOnMaterial:0,profitOnLabour:0})),fittingsAndAccessories:n.fittingsAndAccessories.map(h=>({...h,profitOnMaterial:0})),nonBrandMaterials:n.nonBrandMaterials.map(h=>({...h,profitOnMaterial:0}))},s}),setTimeout(()=>P(),0)},P=()=>{const t=E.current.map(n=>n.current).filter(n=>n!==null).map(n=>n.getUpdatedFurniture()).reduce((n,h)=>n+h.totals.furnitureTotal,0),l=M.reduce((n,h)=>n+(h.rowTotal||0),0),s=Math.round(t+l);o(s),x(we())},{profitDifference:I,profitPercentage:y}=c.useMemo(()=>{const a=r-u,t=u>0?a/u*100:0;return{profitDifference:Math.round(a),profitPercentage:t}},[r,u]),we=()=>{const a=E.current.map(s=>s.current).filter(s=>s!==null).map(s=>s.getUpdatedFurniture()),t=32;let l=0;return a.forEach(s=>{const n=s.plywoodBrand?W[s.plywoodBrand]||[]:[],h=s.innerLaminateBrand?U[s.innerLaminateBrand]||[]:[],g=s.outerLaminateBrand?he[s.outerLaminateBrand]||[]:[],i=s.coreMaterials,p=i[0],R=((p==null?void 0:p.carpenters)||0)*((p==null?void 0:p.days)||0)*j,H=i.length>0?R/i.length:0,z=i.length>0?(s.fabricationCost||0)/i.length:0;i.forEach(B=>{var Ee,Ae,Ge,Qe;const ce=be(B.plywoodNos.thickness,n,"plywood"),qe=be(((Ee=B.innerLaminate)==null?void 0:Ee.thickness)||0,h,"laminate"),De=be(((Ae=B.outerLaminate)==null?void 0:Ae.thickness)||0,g,"laminate"),_e=B.plywoodNos.quantity*(ce*t),Ve=(((Ge=B.innerLaminate)==null?void 0:Ge.quantity)||0)*(qe*t),Ue=(((Qe=B.outerLaminate)==null?void 0:Qe.quantity)||0)*(De*t);l+=_e+Ve+Ue+H+z});const Fe=B=>(B.quantity||0)*(B.cost||0);l+=s.fittingsAndAccessories.reduce((B,ce)=>B+Fe(ce),0),l+=s.glues.reduce((B,ce)=>B+(ce.cost||0),0),l+=s.nonBrandMaterials.reduce((B,ce)=>B+Fe(ce),0)}),l+=M.reduce((s,n)=>s+(n.quantity||0)*(n.cost||0),0),Math.round(l)},Te=(a,t)=>{const s=T.reduce((i,p)=>i+p.coreMaterials.length+p.fittingsAndAccessories.length+p.glues.length+p.nonBrandMaterials.length,0)+M.length,n=s>0?b/s:0,g=1+(Z??S)/100;Y(i=>{const p=[...i],R=p[a],H=(R.quantity||0)*(R.cost||0),z=t>0?1+t/100:g;return p[a]={...R,profitOnMaterial:t,rowTotal:Math.round(H*z+n)},p}),setTimeout(()=>P(),0)},Pe=()=>e.jsx("div",{className:"overflow-x-auto rounded-xl border border-gray-200 shadow-sm",children:e.jsxs("table",{className:"min-w-full text-sm bg-white",children:[e.jsx("thead",{className:"bg-blue-50 text-blue-800 font-bold uppercase text-[11px]",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Item Name"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Description"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Quantity"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Cost"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Profit %"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Total"})]})}),e.jsx("tbody",{children:M.map((a,t)=>{var l,s;return e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-blue-50/20 transition-colors",children:[e.jsx("td",{className:"p-3 border-r border-gray-100 text-center font-medium text-gray-700",children:a.itemName||"—"}),e.jsx("td",{className:"p-3 border-r border-gray-100 text-center text-gray-500",children:a.description||"—"}),e.jsx("td",{className:"p-3 border-r border-gray-100 text-center  text-gray-500",children:a.quantity}),e.jsxs("td",{className:"p-3 border-r border-gray-100 text-center  text-gray-500",children:["₹",(l=a.cost)==null?void 0:l.toLocaleString("en-IN")]}),e.jsx("td",{className:"p-3 border-r border-gray-100 text-center ",children:e.jsx("input",{type:"number",value:a.profitOnMaterial||0,onKeyDown:n=>{(n.key==="-"||n.key==="e")&&n.preventDefault()},onChange:n=>{const h=Math.max(0,parseFloat(n.target.value)||0);Te(t,h)},className:"w-16 text-center border border-blue-200 rounded py-1 font-semibold  outline-none focus:ring-1 focus:ring-blue-400"})}),e.jsxs("td",{className:"p-3 text-center font-black text-green-700 bg-green-50/20",children:["₹",(s=a.rowTotal)==null?void 0:s.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})]})]},t)})})]})});c.useEffect(()=>{if(console.log("is it getting called here "),!T.length)return;const t=T.reduce((i,p)=>i+p.coreMaterials.length+p.fittingsAndAccessories.length+p.glues.length+p.nonBrandMaterials.length,0)+M.length,l=t>0?b/t:0,s=T.map(i=>{if(i.coreMaterials.length===0)return i;const p=S??i.furnitureProfit??0;return{...i,furnitureProfit:p}}),h=1+(Z??S)/100,g=M.map(i=>{const p=(i.quantity||0)*(i.cost||0),R=(i.profitOnMaterial||0)>0?p*(1+(i.profitOnMaterial||0)/100):p*h;return{...i,rowTotal:R+l}});te(s),Y(g),setTimeout(()=>P(),0)},[b,S,j,M.length,Z]);const Re=async()=>{var a,t;try{if(!L||!$||!d||!A){ke({title:"Missing info",description:"Please ensure brand and all details are selected",variant:"destructive"});return}const l=E.current.map(i=>i.current).filter(i=>i!==null).map(i=>i.getUpdatedFurniture()),s=l.reduce((i,p)=>i+p.totals.furnitureTotal,0),n=M.map(i=>({...i,rowTotal:Math.round(i.rowTotal||0)})),h=n.reduce((i,p)=>i+p.rowTotal,0),g=Math.round(s+h)||0;await ue({quoteId:$,organizationId:L,data:{quoteId:$,organizationId:L,projectId:d.projectId,brandName:A,innerLaminateBrand:q,outerLaminateBrand:D,plywoodBrandId:ye,innerLaminateId:Ne,outerLaminateId:je,mainQuoteName:d.mainQuoteName,quoteType:d.quoteType,commonMaterials:n,globalTransportation:b,globalProfitPercent:S,furnitures:l,grandTotal:g,notes:"Generated with brand variant"}}),ke({title:"success",description:"Successfully created, check it in the Quote for clients section"})}catch(l){ke({title:"Error",description:((t=(a=l==null?void 0:l.response)==null?void 0:a.data)==null?void 0:t.message)??"Operation failed",variant:"destructive"})}},Be=c.useRef(!0);return c.useEffect(()=>{if(!(!d||!G.length||!k.length||!O.length)&&Be.current){const a=G.find(n=>n.value===d.plywoodBrandId)||null,t=k.find(n=>n.value===d.innerLaminateId)||null,l=O.find(n=>n.value===d.outerLaminateId)||null;K((a==null?void 0:a.label)||null),re((a==null?void 0:a.value)||null),J((t==null?void 0:t.label)||null),ae((t==null?void 0:t.value)||null),X((l==null?void 0:l.label)||null),ne((l==null?void 0:l.value)||null);const s=d.furnitures.map(n=>{var p,R,H;const h=n.plywoodBrandId||d.plywoodBrandId||null,g=n.innerLaminateBrandId||d.innerLaminateId||null,i=n.outerLaminateBrandId||d.outerLaminateId||null;return{...n,totals:{core:n.coreMaterialsTotal||0,fittings:n.fittingsAndAccessoriesTotal||0,glues:n.gluesTotal||0,nbms:n.nonBrandMaterialsTotal||0,furnitureTotal:n.furnitureTotal||0},plywoodBrandId:h,innerLaminateBrandId:g,outerLaminateBrandId:i,plywoodBrand:((p=G.find(z=>z.value===h))==null?void 0:p.label)||null,innerLaminateBrand:((R=k.find(z=>z.value===g))==null?void 0:R.label)||null,outerLaminateBrand:((H=O.find(z=>z.value===i))==null?void 0:H.label)||null}});te(s),xe(d.globalTransportation||0),pe(d.globalProfitPercent||0),se(d.commonProfitOverride||0),Be.current=!1}},[d,G,k,O]),E.current.length!==T.length&&(E.current=T.map((a,t)=>E.current[t]??Ke.createRef())),c.useEffect(()=>{E.current=T.map((a,t)=>E.current[t]??c.createRef())},[T]),c.useEffect(()=>{var a,t;fe.categoryId===""&&(f==null?void 0:f.length)>0&&Le({categoryId:(a=f[0])==null?void 0:a.value,categoryName:(t=f[0])==null?void 0:t.label})},[f]),e.jsxs("div",{className:"p-2 max-h-full overflow-y-auto",children:[e.jsxs("header",{className:"bg-white border-b border-gray-200 pb-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("button",{onClick:()=>m(-1),className:"flex items-center justify-center w-8 h-8 bg-gray-50 hover:bg-gray-100 border border-gray-300 rounded-md transition-colors flex-shrink-0",children:e.jsx("i",{className:"fas fa-arrow-left text-gray-600 text-sm"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900 truncate",children:((F=d==null?void 0:d.projectId)==null?void 0:F.projectName)||"Project"}),e.jsx("p",{className:"text-md text-gray-500",children:d!=null&&d.quoteNo?`Quote: #${d==null?void 0:d.quoteNo}`:""})]})]}),(Se||V)&&e.jsx(Je,{onClick:Re,disabled:me,className:"flex-shrink-0",children:me?"Generating...":"Generate Quote for Client"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 bg-gray-50 p-3 rounded-xl border border-gray-200",children:[e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"text-[10px] font-bold text-gray-500 uppercase",children:"Plywood Brand"}),e.jsx(ge,{options:G,placeholder:"Select Plywood",value:ye||"",onValueChange:a=>{const t=G.find(l=>l.value===a);K((t==null?void 0:t.label)||a),re((t==null?void 0:t.value)||null)}})]}),e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"text-[10px] font-bold text-blue-600 uppercase",children:"Inner Laminate"}),e.jsx(ge,{options:k,placeholder:"Select Inner Brand",value:Ne||"",onValueChange:a=>{const t=k.find(l=>l.value===a);J((t==null?void 0:t.label)||a),ae((t==null?void 0:t.value)||null)}})]}),e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"text-[10px] font-bold text-orange-600 uppercase",children:"Outer Laminate"}),e.jsx(ge,{options:O,placeholder:"Select Outer Brand",value:je||"",onValueChange:a=>{const t=O.find(l=>l.value===a);X((t==null?void 0:t.label)||a),ne((t==null?void 0:t.value)||null)}})]})]}),e.jsxs("div",{className:" grid grid-cols-4 gap-2",children:[e.jsx(Ie,{className:"px-2 py-4 border-l-4 border-blue-600",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-md text-gray-600",children:["Project Cost "," "," ",e.jsx("span",{className:"font-bold",children:"(without profit)"})]}),e.jsxs("p",{className:"text-md font-bold text-blue-600",children:["₹",u.toLocaleString("en-IN")]})]})}),e.jsx(Ie,{className:"px-2 py-4 border-l-4 border-green-600",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-md text-gray-600",children:["Client Quote Amount "," "," ",e.jsx("span",{className:"font-bold",children:"(with profit)"})]}),e.jsxs("p",{className:"text-md font-bold text-green-600",children:["₹",r.toLocaleString("en-IN")]})]})}),e.jsx(Ie,{className:"px-2 py-4 border-l-4 border-violet-600",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-md text-gray-600",children:"Profit Amount"}),e.jsxs("p",{className:"text-md font-bold text-violet-600",children:["₹",I.toLocaleString("en-IN")," ",e.jsxs("span",{className:"text-black !text-[12px] ml-[5px] font-semibold",children:["(",y.toFixed(2),"%)"]})]})]})}),e.jsx(Ie,{className:"px-2 py-4 border-l-4 border-orange-600",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-md text-gray-600",children:"Single Labour Cost"}),e.jsxs("p",{className:"text-md font-bold text-orange-600",children:["₹",j]})]})})]})]}),v||Q?e.jsx(Xe,{}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-6",children:[T.map((a,t)=>e.jsx(rt,{index:t,data:a,labourCost:j,ref:E.current[t],brandRatesByName:ee,innerLaminateRatesByBrand:U,outerLaminateRatesByBrand:he,selectedBrand:A,selectedInnerBrand:q,selectedOuterBrand:D,brandOptions:Ce,innerOptions:k,outerOptions:O,globalTransportation:b,globalProfitPercent:S,onFurnitureChange:P,onProfitOverride:l=>w(t,l)},t)),M.length>0&&e.jsxs("div",{className:"mt-10 bg-white border-2 border-dashed border-blue-200 rounded-2xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-blue-100 p-2 rounded-lg",children:e.jsx("i",{className:"fas fa-tools text-blue-600 text-xl"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Common Site Materials"}),e.jsx("p",{className:"text-xs text-gray-500 italic",children:"Quantities are fixed. Only Profit % can be adjusted for variants."})]})]}),e.jsxs("div",{className:"text-right flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-blue-50 px-3 py-1 rounded-lg border border-blue-100 shadow-sm",children:[e.jsx("label",{className:"text-[10px] font-bold text-blue-500 uppercase tracking-tighter",children:"Common Profit Overlay"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"number",className:"w-12 text-right font-black bg-transparent outline-none text-blue-800",value:Z??S,placeholder:"0",onChange:a=>{const t=a.target.value===""?0:parseFloat(a.target.value);se(t),Y(l=>l.map(s=>({...s,profitOnMaterial:0})))}}),e.jsx("span",{className:"text-blue-600 font-black ml-1 text-sm",children:"%"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-bold text-blue-500 uppercase",children:"Section Total"}),e.jsxs("p",{className:"text-2xl font-black text-blue-700",children:["₹",M.reduce((a,t)=>a+(t.rowTotal||0),0).toLocaleString("en-IN")]})]})]})]}),Pe()]}),e.jsx("div",{className:"flex items-center justify-between gap-4 bg-white border border-blue-100 p-4 rounded-xl shadow-sm mt-8",children:e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-[10px] font-extrabold text-blue-500 uppercase tracking-tighter",children:"Global Transport Cost"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-gray-400 mr-1 text-sm font-bold",children:"₹"}),e.jsx("span",{className:"font-bold text-gray-800",children:b.toLocaleString("en-IN")})]})]}),e.jsx("div",{className:"h-10 w-px bg-gray-100"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-[10px] font-extrabold text-green-500 uppercase tracking-tighter",children:"Global Profit Margin (%)"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"number",className:"w-16 text-right font-black focus:outline-none text-green-700 bg-green-50 rounded px-2 py-1 border border-green-100",value:S,onChange:a=>{const t=parseFloat(a.target.value)||0;pe(t),se(t),te(l=>l.map(s=>({...s,furnitureProfit:t,coreMaterials:s.coreMaterials.map(n=>({...n,profitOnMaterial:0,profitOnLabour:0})),fittingsAndAccessories:s.fittingsAndAccessories.map(n=>({...n,profitOnMaterial:0})),glues:s.glues.map(n=>({...n,profitOnMaterial:0})),nonBrandMaterials:s.nonBrandMaterials.map(n=>({...n,profitOnMaterial:0}))}))),Y(l=>l.map(s=>({...s,profitOnMaterial:0})))}}),e.jsx("span",{className:"text-green-500 ml-1 font-bold text-sm",children:"%"})]}),e.jsx("p",{className:"text-[9px] text-gray-400 italic",children:"Overrides all product margins"})]})]})}),e.jsx("section",{className:"mt-10 text-right",children:e.jsxs("div",{className:"inline-block bg-green-50 border border-green-200 rounded-md px-6 py-4",children:[e.jsx("p",{className:"text-md font-medium text-gray-700 mb-1",children:"Total Estimate"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700",children:["₹",r.toLocaleString("en-IN")]})]})})]})})]})};export{at as DEFAULT_LAMINATE_RATE_PER_SQFT,ct as default};
