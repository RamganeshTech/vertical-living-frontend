import{r as i,R as y,G as p,j as u,H as v,I as S,J as H}from"./index-BAM0eJUz.js";import{a as T}from"./logisticsApi-Qwzfztbq.js";import{r as k}from"./index-C8BdbktQ.js";const ue=(t,e,n)=>{const{mutate:r,isPending:a,data:o}=T();return i.useEffect(()=>{if(!e||!t)return;const c=navigator.geolocation.watchPosition(l=>{r({shipmentId:t,latitude:l.coords.latitude,longitude:l.coords.longitude},{onSuccess:s=>{s.ok&&n&&n()}})},l=>console.error("GPS Error:",l),{enableHighAccuracy:!0,maximumAge:0,timeout:5e3});return()=>navigator.geolocation.clearWatch(c)},[t,e,r]),{isUpdating:a,data:o}};function R(t,e){const n=i.useRef(e);i.useEffect(function(){e!==n.current&&t.attributionControl!=null&&(n.current!=null&&t.attributionControl.removeAttribution(n.current),e!=null&&t.attributionControl.addAttribution(e)),n.current=e},[t,e])}const P=1;function U(t){return Object.freeze({__version:P,map:t})}function V(t,e){return Object.freeze({...t,...e})}const g=i.createContext(null);function h(){const t=i.use(g);if(t==null)throw new Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return t}function _(t){function e(n,r){const{instance:a,context:o}=t(n).current;i.useImperativeHandle(r,()=>a);const{children:c}=n;return c==null?null:y.createElement(g,{value:o},c)}return i.forwardRef(e)}function B(t){function e(n,r){const[a,o]=i.useState(!1),{instance:c}=t(n,o).current;i.useImperativeHandle(r,()=>c),i.useEffect(function(){a&&c.update()},[c,a,n.children]);const l=c._contentNode;return l?k.createPortal(n.children,l):null}return i.forwardRef(e)}function G(t){function e(n,r){const{instance:a}=t(n).current;return i.useImperativeHandle(r,()=>a),null}return i.forwardRef(e)}function E(t,e){const n=i.useRef(void 0);i.useEffect(function(){return e!=null&&t.instance.on(e),n.current=e,function(){n.current!=null&&t.instance.off(n.current),n.current=null}},[t,e])}function b(t,e){const n=t.pane??e.pane;return n?{...t,pane:n}:t}function F(t,e){return function(r,a){const o=h(),c=t(b(r,o),o);return R(o.map,r.attribution),E(c.current,r.eventHandlers),e(c.current,o,r,a),c}}function C(t,e,n){return Object.freeze({instance:t,context:e,container:n})}function j(t,e){return e==null?function(r,a){const o=i.useRef(void 0);return o.current||(o.current=t(r,a)),o}:function(r,a){const o=i.useRef(void 0);o.current||(o.current=t(r,a));const c=i.useRef(r),{instance:l}=o.current;return i.useEffect(function(){c.current!==r&&(e(l,r,c.current),c.current=r)},[l,r,e]),o}}function Z(t,e){i.useEffect(function(){return(e.layerContainer??e.map).addLayer(t.instance),function(){var o;(o=e.layerContainer)==null||o.removeLayer(t.instance),e.map.removeLayer(t.instance)}},[e,t])}function N(t){return function(n){const r=h(),a=t(b(n,r),r);return R(r.map,n.attribution),E(a.current,n.eventHandlers),Z(a.current,r),a}}function J(t,e){const n=j(t,e),r=N(n);return _(r)}function W(t,e){const n=j(t),r=F(n,e);return B(r)}function X(t,e){const n=j(t,e),r=N(n);return G(r)}function q(t,e,n){const{opacity:r,zIndex:a}=e;r!=null&&r!==n.opacity&&t.setOpacity(r),a!=null&&a!==n.zIndex&&t.setZIndex(a)}function O(){return h().map}function K({bounds:t,boundsOptions:e,center:n,children:r,className:a,id:o,placeholder:c,style:l,whenReady:s,zoom:d,...x},I){const[z]=i.useState({className:a,id:o,style:l}),[f,A]=i.useState(null),w=i.useRef(void 0);i.useImperativeHandle(I,()=>(f==null?void 0:f.map)??null,[f]);const D=i.useCallback(L=>{if(L!==null&&!w.current){const m=new p.Map(L,x);w.current=m,n!=null&&d!=null?m.setView(n,d):t!=null&&m.fitBounds(t,e),s!=null&&m.whenReady(s),A(U(m))}},[]);i.useEffect(()=>()=>{f==null||f.map.remove()},[f]);const M=f?y.createElement(g,{value:f},r):c??null;return y.createElement("div",{...z,ref:D},M)}const Q=i.forwardRef(K),Y=J(function({position:e,...n},r){const a=new p.Marker(e,n);return C(a,V(r,{overlayContainer:a}))},function(e,n,r){n.position!==r.position&&e.setLatLng(n.position),n.icon!=null&&n.icon!==r.icon&&e.setIcon(n.icon),n.zIndexOffset!=null&&n.zIndexOffset!==r.zIndexOffset&&e.setZIndexOffset(n.zIndexOffset),n.opacity!=null&&n.opacity!==r.opacity&&e.setOpacity(n.opacity),e.dragging!=null&&n.draggable!==r.draggable&&(n.draggable===!0?e.dragging.enable():e.dragging.disable())}),$=W(function(e,n){const r=new p.Popup(e,n.overlayContainer);return C(r,n)},function(e,n,{position:r},a){i.useEffect(function(){const{instance:c}=e;function l(d){d.popup===c&&(c.update(),a(!0))}function s(d){d.popup===c&&a(!1)}return n.map.on({popupopen:l,popupclose:s}),n.overlayContainer==null?(r!=null&&c.setLatLng(r),c.openOn(n.map)):n.overlayContainer.bindPopup(c),function(){var x;n.map.off({popupopen:l,popupclose:s}),(x=n.overlayContainer)==null||x.unbindPopup(),n.map.removeLayer(c)}},[e,n,a,r])}),ee=X(function({url:e,...n},r){const a=new p.TileLayer(e,b(n,r));return C(a,r)},function(e,n,r){q(e,n,r);const{url:a}=n;a!=null&&a!==r.url&&e.setUrl(a)});let ne=v.icon({iconUrl:H,shadowUrl:S,iconSize:[25,41],iconAnchor:[12,41]});v.Marker.prototype.options.icon=ne;const te=({center:t})=>{const e=O(),n=()=>{e.flyTo(t,15,{animate:!0,duration:1.5})};return u.jsx("div",{className:"leaflet-bottom leaflet-right",style:{marginBottom:"20px",marginRight:"10px"},children:u.jsx("div",{className:"leaflet-control  border-none shadow-none",children:u.jsx("button",{onClick:r=>{r.preventDefault(),n()},className:"bg-white hover:bg-slate-50 text-blue-600 w-12 h-12 rounded-full flex items-center justify-center shadow-2xl transition-all border-2 border-blue-100 active:scale-90",title:"Recenter to Driver",style:{cursor:"pointer"},children:u.jsx("i",{className:"fas fa-crosshairs text-xl"})})})})},re=({center:t})=>{const e=O();return i.useEffect(()=>{t[0]&&t[1]&&e.panTo(t,{animate:!0})},[t,e]),null},ae=()=>v.divIcon({className:"custom-vehicle-marker",html:`
      <div style="
        background-color: #4285F4;
        width: 32px;
        height: 32px;
        border-radius: 50%;
        border: 3px solid white;
        box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
      ">
        ðŸšš
      </div>
    `,iconSize:[32,32],iconAnchor:[16,16]}),le=({shipment:t,currentLocation:e})=>{var c,l,s;const n=i.useRef(null),r=(e==null?void 0:e.latitude)||0,a=(e==null?void 0:e.longitude)||0;if(!r||!a)return u.jsx("div",{className:"flex items-center justify-center h-96 bg-gray-100 rounded-lg",children:u.jsxs("div",{className:"text-center",children:[u.jsx("i",{className:"fas fa-map-marked-alt text-4xl text-gray-300 mb-3"}),u.jsx("p",{className:"text-gray-700",children:"No location data available"})]})});const o=[r,a];return u.jsx("div",{className:"space-y-4 min-w-full",children:u.jsx("div",{className:"w-full h-96 rounded-lg border border-gray-300 shadow-sm overflow-hidden",children:u.jsxs(Q,{center:o,zoom:13,style:{height:"100%",width:"100%"},ref:n,children:[u.jsx(ee,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),u.jsx(re,{center:o}),u.jsx(te,{center:o}),u.jsx(Y,{position:o,icon:ae(),children:u.jsx($,{children:u.jsxs("div",{className:"p-2",children:[u.jsx("h3",{className:"font-bold text-sm mb-1",children:((c=t==null?void 0:t.vehicleDetails)==null?void 0:c.vehicleNumber)||"Vehicle"}),u.jsxs("p",{className:"text-xs text-gray-600",children:["Driver: ",((s=(l=t==null?void 0:t.vehicleDetails)==null?void 0:l.driver)==null?void 0:s.name)||"N/A"]}),u.jsxs("p",{className:"text-xs text-gray-600",children:["Status: ",u.jsx("span",{className:"font-semibold",children:(t==null?void 0:t.shipmentStatus)||"N/A"})]}),u.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Last updated: ",e.updatedAt?new Date(e.updatedAt).toLocaleTimeString():"N/A"]}),u.jsxs("p",{className:"text-xs text-gray-400 mt-1 font-mono",children:[r.toFixed(6),", ",a.toFixed(6)]})]})})})]})})})};export{le as L,ue as u};
