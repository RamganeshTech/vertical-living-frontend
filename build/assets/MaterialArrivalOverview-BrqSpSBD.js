import{b as H,a as J,e as Q,r as j,j as e,O as V,B as x,I as m,t as u}from"./index-JxDlpqED.js";import{c as X}from"./Card-k7cnv6-m.js";import{G as Y}from"./GenerateWhatsappLink-CpxKgxE0.js";import{A as D,S as K}from"./AssignStaff-CImI9i7H.js";import{R as ee}from"./ResetStageButton-C0E3UjXl.js";import se from"./MaterialOverviewLoading-BSabl9op.js";import{u as ae,a as te,b as le,c as re,d as ie,e as ne}from"./materialArrivalApi-BhdReA-P.js";import{S as ce}from"./ShareDocumentWhatsapp-iHbfFZbf.js";import"./getAllUsersApi-C5NzaZfv.js";import"./Skeleton-DUWdTQlJ.js";import"./documentationApi-dpZ0n6XV.js";const ve=()=>{var S,C;const{projectId:o,organizationId:y}=H(),A=J(),{isMobile:k,openMobileSidebar:P}=Q(),M=location.pathname.includes("/materialarrivalroom/"),[E,N]=j.useState(!1),[L,v]=j.useState(!1),[i,h]=j.useState({}),[n,p]=j.useState({}),{data:t,isLoading:I,isError:b,error:g,refetch:f}=ae(o),{mutateAsync:O}=te(),{mutateAsync:F}=le(),{mutateAsync:U,isPending:R}=re(),{mutateAsync:G,isPending:$}=ie(),{mutateAsync:B,isPending:T}=ne();if(I)return e.jsx(se,{});const{shopDetails:l,deliveryLocationDetails:r,materialArrivalList:w,timer:d,generatedLink:z}=t||{},W=Object.keys(w||{}),Z=async()=>{var s,c;try{if(i.phoneNumber&&!/^\d{10}$/.test(i.phoneNumber.trim()))throw new Error("Phone number should contain exactly 10 digit numbers");await O({projectId:o,updates:i}),u({title:"Success",description:"Shop details updated"}),N(!1),f()}catch(a){u({variant:"destructive",title:"Error",description:((c=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:c.message)||(a==null?void 0:a.message)||"Update failed"})}},_=async()=>{var s,c;try{if(n.phoneNumber&&!/^\d{10}$/.test(n.phoneNumber.trim()))throw new Error("Phone number should contain exactly 10 digit numbers");await F({projectId:o,updates:n}),u({title:"Success",description:"Delivery location updated"}),v(!1),f()}catch(a){u({variant:"destructive",title:"Error",description:((c=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:c.message)||(a==null?void 0:a.message)||"Update failed"})}},q=async()=>{var s,c;try{await B({projectId:o}),u({description:"Completion status updated successfully",title:"Success"})}catch(a){u({title:"Error",description:((c=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:c.message)||(a==null?void 0:a.message)||"Failed to update completion status",variant:"destructive"})}};return e.jsx("div",{className:"w-full h-full flex flex-col p-2 ",children:M?e.jsx(V,{}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex-shrink-0 flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-4 pb-3 ",children:[e.jsxs("h2",{className:"text-2xl sm:text-2xl lg:text-2xl xl:text-3xl font-semibold text-blue-600 flex items-center",children:[k&&e.jsx("button",{onClick:P,className:"mr-3 p-2 rounded-md border-gray-300 hover:bg-gray-100",title:"Open Menu",children:e.jsx("i",{className:"fa-solid fa-bars"})}),e.jsx("i",{className:"fa-solid fa-receipt mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Material Checking"}),e.jsx("span",{className:"sm:hidden",children:"Material Check"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full sm:w-auto",children:[e.jsxs(x,{isLoading:T,onClick:q,className:"bg-green-600 hover:bg-green-700 text-white w-full sm:w-auto whitespace-nowrap",children:[e.jsx("i",{className:"fa-solid fa-circle-check mr-2"}),"Mark as Complete"]}),e.jsx(ee,{projectId:o,stageNumber:9,stagePath:"materialarrivalcheck"}),!g&&e.jsx(ce,{projectId:o,stageNumber:"9",className:"w-full sm:w-fit",isStageCompleted:t==null?void 0:t.status}),e.jsx(D,{stageName:"MaterialArrivalModel",projectId:o,organizationId:y,currentAssignedStaff:(t==null?void 0:t.assignedTo)||null})]})]}),b&&e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"max-w-xl p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2",children:"⚠️ Error Occurred"}),e.jsx("p",{className:"text-red-500 text-sm mb-4",children:((C=(S=g==null?void 0:g.response)==null?void 0:S.data)==null?void 0:C.message)||"Failed to load material arrival data"}),e.jsx(x,{onClick:()=>f(),className:"bg-red-600 text-white hover:bg-red-700",children:"Retry"})]})}),!b&&e.jsxs("div",{className:"flex-1 min-h-0 overflow-y-auto space-y-4 sm:space-y-6",children:[e.jsxs(X,{className:"p-4 w-full shadow border-l-4 border-blue-600 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-3 text-blue-700 text-sm font-medium mb-2",children:[e.jsx("i",{className:"fa-solid fa-clock text-blue-500 text-lg"}),e.jsx("span",{children:"Stage Timings"})]}),e.jsx(K,{stageName:"materialarrivalcheck",completedAt:d==null?void 0:d.completedAt,projectId:o,formId:t==null?void 0:t._id,deadLine:d==null?void 0:d.deadLine,startedAt:d==null?void 0:d.startedAt,refetchStageMutate:f,deadLineMutate:G,isPending:$})]}),e.jsxs("div",{className:"border-l-4 border-blue-600  rounded-lg p-4 shadow-sm relative bg-white",children:[e.jsxs("h2",{className:"text-base sm:text-lg font-bold mb-3 text-blue-700 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-store"}),"Shop Details"]}),E?e.jsxs("div",{className:"space-y-3",children:[e.jsx(m,{placeholder:"Shop Name",value:i.shopName||"",onChange:s=>h({...i,shopName:s.target.value}),className:"w-full"}),e.jsx(m,{placeholder:"Contact Person",value:i.contactPerson||"",onChange:s=>h({...i,contactPerson:s.target.value}),className:"w-full"}),e.jsx(m,{placeholder:"Phone Number",type:"tel",maxLength:10,value:i.phoneNumber||"",onChange:s=>h({...i,phoneNumber:s.target.value}),className:"w-full"}),e.jsx(m,{placeholder:"Address",value:i.address||"",onChange:s=>h({...i,address:s.target.value}),className:"w-full"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mt-3",children:[e.jsxs(x,{onClick:Z,className:"w-full sm:w-auto",children:[e.jsx("i",{className:"fa-solid fa-save mr-2"}),"Save"]}),e.jsxs(x,{variant:"outline",onClick:()=>N(!1),className:"w-full sm:w-auto",children:[e.jsx("i",{className:"fa-solid fa-times mr-2"}),"Cancel"]})]})]}):e.jsxs("div",{className:"space-y-2 text-sm sm:text-base",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Shop Name:"})," ",(l==null?void 0:l.shopName)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Contact Person:"})," ",(l==null?void 0:l.contactPerson)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Phone:"})," ",(l==null?void 0:l.phoneNumber)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Address:"})," ",(l==null?void 0:l.address)||"-"]}),(t==null?void 0:t.status)!=="completed"&&e.jsxs("button",{onClick:()=>{h(l),N(!0)},className:"absolute top-3 right-4 text-blue-600 text-xs sm:text-sm underline hover:text-blue-800",children:[e.jsx("i",{className:"fa-solid fa-edit mr-1"}),"Edit"]})]})]}),e.jsxs("div",{className:"border-l-4 border-blue-600  rounded-lg p-4 shadow-sm relative bg-white",children:[e.jsxs("h2",{className:"text-base sm:text-lg font-bold mb-3 text-blue-700 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-truck"}),"Delivery Location"]}),L?e.jsxs("div",{className:"space-y-3",children:[e.jsx(m,{placeholder:"Site Name",value:n.siteName||"",onChange:s=>p({...n,siteName:s.target.value}),className:"w-full"}),e.jsx(m,{placeholder:"Site Supervisor",value:n.siteSupervisor||"",onChange:s=>p({...n,siteSupervisor:s.target.value}),className:"w-full"}),e.jsx(m,{placeholder:"Phone Number",type:"tel",maxLength:10,value:n.phoneNumber||"",onChange:s=>p({...n,phoneNumber:s.target.value}),className:"w-full"}),e.jsx(m,{placeholder:"Address",value:n.address||"",onChange:s=>p({...n,address:s.target.value}),className:"w-full"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mt-3",children:[e.jsxs(x,{onClick:_,className:"w-full sm:w-auto",children:[e.jsx("i",{className:"fa-solid fa-save mr-2"}),"Save"]}),e.jsxs(x,{variant:"outline",onClick:()=>v(!1),className:"w-full sm:w-auto",children:[e.jsx("i",{className:"fa-solid fa-times mr-2"}),"Cancel"]})]})]}):e.jsxs("div",{className:"space-y-2 text-sm sm:text-base",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Site Name:"})," ",(r==null?void 0:r.siteName)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Supervisor:"})," ",(r==null?void 0:r.siteSupervisor)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Phone:"})," ",(r==null?void 0:r.phoneNumber)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Address:"})," ",(r==null?void 0:r.address)||"-"]}),(t==null?void 0:t.status)!=="completed"&&e.jsxs("button",{onClick:()=>{p(r),v(!0)},className:"absolute top-3 right-4 text-blue-600 text-xs sm:text-sm underline hover:text-blue-800",children:[e.jsx("i",{className:"fa-solid fa-edit mr-1"}),"Edit"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:W.map(s=>{const c=w[s]||[];return e.jsxs("div",{className:"border-l-4 border-blue-600 p-4 rounded-xl shadow hover:shadow-md transition cursor-pointer bg-white",onClick:()=>A(`materialarrivalroom/${s}`),children:[e.jsx("h3",{className:"text-md font-semibold capitalize text-blue-800",children:s.replace(/([A-Z])/g," $1")}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Items: ",c.length]}),e.jsx("p",{className:"text-xs text-gray-400",children:"Click to view details"})]},s)})}),e.jsx("section",{className:"mt-4",children:e.jsx(Y,{projectId:o,context:"Material",stage:"materialarrival",data:z,isPending:R,generateLink:U})})]})]})})};export{ve as default};
