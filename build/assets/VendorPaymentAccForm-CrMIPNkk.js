import{a as X,r as x,j as e}from"./index-BYTWf4fI.js";import{B as g}from"./Button-aRmNljle.js";import{u as Y}from"./vendorAccApi-DUmEE2AO.js";import{S as Z}from"./SearchSelectNew-DeQkLtVy.js";import{L as I}from"./Label-BupV_v2u.js";import{u as D}from"./projectApi-DD4NsQCs.js";import{e as ee}from"./vendorPaymentApi-B7sVYSgz.js";import{t as A}from"./toast-BSC5QTk1.js";import{I as se}from"./InfoToolTip-E_cpK4Hb.js";const te=[{label:"Cash",value:"cash"},{label:"Bank Transfer",value:"banktransfer"},{label:"Cheque",value:"cheque"},{label:"UPI",value:"upi"},{label:"Credit Card",value:"creditcard"},{label:"Others",value:"others"}],re=["Cash EOD","weekly salary","pay advance and balance after completion","credit pay as you go"],pe=({mode:f,initialData:a,onSubmit:q,isSubmitting:V,organizationId:v,refetch:w})=>{var B,L;const T=X(),[u,k]=x.useState(f),{data:N}=Y(v),{mutateAsync:R,isPending:U}=ee(),l={organizationId:v,vendorId:"",projectId:null,paymentTerms:"",vendorName:"",vendorPaymentDate:new Date().toISOString().split("T")[0],paymentMode:"Cash",paidThrough:"",items:[{itemName:"",billAmount:0}],totalAmount:0,notes:""},{data:P}=D(v),b=P==null?void 0:P.map(s=>({_id:s._id,projectName:s.projectName})),[C,E]=x.useState(!1),[n,i]=x.useState(l),[O,W]=x.useState({totalAmount:0});x.useEffect(()=>{var s;i({...l,...a&&{vendorId:a.vendorId||l.vendorId,projectId:a.projectId||l.projectId,vendorName:a.vendorName||l.vendorName,vendorPaymentDate:a.vendorPaymentDate?new Date(a.vendorPaymentDate).toISOString().split("T")[0]:l.vendorPaymentDate,paymentMode:a.paymentMode||l.paymentMode,paidThrough:a.paidThrough||l.paidThrough,items:(s=a.items)!=null&&s.length?a.items.map(t=>({itemName:t!=null&&t.itemName?t.itemName:l.items[0].itemName,billAmount:t.billAmount??l.items[0].billAmount})):l.items,totalAmount:a.totalAmount??l.totalAmount,notes:a.notes||l.notes}}),f==="view"&&E(!0)},[a,f]),x.useEffect(()=>{const s=n.items.reduce((t,r)=>t+(r.billAmount||0),0);W({totalAmount:s})},[n.items]);const $=(B=N||[])==null?void 0:B.map(s=>({value:s._id,label:s.vendorName,email:s.email})),h=s=>{const{name:t,value:r}=s.target;i(o=>({...o,[t]:r}))},G=()=>{i(s=>({...s,items:[...s.items,{itemName:"",billAmount:0}]}))},z=s=>{i(t=>({...t,items:t.items.filter((r,o)=>o!==s)}))},F=(s,t,r)=>{i(o=>{const d=[...o.items],p={...d[s]};if(t==="billAmount"){let m=0;r===null||r===""?m=0:typeof r=="string"?m=parseFloat(r)||0:m=r,p[t]=m<0?0:m}else t==="itemName"&&(p.itemName=r);if(d[s]=p,s===d.length-1){const m=d[d.length-1];Object.values(m).some(j=>typeof j=="number"?j!==0:j&&j.trim()!=="")&&d.push({itemName:"",billAmount:0})}return{...o,items:d}})},H=s=>{var r;const t=[];return s.vendorName.trim()||t.push("Vendor name is required"),s!=null&&s.items&&((r=s==null?void 0:s.items)==null?void 0:r.length)===0&&t.push("Atleast one item should be provided"),s.items.forEach((o,d)=>{(!o.itemName||o.itemName.trim()==="")&&t.push(`Item ${d+1}: itemName is required`),o.billAmount<0&&t.push(`Item ${d+1}: Bill amount cannot be negative`)}),t},J=s=>{const t=N==null?void 0:N.find(r=>r._id===s);i(r=>({...r,vendorId:s||"",vendorName:(t==null?void 0:t.vendorName)||""}))},M=async s=>{s.preventDefault();const t=n.items.filter(p=>{var m;return p.billAmount>0||((m=p.itemName)==null?void 0:m.trim())}),r={...n,items:t},o=H(r);if(o.length>0){alert(o.join(`
`));return}const d={...r,organizationId:"",totalAmount:O.totalAmount};await q(d),u==="edit"&&k("view"),u==="create"&&i(l)},K=async()=>{var s,t;try{if(a!=null&&a.isSyncWithPaymentsSection)return A({variant:"destructive",title:"Error",description:"already sent to payments section"});await R({id:a==null?void 0:a._id}),w==null||w(),A({title:"Success",description:"Bill sent to Payments Section"})}catch(r){A({variant:"destructive",title:"Error",description:((t=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:t.message)||(r==null?void 0:r.message)||"operation failed"})}},c=u==="view",y=u==="create",S=u==="edit",_=()=>k(s=>s==="view"?"edit":"view");return e.jsxs("div",{className:"max-w-full mx-auto space-y-2",children:[e.jsxs("header",{className:"sticky top-0 z-20 bg-white border-b border-gray-200 pb-4 pt-2 mb-6 flex justify-between items-center",children:[e.jsxs("div",{className:"flex justify-between items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>T(-1),className:"bg-blue-100 hover:bg-slate-300 flex items-center justify-between w-8 h-8 border border-[#a6aab8] text-sm cursor-pointer rounded-md px-2 ",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-credit-card mr-3 text-blue-600"}),y?"Create Vendor Payment Order":S?"Update Vendor Payment  Order":"View Vendor Payment Order"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:y?"Fill in the details to create a new order":S?"Update the Vendor Payment details":"Vendor Payment details"})]})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[c&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(g,{variant:"primary",className:`${a!=null&&a.isSyncWithPaymentsSection?"!cursor-not-allowed":""}`,title:a!=null&&a.isSyncWithPaymentsSection?"already sent to payment":"",isLoading:U,disabled:a==null?void 0:a.isSyncWithPaymentsSection,onClick:K,children:"Send To Payments Section"}),e.jsx(se,{content:"Click the button to send the vendor payment order to Payments section",type:"info",position:"bottom"})]}),u==="view"&&e.jsx("div",{className:"flex justify-end",children:e.jsx(g,{onClick:_,className:"bg-blue-600 text-white px-6 py-2",children:"Edit"})})]}),(y||S)&&e.jsxs("div",{className:"flex justify-end items-center gap-4",children:[e.jsx(g,{type:"button",onClick:M,className:"bg-blue-600 text-white px-6 py-2",disabled:V,children:V?e.jsx("i",{className:"fas fa-spinner fa-spin"}):e.jsx(e.Fragment,{children:y?"Create":"Update"})}),e.jsx(g,{variant:"outline",type:"button",onClick:()=>{y?T(-1):_()},className:"bg-gray-500 hover:bg-gray-500 text-white px-6 py-2",children:"Cancel"})]})]}),e.jsxs("form",{onSubmit:M,className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx("i",{className:"fas fa-file-alt mr-2 text-blue-600"}),"Vendor Payment Details"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(I,{children:"Vendor"}),e.jsx(Z,{options:$,placeholder:"Select Vendor",searchPlaceholder:"Search Vendor...",value:(n==null?void 0:n.vendorId)||void 0,onValueChange:s=>J(s),searchBy:"name",displayFormat:"simple",className:"w-full"})]}),e.jsxs("div",{className:"",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"checkbox",className:"cursor-pointer",checked:C,id:"enableName",onChange:()=>E(s=>!s)}),e.jsx(I,{htmlFor:"enableName",className:"cursor-pointer",children:"Click the check box to enter the name manually, if not available from the drop down"})]}),e.jsx("input",{type:"text",name:"vendorName",value:n.vendorName,onChange:s=>{C&&h(s)},disabled:c||!C,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",placeholder:"Enter Vendor name"})]}),e.jsxs("div",{children:[e.jsx(I,{children:"Project"}),e.jsxs("select",{value:(n==null?void 0:n.projectId)||"",disabled:c,onChange:s=>{const t=b==null?void 0:b.find(r=>r._id===s.target.value);i(t?r=>({...r,projectId:t._id,projectName:t.projectName}):r=>({...r,projectId:null,projectName:null}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white disabled:bg-gray-100 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:"Select Projects"}),b==null?void 0:b.map(s=>e.jsx("option",{value:s._id,children:s.projectName},s._id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date"}),e.jsx("input",{type:"date",name:"vendorPaymentDate",value:n.vendorPaymentDate,onChange:h,disabled:c,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Mode"}),e.jsxs("select",{name:"paymentMode",value:n.paymentMode,onChange:h,disabled:c,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:"Select Payment Mode"}),te.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Terms"}),e.jsxs("select",{name:"paymentTerms",value:n.paymentTerms,onChange:h,disabled:c,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:"Select Payment Term"}),re.map(s=>e.jsx("option",{value:s,children:s},s))]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-list mr-2 text-blue-600"}),"Items ",e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),!c&&e.jsxs(g,{type:"button",onClick:G,variant:"primary",children:[e.jsx("i",{className:"fas fa-plus mr-2"}),"Add Item"]})]}),((L=n==null?void 0:n.items)==null?void 0:L.length)===0&&f==="view"?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("i",{className:"fas fa-inbox text-4xl mb-2"}),e.jsx("p",{children:"No items added yet. Start typing to add items."})]}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("div",{className:"grid grid-cols-10 gap-3 mb-2 px-4 py-3 bg-gray-100 rounded-lg font-semibold text-gray-700 text-sm",children:[e.jsx("div",{className:"col-span-1 text-center",children:"#"}),e.jsxs("div",{className:"col-span-3 text-center",children:["Item Name",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"col-span-3 text-center",children:"Bill Amount"}),e.jsx("div",{className:"col-span-3 text-center",children:"Action"})]}),e.jsx("div",{className:"space-y-2",children:n.items.map((s,t)=>e.jsxs("div",{className:"grid grid-cols-10 gap-3 px-4 py-3 bg-white border border-gray-200 rounded-lg hover:border-blue-300 transition-colors items-center",children:[e.jsx("div",{className:"col-span-1 text-center text-gray-600 font-medium",children:t+1}),e.jsx("div",{className:"col-span-3",children:e.jsx("input",{type:"itemName",value:s.itemName,onChange:r=>F(t,"itemName",r.target.value),disabled:c,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed text-sm",placeholder:"Enter item name"})}),e.jsx("div",{className:"col-span-3",children:e.jsx("input",{type:"number",value:s.billAmount,onChange:r=>F(t,"billAmount",r.target.value),disabled:c,min:"0",step:"1",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed text-sm",placeholder:"0"})}),e.jsx("div",{className:"col-span-3 text-center",children:!c&&e.jsx("button",{type:"button",onClick:()=>z(t),disabled:n.items.length===1,className:"text-red-600 cursor-pointer hover:text-red-800 disabled:text-gray-400 disabled:cursor-not-allowed p-2 rounded-full hover:bg-red-50 transition-colors",title:n.items.length===1?"Cannot delete last item":"Delete item",children:e.jsx("i",{className:"fas fa-trash"})})})]},t))}),e.jsx("section",{className:"px-8 py-3 bg-blue-50 rounded-lg mt-4 font-semibold text-gray-800",children:e.jsxs("div",{className:"text-right",children:["Total:",e.jsxs("span",{className:"ml-3 text-right text-blue-600 text-lg",children:["â‚¹",O.totalAmount.toFixed(2)]})]})})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx("i",{className:"fas fa-comment-alt mr-2 text-blue-600"}),"Additional Information"]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("textarea",{name:"notes",value:n.notes,onChange:h,disabled:c,rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed resize-none",placeholder:"Add any notes for the Vendor..."})]})})]})]})]})};export{pe as V};
