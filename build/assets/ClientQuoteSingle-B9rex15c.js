import{j as e,u as G,b as $,a as O,a8 as q,a9 as U,r as i,R as V,B as C,M as W,t as x,e as z}from"./index-CUvv9ev0.js";import{C as D}from"./ClientFurnitures-BvGOlczD.js";import{L as H}from"./Label-CX2gOFKV.js";import{S as J,a as K,b as X,c as Y,d as Z}from"./Select-Dr5p0XuH.js";import{u as ee}from"./quoteVariantApi-DXhk0qe8.js";const te=({data:l,isBlured:c})=>{const h=(l==null?void 0:l.sqftRateWork)||[];return e.jsx("div",{className:"w-full bg-white rounded-3xl border border-slate-200 shadow-sm overflow-hidden",children:e.jsxs("div",{className:"p-8",children:[e.jsxs("table",{className:"w-full border-separate border-spacing-y-3",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-[10px] uppercase font-black text-slate-400 tracking-[0.15em]",children:[e.jsx("th",{className:"text-left px-6 pb-2",children:"Work Type"}),e.jsx("th",{className:"text-right px-6 pb-2",children:"Subtotal"})]})}),e.jsx("tbody",{children:h.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:2,className:"py-20 text-center text-slate-400 font-bold italic",children:"No items listed in this quote."})}):h.map((g,f)=>e.jsxs("tr",{className:"bg-slate-50/50 hover:bg-slate-50 transition-colors rounded-xl overflow-hidden",children:[e.jsx("td",{className:"px-6 py-5 rounded-l-2xl",children:e.jsx("div",{className:`transition-all duration-500 ${c?"blur-sm select-none":""}`,children:e.jsx("p",{className:"font-bold text-slate-800 text-lg leading-tight",children:g.workType||"General Work"})})}),e.jsx("td",{className:"px-6 py-5 text-right rounded-r-2xl border-l border-white/50",children:e.jsx("div",{className:`transition-all duration-500 ${c?"blur-sm select-none":""}`,children:e.jsxs("p",{className:"text-xl font-black text-slate-900",children:["₹",(g.totalCost||0).toLocaleString("en-IN")]})})})]},f))})]}),e.jsx("footer",{className:"mt-6 flex justify-end",children:e.jsxs("div",{className:"w-full max-w-md border-t-2 border-dashed border-slate-400 pt-6 px-6 flex items-center justify-between",children:[e.jsx("div",{className:"text-left",children:e.jsx("p",{className:"text-lg font-black text-slate-800 uppercase tracking-widest leading-none mb-1",children:"Total Estimate"})}),e.jsx("div",{className:`transition-all duration-500 ${c?"blur-md select-none":""}`,children:e.jsxs("p",{className:"text-4xl font-black text-blue-600 tracking-tight",children:["₹",((l==null?void 0:l.grandTotal)||0).toLocaleString("en-IN")]})})]})})]})})},ie=0,ce=()=>{var S,k,T;const{organizationId:l,quoteId:c,quoteType:h}=G(),g=$(),{role:f,permission:m}=O(),N=f==="owner"||((S=m==null?void 0:m.clientquote)==null?void 0:S.create),y=f==="owner"||((k=m==null?void 0:m.clientquote)==null?void 0:k.edit),{data:a,isLoading:L}=q(l,c),j=h==="sqft_rate",{mutateAsync:I,isPending:w}=U(),{mutateAsync:P,isPending:A}=ee(),o=i.useRef([]),[v,b]=i.useState(null),[n,E]=i.useState(!0),[d,M]=i.useState("type 1"),[p,B]=i.useState([]),[u,Q]=i.useState((a==null?void 0:a.grandTotal)||0);i.useEffect(()=>{Q(a==null?void 0:a.grandTotal)},[a]);const R=async()=>{var t,s;try{if(!l||!c||!a){x({title:"Missing info",description:"Please ensure quote and all details are not missing",variant:"destructive"});return}if(!confirm("Are you sure want to send this quotation to payment?"))return;await I({organizationId:l,id:c}),x({title:"success",description:"Quote Selected and stored in the payment stage"})}catch(r){x({title:"Error",description:((s=(t=r==null?void 0:r.response)==null?void 0:t.data)==null?void 0:s.message)??"Operation failed"})}},_=async()=>{var t,s;try{if(!a.projectId._id||!c||!d){x({title:"Missing info",description:"Please ensure brand and all details are selected",variant:"destructive"});return}const r=await P({quoteId:c,type:d,projectId:a.projectId._id,quoteType:h,isBlurred:n});await z({src:r.url,alt:r.fileName}),x({title:"success",description:"pdf generated successfully"})}catch(r){x({title:"Error",description:((s=(t=r==null?void 0:r.response)==null?void 0:t.data)==null?void 0:s.message)||"Operation failed",variant:"destructive"})}},F=async()=>{var t,s;try{E(r=>!r)}catch(r){x({title:"Error",description:((s=(t=r==null?void 0:r.response)==null?void 0:t.data)==null?void 0:s.message)??"Operation failed"})}};return i.useEffect(()=>{if(!(a!=null&&a.furnitures))return;const t=a.furnitures.map(s=>({furnitureName:s.furnitureName,coreMaterials:s.coreMaterials||[],fittingsAndAccessories:s.fittingsAndAccessories||[],glues:s.glues||[],nonBrandMaterials:s.nonBrandMaterials||[],totals:{core:s.coreMaterialsTotal||0,fittings:s.fittingsAndAccessoriesTotal||0,glues:s.gluesTotal||0,nbms:s.nonBrandMaterialsTotal||0,furnitureTotal:s.furnitureTotal||0},plywoodBrand:s.plywoodBrand||"",innerLaminateBrand:s.innerLaminateBrand||"",outerLaminateBrand:s.outerLaminateBrand||"",fabricationCost:s.fabricationCost||0}));B(t)},[a]),o.current.length!==p.length&&(o.current=p.map((t,s)=>o.current[s]??V.createRef())),i.useEffect(()=>{console.log("furnitureRefs Array",o),o.current=p.map((t,s)=>o.current[s]??i.createRef())},[p]),e.jsxs("div",{className:"p-2 max-h-full overflow-y-auto",children:[e.jsx("header",{className:"bg-white border-b border-gray-200 pb-4 space-y-3",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("button",{onClick:()=>g(-1),className:"flex cursor-pointer items-center justify-center w-8 h-8 bg-gray-50 hover:bg-gray-100 border border-gray-300 rounded-md transition-colors flex-shrink-0",children:e.jsx("i",{className:"fas fa-arrow-left text-gray-600 text-sm"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900 truncate",children:(a==null?void 0:a.mainQuoteName)||"Quote"}),e.jsx("p",{className:"text-md text-gray-500",children:a!=null&&a.quoteNo?`Quote: #${a==null?void 0:a.quoteNo}`:""})]})]}),e.jsxs("div",{className:"flex gap-2 justify-between  items-center",children:[e.jsxs("div",{className:"px-4 text-center",children:[e.jsx("p",{className:"text-md text-gray-600",children:"Total Cost"}),e.jsxs("p",{className:"text-md font-bold text-green-600",children:["₹",u==null?void 0:u.toLocaleString("en-in")]})]}),(N||y)&&!j&&e.jsx(C,{onClick:R,disabled:w,className:"flex-shrink-0 px-4 ",children:w?"Sending...":"Send to Payment"}),(N||y)&&e.jsx(C,{onClick:_,isLoading:A,className:"flex-shrink-0 px-4 ",children:"Generate Pdf"}),e.jsxs("div",{className:"flex gap-2 w-fit px-4 justify-center",children:[e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:n,onChange:F,className:"sr-only",id:"blurinput"}),e.jsx("div",{className:`w-11 h-6 rounded-full cursor-pointer transition-colors ${n?"bg-gray-200":"bg-blue-600"}`,children:e.jsx("div",{className:`w-5 h-5 bg-white rounded-full shadow transform transition-transform ${n?"translate-x-0":"translate-x-5"} mt-0.5 ml-0.5`})})]}),e.jsx(H,{htmlFor:"blurinput",className:" cursor-pointer flex flex-4/2",children:"Show Stats"})]}),!j&&e.jsx("div",{className:"w-full",children:e.jsxs(J,{onValueChange:t=>{M(t)},children:[e.jsx(K,{className:"w-full",children:e.jsx(X,{placeholder:"Select Template Type",selectedValue:d[0].toUpperCase()+d.slice(1)})}),e.jsx(Y,{children:["type 1","type 2","type 3"].map(t=>e.jsx(Z,{value:t.toString(),children:t[0].toUpperCase()+t.slice(1)},t))})]})})]})]})}),j?e.jsx(e.Fragment,{children:e.jsx(te,{data:a,isBlured:n})}):e.jsxs(e.Fragment,{children:["  ",L?e.jsx(W,{}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-6",children:[p.map((t,s)=>e.jsx(D,{index:s,data:t,ref:o.current[s],templateType:d,isBlurred:n,onImageClick:b},s)),d!=="type 2"&&((T=a==null?void 0:a.commonMaterials)==null?void 0:T.length)>0&&e.jsxs("div",{className:"mt-10 bg-white border border-gray-200 rounded-lg p-4 shadow-md",children:[e.jsxs("h3",{className:"font-semibold text-md mb-2 text-gray-800 flex items-center gap-2",children:["Common Site Materials",e.jsxs("span",{className:"text-sm  ml-1",children:["(Total: ₹",a.commonMaterials.reduce((t,s)=>t+(s.rowTotal||0),0).toLocaleString("en-IN"),")"]})]}),e.jsx("div",{className:"overflow-x-auto rounded-md border border-gray-100",children:d!=="type 3"&&e.jsxs("table",{className:"min-w-full text-sm bg-white shadow-sm",children:[e.jsx("thead",{className:"bg-blue-50 text-sm font-semibold text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Item Name"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Description"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Quantity"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Cost"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{children:a.commonMaterials.map((t,s)=>{var r;return e.jsxs("tr",{className:"border-b hover:bg-gray-50/50 transition-colors",children:[e.jsx("td",{className:"text-center border p-2",children:e.jsx("span",{className:n?"blur-sm select-none":"",children:(t==null?void 0:t.itemName)||"—"})}),e.jsx("td",{className:"text-center border p-2",children:e.jsx("span",{className:n?"blur-sm select-none":"",children:(t==null?void 0:t.description)||"—"})}),e.jsx("td",{className:"text-center border p-2",children:e.jsx("span",{className:n?"blur-sm select-none":"",children:(t==null?void 0:t.quantity)||0})}),e.jsx("td",{className:"text-center border p-2",children:e.jsxs("span",{className:n?"blur-sm select-none":"",children:["₹",((r=t==null?void 0:t.cost)==null?void 0:r.toLocaleString("en-IN"))||0]})}),e.jsx("td",{className:"text-center border p-2 text-green-700 font-bold",children:e.jsxs("span",{className:n?"blur-sm select-none":"",children:["₹",(t.rowTotal||0).toLocaleString("en-IN")]})}),e.jsx("td",{className:"text-center border p-2 text-gray-400",children:"—"})]},s)})})]})})]}),e.jsx("div",{className:"mt-10 text-right",children:e.jsxs("div",{className:"inline-block bg-green-50 border border-green-200 rounded-md px-6 py-4",children:[e.jsx("p",{className:"text-md font-medium text-gray-700 mb-1",children:"Total Estimate"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700",children:["₹",u==null?void 0:u.toLocaleString("en-in")]})]})})]})}),v&&e.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/80 p-4 animate-in fade-in duration-200",onClick:()=>b(null),children:e.jsxs("div",{className:"relative max-w-4xl max-h-[90vh]",children:[e.jsx("button",{className:"absolute -top-10 right-0 text-white text-3xl hover:text-gray-300 transition-colors",onClick:()=>b(null),children:e.jsx("i",{className:"fas fa-times"})}),e.jsx("img",{src:v,className:"rounded-lg shadow-2xl max-w-full max-h-[85vh] object-contain border-4 border-white/10",alt:"Enlarged view",onClick:t=>t.stopPropagation()})]})})]})]})};export{ie as DEFAULT_LAMINATE_RATE_PER_SQFT,ce as default};
