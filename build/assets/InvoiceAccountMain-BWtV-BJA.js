import{b as L,j as e,a as V,e as Y,u as q,r as d,O as J}from"./index-Dkf7SbMA.js";import{B as S}from"./Button-ClgICMLF.js";import{f as K,u as Q,a as U}from"./formatCurrency-BMQMtrYr.js";import{t as F}from"./toast-BSC5QTk1.js";import{d as T}from"./dateFormator-BGKi5rfZ.js";import{B as W}from"./Breadcrumb-By3hsyj1.js";import{S as X}from"./index-BpwGr7wu.js";import{u as B}from"./useDebounce-DdomlvL1.js";import{S as Z}from"./StageGuide-CjTD8LTi.js";import"./roleCheck-CXq1v0D5.js";import"./useQuery-h0LZ4b8f.js";import"./useMutation-DtRxugN4.js";import"./useInfiniteQuery-BUWQcrvt.js";import"./index-CwzFm0RL.js";const ee=({invoice:r,index:m,handleView:c,handleDelete:x,deleteInvoiceMutation:u})=>{var h,b;const{role:f,permission:l}=L(),g=f==="owner"||((h=l==null?void 0:l.invoice)==null?void 0:h.delete);return e.jsxs("div",{className:"grid cursor-pointer grid-cols-14 gap-4 px-6 py-4 border-b border-gray-100 hover:bg-[#f9fcff] transition-colors items-center last:border-b-0",onClick:()=>c(r._id),children:[e.jsx("div",{className:"col-span-1 text-center text-gray-600 font-medium",children:m+1}),e.jsx("div",{className:"col-span-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-user text-blue-600 text-sm"}),e.jsx("span",{className:"font-medium text-gray-900 truncate",children:r.customerName||"N/A"})]})}),e.jsx("div",{className:"col-span-2",children:e.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-semibold",children:r.invoiceNumber||"N/A"})}),e.jsxs("div",{className:"col-span-2 text-gray-600 text-sm",children:[e.jsx("i",{className:"fas fa-calendar-alt text-gray-400 mr-2"}),T(r.invoiceDate)]}),e.jsxs("div",{className:"col-span-2 text-gray-600 text-sm",children:[e.jsx("i",{className:"fas fa-calendar-alt text-gray-400 mr-2"}),T(r.createdAt)]}),e.jsx("div",{className:"col-span-2 font-semibold text-green-600",children:K(r==null?void 0:r.grandTotal)}),e.jsx("div",{className:"col-span-1 text-center",children:e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium",children:((b=r.items)==null?void 0:b.length)||0})}),e.jsx("div",{className:"col-span-1 flex justify-center gap-2",children:g&&e.jsx("button",{onClick:t=>{t.stopPropagation(),x(r._id)},disabled:u.isPending,className:"p-2 cursor-pointer text-red-600 hover:bg-red-100 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Delete Invoice",children:u.isPending?e.jsx("i",{className:"fas fa-spinner fa-spin"}):e.jsx("i",{className:"fas fa-trash"})})})]})},he=()=>{var C,k;const r=V(),m=Y(),{organizationId:c}=q(),x=d.useRef(null),u=[{label:"Account",path:`/organizations/${c}/projects/accounting`},{label:"Bills",path:`/organizations/${c}/projects/billmain`},{label:"Invoice",path:`/organizations/${c}/projects/invoicemain`}],{role:f,permission:l}=L(),g=f==="owner"||((C=l==null?void 0:l.invoice)==null?void 0:C.list),h=f==="owner"||((k=l==null?void 0:l.invoice)==null?void 0:k.create),b=m.pathname.includes("/invoicesingle")||m.pathname.includes("/create"),[t,n]=d.useState({search:"",customerId:"",minAmount:0,maxAmount:1e6,fromInvoiceDate:"",toInvoiceDate:"",createdFromDate:"",createdToDate:"",sortBy:"createdAt",sortOrder:"desc"}),[O,E]=d.useState(t.search),M=B(t.minAmount,800),P=B(t.maxAmount,800);d.useEffect(()=>{const s=setTimeout(()=>{E(t.search)},500);return()=>clearTimeout(s)},[t.search]);const{data:p,fetchNextPage:D,hasNextPage:j,isFetchingNextPage:v,isLoading:z,isError:R,error:N,refetch:A}=Q({organizationId:c||"",customerId:t.customerId||void 0,limit:20,fromInvoiceDate:t.fromInvoiceDate||void 0,toInvoiceDate:t.toInvoiceDate||void 0,createdFromDate:t.createdFromDate||void 0,createdToDate:t.createdToDate||void 0,minAmount:M,maxAmount:P,search:O||void 0,sortBy:t.sortBy||void 0,sortOrder:t.sortOrder||void 0}),I=U();d.useEffect(()=>{const s=x.current;if(!s)return;const a=()=>{const{scrollTop:i,scrollHeight:o,clientHeight:H}=s;o-i-H<100&&j&&!v&&(console.log("ðŸ“œ Loading more invoices..."),D())};return s.addEventListener("scroll",a),()=>s.removeEventListener("scroll",a)},[j,v,D]);const G=async s=>{var a,i;try{await I.mutateAsync({invoiceId:s}),A(),F({title:"Success",description:"Invoice deleted successfully"})}catch(o){F({title:"Error",description:((i=(a=o==null?void 0:o.response)==null?void 0:a.data)==null?void 0:i.message)||(o==null?void 0:o.message)||"Failed to delete the invoice",variant:"destructive"})}},$=s=>{r(`invoicesingle/${s}`)},w=Object.values(t).filter(s=>s!==""&&s!=="createdAt"&&s!=="desc").length,_=()=>{n({search:"",customerId:"",fromInvoiceDate:"",minAmount:0,maxAmount:1e6,toInvoiceDate:"",createdFromDate:"",createdToDate:"",sortBy:"createdAt",sortOrder:"desc"})},y=(p==null?void 0:p.pages.flatMap(s=>s.data))||[];return b?e.jsx(J,{}):e.jsxs("div",{className:"space-y-0 h-full",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-file-invoice mr-3 text-blue-600"}),"Invoice Accounts"]}),e.jsx(W,{paths:u})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[h&&e.jsxs(S,{onClick:()=>r("create"),children:[e.jsx("i",{className:"fas fa-plus mr-2"}),"Create Invoice"]}),e.jsx("div",{className:"w-full sm:w-auto flex justify-end sm:block",children:e.jsx(Z,{organizationId:c,stageName:"invoice"})})]})]}),z?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("i",{className:"fas fa-spinner fa-spin text-blue-600 text-4xl"})}):R?e.jsxs("div",{className:"max-w-xl sm:min-w-[80%] mx-auto mt-4 p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2 text-xl sm:text-3xl",children:"âš ï¸ Error Occurred"}),e.jsx("p",{className:"text-red-500 mb-4 text-lg sm:text-xl",children:(N==null?void 0:N.message)||"Failed to load invoices"}),e.jsx(S,{onClick:()=>A(),className:"bg-red-600 text-white px-4 py-2",children:"Retry"})]}):e.jsxs("main",{className:"flex gap-2 !max-h-[90%]",children:[e.jsx("div",{className:"xl:w-80 flex-shrink-0 !max-h-[100%] overflow-y-auto",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-filter mr-2 text-blue-600"}),"Filters"]}),w>0&&e.jsxs("button",{onClick:_,className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:["Clear All (",w,")"]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx("i",{className:"fas fa-search mr-2"}),"Search"]}),e.jsx("input",{type:"text",autoFocus:!0,placeholder:"Invoice number, customer name...",value:t.search,onChange:s=>n(a=>({...a,search:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx("i",{className:"fas fa-calendar mr-2"}),"From CreatedAt Date"]}),e.jsx("input",{type:"date",value:t.createdFromDate,onChange:s=>{n(a=>({...a,createdFromDate:s.target.value}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx("i",{className:"fas fa-calendar mr-2"}),"To CreatedAt Date"]}),e.jsx("input",{type:"date",value:t.createdToDate,onChange:s=>{n(a=>({...a,createdToDate:s.target.value}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx("i",{className:"fas fa-calendar mr-2"}),"From Invoice Date"]}),e.jsx("input",{type:"date",value:t.fromInvoiceDate,onChange:s=>{n(a=>({...a,fromInvoiceDate:s.target.value}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx("i",{className:"fas fa-calendar mr-2"}),"To Invoice Date"]}),e.jsx("input",{type:"date",value:t.toInvoiceDate,onChange:s=>{n(a=>({...a,toInvoiceDate:s.target.value}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-4",children:[e.jsx("i",{className:"fas fa-coins mr-2 text-gray-400"}),"Amount Range"]}),e.jsx("div",{className:"px-2 mb-3",children:e.jsx(X,{range:!0,min:0,max:1e6,step:500,value:[Number(t.minAmount),Number(t.maxAmount)],onChange:s=>{const[a,i]=s;n(o=>({...o,minAmount:a,maxAmount:i}))},trackStyle:[{backgroundColor:"#3b82f6",height:6}],handleStyle:[{borderColor:"#3b82f6",backgroundColor:"#fff",boxShadow:"0 2px 6px rgba(59, 130, 246, 0.4)",width:18,height:18,marginTop:-6,opacity:1},{borderColor:"#3b82f6",backgroundColor:"#fff",boxShadow:"0 2px 6px rgba(59, 130, 246, 0.4)",width:18,height:18,marginTop:-6,opacity:1}],railStyle:{backgroundColor:"#e5e7eb",height:6}})}),e.jsxs("div",{className:"flex justify-between items-center gap-2 text-sm",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-xs text-gray-500 block mb-1",children:"Min"}),e.jsxs("div",{className:"bg-blue-50 px-2 py-1.5 rounded border border-blue-100 font-semibold text-blue-700 text-center text-xs",children:["â‚¹",Number(t.minAmount).toLocaleString("en-IN")]})]}),e.jsx("div",{className:"text-gray-300",children:"â€”"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-xs text-gray-500 block mb-1",children:"Max"}),e.jsxs("div",{className:"bg-blue-50 px-2 py-1.5 rounded border border-blue-100 font-semibold text-blue-700 text-center text-xs",children:["â‚¹",Number(t.maxAmount).toLocaleString("en-IN")]})]})]}),e.jsxs("div",{className:"flex gap-2 items-center mt-3",children:[e.jsx("input",{type:"number",value:t.minAmount,onChange:s=>n(a=>({...a,minAmount:+s.target.value})),placeholder:"Min",className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500",min:"0"}),e.jsx("input",{type:"number",value:t.maxAmount,onChange:s=>n(a=>({...a,maxAmount:+s.target.value})),placeholder:"Max",className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500",min:"0"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sort By"}),e.jsxs("select",{value:t.sortBy,onChange:s=>{n(a=>({...a,sortBy:s.target.value}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"createdAt",children:"Created Date"}),e.jsx("option",{value:"invoiceDate",children:"Invoice Date"}),e.jsx("option",{value:"dueDate",children:"Due Date"}),e.jsx("option",{value:"grandTotal",children:"Grand Total"}),e.jsx("option",{value:"customerName",children:"Customer Name"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sort Order"}),e.jsxs("select",{value:t.sortOrder,onChange:s=>{n(a=>({...a,sortOrder:s.target.value}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"desc",children:"Descending"}),e.jsx("option",{value:"asc",children:"Ascending"})]})]})]})]})}),g&&e.jsxs(e.Fragment,{children:["     ",y.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[300px] w-full bg-white rounded-xl text-center p-6",children:[e.jsx("i",{className:"fas fa-file-invoice text-5xl text-blue-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-1",children:"No Invoices Found"}),e.jsxs("p",{className:"text-sm text-gray-500",children:[t.search||t.customerId?"Try adjusting your filters to find invoices.":"Looks like there are no invoices yet.",e.jsx("br",{}),"Click on ",e.jsx("strong",{children:'"Create Invoice"'})," to get started ðŸš€"]})]}):e.jsxs("div",{ref:x,className:"flex-1 !max-h-[100%] overflow-y-auto",children:[e.jsx("div",{className:"bg-white rounded-t-xl border border-gray-200 sticky top-0 z-10",children:e.jsxs("div",{className:"grid grid-cols-14 gap-4 px-6 py-4 bg-gradient-to-r from-blue-50 to-indigo-50 font-semibold text-gray-700 text-sm",children:[e.jsx("div",{className:"col-span-1 text-center",children:"S.No"}),e.jsx("div",{className:"col-span-3",children:"Customer Name"}),e.jsx("div",{className:"col-span-2",children:"Invoice Number"}),e.jsx("div",{className:"col-span-2",children:"Invoice Date"}),e.jsx("div",{className:"col-span-2",children:"Created At"}),e.jsx("div",{className:"col-span-2",children:"Grand Total"}),e.jsx("div",{className:"col-span-1 text-center",children:"Items"}),e.jsx("div",{className:"col-span-1 text-center",children:"Actions"})]})}),e.jsx("div",{className:"bg-white rounded-b-xl border-x border-b border-gray-200",children:y.map((s,a)=>e.jsx(ee,{invoice:s,index:a,handleView:$,handleDelete:G,deleteInvoiceMutation:I},s._id))}),v&&e.jsx("div",{className:"flex justify-center py-8",children:e.jsxs("div",{className:"flex items-center gap-2 text-blue-600",children:[e.jsx("i",{className:"fas fa-spinner fa-spin text-2xl"}),e.jsx("span",{className:"text-sm font-medium",children:"Loading more invoices..."})]})}),!j&&y.length>0&&e.jsx("div",{className:"flex justify-center py-6",children:e.jsxs("p",{className:"text-gray-400 text-sm font-medium",children:[e.jsx("i",{className:"fas fa-check-circle mr-2"}),"You've reached the end of the list"]})})]})]})]})]})};export{he as default};
