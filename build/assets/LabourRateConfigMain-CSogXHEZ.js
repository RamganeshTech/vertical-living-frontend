import{u as _,b as $,r as I,j as e}from"./index-DmIvND9E.js";import{I as O}from"./Input-DkyuoIiE.js";import{t as w}from"./toast-BSC5QTk1.js";import{B as h}from"./Button-CcLxO5cH.js";import{D as Q,a as U,c as W,b as X}from"./Dialog-CZeWCHP9.js";import{u as T,a as Y,b as Z,c as ee,d as te}from"./labourRateconfigApi-zZVY1ZdT.js";import V from"./MaterialOverviewLoading-CWbdT0Pl.js";import"./useQuery-BHdcKCtG.js";import"./useMutation-CAeBxy3I.js";import"./roleCheck-DZRqXPrB.js";import"./Skeleton-Cm__h_hu.js";function ae(){var x,d,r,C,B;const{organizationId:m}=_(),{data:k}=T(m),{data:l,isLoading:z,refetch:P}=Y(m),{mutateAsync:L,isPending:M}=Z(),{mutateAsync:y,isPending:j}=ee(),{role:v,permission:o}=$(),i=v==="owner"||((x=o==null?void 0:o.materialquote)==null?void 0:x.create),R=v==="owner"||((d=o==null?void 0:o.materialquote)==null?void 0:d.delete),F=v==="owner"||((r=o==null?void 0:o.materialquote)==null?void 0:r.edit),[u,g]=I.useState([{data:{}}]);if(z)return e.jsx(V,{});const c=(C=k||[])==null?void 0:C.find(t=>t.organizationId===m);if(!c)return e.jsx("p",{children:"Category not found"});const S=(t,n,s)=>{var G,H;const a=[...u];a[t].data[n]=s;const p=(H=(G=c.fields)==null?void 0:G[0])==null?void 0:H.key,A=t===a.length-1,b=n===p,f=(s==null?void 0:s.toString().trim())!=="",J=a.length>0&&Object.values(a[a.length-1].data).every(D=>D===void 0||D==="");if(A&&b&&f&&!J&&a.push({data:{}}),!f&&b&&u.length>1){const D=a[a.length-1];Object.values(D.data).every(K=>K===void 0||K==="")&&a.pop()}g(a)},N=()=>g([...u,{data:{}}]),E=t=>{const n=[...u];n.splice(t,1),g(n)},q=async()=>{var t,n,s,a;try{const p=(n=(t=c.fields)==null?void 0:t[0])==null?void 0:n.key,A=u.map(b=>b.data).filter(b=>{const f=b[p];return f!=null&&f.toString().trim()!==""});if(A.length===0)return w({title:"Error",description:"Nothing to save",variant:"destructive"});await L({items:A,organizationId:m}),w({title:"Success",description:"field created successfully"}),g([{data:{}}]),P()}catch(p){w({title:"Error",description:((a=(s=p==null?void 0:p.response)==null?void 0:s.data)==null?void 0:a.message)??"Operation failed"})}};return e.jsxs("div",{className:"space-y-4  ",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center sticky top-0 bg-white z-10",children:[e.jsx("div",{className:"flex gap-2 items-center",children:e.jsx("div",{children:((B=c.name)==null?void 0:B.toLowerCase())==="Labour and Miscellaneous".toLowerCase()&&e.jsx("span",{className:"block absolute -top-[22px] text-[12px] text-gray-500",children:"* Enter the rupees per head (Every field will be added for single labour cost)"})})}),e.jsxs("div",{className:"flex gap-2 mt-3 sm:mt-0 absolute -top-[83px] right-[5px] ",children:[(F||i)&&e.jsx(h,{onClick:N,variant:"primary",className:"",children:"+ Add Row"}),(F||i)&&e.jsxs(h,{onClick:q,isLoading:M,className:"bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx("i",{className:"fas fa-file mr-2"})," Save Items"]})]})]}),e.jsx("div",{className:"overflow-x-auto ",children:e.jsxs("table",{className:"min-w-full bg-white text-sm",children:[e.jsx("thead",{className:"bg-blue-50 text-sm font-semibold text-gray-600 px-6 py-1 sm:py-3",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-6 py-1 sm:py-3  text-xs font-medium text-gray-500 uppercase tracking-wider",children:"S.NO"}),c.fields.map(t=>e.jsx("th",{className:"text-center px-6 py-1 sm:py-3  text-xs font-medium text-gray-500 uppercase tracking-wider",children:t.key},t.key)),e.jsx("th",{className:"text-center px-6 py-1 sm:py-3  text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsxs("tbody",{children:[l==null?void 0:l.map((t,n)=>{var s;return e.jsxs("tr",{className:`group relative border-none !border-b-1 px-4 py-2  cursor-pointer transition-all duration-200
     hover:bg-gray-50 hover:border-gray-300
  `,children:[e.jsx("td",{className:"border border-gray-100 font-medium text-center p-4  text-sm text-gray-700 group-hover:text-gray-900 transition-colors duration-200",children:n+1||"—"}),(s=c==null?void 0:c.fields)==null?void 0:s.map(a=>e.jsx("td",{className:"border border-gray-100 font-medium text-center  text-sm text-gray-700 group-hover:text-gray-900 transition-colors duration-200",children:(t==null?void 0:t.data[a==null?void 0:a.key])??"—"},a==null?void 0:a.key)),R&&e.jsx("td",{className:"text-center p-4 border border-gray-100",children:e.jsxs(h,{size:"sm",variant:"danger",isLoading:j,className:"group text-white bg-red-600",onClick:()=>y({itemId:t==null?void 0:t._id,organizationId:m}),children:[e.jsx("i",{className:"fas fa-trash mr-2"}),e.jsx("span",{className:"",children:"Delete"})]})})]},`existing-${t==null?void 0:t._id}`)}),u.map((t,n)=>e.jsxs("tr",{className:`group relative border-none !border-b-1 px-4 py-2  cursor-pointer transition-all duration-200\r
                                hover:bg-gray-50 hover:border-gray-300`,children:[e.jsx("td",{className:`border border-gray-100 px-4 font-medium text-center  \r
                                    text-sm text-gray-700 group-hover:text-gray-900 \r
                                    transition-colors duration-200`,children:l.length+n+1}),c.fields.map(s=>e.jsx("td",{className:"border border-gray-100 px-4 font-medium text-center  text-sm text-gray-700 group-hover:text-gray-900 transition-colors duration-200",children:e.jsx(O,{type:s.type==="number"?"number":"text",placeholder:s.key,className:"w-full rounded-md ",value:t.data[s.key]||"",onChange:a=>S(n,s.key,s.type==="number"?Number(a.target.value):a.target.value)})},s.key)),e.jsx("td",{className:"text-center p-4 border border-gray-100",children:e.jsxs(h,{size:"sm",variant:"ghost",className:"group text-white bg-red-600 hover:bg-red-600",onClick:()=>E(n),children:[e.jsx("i",{className:"fas fa-xmark mr-2"})," Remove"]})})]},`new-${n}`))]})]})})]})}function he(){var E,q;const{organizationId:m}=_(),{role:k,permission:l}=$(),z=k==="owner"||((E=l==null?void 0:l.materialquote)==null?void 0:E.list),P=k==="owner"||((q=l==null?void 0:l.materialquote)==null?void 0:q.create),[L,M]=I.useState("Labour and Miscellaneous"),[y,j]=I.useState([{key:"Category",type:"string",required:!1},{key:"Rs",type:"number",required:!1},{key:"notes",type:"string",required:!1}]),[v,o]=I.useState(!1),{data:i,isLoading:R,refetch:F}=T(m),{mutateAsync:u,isPending:g}=te(),c=()=>{j([...y,{key:"",type:"string",required:!1}])},S=(x,d,r)=>{const C=[...y];C[x][d]=r,j(C)},N=async()=>{var x,d;try{await u({organizationId:m,name:L,fields:y}),M(""),j([{key:"",type:"string",required:!1}]),o(!1),F(),w({title:"Success",description:"Category Created Successfully"})}catch(r){w({title:"Error",description:((d=(x=r==null?void 0:r.response)==null?void 0:x.data)==null?void 0:d.message)||(r==null?void 0:r.message)||"failed to create category",variant:"destructive"})}};return e.jsxs("div",{className:"space-y-6 max-h-full overflow-y-auto ",children:[e.jsxs("header",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 ",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-cubes mr-3 text-blue-600"}),"Labour Rate Configuration"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your labour's charges here"})]}),(i==null?void 0:i.length)===0&&P&&e.jsx("div",{children:e.jsx(h,{onClick:N,isLoading:g,children:"Create New Category"})})]}),e.jsx(Q,{open:v,onOpenChange:o,children:e.jsxs(U,{className:"px-5 py-6",children:[e.jsx(W,{className:"px-0 py-0",children:e.jsx(X,{children:"Create New Labour Category"})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(O,{placeholder:"Labour and Miscellaneous",value:L}),e.jsx("h4",{className:"text-base font-semibold",children:"Define Fields"}),e.jsx("div",{className:"space-y-2",children:y.map((x,d)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(O,{placeholder:"Field key (e.g: Category, Rs, notes)",value:x.key,onChange:r=>S(d,"key",r.target.value),className:"flex-1"}),e.jsxs("select",{value:x.type,onChange:r=>S(d,"type",r.target.value),className:"  px-2 py-2 rounded-xl border border-blue-200 focus:border-blue-200 active:border-blue-200",children:[e.jsx("option",{value:"string",children:"text"}),e.jsx("option",{value:"number",children:"number"})]})]},d))}),e.jsxs("div",{className:"flex justify-between pt-2",children:[e.jsx(h,{variant:"secondary",onClick:c,children:"+ Add Field"}),e.jsx(h,{isLoading:g,onClick:N,children:"Create Category"})]})]})]})}),!R&&(i==null?void 0:i.length)===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[300px] w-full bg-white rounded-xl   text-center p-6",children:[e.jsx("i",{className:"fas fa-box-open text-5xl text-blue-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-1",children:"No Labour Rate Configuration Found"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Looks like there are no Labour Rate Configuration yet for this organization.",e.jsx("br",{}),e.jsx(h,{onClick:N,isLoading:g,className:"mx-4 my-2",children:"Create New Category"})]})]}),R&&e.jsx(V,{}),z&&(i==null?void 0:i.length)>0&&e.jsx(ae,{})]})}export{he as default};
