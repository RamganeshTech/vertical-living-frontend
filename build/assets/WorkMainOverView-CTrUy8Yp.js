import{b as F,f as V,d as $,r as S,j as e,O as _,L as k}from"./index-DkfQDeIt.js";import{u as G,a as U,b as q,c as H}from"./workScheduleApi-46XwhhrI.js";import{t as o}from"./toast-BSC5QTk1.js";import{B as n}from"./Button-C-chqFKc.js";import{R as J}from"./ResetStageButton-DPKiOhg7.js";import{A as K,S as Q}from"./AssignStaff-DXCssW_O.js";import{c as y}from"./Card-Dx_Z9f0D.js";import X from"./MaterialOverviewLoading-CgXl-m5l.js";import{S as Y,a as Z,b as ee,c as se,d as te}from"./Select-BS8c4mwJ.js";import"./roleCheck-DNL7PxQZ.js";import"./useQuery-mUmMtORz.js";import"./useMutation-BWlLDX_I.js";import"./Input-lr8I7tVA.js";import"./getAllUsersApi-CuWWGdu9.js";import"./Skeleton-CVtEMTN7.js";const be=()=>{var h,g,f,b,j,N,v,w;const{projectId:i,organizationId:A}=F(),x=V(),{isMobile:C,openMobileSidebar:M}=$(),{data:s,isLoading:u,refetch:c,error:l}=G(i),{mutateAsync:L,isPending:P}=U(),{mutateAsync:I,isPending:O}=q(),{mutateAsync:W,isPending:T}=H(),[p,d]=S.useState(!1),[m,D]=S.useState("pending"),E=x.pathname.includes("/workschedule")||x.pathname.includes("/dailyschedule"),R=()=>{d(!0)},z=async()=>{var t,r;try{await I({projectId:i}),o({description:"Completion status updated successfully.",title:"Success"}),c()}catch(a){o({title:"Error",description:((r=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:r.message)||a.message||"Failed to update completion.",variant:"destructive"})}},B=async()=>{var t,r;try{await W({projectId:i,mainStageId:s==null?void 0:s._id,payload:{action:m}}),o({description:"MD Approval updated successfully.",title:"Success"}),d(!1),c()}catch(a){o({title:"Error",description:((r=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:r.message)||a.message||"Failed to update Approval.",variant:"destructive"})}};return E?e.jsx(_,{}):u?e.jsx(X,{}):e.jsxs("main",{className:"w-full h-full",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4 mb-6",children:[e.jsxs("h2",{className:"text-2xl sm:text-3xl font-semibold text-blue-600 flex items-center",children:[C&&e.jsx("button",{onClick:M,className:"mr-3 p-2 rounded-md border border-gray-200 hover:bg-gray-100",title:"Open menu",children:e.jsx("i",{className:"fa-solid fa-bars"})}),e.jsx("i",{className:"fas fa-digging mr-2"})," Work Schedule Overview"]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full sm:w-auto",children:[e.jsxs(n,{isLoading:O,onClick:z,className:"bg-green-600 h-10 hover:bg-green-700 text-white w-full sm:w-auto",children:[e.jsx("i",{className:"fa-solid fa-circle-check mr-2"}),"Mark as Complete"]}),e.jsx(J,{projectId:i,stageNumber:10,stagePath:"worktasks",className:"w-full sm:w-auto"}),e.jsx(K,{className:"w-full sm:w-auto",stageName:"WorkMainStageScheduleModel",projectId:i,organizationId:A,currentAssignedStaff:(s==null?void 0:s.assignedTo)||null})]})]}),l?e.jsxs("div",{className:"max-w-xl mx-auto p-6 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 text-xl font-semibold mb-2",children:"⚠️ An Error Occurred"}),e.jsx("p",{className:"text-red-500 text-sm mb-4",children:((g=(h=l==null?void 0:l.response)==null?void 0:h.data)==null?void 0:g.message)||(l==null?void 0:l.message)||"Couldn't load data."}),e.jsx(n,{isLoading:u,onClick:()=>c(),className:"bg-red-600 text-white hover:bg-red-700 px-4 py-2",children:"Retry"})]}):e.jsxs(e.Fragment,{children:[e.jsxs(y,{className:"p-4 mb-6 w-full border-l-4 border-blue-600 shadow bg-white",children:[e.jsxs("div",{className:"flex items-center gap-3 text-blue-700 text-sm font-medium mb-2",children:[e.jsx("i",{className:"fa-solid fa-clock text-blue-500 text-lg"}),e.jsx("span",{children:"Stage Timings"})]}),e.jsx(Q,{stageName:"worktasks",completedAt:(f=s==null?void 0:s.timer)==null?void 0:f.completedAt,projectId:i,formId:s==null?void 0:s._id,deadLine:(b=s==null?void 0:s.timer)==null?void 0:b.deadLine,startedAt:(j=s==null?void 0:s.timer)==null?void 0:j.startedAt,refetchStageMutate:c,deadLineMutate:L,isPending:P})]}),e.jsxs(y,{className:"p-2 mb-4 border-l-4 border-blue-600 bg-white border shadow-md rounded-xl",children:[e.jsxs("div",{className:"text-blue-600 rounded-t flex items-center gap-2 mb-4",children:[e.jsx("i",{className:"fas fa-user-shield"}),e.jsx("h2",{className:"text-lg font-semibold",children:"MD Approval"})]}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"text-gray-700 font-medium ",children:"Status:"}),p?e.jsxs(Y,{value:m,onValueChange:t=>D(t),children:[e.jsx(Z,{children:e.jsx(ee,{selectedValue:m,placeholder:"Select status"})}),e.jsx(se,{children:["pending","approved","rejected"].map(t=>e.jsx(te,{value:t,children:t.charAt(0).toUpperCase()+t.slice(1)},t))})]}):e.jsx("span",{className:`inline-block px-3 py-1 text-xs font-semibold rounded-full ${((N=s==null?void 0:s.mdApproval)==null?void 0:N.status)==="approved"?"bg-green-200 text-green-700":((v=s==null?void 0:s.mdApproval)==null?void 0:v.status)==="pending"?"bg-yellow-100 text-yellow-800":"bg-red-200 text-red-700"}`,children:((w=s==null?void 0:s.mdApproval)==null?void 0:w.status)||"N/A"}),p?e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{size:"sm",variant:"primary",isLoading:T,onClick:B,children:e.jsx("i",{className:"fas fa-check"})}),e.jsx(n,{size:"sm",variant:"secondary",onClick:()=>d(!1),children:e.jsx("i",{className:"fas fa-xmark"})})]}):e.jsx(n,{size:"md",onClick:R,children:e.jsx("i",{className:"fas fa-pencil"})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-8",children:[e.jsxs(k,{to:`workschedule/${s==null?void 0:s.workScheduleId}`,className:"rounded-xl border border-blue-200 bg-blue-50 hover:bg-blue-100 transition-colors shadow-md px-6 py-5 flex items-center gap-4",children:[e.jsx("i",{className:"fas fa-list-alt text-blue-600 text-3xl"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-blue-800",children:"Work Plans"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Manage detailed work plans for the project."})]})]}),e.jsxs(k,{to:`dailyschedule/${s==null?void 0:s.dailyScheduleId}`,className:"rounded-xl border border-blue-200 bg-blue-50 hover:bg-blue-100 transition-colors shadow-md px-6 py-5 flex items-center gap-4",children:[e.jsx("i",{className:"fas fa-calendar-check text-blue-600 text-3xl"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-blue-800",children:"Daily Tasks"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Track daily activities and progress reports."})]})]})]})]})]})};export{be as default};
