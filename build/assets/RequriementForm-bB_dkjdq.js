import{r as N,j as e,R as y,a as E,u as M,e as ee,d as se,O as te}from"./index-Duiduteo.js";import{g as ae,u as le,h as ie,i as oe,j as re,k as ne,l as ce,m as de}from"./requirementFormApi-Bu99oO0Y.js";import{C as k}from"./Card-Gh0ygLsD.js";import{B as n}from"./Button-DF5tm_KZ.js";import{t as r}from"./toast-BSC5QTk1.js";import{L as P}from"./Label-nktAbCV7.js";import{I as q}from"./Input-52Zu5jN0.js";import{A as me,S as xe}from"./AssignStaff-Z48WGI4U.js";import{R as ue}from"./StageFileUploader-Cbg72I-6.js";import{R as pe}from"./ResetStageButton-Y2VlnjhI.js";import he from"./MaterialOverviewLoading-TJ-ituV7.js";import{S as fe}from"./ShareDocumentWhatsapp-cwaoUxmX.js";import"./useQuery-C2l_NFV4.js";import"./useMutation-BNs_TkNH.js";import"./roleCheck-CeVvsM7Q.js";import"./getAllUsersApi-DSEufrE1.js";import"./downloadFile-BUxmPHqL.js";import"./index-8lvJRKAt.js";import"./ImageGalleryMain-fMmQ8S_0.js";import"./constants-DnylCaPP.js";import"./VideoGalleryMain-Cu-HCWDH.js";import"./Skeleton-bh-hi-We.js";import"./documentationApi-C888mmAL.js";const ge=({client:t,className:c})=>e.jsxs(k,{className:` ${c} p-4 bg-white shadow border-l-4 border-blue-500`,children:[e.jsxs("h2",{className:"text-lg font-semibold text-blue-700 mb-4",children:[e.jsx("i",{className:"fa-solid fa-user-tie mr-2"})," Client Info"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsx(j,{label:"Name",value:t==null?void 0:t.clientName,icon:"fa-user"}),e.jsx(j,{label:"Email",value:t==null?void 0:t.email,icon:"fa-envelope"}),e.jsx(j,{label:"WhatsApp",value:t==null?void 0:t.whatsapp,icon:"fa-phone"}),e.jsx(j,{label:"Location",value:t==null?void 0:t.location,icon:"fa-location-dot"})]})]}),j=({label:t,value:c,icon:d})=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("i",{className:`fa-solid ${d} text-gray-600`}),e.jsxs("strong",{children:[t,":"]})," ",c||"N/A"]}),be=N.memo(ge),je=({sections:t,setIsCreateRoomOpen:c})=>{const{projectId:d}=E(),x=M(),{mutateAsync:m,isPending:h}=ae();return e.jsxs("section",{className:"w-full",children:[e.jsxs("div",{className:"mb-8 flex justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800 mb-2",children:"Project Rooms"}),e.jsx("p",{className:"hidden sm:inline-block text-slate-600",children:"Manage requirements and items for each room"})]}),e.jsx("div",{className:"mt-4",children:e.jsx(n,{onClick:()=>c(!0),className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"+ Create New Room"})})]}),!Array.isArray(t)||!(t!=null&&t.length)?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-4",children:[e.jsx("div",{className:"bg-slate-50 rounded-full p-6 mb-4",children:e.jsx("i",{className:"fas fa-home text-4xl text-slate-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-slate-700 mb-2",children:"No Rooms Available"}),e.jsx("p",{className:"text-slate-500 text-center max-w-md",children:"There are currently no rooms configured for this project. Add some rooms to get started."})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:t.map(a=>{const w=async()=>{var u,p;try{await m({projectId:d,roomId:a._id}),r({title:"Success",description:"Room deleted successfully"})}catch(s){r({title:"Error",description:((p=(u=s==null?void 0:s.response)==null?void 0:u.data)==null?void 0:p.message)||(s==null?void 0:s.message)||"Failed to delete room",variant:"destructive"})}};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"group relative bg-white rounded-2xl shadow-sm border border-slate-200 hover:shadow-xl hover:border-blue-300 transition-all duration-300 cursor-pointer overflow-hidden",onClick:()=>x(`roompage/${a._id}`),children:[e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-3 group-hover:from-blue-100 group-hover:to-indigo-100 transition-colors duration-300",children:e.jsx("i",{className:"fas fa-door-open text-2xl text-blue-600 group-hover:text-blue-700"})}),e.jsx("div",{children:e.jsx(n,{variant:"danger",isLoading:h,className:"hover:text-white",onClick:u=>{u.stopPropagation(),w()},children:e.jsx("i",{className:"fas fa-trash"})})})]}),e.jsx("h3",{className:"font-semibold text-slate-800 group-hover:text-blue-700 transition-colors duration-300 mb-2 line-clamp-2",children:a.roomName}),e.jsxs("div",{className:"flex items-center text-sm text-slate-500 mb-4",children:[e.jsx("i",{className:"fas fa-list-ul mr-2"}),e.jsx("span",{children:"Manage items & requirements"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-medium text-slate-400 uppercase tracking-wide",children:"Click to manage"}),e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full opacity-60 group-hover:opacity-100 transition-opacity duration-300"})]})]}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/5 to-indigo-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none"})]},a._id)})})})]})},Ne=y.memo(je);function we({open:t,onClose:c,onSubmit:d,isLoading:x}){const[m,h]=y.useState("");return y.useEffect(()=>{t||h("")},[t]),t?e.jsx("div",{className:"fixed top-0 left-0 w-full h-screen  bg-black/70 bg-opacity-40 flex justify-center items-center z-50",onClick:c,children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-sm w-full",onClick:a=>a.stopPropagation(),children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Create New Room"}),e.jsx("input",{type:"text",placeholder:"Enter Room Name",className:"w-full p-2 border border-gray-300 rounded mb-4",value:m,onKeyDown:a=>{a.key==="Enter"&&d(m)},autoFocus:!0,onChange:a=>h(a.target.value)}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(n,{className:"px-4 py-2 bg-gray-500 rounded hover:bg-gray-400",onClick:c,disabled:x,children:"Cancel"}),e.jsx(n,{className:"px-4 py-2 bg-blue-600 text-white rounded disabled:opacity-50",onClick:()=>d(m),disabled:!m.trim()||x,children:x?"Creating...":"Create"})]})]})}):null}function Ye(){var S,F,L,A,I;const{projectId:t,organizationId:c}=E(),{role:d}=ee(),{isMobile:x,openMobileSidebar:m}=se(),h=M(),[a,w]=N.useState(""),[u,p]=N.useState(!1),{data:s,isLoading:T,error:f,refetch:b}=le({projectId:t}),{mutateAsync:O,isPending:U}=ie(),{mutateAsync:$,isPending:C}=oe(),{mutateAsync:_,isPending:G}=re(),{mutateAsync:W,isPending:z}=ne(),{mutateAsync:B,isPending:K}=ce(),[Y,v]=N.useState(!1),{mutateAsync:H,isPending:J}=de(),Q=async o=>{var l,i;if(t)try{await H({projectId:t,payload:{roomName:o}}),r({title:"Success",description:"Room created successfully"}),v(!1),b()}catch(g){r({title:"Error",description:((i=(l=g==null?void 0:g.response)==null?void 0:l.data)==null?void 0:i.message)||(g==null?void 0:g.message)||"Failed to create room",variant:"destructive"})}};if(T)return e.jsx(he,{});const V=async()=>{var o,l;try{C||(await $({formId:s._id,projectId:t}),r({title:"Success",description:"completion updated successfully"}),h("../sitemeasurement"))}catch(i){r({title:"Error",description:((l=(o=i==null?void 0:i.response)==null?void 0:o.data)==null?void 0:l.message)||"Failed to update to complete the form",variant:"destructive"})}},X=async o=>{try{const l=["owner","staff","CTO"];if(!d)throw new Error("Not Authorized");if(!l.includes(d))throw new Error("Dont have the access");await navigator.clipboard.writeText(o),p(!0),r({title:"Success",description:"Link copied to clipboard"}),setTimeout(()=>p(!1),4e3)}catch(l){r({title:"Error",description:l.message||"Failed to copy link",variant:"destructive"})}},Z=async()=>{var o,l;try{const i=await O({projectId:t});w(i.inviteLink||i),r({title:"Success",description:"Invitation link generated successfully"})}catch(i){r({title:"Error",description:((l=(o=i==null?void 0:i.response)==null?void 0:o.data)==null?void 0:l.message)||i.message||"Failed to generate invitation link",variant:"destructive"})}},R=async()=>{try{await navigator.clipboard.writeText(a),p(!0),r({title:"Success",description:"Link copied to clipboard"}),setTimeout(()=>p(!1),2e3)}catch{r({title:"Error",description:"Failed to copy link",variant:"destructive"})}},D=()=>{const o=`You're requested to fill the form, Click this link to fill the form: ${a}`,l=`https://wa.me/?text=${encodeURIComponent(o)}`;window.open(l,"_blank")};return location.pathname.includes("roompage")?e.jsx(te,{}):e.jsx("div",{className:"h-full w-full overflow-y-auto ",children:e.jsxs("div",{className:"h-full w-full space-y-4",children:[e.jsxs("div",{className:"flex flex-col w-full sm:flex-row justify-between sm:items-center items-start gap-4",children:[e.jsx("div",{className:"",children:e.jsxs("h2",{className:"text-2xl sm:text-3xl font-semibold text-blue-600 flex items-center",children:[x&&e.jsx("button",{onClick:m,className:"mr-3 p-2 rounded-md border border-gray-300 hover:bg-gray-100",title:"Open Menu",children:e.jsx("i",{className:"fa-solid fa-bars"})})," ",e.jsx("i",{className:"fa-solid fa-pencil mr-2"})," Client Requirement"]})}),e.jsxs("div",{className:"flex flex-wrap sm:flex-nowrap items-center gap-2  !w-[100%] sm:!w-[50%] lg:!w-[60%] justify-end lg:justify-end",children:[e.jsxs(n,{isLoading:C,onClick:V,className:"bg-green-600 hover:bg-green-700 text-white w-full sm:w-auto",children:[e.jsx("i",{className:"fa-solid fa-circle-check mr-2"}),"Mark as Complete"]}),e.jsx(pe,{projectId:t,stageNumber:1,stagePath:"requirementform",className:"sm:!max-w-[20%] w-full"}),!f&&e.jsx(fe,{projectId:t,stageNumber:"1",className:"w-full sm:w-fit",isStageCompleted:s==null?void 0:s.status}),e.jsx(me,{stageName:"RequirementFormModel",projectId:t,organizationId:c,currentAssignedStaff:(s==null?void 0:s.assignedTo)||null,className:"w-full sm:w-auto"})]})]}),f&&e.jsxs("div",{className:"max-w-xl sm:min-w-[80%]  mx-auto mt-4 p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2 text-xl sm:text-3xl",children:"⚠️ Error Occurred"}),e.jsx("p",{className:"text-red-500  mb-4 text-lg sm:text-xl",children:((F=(S=f==null?void 0:f.response)==null?void 0:S.data)==null?void 0:F.message)||"Failed to load data"}),e.jsx(n,{onClick:()=>b(),className:"bg-red-600 text-white px-4 py-2",children:"Retry"})]}),!f&&e.jsxs("main",{className:"h-[calc(100vh-90px)] overflow-y-auto custom-scrollbar space-y-6",children:[e.jsxs(k,{className:"p-4 w-full shadow border-l-4 border-blue-600 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-3 text-blue-700 text-sm font-medium mb-2",children:[e.jsx("i",{className:"fa-solid fa-clock text-blue-500 text-lg"}),e.jsx("span",{children:"Stage Timings"})]}),e.jsx(xe,{startedAt:(L=s==null?void 0:s.timer)==null?void 0:L.startedAt,projectId:t,stageName:"requirementform",refetchStageMutate:b,completedAt:(A=s==null?void 0:s.timer)==null?void 0:A.completedAt,deadLine:(I=s==null?void 0:s.timer)==null?void 0:I.deadLine,formId:s==null?void 0:s._id,deadLineMutate:_,isPending:G})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 sm:gap-6",children:[e.jsx(be,{className:"w-[100%] md:w-[50%]",client:s==null?void 0:s.clientData}),e.jsx(k,{className:"p-4 w-[100%] md:w-[50%] shadow border-l-4 border-blue-500 bg-white",children:e.jsx(ue,{formId:s==null?void 0:s._id,existingUploads:s==null?void 0:s.uploads,onUploadComplete:b,uploadFilesMutate:W,uploadPending:z,projectId:t,refetch:b,onDeleteUpload:B,deleteFilePending:K})})]}),e.jsx(we,{open:Y,onClose:()=>v(!1),onSubmit:Q,isLoading:J}),e.jsx(Ne,{sections:s==null?void 0:s.rooms,setIsCreateRoomOpen:v}),e.jsx("div",{className:"pb-6",children:s!=null&&s.shareToken?e.jsxs("div",{className:"space-y-4",children:[e.jsx(P,{children:"Form Link"}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-2",children:[e.jsx(q,{value:s==null?void 0:s.shareToken,readOnly:!0,className:"bg-blue-50 text-blue-800 flex-1"}),e.jsx(n,{onClick:()=>X(s==null?void 0:s.shareToken),className:"w-full sm:w-auto",children:e.jsx("i",{className:`fas ${u?"fa-check":"fa-copy"}`})})]})]}):e.jsxs("div",{className:"bg-white p-4 sm:p-6 rounded-2xl shadow-lg space-y-4",children:[e.jsxs("h2",{className:"text-lg sm:text-xl font-bold text-blue-900 flex items-center",children:[e.jsx("i",{className:"fas fa-link mr-2"})," Generate Form Link"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Request to fill the form by generating a link."}),a?e.jsxs("div",{className:"space-y-4",children:[e.jsx(P,{children:"Form Link"}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-2",children:[e.jsx(q,{value:a,readOnly:!0,className:"bg-blue-50 text-blue-800 flex-1"}),e.jsx(n,{onClick:R,className:"w-full sm:w-auto",children:e.jsx("i",{className:`fas ${u?"fa-check":"fa-copy"}`})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs(n,{onClick:D,className:"w-full sm:w-auto bg-green-600 text-white",children:[e.jsx("i",{className:"fab fa-whatsapp mr-2"})," Share on WhatsApp"]}),e.jsxs(n,{onClick:R,className:"w-full sm:w-auto border border-blue-400 text-blue-700",children:[e.jsx("i",{className:"fas fa-copy mr-2"})," Copy"]})]})]}):e.jsxs(n,{onClick:Z,isLoading:U,className:"w-full bg-blue-600 text-white py-2.5 sm:py-3",children:[e.jsx("i",{className:"fas fa-link mr-2"})," Generate Form Link"]})]})})]})]})})}export{we as CreateRoomModal,Ye as default};
