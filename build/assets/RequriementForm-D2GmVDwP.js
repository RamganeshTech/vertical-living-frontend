import{r as A,j as e,R as P,u as Y,b as H,a as J,f as ne,O as ce}from"./index-BZjlY-2Z.js";import{g as de,u as me,h as ue,i as xe,j as pe,k as he,l as fe,m as ge}from"./requirementFormApi-BXUq7tiS.js";import{C as E}from"./Card-CmzT6E3j.js";import{B as c}from"./Button-BGBzZFjk.js";import{t as o}from"./toast-BSC5QTk1.js";import{L as B}from"./Label-D3bfhfMc.js";import{I as K}from"./Input-BDSEJtPI.js";import{A as be,S as je}from"./AssignStaff-DHSDCnbr.js";import{R as we}from"./StageFileUploader-DNuYCPQ9.js";import{R as Ne}from"./ResetStageButton-CaASdV3V.js";import ve from"./MaterialOverviewLoading-C38kMtqM.js";import{S as ye}from"./ShareDocumentWhatsapp-hlwJvdoC.js";import{S as ke}from"./StageGuide-BGPpzdDF.js";import"./useQuery-Coz1VCY2.js";import"./useMutation-BRRIqsxx.js";import"./roleCheck-DuKNZHKs.js";import"./getAllUsersApi-CczUwJt9.js";import"./downloadFile-Ck0ndJgl.js";import"./index-CEnBN4s8.js";import"./ImageGalleryMain-BBpbKra0.js";import"./VideoGalleryMain-M0riuzEQ.js";import"./Skeleton-BnQtABYA.js";import"./documentationApi-DG_waLms.js";const Ce=({client:t,className:n})=>e.jsxs(E,{className:` ${n} p-4 bg-white shadow border-l-4 border-blue-500`,children:[e.jsxs("h2",{className:"text-lg font-semibold text-blue-700 mb-4",children:[e.jsx("i",{className:"fa-solid fa-user-tie mr-2"})," Client Info"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsx(L,{label:"Name",value:t==null?void 0:t.clientName,icon:"fa-user"}),e.jsx(L,{label:"Email",value:t==null?void 0:t.email,icon:"fa-envelope"}),e.jsx(L,{label:"WhatsApp",value:t==null?void 0:t.whatsapp,icon:"fa-phone"}),e.jsx(L,{label:"Location",value:t==null?void 0:t.location,icon:"fa-location-dot"})]})]}),L=({label:t,value:n,icon:h})=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("i",{className:`fa-solid ${h} text-gray-600`}),e.jsxs("strong",{children:[t,":"]})," ",n||"N/A"]}),Re=A.memo(Ce),Se=({sections:t,setIsCreateRoomOpen:n})=>{var x,f,R;const{projectId:h}=Y(),{role:d,permission:a}=H(),m=d==="owner"||((x=a==null?void 0:a.clientrequirement)==null?void 0:x.delete),u=d==="owner"||((f=a==null?void 0:a.clientrequirement)==null?void 0:f.create),C=d==="owner"||((R=a==null?void 0:a.clientrequirement)==null?void 0:R.edit),j=J(),{mutateAsync:s,isPending:F}=de();return e.jsxs("section",{className:"w-full",children:[e.jsxs("div",{className:"mb-8 flex justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800 mb-2",children:"Project Rooms"}),e.jsx("p",{className:"hidden sm:inline-block text-slate-600",children:"Manage requirements and items for each room"})]}),(u||C)&&e.jsx("div",{className:"mt-4",children:e.jsx(c,{onClick:()=>n(!0),className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"+ Create New Room"})})]}),!Array.isArray(t)||!(t!=null&&t.length)?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-4",children:[e.jsx("div",{className:"bg-slate-50 rounded-full p-6 mb-4",children:e.jsx("i",{className:"fas fa-home text-4xl text-slate-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-slate-700 mb-2",children:"No Rooms Available"}),e.jsx("p",{className:"text-slate-500 text-center max-w-md",children:"There are currently no rooms configured for this project. Add some rooms to get started."})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:t.map(w=>{const q=async()=>{var b,S;try{await s({projectId:h,roomId:w._id}),o({title:"Success",description:"Room deleted successfully"})}catch(g){o({title:"Error",description:((S=(b=g==null?void 0:g.response)==null?void 0:b.data)==null?void 0:S.message)||(g==null?void 0:g.message)||"Failed to delete room",variant:"destructive"})}};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"group relative bg-white rounded-2xl shadow-sm border border-slate-200 hover:shadow-xl hover:border-blue-300 transition-all duration-300 cursor-pointer overflow-hidden",onClick:()=>j(`roompage/${w._id}`),children:[e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-3 group-hover:from-blue-100 group-hover:to-indigo-100 transition-colors duration-300",children:e.jsx("i",{className:"fas fa-door-open text-2xl text-blue-600 group-hover:text-blue-700"})}),m&&e.jsx("div",{children:e.jsx(c,{variant:"danger",isLoading:F,className:"hover:text-white",onClick:b=>{b.stopPropagation(),q()},children:e.jsx("i",{className:"fas fa-trash"})})})]}),e.jsx("h3",{className:"font-semibold text-slate-800 group-hover:text-blue-700 transition-colors duration-300 mb-2 line-clamp-2",children:w.roomName}),e.jsxs("div",{className:"flex items-center text-sm text-slate-500 mb-4",children:[e.jsx("i",{className:"fas fa-list-ul mr-2"}),e.jsx("span",{children:"Manage items & requirements"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-medium text-slate-400 uppercase tracking-wide",children:"Click to manage"}),e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full opacity-60 group-hover:opacity-100 transition-opacity duration-300"})]})]}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/5 to-indigo-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none"})]},w._id)})})})]})},Le=P.memo(Se);function Ae({open:t,onClose:n,onSubmit:h,isLoading:d}){const[a,m]=P.useState("");return P.useEffect(()=>{t||m("")},[t]),t?e.jsx("div",{className:"fixed top-0 left-0 w-full h-screen  bg-black/70 bg-opacity-40 flex justify-center items-center z-50",onClick:n,children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-sm w-full",onClick:u=>u.stopPropagation(),children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Create New Room"}),e.jsx("input",{type:"text",placeholder:"Enter Room Name",className:"w-full p-2 border border-gray-300 rounded mb-4",value:a,onKeyDown:u=>{u.key==="Enter"&&h(a)},autoFocus:!0,onChange:u=>m(u.target.value)}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(c,{className:"px-4 py-2 bg-gray-500 rounded hover:bg-gray-400",onClick:n,disabled:d,children:"Cancel"}),e.jsx(c,{className:"px-4 py-2 bg-blue-600 text-white rounded disabled:opacity-50",onClick:()=>h(a),disabled:!a.trim()||d,children:d?"Creating...":"Create"})]})]})}):null}function es(){var T,O,U,$,_,G,W,z;const{projectId:t,organizationId:n}=Y(),{isMobile:h,openMobileSidebar:d}=ne(),a=J(),[m,u]=A.useState(""),[C,j]=A.useState(!1),{data:s,isLoading:F,error:x,refetch:f}=me({projectId:t}),{mutateAsync:R,isPending:w}=ue(),{mutateAsync:q,isPending:b}=xe(),{mutateAsync:S,isPending:g}=pe(),{mutateAsync:Q,isPending:V}=he(),{mutateAsync:X,isPending:Z}=fe(),[D,I]=A.useState(!1),{mutateAsync:ee,isPending:se}=ge(),{role:k,permission:p}=H(),te=k==="owner"||((T=p==null?void 0:p.clientrequirement)==null?void 0:T.list),N=k==="owner"||((O=p==null?void 0:p.clientrequirement)==null?void 0:O.create),v=k==="owner"||((U=p==null?void 0:p.clientrequirement)==null?void 0:U.edit),ae=async r=>{var l,i;if(t)try{await ee({projectId:t,payload:{roomName:r}}),o({title:"Success",description:"Room created successfully"}),I(!1),f()}catch(y){o({title:"Error",description:((i=(l=y==null?void 0:y.response)==null?void 0:l.data)==null?void 0:i.message)||(y==null?void 0:y.message)||"Failed to create room",variant:"destructive"})}};if(F)return e.jsx(ve,{});const le=async()=>{var r,l;try{b||(await q({formId:s._id,projectId:t}),o({title:"Success",description:"completion updated successfully"}),a("../sitemeasurement"))}catch(i){o({title:"Error",description:((l=(r=i==null?void 0:i.response)==null?void 0:r.data)==null?void 0:l.message)||"Failed to update to complete the form",variant:"destructive"})}},ie=async r=>{try{const l=["owner","staff","CTO"];if(!k)throw new Error("Not Authorized");if(!l.includes(k))throw new Error("Dont have the access");await navigator.clipboard.writeText(r),j(!0),o({title:"Success",description:"Link copied to clipboard"}),setTimeout(()=>j(!1),4e3)}catch(l){o({title:"Error",description:l.message||"Failed to copy link",variant:"destructive"})}},re=async()=>{var r,l;try{const i=await R({projectId:t});u(i.inviteLink||i),o({title:"Success",description:"Invitation link generated successfully"})}catch(i){o({title:"Error",description:((l=(r=i==null?void 0:i.response)==null?void 0:r.data)==null?void 0:l.message)||i.message||"Failed to generate invitation link",variant:"destructive"})}},M=async()=>{try{await navigator.clipboard.writeText(m),j(!0),o({title:"Success",description:"Link copied to clipboard"}),setTimeout(()=>j(!1),2e3)}catch{o({title:"Error",description:"Failed to copy link",variant:"destructive"})}},oe=()=>{const r=`You're requested to fill the form, Click this link to fill the form: ${m}`,l=`https://wa.me/?text=${encodeURIComponent(r)}`;window.open(l,"_blank")};return location.pathname.includes("roompage")?e.jsx(ce,{}):e.jsx("div",{className:"h-full w-full overflow-y-auto ",children:e.jsxs("div",{className:"h-full w-full space-y-4",children:[e.jsxs("div",{className:"flex flex-col w-full sm:flex-row justify-between sm:items-center items-start gap-4",children:[e.jsx("div",{className:"",children:e.jsxs("h2",{className:"text-2xl sm:text-3xl font-semibold text-blue-600 flex items-center",children:[h&&e.jsx("button",{onClick:d,className:"mr-3 p-2 rounded-md border border-gray-300 hover:bg-gray-100",title:"Open Menu",children:e.jsx("i",{className:"fa-solid fa-bars"})})," ",e.jsx("i",{className:"fa-solid fa-pencil mr-2"})," Client Requirement"]})}),e.jsxs("div",{className:"flex flex-wrap sm:flex-nowrap items-center gap-2  !w-[100%] sm:!w-[50%] lg:!w-[60%] justify-end lg:justify-end",children:[(N||v)&&e.jsxs(c,{isLoading:b,onClick:le,className:"bg-green-600 hover:bg-green-700 text-white w-full sm:w-auto",children:[e.jsx("i",{className:"fa-solid fa-circle-check mr-2"}),"Mark as Complete"]}),(N||v)&&e.jsx(Ne,{projectId:t,stageNumber:1,stagePath:"requirementform",className:"sm:!max-w-[20%] w-full"}),!x&&(N||v)&&e.jsx(ye,{projectId:t,stageNumber:"1",className:"w-full sm:w-fit",isStageCompleted:s==null?void 0:s.status}),(N||v)&&e.jsx(be,{stageName:"RequirementFormModel",projectId:t,organizationId:n,currentAssignedStaff:(s==null?void 0:s.assignedTo)||null,className:"w-full sm:w-auto"}),e.jsx("div",{className:"w-full sm:w-auto flex justify-end sm:block",children:e.jsx(ke,{organizationId:n,stageName:"clientrequirement"})})]})]}),x&&e.jsxs("div",{className:"max-w-xl sm:min-w-[80%]  mx-auto mt-4 p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2 text-xl sm:text-3xl",children:"⚠️ Error Occurred"}),e.jsx("p",{className:"text-red-500  mb-4 text-lg sm:text-xl",children:((_=($=x==null?void 0:x.response)==null?void 0:$.data)==null?void 0:_.message)||"Failed to load data"}),e.jsx(c,{onClick:()=>f(),className:"bg-red-600 text-white px-4 py-2",children:"Retry"})]}),!x&&e.jsxs("main",{className:"h-[calc(100vh-90px)] overflow-y-auto custom-scrollbar space-y-6",children:[e.jsxs(E,{className:"p-4 w-full shadow border-l-4 border-blue-600 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-3 text-blue-700 text-sm font-medium mb-2",children:[e.jsx("i",{className:"fa-solid fa-clock text-blue-500 text-lg"}),e.jsx("span",{children:"Stage Timings"})]}),e.jsx(je,{startedAt:(G=s==null?void 0:s.timer)==null?void 0:G.startedAt,projectId:t,stageName:"requirementform",refetchStageMutate:f,completedAt:(W=s==null?void 0:s.timer)==null?void 0:W.completedAt,deadLine:(z=s==null?void 0:s.timer)==null?void 0:z.deadLine,formId:s==null?void 0:s._id,deadLineMutate:S,isPending:g})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 sm:gap-6",children:[e.jsx(Re,{className:"w-[100%] md:w-[50%]",client:s==null?void 0:s.clientData}),te&&e.jsx(E,{className:"p-4 w-[100%] md:w-[50%] shadow border-l-4 border-blue-500 bg-white",children:e.jsx(we,{enableUpload:v||N,formId:s==null?void 0:s._id,existingUploads:s==null?void 0:s.uploads,onUploadComplete:f,uploadFilesMutate:Q,uploadPending:V,projectId:t,refetch:f,onDeleteUpload:X,deleteFilePending:Z})})]}),e.jsx(Ae,{open:D,onClose:()=>I(!1),onSubmit:ae,isLoading:se}),e.jsx(Le,{sections:s==null?void 0:s.rooms,setIsCreateRoomOpen:I}),e.jsx("div",{className:"pb-6",children:s!=null&&s.shareToken?e.jsxs("div",{className:"space-y-4",children:[e.jsx(B,{children:"Form Link"}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-2",children:[e.jsx(K,{value:s==null?void 0:s.shareToken,readOnly:!0,className:"bg-blue-50 text-blue-800 flex-1"}),e.jsx(c,{onClick:()=>ie(s==null?void 0:s.shareToken),className:"w-full sm:w-auto",children:e.jsx("i",{className:`fas ${C?"fa-check":"fa-copy"}`})})]})]}):e.jsxs("div",{className:"bg-white p-4 sm:p-6 rounded-2xl shadow-lg space-y-4",children:[e.jsxs("h2",{className:"text-lg sm:text-xl font-bold text-blue-900 flex items-center",children:[e.jsx("i",{className:"fas fa-link mr-2"})," Generate Form Link"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Request to fill the form by generating a link."}),!m&&(N||v)?e.jsxs(c,{onClick:re,isLoading:w,className:"w-full bg-blue-600 text-white py-2.5 sm:py-3",children:[e.jsx("i",{className:"fas fa-link mr-2"})," Generate Form Link"]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx(B,{children:"Form Link"}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-2",children:[e.jsx(K,{value:m,readOnly:!0,className:"bg-blue-50 text-blue-800 flex-1"}),e.jsx(c,{onClick:M,className:"w-full sm:w-auto",children:e.jsx("i",{className:`fas ${C?"fa-check":"fa-copy"}`})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs(c,{onClick:oe,className:"w-full sm:w-auto bg-green-600 text-white",children:[e.jsx("i",{className:"fab fa-whatsapp mr-2"})," Share on WhatsApp"]}),e.jsxs(c,{onClick:M,className:"w-full sm:w-auto border border-blue-400 text-blue-700",children:[e.jsx("i",{className:"fas fa-copy mr-2"})," Copy"]})]})]})]})})]})]})})}export{Ae as CreateRoomModal,es as default};
