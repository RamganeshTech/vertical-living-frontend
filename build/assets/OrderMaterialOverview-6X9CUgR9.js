import{r as u,j as e,u as ls,af as is,a as ns,d as cs,k as os,O as ds,M as ms,B as f,t as n}from"./index-BAM0eJUz.js";import{C as Pe,a as us}from"./Card-CdxfjEr-.js";import{A as xs,S as hs}from"./AssignStaff-Bt6qrEbL.js";import{R as ps}from"./ResetStageButton-DaUxSSZv.js";import{u as fs,a as bs,b as gs,c as Ns,d as js,e as vs,f as ys,g as ws,h as Ss,i as Is,j as ks,k as Ps,l as Cs,m as Os}from"./orderMaterialHistoryApi-CM4FQ_Il.js";import{I as k}from"./Input-1UBXZqEj.js";import{d as Ce}from"./downloadFile-BbGV_BaX.js";import{S as As}from"./SearchSelectNew-IGAHiELy.js";import{I as Es}from"./ImageGalleryMain-B3g6b13d.js";import{S as Ds}from"./StageGuide-e28gQ0h1.js";import{u as Z}from"./vendorAccApi-m3R96_-K.js";import{d as Ls,f as _s}from"./dateFormator-BGKi5rfZ.js";const Ms=({ele:l,projectId:w,organizationId:L,refetch:_})=>{const[v,C]=u.useState(!1),S=u.useRef(null),[h,M]=u.useState(null),[b,g]=u.useState(!1),[a,q]=u.useState("priorities"),{mutateAsync:U,isPending:O}=fs(),{data:p,isLoading:$}=Z(L,!!h,h||""),{data:A,isLoading:G}=Z(L,!0);u.useEffect(()=>{if(v&&S.current){const o=S.current.getBoundingClientRect();window.innerHeight-o.bottom<450?g(!0):g(!1)}},[v]),u.useEffect(()=>{const o=E=>{S.current&&!S.current.contains(E.target)&&C(!1)};return document.addEventListener("mousedown",o),()=>document.removeEventListener("mousedown",o)},[]);const W=[{label:"Speed",value:"speed",color:"bg-red-500",icon:"fa-fire"},{label:"Cost Efficient",value:"cost_efficient",color:"bg-yellow-500",icon:"fa-bolt"},{label:"quality",value:"quality",color:"bg-blue-500",icon:"fa-faucet"},{label:"General",value:"general",color:"bg-slate-500",icon:"fa-layer-group"}],B=async(o,E)=>{C(!1);try{await U({projectId:w,organizationId:L,orderItemId:l._id,priority:o,vendorId:E}),_==null||_()}catch(H){console.error("Failed to send to procurement",H)}};return e.jsxs("div",{className:"relative inline-block text-left",ref:S,children:[e.jsxs("button",{type:"button",disabled:(l==null?void 0:l.isSyncWithProcurement)||O,onClick:()=>C(!v),className:`flex items-center gap-2 px-4 py-2 border-2 rounded-lg font-medium transition-all duration-200 
                    ${l!=null&&l.isSyncWithProcurement?"bg-gray-50 border-gray-200 text-gray-400 cursor-not-allowed":"border-green-400 text-green-700 hover:bg-green-50 active:scale-95 shadow-sm"}`,children:[O?e.jsx("i",{className:"fas fa-spinner fa-spin"}):l!=null&&l.isSyncWithProcurement?e.jsx("i",{className:"fas fa-check-circle"}):e.jsx("i",{className:"fas fa-paper-plane"}),e.jsx("span",{children:l!=null&&l.isSyncWithProcurement?"Sent to Procurement":"Send To Procurement"}),!(l!=null&&l.isSyncWithProcurement)&&e.jsx("i",{className:`fas fa-chevron-down text-xs transition-transform ${v?"rotate-180":""}`})]}),v&&e.jsxs("div",{className:`absolute right-0 w-[600px] rounded-2xl bg-slate-50 shadow-2xl border border-blue-100 z-[9999] flex p-3 gap-3 overflow-hidden animate-in fade-in zoom-in duration-200
                    ${b?"bottom-full mb-2":"top-full mt-2"}`,children:[e.jsx("div",{className:"w-1/2 flex flex-col bg-white rounded-xl border border-blue-50 shadow-sm overflow-hidden",children:a==="priorities"?e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"bg-blue-600 px-4 py-3 flex items-center justify-between",children:[e.jsx("span",{className:"text-[10px] font-black text-white uppercase tracking-widest",children:"1. Priority Tag"}),e.jsx("i",{className:"fas fa-tags text-blue-200 text-xs"})]}),e.jsx("div",{className:"p-2 space-y-1",children:W.map(o=>e.jsxs("button",{onClick:()=>{M(o.value),q("vendors")},className:`w-full flex items-center justify-between px-4 py-3 text-sm rounded-lg transition-all group
                                                ${h===o.value?"bg-blue-50 text-blue-700":"text-gray-700 hover:bg-slate-50"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`w-2.5 h-2.5 rounded-full border-2 border-white shadow-sm ${o.color}`}),e.jsx("span",{className:"font-bold",children:o.label})]}),e.jsx("i",{className:"fas fa-chevron-right text-[10px] text-slate-300 group-hover:translate-x-1 transition-transform"})]},o.value))})]}):e.jsxs("div",{className:"flex flex-col h-full animate-in slide-in-from-right-2 duration-200",children:[e.jsxs("div",{className:"bg-blue-700 px-4 py-3 flex items-center gap-3",children:[e.jsx("button",{onClick:()=>q("priorities"),className:"bg-white/20 hover:bg-white/40 text-white w-7 h-7 rounded-full flex items-center justify-center transition-all",children:e.jsx("i",{className:"fas fa-arrow-left text-xs"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-[9px] font-black text-blue-200 uppercase tracking-tighter",children:["Priority: ",h]}),e.jsx("div",{className:"text-sm text-white font-bold leading-none",children:"Choose Vendor"})]})]}),e.jsxs("div",{className:"relative flex-1 min-h-[300px] max-h-[380px] overflow-y-auto custom-scrollbar bg-white p-1",children:[$&&e.jsx("div",{className:"absolute inset-0 bg-white/80 z-10 flex items-center justify-center",children:e.jsx("i",{className:"fas fa-circle-notch fa-spin text-blue-600 text-xl"})}),(p==null?void 0:p.length)>0?p.map(o=>e.jsx(Oe,{vendor:o,onClick:()=>B(h,o._id)},o._id)):!$&&e.jsxs("div",{className:"p-10 text-center flex flex-col items-center",children:[e.jsx("i",{className:"fas fa-store-slash text-slate-200 text-2xl mb-2"}),e.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-tight",children:"No vendors found"})]})]})]})}),e.jsxs("div",{className:"w-1/2 flex flex-col bg-white rounded-xl border border-blue-50 shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"bg-blue-800 px-4 py-3 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-[10px] font-black text-blue-300 uppercase tracking-widest block",children:"Direct Select"}),e.jsx("div",{className:"text-sm text-white font-bold leading-none",children:"All Shops"})]}),e.jsx("i",{className:"fas fa-store text-blue-400 text-xs"})]}),e.jsxs("div",{className:"relative flex-1 min-h-[300px] max-h-[440px] overflow-y-auto custom-scrollbar p-1",children:[G&&e.jsx("div",{className:"absolute inset-0 bg-white/80 z-10 flex items-center justify-center",children:e.jsx("i",{className:"fas fa-circle-notch fa-spin text-blue-400 text-xl"})}),(A==null?void 0:A.length)>0?A.map(o=>e.jsx(Oe,{vendor:o,onClick:()=>B(null,o._id)},o._id)):!G&&e.jsxs("div",{className:"p-10 text-center flex flex-col items-center",children:[e.jsx("i",{className:"fas fa-search text-slate-200 text-2xl mb-2"}),e.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-tight",children:"No Shops Available"})]})]})]})]})]})},Oe=({vendor:l,onClick:w})=>e.jsxs("button",{onClick:w,className:"w-full text-left px-4 py-3.5 hover:bg-blue-50 border-b border-gray-100 last:border-0 transition-colors group",children:[e.jsx("div",{className:"text-sm font-black text-slate-800 truncate uppercase",title:l.vendorName,children:l.vendorName}),e.jsxs("div",{className:"text-[10px] font-medium text-slate-500 flex items-center gap-1.5 mt-0.5 italic",children:[e.jsx("i",{className:"fas fa-store text-blue-400"}),e.jsx("span",{className:"truncate w-full",children:l.shopName||"Untitled Shop"})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("span",{className:"text-[9px] font-bold px-2 py-0.5 bg-slate-100 rounded text-slate-400 group-hover:bg-blue-100 group-hover:text-blue-600 transition-colors uppercase tracking-tighter",children:l.phoneNo||"No Contact"}),e.jsx("i",{className:"fas fa-chevron-right text-[10px] text-blue-500 opacity-0 group-hover:opacity-100 transition-all"})]})]}),X=["nos","pieces","litre","dozens","kg","mm","cm","meter","feet","inch","sqft","sqmm","packet","roll","sheet","set","coil","pair"],qs=()=>{var te,ae,re,le,ie,ne,ce,oe,de,me,ue,xe,he,pe,fe,be,ge,Ne,je,ve,ye,we,Se,Ie,ke;const{projectId:l,organizationId:w}=ls(),{isMobile:L,openMobileSidebar:_}=is(),v=ns(),C=cs(),{role:S,permission:h}=os(),M=S==="owner"||((te=h==null?void 0:h.ordermaterial)==null?void 0:te.delete),b=S==="owner"||((ae=h==null?void 0:h.ordermaterial)==null?void 0:ae.create),g=S==="owner"||((re=h==null?void 0:h.ordermaterial)==null?void 0:re.edit),{data:a,isLoading:q,isError:U,error:O,refetch:p}=bs(l),{mutateAsync:$,isPending:A}=gs(),{mutateAsync:G,isPending:W}=Ns(),{mutateAsync:B}=js(),{mutateAsync:o,isPending:E}=vs(),{mutateAsync:H}=ys(),{mutateAsync:Ae,isPending:K}=ws(),Ee=Ss(),{mutateAsync:De,isPending:Le}=Is(),{mutateAsync:_e,isPending:Me}=ks(),{mutateAsync:qe}=Ps(),{mutateAsync:Ue}=Cs(),{data:P}=Z(w),{mutateAsync:Te,isPending:ze}=Os(),[Re,Q]=u.useState(!1),[c,T]=u.useState({}),[ee,J]=u.useState(!1),[m,D]=u.useState({}),[V,$e]=u.useState({selectedId:null,shopName:null});u.useEffect(()=>{if(V.selectedId&&P.length>0){const s=P.find(t=>t._id===V.selectedId);s&&D({shopName:s==null?void 0:s.shopName,address:s==null?void 0:s.address,contactPerson:s==null?void 0:s.vendorName,phoneNumber:s==null?void 0:s.phoneNo,priority:(s==null?void 0:s.priority)||[]})}},[V.selectedId,P]);const Ge=u.useMemo(()=>P==null?void 0:P.map(s=>({value:s._id,label:s.shopName||s.vendorName,subLabel:s.contactPerson})),[P]),[d,y]=u.useState(null),[x,F]=u.useState({name:"",quantity:1,unit:""}),z=u.useRef(null),Be=async s=>{var t,r;try{const i=s.target.files;if(!i||i.length===0)return;const N=Array.from(i).filter(j=>j.type.startsWith("image/"));if(N.length!==i.length){n({title:"Invalid file type",description:"Only images are allowed (JPG, PNG, etc.)",variant:"destructive"});return}await Ae({files:N,projectId:l}),n({description:"Successfully uploaded images",title:"Success"})}catch(i){n({title:"Error",description:((r=(t=i==null?void 0:i.response)==null?void 0:t.data)==null?void 0:r.message)||i.message||"Failed to upload images",variant:"destructive"})}},Ve=async()=>{var s,t;try{await _e({projectId:l}),n({description:"Completion status updated successfully",title:"Success"}),v("../materialarrival")}catch(r){n({title:"Error",description:((t=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:t.message)||r.message||"Failed to update completion status",variant:"destructive"})}},Fe=async()=>{var s,t;try{if(!window.confirm("Are you sure need to perform this operation?"))return;await Te({projectId:l}),n({description:"All Sub Items successfully",title:"Success"})}catch(r){n({title:"Error",description:((t=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:t.message)||r.message||"Failed to delete sub items",variant:"destructive"})}},We=async()=>{var s,t;try{await G({projectId:l}),n({description:"All Sub Items successfully",title:"Success"})}catch(r){n({title:"Error",description:((t=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:t.message)||r.message||"Failed to delete sub items",variant:"destructive"})}},He=async()=>{var s,t;try{if(c!=null&&c.phoneNumber&&!/^\d{10}$/.test(c==null?void 0:c.phoneNumber.trim()))throw new Error("Phone number should contain exactly 10 digit numbers");await qe({projectId:l,updates:c}),Q(!1),n({title:"Success",description:"Delivery Details Updated"}),p()}catch(r){n({variant:"destructive",title:"Error",description:((t=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:t.message)||(r==null?void 0:r.message)||"Update failed"})}},Ke=async()=>{var s,t;try{if(m.phoneNumber&&!/^\d{10}$/.test(m.phoneNumber.trim()))throw new Error("Phone number should contain exactly 10 digit numbers");await Ue({projectId:l,updates:m}),n({title:"Success",description:"Shop Details Updated"}),J(!1),p()}catch(r){n({variant:"destructive",title:"Error",description:((t=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:t.message)||(r==null?void 0:r.message)||"Update failed"})}},Qe=async s=>{var t,r;try{await Ee.mutateAsync({projectId:l,imageId:s}),p==null||p(),n({title:"Success",description:"deleted successfully"})}catch(i){n({title:"Error",description:((r=(t=i==null?void 0:i.response)==null?void 0:t.data)==null?void 0:r.message)||"failed to delete",variant:"destructive"})}};u.useEffect(()=>{d&&z.current&&(z.current.focus(),z.current.select())},[d]);const Je=l==null?void 0:l.replace(/[^a-zA-Z0-9]/g,"").slice(-3).toLowerCase(),Ye=new Date().getFullYear(),se=(((ie=(le=a==null?void 0:a.orderedItems)==null?void 0:le.map(s=>s==null?void 0:s.orderMaterialNumber))==null?void 0:ie.filter(Boolean))||[]).map(s=>{const t=s.split("-").pop();return parseInt(t,10)||0}),Ze=((se.length?Math.max(...se):0)+1).toString().padStart(3,"0"),Xe=((ne=a==null?void 0:a.currentOrder)==null?void 0:ne.orderMaterialNumber)||`ORD-${Je}-${Ye}-${Ze}`||null,R=async(s,t,r)=>{var i,N,j;try{const I=(i=a.currentOrder.subItems)==null?void 0:i.find(rs=>rs._id===s);if(!I)return;const as={projectId:l,subItemId:s,subItemName:t==="name"?r:I.subItemName,quantity:t==="quantity"?Number(r)?Number(r):1:I.quantity,unit:t==="unit"?r:I.unit};await H(as),n({title:"Success",description:"Item updated successfully"})}catch(I){console.log("filed",I),n({title:"Error",description:((j=(N=I==null?void 0:I.response)==null?void 0:N.data)==null?void 0:j.message)||"Failed to update item",variant:"destructive"})}},Y=async s=>{var r,i;if(!g&&!b)return;const t=s;if(!t&&!(t!=null&&t.name.trim()))return n({title:"Error",description:"Material Name is mandatory",variant:"destructive"});try{await B({projectId:l,subItemName:t.name,quantity:t.quantity??1,unit:t.unit}),F({name:"",quantity:1,unit:""}),n({title:"Success",description:"Item created successfully"})}catch(N){n({title:"Error",description:((i=(r=N==null?void 0:N.response)==null?void 0:r.data)==null?void 0:i.message)||"Failed to create item",variant:"destructive"})}},es=async s=>{var t,r;try{await o({projectId:l,subItemId:s}),n({title:"Success",description:"Item deleted successfully"})}catch(i){n({title:"Error",description:((r=(t=i==null?void 0:i.response)==null?void 0:t.data)==null?void 0:r.message)||"Failed to delete item",variant:"destructive"})}},ss=async s=>{var t,r;try{const i=await $({projectId:l,organizationId:w,orderItemId:s});await Ce({src:i==null?void 0:i.pdfUrl,alt:"Order Material"}),n({title:"Success",description:"Pdf Generated successfully"}),p()}catch(i){n({title:"Error",description:((r=(t=i==null?void 0:i.response)==null?void 0:t.data)==null?void 0:r.message)||(i==null?void 0:i.message)||"Failed to generate link",variant:"destructive"})}},ts=async s=>{var t,r,i,N;try{await Ce({src:(t=s==null?void 0:s.pdfLink)==null?void 0:t.url,alt:(r=s==null?void 0:s.pdfLink)==null?void 0:r.pdfName}),n({title:"Success",description:"PDF Downloaded successfully"})}catch(j){n({title:"Error",description:((N=(i=j==null?void 0:j.response)==null?void 0:i.data)==null?void 0:N.message)||(j==null?void 0:j.message)||"Failed to generate PDF",variant:"destructive"})}};return C.pathname.includes("siteorders")||C.pathname.includes("shoplib")||C.pathname.includes("singleorder")?e.jsx(ds,{}):q?e.jsx(ms,{}):e.jsxs("div",{className:"w-full h-full flex flex-col",children:[e.jsxs("header",{className:"flex-shrink-0 flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-4",children:[e.jsxs("h2",{className:"text-2xl sm:text-2xl lg:text-2xl xl:text-3xl font-semibold text-blue-600 flex items-center",children:[L&&e.jsx("button",{onClick:_,className:"mr-3 p-2 rounded-md border-gray-300 hover:bg-gray-100",title:"Open Menu",children:e.jsx("i",{className:"fa-solid fa-bars"})}),e.jsx("i",{className:"fa-solid fa-cart-shopping mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Ordering Material"}),e.jsx("span",{className:"sm:hidden",children:"Order Material"})]}),e.jsxs("div",{className:"flex gap-2",children:[(b||g)&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full sm:w-auto",children:[e.jsxs(f,{isLoading:Me,onClick:Ve,className:"bg-green-600 hover:bg-green-700 text-white w-full sm:w-auto whitespace-nowrap",children:[e.jsx("i",{className:"fa-solid fa-circle-check mr-2"}),"Mark as Complete"]}),e.jsx(ps,{projectId:l,stageNumber:8,stagePath:"orderingmaterial"}),e.jsx(xs,{stageName:"OrderMaterialHistoryModel",projectId:l,organizationId:w,currentAssignedStaff:(a==null?void 0:a.assignedTo)||null})]})}),e.jsx("div",{className:"w-full sm:w-auto flex justify-end sm:block",children:e.jsx(Ds,{organizationId:w,stageName:"ordermaterial"})})]})]}),U&&e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"max-w-xl p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2",children:"⚠️ Error Occurred"}),e.jsx("p",{className:"text-red-500 text-sm mb-4",children:((oe=(ce=O==null?void 0:O.response)==null?void 0:ce.data)==null?void 0:oe.message)||"Failed to load ordering material"}),e.jsx(f,{isLoading:q,onClick:()=>p(),className:"bg-red-600 text-white hover:bg-red-700",children:"Retry"})]})}),!U&&e.jsxs("div",{className:"flex-1 min-h-0 overflow-y-auto space-y-4 sm:space-y-6 ",children:[e.jsxs(Pe,{className:"p-4 w-full shadow border-l-4 border-blue-600 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-3 text-blue-700 text-sm font-medium mb-2",children:[e.jsx("i",{className:"fa-solid fa-clock text-blue-500 text-lg"}),e.jsx("span",{children:"Stage Timings"})]}),e.jsx(hs,{completedAt:(de=a==null?void 0:a.timer)==null?void 0:de.completedAt,stageName:"orderingmaterial",formId:a==null?void 0:a._id,projectId:l,deadLine:(me=a==null?void 0:a.timer)==null?void 0:me.deadLine,startedAt:(ue=a==null?void 0:a.timer)==null?void 0:ue.startedAt,refetchStageMutate:p,deadLineMutate:De,isPending:Le})]}),!U&&e.jsxs("section",{className:"bg-white rounded-3xl shadow-[0_10px_40px_-15px_rgba(0,0,0,0.1)] overflow-hidden",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 w-full mb-3",children:[e.jsxs("section",{className:"border-l-4 flex-1 border-blue-600 rounded-lg p-4 shadow-sm relative bg-white",children:[e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsx("div",{children:e.jsxs("h2",{className:"text-base sm:text-lg font-bold mb-3 text-blue-700 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-store"}),"Shop Details"]})}),ee?e.jsxs("div",{className:"w-[60%] animate-in fade-in duration-300 mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Assignee"}),e.jsx(As,{options:Ge,placeholder:"Select Shop",searchPlaceholder:"Search by shop name...",value:V.selectedId||"",onValueChange:s=>{const t=P.find(r=>r._id===s);t&&$e({selectedId:t._id,shopName:t.shopName})},searchBy:"name",displayFormat:"detailed",className:"w-full"})]}):e.jsxs("div",{className:"gap-2 flex",children:[e.jsxs(f,{onClick:()=>v("shoplib"),children:[e.jsx("i",{className:"fas fa-shop mr-2"}),"Shop Library"]}),(g||b)&&e.jsxs("button",{onClick:()=>{D(a==null?void 0:a.shopDetails),J(!0)},className:" text-blue-600 text-xs sm:text-sm underline hover:text-blue-800",children:[e.jsx("i",{className:"fa-solid fa-edit mr-1"}),"Edit"]})]})]}),ee?e.jsxs("div",{className:"space-y-3",children:[e.jsx(k,{placeholder:"Shop Name",value:(m==null?void 0:m.shopName)||"",onChange:s=>D({...m,shopName:s.target.value}),className:"w-full"}),e.jsx(k,{placeholder:"Contact Person",value:(m==null?void 0:m.contactPerson)||"",onChange:s=>D({...m,contactPerson:s.target.value}),className:"w-full"}),e.jsx(k,{placeholder:"Phone Number",value:(m==null?void 0:m.phoneNumber)||"",type:"tel",maxLength:10,onChange:s=>D({...m,phoneNumber:s.target.value}),className:"w-full"}),e.jsx(k,{placeholder:"Address",value:(m==null?void 0:m.address)||"",onChange:s=>D({...m,address:s.target.value}),className:"w-full"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mt-3  justify-end ",children:[e.jsxs(f,{onClick:Ke,className:"w-full sm:w-auto",children:[e.jsx("i",{className:"fa-solid fa-save mr-2"}),"Save"]}),e.jsxs(f,{variant:"outline",onClick:()=>J(!1),className:"w-full sm:w-auto",children:[e.jsx("i",{className:"fa-solid fa-times mr-2"}),"Cancel"]})]})]}):e.jsxs("div",{className:"space-y-2 text-sm sm:text-base",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Shop Name:"})," ",((xe=a==null?void 0:a.shopDetails)==null?void 0:xe.shopName)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Contact Person:"})," ",((he=a==null?void 0:a.shopDetails)==null?void 0:he.contactPerson)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Phone:"})," ",((pe=a==null?void 0:a.shopDetails)==null?void 0:pe.phoneNumber)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Address:"})," ",((fe=a==null?void 0:a.shopDetails)==null?void 0:fe.address)||"-"]})]})]}),e.jsxs("div",{className:"border-l-4 flex-1 mt-4 border-blue-600 rounded-lg p-4 shadow-sm relative bg-white",children:[e.jsxs("h2",{className:"text-base sm:text-lg font-bold mb-3 text-blue-700 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-truck"}),"Delivery Location"]}),Re?e.jsxs("div",{className:"space-y-3",children:[e.jsx(k,{placeholder:"Site Name",value:(c==null?void 0:c.siteName)||"",onChange:s=>T({...c,siteName:s.target.value}),className:"w-full"}),e.jsx(k,{placeholder:"Site Supervisor",value:(c==null?void 0:c.siteSupervisor)||"",onChange:s=>T({...c,siteSupervisor:s.target.value}),className:"w-full"}),e.jsx(k,{placeholder:"Phone Number",type:"tel",maxLength:10,value:(c==null?void 0:c.phoneNumber)||"",onChange:s=>T({...c,phoneNumber:s.target.value}),className:"w-full"}),e.jsx(k,{placeholder:"Address",value:(c==null?void 0:c.address)||"",onChange:s=>T({...c,address:s.target.value}),className:"w-full"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mt-3  justify-end ",children:[e.jsxs(f,{onClick:He,className:"w-full sm:w-auto",children:[e.jsx("i",{className:"fa-solid fa-save mr-2"}),"Save"]}),e.jsxs(f,{variant:"outline",onClick:()=>Q(!1),className:"w-full sm:w-auto",children:[e.jsx("i",{className:"fa-solid fa-times mr-2"}),"Cancel"]})]})]}):e.jsxs("div",{className:"space-y-2 text-sm sm:text-base",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Site Name:"})," ",((be=a==null?void 0:a.deliveryLocationDetails)==null?void 0:be.siteName)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Supervisor:"})," ",((ge=a==null?void 0:a.deliveryLocationDetails)==null?void 0:ge.siteSupervisor)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Phone:"})," ",((Ne=a==null?void 0:a.deliveryLocationDetails)==null?void 0:Ne.phoneNumber)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Address:"})," ",((je=a==null?void 0:a.deliveryLocationDetails)==null?void 0:je.address)||"-"]}),(g||b)&&e.jsxs("button",{onClick:()=>{T(a==null?void 0:a.deliveryLocationDetails),Q(!0)},className:"absolute top-3 right-4 text-blue-600 text-xs sm:text-sm underline hover:text-blue-800",children:[e.jsx("i",{className:"fa-solid fa-edit mr-1"}),"Edit"]})]})]})]}),e.jsx("section",{className:"w-full",children:e.jsxs("section",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 border-b pb-2 flex items-center",children:[e.jsx("i",{className:"fas fa-folder-open mr-2 text-blue-500"})," Images"]}),e.jsxs("div",{className:"flex items-center justify-between w-full relative",children:[(g||b)&&e.jsx(k,{type:"file",multiple:!0,accept:"image/*",placeholder:"select files",onChange:Be,disabled:K,className:K?"pr-10 opacity-70 cursor-not-allowed w-full mb-4":"mb-4"}),K&&e.jsx("div",{className:"absolute inset-y-0 right-2 flex items-center",children:e.jsxs("svg",{className:"animate-spin h-5 w-5 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4l3.5-3.5L12 0v4a8 8 0 100 16v4l3.5-3.5L12 20v-4a8 8 0 01-8-8z"})]})})]}),e.jsx("div",{className:"mb-6",children:((ve=a==null?void 0:a.images)==null?void 0:ve.length)>0?e.jsx(Es,{...M?{handleDeleteFile:s=>Qe(s)}:{},imageFiles:a==null?void 0:a.images,height:150,minWidth:150,maxWidth:200}):e.jsx("div",{className:"text-gray-500 text-sm italic bg-gray-50 p-8 rounded-lg text-center border-2 border-dashed border-gray-200",children:"No Images uploaded yet."})})]})}),e.jsxs("div",{className:"mt-6 pt-4 border-t-2 border-blue-200 bg-gradient-to-r from-white to-white rounded-lg p-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-end justify-between pb-4 border-b-2 border-blue-600",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-lg bg-blue-50",children:e.jsx("i",{className:"fa-solid fa-list text-blue-600"})}),e.jsx("h4",{className:"font-bold text-gray-900 text-2xl tracking-tight",children:"Create Material Order"})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-10",children:[e.jsx("span",{className:"flex items-center gap-1 text-[10px] font-bold uppercase tracking-wider text-blue-600 bg-blue-50 px-2 py-0.5 rounded",children:"Instruction"}),e.jsxs("p",{className:"text-xs text-gray-500 italic",children:["Click cells to edit • Press ",e.jsx("span",{className:"font-bold text-gray-700",children:"Enter"})," to save"]})]})]}),e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:e.jsxs("div",{className:"flex items-center self-stretch bg-white rounded-lg border border-gray-200 px-3 py-1 shadow-sm",children:[e.jsxs("div",{className:"flex flex-col leading-none border-r border-gray-200 pr-3 mr-3",children:[e.jsx("span",{className:"text-[9px] font-bold text-gray-400 uppercase tracking-widest",children:"Order ID"}),e.jsx("span",{className:"text-sm font-mono font-black text-blue-700 mt-0.5",children:Xe})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs(f,{variant:"primary",size:"sm",className:"h-8 text-xs px-3 shadow-none",onClick:()=>v("siteorders"),children:[e.jsx("i",{className:"fas fa-box-archive mr-2"}),"View Public Orders"]}),M&&e.jsxs(f,{variant:"danger",size:"sm",className:"h-8 text-xs px-3 bg-red-600 text-white shadow-none",isLoading:ze,onClick:Fe,children:[e.jsx("i",{className:"fas fa-trash mr-2"}),"Delete All"]})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg border-2 border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"grid grid-cols-17 gap-0 bg-gradient-to-r from-blue-100 to-blue-100 border-b-2 border-blue-200",children:[e.jsx("div",{className:"col-span-3 px-4 py-3 text-sm font-medium text-gray-700 border-r border-gray-200",children:"Ref ID"}),e.jsx("div",{className:"col-span-8 px-4 py-3 text-sm font-medium text-gray-700 border-r border-gray-200",children:"Material Name"}),e.jsx("div",{className:"col-span-2 px-4 py-3 text-sm font-medium text-gray-700 border-r border-gray-200",children:"Quantity"}),e.jsx("div",{className:"col-span-3 px-4 py-3 text-sm font-medium text-gray-700 border-r border-gray-200",children:"Unit"}),e.jsx("div",{className:"col-span-1 px-4 py-3 text-sm font-medium text-gray-700",children:"Action"})]}),a.currentOrder.subItems&&((ye=a.currentOrder)==null?void 0:ye.subItems.length)>0&&a.currentOrder.subItems.map(s=>e.jsxs("div",{className:"grid grid-cols-17 gap-0 border-b border-gray-100 hover:bg-gray-50",children:[e.jsx("div",{className:"col-span-3 border-r border-blue-200",children:e.jsx("div",{className:"w-full px-4 py-3 border-none outline-none focus:bg-blue-50",children:(s==null?void 0:s.refId)||"N/A"})}),e.jsx("div",{className:"col-span-8 border-r border-blue-200",children:(d==null?void 0:d.subItemId)===s._id&&(d==null?void 0:d.field)==="name"?e.jsx("input",{ref:z,type:"text",defaultValue:s.subItemName,className:"w-full px-4 py-3 border-none outline-none focus:bg-blue-50",onBlur:t=>{R(s._id,"name",t.target.value),y(null)},onKeyDown:t=>{if(t.key==="Enter"){const r=t.target.value;R(s._id,"name",r),y(null)}t.key==="Escape"&&y(null)}}):e.jsx("div",{className:"px-4 py-3 cursor-pointer hover:bg-blue-50 transition-colors",onClick:()=>{(b||g)&&y({subItemId:s._id,field:"name"})},children:s.subItemName})}),e.jsx("div",{className:"col-span-2 border-r border-blue-200",children:(d==null?void 0:d.subItemId)===s._id&&(d==null?void 0:d.field)==="quantity"?e.jsx("input",{ref:z,type:"number",defaultValue:s.quantity,min:"0",className:"w-full px-4 py-3 border-none outline-none focus:bg-blue-50",onBlur:t=>{R(s._id,"quantity",t.target.value),y(null)},onKeyDown:t=>{t.key==="Enter"&&(R(s._id,"quantity",t.currentTarget.value),y(null)),t.key==="Escape"&&y(null)}}):e.jsx("div",{className:"px-4 py-3 cursor-pointer hover:bg-blue-50 transition-colors",onClick:()=>{(b||g)&&y({subItemId:s._id,field:"quantity"})},children:s.quantity})}),e.jsx("div",{className:"col-span-3 border-r border-blue-200",children:(d==null?void 0:d.subItemId)===s._id&&(d==null?void 0:d.field)==="unit"?e.jsx("div",{className:"p-2 relative z-50",children:e.jsxs("select",{defaultValue:s.unit,onChange:t=>{R(s._id,"unit",t.target.value),y(null)},className:"w-full relative z-[50] px-3 py-2 border border-gray-200 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-sm",children:[e.jsx("option",{value:"",disabled:!0,children:"Selected unit"}),X.map(t=>e.jsx("option",{value:t,children:t},t))]})}):e.jsx("div",{className:"px-4 py-3 cursor-pointer hover:bg-blue-50 transition-colors",onClick:()=>{(b||g)&&y({subItemId:s._id,field:"unit"})},children:s.unit})}),M&&e.jsx("div",{className:"col-span-1 flex items-center justify-center",children:e.jsx(f,{variant:"danger",onClick:()=>es(s._id),disabled:E,isLoading:E,className:"p-2 bg-red-600 text-white  hover:bg-red-50 rounded transition-colors disabled:opacity-50",title:"Delete item",children:e.jsx("i",{className:"fa fa-trash text-sm"})})})]},s._id)),e.jsxs("div",{className:"grid grid-cols-17 gap-0 bg-green-50 border-b border-gray-100",children:[e.jsx("div",{className:"col-span-3 border-r border-gray-200",children:e.jsx("div",{className:"w-full px-4 py-3 border-none outline-none focus:bg-blue-50",children:"Ref Id"})}),e.jsx("div",{className:"col-span-8 border-r border-gray-200",children:e.jsx("input",{type:"text",placeholder:"Enter matterial name...",value:(x==null?void 0:x.name)||"",onChange:s=>{F(t=>({...t,name:s.target.value}))},onBlur:()=>{var s;(s=x==null?void 0:x.name)!=null&&s.trim()&&x.quantity&&x.unit&&Y(x)},onKeyDown:s=>{s.key==="Enter"&&Y(x)},className:"w-full px-4 py-3 bg-transparent border-none outline-none placeholder-gray-400"})}),e.jsx("div",{className:"col-span-2 border-r border-gray-200",children:e.jsx("input",{type:"number",placeholder:"Qty",min:"0",value:(x==null?void 0:x.quantity)||1,onChange:s=>{F(t=>({...t,quantity:Number(s.target.value)||1}))},className:"w-full px-4 py-3 bg-transparent border-none outline-none placeholder-gray-400"})}),e.jsx("div",{className:"col-span-3 border-r border-gray-200",children:e.jsx("div",{className:"p-2",children:e.jsxs("select",{value:(x==null?void 0:x.unit)||"",onChange:async s=>{const t={...x,unit:s.target.value};F(r=>({...r,unit:s.target.value})),await Y(t)},className:"w-full relative z-[50] px-3 py-2 border border-gray-200 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-sm",children:[e.jsx("option",{value:"",children:"Selected unit"}),X.map(s=>e.jsx("option",{value:s,children:s},s))]})})})]}),(!a.currentOrder.subItems||((Se=(we=a.currentOrder)==null?void 0:we.subItems)==null?void 0:Se.length)===0)&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("i",{className:"fa-solid fa-inbox text-2xl mb-2"}),e.jsx("p",{className:"text-sm",children:"No sub-items yet. Start typing in the row above to add items."})]})]})]})]}),e.jsxs("section",{children:[e.jsxs("div",{className:"flex flex-col px-6 sm:flex-row gap-4 items-start sm:items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"Orders"}),e.jsx("p",{className:"text-sm text-gray-600",children:"view your orders"})]}),b&&e.jsx(f,{onClick:We,isLoading:W,className:"min-w-[140px] bg-blue-600 hover:bg-blue-700 text-white font-medium",size:"lg",children:"Submit Order"})]}),a!=null&&a.orderedItems&&((Ie=a==null?void 0:a.orderedItems)==null?void 0:Ie.length)>0?e.jsx("div",{className:"flex flex-col gap-2",children:(ke=a==null?void 0:a.orderedItems)==null?void 0:ke.sort((s,t)=>new Date(t==null?void 0:t.createdAt).getTime()-new Date(s.createdAt).getTime()).map(s=>e.jsx(Pe,{className:"border-green-200  !relative bg-green-50 shadow  border-0 rounded-2xl ",children:e.jsx(us,{className:"p-6 ",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start  sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx("i",{className:"fas fa-check-circle text-green-600"})}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-blue-700 ",children:[e.jsx("span",{className:"!text-sm text-gray-600",children:"Order Id: "})," ",s.orderMaterialNumber]}),e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-0.5 bg-blue-100/50 rounded-md border border-blue-200 w-fit",children:[e.jsx("i",{className:"far fa-calendar-alt text-[10px] text-blue-500"}),e.jsxs("span",{className:"text-[11px] font-bold text-blue-600 uppercase tracking-tight",children:[Ls(s.createdAt)," • ",_s(s.createdAt)]})]})]})]}),e.jsxs("div",{className:"flex flex-col  sm:flex-row gap-2 w-full sm:w-auto ",children:[e.jsxs(f,{variant:"outline",onClick:()=>v(`singleorder/${s._id}`),className:"border-green-300 text-blue-700 hover:bg-blue-100 hover:border-blue-400",children:[e.jsx("i",{className:"fas mr-2 fa-external-link-alt"}),"View"]}),(b||g)&&e.jsx(f,{variant:"outline",onClick:()=>ss(s._id),isLoading:A,className:"border-green-300 text-blue-700 hover:bg-blue-100 hover:border-blue-400",children:"Generate Pdf"}),e.jsx(f,{variant:"secondary",onClick:()=>ts(s),className:"border-blue-300 text-blue-700 hover:bg-blue-100 hover:border-blue-400",children:"Download PDF"}),(b||g)&&e.jsx(Ms,{ele:s,projectId:l,organizationId:w,refetch:p})]})]})})},s._id))}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col items-center  justify-center min-h-[300px] w-full bg-white rounded-xl text-center p-6",children:[e.jsx("i",{className:"fa-solid fa-box text-5xl text-blue-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-1",children:"No Orders Found"})]})})]})]})]})},Zs=Object.freeze(Object.defineProperty({__proto__:null,ORDERMATERIAL_UNIT_OPTIONS:X,default:qs},Symbol.toStringTag,{value:"Module"}));export{X as O,Ms as P,Zs as a};
