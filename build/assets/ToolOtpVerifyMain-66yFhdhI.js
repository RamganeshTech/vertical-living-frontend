import{a as v,b as w,r as x,j as e}from"./index-By5P0A7l.js";import{B as N}from"./Button-DLUK8O0t.js";import{t as g}from"./toast-BSC5QTk1.js";import{g as k,h as R}from"./toolOtpApi-Cj-5bnMm.js";import{B as C}from"./Breadcrumb-CBhb_ayJ.js";import"./useQuery-Cc7pLKfK.js";import"./useMutation-7YLqc7VE.js";import"./useInfiniteQuery-DQF0m-E9.js";import"./roleCheck-YGaMnK_P.js";const B=()=>{const{organizationId:l}=v(),i=w(),[t,m]=x.useState("issue"),f=k(),p=R(),c=t==="issue"?f:p,[n,d]=x.useState(["","","","","",""]),u=x.useRef([]),h=[{label:"Tools & Hardware",path:`/organizations/${l}/projects/toolhub`},{label:"Handover Hub",path:`/organizations/${l}/projects/enterotp`}],b=(a,r)=>{var o;if(!/^\d*$/.test(r))return;const s=[...n];s[a]=r.slice(-1),d(s),r&&a<5&&((o=u.current[a+1])==null||o.focus())},y=(a,r)=>{var s;r.key==="Backspace"&&!n[a]&&a>0&&((s=u.current[a-1])==null||s.focus())},j=async()=>{var r,s;const a=n.join("");if(a.length!==6){g({title:"Incomplete OTP",description:"Please enter all 6 digits",variant:"destructive"});return}try{await c.mutateAsync({otp:a,organizationId:l}),g({title:t==="issue"?"Handover Verified":"Return Verified",description:t==="issue"?"Tool assigned to worker successfully.":"Tool returned to store registry successfully."}),i(-1)}catch(o){g({title:"Verification Failed",description:((s=(r=o==null?void 0:o.response)==null?void 0:r.data)==null?void 0:s.message)||"Invalid or Expired OTP",variant:"destructive"})}};return e.jsxs("div",{className:"flex flex-col h-full w-full bg-gray-50/50",children:[e.jsxs("header",{className:"w-full bg-white border-b border-gray-200 px-8 py-4 flex items-center justify-between sticky top-0 z-10",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("button",{onClick:()=>i(-1),className:"p-2 hover:bg-gray-100 rounded-full transition-colors text-gray-500",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx("span",{className:`w-3 h-3 rounded-full animate-pulse ${t==="issue"?"bg-blue-500":"bg-orange-500"}`}),"Verification Protocol"]}),e.jsx(C,{paths:h})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"flex items-center gap-4 bg-gray-100 p-1.5 rounded-2xl border border-gray-200",children:[e.jsxs("button",{onClick:()=>{m("issue"),d(["","","","","",""])},className:`px-8 py-2.5 cursor-pointer rounded-xl text-sm font-bold transition-all flex items-center gap-2 ${t==="issue"?"bg-blue-600 text-white shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx("i",{className:"fas fa-user-shield"})," ISSUE VERIFY"]}),e.jsxs("button",{onClick:()=>{m("return"),d(["","","","","",""])},className:`px-8 py-2.5 cursor-pointer rounded-xl text-sm font-bold transition-all flex items-center gap-2 ${t==="return"?"bg-orange-600 text-white shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx("i",{className:"fas fa-undo-alt"})," RETURN VERIFY"]})]}),e.jsx("div",{className:"h-8 w-[1px] bg-gray-200 mx-2"}),e.jsx("div",{className:"flex items-center gap-4 bg-gray-100 p-1.5 rounded-2xl border border-gray-200",children:e.jsxs("button",{onClick:()=>i("../issueotp"),className:"px-8 cursor-pointer py-2.5 rounded-xl text-sm font-bold transition-all flex items-center gap-2 text-gray-500 hover:text-gray-700 hover:bg-white",children:[e.jsx("i",{className:"fas fa-paper-plane text-blue-500"}),"GENERATE OTP",e.jsx("i",{className:"fas fa-external-link-alt text-[10px] opacity-50"})]})})]})]}),e.jsxs("div",{className:"max-w-md mx-auto mt-6 w-full bg-white rounded-3xl shadow-xl border border-gray-100 p-8 space-y-8 transition-all",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("div",{className:`w-16 h-16 rounded-2xl flex items-center justify-center mx-auto mb-4 transition-colors ${t==="issue"?"bg-blue-100 text-blue-600":"bg-orange-100 text-orange-600"}`,children:e.jsx("i",{className:`fas ${t==="issue"?"fa-user-shield":"fa-undo-alt"} text-2xl`})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:t==="issue"?"Verify Handover":"Verify Return"}),e.jsx("p",{className:"text-gray-500 text-sm px-4",children:t==="issue"?"Enter the 6-digit code sent to the worker to confirm they received the tool.":"Enter the 6-digit code sent to the worker to confirm they returned the tool."})]}),e.jsx("div",{className:"flex justify-between gap-2 sm:gap-4",children:n.map((a,r)=>e.jsx("input",{ref:s=>{u.current[r]=s},type:"text",inputMode:"numeric",maxLength:1,value:a,onChange:s=>b(r,s.target.value),onKeyDown:s=>y(r,s),className:`w-12 h-14 sm:w-14 sm:h-16 text-center text-2xl font-bold border-2 rounded-xl focus:ring-4 outline-none transition-all text-gray-700 ${t==="issue"?"focus:border-blue-500 focus:ring-blue-100 border-gray-100":"focus:border-orange-500 focus:ring-orange-100 border-gray-100"}`},r))}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsx(N,{onClick:j,disabled:c.isPending,className:`w-full h-12 text-white rounded-xl font-bold shadow-lg transition-all ${t==="issue"?"bg-blue-600 hover:bg-blue-700 shadow-blue-200":"bg-orange-600 hover:bg-orange-700 shadow-orange-200"}`,children:c.isPending?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin mr-2"})," Processing..."]}):t==="issue"?"Confirm Handover":"Confirm Collection"}),e.jsx("button",{onClick:()=>i(-1),className:"w-full text-sm text-gray-400 hover:text-gray-600 font-medium",children:"Cancel"})]}),e.jsxs("div",{className:`rounded-xl p-4 flex gap-3 border transition-colors ${t==="issue"?"bg-blue-50 border-blue-100 text-blue-700":"bg-orange-50 border-orange-100 text-orange-700"}`,children:[e.jsx("i",{className:"fas fa-info-circle mt-1"}),e.jsx("p",{className:"text-[11px] leading-tight",children:t==="issue"?"Handover verification moves responsibility of the asset to the worker.":"Return verification inspects the tool condition and clears the worker's record."})]})]})]})};export{B as default};
