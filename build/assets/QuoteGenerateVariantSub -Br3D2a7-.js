import{j as e,u as te,a as se,b as ae,c as ee,d as re,r as k,B as ne,M as ce,t as X,e as le}from"./index-sOEqqOOm.js";import{R as Y}from"./FurnitureForm-AUj5tGUu.js";import{N as ie}from"./constants-BoN4q75_.js";const oe=({data:x,index:L,selectedBrandRates:z,selectedLaminateRates:f,selectedBrand:D,selectedLaminateBrand:E})=>{console.log("data",x);const Q=(t,m,n)=>{const b=String(t).toLowerCase().replace("mm","").trim(),N=m.find(S=>String(S.thickness).toLowerCase().replace("mm","").trim()===b);return console.log("🔍  rrrr Input thickness:",b),console.log("📦 rrrr Available rates:",m),console.log("✅ rrrr Matched:",N),(N==null?void 0:N.rs)!==void 0?N.rs:n==="laminate"?Z:0},C=t=>{if(!D&&!E)return t.rowTotal||0;const n=Q(t.plywoodNos.thickness,z,"plywood"),b=Q(t.laminateNos.thickness,f,"laminate");console.log("ply Rate",n),console.log("lami Rate",b);const N=32,S=t.plywoodNos.quantity*(n*N),B=t.laminateNos.quantity*(b*N);console.log("plyCost",S),console.log("lamiCost",B);const F=S+B;console.log("baseMaterialCost",F);const q=F*(t.profitOnMaterial/100);console.log("profitOnMaterial",q);const s=t.carpenters*t.days*Y.labour;console.log("labour cost",s);const a=s*(t.profitOnLabour/100);console.log("profiit on labour",a);const r=F+q+s+a;return Math.round(r)},A=t=>t.quantity*t.cost,G=x.coreMaterials.reduce((t,m)=>t+C(m),0),o=x.fittingsAndAccessories.reduce((t,m)=>t+A(m),0),P=x.glues.reduce((t,m)=>t+A(m),0),p=x.nonBrandMaterials.reduce((t,m)=>t+A(m),0),w=G+o+P+p,v=()=>e.jsxs("div",{className:"mt-6",children:[e.jsxs("h3",{className:"font-semibold text-md text-gray-800 mb-2",children:["Core Materials (Total: ₹",G.toLocaleString("en-IN"),")"]}),e.jsx("div",{className:"overflow-x-auto rounded-md",children:e.jsxs("table",{className:"min-w-full text-sm bg-white shadow-sm",children:[e.jsxs("thead",{className:"bg-blue-50 text-sm font-semibold text-gray-600",children:[e.jsxs("tr",{children:[e.jsx("th",{rowSpan:2,className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Image"}),e.jsx("th",{rowSpan:2,className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Item Name"}),e.jsx("th",{colSpan:2,className:"text-center px-6 py-1 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Plywood"}),e.jsx("th",{colSpan:2,className:"text-center px-6 py-1 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Laminate"}),e.jsx("th",{rowSpan:2,className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"No. of Carpenters / Day"}),e.jsx("th",{rowSpan:2,className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"No. of Days"}),e.jsx("th",{rowSpan:2,className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Profit % Material"}),e.jsx("th",{rowSpan:2,className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Profit % Labour"}),e.jsx("th",{rowSpan:2,className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Remarks"}),e.jsx("th",{rowSpan:2,className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),e.jsx("th",{rowSpan:2,className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]}),e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-6 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Qty"}),e.jsx("th",{className:"text-center px-6 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Thk"}),e.jsx("th",{className:"text-center px-6 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Qty"}),e.jsx("th",{className:"text-center px-6 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Thk"})]})]}),e.jsx("tbody",{children:(x.coreMaterials.length>0?x.coreMaterials:[R()]).map((t,m)=>{var b,N,S,B;const n=C(t);return e.jsxs("tr",{className:"group border",children:[e.jsx("td",{className:"text-center border-r-1 p-2",children:t!=null&&t.imageUrl?e.jsx("img",{src:(t==null?void 0:t.imageUrl)||ie,className:"h-10 mx-auto"}):e.jsx(e.Fragment,{children:"—"})}),e.jsx("td",{className:"text-center border-r-1 p-2",children:(t==null?void 0:t.itemName)||"—"}),e.jsx("td",{className:"text-center border-r-1 p-2",children:((b=t==null?void 0:t.plywoodNos)==null?void 0:b.quantity)??0}),e.jsx("td",{className:"text-center border-r-1 p-2",children:((N=t==null?void 0:t.plywoodNos)==null?void 0:N.thickness)??0}),e.jsx("td",{className:"text-center border-r-1 p-2",children:((S=t==null?void 0:t.laminateNos)==null?void 0:S.quantity)??0}),e.jsx("td",{className:"text-center border-r-1 p-2",children:((B=t==null?void 0:t.laminateNos)==null?void 0:B.thickness)??0}),e.jsx("td",{className:"text-center border-r-1 p-2",children:(t==null?void 0:t.carpenters)||0}),e.jsx("td",{className:"text-center border-r-1 p-2",children:(t==null?void 0:t.days)||0}),e.jsx("td",{className:"text-center border-r-1 p-2",children:(t==null?void 0:t.profitOnMaterial)||0}),e.jsx("td",{className:"text-center border-r-1 p-2",children:(t==null?void 0:t.profitOnLabour)||0}),e.jsx("td",{className:"text-center border-r-1 p-2",children:(t==null?void 0:t.remarks)||"—"}),e.jsxs("td",{className:"text-center border-r-1 p-2 text-green-700 font-bold",children:["₹",n==null?void 0:n.toLocaleString("en-IN")]}),e.jsx("td",{className:"text-center border-r-1 p-2",children:"—"})]},m)})})]})})]}),y=(t,m)=>e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"font-semibold text-md mb-2 text-gray-800",children:t}),e.jsxs("table",{className:"min-w-full text-sm bg-white shadow-sm",children:[e.jsx("thead",{className:"bg-blue-50 text-sm font-semibold text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Item Name"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Description"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Quantity"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Cost"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{children:(m.length>0?m:[T()]).map((n,b)=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"text-center border p-2",children:(n==null?void 0:n.itemName)||"—"}),e.jsx("td",{className:"text-center border p-2",children:(n==null?void 0:n.description)||"—"}),e.jsx("td",{className:"text-center border p-2",children:(n==null?void 0:n.quantity)||0}),e.jsx("td",{className:"text-center border p-2",children:(n==null?void 0:n.cost)||0}),e.jsxs("td",{className:"text-center border p-2 text-green-700 font-bold",children:["₹",A(n).toLocaleString("en-IN")]}),e.jsx("td",{className:"text-center border p-2",children:"—"})]},b))})]})]}),R=()=>({itemName:"",plywoodNos:{quantity:0,thickness:0},laminateNos:{quantity:0,thickness:0},carpenters:0,days:0,profitOnMaterial:0,profitOnLabour:0,remarks:"",rowTotal:0,imageUrl:void 0,previewUrl:""}),T=()=>({itemName:"",description:"",quantity:0,cost:0,rowTotal:0});return e.jsxs("div",{className:"shadow-md p-4 my-4 border rounded-lg bg-white",children:[e.jsxs("div",{className:" flex justify-between items-center",children:[e.jsxs("h2",{className:"text-xl font-semibold  text-blue-600",children:["Furniture ",L+1,": ",x.furnitureName]}),e.jsxs("div",{className:"text-right text-xl font-bold text-green-700",children:["Furniture Total: ₹",w.toLocaleString("en-IN")]})]}),v(),y("Fittings & Accessories",x.fittingsAndAccessories),y("Glues",x.glues),y("Non-Branded Materials",x.nonBrandMaterials)]})},Z=10,ue=()=>{var F,q;const{organizationId:x,quoteId:L}=te(),z=se(),{data:f,isLoading:D}=ae(x,L);let{data:E,isLoading:Q}=ee(x,"plywood"),{data:C}=ee(x,"Laminate");const{mutateAsync:A,isPending:G}=re(),[o,P]=k.useState(null),[p,w]=k.useState(null),v=k.useMemo(()=>{if(!E)return{};const s={};return E.forEach(a=>{const r=(a==null?void 0:a.data)||{},c=r.Brand??r.brand,d=r["thickness (mm)"]||r.thickness||r.Thickness;let u=r.Rs||r.rs;if(c&&d&&u){const h=String(c).trim(),M=String(d).trim(),g=parseFloat(u);s[h]||(s[h]=[]),s[h].push({thickness:M,rs:g})}}),s},[E]),y=k.useMemo(()=>Object.keys(v),[v]),R=k.useMemo(()=>{if(!C)return{};const s={};return C.forEach(a=>{const r=(a==null?void 0:a.data)||{},c=r.Brand??r.brand,d=r["thickness (mm)"]||r.thickness||r.Thickness,u=r.Rs||r.rs;if(c&&d&&u){const h=String(c).trim(),M=String(d).trim(),g=parseFloat(u);s[h]||(s[h]=[]),s[h].push({thickness:M,rs:g})}}),s},[C]),T=k.useMemo(()=>Object.keys(R),[R]),[t,m]=k.useState([]),n=s=>{var c;if(!o)return 0;const a=String(s).toLowerCase().replace("mm","").trim(),r=(c=v[o])==null?void 0:c.find(d=>String(d.thickness).toLowerCase().replace("mm","").trim()===a);return(r==null?void 0:r.rs)||0},b=s=>{var d;if(!p)return Z;const a=u=>String(u).replace(/mm/gi,"").replace(/\s+/g,"").trim().toLowerCase(),r=a(s),c=(d=R[p])==null?void 0:d.find(u=>a(u.thickness)===r);return(c==null?void 0:c.rs)??Z},N=k.useMemo(()=>{if(t.length===0)return 0;const s=32,a=c=>{const d=c.coreMaterials.reduce((g,i)=>{var j,_;if(!o&&!p)return g+(i.rowTotal||0);{const V=n(i.plywoodNos.thickness),U=b(i.laminateNos.thickness),H=((j=i.plywoodNos)==null?void 0:j.quantity)*V*s,W=((_=i.laminateNos)==null?void 0:_.quantity)*U*s,O=H+W,$=O*(i.profitOnMaterial/100),I=i.carpenters*i.days*Y.labour,J=I*(i.profitOnLabour/100),K=O+$+I+J;return g+Math.round(K)}},0),u=c.fittingsAndAccessories.reduce((g,i)=>g+i.quantity*i.cost,0),h=c.glues.reduce((g,i)=>g+i.quantity*i.cost,0),M=c.nonBrandMaterials.reduce((g,i)=>g+i.quantity*i.cost,0);return Math.round(d+u+h+M)};return t.reduce((c,d)=>c+a(d),0)},[t,o,p]),S=()=>t.map(s=>{const a=s.coreMaterials||[],r=l=>{if(!o&&!p)return l.rowTotal||0;const _=n(l.plywoodNos.thickness),V=b(l.laminateNos.thickness),U=32,H=l.plywoodNos.quantity*_*U,W=l.laminateNos.quantity*V*U,O=H+W,$=O*(l.profitOnMaterial/100),I=l.carpenters*l.days*Y.labour,J=I*(l.profitOnLabour/100),K=O+$+I+J;return Math.round(K)},c=l=>l.quantity*l.cost,d=a.map(l=>({...l,rowTotal:r(l)})),u=s.fittingsAndAccessories.reduce((l,j)=>l+c(j),0),h=s.glues.reduce((l,j)=>l+c(j),0),M=s.nonBrandMaterials.reduce((l,j)=>l+c(j),0),g=d.reduce((l,j)=>l+j.rowTotal,0),i=g+u+h+M;return{...s,coreMaterials:d,coreMaterialsTotal:g,fittingsAndAccessoriesTotal:u,gluesTotal:h,nonBrandMaterialsTotal:M,furnitureTotal:i,totals:{core:g,fittings:u,glues:h,nbms:M,furnitureTotal:i}}}),B=async()=>{var s,a;try{if(!x||!L||!f||!o){X({title:"Missing info",description:"Please ensure brand and all details are selected",variant:"destructive"});return}const r=S(),c=r.reduce((u,h)=>u+h.furnitureTotal,0),d=await A({quoteId:L,organizationId:x,data:{quoteId:L,organizationId:x,projectId:f.projectId,brandName:o,laminateBrand:p,furnitures:r,grandTotal:c,notes:"Generated with brand variant"}});le({src:d.url,alt:d.fileName}),X({title:"success",description:"scuesssfully vrated"})}catch(r){X({title:"Error",description:((a=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:a.message)??"Operation failed"})}};return k.useEffect(()=>{if(!(f!=null&&f.furnitures))return;const s=f.furnitures.map(a=>({furnitureName:a.furnitureName,coreMaterials:a.coreMaterials||[],fittingsAndAccessories:a.fittingsAndAccessories||[],glues:a.glues||[],nonBrandMaterials:a.nonBrandMaterials||[],totals:{core:a.coreMaterialsTotal||0,fittings:a.fittingsAndAccessoriesTotal||0,glues:a.gluesTotal||0,nbms:a.nonBrandMaterialsTotal||0,furnitureTotal:a.furnitureTotal||0}}));m(s)},[f]),k.useEffect(()=>{!o&&(y==null?void 0:y.length)>0&&P(y[0])},[y]),k.useEffect(()=>{!p&&(T==null?void 0:T.length)>0&&w(T[0])},[T]),e.jsxs("div",{className:"p-2 max-h-full overflow-y-auto",children:[e.jsxs("header",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("div",{onClick:()=>z(-1),className:"bg-slate-50 hover:bg-slate-300 flex items-center justify-between w-8 h-8 border border-[#a6aab8] text-sm cursor-pointer rounded-md px-2 ",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsxs("h1",{className:"text-2xl font-bold",children:["Quote #",(f==null?void 0:f.quoteNo)||"View"]})]}),e.jsxs("div",{className:"flex items-center gap-3 justify-end ",children:[e.jsx("div",{children:e.jsx(ne,{isLoading:G,onClick:()=>{B()},children:"Generate Quote"})}),e.jsxs("div",{children:[e.jsx("label",{className:"font-medium text-gray-700",children:"Select plywood Brand:"}),e.jsxs("select",{value:o||"",onChange:s=>P(s.target.value),className:"border border-gray-300 px-3 py-2 rounded text-sm w-full",children:[e.jsx("option",{value:"",children:"-- Choose Brand --"}),y.length>0?e.jsx(e.Fragment,{children:y.map(s=>e.jsx("option",{value:s,children:s},s))}):e.jsx(e.Fragment,{children:e.jsx("option",{value:"",disabled:!0,className:"text-gray-400",children:"No Playwood brand options available. Create it in the Rate config section."})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"font-medium text-gray-700",children:"Select Laminate Brand:"}),e.jsxs("select",{value:p||"",onChange:s=>w(s.target.value),className:"border border-gray-300 px-3 py-2 rounded text-sm w-full",children:[e.jsx("option",{value:"",children:"-- Choose Laminate Brand --"}),T.length>0?e.jsx(e.Fragment,{children:T.map(s=>e.jsx("option",{value:s,children:s},s))}):e.jsx(e.Fragment,{children:e.jsx("option",{value:"",disabled:!0,className:"text-gray-400",children:"No Laminate brand options available. Create it in the Rate config."})})]})]})]})]}),o&&((F=v[o])==null?void 0:F.length)>0&&e.jsxs("div",{className:"mt-6 border border-gray-200 bg-white rounded-md shadow-sm p-4",children:[e.jsxs("h3",{className:"text-md font-semibold text-gray-800 mb-2",children:["Available Thickness & Rates for ",e.jsx("span",{className:"text-blue-600",children:o})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm text-left border border-gray-100",children:[e.jsx("thead",{className:"bg-blue-50 text-xs text-gray-600 uppercase tracking-wider",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 border-r",children:"Thickness"}),e.jsx("th",{className:"px-4 py-2",children:"Rate (₹/sqft)"})]})}),e.jsx("tbody",{children:v[o].map((s,a)=>e.jsxs("tr",{className:"border-t border-gray-100",children:[e.jsx("td",{className:"px-4 py-2 border-r text-gray-700 font-medium",children:s.thickness}),e.jsxs("td",{className:"px-4 py-2 text-green-800 font-bold",children:["₹",s.rs.toFixed(2)]})]},a))})]})})]}),p&&((q=R[p])==null?void 0:q.length)>0&&e.jsxs("div",{className:"mt-4 border bg-white rounded-md shadow-sm p-4",children:[e.jsxs("h3",{className:"text-md font-semibold text-gray-800 mb-2",children:["Laminate Rates for ",e.jsx("span",{className:"text-blue-600",children:p})]}),e.jsxs("table",{className:"min-w-full text-sm border",children:[e.jsx("thead",{className:"bg-blue-50 text-xs text-gray-600 uppercase",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 border-r",children:"Thickness"}),e.jsx("th",{className:"px-4 py-2",children:"Rate (₹/sqft)"})]})}),e.jsx("tbody",{children:R[p].map((s,a)=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-2 border-r font-medium",children:s.thickness}),e.jsxs("td",{className:"px-4 py-2 text-green-800 font-bold",children:["₹",s.rs.toFixed(2)]})]},a))})]})]}),D||Q?e.jsx(ce,{}):e.jsx(e.Fragment,{children:e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-6",children:[t.map((s,a)=>e.jsx(oe,{index:a,data:s,selectedBrandRates:o?v[o]||[]:[],selectedLaminateRates:p?R[p]||[]:[],selectedBrand:o,selectedLaminateBrand:p},a)),e.jsx("div",{className:"mt-10 text-right",children:e.jsxs("div",{className:"inline-block bg-green-50 border border-green-200 rounded-md px-6 py-4",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-700 mb-1",children:["Total Estimate ",o?`(Based on ${o})`:""]}),e.jsxs("p",{className:"text-2xl font-bold text-green-700",children:["₹",N.toLocaleString("en-IN")]})]})})]})})})]})};export{Z as DEFAULT_LAMINATE_RATE_PER_SQFT,ue as default};
