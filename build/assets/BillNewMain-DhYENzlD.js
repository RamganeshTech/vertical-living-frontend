import{a as z,e as $,u as H,r as p,b as M,j as e,O as _}from"./index-Dkf7SbMA.js";import{C as G,b as V,c as U,a as q}from"./Card-BI-_ii1r.js";import{B as J}from"./Badge-D-jZpWR0.js";import{d as K}from"./dateFormator-BGKi5rfZ.js";import{d as Q,e as W}from"./billNewAccountingApi-Br0Rh_jI.js";import{B as o}from"./Button-ClgICMLF.js";import{u as X}from"./useDebounce-DdomlvL1.js";import{B as Y}from"./Breadcrumb-By3hsyj1.js";import{S as Z}from"./StageGuide-CjTD8LTi.js";import"./useQuery-h0LZ4b8f.js";import"./useMutation-DtRxugN4.js";import"./useInfiniteQuery-BUWQcrvt.js";import"./roleCheck-CXq1v0D5.js";import"./toast-BSC5QTk1.js";const fe=()=>{var b,N,y;const i=z(),n=$(),{organizationId:c}=H(),g=p.useRef(null),[a,l]=p.useState({search:"",projectId:"",createdFromDate:"",createdToDate:"",sortBy:"createdAt",sortOrder:"desc"}),v=X(a.search,700),{role:d,permission:r}=M(),w=d==="owner"||((b=r==null?void 0:r.billtemplate)==null?void 0:b.list),C=d==="owner"||((N=r==null?void 0:r.billtemplate)==null?void 0:N.create),D=d==="owner"||((y=r==null?void 0:r.billtemplate)==null?void 0:y.delete),{data:x,fetchNextPage:j,hasNextPage:m,isFetchingNextPage:u,isLoading:B,isError:k,error:h,refetch:F}=Q({organizationId:c,projectId:a.projectId||void 0,limit:12,search:v,createdFromDate:a.createdFromDate,createdToDate:a.createdToDate,sortBy:a.sortBy,sortOrder:a.sortOrder}),I=W(),f=(x==null?void 0:x.pages.flatMap(t=>t.data))||[];p.useEffect(()=>{const t=g.current;if(!t)return;const s=()=>{const{scrollTop:L,scrollHeight:S,clientHeight:R}=t;S-L-R<100&&m&&!u&&j()};return t.addEventListener("scroll",s),()=>t.removeEventListener("scroll",s)},[m,u,j]);const O=t=>{i(`single/${t}`)},A=(t,s)=>{t.stopPropagation(),window.confirm("Are you sure you want to delete this bill?")&&I.mutate({id:s,organizationId:c})},E=()=>{l({search:"",projectId:"",createdFromDate:"",createdToDate:"",sortBy:"createdAt",sortOrder:"desc"})},P=[{label:"Account",path:`/organizations/${c}/projects/accounting`},{label:"Design Bill",path:`/organizations/${c}/projects/billnew`}],T=(a.search?1:0)+(a.projectId?1:0)+(a.createdFromDate?1:0);return n.pathname.includes("/single")||n.pathname.includes("/create")||n.pathname.includes("/billtemplate")?e.jsx(_,{}):e.jsxs("div",{className:"h-full flex flex-col bg-gray-50/50 overflow-hidden",children:[e.jsxs("header",{className:"flex justify-between items-center bg-white border-b border-gray-200 flex-shrink-0",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-file-pdf mr-3 text-blue-600"}),"Bill Designs"]}),e.jsx(Y,{paths:P})]}),e.jsxs("div",{className:"gap-2 flex items-center",children:[C&&e.jsxs(o,{onClick:()=>i("create"),className:"bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx("i",{className:"fas fa-plus mr-2"})," Create Bill"]}),e.jsxs(o,{onClick:()=>i("billtemplate"),className:"bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx("i",{className:"fas fa-file-invoice mr-2"})," Bill Template"]}),e.jsx("div",{className:"w-full sm:w-auto flex justify-end sm:block",children:e.jsx(Z,{organizationId:c,stageName:"billtemplate"})})]})]}),B?e.jsxs("div",{className:"flex flex-1 items-center justify-center text-gray-500",children:[e.jsx("i",{className:"fas fa-spinner fa-spin mr-2 text-2xl"})," Loading Bills..."]}):k?e.jsxs("div",{className:"max-w-xl mx-auto mt-10 p-6 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2 text-xl",children:"⚠️ Error Occurred"}),e.jsx("p",{className:"text-red-500 mb-4",children:(h==null?void 0:h.message)||"Failed to load bills."}),e.jsx(o,{onClick:()=>F(),className:"bg-red-600 text-white",children:"Retry"})]}):e.jsxs("main",{className:"flex flex-col xl:flex-row flex-1 overflow-hidden",children:[e.jsxs("div",{className:"xl:w-80 flex-shrink-0 border-r border-gray-200 bg-white overflow-y-auto p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-md font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-filter mr-2 text-blue-600"})," Filters"]}),T>0&&e.jsx("button",{onClick:E,className:"text-xs text-blue-600 hover:underline font-medium",children:"Clear All"})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx("i",{className:"fas fa-search absolute left-3 top-2.5 text-gray-400 text-xs"}),e.jsx("input",{type:"text",placeholder:"Customer or Bill #...",value:a.search,onChange:t=>l(s=>({...s,search:t.target.value})),className:"w-full pl-8 pr-3 py-2 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500 outline-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"Project ID"}),e.jsx("input",{type:"text",placeholder:"Filter by Project ID",value:a.projectId,onChange:t=>l(s=>({...s,projectId:t.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded text-sm outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"Date Range"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"date",className:"w-full px-3 py-2 border border-gray-300 rounded text-sm outline-none",value:a.createdFromDate,onChange:t=>l(s=>({...s,createdFromDate:t.target.value}))}),e.jsx("input",{type:"date",className:"w-full px-3 py-2 border border-gray-300 rounded text-sm outline-none",value:a.createdToDate,onChange:t=>l(s=>({...s,createdToDate:t.target.value}))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"Sort By"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("select",{value:a.sortBy,onChange:t=>l(s=>({...s,sortBy:t.target.value})),className:"w-full px-2 py-2 border border-gray-300 rounded text-sm outline-none bg-white",children:[e.jsx("option",{value:"createdAt",children:"Created"}),e.jsx("option",{value:"billNumber",children:"Bill #"}),e.jsx("option",{value:"customerName",children:"Customer"})]}),e.jsxs("select",{value:a.sortOrder,onChange:t=>l(s=>({...s,sortOrder:t.target.value})),className:"w-full px-2 py-2 border border-gray-300 rounded text-sm outline-none bg-white",children:[e.jsx("option",{value:"desc",children:"Newest"}),e.jsx("option",{value:"asc",children:"Oldest"})]})]})]})]})]}),w&&e.jsx("div",{ref:g,className:"flex-1 overflow-y-auto bg-gray-50/50 p-4",children:f.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center",children:[e.jsx("div",{className:"w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mb-4",children:e.jsx("i",{className:"fas fa-box-open text-4xl text-gray-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-700",children:"No Bills Found"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:a.search?`No matches for "${a.search}"`:"Create a new bill to get started."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 2xl:grid-cols-4 gap-6",children:f.map(t=>e.jsxs(G,{onClick:()=>O(t._id),className:"cursor-pointer hover:shadow-xl transition-all duration-300 border-l-4 border-l-green-500 relative group",children:[e.jsxs(V,{className:"pb-2",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-bold text-lg text-gray-800 truncate",title:t.customerName,children:t.customerName||"Unknown Customer"}),e.jsx("span",{className:"text-xs text-gray-500 font-mono bg-gray-100 px-2 py-0.5 rounded mt-1 inline-block",children:t.billNumber})]}),D&&e.jsx(o,{variant:"danger",size:"icon",className:"h-7 w-7 opacity-0 group-hover:opacity-100 transition-opacity",onClick:s=>A(s,t._id),children:e.jsx("i",{className:"fas fa-trash text-xs"})})]}),e.jsxs(U,{className:"mt-2 text-xs",children:[e.jsx("i",{className:"far fa-calendar mr-1"}),K(t.createdAt)]})]}),e.jsx(q,{children:e.jsx("div",{className:"flex gap-2 flex-wrap",children:t.projectId&&e.jsxs(J,{variant:"secondary",className:"text-[10px]",children:[e.jsx("i",{className:"fas fa-project-diagram mr-1"}),t.projectId.projectName||"Project"]})})})]},t._id))}),u&&e.jsx("div",{className:"flex justify-center py-8",children:e.jsxs("div",{className:"flex items-center gap-2 text-blue-600",children:[e.jsx("i",{className:"fas fa-spinner fa-spin text-xl"}),e.jsx("span",{className:"text-sm font-medium",children:"Loading more bills..."})]})}),!m&&f.length>0&&e.jsx("div",{className:"flex justify-center py-6 text-gray-400 text-xs",children:e.jsx("p",{children:"End of list"})})]})})]})]})};export{fe as default};
