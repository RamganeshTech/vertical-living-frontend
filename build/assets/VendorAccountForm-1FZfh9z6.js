import{b as J,u as K,r as c,j as e}from"./index-DLaY3p7d.js";import{C as Q}from"./Card-BHri7Z1r.js";import{B as N}from"./Button-B7O4a2pZ.js";import{g as X}from"./vendorAccApi-pEC3_Fgz.js";import{I as Y}from"./ImageGalleryMain-zPj6a3lK.js";import{d as Z}from"./dateFormator-BGKi5rfZ.js";import{t as D}from"./toast-BSC5QTk1.js";const ne=({mode:A,initialData:a,onSubmit:U,isSubmitting:v})=>{var R,M,S,B;const{organizationId:w}=J(),E=K(),[n,k]=c.useState(A),[P,C]=c.useState(void 0),[d,g]=c.useState(null),[I,p]=c.useState(!1),[r,u]=c.useState({organizationId:w,projectId:(a==null?void 0:a.projectId)||null,clientId:(a==null?void 0:a.clientId)||null,firstName:"",companyName:"",email:"",phone:{work:"",mobile:""},vendorLanguage:"English",pan:"",currency:"INR - Indian Rupee",accountsPayable:"",openingBalance:0,paymentTerms:"Due on Receipt",location:{address:"",mapUrl:"",latitude:0,longitude:0}}),b=X(),[h,f]=c.useState([]),[m,T]=c.useState({});c.useEffect(()=>{const s=l=>{l.key==="Escape"&&p(!1)};return I&&document.addEventListener("keydown",s),()=>{document.removeEventListener("keydown",s)}},[I]),c.useEffect(()=>{var s,l,o,x,z,O;a&&(u({organizationId:a.organizationId||w,projectId:a.projectId||null,clientId:a.clientId||null,firstName:a.firstName||"",companyName:a.companyName||"",email:a.email||"",phone:{work:((s=a.phone)==null?void 0:s.work)||"",mobile:((l=a.phone)==null?void 0:l.mobile)||""},vendorLanguage:a.vendorLanguage||"English",pan:a.pan||"",currency:a.currency||"INR - Indian Rupee",accountsPayable:a.accountsPayable||"",openingBalance:a.openingBalance||0,paymentTerms:a.paymentTerms||"Due on Receipt",location:{address:((o=a.location)==null?void 0:o.address)||"",mapUrl:((x=a.location)==null?void 0:x.mapUrl)||"",latitude:((z=a.location)==null?void 0:z.latitude)??0,longitude:((O=a.location)==null?void 0:O.longitude)??0}}),a.mainImage&&g(a.mainImage.url))},[a,w]),c.useEffect(()=>()=>{d&&!d.startsWith("http")&&URL.revokeObjectURL(d)},[d]);const t=n==="view",i=s=>{const{name:l,value:o}=s.target;u(x=>({...x,[l]:o}))},F=(s,l)=>{u(o=>({...o,phone:{...o.phone,[s]:l}}))},V=s=>{u(l=>({...l,location:{...l.location,mapUrl:s}}))},$=s=>{s.target.files&&f(Array.from(s.target.files))},W=s=>{f(l=>l.filter((o,x)=>x!==s))},_=async s=>{if(s.target.files&&s.target.files[0]){const l=s.target.files[0];if(n==="create")C(l),g(URL.createObjectURL(l));else if(a!=null&&a._id)try{g(URL.createObjectURL(l)),await b.mutateAsync({vendorId:a._id,file:l}),D({title:"Successfull",description:"vendor Image updated successfully"})}catch(o){console.error("Failed to update image",o)}}},G=()=>k("update"),L=()=>{n==="create"?E(-1):(k("view"),f([]),C(void 0),g((a==null?void 0:a.mainImage)||null))},q=()=>{var l,o;const s={};if((l=r.firstName)!=null&&l.trim()||(s.firstName="First name / Shop Name is required"),r.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r.email)&&(s.email="Invalid email format"),r.phone.mobile){const x=r.phone.mobile.replace(/[\s-()]/g,"");/^[0-9]{10}$/.test(x)||(s["phone.mobile"]="Must be 10 digits")}return(o=r.location)!=null&&o.mapUrl&&(/^https?:\/\/(www\.)?(google\.[a-z.]+\/maps|maps\.google\.[a-z.]+|maps\.app\.goo\.gl|goo\.gl\/maps)/.test(r.location.mapUrl)||(s["location.mapUrl"]="Invalid Google Maps link")),T(s),Object.keys(s).length===0},H=async()=>{if(q())try{n==="create"?await U(r,h,P):(await U(r,h,P),k("view"),f([]),C(void 0))}catch(s){console.error(s)}},j=((R=a==null?void 0:a.documents)==null?void 0:R.filter(s=>s.type==="image"))||[],y=((M=a==null?void 0:a.documents)==null?void 0:M.filter(s=>s.type==="pdf"))||[];return e.jsxs("div",{className:"max-w-full overflow-y-auto mx-auto h-full flex flex-col pb-10",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>E(-1),className:"bg-white hover:bg-gray-100 w-8 h-8 flex items-center justify-center border border-gray-300 rounded-md transition-colors",children:e.jsx("i",{className:"fas fa-arrow-left text-gray-600"})}),e.jsx("div",{children:e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:`fas ${n==="create"?"fa-plus-circle":"fa-store"} mr-3 text-blue-600`}),n==="create"?"Create Vendor":n==="update"?"Update Vendor":"Vendor Details"]})})]}),e.jsxs("div",{className:"flex gap-2",children:[n==="view"&&e.jsxs(N,{onClick:G,className:"bg-blue-600 text-white shadow-sm",children:[e.jsx("i",{className:"fas fa-edit mr-2"})," Edit Details"]}),n==="update"&&e.jsx(N,{onClick:L,variant:"outline",className:"bg-white",children:"Cancel Edit"})]})]}),e.jsx("div",{className:"flex justify-center mb-8",children:e.jsxs("div",{className:"relative group",children:[e.jsxs("div",{className:`w-36 h-36 rounded-full overflow-hidden border-4 border-white shadow-lg bg-gray-100 flex items-center justify-center relative 
            ${d?"cursor-pointer hover:opacity-90":""}`,onClick:()=>{d&&p(!0)},children:[b.isPending&&e.jsx("div",{className:"absolute inset-0 bg-black/30 z-10 flex items-center justify-center",children:e.jsx("i",{className:"fas fa-spinner fa-spin text-white text-2xl"})}),d?e.jsx("img",{src:d,alt:"Shop Main",className:"w-full h-full object-cover",title:"Click to view full image"}):e.jsx("i",{className:"fas fa-store text-4xl text-gray-300"})]}),e.jsxs("label",{htmlFor:"mainImageUpload",className:"absolute bottom-1 right-1 bg-blue-600 hover:bg-blue-700 text-white p-2.5 rounded-full cursor-pointer shadow-md transition-transform hover:scale-105 z-20",title:"Update Shop Image",onClick:s=>s.stopPropagation(),children:[e.jsx("i",{className:`fas ${b.isPending?"fa-hourglass-half":"fa-pen"} text-sm`}),e.jsx("input",{id:"mainImageUpload",type:"file",accept:"image/*",className:"hidden",disabled:b.isPending,onChange:_})]})]})}),I&&d&&e.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/90 backdrop-blur-sm p-4",onClick:()=>p(!1),children:e.jsxs("div",{className:"relative max-w-4xl max-h-[90vh] w-full flex justify-center",children:[e.jsx("button",{onClick:()=>p(!1),className:"absolute -top-12 right-0 text-white hover:text-gray-300 text-3xl transition-colors",children:e.jsx("i",{className:"fas fa-times"})}),e.jsx("img",{src:d,alt:"Shop Full View",className:"max-w-full max-h-[85vh] object-contain rounded-lg shadow-2xl border border-gray-700",onClick:s=>s.stopPropagation()})]})}),e.jsx(Q,{className:"p-6",children:e.jsxs("div",{className:"space-y-8",children:[e.jsxs("section",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 pb-2 border-b border-gray-100 flex items-center",children:[e.jsx("i",{className:"fas fa-info-circle mr-2 text-blue-500"})," Basic Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Vendor Name / First Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{name:"firstName",value:r.firstName,onChange:i,disabled:t,placeholder:"Enter Name",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 disabled:bg-gray-50"}),m.firstName&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:m.firstName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Company Name"}),e.jsx("input",{name:"companyName",value:r.companyName,onChange:i,disabled:t,placeholder:"Enter Company Name",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 disabled:bg-gray-50"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address"}),e.jsx("input",{type:"email",name:"email",value:r.email,onChange:i,disabled:t,placeholder:"email@example.com",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 disabled:bg-gray-50"}),m.email&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:m.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Mobile Number"}),e.jsx("input",{value:r.phone.mobile,onChange:s=>F("mobile",s.target.value),disabled:t,maxLength:10,placeholder:"10 digit mobile",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 disabled:bg-gray-50"}),m["phone.mobile"]&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:m["phone.mobile"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Work Phone"}),e.jsx("input",{value:r.phone.work,onChange:s=>F("work",s.target.value),disabled:t,maxLength:10,placeholder:"Work/Landline",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 disabled:bg-gray-50"})]})]})]}),e.jsxs("section",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 pb-2 border-b border-gray-100 flex items-center",children:[e.jsx("i",{className:"fas fa-coins mr-2 text-blue-500"})," Financial & Location"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"PAN Number"}),e.jsx("input",{name:"pan",value:r.pan,onChange:i,disabled:t,placeholder:"ABCDE1234F",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 disabled:bg-gray-50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Opening Balance"}),e.jsx("input",{type:"number",name:"openingBalance",value:r.openingBalance,onChange:i,disabled:t,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 disabled:bg-gray-50"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Language"}),e.jsx("select",{name:"vendorLanguage",value:r.vendorLanguage,onChange:i,disabled:t,className:"w-full px-3 py-2 border border-gray-300 rounded-lg disabled:bg-gray-50",children:["English","Hindi","Tamil","Telugu","Malayalam","Kannada"].map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Currency"}),e.jsx("select",{name:"currency",value:r.currency,onChange:i,disabled:t,className:"w-full px-3 py-2 border border-gray-300 rounded-lg disabled:bg-gray-50",children:["INR - Indian Rupee","USD - US Dollar","EUR - Euro"].map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Terms"}),e.jsx("select",{name:"paymentTerms",value:r.paymentTerms,onChange:i,disabled:t,className:"w-full px-3 py-2 border border-gray-300 rounded-lg disabled:bg-gray-50",children:["Due on Receipt","Net 15","Net 30","Net 45"].map(s=>e.jsx("option",{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Accounts Payable"}),e.jsx("input",{name:"accountsPayable",value:r.accountsPayable,onChange:i,disabled:t,className:"w-full px-3 py-2 border border-gray-300 rounded-lg disabled:bg-gray-50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Map Location (Link)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{value:((S=r.location)==null?void 0:S.mapUrl)||"",onChange:s=>V(s.target.value),disabled:t,placeholder:"https://maps.app.goo.gl/...",className:`w-full px-3 py-2 pl-9 border rounded-lg outline-none disabled:bg-gray-50 ${m["location.mapUrl"]?"border-red-500":"border-gray-300"}`}),e.jsx("i",{className:"fas fa-map-pin absolute left-3 top-3 text-gray-400"}),((B=r.location)==null?void 0:B.mapUrl)&&e.jsx("a",{href:r.location.mapUrl,target:"_blank",rel:"noreferrer",className:"absolute right-2 top-2 text-blue-600 text-xs bg-blue-50 px-2 py-1 rounded border border-blue-100",children:"Open"})]}),m["location.mapUrl"]&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:m["location.mapUrl"]})]})]})]}),(j.length>0||y.length>0)&&e.jsxs("section",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 pb-2 border-b border-gray-100 flex items-center",children:[e.jsx("i",{className:"fas fa-folder-open mr-2 text-blue-500"})," Documents"]}),j.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("i",{className:"fas fa-images text-purple-600"}),e.jsx("h4",{className:"font-semibold text-gray-800 text-sm",children:"Images"}),e.jsx("span",{className:"text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded-full",children:j.length})]}),e.jsx(Y,{imageFiles:j,height:150,minWidth:150,maxWidth:200})]}),y.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("i",{className:"fas fa-file-pdf text-red-600"}),e.jsx("h4",{className:"font-semibold text-gray-800 text-sm",children:"PDF Documents"}),e.jsx("span",{className:"text-xs bg-red-100 text-red-700 px-2 py-1 rounded-full",children:y.length})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:y.map((s,l)=>e.jsxs("div",{className:"flex items-center gap-4 bg-gradient-to-r from-red-50 to-orange-50 p-4 rounded-lg border border-red-200 hover:shadow-md transition-all group",children:[e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center text-red-600 text-xl",children:e.jsx("i",{className:"fas fa-file-pdf"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900 truncate",children:s.originalName||`Document ${l+1}.pdf`}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[e.jsx("i",{className:"far fa-calendar mr-1"}),Z(s.uploadedAt)]})]}),e.jsx("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"px-3 py-2 bg-white text-red-600 rounded-lg hover:bg-red-600 hover:text-white transition-colors font-medium text-sm shadow-sm group-hover:shadow-md",children:"Open"})]},l))})]})]}),!t&&e.jsxs("section",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 pb-2 border-b border-gray-100 flex items-center",children:[e.jsx("i",{className:"fas fa-cloud-upload-alt mr-2 text-blue-500"}),n==="create"?"Upload Documents":"Add New Documents"]}),e.jsxs("div",{className:"relative w-full h-32 border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-500 transition-colors bg-gray-50 flex flex-col items-center justify-center",children:[e.jsx("input",{type:"file",multiple:!0,accept:"image/*,.pdf",onChange:$,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer z-20"}),e.jsx("i",{className:"fas fa-cloud-upload-alt text-3xl text-gray-400 mb-2"}),e.jsx("p",{className:"text-sm text-gray-600 font-medium",children:"Click to upload files"}),e.jsx("p",{className:"text-xs text-gray-500",children:"PDF, PNG, JPG"})]}),h.length>0&&e.jsx("div",{className:"mt-4 space-y-2",children:h.map((s,l)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-white border border-gray-200 rounded shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("i",{className:`fas ${s.type.includes("pdf")?"fa-file-pdf text-red-500":"fa-file-image text-blue-500"}`}),e.jsx("span",{className:"text-sm text-gray-700",children:s.name}),e.jsxs("span",{className:"text-xs text-gray-400",children:["(",(s.size/1024/1024).toFixed(2)," MB)"]})]}),e.jsx("button",{type:"button",onClick:()=>W(l),className:"text-red-500 hover:text-red-700 px-2",children:e.jsx("i",{className:"fas fa-times"})})]},l))})]}),!t&&e.jsxs("div",{className:"pt-6 mt-6 border-t border-gray-200 flex justify-end gap-4",children:[e.jsx(N,{type:"button",variant:"outline",onClick:L,disabled:v,children:"Cancel"}),e.jsx(N,{type:"button",onClick:H,disabled:v,className:"bg-blue-600 text-white min-w-[120px]",children:v?e.jsx("i",{className:"fas fa-spinner fa-spin"}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-save mr-2"})," Save Details"]})})]})]})})]})};export{ne as V};
