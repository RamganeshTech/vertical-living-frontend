import{q as P,b as C,d as R,j as e,r as b}from"./index-DkfQDeIt.js";import{u as $}from"./useQuery-mUmMtORz.js";import{u as E}from"./useMutation-BWlLDX_I.js";import{u as w,g as v}from"./roleCheck-DNL7PxQZ.js";import{t as g}from"./toast-BSC5QTk1.js";import{B as q}from"./Button-C-chqFKc.js";const A=async({api:t,id:a,section:r,notes:s})=>{const{data:i}=await t.patch(`/prerequireties/update/${a}/notes/${r}`,{notes:s});if(i.ok)return i;throw new Error(i.message||"Failed to update notes")},S=async({api:t,id:a,section:r,isRequired:s})=>{const{data:i}=await t.patch(`/prerequireties/update/${a}/boolean/${r}`,{isRequired:s});if(i.ok)return i;throw new Error(i.message||"Failed to update boolean")},W=async({api:t,projectId:a})=>{const{data:r}=await t.get(`/prerequireties/getalldetails/${a}`);if(r.ok)return r;throw new Error(r.message||"Failed to get all PreRequireties")},F=()=>{const{role:t}=w(),a=v(t),r=["owner","staff","CTO"];return E({mutationFn:async({id:s,section:i,notes:c})=>{if(!t)throw new Error("Not Authorized");if(!r.includes(t))throw new Error("Not allowed");if(!a)throw new Error("API not found");return await A({api:a,id:s,section:i,notes:c})},onSuccess:()=>{P.invalidateQueries({queryKey:["preRequireties"]})}})},_=()=>{const{role:t}=w(),a=v(t),r=["owner","staff","CTO"];return E({mutationFn:async({id:s,section:i,isRequired:c})=>{if(!t)throw new Error("Not Authorized");if(!r.includes(t))throw new Error("Not allowed");if(!a)throw new Error("API not found");return await S({api:a,id:s,section:i,isRequired:c})},onSuccess:()=>{P.invalidateQueries({queryKey:["preRequireties"]})}})},B=t=>{const{role:a}=w(),r=v(a),s=["owner","staff","CTO"];return $({queryKey:["preRequireties",t],queryFn:async()=>{if(!a)throw new Error("Not Authorized");if(!s.includes(a))throw new Error("Not allowed");if(!r)throw new Error("API not found");return await W({api:r,projectId:t})},retry:!1,refetchOnMount:!1})},M=({title:t,section:a,isRequired:r,notes:s,formId:i,onUpdate:c})=>{const[u,y]=b.useState(!1),[x,m]=b.useState(s),[p,h]=b.useState(!1),d=_(),N=F(),f=async o=>{try{await d.mutateAsync({id:i,section:a,isRequired:o}),g({title:"Success",description:`${t} requirement updated successfully`}),c()}catch(k){g({title:"Error",description:k instanceof Error?k.message:"Failed to update requirement",variant:"destructive"})}},n=async()=>{if(x!==s){h(!0);try{await N.mutateAsync({id:i,section:a,notes:x}),g({title:"Success",description:`${t} notes updated successfully`}),c()}catch(o){g({title:"Error",description:o instanceof Error?o.message:"Failed to update notes",variant:"destructive"}),m(s)}finally{h(!1)}}},l=()=>{n()},j=o=>{o.key==="Enter"&&o.ctrlKey&&n()};return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg shadow-sm mb-4",children:[e.jsx("div",{className:"p-4 cursor-pointer hover:bg-gray-50 transition-colors border-b border-gray-100",onClick:()=>y(!u),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("i",{className:`fas ${u?"fa-chevron-down":"fa-chevron-right"} text-gray-400`}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:t}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Status:"}),r?e.jsxs("span",{className:"flex items-center text-green-600 text-sm",children:[e.jsx("i",{className:"fas fa-check-circle mr-1"}),"Required"]}):e.jsxs("span",{className:"flex items-center text-gray-500 text-sm",children:[e.jsx("i",{className:"fas fa-exclamation-circle mr-1"}),"Not Required"]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r,onChange:o=>{o.stopPropagation(),f(o.target.checked)},disabled:d.isPending,className:"sr-only"}),e.jsx("div",{className:`w-11 h-6 rounded-full transition-colors ${r?"bg-blue-600":"bg-gray-200"} ${d.isPending?"opacity-50":""}`,children:e.jsx("div",{className:`w-5 h-5 bg-white rounded-full shadow transform transition-transform ${r?"translate-x-5":"translate-x-0"} mt-0.5 ml-0.5`})})]}),d.isPending&&e.jsx("i",{className:"fas fa-spinner fa-spin text-gray-400"})]})]})}),u&&e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r,onChange:o=>f(o.target.checked),disabled:d.isPending,className:"sr-only"}),e.jsx("div",{className:`w-11 h-6 rounded-full transition-colors ${r?"bg-blue-600":"bg-gray-200"} ${d.isPending?"opacity-50":""}`,children:e.jsx("div",{className:`w-5 h-5 bg-white rounded-full shadow transform transition-transform ${r?"translate-x-5":"translate-x-0"} mt-0.5 ml-0.5`})})]}),e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"This work is required for the project"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Notes & Additional Details"}),e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{placeholder:`Add notes about ${t.toLowerCase()}...`,value:x,onChange:o=>m(o.target.value),onBlur:l,onKeyDown:j,className:"w-full min-h-[100px] p-3 border border-gray-300 rounded-md resize-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none",disabled:p}),p&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("i",{className:"fas fa-spinner fa-spin text-gray-400"})})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Press Ctrl+Enter to save or click outside the text area"})]})]})})]})},Q=()=>{var p,h,d,N,f;const{projectId:t}=C(),{isMobile:a,openMobileSidebar:r}=R(),{data:s,isLoading:i,error:c,refetch:u}=B(t),y=[{key:"modularWork",title:"Modular Work",description:"Prefabricated components and modular construction",_id:(p=s==null?void 0:s.data)==null?void 0:p._id},{key:"electricalWork",title:"Electrical Work",description:"Wiring, fixtures, and electrical installations",_id:(h=s==null?void 0:s.data)==null?void 0:h._id},{key:"plumbingWork",title:"Plumbing Work",dzescription:"Water supply, drainage, and plumbing fixtures",_id:(d=s==null?void 0:s.data)==null?void 0:d._id},{key:"civilWork",title:"Civil Work",description:"Structural work, foundations, and civil engineering",_id:(N=s==null?void 0:s.data)==null?void 0:N._id},{key:"decorationWork",title:"Decoration Work",description:"Interior design, painting, and finishing touches",_id:(f=s==null?void 0:s.data)==null?void 0:f._id}],x=()=>{u()};if(i)return e.jsx("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("i",{className:"fas fa-spinner fa-spin text-4xl text-blue-600"}),e.jsx("p",{className:"text-gray-600",children:"Loading project prerequisites..."})]})});if(c)return e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-exclamation-circle text-red-600 mr-2"}),e.jsx("p",{className:"text-red-800",children:c instanceof Error?c.message:"Failed to load prerequisites"})]})}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx("button",{onClick:()=>u(),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors",children:"Try Again"})})]});if(!(s!=null&&s.data))return e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-exclamation-circle text-yellow-600 mr-2"}),e.jsx("p",{className:"text-yellow-800",children:"No prerequisites data found for this project. Please ensure the project exists and try again."})]})}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx("button",{onClick:()=>u(),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors",children:"Refresh"})})]});const m=s.data;return e.jsx(e.Fragment,{children:e.jsx("div",{className:"max-h-full overflow-y-auto mx-auto px-4 py-4 custom-scrollbar",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center hidden sm:block space-y-2",children:[e.jsx("h1",{className:"text-3xl font-bold text-blue-700",children:"Project Prerequisites"}),e.jsx("p",{className:"text-gray-600 max-w-2xl mx-auto",children:"Configure the required work types for your project. These prerequisites must be completed before proceeding to the 14-step process."})]}),e.jsx("header",{className:"block sm:hidden space-y-2",children:e.jsxs("h1",{className:"text-2xl font-bold text-gray-900",children:[a&&e.jsx("button",{onClick:r,className:"mr-3 p-2 rounded-md border border-gray-300 hover:bg-gray-100",title:"Open Menu",children:e.jsx("i",{className:"fa-solid fa-bars"})}),"Project Prerequisites"]})}),e.jsx("div",{className:"space-y-4",children:y.map(n=>{const l=m[n.key];return e.jsx(M,{title:n.title,section:n.key,isRequired:(l==null?void 0:l.isRequired)||!1,notes:(l==null?void 0:l.notes)||"",formId:n._id,onUpdate:x},n.key)})}),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Prerequisites Summary"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4",children:y.map(n=>{const l=m[n.key],j=(l==null?void 0:l.isRequired)||!1;return e.jsxs("div",{className:"flex items-center space-x-2",children:[j?e.jsx("i",{className:"fas fa-check-circle text-green-600"}):e.jsx("i",{className:"fas fa-exclamation-circle text-gray-400"}),e.jsx("span",{className:`text-sm ${j?"text-green-600 font-medium":"text-gray-500"}`,children:n.title})]},n.key)})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[e.jsx(q,{variant:"ghost",onClick:()=>u(),className:"px-6 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors",children:"Refresh Data"}),e.jsx(q,{onClick:()=>{g({title:"Success",description:"Prerequisites configured successfully. You can now proceed to the 14-step process."})},className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Continue to Next Steps"})]})]})})})};export{Q as default};
