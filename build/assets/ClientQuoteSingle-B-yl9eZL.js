import{b as _,c as F,d as G,r as n,R as O,j as e,B as S,M as V,t as l}from"./index-DyM6T-eT.js";import{C as $}from"./ClientFurnitures-p8E-JN8-.js";import{b as z,c as D}from"./clientQuoteApi-TmeWipbR.js";import{L as U}from"./Label-B3hr6461.js";import{S as H,a as J,b as K,c as W,d as X}from"./Select-CKRO57ug.js";import{u as Y}from"./quoteVariantApi-m51q8T1h.js";import{d as Z}from"./downloadFile-CQDFTv8V.js";const ie=0,le=()=>{var N,v,w;const{organizationId:g,quoteId:d}=_(),T=F(),{role:p,permission:c}=G(),h=p==="owner"||((N=c==null?void 0:c.clientquote)==null?void 0:N.create),j=p==="owner"||((v=c==null?void 0:c.clientquote)==null?void 0:v.edit),{data:s,isLoading:C}=z(g,d),{mutateAsync:P,isPending:y}=D(),{mutateAsync:k,isPending:A}=Y(),i=n.useRef([]),[b,f]=n.useState(null),[m,E]=n.useState(!0),[x,I]=n.useState("type 1"),[u,B]=n.useState([]),[o,M]=n.useState((s==null?void 0:s.grandTotal)||0);n.useEffect(()=>{M(s==null?void 0:s.grandTotal)},[s]);const L=async()=>{var a,t;try{if(!g||!d||!s){l({title:"Missing info",description:"Please ensure quote and all details are not missing",variant:"destructive"});return}if(!confirm("Are you sure want to send this quotation to payment?"))return;await P({organizationId:g,id:d}),l({title:"success",description:"Quote Selected and stored in the payment stage"})}catch(r){l({title:"Error",description:((t=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:t.message)??"Operation failed"})}},R=async()=>{var a,t;try{if(!s.projectId._id||!d||!x){l({title:"Missing info",description:"Please ensure brand and all details are selected",variant:"destructive"});return}const r=await k({quoteId:d,type:x,projectId:s.projectId._id});await Z({src:r.url,alt:r.fileName}),l({title:"success",description:"pdf generated successfully"})}catch(r){l({title:"Error",description:((t=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:t.message)||"Operation failed",variant:"destructive"})}},Q=async()=>{var a,t;try{E(r=>!r)}catch(r){l({title:"Error",description:((t=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:t.message)??"Operation failed"})}};return n.useEffect(()=>{if(!(s!=null&&s.furnitures))return;const a=s.furnitures.map(t=>({furnitureName:t.furnitureName,coreMaterials:t.coreMaterials||[],fittingsAndAccessories:t.fittingsAndAccessories||[],glues:t.glues||[],nonBrandMaterials:t.nonBrandMaterials||[],totals:{core:t.coreMaterialsTotal||0,fittings:t.fittingsAndAccessoriesTotal||0,glues:t.gluesTotal||0,nbms:t.nonBrandMaterialsTotal||0,furnitureTotal:t.furnitureTotal||0},plywoodBrand:"",laminateBrand:""}));B(a)},[s]),i.current.length!==u.length&&(i.current=u.map((a,t)=>i.current[t]??O.createRef())),n.useEffect(()=>{console.log("furnitureRefs Array",i),i.current=u.map((a,t)=>i.current[t]??n.createRef())},[u]),e.jsxs("div",{className:"p-2 max-h-full overflow-y-auto",children:[e.jsx("header",{className:"bg-white border-b border-gray-200 pb-4 space-y-3",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("button",{onClick:()=>T(-1),className:"flex cursor-pointer items-center justify-center w-8 h-8 bg-gray-50 hover:bg-gray-100 border border-gray-300 rounded-md transition-colors flex-shrink-0",children:e.jsx("i",{className:"fas fa-arrow-left text-gray-600 text-sm"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900 truncate",children:((w=s==null?void 0:s.projectId)==null?void 0:w.projectName)||"Project"}),e.jsx("p",{className:"text-md text-gray-500",children:s!=null&&s.quoteNo?`Quote: #${s==null?void 0:s.quoteNo}`:""})]})]}),e.jsxs("div",{className:"flex gap-2 justify-between  items-center",children:[e.jsxs("div",{className:"px-4 text-center",children:[e.jsx("p",{className:"text-md text-gray-600",children:"Total Cost"}),e.jsxs("p",{className:"text-md font-bold text-green-600",children:["₹",o==null?void 0:o.toLocaleString("en-in")]})]}),(h||j)&&e.jsx(S,{onClick:L,disabled:y,className:"flex-shrink-0 px-4 ",children:y?"Sending...":"Send to Payment"}),(h||j)&&e.jsx(S,{onClick:R,isLoading:A,className:"flex-shrink-0 px-4 ",children:"Generate Pdf"}),e.jsxs("div",{className:"flex gap-2 w-fit px-4 justify-center",children:[e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:m,onChange:Q,className:"sr-only",id:"blurinput"}),e.jsx("div",{className:`w-11 h-6 rounded-full cursor-pointer transition-colors ${m?"bg-gray-200":"bg-blue-600"}`,children:e.jsx("div",{className:`w-5 h-5 bg-white rounded-full shadow transform transition-transform ${m?"translate-x-0":"translate-x-5"} mt-0.5 ml-0.5`})})]}),e.jsx(U,{htmlFor:"blurinput",className:" cursor-pointer flex flex-4/2",children:"Show Stats"})]}),e.jsx("div",{className:"w-full",children:e.jsxs(H,{onValueChange:a=>{I(a)},children:[e.jsx(J,{className:"w-full",children:e.jsx(K,{placeholder:"Select Template Type",selectedValue:x})}),e.jsx(W,{children:["type 1","type 2","type 3"].map(a=>e.jsx(X,{value:a.toString(),children:a},a))})]})})]})]})}),C?e.jsx(V,{}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-6",children:[u.map((a,t)=>e.jsx($,{index:t,data:a,ref:i.current[t],templateType:x,isBlurred:m,onImageClick:f},t)),e.jsx("div",{className:"mt-10 text-right",children:e.jsxs("div",{className:"inline-block bg-green-50 border border-green-200 rounded-md px-6 py-4",children:[e.jsx("p",{className:"text-md font-medium text-gray-700 mb-1",children:"Total Estimate"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700",children:["₹",o==null?void 0:o.toLocaleString("en-in")]})]})})]})}),b&&e.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/80 p-4 animate-in fade-in duration-200",onClick:()=>f(null),children:e.jsxs("div",{className:"relative max-w-4xl max-h-[90vh]",children:[e.jsx("button",{className:"absolute -top-10 right-0 text-white text-3xl hover:text-gray-300 transition-colors",onClick:()=>f(null),children:e.jsx("i",{className:"fas fa-times"})}),e.jsx("img",{src:b,className:"rounded-lg shadow-2xl max-w-full max-h-[85vh] object-contain border-4 border-white/10",alt:"Enlarged view",onClick:a=>a.stopPropagation()})]})})]})};export{ie as DEFAULT_LAMINATE_RATE_PER_SQFT,le as default};
