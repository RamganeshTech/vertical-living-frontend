import{u as Z,b as q,r as S,j as e}from"./index-C2KHEypQ.js";import{u as Q,a as ee,D as te,P as se,b as le,C as ae}from"./core.esm-D8jwI6VD.js";import{f as re,g as oe,h as ie,u as ne}from"./billNewAccountingApi-CBXtLHri.js";import{B as U}from"./Button-Cz-akwNZ.js";import{u as de}from"./projectApi-BtQy_PTR.js";import"./index-D5MZ_Dqb.js";import"./useQuery-BmC89CNR.js";import"./useMutation-DaAue-fW.js";import"./useInfiniteQuery-Ce_ii5sB.js";import"./roleCheck-DBD7VNWv.js";function ce(t){const[n,p]=S.useState([t]),[x,o]=S.useState(0),m=n[x],k=w=>{const R=typeof w=="function"?w(m):w;if(JSON.stringify(m)===JSON.stringify(R))return;const M=n.slice(0,x+1);M.push(R),p(M),o(M.length-1)},g=S.useCallback(()=>o(w=>Math.max(w-1,0)),[]),c=S.useCallback(()=>o(w=>Math.min(w+1,n.length-1)),[n]),z=w=>{p([w]),o(0)};return{state:m,setState:k,undo:g,redo:c,canUndo:x>0,canRedo:x<n.length-1,reset:z}}const V=()=>`blk_${Math.random().toString(36).substr(2,9)}`,X={fontSize:12,color:"#000000",backgroundColor:"transparent",fontWeight:"normal",textAlign:"left",width:200,height:"auto"},ue=({onSelect:t})=>{const[n,p]=S.useState({rows:0,cols:0});return e.jsxs("div",{className:"absolute top-12 left-0 z-50 bg-white shadow-xl border border-gray-300 p-3 rounded w-48",children:[e.jsxs("div",{className:"text-xs font-bold mb-2 text-gray-500",children:["Table ",n.cols,"x",n.rows]}),e.jsx("div",{className:"grid grid-cols-10 gap-1",onMouseLeave:()=>p({rows:0,cols:0}),children:Array.from({length:50}).map((x,o)=>{const m=Math.floor(o/10)+1,k=o%10+1,g=m<=n.rows&&k<=n.cols;return e.jsx("div",{className:`w-3 h-3 border ${g?"bg-blue-500 border-blue-600":"bg-gray-100 border-gray-300"}`,onMouseEnter:()=>p({rows:m,cols:k}),onClick:()=>t(m,k)},o)})})]})},xe=({x:t,y:n,actions:p,onClose:x})=>(S.useEffect(()=>{const o=()=>x();return document.addEventListener("click",o),()=>document.removeEventListener("click",o)},[x]),e.jsx("div",{className:"fixed z-[9999] bg-white shadow-xl border border-gray-200 rounded py-1 min-w-[180px]",style:{top:n,left:t},children:p.map((o,m)=>e.jsx("button",{onClick:o.action,className:`w-full text-left px-4 py-2 text-sm hover:bg-gray-100 block ${o.color||"text-gray-700"}`,children:o.label},m))})),he=({organizationId:t,onSelect:n,onClose:p})=>{const{data:x}=ne({organizationId:t,limit:20}),o=(x==null?void 0:x.pages.flatMap(m=>m.data))||[];return e.jsxs("div",{className:"w-full bg-gray-50 border-b border-gray-200 p-4 animate-in slide-in-from-top-10 duration-300 shadow-inner",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h3",{className:"text-sm font-bold text-gray-700 uppercase",children:"Select a Template"}),e.jsx("button",{onClick:p,children:e.jsx("i",{className:"fas fa-times text-gray-400 hover:text-gray-600"})})]}),e.jsx("div",{className:"flex gap-4 overflow-x-auto pb-2",children:o.map(m=>e.jsxs("div",{onClick:()=>n(m),className:"min-w-[160px] bg-white border rounded cursor-pointer hover:ring-2 ring-blue-500 transition-all",children:[e.jsx("div",{className:"h-24 bg-gray-100 flex items-center justify-center border-b text-gray-300",children:e.jsx("i",{className:"fas fa-file-invoice text-3xl"})}),e.jsx("div",{className:"p-2",children:e.jsx("p",{className:"text-xs font-bold truncate",children:m.templateName})})]},m._id))})]})},ge=({component:t,isSelected:n,onClick:p,onUpdateValue:x,onUpdateMeta:o,onResize:m,onDelete:k,activeCell:g,onCellSelect:c})=>{var Y,O,J;const{attributes:z,listeners:w,setNodeRef:R,transform:M,isDragging:A}=le({id:t.id,data:{...t}}),[h,j]=S.useState(null),L={transform:ae.Translate.toString(M),position:"absolute",left:`${t.x}px`,top:`${t.y}px`,width:t.style.width?`${t.style.width}px`:"auto",height:t.style.height?`${t.style.height}px`:"auto",zIndex:A?9999:n?100:1,fontSize:`${t.style.fontSize}px`,color:t.style.color,fontWeight:t.style.fontWeight,textAlign:t.style.textAlign,backgroundColor:t.style.backgroundColor},W=l=>{l.stopPropagation(),l.preventDefault();const r=l.clientX,d=l.clientY,f=t.style.width||100,N=t.style.height||100,y=D=>m(Math.max(50,f+(D.clientX-r)),Math.max(20,N+(D.clientY-d))),v=()=>{document.removeEventListener("mousemove",y),document.removeEventListener("mouseup",v)};document.addEventListener("mousemove",y),document.addEventListener("mouseup",v)},_=(l,r)=>{l.stopPropagation();const d=l.clientX,f=t.columnWidths||[],N=t.style.width||300,y=D=>{const E=(D.clientX-d)/N*100,C=[...f];C[r+1]!==void 0&&(C[r]=Math.max(5,C[r]+E),C[r+1]=Math.max(5,C[r+1]-E),o("columnWidths",C))},v=()=>{document.removeEventListener("mousemove",y),document.removeEventListener("mouseup",v)};document.addEventListener("mousemove",y),document.addEventListener("mouseup",v)},T=(l,r)=>{l.stopPropagation();const d=l.clientY,f=t.rowHeights||[],N=v=>{const D=[...f];D[r]=Math.max(20,(D[r]||30)+(v.clientY-d)),o("rowHeights",D)},y=()=>{document.removeEventListener("mousemove",N),document.removeEventListener("mouseup",y)};document.addEventListener("mousemove",N),document.addEventListener("mouseup",y)},H=(l,r=-1,d=-1)=>{t.type==="table"&&(l.preventDefault(),l.stopPropagation(),j({x:l.clientX,y:l.clientY,targetR:r,targetC:d}))},G=()=>{const l=h.targetR===-1?t.value.length:h.targetR+1,r=JSON.parse(JSON.stringify(t.value));r.splice(l,0,Array.from({length:r[0].length},()=>({content:"",style:{}})));const d=[...t.rowHeights||[]];d.splice(l,0,30),x(r),o("rowHeights",d),j(null)},B=()=>{var N;const l=h.targetC===-1?((N=t.columnWidths)==null?void 0:N.length)||1:h.targetC+1,r=t.value.map(y=>{const v=[...y];return v.splice(l,0,{content:"",style:{}}),v});let d=[...t.columnWidths||[]];d.splice(l,0,15);const f=d.reduce((y,v)=>y+v,0);d=d.map(y=>y/f*100),x(r),o("columnWidths",d),j(null)},$=()=>{if(t.value.length<=1)return;const l=[...t.value];l.splice(h.targetR,1);const r=[...t.rowHeights];r.splice(h.targetR,1),x(l),o("rowHeights",r),j(null)},F=()=>{if(t.value[0].length<=1)return;const l=t.value.map(f=>f.filter((N,y)=>y!==h.targetC));let r=[...t.columnWidths];r.splice(h.targetC,1);const d=r.reduce((f,N)=>f+N,0);r=r.map(f=>f/d*100),x(l),o("columnWidths",r),j(null)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{ref:R,style:L,onContextMenu:l=>H(l),onClick:l=>{l.stopPropagation(),p()},className:`group ${n?"ring-2 ring-blue-500":"hover:ring-1 hover:ring-gray-300"}`,children:[e.jsx("div",{...w,...z,className:`absolute -top-3 -left-3 w-6 h-6 bg-white shadow rounded-full flex items-center justify-center cursor-move z-50 ${n?"flex":"hidden group-hover:flex"}`,children:e.jsx("i",{className:"fa-solid fa-arrows-up-down-left-right text-xs text-gray-600"})}),t.type==="text"&&e.jsx("textarea",{className:"w-full h-full p-1 bg-transparent border-transparent outline-none resize-none overflow-hidden",value:t.label,style:{fontSize:t.style.fontSize,fontWeight:t.style.fontWeight,textAlign:t.style.textAlign,color:t.style.color},onChange:l=>o("label",l.target.value),onPointerDown:l=>l.stopPropagation()}),t.type==="data-field"&&e.jsxs("div",{className:"flex items-center gap-2 px-2 py-1 border border-dashed border-gray-400 bg-gray-50 w-full h-full overflow-hidden",children:[e.jsxs("span",{className:"font-bold text-xs whitespace-nowrap",children:[t.label,":"]}),e.jsx("input",{className:"bg-transparent border-b border-gray-300 text-xs w-full outline-none",value:t.value,onChange:l=>x(l.target.value),onPointerDown:l=>l.stopPropagation()})]}),t.type==="image"&&e.jsx("div",{className:"w-full h-full bg-gray-100",children:Array.isArray(t.value)&&t.value.length>0?e.jsx("img",{src:typeof t.value[0]=="string"?t.value[0]:t.value[0].preview,className:"w-full h-full block pointer-events-none object-fill"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-xs text-gray-400 border border-dashed",children:"No Img"})}),t.type==="table"&&Array.isArray(t.value)&&e.jsxs("div",{className:"w-full h-full flex flex-col relative",children:[n&&e.jsx("div",{className:"flex w-full h-2 absolute -top-2 left-0 pointer-events-none z-20",children:(Y=t.columnWidths)==null?void 0:Y.map((l,r)=>e.jsx("div",{style:{width:`${l}%`},className:"relative border-r border-blue-400 h-2 pointer-events-auto",children:e.jsx("div",{onMouseDown:d=>_(d,r),className:"absolute right-[-4px] top-[-4px] w-3 h-3 cursor-col-resize bg-blue-500 rounded-sm z-50"})},r))}),n&&e.jsx("div",{className:"absolute -left-2 top-0 w-2 h-full flex flex-col pointer-events-none z-20",children:(O=t.rowHeights)==null?void 0:O.map((l,r)=>e.jsx("div",{style:{height:`${l}px`},className:"relative border-b border-blue-400 w-2 pointer-events-auto",children:e.jsx("div",{onMouseDown:d=>T(d,r),className:"absolute bottom-[-4px] left-[-4px] w-3 h-3 cursor-row-resize bg-blue-500 rounded-sm z-50"})},r))}),e.jsxs("table",{className:"w-full table-fixed",style:{borderCollapse:"collapse",border:"1px solid #9ca3af"},children:[e.jsx("colgroup",{children:(J=t.columnWidths)==null?void 0:J.map((l,r)=>e.jsx("col",{style:{width:`${l}%`}},r))}),e.jsx("tbody",{children:t.value.map((l,r)=>e.jsx("tr",{style:{height:`${t.rowHeights&&t.rowHeights[r]||30}px`},children:l.map((d,f)=>{var N,y,v,D,E;return e.jsx("td",{style:{border:"1px solid #9ca3af",padding:0,verticalAlign:"top",backgroundColor:((N=d.style)==null?void 0:N.backgroundColor)||"transparent"},className:`relative ${(g==null?void 0:g.r)===r&&(g==null?void 0:g.c)===f?"ring-2 ring-inset ring-blue-500 z-10":""}`,onContextMenu:C=>H(C,r,f),children:e.jsx("textarea",{className:"w-full h-full p-1 border-none outline-none bg-transparent resize-none overflow-hidden",style:{fontSize:`${((y=d.style)==null?void 0:y.fontSize)||t.style.fontSize}px`,color:((v=d.style)==null?void 0:v.color)||t.style.color,textAlign:((D=d.style)==null?void 0:D.textAlign)||t.style.textAlign,fontWeight:((E=d.style)==null?void 0:E.fontWeight)||t.style.fontWeight,fontFamily:"inherit",lineHeight:"1.2"},value:d.content,onChange:C=>{const s=JSON.parse(JSON.stringify(t.value));s[r][f].content=C.target.value,x(s)},onFocus:()=>c(r,f),onPointerDown:C=>C.stopPropagation()})},f)})},r))})]})]}),n&&e.jsx("div",{onMouseDown:W,onPointerDown:l=>l.stopPropagation(),className:"absolute -bottom-1 -right-1 w-4 h-4 bg-blue-500 cursor-nwse-resize rounded-full z-50 border-2 border-white shadow"})]}),h&&e.jsx(xe,{x:h.x,y:h.y,onClose:()=>j(null),actions:[{label:"Insert Row Below",action:G,color:"text-blue-600"},{label:"Insert Col Right",action:B,color:"text-blue-600"},{label:"Delete Row",action:$},{label:"Delete Col",action:F},{label:"Delete Table",action:k,color:"text-red-600"}]})]})},fe=({component:t,activeCell:n,onUpdate:p,onUpdateCell:x,onDelete:o,onClose:m})=>{const k=(c,z,w,R,M,A,h)=>e.jsxs("div",{className:"space-y-2 p-3 bg-gray-50 rounded border border-gray-200",children:[e.jsxs("h4",{className:"text-[10px] font-bold text-gray-500 uppercase",children:[h," Styling"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-[10px] text-gray-400",children:"Size"}),e.jsx("input",{type:"number",className:"w-full border p-1 text-xs rounded",value:c||12,onChange:j=>A("fontSize",Number(j.target.value))})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"text-[10px] text-gray-400",children:"Text"}),e.jsx("div",{className:"flex items-center border p-1 rounded bg-white h-7",children:e.jsx("input",{type:"color",className:"w-full h-full border-none p-0 bg-transparent cursor-pointer",value:z||"#000000",onChange:j=>A("color",j.target.value)})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"text-[10px] text-gray-400",children:"BG"}),e.jsx("div",{className:"flex items-center border p-1 rounded bg-white h-7",children:e.jsx("input",{type:"color",className:"w-full h-full border-none p-0 bg-transparent cursor-pointer",value:w||"#ffffff",onChange:j=>A("backgroundColor",j.target.value)})})]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>A("fontWeight",R==="bold"?"normal":"bold"),className:`flex-1 border p-1 text-xs ${R==="bold"?"bg-blue-100":"bg-white"}`,children:e.jsx("i",{className:"fa-solid fa-bold"})}),e.jsx("button",{onClick:()=>A("textAlign","left"),className:`flex-1 border p-1 text-xs ${M==="left"?"bg-blue-100":"bg-white"}`,children:e.jsx("i",{className:"fa-solid fa-align-left"})}),e.jsx("button",{onClick:()=>A("textAlign","center"),className:`flex-1 border p-1 text-xs ${M==="center"?"bg-blue-100":"bg-white"}`,children:e.jsx("i",{className:"fa-solid fa-align-center"})}),e.jsx("button",{onClick:()=>A("textAlign","right"),className:`flex-1 border p-1 text-xs ${M==="right"?"bg-blue-100":"bg-white"}`,children:e.jsx("i",{className:"fa-solid fa-align-right"})})]})]});let g={};return t.type==="table"&&n&&(g=t.value[n.r][n.c].style||{}),e.jsxs("div",{className:"w-72 bg-white border-l border-gray-200 flex flex-col h-full shadow-xl z-50 fixed right-0 top-16 bottom-0",onClick:c=>c.stopPropagation(),children:[e.jsxs("div",{className:"p-4 border-b flex justify-between items-center",children:[e.jsx("span",{className:"font-bold text-xs uppercase text-gray-600",children:"Properties"}),e.jsx("button",{onClick:m,children:e.jsx("i",{className:"fa-solid fa-xmark"})})]}),e.jsxs("div",{className:"p-4 space-y-6 overflow-y-auto flex-1",children:[t.type==="text"&&e.jsx("textarea",{className:"w-full border p-2 text-sm rounded",rows:3,value:t.label,onChange:c=>p("label",c.target.value)}),t.type==="data-field"&&e.jsxs(e.Fragment,{children:[e.jsx("input",{className:"w-full border p-2 text-sm rounded mb-2",value:t.label,onChange:c=>p("label",c.target.value)}),e.jsx("input",{className:"w-full border p-2 text-sm rounded",value:t.value,onChange:c=>p("value",c.target.value)})]}),t.type==="table"&&n&&k(g.fontSize||t.style.fontSize,g.color||t.style.color,g.backgroundColor||"transparent",g.fontWeight||t.style.fontWeight,g.textAlign||t.style.textAlign,(c,z)=>x(n.r,n.c,c,z),"Cell"),k(t.style.fontSize,t.style.color,t.style.backgroundColor,t.style.fontWeight,t.style.textAlign,(c,z)=>p(c,z,!0),"Global"),e.jsx("button",{onClick:o,className:"w-full mt-6 bg-red-50 text-red-600 py-2 rounded border border-red-200 text-sm",children:"Delete Block"})]})]})},ke=({mode:t})=>{const n=Z(),{id:p,organizationId:x}=q(),{data:o,isLoading:m}=re({id:p||""}),{data:k}=de(x),{state:g=[],setState:c,undo:z,redo:w,canUndo:R,canRedo:M,reset:A}=ce([]),[h,j]=S.useState({customerName:"",billNumber:"",projectId:"",projectName:"",pdfData:null}),[L,W]=S.useState(null),[_,T]=S.useState(null),[H,G]=S.useState(!1),[B,$]=S.useState(!1),[F,Y]=S.useState(null),O=S.useRef(null),J=oe(),l=ie(),r=Q(ee(se,{activationConstraint:{distance:5}}));S.useEffect(()=>{const s=a=>{(a.ctrlKey||a.metaKey)&&a.key==="z"&&(a.preventDefault(),a.shiftKey?w():z()),(a.ctrlKey||a.metaKey)&&a.key==="y"&&(a.preventDefault(),w())};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[z,w]),S.useEffect(()=>{var s,a;if(t==="edit"&&o&&(j({customerName:o.customerName,billNumber:o.billNumber,projectId:((s=o.projectId)==null?void 0:s._id)||o.projectId,projectName:"",pdfData:o.pdfData}),o.layout&&((a=o.layout[0])!=null&&a.components))){const i=o.layout[0].components.map(u=>{var b;return u.type==="table"&&typeof((b=u.value[0])==null?void 0:b[0])=="string"&&(u.value=u.value.map(I=>I.map(P=>({content:P,style:{}})))),u});A(i)}t==="create"&&g.length===0&&$(!0)},[o,t]);const d=s=>{Y(s._id);const i=JSON.parse(JSON.stringify(s.layout[0].components)).map(u=>{var b;return u.type==="table"&&typeof((b=u.value[0])==null?void 0:b[0])=="string"&&(u.value=u.value.map(I=>I.map(P=>({content:P,style:{}})))),u});c(i),j(u=>({...u,pdfData:s.pdfData||null})),$(!1)},f=s=>{const a={id:V(),type:s,label:s==="text"?"Text":"Field",value:s==="text"?"":"Val",x:50,y:50,style:{...X,width:150,height:"auto"}};c(i=>[...i,a]),W(a.id),T(null)},N=(s,a)=>{const i={id:V(),type:"table",label:"Table",value:Array.from({length:s},()=>Array(a).fill({content:"",style:{}})),x:50,y:100,style:{...X,width:400,height:s*30},columnWidths:Array(a).fill(100/a),rowHeights:Array(s).fill(30)};c(u=>[...u,i]),G(!1),W(i.id)},y=s=>{if(s.target.files&&s.target.files[0]){const a=s.target.files[0],i=Object.assign(a,{preview:URL.createObjectURL(a)}),u={id:V(),type:"image",label:"Img",value:[i],x:50,y:50,style:{...X,width:200,height:200}};c(b=>[...b,u])}},v=(s,a,i,u=!1)=>{c(b=>b.map(I=>I.id===s?u?{...I,style:{...I.style,[a]:i}}:{...I,[a]:i}:I))},D=(s,a,i,u,b)=>{c(I=>I.map(P=>{if(P.id!==s)return P;const K=JSON.parse(JSON.stringify(P.value));return K[a][i].style={...K[a][i].style,[u]:b},{...P,value:K}}))},E=()=>{const s=[{id:"main_canvas",name:"Canvas",order:0,style:X,components:g}],a={organizationId:x,projectId:h.projectId||null,templateId:F,customerName:h.customerName,billNumber:h.billNumber,layout:s,initialValues:{}};t==="create"?J.mutate(a,{onSuccess:i=>n(`../single/${i.data._id}`,{replace:!0})}):l.mutate({...a,id:p})};if(t==="edit"&&m)return e.jsx("div",{className:"p-10 text-center",children:"Loading..."});const C=g.find(s=>s.id===L);return e.jsxs("div",{className:"h-screen flex flex-col bg-gray-100 overflow-hidden",children:[e.jsxs("div",{className:"bg-white border-b px-4 py-2 shadow-sm z-30",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>n(-1),children:e.jsx("i",{className:"fa-solid fa-arrow-left text-gray-500"})}),e.jsx("input",{className:"font-bold text-gray-700 outline-none border-b border-transparent hover:border-gray-300 focus:border-blue-500 w-48",value:h.customerName,onChange:s=>j({...h,customerName:s.target.value}),placeholder:"Customer Name"}),e.jsxs("select",{className:"text-sm border border-gray-300 rounded px-2 py-1 w-48",value:h.projectId,onChange:s=>j({...h,projectId:s.target.value}),children:[e.jsx("option",{value:"",children:"Select Project"}),k==null?void 0:k.map(s=>e.jsx("option",{value:s._id,children:s.projectName},s._id))]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(U,{variant:"outline",onClick:()=>$(!B),children:[B?"Hide":"Show"," Templates"]}),e.jsx(U,{onClick:E,isLoading:J.isPending||l.isPending,children:"Save Bill"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 border-t pt-2",children:[e.jsx("button",{onClick:z,disabled:!R,className:`btn-tool ${R?"":"opacity-50"}`,title:"Undo (Ctrl+Z)",children:e.jsx("i",{className:"fa-solid fa-rotate-left"})}),e.jsx("button",{onClick:w,disabled:!M,className:`btn-tool ${M?"":"opacity-50"}`,title:"Redo (Ctrl+Y)",children:e.jsx("i",{className:"fa-solid fa-rotate-right"})}),e.jsx("div",{className:"w-px h-6 bg-gray-300 mx-2"}),e.jsxs("button",{onClick:()=>f("text"),className:"btn-tool",children:[e.jsx("i",{className:"fa-solid fa-font"})," Text"]}),e.jsxs("button",{onClick:()=>f("data-field"),className:"btn-tool",children:[e.jsx("i",{className:"fa-solid fa-database"})," Field"]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>G(!H),className:"btn-tool",children:[e.jsx("i",{className:"fa-solid fa-table"})," Table"]}),H&&e.jsx(ue,{onSelect:N})]}),e.jsxs("button",{onClick:()=>{var s;return(s=O.current)==null?void 0:s.click()},className:"btn-tool",children:[e.jsx("i",{className:"fa-regular fa-image"})," Image"]}),e.jsx("input",{type:"file",ref:O,className:"hidden",onChange:y})]})]}),B&&e.jsx(he,{organizationId:x,onSelect:d,onClose:()=>$(!1)}),e.jsx("div",{className:"flex-1 bg-gray-200 overflow-auto p-8 relative",onClick:()=>{W(null),T(null)},children:e.jsx(te,{sensors:r,onDragEnd:s=>{const{active:a,delta:i}=s;c(u=>u.map(b=>b.id===a.id?{...b,x:b.x+i.x,y:b.y+i.y}:b))},children:e.jsxs("div",{className:"mx-auto bg-white shadow-2xl relative",style:{width:794,minHeight:1123,height:"auto"},children:[h.pdfData&&e.jsx("div",{className:"absolute inset-0 z-0 pointer-events-none",children:e.jsx("img",{src:h.pdfData.url,className:"w-full h-full opacity-50 object-cover"})}),g.map(s=>e.jsx(ge,{component:s,isSelected:s.id===L,activeCell:s.id===L?_:null,onClick:()=>W(s.id),onCellSelect:(a,i)=>{W(s.id),T({r:a,c:i})},onUpdateValue:a=>v(s.id,"value",a),onUpdateMeta:(a,i)=>v(s.id,a,i,a!=="label"),onResize:(a,i)=>c(u=>u.map(b=>b.id===s.id?{...b,style:{...b.style,width:a,height:i}}:b)),onDelete:()=>{c(a=>a.filter(i=>i.id!==s.id)),W(null)}},s.id))]})})}),L&&C&&e.jsx(fe,{component:C,activeCell:C.type==="table"?_:null,onUpdate:(s,a,i=!1)=>v(L,s,a,i),onUpdateCell:(s,a,i,u)=>D(L,s,a,i,u),onDelete:()=>{c(s=>s.filter(a=>a.id!==L)),W(null)},onClose:()=>W(null)})]})};export{ke as default};
