import{c as E,e as P,f as q,a as u,j as e,O as z}from"./index-ftjmZ4WH.js";import{I as y}from"./Input-sieJTkC7.js";import{t as l}from"./toast-BSC5QTk1.js";import{B as o}from"./Button-BhpUbe89.js";import{u as A,a as L,b as M}from"./rateConfigApi-Dedzh3LL.js";import{C as R,a as I}from"./Card-BB2WhPtT.js";import{D as O,a as _,b as B,c as G}from"./Dialog-KWaY4M9H.js";import"./useQuery-DmDT-v30.js";import"./useMutation-CSGCjuCw.js";import"./roleCheck-BuedAs3v.js";function Z(){const{organizationId:d}=E(),j=P(),C=q().pathname.includes("single"),[c,x]=u.useState(""),[n,m]=u.useState([{key:"",type:"string",required:!1}]),[v,g]=u.useState(!1),{data:r,isLoading:h,refetch:p}=A(d),{mutateAsync:N,isPending:b}=L(),{mutateAsync:w,isPending:k}=M(),D=()=>{m([...n,{key:"",type:"string",required:!1}])},f=(a,t,s)=>{const i=[...n];i[a][t]=s,m(i)},F=async()=>{var a,t;try{if(!d||!c||n.length===0)return l({title:"Error",description:"Category name and fields are required",variant:"destructive"});const s=n.filter(i=>i.key.trim()!=="");if(s.length===0)return l({title:"Error",description:"Please enter valid field keys",variant:"destructive"});await N({organizationId:d,name:c,fields:s}),x(""),m([{key:"",type:"string",required:!1}]),g(!1),p(),l({title:"Success",description:"Category Created Successfully"})}catch(s){l({title:"Error",description:((t=(a=s==null?void 0:s.response)==null?void 0:a.data)==null?void 0:t.message)||(s==null?void 0:s.message)||"failed to create category",variant:"destructive"})}},S=a=>{var t,s;try{w({categoryId:a,organizationId:d}),p(),l({title:"Success",description:"Category Deleted Successfully"})}catch(i){l({title:"Error",description:((s=(t=i==null?void 0:i.response)==null?void 0:t.data)==null?void 0:s.message)||(i==null?void 0:i.message)||"failed to delete category",variant:"destructive"})}};return C?e.jsx(z,{}):e.jsxs("div",{className:"space-y-6 max-h-full overflow-y-auto",children:[e.jsxs("header",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-cubes mr-3 text-blue-600"}),"Rate Configuration Materials"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your organization's material categories and configurable fields"})]}),e.jsx("div",{children:e.jsx(o,{onClick:()=>g(!0),children:"Create New Category"})})]}),e.jsx(O,{open:v,onOpenChange:g,children:e.jsxs(_,{className:"px-5 py-6",children:[e.jsx(B,{className:"px-0 py-0",children:e.jsx(G,{children:"Create New Material Category"})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(y,{placeholder:"Category name (e.g. Plywood)",value:c,onChange:a=>x(a.target.value)}),e.jsx("h4",{className:"text-base font-semibold",children:"Define Fields"}),e.jsx("div",{className:"space-y-2",children:n.map((a,t)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(y,{placeholder:"Field key (e.g: brand, sqft/rate, notes)",value:a.key,onChange:s=>f(t,"key",s.target.value),className:"flex-1"}),e.jsxs("select",{value:a.type,onChange:s=>f(t,"type",s.target.value),className:"  px-2 py-2 rounded-xl border border-blue-200 focus:border-blue-200 active:border-blue-200",children:[e.jsx("option",{value:"string",children:"text"}),e.jsx("option",{value:"number",children:"number"})]})]},t))}),e.jsxs("div",{className:"flex justify-between pt-2",children:[e.jsx(o,{variant:"secondary",onClick:D,children:"+ Add Field"}),e.jsx(o,{isLoading:b,onClick:F,children:"Create Category"})]})]})]})}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[h&&e.jsx("p",{children:"Loading categories..."}),!h&&(r==null?void 0:r.length)===0&&e.jsx("p",{className:"text-gray-500",children:"No categories found"}),r==null?void 0:r.map(a=>e.jsx(R,{className:"w-full border-l-4 border-blue-600 shadow-md bg-white hover:shadow-lg transition-all",children:e.jsxs(I,{className:"p-4 space-y-2",children:[e.jsx("h3",{className:"text-base font-bold text-blue-700 mb-2",children:a.name}),e.jsxs("p",{className:"text-sm text-gray-600 capitalize",children:["Fields:"," ",e.jsx("strong",{children:a.fields.map(t=>t.key).join(", ")})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsxs(o,{size:"sm",variant:"secondary",onClick:()=>j(`single/${a._id}`),children:[e.jsx("i",{className:"fas fa-eye mr-1"}),"View"]}),e.jsxs(o,{size:"sm",isLoading:k,variant:"danger",className:"bg-red-600 text-white",onClick:()=>S(a._id),children:[e.jsx("i",{className:"fas fa-trash mr-1"}),"Delete"]})]})]})},a._id))]})]})}export{Z as default};
