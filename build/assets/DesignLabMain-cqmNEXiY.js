import{b as E,j as e,a as _,f as M,p as G,r as w,O as H,B as S,t as A}from"./index-hYGmCEO1.js";import{u as V}from"./useDebounce-Iar4ThTS.js";import{c as Y,d as U}from"./designLabApi-DGA1p7b6.js";import{S as $}from"./StageGuide-BKWoPeLK.js";const z=({images:t})=>{const a=(t==null?void 0:t.filter(c=>c==null?void 0:c.url).slice(0,3))||[];return a.length===0?e.jsxs("div",{className:"w-full h-full bg-gray-100 flex flex-col items-center justify-center text-gray-300",children:[e.jsx("i",{className:"fas fa-image text-3xl mb-2"}),e.jsx("span",{className:"text-xs font-medium",children:"No Reference Images"})]}):a.length===1?e.jsx("img",{src:a[0].url,className:"w-full h-full object-cover"}):a.length===2?e.jsx("div",{className:"w-full h-full grid grid-cols-2 gap-0.5",children:a.map((c,o)=>e.jsx("img",{src:c.url,className:"w-full h-full object-cover"},o))}):e.jsxs("div",{className:"w-full h-full grid grid-cols-3 grid-rows-2 gap-0.5",children:[e.jsx("img",{src:a[0].url,className:"col-span-2 row-span-2 w-full h-full object-cover"}),e.jsx("img",{src:a[1].url,className:"col-span-1 row-span-1 w-full h-full object-cover"}),e.jsxs("div",{className:"relative col-span-1 row-span-1",children:[e.jsx("img",{src:a[2].url,className:"w-full h-full object-cover"}),t.length>3&&e.jsxs("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center text-white text-xs font-bold",children:["+",t.length-3]})]})]})},K=({design:t,handleView:a,handleDelete:c,deletePending:o})=>{var u;const{role:i,permission:x}=E(),b=i==="owner"||((u=x==null?void 0:x.design)==null?void 0:u.delete);return e.jsxs("div",{onClick:()=>a(t._id),className:"group relative bg-white rounded-2xl border border-gray-200 shadow-sm hover:shadow-xl hover:-translate-y-1 transition-all duration-300 cursor-pointer overflow-hidden flex flex-col h-full",children:[e.jsxs("div",{className:"h-48 relative bg-gray-50 border-b border-gray-100 shrink-0",children:[e.jsx(z,{images:t.referenceImages||[]}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsx("div",{className:"absolute top-3 left-3 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:e.jsxs("span",{className:"px-2 py-1 bg-black/50 backdrop-blur-md text-white text-[10px] font-mono rounded",children:["#",t.designCode]})}),b&&e.jsx("button",{onClick:f=>{f.stopPropagation(),c(t._id)},disabled:o,className:"absolute cursor-pointer top-3 right-3 w-8 h-8 flex items-center justify-center bg-white/90 backdrop-blur-sm text-red-500 rounded-full shadow-sm opacity-0 group-hover:opacity-100 transition-all transform hover:scale-110 hover:bg-red-500 hover:text-white",title:"Delete Design",children:o?e.jsx("i",{className:"fas fa-spinner fa-spin text-xs"}):e.jsx("i",{className:"fas fa-trash text-xs"})})]}),e.jsxs("div",{className:"p-4 flex flex-col flex-1 gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-900 text-base leading-tight truncate mb-1",title:t.productName,children:t.productName}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx("i",{className:"fas fa-user-circle text-blue-500"}),e.jsx("span",{className:"font-medium truncate",children:t.designerName})]})]}),e.jsx("div",{className:"h-px bg-gray-100 w-full"}),e.jsxs("div",{className:"grid grid-cols-2 gap-y-3 gap-x-2 text-xs",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] text-gray-400 uppercase tracking-wide font-medium",children:"DL Code"}),e.jsxs("span",{className:"font-mono font-semibold text-indigo-600 truncate",title:t.designCode,children:["#",t.designCode]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] text-gray-400 uppercase tracking-wide font-medium",children:"Space"}),e.jsx("span",{className:"font-semibold text-gray-800 truncate",children:t.spaceType||"—"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] text-gray-400 uppercase tracking-wide font-medium",children:"Difficulty"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${t.difficultyLevel==="Hard"?"bg-red-500":t.difficultyLevel==="Medium"?"bg-orange-500":"bg-green-500"}`}),e.jsx("span",{className:"font-semibold text-gray-700",children:t.difficultyLevel||"—"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] text-gray-400 uppercase tracking-wide font-medium",children:"Date"}),e.jsx("span",{className:"font-semibold text-gray-700",children:new Date(t.designDate).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"2-digit"})})]})]})]})]})},W=["Bedroom","Living Room","Kitchen","Bathroom","Foyer","Commercial"],q=["Beginner","Intermediate","Advanced","Factory Pro"],J=["draft","published","archived"],se=()=>{var D,L;const t=_(),a=M(),{organizationId:c}=G(),{role:o,permission:i}=E(),x=o==="owner"||((D=i==null?void 0:i.design)==null?void 0:D.list),b=o==="owner"||((L=i==null?void 0:i.design)==null?void 0:L.create),u=a.pathname.includes("/single")||a.pathname.includes("/create"),f=w.useRef(null),[r,d]=w.useState({search:"",spaceType:"",difficultyLevel:"",status:"",sortBy:"createdAt",sortOrder:"desc"}),F=V(r.search,700),{data:j,isLoading:T,isError:B,error:y,fetchNextPage:k,hasNextPage:v,isFetchingNextPage:m,refetch:O}=Y({organizationId:c,filters:{...r,search:F}}),N=U();w.useEffect(()=>{const s=f.current;if(!s)return;const l=()=>{const{scrollTop:p,scrollHeight:n,clientHeight:R}=s;n-p-R<100&&v&&!m&&k()};return s.addEventListener("scroll",l),()=>s.removeEventListener("scroll",l)},[v,m,k]);const P=async s=>{var l,p;try{await N.mutateAsync(s),A({title:"Success",description:"Design deleted successfully"})}catch(n){A({title:"Error",description:((p=(l=n==null?void 0:n.response)==null?void 0:l.data)==null?void 0:p.message)||(n==null?void 0:n.message)||"Failed to delete design",variant:"destructive"})}},I=s=>{t(`single/${s}`)},C=()=>{d({search:"",spaceType:"",difficultyLevel:"",status:"",sortBy:"createdAt",sortOrder:"desc"})},g=Object.values(r).filter(s=>s!==""&&s!=="createdAt"&&s!=="desc").length,h=(j==null?void 0:j.pages.flatMap(s=>s.designLabs))||[];return u?e.jsx(H,{}):e.jsxs("div",{className:"space-y-0 h-full flex flex-col",children:[e.jsxs("header",{className:"flex justify-between items-center shrink-0 mb-4 px-1",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-layer-group mr-3 text-blue-600"}),"Design Lab"]}),e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Manage your design specifications"})]}),e.jsxs("div",{className:"flex gap-3 items-center",children:[b&&e.jsxs(S,{onClick:()=>t("create"),className:"flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-plus"}),"Create Design"]}),e.jsx("div",{className:"w-full sm:w-auto flex justify-end sm:block",children:e.jsx($,{organizationId:c,stageName:"design"})})]})]}),e.jsxs("main",{className:"flex gap-4 flex-1 overflow-hidden",children:[e.jsx("div",{className:"w-72 flex-shrink-0 h-full overflow-y-auto custom-scrollbar pb-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-5 border border-gray-200 h-full flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 shrink-0",children:[e.jsxs("h3",{className:"text-base font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-filter mr-2 text-blue-600"}),"Filters"]}),g>0&&e.jsxs("button",{onClick:C,className:"text-xs text-blue-600 hover:text-blue-800 font-semibold hover:underline",children:["Clear All (",g,")"]})]}),e.jsxs("div",{className:"space-y-5 overflow-y-auto flex-1 pr-1 custom-scrollbar",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-700 mb-1.5 uppercase tracking-wide",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx("i",{className:"fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-xs"}),e.jsx("input",{type:"text",placeholder:"Design name, code...",value:r.search,onChange:s=>d(l=>({...l,search:s.target.value})),className:"w-full pl-9 pr-3 py-2 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-700 mb-1.5 uppercase tracking-wide",children:"Space Type"}),e.jsxs("select",{value:r.spaceType,onChange:s=>d(l=>({...l,spaceType:s.target.value})),className:"w-full px-3 py-2 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none",children:[e.jsx("option",{value:"",children:"All Spaces"}),W.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-700 mb-1.5 uppercase tracking-wide",children:"Difficulty"}),e.jsxs("select",{value:r.difficultyLevel,onChange:s=>d(l=>({...l,difficultyLevel:s.target.value})),className:"w-full px-3 py-2 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none",children:[e.jsx("option",{value:"",children:"All Levels"}),q.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-700 mb-1.5 uppercase tracking-wide",children:"Status"}),e.jsxs("select",{value:r.status,onChange:s=>d(l=>({...l,status:s.target.value})),className:"w-full px-3 py-2 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none",children:[e.jsx("option",{value:"",children:"All Statuses"}),J.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-700 mb-1.5 uppercase tracking-wide",children:"Sort By"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("select",{value:r.sortBy,onChange:s=>d(l=>({...l,sortBy:s.target.value})),className:"col-span-2 w-full px-3 py-2 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none",children:[e.jsx("option",{value:"createdAt",children:"Created Date"}),e.jsx("option",{value:"designDate",children:"Design Date"}),e.jsx("option",{value:"productName",children:"Name"})]}),e.jsxs("select",{value:r.sortOrder,onChange:s=>d(l=>({...l,sortOrder:s.target.value})),className:"col-span-2 w-full px-3 py-2 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none",children:[e.jsx("option",{value:"desc",children:"Newest First"}),e.jsx("option",{value:"asc",children:"Oldest First"})]})]})]})]})]})}),x&&e.jsx("div",{className:"flex-1 h-full overflow-hidden flex flex-col",children:T?e.jsx("div",{className:"flex-1 flex justify-center items-center bg-white rounded-xl border border-gray-200",children:e.jsxs("div",{className:"flex flex-col items-center gap-3 text-blue-600",children:[e.jsx("i",{className:"fas fa-spinner fa-spin text-4xl"}),e.jsx("p",{className:"text-sm font-medium",children:"Loading Designs..."})]})}):B?e.jsx("div",{className:"flex-1 flex justify-center items-start pt-10 bg-white rounded-xl border border-gray-200",children:e.jsxs("div",{className:"max-w-md w-full p-6 bg-red-50 border border-red-200 rounded-xl shadow-sm text-center",children:[e.jsxs("div",{className:"text-red-600 font-bold mb-2 text-xl flex items-center justify-center gap-2",children:[e.jsx("i",{className:"fas fa-exclamation-triangle"})," Error Occurred"]}),e.jsx("p",{className:"text-red-500 mb-6",children:(y==null?void 0:y.message)||"Failed to load designs. Please try again."}),e.jsx(S,{onClick:()=>O(),variant:"danger",children:"Retry"})]})}):h.length===0?e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center bg-white rounded-xl border border-gray-200 p-10 text-center shadow-sm",children:[e.jsx("div",{className:"bg-blue-50 p-6 rounded-full mb-6",children:e.jsx("i",{className:"fas fa-drafting-compass text-5xl text-blue-300"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"No Designs Found"}),e.jsx("p",{className:"text-gray-500 max-w-md mb-8",children:r.search||g>0?"We couldn’t find any designs matching your filters. Try adjusting or clearing them.":"Your design library is empty. Start by creating your first design specification."}),r.search||g>0?e.jsx("button",{onClick:C,className:"text-blue-600 font-medium hover:underline",children:"Clear all filters"}):null]}):e.jsxs("div",{ref:f,className:"flex-1 bg-gray-50/50 rounded-xl overflow-y-auto custom-scrollbar flex flex-col p-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 pb-6",children:h.map(s=>e.jsx(K,{design:s,handleView:I,handleDelete:P,deletePending:N.isPending&&N.variables===s._id},s._id))}),e.jsx("div",{className:"py-8 text-center mt-auto shrink-0",children:m?e.jsxs("div",{className:"flex flex-col items-center gap-2 text-blue-600",children:[e.jsx("i",{className:"fas fa-circle-notch fa-spin text-xl"}),e.jsx("span",{className:"text-sm font-medium",children:"Loading more designs..."})]}):!v&&h.length>0?e.jsxs("div",{className:"flex items-center justify-center gap-2 opacity-50",children:[e.jsx("span",{className:"h-px w-12 bg-gray-300"}),e.jsx("p",{className:"text-xs text-gray-400 font-medium uppercase tracking-wide",children:"End of Collection"}),e.jsx("span",{className:"h-px w-12 bg-gray-300"})]}):h.length===0&&!m?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-gray-400",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4",children:e.jsx("i",{className:"fas fa-layer-group text-2xl"})}),e.jsx("p",{children:"No designs found"})]}):null})]})})]})]})};export{se as default};
