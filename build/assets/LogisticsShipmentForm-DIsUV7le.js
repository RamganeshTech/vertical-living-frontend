import{r as j,j as e,B as y,t as k}from"./index-BAM0eJUz.js";import{L as m}from"./Label-C8i6KaZe.js";import{I as d}from"./Input-1UBXZqEj.js";import{u as A}from"./projectApi-D7-uwdh2.js";import{d as U,e as B}from"./logisticsApi-Qwzfztbq.js";const T=c=>{if(!c)return"";const u=new Date(c),p=o=>String(o).padStart(2,"0"),N=u.getFullYear(),b=p(u.getMonth()+1),P=p(u.getDate()),C=p(u.getHours()),x=p(u.getMinutes());return`${N}-${b}-${P}T${C}:${x}`},G=({shipment:c,onClose:u,organizationId:p})=>{var w;const{mutateAsync:N,isPending:b}=U(),{mutateAsync:P,isPending:C}=B(),{data:x}=A(p),o=x==null?void 0:x.map(i=>({_id:i._id,projectName:i.projectName})),[g,f]=j.useState({_id:"",projectName:""}),[t,v]=j.useState({shipmentStatus:"pending",vehicleDetails:{vehicleNumber:"",vehicleType:"truck",driverCharge:0,driver:{name:"",phone:"",licenseNumber:""},driverUpiId:""},origin:{address:"",contactPerson:"",contactPhone:""},destination:{address:"",contactPerson:"",contactPhone:""},items:[{name:"",quantity:0}],scheduledDate:"",actualPickupTime:"",actualDeliveryTime:"",notes:"",trackingLink:null});j.useEffect(()=>{c&&(v({...t,...c,scheduledDate:c.scheduledDate?T(c.scheduledDate):"",actualPickupTime:c.actualPickupTime?T(c.actualPickupTime):"",actualDeliveryTime:c.actualDeliveryTime?T(c.actualDeliveryTime):""}),f(()=>{const i=o==null?void 0:o.find(s=>s._id===(c==null?void 0:c.projectId));return{_id:c.projectId,projectName:i==null?void 0:i.projectName}}))},[c]),j.useEffect(()=>{c||o&&o.length>0&&(console.log("projects",o),f(()=>{var i,s;return{_id:(i=o[0])==null?void 0:i._id,projectName:(s=o[0])==null?void 0:s.projectName}}))},[x]),j.useEffect(()=>{const i=s=>{s.key==="Escape"&&u()};return window.addEventListener("keydown",i),()=>{window.removeEventListener("keydown",i)}},[u]);const r=i=>{const{name:s,value:n}=i.target;if(s.startsWith("origin.")){const a=s.split(".")[1];v(l=>({...l,origin:{...l.origin,[a]:n}}))}else if(s.startsWith("destination.")){const a=s.split(".")[1];v(l=>({...l,destination:{...l.destination,[a]:n}}))}else if(s.startsWith("vehicleDetails.driver.")){const a=s.split(".")[2];v(l=>({...l,vehicleDetails:{...l.vehicleDetails,driver:{...l.vehicleDetails.driver,[a]:n}}}))}else if(s.startsWith("vehicleDetails.")){const a=s.split(".")[1];v(l=>({...l,vehicleDetails:{...l.vehicleDetails,[a]:n}}))}else v(a=>({...a,[s]:n}))},$=i=>{var n,a,l,h,S,I,_,L;const s=[];return(n=i==null?void 0:i.origin)!=null&&n.contactPhone&&!/^\d{10}$/.test((a=i==null?void 0:i.origin)==null?void 0:a.contactPhone)&&s.push("Phone number must be exactly 10 digits."),(l=i==null?void 0:i.destination)!=null&&l.contactPhone&&!/^\d{10}$/.test((h=i==null?void 0:i.destination)==null?void 0:h.contactPhone)&&s.push("Phone number must be exactly 10 digits."),(I=(S=i==null?void 0:i.vehicleDetails)==null?void 0:S.vehicleNumber)!=null&&I.trim()||s.push("vehicle number is required."),((_=i==null?void 0:i.items)==null?void 0:_.length)>0&&((L=i==null?void 0:i.items)==null||L.forEach((D,E)=>{D.name||s.push(`Item ${E+1} is missing a name.`),D.quantity<0&&s.push(`Item ${E+1} has invalid quantity.`)})),s},q=async()=>{var i,s;try{const n=$(t);if(n.length>0){n.forEach(a=>{k({title:"Validation Error",description:a,variant:"destructive"})});return}c?await P({shipmentId:c._id,organizationId:p,projectId:g==null?void 0:g._id,payload:t}):await N({organizationId:p,projectId:g._id,payload:t,projectName:g.projectName}),k({title:"success",description:"shipment has generated"}),u()}catch(n){k({title:"Error",description:((s=(i=n==null?void 0:n.response)==null?void 0:i.data)==null?void 0:s.message)||"Operation Failed",variant:"destructive"})}};return e.jsx("div",{onClick:u,className:"fixed inset-0 bg-black/60 flex justify-center items-center z-50",children:e.jsxs("div",{onClick:i=>i.stopPropagation(),className:"bg-white rounded-xl p-6 shadow-lg w-[90vw] max-w-[1300px] h-[90vh] flex flex-col",children:[e.jsx("h3",{className:"text-xl font-bold mb-3",children:c?"Edit Shipment":"Create Shipment"}),e.jsxs("div",{className:"max-h-[80vh] overflow-y-auto p-2 sm:p-4 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold mb-2 text-blue-700",children:"Shipment Info"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(m,{children:"Select Project"}),e.jsx("select",{className:"w-full px-3 py-2 border rounded-xl",name:"projectID",value:g._id,onChange:i=>{const s=o==null?void 0:o.find(n=>n._id===i.target.value);s&&f({_id:s._id,projectName:s.projectName})},children:o==null?void 0:o.map(i=>e.jsx("option",{value:i._id,children:i.projectName},i._id))})]}),e.jsxs("div",{children:[e.jsx(m,{children:"shipmentStatus"}),e.jsxs("select",{className:"w-full px-3 py-2 border rounded-xl",name:"shipmentStatus",value:t.shipmentStatus,onChange:r,children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"assigned",children:"Assigned"}),e.jsx("option",{value:"pickedup",children:"Picked Up"}),e.jsx("option",{value:"in_transit",children:"In Transit"}),e.jsx("option",{value:"delivered",children:"Delivered"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Scheduled Date"}),e.jsx(d,{type:"datetime-local",name:"scheduledDate",value:t.scheduledDate,onChange:r})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold mb-2 text-green-700",children:"Vehicle Info"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(d,{name:"vehicleDetails.vehicleNumber",placeholder:"Vehicle Number",required:!0,value:t.vehicleDetails.vehicleNumber,onChange:r}),e.jsxs("select",{name:"vehicleDetails.vehicleType",value:t.vehicleDetails.vehicleType,onChange:r,className:"w-full px-3 py-2 border rounded-xl",children:[e.jsx("option",{value:"truck",children:"Truck"}),e.jsx("option",{value:"van",children:"Van"}),e.jsx("option",{value:"car",children:"Car"}),e.jsx("option",{value:"bike",children:"Bike"}),e.jsx("option",{value:"tempo",children:"Tempo"}),e.jsx("option",{value:"container",children:"Container"})]}),e.jsx(d,{name:"vehicleDetails.driver.name",placeholder:"Driver Name",value:t.vehicleDetails.driver.name,onChange:r}),e.jsx(d,{name:"vehicleDetails.driver.phone",type:"tel",maxLength:10,placeholder:"Driver Phone",value:t.vehicleDetails.driver.phone,onChange:i=>{const s=i.target.value;/^\d*$/.test(s)&&r(i)}}),e.jsx(d,{name:"vehicleDetails.driver.licenseNumber",placeholder:"License Number",value:t.vehicleDetails.driver.licenseNumber,onChange:r}),e.jsx(d,{name:"vehicleDetails.driverCharge",type:"number",placeholder:"Driver Charge",value:(w=t==null?void 0:t.vehicleDetails)==null?void 0:w.driverCharge,onChange:i=>{const s=i.target.value;(s===""||Number(s)>=0)&&r(i)}}),e.jsx(d,{name:"vehicleDetails.driverUpiId",type:"text",placeholder:"Driver Upi",value:t.vehicleDetails.driverUpiId||"",onChange:i=>{r(i)}})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-yellow-700 mb-2",children:"Origin & Destination"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(m,{children:"Origin"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{name:"origin.address",placeholder:"Address",value:t.origin.address,onChange:r}),e.jsx(d,{name:"origin.contactPerson",placeholder:"Contact Person",value:t.origin.contactPerson,onChange:r}),e.jsx(d,{name:"origin.contactPhone",placeholder:"Contact Phone",type:"tel",maxLength:10,value:t.origin.contactPhone,onChange:i=>{const s=i.target.value;/^\d*$/.test(s)&&r(i)}})]})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Destination"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{name:"destination.address",placeholder:"Address",value:t.destination.address,onChange:r}),e.jsx(d,{name:"destination.contactPerson",placeholder:"Contact Person",value:t.destination.contactPerson,onChange:r}),e.jsx(d,{name:"destination.contactPhone",placeholder:"Contact Phone",type:"tel",maxLength:10,value:t.destination.contactPhone,onChange:i=>{const s=i.target.value;/^\d*$/.test(s)&&r(i)}})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-indigo-700 mb-2",children:"Timing Schedule"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(m,{children:"Actual Pickup Time"}),e.jsx(d,{type:"datetime-local",name:"actualPickupTime",value:t.actualPickupTime,onChange:r})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Actual Delivery Time"}),e.jsx(d,{type:"datetime-local",name:"actualDeliveryTime",value:t.actualDeliveryTime,onChange:r})]})]})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Notes"}),e.jsx("textarea",{name:"notes",className:"w-full px-3 py-2 border rounded-xl",rows:3,value:t.notes,onChange:r})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-pink-700 mb-2",children:"Shipment Items"}),e.jsxs("div",{className:"space-y-4",children:[t.items.map((i,s)=>e.jsxs("div",{className:"grid grid-cols-12  items-center gap-2 sm:gap-4",children:[e.jsxs("div",{className:"col-span-6 sm:col-span-5",children:[e.jsx(m,{children:"Item Name"}),e.jsx(d,{name:`item-name-${s}`,value:i.name,placeholder:"e.g. Wooden Pallets",onChange:n=>{const a=n.target.value;v(l=>{const h=[...l.items];return h[s].name=a,s===h.length-1&&a.trim()!==""&&h.push({name:"",quantity:0}),a.trim()===""&&s<h.length-1&&h.splice(s,1),{...l,items:h}})}})]}),e.jsxs("div",{className:"col-span-4 sm:col-span-3",children:[e.jsx(m,{children:"Quantity"}),e.jsx(d,{type:"number",name:`item-qty-${s}`,value:i.quantity,placeholder:"e.g. 10",onChange:n=>{const a=parseInt(n.target.value)||0;Number(a)>=0&&v(l=>{const h=[...l.items];return h[s].quantity=a,{...l,items:h}})}})]}),e.jsx("div",{className:"col-span-2 sm:col-span-2 flex mt-5 place-items-center h-full",children:e.jsx(y,{variant:"danger",size:"md",type:"button",className:"text-white bg-red-600",onClick:()=>{v(n=>({...n,items:n.items.filter((a,l)=>l!==s)}))},children:e.jsx("i",{className:"fas fa-trash"})})})]},s)),e.jsx("div",{children:e.jsxs(y,{variant:"outline",size:"sm",type:"button",onClick:()=>v(i=>({...i,items:[...i.items,{name:"",quantity:0}]})),children:[e.jsx("i",{className:"fas fa-plus mr-1"}),"Add Item"]})})]})]})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Tracking Link"}),e.jsx(d,{name:"trackingLink",placeholder:"Paste the Tracking Link here",value:t.trackingLink||"",onChange:r})]}),e.jsxs("div",{className:"pt-4 flex justify-end gap-3 border-t mt-5",children:[e.jsx(y,{variant:"outline",onClick:u,children:"Cancel"}),e.jsx(y,{isLoading:C||b,onClick:()=>q(),children:c?"Update":"Create"})]})]})})};export{G as L,T as f};
