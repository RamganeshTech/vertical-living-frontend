import{u as b,j as r,M as G,t as d}from"./index-BAM0eJUz.js";import{C as E}from"./CutlistForm-CcqoVJFt.js";import{b as h,c as k,d as F}from"./cutlistApi-DKkfWc2n.js";import{d as M}from"./downloadFile-BbGV_BaX.js";import"./projectApi-D7-uwdh2.js";import"./clientQuoteApi-B0Dnhpm6.js";import"./SearchSelectNew-IGAHiELy.js";import"./Input-1UBXZqEj.js";import"./requirementFormApi-_wh_iBu9.js";import"./useInfiniteQuery-BGz0VllC.js";const H=()=>{const{id:l,organizationId:c}=b(),{data:y,isLoading:N,isError:w,error:x,refetch:m}=h(l),p=k(),u=F(),j=async(a,s,t)=>{var f,g;try{const e=new FormData;e.append("organizationId",c),e.append("clientName",a.clientName||""),e.append("location",a.location||""),e.append("projectId",a.projectId||""),e.append("quoteNo",a.selectedQuoteNo||""),e.append("quoteId",a.selectedQuoteId||""),e.append("versionNo",a.versionNo||"1.0"),e.append("summary",JSON.stringify(t));const L=s.map((i,S)=>{var v,I;(v=i.backSideLaminateImage)!=null&&v.file&&e.append(`rooms[${S}].backSideLaminateImage`,i.backSideLaminateImage.file),(I=i.frontSideLaminateImage)!=null&&I.file&&e.append(`rooms[${S}].frontSideLaminateImage`,i.frontSideLaminateImage.file);const{backSideLaminateImage:n,frontSideLaminateImage:o,...P}=i;return{...P,backSideLaminateImage:n!=null&&n.file?null:n,frontSideLaminateImage:o!=null&&o.file?null:o}});e.append("rooms",JSON.stringify(L)),await p.mutateAsync({id:l,formData:e}),await m(),d({title:"Success",description:"Cutlist updated successfully"})}catch(e){d({title:"Error",description:((g=(f=e==null?void 0:e.response)==null?void 0:f.data)==null?void 0:g.message)||e.message||"Update failed",variant:"destructive"})}},C=async()=>{var a,s;try{const t=await u.mutateAsync({id:l});await M({src:t==null?void 0:t.pdfUrl,alt:"Cutlist Generation"}),d({title:"Success",description:"Pdf Generated successfully"})}catch(t){d({title:"Error",description:((s=(a=t==null?void 0:t.response)==null?void 0:a.data)==null?void 0:s.message)||(t==null?void 0:t.message)||"Failed to generate link",variant:"destructive"})}};return N?r.jsx(G,{}):w?r.jsxs("div",{className:"p-10 text-center text-red-500",children:["Error: ",x.message]}):r.jsx("main",{className:"max-h-full h-full overflow-y-auto ",children:r.jsx(E,{mode:"view",initialData:y,organizationId:c,onSubmit:j,isSubmitting:p.isPending,isGeneratingPdf:u.isPending,refetch:m,handleGenerate:C})})};export{H as default};
