import{r as k,d as S,j as e,a as L,b as O,c as F,O as D}from"./index-Di9fivK2.js";import{c as I,d as _,e as $,f as B}from"./materialSelectionApi-CoFPw9fv.js";import{t as f}from"./toast-BSC5QTk1.js";import{B as j}from"./Button-CVj9LlQY.js";import{C as T}from"./Card-BLnLpKqb.js";import{A as z,S as E}from"./AssignStaff-DCCFkQ2J.js";import q from"./MaterialOverviewLoading-Coogz3JI.js";import{R as G}from"./ResetStageButton-8ulmKiqQ.js";import{S as V}from"./ShareDocumentWhatsapp-Ct--FB6F.js";import"./roleCheck-CZ0YkMwP.js";import"./useQuery-D3U2IXUF.js";import"./useBaseQuery-DArxBqcU.js";import"./useMutation-Br_DKCOJ.js";import"./Input-CT6Rp1Ze.js";import"./getAllUsersApi-CE5ccby1.js";import"./Skeleton-o7WjJukS.js";import"./documentationApi-B3-CzFxq.js";import"./requirementFormApi-CxXF4l-y.js";const W=({room:s,projectId:u,roomType:r})=>{var a;const m=S(),{mutateAsync:p,isPending:g}=I(),t=async l=>{var c,d;l.stopPropagation();try{if(!confirm("Are you sure you need to delete the room?"))return;await p({projectId:u,roomId:s._id}),f({title:"Success",description:"Room deleted successfully"})}catch(o){f({title:"Error",description:((d=(c=o==null?void 0:o.response)==null?void 0:c.data)==null?void 0:d.message)||"Failed to delete the room",variant:"destructive"})}},h=r==="customRoom"?s.items:s.roomFields;return e.jsxs("div",{onClick:()=>m(`materialroom/${s._id}/${r}`),className:"border-l-4 border-blue-600 cursor-pointer shadow-sm hover:shadow-md transition-all duration-200 rounded-lg p-4 bg-white flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:s.name}),e.jsxs("p",{className:"text-sm text-blue-500",children:["No of Fields: ",(a=Object.keys(h||{}))==null?void 0:a.length]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsx("button",{onClick:l=>{l.stopPropagation(),m(`materialroom/${s._id}/${r}`)},className:"text-sm text-blue-600 underline hover:no-underline cursor-pointer",children:"View →"}),e.jsxs(j,{variant:"danger",size:"sm",onClick:t,disabled:g,className:"flex items-center gap-1 px-2 py-1 text-sm hover:text-white",children:[e.jsx("i",{className:"fas fa-trash"})," Delete"]})]})]})},Y=k.memo(W);function de(){var b,N,w,v,y;const{projectId:s,organizationId:u}=L(),{isMobile:r,openMobileSidebar:m}=O(),p=F(),g=S(),{data:t,isLoading:h,error:a,refetch:l}=_(s),{mutateAsync:c,isPending:d}=$(),{mutateAsync:o,isPending:M}=B();if(h)return e.jsx(q,{});const R=p.pathname.includes("/materialroom"),A=async()=>{var n,C;try{await o({projectId:s}),f({description:"Completion status updated successfully",title:"Success"}),g("../costestimation")}catch(x){f({title:"Error",description:((C=(n=x==null?void 0:x.response)==null?void 0:n.data)==null?void 0:C.message)||x.message||"Failed to update completion status",variant:"destructive"})}},{rooms:i}=t||{},P=(i==null?void 0:i.length)||0;return e.jsx("div",{className:"flex flex-col h-full w-full  py-2",children:R?e.jsx(D,{}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4 mb-4",children:[e.jsxs("h2",{className:"text-2xl sm:text-3xl font-semibold text-blue-600 flex items-center",children:[r&&e.jsx("button",{onClick:m,className:"mr-3 p-2 rounded-md border-gray-300 hover:bg-gray-100",title:"Open Menu",children:e.jsx("i",{className:"fa-solid fa-bars"})}),e.jsx("i",{className:"fas fa-box mr-2"})," Material Selection"]}),e.jsxs("div",{className:"!w-[100%] sm:!w-[100%] lg:!w-[50%] xl:!w-[65%]  flex flex-col sm:flex-row gap-3 justify-end",children:[e.jsx("div",{className:"flex flex-wrap  md:flex-nowrap gap-2 justify-end",children:e.jsxs(j,{isLoading:M,onClick:A,className:"bg-green-600 hover:bg-green-700 text-white flex-1 sm:flex-initial min-w-max",children:[e.jsx("i",{className:"fa-solid fa-circle-check mr-2"}),"Mark Complete"]})}),e.jsxs("div",{className:"flex flex-wrap md:flex-nowrap gap-2 justify-end",children:[e.jsx(G,{projectId:s,stageNumber:5,stagePath:"materialconfirmation",className:"flex-1 sm:flex-initial min-w-max"}),!a&&e.jsx(V,{projectId:s,stageNumber:"5",className:"w-full sm:w-fit",isStageCompleted:t==null?void 0:t.status}),e.jsx(z,{stageName:"MaterialRoomConfirmationModel",projectId:s,organizationId:u,currentAssignedStaff:(t==null?void 0:t.assignedTo)||null,className:"flex-1 sm:flex-initial min-w-max"})]})]})]}),a&&e.jsxs("div",{className:"max-w-xl mx-auto p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center mb-4",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2",children:"⚠️ Error Occurred"}),e.jsx("p",{className:"text-red-500 text-sm mb-4",children:((N=(b=a==null?void 0:a.response)==null?void 0:b.data)==null?void 0:N.message)||(a==null?void 0:a.message)||"Failed to load room data"}),e.jsx(j,{onClick:()=>l(),className:"bg-red-600 text-white px-4 py-2",children:"Retry"})]}),e.jsx("div",{className:"flex-grow min-h-0 flex flex-col",children:!a&&e.jsxs(e.Fragment,{children:[e.jsxs(T,{className:"p-4 mb-4 w-full shadow border-l-4 border-blue-600 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-3 text-blue-700 text-sm font-medium mb-2",children:[e.jsx("i",{className:"fa-solid fa-clock text-blue-500 text-lg"}),e.jsx("span",{children:"Stage Timings"})]}),e.jsx(E,{completedAt:(w=t==null?void 0:t.timer)==null?void 0:w.completedAt,stageName:"materialconfirmation",projectId:s,formId:t==null?void 0:t._id,deadLine:(v=t==null?void 0:t.timer)==null?void 0:v.deadLine,startedAt:(y=t==null?void 0:t.timer)==null?void 0:y.startedAt,refetchStageMutate:l,deadLineMutate:c,isPending:d})]}),e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("h2",{className:"text-xl sm:text-2xl font-semibold",children:["Total Rooms: ",P]})}),e.jsxs("div",{className:"flex-grow min-h-[100%] py-2 sm:!min-h-0  overflow-y-auto",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:i==null?void 0:i.map(n=>e.jsx(Y,{roomType:"predefinedRoom",room:n,projectId:s},n._id))}),(i==null?void 0:i.length)===0&&e.jsx("div",{className:"h-full flex items-center justify-center py-8",children:e.jsxs("div",{className:"text-center max-w-md mx-auto",children:[e.jsx("i",{className:"fas fa-door-open text-5xl sm:text-6xl text-blue-300 mb-4"}),e.jsx("h2",{className:"text-xl sm:text-2xl font-semibold text-gray-700 mb-2",children:"No Rooms Created Yet"}),e.jsx("p",{className:"text-gray-500",children:"Add rooms in client requirement stage"})]})})]})]})})]})})}export{de as default};
