import{e as L,n as V,f as E,h as R,r as G,j as e,N as I,B as w,t as N,u as q,o as _}from"./index-DBgPBgiq.js";import{C as z}from"./Card-wZG4gXZm.js";import{G as D}from"./GenerateWhatsappLink-BKDXB46I.js";import{A as Q,S as B}from"./AssignStaff-Cn1HeimW.js";import{R as K}from"./ResetStageButton-OANuO7IW.js";import W from"./MaterialOverviewLoading-MdxxUrUT.js";import{S as U}from"./ShareDocumentWhatsapp-D8nqMXmt.js";import{u as H,a as J,b as X}from"./materialArrivalNewApi-ZWclFPHV.js";import"./getAllUsersApi-2Erfs-tQ.js";import"./Skeleton-DujftK8I.js";import"./documentationApi-qRakpMcq.js";const Y=async({formId:s,projectId:i,deadLine:t,api:r})=>{const{data:a}=await r.put(`/materialarrivalcheck/deadline/${i}/${s}`,{deadLine:t});if(!a.ok)throw new Error(a.message);return a.data},Z=async({projectId:s,api:i})=>{const{data:t}=await i.put(`/materialarrivalcheck/completionstatus/${s}`);if(!t.ok)throw new Error(t.message);return t.data},ee=()=>{const s=["owner","staff","CTO"],{role:i}=L(),t=R(i),r=V();return E({mutationFn:async({formId:a,projectId:n,deadLine:l})=>{if(!i||!s.includes(i))throw new Error("not allowed to make this api call");if(!t)throw new Error("API instance missing");return await Y({formId:a,projectId:n,deadLine:l,api:t})},onSuccess:(a,n)=>{r.invalidateQueries({queryKey:["ordering-material",n.formId]})}})},se=()=>{const s=["owner","staff","CTO"],{role:i}=L(),t=R(i),r=V();return E({mutationFn:async({projectId:a})=>{if(!i||!s.includes(i))throw new Error("not allowed to make this api call");if(!t)throw new Error("API instance missing");return await Z({projectId:a,api:t})},onSuccess:(a,{projectId:n})=>{r.invalidateQueries({queryKey:["material-arrival",n]})}})},ae=({item:s,projectId:i,index:t})=>{var h,u,j;const{mutateAsync:r,isPending:a}=H(),[n,l]=G.useState(!1),f=async()=>{var o,p;try{await r({projectId:i,unitName:s.unitName,toggle:!(s!=null&&s.isVerified)}),N({title:"Success",description:"Verification status updated."})}catch(x){N({title:"Error",description:((p=(o=x==null?void 0:x.response)==null?void 0:o.data)==null?void 0:p.message)||x.message||"Failed to update",variant:"destructive"})}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`grid grid-cols-5 gap-4 px-4 py-4 hover:bg-gray-50 transition-colors duration-200 ${t%2===0?"bg-white":"bg-gray-25"}`,children:[e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 text-xs font-semibold",children:t+1}),e.jsx("span",{className:"font-medium text-gray-800 truncate",children:(s==null?void 0:s.unitName)||"N/A"})]})}),e.jsx("div",{className:"flex items-center",children:e.jsx("div",{className:"bg-gray-100 px-3 py-1 rounded-full",children:e.jsx("span",{className:"font-semibold text-gray-700",children:s.quantity})})}),e.jsx("div",{className:"flex items-center",children:s!=null&&s.image?e.jsxs("div",{className:"relative group cursor-pointer",onClick:()=>l(!0),children:[e.jsx("div",{className:"w-45 h-45 border-2 border-gray-200 rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-shadow duration-200",children:e.jsx("img",{src:((h=s==null?void 0:s.image)==null?void 0:h.url)||I,alt:s.image.originalName||"Material Image",className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-200"})}),e.jsx("div",{className:"absolute inset-0  bg-opacity-0 group-hover:bg-opacity-20 rounded-lg transition-all duration-200 flex items-center justify-center",children:e.jsx("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity duration-200"})})]}):e.jsx("div",{className:"w-45 h-45 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"fa-solid fa-image text-gray-400 text-lg mb-1"}),e.jsx("p",{className:"text-xs text-gray-400",children:"No Image"})]})})}),e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{className:`inline-flex items-center gap-2 px-3 py-1 rounded-full text-sm font-medium ${s.isVerified?"bg-green-100 text-green-700 border border-green-200":"bg-gray-100 text-gray-600 border border-gray-200"}`,children:[e.jsx("i",{className:`fa-solid ${s.isVerified?"fa-check-circle":"fa-clock"} text-xs`}),s.isVerified?"Verified":"Pending"]})}),e.jsx("div",{className:"flex items-center",children:e.jsxs(w,{onClick:f,disabled:a,size:"sm",className:`flex items-center gap-2 px-4 py-2 text-sm font-medium transition-colors duration-200 ${s.isVerified?"bg-orange-500 hover:bg-orange-600 text-white":"bg-green-500 hover:bg-green-600 text-white"}`,children:[a?e.jsx("i",{className:"fa-solid fa-spinner fa-spin"}):e.jsx("i",{className:`fa-solid ${s.isVerified?"fa-times":"fa-check"}`}),s.isVerified?"Unverify":"Verify"]})})]}),n&&s.image&&e.jsx("div",{className:"fixed inset-0 bg-black/70  flex items-center justify-center z-50 p-4",onClick:()=>l(!1),children:e.jsxs("div",{className:"relative w-[80vw] h-[80vh] max-w-4xl",children:[e.jsx("button",{onClick:()=>l(!1),className:"absolute -top-10 right-0 text-white hover:text-gray-300 transition-colors duration-200 z-10",children:e.jsx("i",{className:"fa-solid fa-times text-2xl"})}),e.jsx("img",{src:((u=s==null?void 0:s.image)==null?void 0:u.url)||I,alt:((j=s==null?void 0:s.image)==null?void 0:j.originalName)||"Material Image",className:"w-full h-full object-cover rounded-lg shadow-2xl",onClick:o=>o.stopPropagation()}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-black  text-white p-4 rounded-b-lg",children:[e.jsx("p",{className:"text-sm font-medium",children:s.image.originalName||"Material Image"}),e.jsx("p",{className:"text-xs text-gray-300",children:"Click outside to close"})]})]})})]})},he=()=>{var k,M,A,C,S,P;const{projectId:s,organizationId:i}=q(),{isMobile:t,openMobileSidebar:r}=_(),{data:a,isLoading:n,error:l,isError:f,refetch:h}=J(s),{mutateAsync:u,isPending:j}=X(),{mutateAsync:o,isPending:p}=ee(),{mutateAsync:x,isPending:$}=se();if(n)return e.jsx(W,{});const{timer:c,generatedLink:F}=a||{},O=async()=>{var d,v;try{await x({projectId:s}),N({description:"Completion status updated successfully",title:"Success"})}catch(g){N({title:"Error",description:((v=(d=g==null?void 0:g.response)==null?void 0:d.data)==null?void 0:v.message)||(g==null?void 0:g.message)||"Failed to update completion status",variant:"destructive"})}},m=((k=a==null?void 0:a.materialArrivalList)==null?void 0:k.length)||0,b=((A=(M=a==null?void 0:a.materialArrivalList)==null?void 0:M.filter(d=>d.isVerified))==null?void 0:A.length)||0,T=m-b,y=m>0?Math.round(b/m*100):0;return e.jsxs("div",{className:"w-full h-full flex flex-col p-2 ",children:[e.jsxs("div",{className:"flex-shrink-0 flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-4 pb-3 ",children:[e.jsxs("h2",{className:"text-2xl sm:text-2xl lg:text-2xl xl:text-3xl font-semibold text-blue-600 flex items-center",children:[t&&e.jsx("button",{onClick:r,className:"mr-3 p-2 rounded-md border-gray-300 hover:bg-gray-100",title:"Open Menu",children:e.jsx("i",{className:"fa-solid fa-bars"})}),e.jsx("i",{className:"fa-solid fa-receipt mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Material Checking"}),e.jsx("span",{className:"sm:hidden",children:"Material Check"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full sm:w-auto",children:[e.jsxs(w,{isLoading:$,onClick:O,className:"bg-green-600 hover:bg-green-700 text-white w-full sm:w-auto whitespace-nowrap",children:[e.jsx("i",{className:"fa-solid fa-circle-check mr-2"}),"Mark as Complete"]}),e.jsx(K,{projectId:s,stageNumber:9,stagePath:"materialarrivalcheck"}),!l&&e.jsx(U,{projectId:s,stageNumber:"9",className:"w-full sm:w-fit",isStageCompleted:a==null?void 0:a.status}),e.jsx(Q,{stageName:"MaterialArrivalModel",projectId:s,organizationId:i,currentAssignedStaff:(a==null?void 0:a.assignedTo)||null})]})]}),f&&e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"max-w-xl p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2",children:"⚠️ Error Occurred"}),e.jsx("p",{className:"text-red-500 text-sm mb-4",children:((S=(C=l==null?void 0:l.response)==null?void 0:C.data)==null?void 0:S.message)||"Failed to load material arrival data"}),e.jsx(w,{onClick:()=>h(),className:"bg-red-600 text-white hover:bg-red-700",children:"Retry"})]})}),!f&&e.jsxs("div",{className:"flex-1 min-h-0 overflow-y-auto space-y-4 sm:space-y-6",children:[e.jsxs(z,{className:"p-4 w-full shadow border-l-4 border-blue-600 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-3 text-blue-700 text-sm font-medium mb-2",children:[e.jsx("i",{className:"fa-solid fa-clock text-blue-500 text-lg"}),e.jsx("span",{children:"Stage Timings"})]}),e.jsx(B,{stageName:"materialarrivalcheck",completedAt:c==null?void 0:c.completedAt,projectId:s,formId:a==null?void 0:a._id,deadLine:c==null?void 0:c.deadLine,startedAt:c==null?void 0:c.startedAt,refetchStageMutate:h,deadLineMutate:o,isPending:p})]}),e.jsxs("section",{className:"w-full  rounded-xl shadow-lg border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:" bg-gradient-to-r from-slate-800 to-gray-900 p-6 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12  bg-opacity-20 rounded-lg flex items-center justify-center",children:e.jsx("i",{className:"fa-solid fa-boxes-stacked text-2xl text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold",children:"Material Verification Center"}),e.jsx("p",{className:"text-gray-300 text-sm mt-1",children:"Review and verify material arrivals"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold",children:m}),e.jsx("div",{className:"text-gray-300 text-sm",children:"Total Items"})]})]}),m>0&&e.jsxs("div",{className:"mt-6 grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-slate-600 bg-opacity-10 rounded-lg p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-emerald-500 bg-opacity-30 rounded-full flex items-center justify-center",children:e.jsx("i",{className:"fa-solid fa-check text-emerald-300 text-lg"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:b}),e.jsx("div",{className:"text-gray-300 text-sm",children:"Verified"})]})]})}),e.jsx("div",{className:"bg-slate-600 bg-opacity-10 rounded-lg p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-amber-500 bg-opacity-30 rounded-full flex items-center justify-center",children:e.jsx("i",{className:"fa-solid fa-clock text-amber-300 text-lg"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:T}),e.jsx("div",{className:"text-gray-300 text-sm",children:"Pending"})]})]})}),e.jsx("div",{className:"bg-slate-600 bg-opacity-10 rounded-lg p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-indigo-500 bg-opacity-30 rounded-full flex items-center justify-center",children:e.jsx("i",{className:"fa-solid fa-chart-line text-indigo-300 text-lg"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-2xl font-bold text-white",children:[y,"%"]}),e.jsx("div",{className:"text-gray-300 text-sm",children:"Progress"})]})]})})]}),m>0&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-300 mb-2",children:[e.jsx("span",{children:"Verification Progress"}),e.jsxs("span",{children:[y,"% Complete"]})]}),e.jsx("div",{className:"w-full bg-white bg-opacity-20 rounded-full h-2",children:e.jsx("div",{className:"bg-emerald-400 h-2 rounded-full transition-all duration-500 ease-out",style:{width:`${y}%`}})})]})]}),e.jsx("div",{className:"bg-gray-50 border-b border-gray-200",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"min-w-[800px]",children:e.jsxs("div",{className:"grid grid-cols-5 gap-4 px-6 py-4 font-semibold text-gray-700 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-hashtag text-blue-500"}),e.jsx("span",{children:"Item Name"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-calculator text-blue-500"}),e.jsx("span",{children:"Quantity"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-image text-blue-500"}),e.jsx("span",{children:"Image"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-shield-check text-blue-500"}),e.jsx("span",{children:"Status"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-cog text-blue-500"}),e.jsx("span",{children:"Action"})]})]})})})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"min-w-[800px]",children:((P=a==null?void 0:a.materialArrivalList)==null?void 0:P.length)>0?e.jsx("div",{className:"divide-y divide-gray-100",children:a.materialArrivalList.map((d,v)=>e.jsx(ae,{item:d,projectId:s,index:v},d._id))}):e.jsx("div",{className:"p-12 text-center bg-gray-50",children:e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-6 bg-gradient-to-br from-gray-100 to-gray-200 rounded-full flex items-center justify-center shadow-inner",children:e.jsx("i",{className:"fa-solid fa-box-open text-3xl text-gray-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-600 mb-3",children:"No Materials Found"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Material data will appear here once available. Check back later or contact your administrator."}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-gray-400",children:[e.jsx("i",{className:"fa-solid fa-info-circle"}),e.jsx("span",{children:"Materials are automatically synced from your project"})]})]})})})})]}),e.jsx("section",{className:"mt-4",children:e.jsx(D,{projectId:s,context:"Material",stage:"materialarrival",data:F,isPending:j,generateLink:u})})]})]})};export{he as default};
