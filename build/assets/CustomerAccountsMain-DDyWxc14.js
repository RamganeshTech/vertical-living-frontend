import{b as O,j as e,a as $,e as M,u as V,r as u,O as G}from"./index-BZjlY-2Z.js";import{a as H,b as Y}from"./customerAccountApi-B73ZJ9J6.js";import{B as S}from"./Button-BGBzZFjk.js";import{B as q}from"./Breadcrumb-CzLdyNJ_.js";import{d as J}from"./dateFormator-BGKi5rfZ.js";import{t as E}from"./toast-BSC5QTk1.js";import{S as K}from"./StageGuide-BGPpzdDF.js";import"./useQuery-Coz1VCY2.js";import"./useMutation-BRRIqsxx.js";import"./useInfiniteQuery--LmPAkvr.js";import"./roleCheck-DuKNZHKs.js";const Q=({customer:a,index:h,onView:o,onDelete:f,isDeleting:i})=>{var c,p,g;const l=a.firstName,{role:b,permission:d}=O(),N=b==="owner"||((c=d==null?void 0:d.customer)==null?void 0:c.delete),m=((p=a==null?void 0:a.phone)==null?void 0:p.work)||null,t=((g=a==null?void 0:a.phone)==null?void 0:g.mobile)||null;return e.jsxs("div",{className:"grid cursor-pointer grid-cols-14 gap-4 px-6 py-4 border-b border-gray-100 hover:bg-[#f9fcff] items-center transition-colors last:border-b-0",onClick:()=>o(a._id),children:[e.jsx("div",{className:"col-span-1 text-center text-gray-600 font-medium",children:h+1}),e.jsx("div",{className:"col-span-3 text-center truncate font-medium text-gray-900 flex items-center gap-2",children:l?e.jsx("span",{className:" block mx-auto",children:l}):"-"}),e.jsx("div",{className:"col-span-2 text-sm text-gray-700 truncate text-center",children:a.companyName?a.companyName:"-"}),e.jsx("div",{className:"col-span-2 text-sm text-gray-700 truncate text-center",children:a.email?a.email:"-"}),e.jsxs("div",{className:"col-span-2 text-sm text-gray-700 flex flex-col items-center gap-1",children:[m&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-phone text-gray-400"}),e.jsx("span",{children:m})]}),t&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-mobile-alt text-gray-400"}),e.jsx("span",{children:t})]}),!m&&!t&&e.jsx("span",{children:"-"})]}),e.jsxs("div",{className:"col-span-2 text-sm text-gray-600 whitespace-nowrap text-center",children:[e.jsx("i",{className:"fas fa-calendar-alt mr-2 text-gray-400"}),J(a.createdAt)]}),e.jsx("div",{className:"col-span-2 flex justify-center gap-2",children:N&&e.jsx("button",{onClick:x=>{x.stopPropagation(),f(a._id)},className:"p-2 text-red-600 hover:bg-red-100 rounded transition",disabled:i,title:"Delete Customer",children:i?e.jsx("i",{className:"fas fa-spinner fa-spin"}):e.jsx("i",{className:"fas fa-trash"})})})]})},ne=()=>{var F,B;const a=$(),h=M(),{organizationId:o}=V(),f=u.useRef(null),{role:i,permission:l}=O(),b=i==="owner"||((F=l==null?void 0:l.customer)==null?void 0:F.list),d=i==="owner"||((B=l==null?void 0:l.customer)==null?void 0:B.create),N=h.pathname.includes("/customersingle")||h.pathname.includes("/create"),m=[{label:"Account",path:`/organizations/${o}/projects/accounting`},{label:"Bills",path:`/organizations/${o}/projects/billmain`},{label:"Customer",path:`/organizations/${o}/projects/customermain`}],[t,c]=u.useState({search:"",projectId:"",sortBy:"createdAt",createdFromDate:"",createdToDate:"",sortOrder:"desc"}),[p,g]=u.useState(t.search);u.useEffect(()=>{const s=setTimeout(()=>{g(t.search)},500);return()=>clearTimeout(s)},[t.search]);const{data:x,fetchNextPage:D,hasNextPage:y,isFetchingNextPage:v,isLoading:T,isError:L,error:C,refetch:P}=H({organizationId:o||"",search:p,projectId:t.projectId||void 0,createdFromDate:t.createdFromDate||void 0,createdToDate:t.createdToDate||void 0,sortBy:t.sortBy,sortOrder:t.sortOrder,limit:20}),k=Y();u.useEffect(()=>{const s=f.current;if(!s)return;const r=()=>{const{scrollTop:j,scrollHeight:n,clientHeight:R}=s;n-j-R<100&&y&&!v&&(console.log("ðŸ“œ Loading more customers..."),D())};return s.addEventListener("scroll",r),()=>s.removeEventListener("scroll",r)},[y,v,D]);const z=async s=>{var r,j;try{await k.mutateAsync(s),E({title:"Success",description:"Customer deleted successfully"})}catch(n){E({title:"Error",description:((j=(r=n==null?void 0:n.response)==null?void 0:r.data)==null?void 0:j.message)||(n==null?void 0:n.message)||"Failed to delete the customer",variant:"destructive"})}},I=s=>{a(`customersingle/${s}`)},A=Object.values(t).filter(s=>s!==""&&s!=="createdAt"&&s!=="desc").length,_=()=>{c({search:"",projectId:"",createdFromDate:"",createdToDate:"",sortBy:"createdAt",sortOrder:"desc"})},w=(x==null?void 0:x.pages.flatMap(s=>s.data))||[];return N?e.jsx(G,{}):e.jsxs("div",{className:"space-y-4 h-full",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-users mr-3 text-blue-600"}),"Customer Accounts"]}),e.jsx(q,{paths:m})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[d&&e.jsxs(S,{onClick:()=>a("create"),children:[e.jsx("i",{className:"fas fa-plus mr-2"}),"Add Customer"]}),e.jsx("div",{className:"w-full sm:w-auto flex justify-end sm:block",children:e.jsx(K,{organizationId:o,stageName:"customer"})})]})]}),T?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("i",{className:"fas fa-spinner fa-spin text-blue-600 text-4xl"})}):L?e.jsxs("div",{className:"max-w-xl sm:min-w-[80%] mx-auto mt-4 p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2 text-xl sm:text-3xl",children:"âš ï¸ Error Occurred"}),e.jsx("p",{className:"text-red-500 mb-4 text-lg sm:text-xl",children:(C==null?void 0:C.message)||"Failed to load customers"}),e.jsx(S,{onClick:()=>P(),className:"bg-red-600 text-white px-4 py-2",children:"Retry"})]}):e.jsxs("main",{className:"flex gap-2 !max-h-[87%]",children:[e.jsx("div",{className:"xl:w-80 flex-shrink-0 !max-h-[100%] overflow-y-auto",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-filter mr-2 text-blue-600"}),"Filters"]}),A>0&&e.jsxs("button",{onClick:_,className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:["Clear All (",A,")"]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx("i",{className:"fas fa-search mr-2"}),"Search"]}),e.jsx("input",{type:"text",autoFocus:!0,placeholder:"Name, email, phone, company...",value:t.search,onChange:s=>c(r=>({...r,search:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx("i",{className:"fas fa-calendar mr-2"}),"From CreatedAt Date"]}),e.jsx("input",{type:"date",value:t.createdFromDate,onChange:s=>{c(r=>({...r,createdFromDate:s.target.value}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx("i",{className:"fas fa-calendar mr-2"}),"To CreatedAt Date"]}),e.jsx("input",{type:"date",value:t.createdToDate,onChange:s=>{c(r=>({...r,createdToDate:s.target.value}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sort By"}),e.jsxs("select",{value:t.sortBy,onChange:s=>c(r=>({...r,sortBy:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"createdAt",children:"Created Date"}),e.jsx("option",{value:"firstName",children:"First Name"}),e.jsx("option",{value:"companyName",children:"Company Name"}),e.jsx("option",{value:"email",children:"Email"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sort Order"}),e.jsxs("select",{value:t.sortOrder,onChange:s=>c(r=>({...r,sortOrder:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"desc",children:"Descending"}),e.jsx("option",{value:"asc",children:"Ascending"})]})]})]})]})}),b&&e.jsxs(e.Fragment,{children:["   ",w.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[300px] w-full bg-white rounded-xl text-center p-6",children:[e.jsx("i",{className:"fas fa-user-slash text-5xl text-blue-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-1",children:"No Customers Found"}),e.jsxs("p",{className:"text-sm text-gray-500",children:[t.search?"Try adjusting your filters to find customers.":"Looks like there are no customers yet.",e.jsx("br",{}),"Click on ",e.jsx("strong",{children:'"Add Customer"'})," to get started ðŸš€"]})]}):e.jsxs("div",{ref:f,className:"flex-1 max-h-[100%] overflow-y-auto",children:[e.jsx("div",{className:"bg-white rounded-t-xl border border-gray-200 sticky top-0 z-10",children:e.jsxs("div",{className:"grid grid-cols-14 gap-4 px-6 py-4 bg-gradient-to-r from-blue-50 to-indigo-50 font-semibold text-gray-700 text-sm",children:[e.jsx("div",{className:"col-span-1 text-center",children:"S.No"}),e.jsx("div",{className:"col-span-3 text-center",children:"Customer Name"}),e.jsx("div",{className:"col-span-2 text-center",children:"Company Name"}),e.jsx("div",{className:"col-span-2 text-center",children:"Email"}),e.jsx("div",{className:"col-span-2 text-center",children:"Phone"}),e.jsx("div",{className:"col-span-2 text-center",children:"Created At"}),e.jsx("div",{className:"col-span-2 text-center",children:"Actions"})]})}),e.jsx("div",{className:"bg-white rounded-b-xl border-x border-b border-gray-200",children:w.map((s,r)=>e.jsx(Q,{customer:s,index:r,onView:()=>I(s._id),onDelete:()=>z(s._id),isDeleting:k.isPending},s._id))}),v&&e.jsx("div",{className:"flex justify-center py-8",children:e.jsxs("div",{className:"flex items-center gap-2 text-blue-600",children:[e.jsx("i",{className:"fas fa-spinner fa-spin text-2xl"}),e.jsx("span",{className:"text-sm font-medium",children:"Loading more customers..."})]})}),!y&&w.length>0&&e.jsx("div",{className:"flex justify-center py-6",children:e.jsxs("p",{className:"text-gray-400 text-sm font-medium",children:[e.jsx("i",{className:"fas fa-check-circle mr-2"}),"You've reached the end of the list"]})})]})]})]})]})};export{ne as default};
