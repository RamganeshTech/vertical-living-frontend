import{a as y,j as e,r as P,u as A,f as O,x as R,O as T,B as d,t as w}from"./index-DCvjwNGU.js";import{u as $,a as F,b as B}from"./costEstimationApi-CIkSWbg2.js";import{R as I}from"./ResetStageButton-yyHG6Jc9.js";import{C as D}from"./Card-D6Sc2MI-.js";import{A as G,S as _}from"./AssignStaff-BckChmVR.js";import q from"./MaterialOverviewLoading-DwCp8CV2.js";import{S as z}from"./ShareDocumentWhatsapp-ClvcSIIS.js";import"./getAllUsersApi-CQ55Q7DU.js";import"./Skeleton-C14joy6B.js";import"./documentationApi-DRaFe_FG.js";import"./requirementFormApi-CIZP8QFV.js";const V=({room:t,projectId:a,organizationId:l})=>{var n;const o=y();return e.jsxs("div",{onClick:()=>o(`/${l}/projectdetails/${a}/costestimation/roomdetails/${t._id}`),className:"cursor-pointer border-l-6 border-blue-600 shadow-md hover:border-blue-400 transition-all duration-200 rounded-lg p-5 bg-white hover:shadow-lg flex items-center gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-1",children:t.name}),e.jsxs("p",{className:"text-sm text-blue-500",children:["No of Fields: ",((n=t.materials)==null?void 0:n.length)||0]})]}),e.jsx("div",{className:"text-sm text-blue-600 font-medium underline hover:no-underline",children:"View →"})]})},W=({data:t})=>{if(!t)return null;const{totalMaterialCost:a,totalLabourCost:l,totalEstimation:o}=t;return e.jsxs("section",{className:"mt-6 w-full",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-4",children:"Cost Estimation Summary"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white shadow rounded-lg p-4 border-l-4 border-blue-600",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-500 mb-1",children:"Total Material Cost"}),e.jsxs("p",{className:"text-xl font-bold text-gray-800",children:["₹",(a==null?void 0:a.toLocaleString())||0]})]}),e.jsxs("div",{className:"bg-white shadow rounded-lg p-4 border-l-4 border-green-600",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-500 mb-1",children:"Total Labour Cost"}),e.jsxs("p",{className:"text-xl font-bold text-gray-800",children:["₹",(l==null?void 0:l.toLocaleString())||0]})]}),e.jsxs("div",{className:"bg-white shadow rounded-lg p-4 border-l-4 border-purple-600",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-500 mb-1",children:"Grand Total Estimation"}),e.jsxs("p",{className:"text-xl font-bold text-gray-800",children:["₹",(o==null?void 0:o.toLocaleString())||0]})]})]})]})},H=P.memo(W),ie=()=>{var g,f,h,p,b,j;const{projectId:t,organizationId:a}=A(),{isMobile:l,openMobileSidebar:o}=O(),n=R(),c=y(),{data:s,isLoading:x,isError:v,error:i,refetch:u}=$(t),{mutateAsync:C,isPending:S}=F(),{mutateAsync:E,isPending:L}=B(),k=async()=>{var r,N;try{await E({projectId:t}),w({description:"Completion status updated successfully",title:"Success"}),c("../paymentconfirmation")}catch(m){w({title:"Error",description:((N=(r=m==null?void 0:m.response)==null?void 0:r.data)==null?void 0:N.message)||m.message||"Failed to update completion status",variant:"destructive"})}},M=n.pathname.includes("/roomdetails");return x?e.jsx(q,{}):e.jsx("div",{className:"mx-auto w-full  max-h-full overflow-y-auto custom-scrollbar",children:M?e.jsx(T,{}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4 mb-6",children:[e.jsxs("h2",{className:"text-2xl sm:text-3xl font-semibold text-blue-600 flex items-center",children:[l&&e.jsx("button",{onClick:o,className:"mr-3 p-2 rounded-md border-gray-300 hover:bg-gray-100",title:"Open Menu",children:e.jsx("i",{className:"fa-solid fa-bars"})}),e.jsx("i",{className:"fa-solid fa-money-bill-1-wave mr-2"})," Cost Estimation"]}),e.jsxs("div",{className:"!w-[100%] sm:!w-[50%] flex flex-col sm:flex-row gap-3 justify-end",children:[e.jsx("div",{className:"flex flex-wrap  gap-2 justify-end",children:e.jsxs(d,{isLoading:L,onClick:k,className:"bg-green-600 hover:bg-green-700 text-white flex-1 sm:flex-initial min-w-max",children:[e.jsx("i",{className:"fa-solid fa-circle-check mr-2"}),"Mark Complete"]})}),e.jsxs("div",{className:"flex flex-wrap sm:flex-nowrap  gap-2 justify-end",children:[e.jsx(I,{projectId:t,stageNumber:6,stagePath:"costestimation",className:"flex-1 sm:flex-initial min-w-max"}),!i&&e.jsx(z,{projectId:t,stageNumber:"6",className:"w-full sm:w-fit",isStageCompleted:s==null?void 0:s.status}),e.jsx(G,{stageName:"CostEstimation",projectId:t,organizationId:a,currentAssignedStaff:(s==null?void 0:s.assignedTo)||null,className:"flex-1 sm:flex-initial min-w-max"})]})]})]}),i&&e.jsxs("div",{className:"max-w-xl mx-auto p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center mb-6",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2",children:"⚠️ Error Occurred"}),e.jsx("p",{className:"text-red-500 text-sm mb-4",children:((f=(g=i==null?void 0:i.response)==null?void 0:g.data)==null?void 0:f.message)||(i==null?void 0:i.message)||"Failed to load cost estimation data"}),e.jsx(d,{onClick:()=>u(),className:"bg-red-600 text-white px-4 py-2",children:"Retry"})]}),!i&&e.jsxs(e.Fragment,{children:[e.jsxs(D,{className:"p-4 mb-6 w-full shadow border-l-4 border-blue-600 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-3 text-blue-700 text-sm font-medium mb-2",children:[e.jsx("i",{className:"fa-solid fa-clock text-blue-500 text-lg"}),e.jsx("span",{children:"Stage Timings"})]}),e.jsx(_,{completedAt:(h=s==null?void 0:s.timer)==null?void 0:h.completedAt,stageName:"costestimation",formId:s==null?void 0:s._id,projectId:t,deadLine:(p=s==null?void 0:s.timer)==null?void 0:p.deadLine,startedAt:(b=s==null?void 0:s.timer)==null?void 0:b.startedAt,refetchStageMutate:u,deadLineMutate:C,isPending:S})]}),e.jsxs("section",{className:"mb-6 ",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start md:items-center gap-4 mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"Material Cost Estimation"}),e.jsxs(d,{className:"bg-blue-600 text-white px-2 lg:px-4 py-2 w-full sm:w-auto",onClick:()=>c(`/${a}/projectdetails/${t}/costestimation/roomdetails/labour`),children:["Labour Cost Estimation ",e.jsx("i",{className:"ml-2 fa-solid fa-arrow-up-right-from-square"})]})]}),e.jsx("div",{className:"max-h-[100%] grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:(j=s==null?void 0:s.materialEstimation)==null?void 0:j.map(r=>e.jsx(V,{room:r,projectId:t,organizationId:a},r.key))})]}),!x&&!v&&s&&e.jsx(H,{data:s})]})]})})};export{ie as default};
