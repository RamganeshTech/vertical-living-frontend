import{a as we,u as Fe,b as Ie,r as n,j as e,B as h,I as o,t as f}from"./index-hYGmCEO1.js";import{b as ke,c as Pe,d as Se}from"./modularUnitNewApi-lIopbgmD.js";import{C,b as w,d as F,a as I}from"./Card-ChYAICVg.js";import{L as c}from"./Label-hkBviWcw.js";import{T as W}from"./TextArea-BRgMMCHU.js";const qe=({mode:d,unitId:N})=>{var O,T;const k=we(),{organizationId:_}=Fe(),{mutateAsync:J,isPending:K}=ke(),{mutateAsync:Q,isPending:X}=Pe(),{data:l,isLoading:Y}=Se(d==="edit"&&N?N:""),{role:P,permission:x}=Ie(),Z=P==="owner"||((O=x==null?void 0:x.modularunit)==null?void 0:O.create),ee=P==="owner"||((T=x==null?void 0:x.modularunit)==null?void 0:T.edit),[S,q]=n.useState([{key:"no",label:"No"},{key:"partCode",label:"Part Code"},{key:"partName",label:"Part Name"},{key:"l",label:"L"},{key:"w",label:"W"},{key:"t",label:"T"},{key:"coreMaterial",label:"Core Material"},{key:"externalFinish",label:"External Finish"},{key:"internalFinish",label:"Internal Finish"},{key:"grain",label:"Grain"}]),A={productName:"",serialNo:"",category:"",description:"",dimention:{height:0,width:0,depth:0},totalAreaSqFt:"",materialsNeeded:"",fabricationCost:"",timeRequired:"",attributes:[],parts:[{no:1,partCode:"",partName:"",l:0,w:0,t:0,coreMaterial:"",externalFinish:"",internalFinish:"",grain:""}]},[i,m]=n.useState(A),[R,te]=n.useState([]),[D,U]=n.useState([]),[E,se]=n.useState([]),[L,M]=n.useState([]),[V,ae]=n.useState([]),[$,z]=n.useState([]),[j,re]=n.useState([]),[ie,le]=n.useState(!1),[ne,ce]=n.useState(!1),[de,oe]=n.useState(!1),[me,ue]=n.useState(!1),[b,B]=n.useState("");n.useEffect(()=>{var t,s,a,r,u,H;d==="edit"&&l&&(m({serialNo:l.serialNo||"",category:l.category||"",description:l.description||"",dimention:{height:((t=l.dimention)==null?void 0:t.height)||0,width:((s=l.dimention)==null?void 0:s.width)||0,depth:((a=l.dimention)==null?void 0:a.depth)||0},totalAreaSqFt:((r=l.totalAreaSqFt)==null?void 0:r.toString())||"",materialsNeeded:l.materialsNeeded||"",fabricationCost:((u=l.fabricationCost)==null?void 0:u.toString())||"",timeRequired:((H=l.timeRequired)==null?void 0:H.toString())||"",attributes:l.attributes||[],parts:l.parts||[]}),l.productImages&&U(l.productImages.map(g=>g.url)),l["2dImages"]&&M(l["2dImages"].map(g=>g.url)),l["3dImages"]&&z(l["3dImages"].map(g=>g.url)))},[d,l]);const p=(t,s)=>{m(a=>({...a,[t]:s}))},y=(t,s)=>{m(a=>({...a,dimention:{...a.dimention,[t]:s}}))},xe=t=>{const s=Array.from(t.target.files||[]);te(s);const a=s.map(r=>URL.createObjectURL(r));U(a),d==="edit"&&le(!0)},pe=t=>{const s=Array.from(t.target.files||[]);se(s);const a=s.map(r=>URL.createObjectURL(r));M(a),d==="edit"&&ce(!0)},he=t=>{const s=Array.from(t.target.files||[]);ae(s);const a=s.map(r=>URL.createObjectURL(r));z(a),d==="edit"&&oe(!0)},ge=t=>{const s=Array.from(t.target.files||[]);re(s),d==="edit"&&ue(!0)},fe=()=>{const t=prompt("Enter new field name (e.g., Edge Banding):");if(!t)return;const s=t.toLowerCase().replace(/\s+/g,"_");q(a=>[...a,{key:s,label:t}]),m(a=>({...a,parts:a.parts.map(r=>({...r,[s]:""}))}))},je=t=>{t!=="no"&&(q(s=>s.filter(a=>a.key!==t)),m(s=>({...s,parts:s.parts.map(a=>{const r={...a};return delete r[t],r})})))},Ne=(t,s,a)=>{m(r=>{const u=[...r.parts];return u[t]={...u[t],[s]:a},{...r,parts:u}})},be=()=>{m(t=>({...t,parts:[...t.parts,{no:t.parts.length+1,partCode:"",partName:"",l:0,w:0,t:0,coreMaterial:"",externalFinish:"",internalFinish:"",grain:""}]}))},ye=t=>{m(s=>({...s,parts:s.parts.filter((a,r)=>r!==t)}))},G=()=>{b.trim()&&(m(t=>({...t,attributes:[...t.attributes,b.trim()]})),B(""))},ve=t=>{m(s=>({...s,attributes:s.attributes.filter((a,r)=>r!==t)}))},Ce=async t=>{var a,r;if(t.preventDefault(),!i.category){f({title:"Error",description:"Category is required",variant:"destructive"});return}if(!i.fabricationCost||Number(i.fabricationCost)<=0){f({title:"Error",description:"Valid fabrication cost is required",variant:"destructive"});return}const s={...i,dimention:{height:i.dimention.height||void 0,width:i.dimention.width||void 0,depth:i.dimention.depth||void 0},totalAreaSqFt:i.totalAreaSqFt||void 0,fabricationCost:i.fabricationCost||void 0,timeRequired:i.timeRequired||void 0,parts:JSON.stringify(i.parts)};try{d==="create"?(await J({organizationId:_,formValues:s,productImages:R,images2d:E,images3d:V,cutlistDoc:j}),f({title:"Success",description:"Product created successfully!"}),m(A)):(await Q({unitId:N,formValues:s,productImages:R,images2d:E,images3d:V,cutlistDoc:j,replaceProductImages:ie,replace2dImages:ne,replace3dImages:de,replaceCutlistDoc:me}),f({title:"Success",description:"Product updated successfully!"}))}catch(u){f({title:"Error",description:((r=(a=u==null?void 0:u.response)==null?void 0:a.data)==null?void 0:r.message)||`Failed to ${d} product`,variant:"destructive"})}};if(d==="edit"&&Y)return e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx("i",{className:"fas fa-spinner fa-spin text-4xl text-gray-400"})});const v=K||X;return e.jsx("div",{className:"min-h-full bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-full mx-auto",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>k(-1),className:"flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-arrow-left"}),"Back"]}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:d==="create"?"Create New Product":"Edit Product"})]})}),e.jsxs("form",{onSubmit:Ce,className:"space-y-6",children:[e.jsxs(C,{children:[e.jsx(w,{children:e.jsxs(F,{className:"flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-images text-blue-600"}),"Product Images"]})}),e.jsx(I,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"productImages",className:"text-sm font-medium",children:[e.jsx("i",{className:"fas fa-image mr-1 text-pink-600"}),"Product Images"]}),e.jsx(o,{id:"productImages",type:"file",accept:"image/*",multiple:!0,onChange:xe,className:"cursor-pointer text-xs"}),D.length>0&&e.jsx("div",{className:"grid grid-cols-3 gap-2 mt-2",children:D.map((t,s)=>e.jsx("div",{className:"relative aspect-square rounded overflow-hidden border",children:e.jsx("img",{src:t,alt:`Product ${s+1}`,className:"w-full h-full object-cover"})},s))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"images2d",className:"text-sm font-medium",children:[e.jsx("i",{className:"fas fa-draw-polygon mr-1 text-cyan-600"}),"2D Images"]}),e.jsx(o,{id:"images2d",type:"file",accept:"image/*",multiple:!0,onChange:pe,className:"cursor-pointer text-xs"}),L.length>0&&e.jsx("div",{className:"grid grid-cols-3 gap-2 mt-2",children:L.map((t,s)=>e.jsx("div",{className:"relative aspect-square rounded overflow-hidden border border-cyan-200",children:e.jsx("img",{src:t,alt:`2D ${s+1}`,className:"w-full h-full object-cover"})},s))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"images3d",className:"text-sm font-medium",children:[e.jsx("i",{className:"fas fa-cube mr-1 text-indigo-600"}),"3D Images"]}),e.jsx(o,{id:"images3d",type:"file",accept:"image/*",multiple:!0,onChange:he,className:"cursor-pointer text-xs"}),$.length>0&&e.jsx("div",{className:"grid grid-cols-3 gap-2 mt-2",children:$.map((t,s)=>e.jsx("div",{className:"relative aspect-square rounded overflow-hidden border border-indigo-200",children:e.jsx("img",{src:t,alt:`3D ${s+1}`,className:"w-full h-full object-cover"})},s))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"images3d",className:"text-sm font-medium",children:[e.jsx("i",{className:"fas fa-file mr-1 text-indigo-600"}),"Cutlist Document"]}),e.jsx(o,{id:"cutlistdoc",type:"file",accept:"pdf/*",multiple:!0,onChange:ge,className:"cursor-pointer text-xs"}),j.length>0&&e.jsx("div",{className:"mt-2 space-y-1",children:j.map((t,s)=>e.jsxs("p",{className:"text-xs text-gray-500 truncate",children:[e.jsx("i",{className:"far fa-file-pdf mr-1 text-red-500"}),t.name]},s))})]})]})})]}),e.jsxs(C,{children:[e.jsx(w,{children:e.jsxs(F,{className:"flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-info-circle text-blue-600"}),"Product Details"]})}),e.jsxs(I,{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"category",children:["Category ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(o,{id:"Category",placeholder:"Enter Category",value:i.category,onChange:t=>p("category",t.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"fabricationCost",children:["Fabrication Cost (â‚¹) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(o,{id:"fabricationCost",type:"number",placeholder:"Enter fabrication cost",value:i.fabricationCost,onChange:t=>p("fabricationCost",t.target.value),required:!0})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-ruler-combined text-purple-600"}),"Dimensions (mm)"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{htmlFor:"height",className:"text-xs text-gray-600",children:"Height"}),e.jsx(o,{id:"height",type:"number",placeholder:"H",value:i.dimention.height||"",onChange:t=>y("height",+t.target.value),className:"text-sm"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{htmlFor:"width",className:"text-xs text-gray-600",children:"Width"}),e.jsx(o,{id:"width",type:"number",placeholder:"W",value:i.dimention.width||"",onChange:t=>y("width",+t.target.value),className:"text-sm"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{htmlFor:"depth",className:"text-xs text-gray-600",children:"Depth"}),e.jsx(o,{id:"depth",type:"number",placeholder:"D",value:i.dimention.depth||"",onChange:t=>y("depth",+t.target.value),className:"text-sm"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"timeRequired",children:"Time Required (days)"}),e.jsx(o,{id:"timeRequired",type:"number",placeholder:"Enter time required",value:i.timeRequired,onChange:t=>p("timeRequired",t.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"totalAreaSqFt",children:"Total Area (sq ft)"}),e.jsx(o,{id:"totalAreaSqFt",type:"number",placeholder:"Enter total area",value:i.totalAreaSqFt,onChange:t=>p("totalAreaSqFt",t.target.value)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"materialsNeeded",children:"Materials Needed"}),e.jsx(W,{id:"materialsNeeded",placeholder:"Enter materials needed",value:i.materialsNeeded,onChange:t=>p("materialsNeeded",t.target.value),rows:2,className:"text-sm"})]}),e.jsxs(C,{className:"!shadow-none !p-0",children:[e.jsxs(w,{className:"flex !p-0 flex-row items-center justify-between",children:[e.jsxs(F,{className:"text-sm font-bold flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-th-list text-green-600"}),"Cutlist Details"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(h,{type:"button",size:"sm",variant:"outline",onClick:fe,children:[e.jsx("i",{className:"fas fa-columns mr-2"})," Add Field"]}),e.jsxs(h,{type:"button",size:"sm",variant:"outline",onClick:be,children:[e.jsx("i",{className:"fas fa-plus mr-2"})," Add Row"]})]})]}),e.jsx(I,{className:"!p-2 overflow-x-auto border-t border-gray-300",children:e.jsxs("table",{className:"w-full text-left border-collapse min-w-[1000px]",children:[e.jsx("thead",{className:"bg-gray-50 text-[10px] uppercase text-gray-600",children:e.jsxs("tr",{children:[S.map((t,s)=>e.jsx("th",{className:`p-2 border-b border-r bg-blue-50 border-blue-100 text-[11px] font-bold uppercase tracking-wider text-blue-700 relative group
                                                             ${s===0?"rounded-tl-xl":""}
                                                                       
                                                            `,children:e.jsxs("div",{className:"flex items-center justify-between",children:[t.label,t.key!=="no"&&e.jsx("button",{type:"button",onClick:()=>je(t.key),className:"ml-2 text-red-500 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("i",{className:"fas fa-times-circle"})})]})},t.key)),e.jsx("th",{className:"p-2 border-b rounded-tr-xl border-blue-100 text-[11px] font-bold uppercase tracking-wider text-blue-700 text-center bg-blue-50",children:"Action"})]})}),e.jsx("tbody",{className:"text-xs",children:i.parts.map((t,s)=>e.jsxs("tr",{className:"hover:bg-blue-50/40 transition-colors group",children:[S.map(a=>e.jsx("td",{className:"p-0 border border-r border-blue-200",children:a.key==="no"?e.jsx("div",{className:"text-center font-medium p-2",children:s+1}):e.jsx("input",{type:["l","w","t"].includes(a.key)?"number":"text",value:t[a.key]||"",onChange:r=>Ne(s,a.key,r.target.value),className:`w-full p-3 bg-transparent outline-none transition-all
                                                                       
                                                                            focus:bg-white focus:ring-2 focus:ring-inset focus:ring-blue-500 cursor-text
                                                                        `})},a.key)),e.jsx("td",{className:"p-1 border border-blue-200 text-center",children:e.jsx("button",{type:"button",onClick:()=>ye(s),className:"p-2 cursor-pointer text-slate-600 hover:text-red-500 hover:bg-red-50 rounded-full transition-all",children:e.jsx("i",{className:"fas fa-trash"})})})]},s))})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-tags text-orange-600"}),"Attributes"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{placeholder:"Add attribute (e.g., modern, wooden)",value:b,onChange:t=>B(t.target.value),onKeyPress:t=>{t.key==="Enter"&&(t.preventDefault(),G())},className:"text-sm flex-1"}),e.jsx(h,{type:"button",onClick:G,variant:"outline",size:"sm",className:"px-3",children:e.jsx("i",{className:"fas fa-plus"})})]}),i.attributes.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1.5 mt-2",children:i.attributes.map((t,s)=>e.jsxs("span",{className:"px-2 py-1 bg-blue-50 text-blue-700 rounded-full text-xs flex items-center gap-1.5",children:[t,e.jsx("button",{type:"button",onClick:()=>ve(s),className:"hover:text-red-600 transition-colors",children:e.jsx("i",{className:"fas fa-times text-[10px]"})})]},s))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"description",children:"Description"}),e.jsx(W,{id:"description",placeholder:"Enter product description",value:i.description,onChange:t=>p("description",t.target.value),rows:3,className:"text-sm"})]})]})]}),(Z||ee)&&e.jsxs("div",{className:"flex items-center justify-end gap-4 sticky bottom-0 bg-white p-4  rounded-lg shadow-lg",children:[e.jsxs(h,{type:"button",variant:"outline",onClick:()=>k(-1),disabled:v,children:[e.jsx("i",{className:"fas fa-times mr-2"}),"Cancel"]}),e.jsx(h,{type:"submit",isLoading:v,className:"min-w-[150px]",children:v?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin mr-2"}),d==="create"?"Creating...":"Updating..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:`fas ${d==="create"?"fa-plus":"fa-save"} mr-2`}),d==="create"?"Create Product":"Update Product"]})})]})]})]})})},Le=()=>e.jsxs("main",{className:"max-h-full overflow-y-auto",children:[e.jsx(qe,{mode:"create"}),";"]});export{Le as default};
