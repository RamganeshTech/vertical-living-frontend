import{j as e,u as I,a as L,b as P,r as d,O as z}from"./index-C1DtYOG4.js";import{B as O}from"./Button-D6HVPia8.js";import{t as S}from"./toast-BSC5QTk1.js";import{B as R}from"./Breadcrumb-C3Nh5JEi.js";import{u as G,a as _}from"./salesOrderApi-BtwBaWzv.js";import{d as D}from"./dateFormator-BGKi5rfZ.js";import"./roleCheck-vyRiFK58.js";import"./useQuery-DD9aZBjN.js";import"./useMutation-BgVKkKtF.js";import"./useInfiniteQuery-4I03x6LQ.js";const $=({salesData:t,index:n,handleView:o,handleDelete:i,deleteSalesMutation:m})=>{var x,r;return e.jsxs("div",{className:"grid cursor-pointer grid-cols-12 gap-4 px-6 py-4 border-b border-gray-100 hover:bg-[#f9fcff] transition-colors items-center last:border-b-0",onClick:()=>o(t._id),children:[e.jsx("div",{className:"col-span-1 text-center text-gray-600 font-medium",children:n+1}),e.jsx("div",{className:"col-span-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-user text-blue-600 text-sm"}),e.jsx("span",{className:"font-medium text-gray-900 truncate",children:t.customerName||"N/A"})]})}),e.jsx("div",{className:"col-span-2",children:e.jsx("span",{className:"fas fa-calendar-alt text-gray-400 mr-2",children:D(t.salesOrderDate)||"N/A"})}),e.jsxs("div",{className:"col-span-2 text-gray-600 text-sm",children:[e.jsx("i",{className:"fas fa-calendar-alt text-gray-400 mr-2"}),D(t.createdAt)]}),e.jsxs("div",{className:"col-span-2 font-semibold text-green-600",children:["â‚¹",((x=t.grandTotal)==null?void 0:x.toFixed(2))||"0.00"]}),e.jsx("div",{className:"col-span-1 text-center",children:e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium",children:((r=t.items)==null?void 0:r.length)||0})}),e.jsx("div",{className:"col-span-1 flex justify-center gap-2",children:e.jsx("button",{onClick:l=>{l.stopPropagation(),i(t._id)},disabled:m.isPending,className:"p-2 cursor-pointer text-red-600 hover:bg-red-100 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Delete salesData",children:m.isPending?e.jsx("i",{className:"fas fa-spinner fa-spin"}):e.jsx("i",{className:"fas fa-trash"})})})]})},X=()=>{const t=I(),n=L(),{organizationId:o}=P(),i=d.useRef(null),m=[{label:"Account",path:`/organizations/${o}/projects/accounting`},{label:"Sales Order",path:`/organizations/${o}/projects/salesordermain`}],x=n.pathname.includes("/salessingle")||n.pathname.includes("/create"),[r,l]=d.useState({search:"",customerId:"",fromSalesOrderDate:"",toSalesOrderDate:"",createdFromDate:"",createdToDate:"",sortBy:"createdAt",sortOrder:"desc"}),[w,C]=d.useState(r.search);d.useEffect(()=>{const s=setTimeout(()=>{C(r.search)},500);return()=>clearTimeout(s)},[r.search]);const{data:f,fetchNextPage:j,hasNextPage:h,isFetchingNextPage:g,isLoading:F,isError:k,error:p,refetch:N}=G({organizationId:o||"",customerId:r.customerId||void 0,limit:10,fromSalesOrderDate:r.fromSalesOrderDate||void 0,toSalesOrderDate:r.toSalesOrderDate||void 0,createdFromDate:r.createdFromDate||void 0,createdToDate:r.createdToDate||void 0,search:w||void 0,sortBy:r.sortBy||void 0,sortOrder:r.sortOrder||void 0}),v=_();d.useEffect(()=>{const s=i.current;if(!s)return;const a=()=>{const{scrollTop:u,scrollHeight:c,clientHeight:E}=s;c-u-E<100&&h&&!g&&(console.log("ðŸ“œ Loading more orders..."),j())};return s.addEventListener("scroll",a),()=>s.removeEventListener("scroll",a)},[h,g,j]);const A=async s=>{var a,u;try{await v.mutateAsync({salesId:s}),N(),S({title:"Success",description:"Order deleted successfully"})}catch(c){S({title:"Error",description:((u=(a=c==null?void 0:c.response)==null?void 0:a.data)==null?void 0:u.message)||(c==null?void 0:c.message)||"Failed to delete the Order",variant:"destructive"})}},T=s=>{t(`salessingle/${s}`)},y=Object.values(r).filter(s=>s!==""&&s!=="createdAt"&&s!=="desc").length,B=()=>{l({search:"",customerId:"",fromSalesOrderDate:"",toSalesOrderDate:"",createdFromDate:"",createdToDate:"",sortBy:"createdAt",sortOrder:"desc"})},b=(f==null?void 0:f.pages.flatMap(s=>s.data))||[];return x?e.jsx(z,{}):e.jsxs("div",{className:"space-y-0 h-full",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-file-invoice mr-3 text-blue-600"}),"Sales Order"]}),e.jsx(R,{paths:m})]}),e.jsxs(O,{onClick:()=>t("create"),children:[e.jsx("i",{className:"fas fa-plus mr-2"}),"Create Order"]})]}),F?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("i",{className:"fas fa-spinner fa-spin text-blue-600 text-4xl"})}):k?e.jsxs("div",{className:"max-w-xl sm:min-w-[80%] mx-auto mt-4 p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2 text-xl sm:text-3xl",children:"âš ï¸ Error Occurred"}),e.jsx("p",{className:"text-red-500 mb-4 text-lg sm:text-xl",children:(p==null?void 0:p.message)||"Failed to load orders"}),e.jsx(O,{onClick:()=>N(),className:"bg-red-600 text-white px-4 py-2",children:"Retry"})]}):e.jsxs("main",{className:"flex gap-2 !max-h-[90%]",children:[e.jsx("div",{className:"xl:w-80 flex-shrink-0 !max-h-[100%] overflow-y-auto",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-filter mr-2 text-blue-600"}),"Filters"]}),y>0&&e.jsxs("button",{onClick:B,className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:["Clear All (",y,")"]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx("i",{className:"fas fa-search mr-2"}),"Search"]}),e.jsx("input",{type:"text",autoFocus:!0,placeholder:"customer name",value:r.search,onChange:s=>l(a=>({...a,search:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx("i",{className:"fas fa-calendar mr-2"}),"From CreatedAt Date"]}),e.jsx("input",{type:"date",value:r.createdFromDate,onChange:s=>{l(a=>({...a,createdFromDate:s.target.value}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx("i",{className:"fas fa-calendar mr-2"}),"To CreatedAt Date"]}),e.jsx("input",{type:"date",value:r.createdToDate,onChange:s=>{l(a=>({...a,createdToDate:s.target.value}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx("i",{className:"fas fa-calendar mr-2"}),"From Sales Order Date"]}),e.jsx("input",{type:"date",value:r.fromSalesOrderDate,onChange:s=>{l(a=>({...a,fromSalesOrderDate:s.target.value}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx("i",{className:"fas fa-calendar mr-2"}),"To Sales Order Date"]}),e.jsx("input",{type:"date",value:r.toSalesOrderDate,onChange:s=>{l(a=>({...a,toSalesOrderDate:s.target.value}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sort By"}),e.jsxs("select",{value:r.sortBy,onChange:s=>{l(a=>({...a,sortBy:s.target.value}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"createdAt",children:"Created Date"}),e.jsx("option",{value:"sale",children:"Sales Date"}),e.jsx("option",{value:"grandTotal",children:"Grand Total"}),e.jsx("option",{value:"customerName",children:"Customer Name"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sort Order"}),e.jsxs("select",{value:r.sortOrder,onChange:s=>{l(a=>({...a,sortOrder:s.target.value}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"desc",children:"Descending"}),e.jsx("option",{value:"asc",children:"Ascending"})]})]})]})]})}),b.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[300px] w-full bg-white rounded-xl text-center p-6",children:[e.jsx("i",{className:"fas fa-file-invoice text-5xl text-blue-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-1",children:"No Sales Order Found"}),e.jsxs("p",{className:"text-sm text-gray-500",children:[r.search||r.customerId?"Try adjusting your filters to find orders.":"Looks like there are no orders yet.",e.jsx("br",{}),"Click on ",e.jsx("strong",{children:"Create Order"})," to get started ðŸš€"]})]}):e.jsxs("div",{ref:i,className:"flex-1 !max-h-[100%] overflow-y-auto",children:[e.jsx("div",{className:"bg-white rounded-t-xl border border-gray-200 sticky top-0 z-10",children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 px-6 py-4 bg-gradient-to-r from-blue-50 to-indigo-50 font-semibold text-gray-700 text-sm",children:[e.jsx("div",{className:"col-span-1 text-center",children:"S.No"}),e.jsx("div",{className:"col-span-3",children:"Customer Name"}),e.jsx("div",{className:"col-span-2",children:"Sales Date"}),e.jsx("div",{className:"col-span-2",children:"Created At"}),e.jsx("div",{className:"col-span-2",children:"Grand Total"}),e.jsx("div",{className:"col-span-1 text-center",children:"Items"}),e.jsx("div",{className:"col-span-1 text-center",children:"Actions"})]})}),e.jsx("div",{className:"bg-white rounded-b-xl border-x border-b border-gray-200",children:b.map((s,a)=>e.jsx($,{salesData:s,index:a,handleView:T,handleDelete:A,deleteSalesMutation:v},s._id))}),g&&e.jsx("div",{className:"flex justify-center py-8",children:e.jsxs("div",{className:"flex items-center gap-2 text-blue-600",children:[e.jsx("i",{className:"fas fa-spinner fa-spin text-2xl"}),e.jsx("span",{className:"text-sm font-medium",children:"Loading more orders..."})]})}),!h&&b.length>0&&e.jsx("div",{className:"flex justify-center py-6",children:e.jsxs("p",{className:"text-gray-400 text-sm font-medium",children:[e.jsx("i",{className:"fas fa-check-circle mr-2"}),"You've reached the end of the list"]})})]})]})]})};export{X as default};
