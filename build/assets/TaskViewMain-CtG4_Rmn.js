import{g as O,j as e,B as d,t as n,u as V,h as L,a as H,r as b,i as P,k as B,l as q,I as N}from"./index-BO7-A9Kz.js";import{C as y,b as S,c as w,a as C,d as R}from"./Card-f5wWE5lT.js";import{S as D,a as _,b as M,c as E,d as U}from"./Select-DdgOLbVu.js";import{D as $,a as z,b as G,c as J,d as K,e as Q}from"./Dialog-Uawugk7E.js";import{d as W}from"./dateFormator-BzaNub_Z.js";import X from"./MaterialOverviewLoading-NvLxL-Rh.js";import"./Skeleton-C-bZXmQ3.js";const Y=({isOpen:u,onClose:a,mainTaskId:p,subtasks:o})=>{const{mutateAsync:h,isPending:t}=O(),m=async(i,g,k)=>{var j,f;try{await h({mainTaskId:p,subTaskId:i,status:g,subTask:k}),n({description:"Updated Successfully",title:"Success"})}catch(c){n({title:"Error",description:((f=(j=c==null?void 0:c.response)==null?void 0:j.data)==null?void 0:f.message)||"Failed to update completion status",variant:"destructive"})}};return e.jsx("div",{className:"px-2 bg-white ",children:e.jsx($,{open:u,onOpenChange:a,children:e.jsxs(z,{children:[e.jsxs(G,{children:[e.jsx(J,{children:"Manage Subtask Status"}),e.jsx(K,{children:"Update status of each subtask and log changes."})]}),e.jsx("div",{className:"divide-y divide-gray-200 px-5",children:o.map(i=>e.jsxs("div",{className:"py-4 flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsx("div",{children:e.jsx("h4",{className:"text-sm font-medium text-gray-800",children:(i==null?void 0:i.taskName)||"-"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(d,{onClick:()=>m(i._id,"start",i.taskName),className:"bg-blue-600 text-white",disabled:t,children:[e.jsx("i",{className:"fa fa-play mr-1"})," Start"]}),e.jsxs(d,{onClick:()=>m(i._id,"paused",i.taskName),className:"bg-yellow-500 text-white",disabled:t,children:[e.jsx("i",{className:"fa fa-pause mr-1"})," Pause"]}),e.jsxs(d,{onClick:()=>m(i._id,"done",i.taskName),className:"bg-green-600 text-white",disabled:t,children:[e.jsx("i",{className:"fa fa-check mr-1"})," Done"]})]})]},i._id))}),e.jsx(Q,{children:e.jsx(d,{onClick:a,variant:"secondary",className:"",children:"Close"})})]})})})},Z=["low","medium","high"],ee=["site","procurement","design","accounts"],de=()=>{var T;const{id:u}=V(),{data:a,isLoading:p,refetch:o}=L(u),h=H(),[t,m]=b.useState({title:"",description:"",due:"",department:"",priority:"medium"}),[i,g]=b.useState(!1),{mutateAsync:k}=P(),{mutateAsync:j}=B(),{mutateAsync:f}=q();b.useEffect(()=>{var s;a&&m({title:a.title,description:a.description,due:(s=a.due)==null?void 0:s.slice(0,16),department:a.department,priority:a.priority})},[a]);const c=(s,l)=>{m(r=>({...r,[s]:l}))},F=async()=>{var s,l;try{if(!a)return;await k({mainTaskId:a._id,updates:t}),o(),n({description:"Updated Successfully",title:"Success"})}catch(r){n({title:"Error",description:((l=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:l.message)||"Failed to update completion status",variant:"destructive"})}},I=async(s,l)=>{var r,x;try{if(!a)return;await j({mainTaskId:a._id,subTaskId:s,taskName:l}),n({description:"Updated Successfully",title:"Success"})}catch(v){n({title:"Error",description:((x=(r=v==null?void 0:v.response)==null?void 0:r.data)==null?void 0:x.message)||"Failed to update completion status",variant:"destructive"})}},A=async s=>{var l,r;try{if(!a)return;await f({mainTaskId:a._id,subTaskId:s}),n({description:"Updated Successfully",title:"Success"})}catch(x){n({title:"Error",description:((r=(l=x==null?void 0:x.response)==null?void 0:l.data)==null?void 0:r.message)||"Failed to update completion status",variant:"destructive"})}};return a?p?e.jsx(X,{}):e.jsxs("div",{className:"p-2 overflow-y-auto max-h-full",children:[e.jsx("section",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("div",{onClick:()=>h(-1),className:"bg-blue-50 hover:bg-slate-300 flex items-center justify-between w-8 h-8 border border-[#a6aab8] text-sm cursor-pointer rounded-md px-2 ",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsx("h1",{className:"text-xl sm:text-3xl font-bold text-blue-800",children:"View And Edit Task"})]})}),e.jsxs(y,{children:[e.jsx(S,{children:e.jsxs(w,{children:["Task: ",a==null?void 0:a.title]})}),e.jsxs(C,{className:"grid md:grid-cols-2 gap-4",children:[e.jsx(N,{value:t.title,onChange:s=>c("title",s.target.value),placeholder:"Task Title"}),e.jsx(N,{value:t.due,onChange:s=>c("due",s.target.value),type:"datetime-local"}),e.jsxs(D,{value:t.priority,onValueChange:s=>c("priority",s),children:[e.jsx(_,{className:"bg-white",children:e.jsx(M,{selectedValue:t.priority,placeholder:"Priority"})}),e.jsx(E,{children:Z.map(s=>e.jsx(U,{value:s,children:s},s))})]}),e.jsxs(D,{value:t.department,onValueChange:s=>c("department",s),children:[e.jsx(_,{className:"bg-white",children:e.jsx(M,{selectedValue:t.department,placeholder:"Department"})}),e.jsx(E,{children:ee.map(s=>e.jsx(U,{value:s,children:s},s))})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(N,{value:t.description,onChange:s=>c("description",s.target.value),placeholder:"Description"})}),e.jsx("div",{className:"md:col-span-2 flex justify-end w-full",children:e.jsxs(d,{onClick:F,className:"mt-2 bg-blue-600 text-white hover:bg-blue-700",children:[e.jsx("i",{className:"fa-solid fa-save mr-2"})," Save Main Task"]})})]})]}),e.jsxs(y,{className:"mt-6",children:[e.jsxs(S,{children:[e.jsx(w,{children:"Subtasks"}),e.jsxs(R,{children:[((T=a.tasks)==null?void 0:T.length)||0," subtasks"]})]}),e.jsx(C,{className:"space-y-4",children:a.tasks.map(s=>e.jsx(se,{subtask:s,onSave:l=>I(s._id,l),onDelete:()=>A(s._id)},s._id))})]}),e.jsx(Y,{isOpen:i,onClose:()=>g(!1),mainTaskId:a._id,subtasks:a.tasks,history:a.history}),e.jsxs(y,{className:"mt-6",children:[e.jsxs(S,{className:"flex justify-between items-center",children:[e.jsx(w,{children:"Task History"}),e.jsxs(d,{onClick:()=>g(!0),className:"bg-blue-700 text-white mt-2",children:[e.jsx("i",{className:"fa fa-bolt mr-1"}),"Update Subtask Status"]})]}),e.jsxs(C,{className:"space-y-3 text-sm text-gray-700",children:[a.history.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[300px] w-full bg-white rounded-xl   text-center p-6",children:[e.jsx("i",{className:"fas fa-history text-5xl text-blue-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-1",children:"No History Found"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Looks like there are no changes made ",e.jsx("br",{})]})]}),a.history.map((s,l)=>{const r={queued:"bg-gray-200 text-gray-800",in_progress:"bg-blue-100 text-blue-800",paused:"bg-yellow-100 text-yellow-800",done:"bg-green-100 text-green-800",start:"bg-purple-100 text-purple-800"};return e.jsxs("div",{className:"border-l-4 border-blue-200 pl-4 py-3 bg-gray-50 rounded-md shadow-sm",children:[e.jsxs("div",{className:"flex items-center flex-wrap gap-2",children:[e.jsx("span",{className:`text-xs px-2 py-1 rounded-full font-semibold ${r[s.status]||"bg-gray-100 text-gray-700"}`,children:s.status.replace("_"," ").toUpperCase()}),s.subTask&&e.jsx("span",{className:"text-sm text-blue-600 font-medium italic",children:s.subTask})]}),e.jsxs("div",{className:"mt-1 text-xs text-gray-500 pl-1",children:["Changed on: ",W(new Date(s==null?void 0:s.changedAt).toLocaleString())," - ",new Date(s==null?void 0:s.changedAt).toLocaleString().slice(11)]})]},l)})]})]})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[300px] w-full bg-white rounded-xl   text-center p-6",children:[e.jsx("i",{className:"fas fa-clipboard text-5xl text-blue-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-1",children:"No Tasks Found"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Looks like there are no tasks created yet ",e.jsx("br",{})]})]})},se=({subtask:u,onSave:a,onDelete:p})=>{const[o,h]=b.useState(u.taskName);return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{value:o,onChange:t=>h(t.target.value),className:"flex-1"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(d,{onClick:()=>a(o),className:"bg-green-600 text-white hover:bg-green-700",children:[e.jsx("i",{className:"fa-solid fa-check mr-1"})," Save"]}),e.jsxs(d,{onClick:p,className:"bg-red-600 text-white hover:bg-red-700",children:[e.jsx("i",{className:"fa-solid fa-trash mr-1"})," Delete"]})]})]})};export{de as TaskViewMain,de as default};
