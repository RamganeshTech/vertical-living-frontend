import{h as p,i as ne,k as w,q as y,l as x,u as M,r as F,j as e,N as oe,B as R,e as K,t as h,aj as le,s as ie,a as de,M as ce,C as z}from"./index-D4FmOK8C.js";import{A as ue,S as me}from"./AssignStaff-BMN3U2AT.js";import{R as he}from"./StageFileUploader-BxO66jJp.js";import{I as ge}from"./Input-BFPVqyVD.js";import{R as pe}from"./ResetStageButton-DPq5RoNc.js";import{S as xe}from"./ShareDocumentWhatsapp-Cxh9ntyU.js";import"./getAllUsersApi-J36MmDR2.js";import"./VideoGalleryMain-Bztdf2I6.js";import"./documentationApi-BZVNE363.js";import"./requirementFormApi-BEe_OSf8.js";const fe=async({projectId:t,siteDetails:s,api:a})=>{const{data:r}=await a.post(`/sitemeasurement/createmeasurement/${t}`,{siteDetails:s});if(!r.ok)throw new Error(r.message);return r.data},be=async({projectId:t,room:s,api:a})=>{const{data:r}=await a.post(`/sitemeasurement/createroom/${t}`,{room:s});if(!r.ok)throw new Error(r.message);return r.data},we=async({projectId:t,api:s})=>{const{data:a}=await s.get(`/sitemeasurement/getmeasurement/${t}`);if(!a.ok)throw new Error(a.message);return a.data},ye=async({projectId:t,api:s,payload:a})=>{const{data:r}=await s.put(`/sitemeasurement/updatecommonmeasurement/${t}`,a);if(!r.ok)throw new Error(r.message);return r.data},je=async({projectId:t,api:s,roomId:a,room:r})=>{const{data:n}=await s.put(`/sitemeasurement/updateroommeasurement/${t}/${a}`,{room:r});if(!n.ok)throw new Error(n.message);return n.data},Ne=async({projectId:t,api:s})=>{const{data:a}=await s.put(`/sitemeasurement/completionstatus/${t}`);if(!a.ok)throw new Error(a.message);return a.data},ve=async({projectId:t,roomId:s,api:a})=>{const{data:r}=await a.patch(`/sitemeasurement/deleteroom/${t}/${s}`);if(!r.ok)throw new Error(r.message);return r.data},Se=async({projectId:t,api:s})=>{const{data:a}=await s.put(`/sitemeasurement/deletesitemeasurement/${t}`);if(!a.ok)throw new Error(a.message);return a.data},Ce=async({formId:t,projectId:s,deadLine:a,api:r})=>{const{data:n}=await r.put(`/sitemeasurement/deadline/${s}/${t}`,{deadLine:a});if(!n.ok)throw new Error(n.message);return n.data},Fe=async({formId:t,files:s,api:a,projectId:r})=>{const n=new FormData;return s.forEach(c=>n.append("file",c)),(await a.post(`/sitemeasurement/upload/multiple/${r}/${t}`,n,{headers:{"Content-Type":"multipart/form-data"}})).data},ke=async(t,s,a)=>{const{data:r}=await a.patch(`/sitemeasurement/${t}/deleteuploadedfile/${s}`);if(!r.ok)throw new Error(r.message);return r.data},Ee=()=>{const{role:t}=p(),s=x(t),a=["owner","staff","CTO","client"];return w({mutationFn:async({projectId:r,fileId:n})=>{if(!t||!a.includes(t))throw new Error("not allowed to make this api call");if(!s)throw new Error("API instance not found for role");return await ke(r,n,s)},onSuccess:(r,{projectId:n})=>{y.invalidateQueries({queryKey:["siteMeasurement",n]})}})},Re=({projectId:t})=>{const s=["owner","staff","CTO","client"],{role:a}=p(),r=x(a);return ne({queryKey:["siteMeasurement",t],queryFn:async()=>{if(!a||!s.includes(a))throw new Error("not allowed to make this api call");if(!r)throw new Error("API instance not found for role");return await we({projectId:t,api:r})},retry:!1})},Ae=()=>{const t=["owner","staff","CTO","client"],{role:s}=p(),a=x(s);return w({mutationFn:async({projectId:r,siteDetails:n})=>{if(!s||!t.includes(s))throw new Error("not allowed to make this api call");if(!a)throw new Error("API instance not found for role");return await fe({projectId:r,api:a,siteDetails:n})},onSuccess:(r,{projectId:n})=>{y.invalidateQueries({queryKey:["siteMeasurement",n]})}})},Me=()=>{const t=["owner","staff","CTO","client"],{role:s}=p(),a=x(s);return w({mutationFn:async({projectId:r,room:n})=>{if(!s||!t.includes(s))throw new Error("not allowed to make this api call");if(!a)throw new Error("API instance not found for role");return await be({projectId:r,api:a,room:n})},onSuccess:(r,{projectId:n})=>{y.invalidateQueries({queryKey:["siteMeasurement",n]})}})},Pe=()=>{const t=["owner","staff","CTO","client"],{role:s}=p(),a=x(s);return w({mutationFn:async({projectId:r,payload:n})=>{if(!s||!t.includes(s))throw new Error("not allowed to make this api call");if(!a)throw new Error("API instance not found for role");return await ye({projectId:r,api:a,payload:n})},onSuccess:(r,{projectId:n})=>{y.invalidateQueries({queryKey:["siteMeasurement",n]})}})},qe=()=>{const t=["owner","staff","CTO","client"],{role:s}=p(),a=x(s);return w({mutationFn:async({projectId:r,roomId:n,room:l})=>{if(!s||!t.includes(s))throw new Error("not allowed to make this api call");if(!a)throw new Error("API instance not found for role");return await je({projectId:r,api:a,roomId:n,room:l})},onSuccess:(r,{projectId:n})=>{y.invalidateQueries({queryKey:["siteMeasurement",n]})}})},Ie=()=>{const t=["owner","staff","CTO","client"],{role:s}=p(),a=x(s);return w({mutationFn:async({projectId:r})=>{if(!s||!t.includes(s))throw new Error("not allowed to make this api call");if(!a)throw new Error("API instance not found for role");return await Ne({projectId:r,api:a})},onSuccess:(r,{projectId:n})=>{y.invalidateQueries({queryKey:["siteMeasurement",n]})}})},$e=()=>{const t=["owner","staff","CTO","client"],{role:s}=p(),a=x(s);return w({mutationFn:async({projectId:r,roomId:n})=>{if(!s||!t.includes(s))throw new Error("not allowed to make this api call");if(!a)throw new Error("API instance not found for role");return await ve({projectId:r,api:a,roomId:n})},onSuccess:(r,{projectId:n})=>{y.invalidateQueries({queryKey:["siteMeasurement",n]})}})},Oe=()=>{const t=["owner","staff","CTO","client"],{role:s}=p(),a=x(s);return w({mutationFn:async({projectId:r})=>{if(!s||!t.includes(s))throw new Error("not allowed to make this api call");if(!a)throw new Error("API instance not found for role");return await Se({projectId:r,api:a})},onSuccess:(r,{projectId:n})=>{y.invalidateQueries({queryKey:["siteMeasurement",n]})}})},Le=()=>{const t=["owner","staff","CTO"],{role:s}=p(),a=x(s);return w({mutationFn:async({formId:r,projectId:n,deadLine:l})=>{if(!s)throw new Error("not authorized");if(!t.includes(s))throw new Error("you  dont have the access to make this api");if(!a)throw new Error("api is null");return await Ce({formId:r,deadLine:l,projectId:n,api:a})},onSuccess:(r,{projectId:n})=>{y.invalidateQueries({queryKey:["siteMeasurement",n]})}})},Te=()=>{const t=["owner","staff","CTO","client"],{role:s}=p(),a=x(s);return w({mutationFn:async({formId:r,files:n,projectId:l})=>{if(!s)throw new Error("not authorized");if(!t.includes(s))throw new Error("you  dont have the access to make this api");if(!a)throw new Error("api is null");return await Fe({formId:r,files:n,projectId:l,api:a})},onSuccess:(r,{projectId:n})=>{y.invalidateQueries({queryKey:["siteMeasurement",n]})}})},_e=async({roomId:t,files:s,api:a,projectId:r})=>(await a.post(`/sitemeasurement/uploadroom/${r}/${t}`,s,{headers:{"Content-Type":"multipart/form-data"}})).data,Ue=async({roomId:t,uploadId:s,api:a,projectId:r})=>(await a.delete(`/sitemeasurement/deleteroom/${r}/${t}/${s}`)).data,Be=async({projectId:t,roomId:s,uploadId:a,categoryName:r,api:n})=>{const{data:l}=await n.patch(`/sitemeasurement/updateimgname/${t}/${s}/${a}`,{categoryName:r});if(!l.ok)throw new Error(l.message);return l.data},Ke=()=>{const t=["owner","staff","CTO","client"],{role:s}=p(),a=x(s);return w({mutationFn:async({roomId:r,files:n,projectId:l})=>{if(!s)throw new Error("not authorized");if(!t.includes(s))throw new Error("you  dont have the access to make this api");if(!a)throw new Error("api is null");return await _e({roomId:r,files:n,projectId:l,api:a})},onSuccess:(r,{projectId:n})=>{y.invalidateQueries({queryKey:["siteMeasurement",n]})}})},ze=()=>{const t=["owner","staff","CTO","client"],{role:s}=p(),a=x(s);return w({mutationFn:async({roomId:r,uploadId:n,projectId:l})=>{if(!s)throw new Error("not authorized");if(!t.includes(s))throw new Error("you  dont have the access to make this api");if(!a)throw new Error("api is null");return await Ue({roomId:r,uploadId:n,projectId:l,api:a})},onSuccess:(r,{projectId:n})=>{y.invalidateQueries({queryKey:["siteMeasurement",n]})}})},Qe=()=>{const t=["owner","staff","CTO"],{role:s}=p(),a=x(s);return w({mutationFn:async({projectId:r,roomId:n,uploadId:l,categoryName:c})=>{if(!s||!t.includes(s))throw new Error("Not allowed to make this API call");if(!a)throw new Error("API instance not found for role");return await Be({projectId:r,roomId:n,uploadId:l,categoryName:c,api:a})},onSuccess:(r,{projectId:n})=>{y.invalidateQueries({queryKey:["siteMeasurement",n]})}})},We=({file:t,setPreviewImage:s,room:a})=>{const{projectId:r}=M(),[n,l]=F.useState(!1),[c,u]=F.useState((t==null?void 0:t.categoryName)||""),{mutateAsync:f,isPending:k}=ze(),{mutateAsync:A,isPending:j}=Qe(),b=async i=>{var o,N;try{await f({roomId:a._id,uploadId:i,projectId:r}),h({title:"Success",description:"Image deleted successfully"})}catch(S){h({title:"Error",description:((N=(o=S==null?void 0:S.response)==null?void 0:o.data)==null?void 0:N.message)||"Failed to delete",variant:"destructive"})}},C=async()=>{var i,o;if(!c||c===t.categoryName){l(!1);return}try{await A({uploadId:t._id,categoryName:c,roomId:a._id,projectId:r}),h({title:"Updated",description:"Image name updated successfully"})}catch(N){h({title:"Error",description:((o=(i=N==null?void 0:N.response)==null?void 0:i.data)==null?void 0:o.message)||"Failed to update name",variant:"destructive"})}finally{l(!1)}};return e.jsxs("div",{className:"group bg-white transition-all duration-300 hover:z-10",children:[e.jsxs("div",{className:"relative w-full overflow-hidden border-4 border-white  transition-all duration-300 cursor-pointer",onClick:()=>s(t==null?void 0:t.url),children:[e.jsx("div",{className:"aspect-square w-full",children:e.jsx("img",{src:t.url||oe,alt:t.originalName,className:"w-full h-full transition-transform duration-300 "})}),e.jsx("div",{className:"absolute inset-0 bg-opacity-0 group-hover:bg-opacity-40 transition-all duration-300 items-center justify-center hidden md:flex",children:e.jsx("div",{className:"flex space-x-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300 transform translate-y-4 group-hover:translate-y-0",children:["eye","trash","download"].map(i=>e.jsx(R,{variant:"secondary",size:"sm",onClick:o=>{o.stopPropagation(),i==="eye"?s(t==null?void 0:t.url):i==="trash"?b(t._id):K({src:t==null?void 0:t.url,alt:(t==null?void 0:t.originalName)||"image"})},disabled:i==="trash"&&k,className:`rounded-full bg-white hover:bg-gray-100 shadow-lg transition-all duration-200 ${i==="trash"?"hover:bg-red-50":""}`,children:e.jsx("i",{className:`w-3 h-3 fas fa-${i} ${i==="trash"?"text-red-500":i==="download"?"text-blue-500":"text-gray-600"}`})},i))})}),e.jsx("div",{className:"absolute top-2 right-[2px] flex flex-col space-y-1 sm:hidden",children:["eye","trash","download"].map(i=>e.jsx(R,{variant:"secondary",size:"sm",onClick:o=>{o.stopPropagation(),i==="eye"?s(t==null?void 0:t.url):i==="trash"?b(t._id):K({src:t==null?void 0:t.url,alt:(t==null?void 0:t.originalName)||"image"})},disabled:i==="trash"&&k,className:`w-6 h-6 p-0 rounded-full bg-white/90 backdrop-blur-sm border shadow-sm transition-all duration-200 ${i==="trash"?"border-red-200 hover:border-red-300 hover:bg-red-50":i==="download"?"border-blue-200 hover:border-blue-300 hover:bg-blue-50":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,children:e.jsx("i",{className:`w-3 h-3 fas fa-${i} ${i==="trash"?"text-red-500":i==="download"?"text-blue-500":"text-gray-600"}`})},i))})]}),e.jsx("div",{onClick:i=>i.stopPropagation(),className:"my-1 flex items-center justify-between px-1",children:n?e.jsxs("div",{className:"flex w-full items-center space-x-1",children:[e.jsx("input",{value:c,onChange:i=>u(i.target.value),className:"text-sm border px-1 py-0.5 rounded w-full",onKeyDown:i=>{i.key==="Enter"&&C()}}),e.jsx("button",{onClick:C,disabled:j,className:"text-blue-600 cursor-pointer hover:text-blue-800 text-xs",children:j?e.jsx("i",{className:"fa fa-spinner animate-spin"}):e.jsx("i",{className:"fas fa-check"})}),e.jsx("button",{onClick:()=>{l(!1),u(t.categoryName||"")},className:"text-red-500 cursor-pointer hover:text-red-700 text-xs",children:e.jsx("i",{className:"fas fa-times"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-sm text-gray-800 truncate max-w-[80%]",children:(t==null?void 0:t.categoryName)||"No category"}),e.jsx("button",{className:"text-gray-500 cursor-pointer hover:text-blue-600 text-xs",onClick:()=>l(!0),children:e.jsx("i",{className:"fas fa-pen"})})]})})]},t._id)},He=({room:t,onEdit:s,onDelete:a,deleteRoomLoading:r})=>{const{projectId:n}=M(),[l,c]=F.useState(null),u=(t==null?void 0:t.uploads)||[],f=t.length&&t.breadth?(t.length*t.breadth).toFixed(2):null,{mutateAsync:k,isPending:A}=Ke(),j=async b=>{var C,i;try{const o=b.target.files;if(!o||o.length===0)return;const N=Array.from(o).filter(v=>v.type.startsWith("image/"));if(N.length===0){h({title:"Error",description:"Please select only image files",variant:"destructive"});return}N.length!==o.length&&h({title:"Warning",description:"Only image files were uploaded. PDFs were skipped.",variant:"destructive"});const S=new FormData;N.forEach(v=>S.append("file",v)),await k({roomId:t._id,files:S,projectId:n}),h({title:"Success",description:"Images uploaded successfully"}),b.target.value=""}catch(o){h({title:"Error",description:((i=(C=o==null?void 0:o.response)==null?void 0:C.data)==null?void 0:i.message)||"Failed to upload",variant:"destructive"})}};return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-2 sm:p-6 mb-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold text-blue-700",children:t.name}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>s(t),className:"text-blue-600 hover:text-blue-800",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx(R,{isLoading:r,onClick:a,variant:"ghost",className:"!text-red-600 hover:text-red-800 bg-white shadow-none hover:!bg-none",children:e.jsx("i",{className:"fas fa-trash-can"})})]})]}),e.jsxs("div",{className:"space-y-4 w-full",children:[e.jsxs("div",{className:"flex items-center justify-between w-full relative",children:[e.jsx(ge,{type:"file",multiple:!0,accept:"image/*",placeholder:"Select images",onChange:j,disabled:A,className:A?"pr-10 opacity-70 cursor-not-allowed w-full":""}),A&&e.jsx("div",{className:"absolute inset-y-0 right-2 flex items-center",children:e.jsxs("svg",{className:"animate-spin h-5 w-5 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4l3.5-3.5L12 0v4a8 8 0 100 16v4l3.5-3.5L12 20v-4a8 8 0 01-8-8z"})]})})]}),e.jsxs("div",{className:"my-6",children:[e.jsx("h4",{className:"text-lg font-semibold mb-4 text-gray-800",children:"Room Images"}),u.length===0?e.jsx("div",{className:"text-gray-500 text-sm italic bg-gray-50 p-8 rounded-lg text-center border-2 border-dashed border-gray-200",children:"No images uploaded yet."}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 p-4 bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl",children:u.map(b=>e.jsx(We,{room:t,setPreviewImage:c,file:b}))})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Length"}),e.jsxs("p",{className:"font-semibold text-gray-800",children:[t.length||0," ft"]})]}),e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Breadth"}),e.jsxs("p",{className:"font-semibold text-gray-800",children:[t.breadth||0," ft"]})]}),e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Height"}),e.jsxs("p",{className:"font-semibold text-gray-800",children:[t.height||0," ft"]})]})]}),f&&e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:e.jsxs("p",{className:"text-blue-700 font-medium text-center",children:["Total Area: ",f," sq.ft"]})}),l&&e.jsx("div",{onClick:()=>c(null),className:"fixed inset-0 z-50 flex items-center justify-center bg-opacity-80 backdrop-blur-sm",children:e.jsxs("div",{onClick:b=>b.stopPropagation(),className:"relative bg-white rounded-xl shadow-2xl max-w-[90%] max-h-[90%] p-2 overflow-hidden",children:[e.jsx("button",{onClick:()=>c(null),className:"absolute top-4 right-4 z-10 w-8 h-8 bg-opacity-50 hover:bg-opacity-70 text-white rounded-full flex items-center justify-center transition-all duration-200",children:e.jsx("i",{className:"fas fa-times text-sm"})}),e.jsx("img",{src:l||"/placeholder.svg",alt:"Preview",className:"w-full max-h-[80vh] object-contain mx-auto rounded-lg"})]})})]})},Ge=({measurementData:t,handleDeleteSiteMeasurement:s,deleteRoomLoading:a,setShowSiteForm:r,setShowRoomForm:n,handleEditRoom:l,handleDeleteRoom:c})=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Site Measurements"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>r(!0),className:"px-2 sm:px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Edit"}),e.jsx("button",{onClick:()=>s(),className:"px-2 sm:px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"Delete"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total Plot Area"}),e.jsx("p",{className:"text-lg font-semibold text-blue-700",children:t.siteDetails.totalPlotAreaSqFt!==null?`${t.siteDetails.totalPlotAreaSqFt} sq.ft`:"Not mentioned"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Built-up Area"}),e.jsx("p",{className:"text-lg font-semibold text-blue-700",children:t.siteDetails.builtUpAreaSqFt!=null?`${t.siteDetails.builtUpAreaSqFt} sq.ft`:"Not mentioned"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Road Facing"}),e.jsx("p",{className:"text-lg font-semibold text-blue-700",children:t.siteDetails.roadFacing===!0?"YES":t.siteDetails.roadFacing===!1?"NO":"Not mentioned"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Number of Floors"}),e.jsx("p",{className:"text-lg font-semibold text-blue-700",children:t.siteDetails.numberOfFloors!=null?t.siteDetails.numberOfFloors:"Not mentioned"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Is having Slope"}),e.jsx("p",{className:"text-lg font-semibold text-blue-700",children:t.siteDetails.hasSlope===!0?"YES":t.siteDetails.hasSlope===!1?"NO":"Not mentioned"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Is Boundary Wall exists"}),e.jsx("p",{className:"text-lg font-semibold text-blue-700",children:t.siteDetails.boundaryWallExists===!0?"YES":t.siteDetails.boundaryWallExists===!1?"NO":"Not mentioned"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Additional Notes"}),e.jsx("p",{className:"text-lg font-semibold text-blue-700",children:t.siteDetails.additionalNotes?t.siteDetails.additionalNotes:"Not mentioned"})]})]})]}),t.siteDetails.totalPlotAreaSqFt!==null&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Rooms"}),e.jsx("button",{onClick:()=>n(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"+ Add Room"})]}),t.rooms.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})})}),e.jsx("p",{className:"text-gray-500",children:"No rooms added yet"})]}):e.jsx("div",{className:"mt-4 grid grid-cols-1 gap-6",children:t.rooms.map((u,f)=>e.jsx(He,{room:u,onEdit:()=>l(u),onDelete:()=>c(u._id),deleteRoomLoading:a},f))})]})]}),Ye=F.memo(Ge),Ve=({roomDetails:t,setRoomDetails:s,handleRoomSubmit:a,setShowRoomForm:r,updateRoomLoading:n,createRoomLoading:l,editingRoomId:c})=>e.jsx("div",{className:"fixed inset-0 bg-black/70 bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-md p-6",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-6",children:c?"Edit Room":"Add New Room"}),e.jsxs("select",{value:t.name||"",onChange:u=>s(f=>({...f,name:u.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent mb-4",children:[e.jsx("option",{value:"",children:"Select Room Type"}),le.map(u=>e.jsx("option",{value:u,children:u}))]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"",children:"Length (ft)"}),e.jsx("input",{type:"number",placeholder:"Length (ft)",value:t.length||0,onChange:u=>s({...t,length:Number(u.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"",children:"Breadth (ft)"}),e.jsx("input",{type:"number",placeholder:"Breadth (ft)",value:t.breadth||0,onChange:u=>s({...t,breadth:Number(u.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"",children:"Height (ft)"}),e.jsx("input",{type:"number",placeholder:"Height (ft)",value:t.height||0,onChange:u=>s({...t,height:Number(u.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),t.length&&t.breadth&&e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg mb-4",children:e.jsxs("p",{className:"text-blue-700 font-medium",children:["Calculated Area: ",(Number(t.length)*Number(t.breadth)).toFixed(2)," sq.ft"]})}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{onClick:()=>r(!1),className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsx(R,{isLoading:c?n:l,onClick:a,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:c?"Edit Room":"Add Room"})]})]})}),Je=({siteDetails:t,updatePending:s,setSiteDetails:a,handleSiteSubmit:r,setShowSiteForm:n})=>e.jsx("div",{className:"fixed inset-0 bg-black/70 bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-2xl p-6",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-6",children:"Site Measurements"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"",children:"Total Plot Area (sq.ft)"}),e.jsx("input",{type:"number",placeholder:"Total Plot Area (sq.ft)",value:t.totalPlotAreaSqFt||0,onChange:l=>a({...t,totalPlotAreaSqFt:Number(l.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"",children:"Built-up Area (sq.ft)"}),e.jsx("input",{type:"number",placeholder:"Built-up Area (sq.ft)",value:t.builtUpAreaSqFt||0,onChange:l=>a({...t,builtUpAreaSqFt:Number(l.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"",children:"Number of Floors"}),e.jsx("input",{type:"number",placeholder:"Number of Floors",value:t.numberOfFloors||0,onChange:l=>a({...t,numberOfFloors:Number(l.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 mb-4",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:t.hasSlope??!1,onChange:l=>a({...t,hasSlope:l.target.checked}),className:"mr-2"}),"Has Slope"]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:t.roadFacing??!1,onChange:l=>a({...t,roadFacing:l.target.checked}),className:"mr-2"}),"Road Facing"]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:t.boundaryWallExists??!1,onChange:l=>a({...t,boundaryWallExists:l.target.checked}),className:"mr-2"}),"Boundary Wall Exists"]})]}),e.jsx("textarea",{placeholder:"Additional Notes",value:t.additionalNotes||"",onChange:l=>a({...t,additionalNotes:l.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent mb-4",rows:4}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(R,{variant:"secondary",onClick:()=>n(!1),className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsx(R,{variant:"primary",onClick:r,isLoading:s,children:"Save Details"})]})]})}),Xe=F.memo(Je),Ze={totalPlotAreaSqFt:null,builtUpAreaSqFt:null,roadFacing:null,numberOfFloors:null,hasSlope:!1,boundaryWallExists:!1,additionalNotes:null},Q={name:null,length:null,breadth:null,height:null,uploads:[]};function dt(){var L,T,_,U,B;const{projectId:t,organizationId:s}=M(),{isMobile:a,openMobileSidebar:r}=ie();if(!t)return;const n=de(),[l,c]=F.useState(!1),[u,f]=F.useState(!1),[k,A]=F.useState(Ze),[j,b]=F.useState(Q),[C,i]=F.useState(null);let{data:o,isLoading:N,refetch:S,error:v}=Re({projectId:t});const W=Ae(),P=Me(),q=Pe(),I=qe(),$=$e(),H=Oe(),O=Ie(),{mutateAsync:G,isPending:Y}=Le(),{mutateAsync:V,isPending:J}=Te(),{mutateAsync:X,isPending:Z}=Ee(),D=async()=>{var m,g;try{Object.values(o.siteDetails).some(E=>typeof E=="number")?await q.mutateAsync({projectId:t,payload:k}):await W.mutateAsync({projectId:t,siteDetails:k}),c(!1),h({description:"Site details updated successfully",title:"Success"})}catch(d){h({title:"Error",description:((g=(m=d==null?void 0:d.response)==null?void 0:m.data)==null?void 0:g.message)||d.message||"Failed to save site details",variant:"destructive"})}},ee=async()=>{var m,g;try{if(!j.name)throw new Error("please select the name");const d=j.length&&j.breadth?(Number(j.length)*Number(j.breadth)).toFixed(2):null,E={...j,area:d};C?await I.mutateAsync({projectId:t,roomId:C,room:E}):await P.mutateAsync({projectId:t,room:E}),f(!1),i(null),b(Q),h({description:C?"Room updated":"Room added",title:"Success"})}catch(d){h({title:"Error",description:((g=(m=d==null?void 0:d.response)==null?void 0:m.data)==null?void 0:g.message)||(d==null?void 0:d.message)||"Operation failed",variant:"destructive"})}},te=async m=>{var g,d;try{await $.mutateAsync({projectId:t,roomId:m}),h({description:"Room deleted",title:"Success"})}catch(E){h({title:"Error",description:((d=(g=E==null?void 0:E.response)==null?void 0:g.data)==null?void 0:d.message)||"Delete failed",variant:"destructive"})}},se=async()=>{var m,g;try{await H.mutateAsync({projectId:t}),h({description:"Site measurement deleted",title:"Success"})}catch(d){h({title:"Error",description:((g=(m=d==null?void 0:d.response)==null?void 0:m.data)==null?void 0:g.message)||"Delete failed",variant:"destructive"})}},ae=async()=>{var m,g;try{await O.mutateAsync({projectId:t}),h({description:"Completion updated",title:"Success"}),n("../sampledesign")}catch(d){h({title:"Error",description:((g=(m=d==null?void 0:d.response)==null?void 0:m.data)==null?void 0:g.message)||"Update failed",variant:"destructive"})}},re=m=>{b(m),i(m==null?void 0:m._id),f(!0)};return N?e.jsx(ce,{}):e.jsxs("div",{className:"container mx-auto px-2 py-2 max-w-full h-full w-full overflow-y-auto custom-scrollbar",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center mb-6 gap-4",children:[e.jsxs("div",{className:"w-full sm:w-auto",children:[e.jsxs("h2",{className:"text-2xl sm:text-3xl font-semibold text-blue-600 flex items-center",children:[a&&e.jsx("button",{onClick:r,className:"mr-3 p-2 rounded-md border border-gray-300 hover:bg-gray-100",title:"Open Menu",children:e.jsx("i",{className:"fa-solid fa-bars"})}),e.jsx("i",{className:"fa-solid fa-receipt mr-2"})," Site Measurement"]}),e.jsx("p",{className:"text-gray-600 hidden sm:block text-sm sm:text-base",children:"Plan your dream home"})]}),e.jsxs("div",{className:"flex flex-wrap sm:flex-nowrap items-center gap-2  !w-[100%] sm:!w-[50%] lg:!w-[60%] justify-start lg:justify-end",children:[e.jsxs(R,{isLoading:O.isPending,onClick:ae,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2  w-full sm:w-auto",children:[e.jsx("i",{className:"fa-solid fa-circle-check mr-2"})," Mark Complete"]}),e.jsx(pe,{projectId:t,stageNumber:2,stagePath:"sitemeasurement",className:"sm:!max-w-[20%] w-full"}),!v&&e.jsx(xe,{projectId:t,stageNumber:"2",className:"w-full sm:w-fit",isStageCompleted:o==null?void 0:o.status}),e.jsx(ue,{stageName:"SiteMeasurementModel",projectId:t,organizationId:s,currentAssignedStaff:(o==null?void 0:o.assignedTo)||null,className:"w-full sm:w-auto"})]})]}),v&&e.jsxs("div",{className:"max-w-xl mx-auto mt-4 p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2",children:"⚠️ Error Occurred"}),e.jsx("p",{className:"text-red-500 text-sm mb-4",children:((T=(L=v==null?void 0:v.response)==null?void 0:L.data)==null?void 0:T.message)||"Failed to load data"}),e.jsx(R,{onClick:()=>S(),className:"bg-red-600 text-white px-4 py-2",children:"Retry"})]}),!v&&e.jsxs(z,{className:"p-4 mb-4 shadow border-l-4 border-blue-600 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-3 text-blue-700 text-sm font-medium mb-2",children:[e.jsx("i",{className:"fa-solid fa-clock text-blue-500 text-lg"}),e.jsx("span",{children:"Stage Timings"})]}),e.jsx(me,{completedAt:(_=o==null?void 0:o.timer)==null?void 0:_.compltedAt,stageName:"sitemeasurement",formId:o==null?void 0:o._id,projectId:t,deadLine:(U=o==null?void 0:o.timer)==null?void 0:U.deadLine,startedAt:(B=o==null?void 0:o.timer)==null?void 0:B.startedAt,refetchStageMutate:S,deadLineMutate:G,isPending:Y})]}),!v&&e.jsx("div",{className:"mb-6",children:e.jsx(z,{className:"p-4 shadow border-l-4 border-blue-500 bg-white",children:e.jsx(he,{autoUpload:!0,formId:o==null?void 0:o._id,refetch:S,existingUploads:o==null?void 0:o.uploads,onUploadComplete:S,uploadFilesMutate:V,uploadPending:J,projectId:t,onDeleteUpload:X,deleteFilePending:Z})})}),!v&&e.jsxs(e.Fragment,{children:[!Object.values((o==null?void 0:o.siteDetails)||{}).some(m=>m!==null)&&!l?e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})})}),e.jsx("p",{className:"text-gray-600 mb-4",children:"No Site Details Added"}),e.jsx("button",{onClick:()=>c(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"Add Site Details"})]}):e.jsx(Ye,{measurementData:o,handleDeleteSiteMeasurement:se,setShowSiteForm:c,setShowRoomForm:f,handleEditRoom:re,handleDeleteRoom:te,deleteRoomLoading:$.isPending}),l&&e.jsx(Xe,{siteDetails:k,setSiteDetails:A,handleSiteSubmit:D,setShowSiteForm:c,updatePending:q.isPending}),u&&e.jsx(Ve,{handleRoomSubmit:ee,setShowRoomForm:f,roomDetails:j,setRoomDetails:b,updateRoomLoading:I.isPending,createRoomLoading:P.isPending,editingRoomId:C})]})]})}export{dt as default};
