import{r as c,j as e,N as Y,u as Z,a as ee,b as te,c as J,d as se,R as re,B as ae,M as ne,t as O,e as ce}from"./index-Wihfhca_.js";import{R as le}from"./FurnitureForm-C1UUssA7.js";const W=({options:r,placeholder:w="Select an option",searchPlaceholder:k="Search...",onSelect:x,selectedValue:M,className:T=""})=>{const[R,g]=c.useState(!1),[L,A]=c.useState(""),[l,h]=c.useState(null),u=c.useRef(null),N=r.filter(i=>i.toLowerCase().includes(L.toLowerCase()));c.useEffect(()=>{const i=p=>{u.current&&!u.current.contains(p.target)&&g(!1)};return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[]),c.useEffect(()=>{if(M){const i=r.find(p=>p===M);h(i||null)}else h(null)},[M,r]);const B=i=>{h(i),x(i),g(!1),A("")},C=()=>{g(!0),A("")},j=i=>{A(i.target.value)};return e.jsxs("div",{className:`relative ${T}`,ref:u,children:[e.jsxs("div",{className:"w-full p-3 border border-gray-300 rounded-lg bg-white cursor-pointer hover:border-gray-400 transition-colors",onClick:C,children:[l?e.jsx("span",{className:"text-gray-800",children:l}):e.jsx("span",{className:"text-gray-500",children:w}),e.jsx("span",{className:"absolute right-3 top-3 text-gray-400",children:"▼"})]}),R&&e.jsxs("div",{className:"absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-auto",children:[e.jsx("div",{className:"p-2 border-b border-gray-200",children:e.jsx("input",{type:"text",placeholder:k,value:L,onChange:j,className:"w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0})}),e.jsx("div",{className:"py-1",children:N.length>0?N.map(i=>e.jsx("div",{className:`px-4 py-2 cursor-pointer hover:bg-gray-100 transition-colors ${l===i?"bg-blue-50 text-blue-600":""}`,onClick:()=>B(i),children:i},i)):e.jsx("div",{className:"px-4 py-2 text-gray-500 text-center",children:"No options found"})})]})]})},oe=c.forwardRef(({data:r,index:w,brandOptions:k,laminateBrandOptions:x,laminateRatesByBrand:M,brandRatesByName:T,selectedBrand:R,selectedLaminateBrand:g,onFurnitureChange:L},A)=>{var b,m;const[l,h]=c.useState(null),[u,N]=c.useState(null),B=l?T[l]||[]:[],C=u?M[u]||[]:[],j=c.useRef(g),i=c.useRef(R);c.useEffect(()=>{i.current!==R&&(h(R),i.current=R)},[R]),c.useEffect(()=>{j.current!==g&&(N(g),j.current=g)},[g]),c.useEffect(()=>{!l&&(k==null?void 0:k.length)>0&&h(k[0])},[k]),c.useEffect(()=>{!u&&(x==null?void 0:x.length)>0&&N(x[0])},[x]);const p=(s,o,t)=>{const y=String(s).toLowerCase().replace("mm","").trim(),S=o.find(E=>String(E.thickness).toLowerCase().replace("mm","").trim()===y);return(S==null?void 0:S.rs)!==void 0?S.rs:t==="laminate"?ie:0},v=(s,o)=>{if(!u&&!u)return s.rowTotal||0;const y=p(s.plywoodNos.thickness,B,"plywood"),S=p(s.laminateNos.thickness,C,"laminate");console.log("ply Rate",y),console.log("lami Rate",S);const E=32,V=s.plywoodNos.quantity*(y*E),D=s.laminateNos.quantity*(S*E);console.log("plyCost",V),console.log("lamiCost",D);const Q=V+D;console.log("baseMaterialCost",Q);const z=Q*(s.profitOnMaterial/100);console.log("profitOnMaterial",z);const H=o.length,_=o[0],K=_.carpenters*_.days*le.labour*(1+(_.profitOnLabour||0)/100)/H,X=Q+z+K;return Math.round(X)},q=s=>s.quantity*s.cost,U=s=>s.cost,F=r.coreMaterials.reduce((s,o)=>s+v(o,r.coreMaterials),0),I=r.fittingsAndAccessories.reduce((s,o)=>s+q(o),0),G=r.glues.reduce((s,o)=>s+U(o),0),P=r.nonBrandMaterials.reduce((s,o)=>s+q(o),0),d=F+I+G+P;c.useImperativeHandle(A,()=>({getUpdatedFurniture:()=>({furnitureName:r.furnitureName,plywoodBrand:l,laminateBrand:u,coreMaterials:r.coreMaterials.map(s=>({...s,rowTotal:v(s,r.coreMaterials)})),fittingsAndAccessories:r.fittingsAndAccessories,glues:r.glues,nonBrandMaterials:r.nonBrandMaterials,coreMaterialsTotal:F,fittingsAndAccessoriesTotal:I,gluesTotal:G,nonBrandMaterialsTotal:P,furnitureTotal:d,totals:{core:F,fittings:I,glues:G,nbms:P,furnitureTotal:d}})})),c.useEffect(()=>{L==null||L()},[l,u,r.coreMaterials,r.fittingsAndAccessories,r.glues]);const a=()=>{var s,o;return e.jsxs("div",{className:"mt-6",children:[e.jsxs("h3",{className:"font-semibold text-md text-gray-800 mb-2",children:["Core Materials (Total: ₹",F.toLocaleString("en-IN"),")"]}),e.jsx("div",{className:"overflow-x-auto rounded-md",children:e.jsxs("table",{className:"min-w-full text-sm bg-white shadow-sm",children:[e.jsxs("thead",{className:"bg-blue-50 text-sm font-semibold text-gray-600",children:[e.jsxs("tr",{children:[e.jsx("th",{rowSpan:2,className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Image"}),e.jsx("th",{rowSpan:2,className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Item Name"}),e.jsx("th",{colSpan:2,className:"text-center px-6 py-1 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Plywood"}),e.jsx("th",{colSpan:2,className:"text-center px-6 py-1 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Laminate"}),e.jsx("th",{rowSpan:2,className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"No. of Carpenters / Day"}),e.jsx("th",{rowSpan:2,className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"No. of Days"}),e.jsx("th",{rowSpan:2,className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Profit % Material"}),e.jsx("th",{rowSpan:2,className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Profit % Labour"}),e.jsx("th",{rowSpan:2,className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Remarks"}),e.jsx("th",{rowSpan:2,className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),e.jsx("th",{rowSpan:2,className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]}),e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-6 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Qty"}),e.jsx("th",{className:"text-center px-6 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Thk"}),e.jsx("th",{className:"text-center px-6 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Qty"}),e.jsx("th",{className:"text-center px-6 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Thk"})]})]}),e.jsx("tbody",{children:((s=r==null?void 0:r.coreMaterials)==null?void 0:s.length)>0&&((o=r==null?void 0:r.coreMaterials)==null?void 0:o.map((t,y)=>{var E,V,D,Q,z,H,_,$;const S=v(t,r.coreMaterials);return e.jsxs("tr",{className:"group border",children:[y===0&&e.jsx("td",{rowSpan:(E=r==null?void 0:r.coreMaterials)==null?void 0:E.length,className:"text-center border-r-1 p-2",children:t!=null&&t.imageUrl?e.jsx("img",{src:(t==null?void 0:t.imageUrl)||Y,className:"h-10 mx-auto"}):e.jsx(e.Fragment,{children:"—"})}),e.jsx("td",{className:"text-center border-r-1 p-2",children:(t==null?void 0:t.itemName)||"—"}),e.jsx("td",{className:"text-center border-r-1 p-2",children:((V=t==null?void 0:t.plywoodNos)==null?void 0:V.quantity)??0}),e.jsx("td",{className:"text-center border-r-1 p-2",children:((D=t==null?void 0:t.plywoodNos)==null?void 0:D.thickness)??0}),e.jsx("td",{className:"text-center border-r-1 p-2",children:((Q=t==null?void 0:t.laminateNos)==null?void 0:Q.quantity)??0}),e.jsx("td",{className:"text-center border-r-1 p-2",children:((z=t==null?void 0:t.laminateNos)==null?void 0:z.thickness)??0}),y===0&&e.jsxs(e.Fragment,{children:[e.jsx("td",{rowSpan:(H=r==null?void 0:r.coreMaterials)==null?void 0:H.length,className:"text-center border-r-1 p-2",children:(t==null?void 0:t.carpenters)||0}),e.jsx("td",{rowSpan:(_=r==null?void 0:r.coreMaterials)==null?void 0:_.length,className:"text-center border-r-1 p-2",children:(t==null?void 0:t.days)||0})]}),e.jsx("td",{className:"text-center border-r-1 p-2",children:(t==null?void 0:t.profitOnMaterial)||0}),y===0&&e.jsx("td",{rowSpan:($=r==null?void 0:r.coreMaterials)==null?void 0:$.length,className:"text-center border-r-1 p-2",children:(t==null?void 0:t.profitOnLabour)||0}),e.jsx("td",{className:"text-center border-r-1 p-2",children:(t==null?void 0:t.remarks)||"—"}),e.jsxs("td",{className:"text-center border-r-1 p-2 text-green-700 font-bold",children:["₹",S==null?void 0:S.toLocaleString("en-IN")]}),e.jsx("td",{className:"text-center border-r-1 p-2",children:"—"})]},y)}))})]})})]})},n=s=>s==="Fittings & Accessories"?I:s==="Glues"?G:s==="Non-Branded Materials"?P:0,f=(s,o)=>e.jsxs("div",{className:"mt-4",children:[e.jsxs("h3",{className:"font-semibold text-md mb-2 text-gray-800",children:[s,"(Total: ₹",n(s).toLocaleString("en-IN"),")"]}),e.jsxs("table",{className:"min-w-full text-sm bg-white shadow-sm",children:[e.jsx("thead",{className:"bg-blue-50 text-sm font-semibold text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Item Name"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Description"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Quantity"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Cost"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{children:o.length>0&&o.map((t,y)=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"text-center border p-2",children:(t==null?void 0:t.itemName)||"—"}),e.jsx("td",{className:"text-center border p-2",children:(t==null?void 0:t.description)||"—"}),e.jsx("td",{className:"text-center border p-2",children:(t==null?void 0:t.quantity)||0}),e.jsx("td",{className:"text-center border p-2",children:(t==null?void 0:t.cost)||0}),s==="Fittings & Accessories"||s==="Non-Branded Materials"?e.jsxs("td",{className:"text-center border p-2 text-green-700 font-bold",children:["₹",q(t).toLocaleString("en-IN")]}):e.jsxs("td",{className:"text-center border p-2 text-green-700 font-bold",children:["₹",U(t).toLocaleString("en-IN")]}),e.jsx("td",{className:"text-center border p-2",children:"—"})]},y))})]})]});return e.jsxs("div",{className:"shadow-md p-4 my-4 border rounded-lg bg-white",children:[e.jsxs("div",{className:" flex justify-between items-center",children:[e.jsxs("h2",{className:"text-xl font-semibold  text-blue-600",children:["Product ",w+1,": ",r.furnitureName]}),e.jsxs("div",{className:"text-right text-xl font-bold text-green-700",children:["Product Total: ₹",d.toLocaleString("en-IN")]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"font-medium text-gray-700",children:"Select Plwyood Brand:"}),e.jsx(W,{options:k,placeholder:"-- Choose Plwyood Brand --",searchPlaceholder:"Search Plywood brands...",onSelect:h,selectedValue:l||"",className:"mt-1"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"font-medium text-gray-700",children:"Select Laminate Brand:"}),e.jsx(W,{options:x,placeholder:"-- Choose Laminate Brand --",searchPlaceholder:"Search laminate brands...",onSelect:N,selectedValue:u||"",className:"mt-1"})]})]}),e.jsxs("div",{children:[l&&((b=T[l])==null?void 0:b.length)>0&&e.jsxs("div",{className:"mt-6 border border-gray-200 bg-white rounded-md shadow-sm p-4",children:[e.jsxs("h3",{className:"text-md font-semibold text-gray-800 mb-2",children:["Available Thickness & Rates for ",e.jsx("span",{className:"text-blue-600",children:l})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm text-left border border-gray-100",children:[e.jsx("thead",{className:"bg-blue-50 text-xs text-gray-600 uppercase tracking-wider",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 border-r",children:"Thickness"}),e.jsx("th",{className:"px-4 py-2",children:"Rate (₹/sqft)"})]})}),e.jsx("tbody",{children:T[l].map((s,o)=>e.jsxs("tr",{className:"border-t border-gray-100",children:[e.jsx("td",{className:"px-4 py-2 border-r text-gray-700 font-medium",children:s.thickness}),e.jsxs("td",{className:"px-4 py-2 text-green-800 font-bold",children:["₹",s.rs.toFixed(2)]})]},o))})]})})]}),u&&((m=M[u])==null?void 0:m.length)>0&&e.jsxs("div",{className:"mt-4 border bg-white rounded-md shadow-sm p-4",children:[e.jsxs("h3",{className:"text-md font-semibold text-gray-800 mb-2",children:["Laminate Rates for ",e.jsx("span",{className:"text-blue-600",children:u})]}),e.jsxs("table",{className:"min-w-full text-sm border",children:[e.jsx("thead",{className:"bg-blue-50 text-xs text-gray-600 uppercase",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 border-r",children:"Thickness"}),e.jsx("th",{className:"px-4 py-2",children:"Rate (₹/sqft)"})]})}),e.jsx("tbody",{children:M[u].map((s,o)=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-2 border-r font-medium",children:s.thickness}),e.jsxs("td",{className:"px-4 py-2 text-green-800 font-bold",children:["₹",s.rs.toFixed(2)]})]},o))})]})]})]})]}),a(),f("Fittings & Accessories",r.fittingsAndAccessories),f("Glues",r.glues),f("Non-Branded Materials",r.nonBrandMaterials)]})}),ie=10,me=()=>{var P;const{organizationId:r,quoteId:w}=Z(),k=ee(),{data:x,isLoading:M}=te(r,w);let{data:T,isLoading:R}=J(r,"plywood"),{data:g}=J(r,"Laminate");const{mutateAsync:L,isPending:A}=se(),l=c.useRef([]),[h,u]=c.useState(null),[N,B]=c.useState(null),C=c.useMemo(()=>{if(!T)return{};const d={};return T.forEach(a=>{const n=(a==null?void 0:a.data)||{},f=n.Brand??n.brand,b=n["thickness (mm)"]||n.thickness||n.Thickness;let m=n.Rs||n.rs;if(f&&b&&m){const s=String(f).trim(),o=String(b).trim(),t=parseFloat(m);d[s]||(d[s]=[]),d[s].push({thickness:o,rs:t})}}),d},[T]),j=c.useMemo(()=>Object.keys(C),[C]),i=c.useMemo(()=>{if(!g)return{};const d={};return g.forEach(a=>{const n=(a==null?void 0:a.data)||{},f=n.Brand??n.brand,b=n["thickness (mm)"]||n.thickness||n.Thickness,m=n.Rs||n.rs;if(f&&b&&m){const s=String(f).trim(),o=String(b).trim(),t=parseFloat(m);d[s]||(d[s]=[]),d[s].push({thickness:o,rs:t})}}),d},[g]),p=c.useMemo(()=>Object.keys(i),[i]),[v,q]=c.useState([]),[U,F]=c.useState(0),I=()=>{const a=l.current.map(n=>n.current).filter(n=>n!==null).map(n=>n.getUpdatedFurniture()).reduce((n,f)=>n+f.totals.furnitureTotal,0);F(a)},G=async()=>{var d,a;try{if(!r||!w||!x||!h){O({title:"Missing info",description:"Please ensure brand and all details are selected",variant:"destructive"});return}console.log("fff Furnitures",v),console.log("fff furnitureRefs",l);const n=l.current.map(m=>m.current).filter(m=>m!==null).map(m=>m.getUpdatedFurniture()),f=n.reduce((m,s)=>m+s.totals.furnitureTotal,0);console.log("fff updatedFurnitures",n);const b=await L({quoteId:w,organizationId:r,data:{quoteId:w,organizationId:r,projectId:x.projectId,brandName:h,laminateBrand:N,furnitures:n,grandTotal:f,notes:"Generated with brand variant"}});ce({src:b.url,alt:b.fileName}),O({title:"success",description:"scuesssfully vrated"})}catch(n){O({title:"Error",description:((a=(d=n==null?void 0:n.response)==null?void 0:d.data)==null?void 0:a.message)??"Operation failed"})}};return c.useEffect(()=>{if(!(x!=null&&x.furnitures))return;const d=x.furnitures.map(a=>({furnitureName:a.furnitureName,coreMaterials:a.coreMaterials||[],fittingsAndAccessories:a.fittingsAndAccessories||[],glues:a.glues||[],nonBrandMaterials:a.nonBrandMaterials||[],totals:{core:a.coreMaterialsTotal||0,fittings:a.fittingsAndAccessoriesTotal||0,glues:a.gluesTotal||0,nbms:a.nonBrandMaterialsTotal||0,furnitureTotal:a.furnitureTotal||0},plywoodBrand:h,laminateBrand:N}));q(d)},[x]),l.current.length!==v.length&&(l.current=v.map((d,a)=>l.current[a]??re.createRef())),c.useEffect(()=>{console.log("furnitureRefs Array",l),l.current=v.map((d,a)=>l.current[a]??c.createRef())},[v]),console.log("furnitureRefs",l),c.useEffect(()=>{!h&&(j==null?void 0:j.length)>0&&u(j[0])},[j]),c.useEffect(()=>{!N&&(p==null?void 0:p.length)>0&&B(p[0])},[p]),e.jsxs("div",{className:"p-2 max-h-full overflow-y-auto",children:[e.jsxs("header",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("div",{onClick:()=>k(-1),className:"bg-slate-50 hover:bg-slate-300 flex items-center justify-between w-8 h-8 border border-[#a6aab8] text-sm cursor-pointer rounded-md px-2 ",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-md font-bold text-gray-500",children:["Project Name: ",e.jsx("strong",{className:"text-black",children:((P=x==null?void 0:x.projectId)==null?void 0:P.projectName)||"Project"})]}),e.jsxs("h1",{className:"text-md font-bold text-gray-500",children:["Quote:  ",e.jsxs("strong",{className:"text-black",children:["#",(x==null?void 0:x.quoteNo)||"View"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 justify-end ",children:[e.jsxs("p",{className:"text-2xl font-bold text-green-700",children:["₹",U.toLocaleString("en-IN")]}),e.jsx("div",{children:e.jsx(ae,{isLoading:A,onClick:()=>{G()},children:"Generate Quote"})}),e.jsxs("div",{className:"max-w-[40%]",children:[e.jsx("label",{className:"font-medium text-gray-700",children:"Select Common Plwyood Brand:"}),e.jsx(W,{options:j,placeholder:"-- Choose Plwyood Brand --",searchPlaceholder:"Search Plywood brands...",onSelect:u,selectedValue:h||"",className:"mt-1"})]}),e.jsxs("div",{className:"max-w-[40%]",children:[e.jsx("label",{className:"font-medium text-gray-700",children:"Select Common Laminate Brand:"}),e.jsx(W,{options:p,placeholder:"-- Choose Laminate Brand --",searchPlaceholder:"Search laminate brands...",onSelect:B,selectedValue:N||"",className:"mt-1"})]})]})]}),M||R?e.jsx(ne,{}):e.jsx(e.Fragment,{children:e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-6",children:[v.map((d,a)=>e.jsx(oe,{index:a,data:d,ref:l.current[a],laminateRatesByBrand:i,brandRatesByName:C,selectedBrand:h,selectedLaminateBrand:N,brandOptions:j,laminateBrandOptions:p,onFurnitureChange:I},a)),e.jsx("div",{className:"mt-10 text-right",children:e.jsxs("div",{className:"inline-block bg-green-50 border border-green-200 rounded-md px-6 py-4",children:[e.jsx("p",{className:"text-md font-medium text-gray-700 mb-1",children:"Total Estimate"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700",children:["₹",U.toLocaleString("en-IN")]})]})})]})})})]})};export{ie as DEFAULT_LAMINATE_RATE_PER_SQFT,me as default};
