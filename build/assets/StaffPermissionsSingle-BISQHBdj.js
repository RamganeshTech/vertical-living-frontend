import{a as U,b as M,r as g,j as e}from"./index-By5P0A7l.js";import{c as L,d as R}from"./orgApi-DMLr_760.js";import{u as q}from"./useDebounce-DqqsQWok.js";import"./useQuery-Cc7pLKfK.js";import"./useMutation-7YLqc7VE.js";import"./roleCheck-YGaMnK_P.js";const J=["hr","logistics","procurement","accounts","payments","billing","vendor","customer","invoice","expense","billtemplate","purchaseorder","vendorpayment","salesorder","retailinvoice","subcontract","referencedesign","stafftask","design","productinventory","invitecto","invitestaff"],z=["inventory","inviteclient","inviteworker","prerequisites","clientrequirement","sitemeasurement","sampledesign","workschedule","technicalconsultant","paymentconfirmation","modularunit","ordermaterial","materialarrival","installation","qualitycheck","cleaning","projectdelivery"],N=["list","create","edit","delete"],O=l=>{if(z.includes(l))return{color:"text-indigo-600",bg:"bg-indigo-50",border:"border-indigo-100",icon:"fa-project-diagram"};switch(l){case"hr":return{color:"text-violet-600",bg:"bg-violet-50",border:"border-violet-100",icon:"fa-users"};case"accounts":return{color:"text-emerald-600",bg:"bg-emerald-50",border:"border-emerald-100",icon:"fa-file-invoice-dollar"};case"logistics":return{color:"text-amber-600",bg:"bg-amber-50",border:"border-amber-100",icon:"fa-truck"};default:return{color:"text-gray-600",bg:"bg-gray-50",border:"border-gray-100",icon:"fa-layer-group"}}},K=()=>{var A;const{userId:l}=U(),h=M(),{mutateAsync:p,status:f}=L(),{data:r,isLoading:b}=R(l),[i,n]=g.useState({}),[o,G]=g.useState(!1),j=q(i,800);g.useEffect(()=>{r&&!o&&(n(r.permission||{}),G(!0))},[r,o]),g.useEffect(()=>{if(!o||JSON.stringify(j)===JSON.stringify((r==null?void 0:r.permissions)||{}))return;(async()=>{await p({userId:l,permission:j})})()},[j]);const c=(A=r==null?void 0:r.role)==null?void 0:A.toLowerCase(),v=s=>c?c==="owner"||c==="cto"||c==="staff"||c==="worker"||c==="client"?s:[]:[],d=g.useMemo(()=>v(J),[c]),x=g.useMemo(()=>v(z),[c]),w=(s,t)=>{n(a=>{var m;return{...a,[s]:{...a[s]||{},[t]:!((m=a[s])!=null&&m[t])}}})},S=s=>{n(t=>{const a=t[s]||{},u=!N.every(I=>a[I]===!0);return{...t,[s]:{list:u,create:u,edit:u,delete:u}}})},k=s=>{const t=i[s]||{};return N.every(a=>t[a]===!0)},y=(s,t)=>{n(a=>{const m={...a};return s.forEach(u=>{m[u]={list:t,create:t,edit:t,delete:t}}),m})},C=s=>y([...d,...x],s),P=s=>y(d,s),$=s=>y(x,s);return b&&!o?e.jsx("div",{className:"flex h-full items-center justify-center",children:"Loading Permissions..."}):e.jsxs("div",{className:"flex flex-col h-full bg-gray-50/50",children:[e.jsxs("header",{className:" border-b border-gray-200 px-6 py-4 flex flex-col md:flex-row justify-between items-center sticky top-0 z-20 shadow-sm/50 backdrop-blur-sm bg-white/90 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4 w-full md:w-auto",children:[e.jsx("button",{onClick:()=>h(-1),className:"text-gray-500 hover:text-blue-600",children:e.jsx("i",{className:"fas fa-arrow-left text-xl"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Permission Management"}),e.jsxs("p",{className:"text-xs text-gray-500",children:[r==null?void 0:r.name," ",e.jsx("span",{className:"uppercase font-bold bg-blue-50 text-blue-600 px-1 rounded ml-1",children:r==null?void 0:r.role})]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[(d.length>0||x.length>0)&&e.jsxs("div",{className:"flex items-center gap-2 border-r pr-4 mr-2 border-gray-200",children:[e.jsx("span",{className:"text-[10px] uppercase font-bold text-gray-400 mr-1",children:"Global:"}),e.jsx("button",{onClick:()=>C(!0),className:"text-xs bg-gray-800 text-white px-3 py-1.5 rounded hover:bg-black transition",children:"Select All"}),e.jsx("button",{onClick:()=>C(!1),className:"text-xs border border-gray-300 text-gray-600 px-3 py-1.5 rounded hover:bg-gray-100 transition",children:"Clear All"})]}),f==="pending"?e.jsx("span",{className:"text-xs font-bold text-orange-500 animate-pulse",children:"SAVING..."}):f==="success"?e.jsx("span",{className:"text-xs font-bold text-green-600",children:"SAVED"}):null]})]}),e.jsxs("main",{className:"flex-1 overflow-y-auto p-6 space-y-10",children:[d.length>0&&e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 border-b pb-2 border-gray-200",children:[e.jsxs("h2",{className:"text-lg font-bold text-gray-800 flex items-center",children:[e.jsx("i",{className:"fas fa-building mr-2 text-blue-500"})," Organization Departments"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>P(!0),className:"text-[10px] uppercase font-bold text-blue-600 hover:underline",children:"Select All Org"}),e.jsx("span",{className:"text-gray-300",children:"|"}),e.jsx("button",{onClick:()=>P(!1),className:"text-[10px] uppercase font-bold text-red-500 hover:underline",children:"Deselect Org"})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:d.map(s=>e.jsx(E,{dept:s,permissions:i,onSelectAll:()=>S(s),onSingleCheck:w,isAllSelected:k(s),style:O(s)},s))})]}),x.length>0&&e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 border-b pb-2 border-gray-200",children:[e.jsxs("h2",{className:"text-lg font-bold text-gray-800 flex items-center",children:[e.jsx("i",{className:"fas fa-layer-group mr-2 text-indigo-500"})," Project Stages"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>$(!0),className:"text-[10px] uppercase font-bold text-blue-600 hover:underline",children:"Select All Projects"}),e.jsx("span",{className:"text-gray-300",children:"|"}),e.jsx("button",{onClick:()=>$(!1),className:"text-[10px] uppercase font-bold text-red-500 hover:underline",children:"Deselect Projects"})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:x.map(s=>e.jsx(E,{dept:s,permissions:i,onSelectAll:()=>S(s),onSingleCheck:w,isAllSelected:k(s),style:O(s)},s))})]}),d.length===0&&x.length===0&&o&&e.jsx("div",{className:"flex flex-col items-center justify-center h-40 text-gray-400",children:e.jsx("p",{children:"No configurable permissions available for this role."})})]})]})},E=({dept:l,permissions:h,onSelectAll:p,onSingleCheck:f,isAllSelected:r,style:b})=>e.jsxs("div",{className:`relative bg-white rounded-xl shadow-sm border transition-all duration-300 ${r?"border-blue-300 shadow-blue-50 ring-1 ring-blue-100":"border-gray-200 hover:shadow-md"}`,children:[e.jsxs("div",{className:`px-4 py-3 border-b flex justify-between items-center cursor-pointer select-none rounded-t-xl transition-colors ${r?"bg-blue-50/50":"bg-white hover:bg-gray-50"}`,onClick:p,children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[e.jsx("div",{className:`flex-shrink-0 h-7 w-7 rounded flex items-center justify-center ${b.bg} ${b.color}`,children:e.jsx("i",{className:`fas ${b.icon} text-xs`})}),e.jsx("h3",{className:"font-bold text-xs text-gray-800 capitalize truncate",title:l,children:l.replace(/([A-Z])/g," $1").trim()})]}),e.jsx("div",{className:`flex-shrink-0 h-4 w-4 rounded border flex items-center justify-center transition-all ${r?"bg-blue-600 border-blue-600":"bg-white border-gray-300"}`,children:r&&e.jsx("i",{className:"fas fa-check text-white text-[10px]"})})]}),e.jsx("div",{className:"p-3 space-y-2",children:N.map(i=>{var o;const n=((o=h[l])==null?void 0:o[i])||!1;return e.jsxs("label",{className:`flex items-center justify-between p-1.5 rounded cursor-pointer transition-all ${n?"bg-blue-50/30":"hover:bg-gray-50"}`,children:[e.jsx("span",{className:`text-xs capitalize font-medium ${n?"text-blue-700":"text-gray-600"}`,children:i}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"checkbox",className:"peer sr-only",checked:n,onChange:()=>f(l,i)}),e.jsx("div",{className:`h-4 w-7 rounded-full transition-colors duration-200 border ${n?"bg-blue-600 border-blue-600":"bg-gray-200 border-gray-200"}`}),e.jsx("div",{className:`absolute left-[2px] top-[2px] bg-white w-3 h-3 rounded-full shadow transition-transform duration-200 ${n?"translate-x-3":"translate-x-0"}`})]})]},i)})}),e.jsx("div",{className:`h-1 w-full rounded-b-xl transition-all ${r?"bg-blue-500":"bg-transparent"}`})]});export{K as default};
