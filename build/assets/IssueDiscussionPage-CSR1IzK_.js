import{b as oa,c as da,e as ca,r as o,o as ma,a0 as y,a1 as xa,j as e,B as S,I as pa,N as vs,t as w}from"./index-DyM6T-eT.js";import{u as fa,a as ua,b as ha,c as ga,d as ba,e as ja}from"./issueDiscussionApi-CqudjFEF.js";import{u as L}from"./getAllUsersApi-V_vS6o62.js";import{T as z}from"./TextArea-D3aqW0sD.js";import{L as N}from"./Label-B3hr6461.js";import{S as G}from"./SearchSelectNew-BTs46di7.js";import{I as ws}from"./ImageGalleryMain-DbEY14VT.js";import{d as Na}from"./dateFormator-BGKi5rfZ.js";import{u as ya}from"./projectApi-CMY3yoCw.js";import{B as va}from"./Badge-zJ_n6Uf_.js";import{u as wa}from"./useDebounce-DXaYFH0W.js";import"./downloadFile-CQDFTv8V.js";import"./index-CkRxYNyB.js";const ks=({showHeader:Rs=!0,showFilters:Ss=!0})=>{var ie,re,ne,oe,de,ce,me,xe,pe,fe,ue,he,ge,be,je,Ne,ye,ve,we,ke,Re,Se,Fe,Ce,Oe,Te,_e,De,Pe,Ae,Ie,Le,Me,Ee,Be,Ue,qe,We,ze,Ge,Ve,$e,He,Ye,Ke,Je,Qe,Xe,Ze,es,ss,as,ts,ls,is,rs,ns,os,ds,cs,ms,xs,ps,fs,us,hs,gs,bs,js,Ns;const{organizationId:p}=oa(),Fs=da(),M=ca(),[d,F]=o.useState({search:"",projectId:"",projectName:"",myTickets:!1,notResponded:!1,sortBy:"createdAt",sortOrder:"desc"});let V=wa(d.search,500);const{mutateAsync:Cs,isPending:E}=fa(),{mutateAsync:Os,isPending:$}=ua(),{mutateAsync:Ts,isPending:_s,variables:Ds}=ha(),{mutateAsync:Ps,isPending:As}=ga(),{mutateAsync:H}=ba({organizationId:p}),{data:k,isLoading:Is,hasNextPage:Ls,fetchNextPage:Ms,refetch:Y}=ja({organizationId:p,limit:50,filters:{search:V,projectId:d.projectId,projectName:d.projectName,myTickets:d.myTickets,notResponded:d.notResponded,sortBy:d.sortBy,sortOrder:d.sortOrder}}),{data:Es=[]}=L(p,"staff"),{data:Bs=[]}=L(p,"owner"),{data:Us=[]}=L(p,"worker"),{data:qs=[]}=L(p,"CTO"),[K,_]=o.useState([]),[t,C]=o.useState(null),[B,U]=o.useState(!1),[u,R]=o.useState({responseType:"text",isMessageRequired:!1,dropdownOptions:[]}),[c,j]=o.useState({issue:"",selectedStaff:"",projectId:"",projectName:"",selectStaffRole:"",dropdownOptions:"",files:[]}),[f,O]=o.useState({content:"",files:[],message:""}),[q,Ws]=o.useState(!1),[zs,J]=o.useState(""),[ka,Q]=o.useState(""),x=ma(),[D,g]=o.useState(null),X=o.useRef(null),Z=o.useRef(null),Gs=o.useRef(null),[v,T]=o.useState({isOpen:!1,type:null,url:""}),{data:P}=ya(p),h=P==null?void 0:P.map(s=>({_id:s._id,projectName:s.projectName})),Vs=(ie=P||[])==null?void 0:ie.map(s=>({value:s._id,label:s.projectName}));o.useEffect(()=>{h&&h.length>0&&!c.projectId&&j(s=>({...s,projectId:h[0]._id}))},[h]),o.useEffect(()=>{if(!y||!p)return;console.log("[Socket] Joining discussion room for organizationId:",p),y.on("recent_discussions",l=>{console.log("[Socket] Received recent discussions:",l)});const s=async l=>{console.log("[Socket] New issue created:",l);const n=M.pathname;if(_(m=>m.some(I=>I._id===l.conversation._id)?m:[l.conversation,...m]),M.pathname.includes("organizations")&&n.split("/").length===3||M.pathname.includes("ticket"))try{console.log("everything is working"),await H()}catch(m){console.log("error from mark as read ticket",m)}},a=l=>{console.log("=== RESPONSE HANDLER CALLED ==="),console.log("Full data received:",l),console.log("ConvoId from data:",l.convoId),console.log("Has conversation?",!!l.conversation),console.log("Has response?",!!l.response),console.log("==============================="),console.log("[Socket] Response added:",l),_(n=>n.map(m=>m._id===l.conversation._id?l.conversation:m)),console.log("selectedIssue id",t==null?void 0:t._id),console.log("data.convoId",l.convoId),C(n=>!n||n._id===l.conversation._id?l.conversation:n)},i=l=>{console.log("[Socket] Issue deleted:",l),_(n=>n.filter(m=>m._id!==l.discussionId)),C(n=>(console.log("Current selected issue:",n==null?void 0:n._id),console.log("Deleted issue:",l.convoId),console.log("discussionId issue:",l.discussionId),(n==null?void 0:n._id)===l.discussionId?null:n))},r=l=>{console.log("[Socket] Issue forwarded:",l),_(n=>n.map(m=>m._id===l.conversation._id?l.conversation:m)),C(n=>(n==null?void 0:n._id)===l.conversation._id?l.conversation:n)};return y.on("new_issue_created",s),y.on("issue_response_added",a),y.on("issue_deleted",i),y.on("issue_forwarded",r),()=>{console.log("[Socket] Leaving discussion room"),y.off("new_issue_created",s),y.off("issue_response_added",a),y.off("issue_deleted",i),y.off("issue_forwarded",r)}},[p,x==null?void 0:x.id]),o.useEffect(()=>{if(k!=null&&k.pages){const s=k.pages.flatMap(a=>a.discussions||[]);_(s)}},[k]);const{userName:ee}=xa(s=>s.authStore);o.useEffect(()=>{k&&(async()=>{await H()})()},[k]);const $s=(Es||[]).map(s=>({value:s._id,label:s.staffName,email:s.email,role:s.role})),Hs=(Bs||[]).map(s=>({value:s._id,label:s.username,email:s.email,role:s.role})),Ys=(Us||[]).map(s=>({value:s._id,label:s.username,email:s.email,role:s.role})),Ks=(qs||[]).map(s=>({value:s._id,label:s.username,email:s.email,role:s.role})),se=[...$s,...Hs,...Ys,...Ks],ae=se.filter(s=>{var a,i,r;return s.value!==(x==null?void 0:x.id)&&s.value!==((r=(i=(a=t==null?void 0:t.discussion[0])==null?void 0:a.issue)==null?void 0:i.raisedBy)==null?void 0:r._id)}),A=se.filter(s=>s.value!==(x==null?void 0:x.id)),Js=s=>{const a=A==null?void 0:A.find(i=>(i==null?void 0:i.value)===s);j(i=>({...i,selectedStaff:a==null?void 0:a.value,selectStaffRole:a==null?void 0:a.role}))},Qs=s=>{const a=h==null?void 0:h.find(i=>i._id===s);j(i=>({...i,projectId:s||"",projectName:(a==null?void 0:a.customerName)||""}))},Xs=async s=>{const a=ae.find(i=>i.value===s);J(a==null?void 0:a.value),Q((a==null?void 0:a.role)||""),await sa(a==null?void 0:a.value,a==null?void 0:a.role)},Zs=async()=>{var s,a,i,r;try{if(!c.issue.trim()||!c.selectedStaff){g("Please fill all required fields");return}if(u.responseType==="dropdown"&&u.dropdownOptions.length===0){g("Please add at least one dropdown option");return}g(null),await Cs({organizationId:p,projectId:c.projectId,selectStaff:c.selectedStaff,selectStaffRole:c.selectStaffRole,issue:c.issue,responseType:u.responseType,isMessageRequired:u.isMessageRequired,files:c.files??[],dropdownOptions:u.responseType==="dropdown"?u.dropdownOptions:void 0}),j({issue:"",selectedStaff:"",dropdownOptions:"",selectStaffRole:"",projectId:"",projectName:"",files:[]}),R({responseType:"text",isMessageRequired:!1,dropdownOptions:[]}),U(!1),w({title:"Success",description:"Ticket created successfully"}),Y()}catch(l){w({title:"Error",description:((a=(s=l==null?void 0:l.response)==null?void 0:s.data)==null?void 0:a.message)||(l==null?void 0:l.message)||"Failed to create the ticket",variant:"destructive"}),g(((r=(i=l==null?void 0:l.response)==null?void 0:i.data)==null?void 0:r.message)||(l==null?void 0:l.message)||"Failed to create ticket")}},ea=async s=>{var a,i;try{await Ts({convoId:s,organizationId:p}),(t==null?void 0:t._id)===s&&C(null),Y(),w({title:"Success",description:"Ticket Deleted successfully"})}catch(r){w({title:"Error",description:((i=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:i.message)||(r==null?void 0:r.message)||"Failed to delete the ticket",variant:"destructive"})}},sa=async(s,a)=>{var i,r;if(!s||!a){alert("Please select a staff");return}try{await Ps({organizationId:p,convoId:t._id,forwardToStaff:s,forwardToStaffRole:a}),J(""),Q(""),As&&w({title:"Success",description:"Ticket Forwarded successfully"})}catch(l){w({title:"Error",description:((r=(i=l==null?void 0:l.response)==null?void 0:i.data)==null?void 0:r.message)||(l==null?void 0:l.message)||"Failed to forward the Ticket",variant:"destructive"})}},aa=async()=>{var s,a,i,r,l,n,m,W,I,ys;try{if(!t)return;if(((s=t.discussion[0])==null?void 0:s.issue.responseType)==="dropdown"&&!f.content){g("Please select an option");return}if(((a=t.discussion[0])==null?void 0:a.issue.responseType)==="text"&&!((i=f.content)!=null&&i.trim())){g("Please enter a response");return}if(((r=t.discussion[0])==null?void 0:r.issue.responseType)==="file"&&f.files.length===0){g("Please upload at least one file");return}if((l=t.discussion[0])!=null&&l.issue.isMessageRequired&&!((n=f.message)!=null&&n.trim())){g("Please add a message");return}g(null),await Os({convoId:t._id,responseContent:f.content,optionalMessage:f.message,files:f.files.length>0?f.files:void 0,organizationId:p}),O({content:"",files:[],message:""}),w({title:"Success",description:"Resolved successfully"})}catch(b){w({title:"Error",description:((W=(m=b==null?void 0:b.response)==null?void 0:m.data)==null?void 0:W.message)||(b==null?void 0:b.message)||"Failed to Resolve the ticket",variant:"destructive"}),g(((ys=(I=b==null?void 0:b.response)==null?void 0:I.data)==null?void 0:ys.message)||(b==null?void 0:b.message)||"Failed to resolve the ticket")}},ta=s=>{if(j(a=>({...a,dropdownOptions:s})),s.includes(",")){const a=s.split(",").map(i=>i.trim()).filter(i=>i&&!u.dropdownOptions.includes(i));a.length>0&&(R(i=>({...i,dropdownOptions:[...i.dropdownOptions,...a]})),j(i=>({...i,dropdownOptions:""})))}},la=()=>{const s=c.dropdownOptions.trim();s&&!u.dropdownOptions.includes(s)&&(R(a=>({...a,dropdownOptions:[...a.dropdownOptions,s]})),j(a=>({...a,dropdownOptions:""})))},ia=s=>{const a=Array.from(s.target.files||[]),i=a.filter(r=>{const l=r.type.startsWith("image/"),n=r.type==="application/pdf";return l||n});i.length!==a.length&&g("Only images and PDFs are allowed"),O(r=>({...r,files:[...r.files,...i]}))},ra=s=>{const a=Array.from(s.target.files||[]),i=a.filter(r=>{const l=r.type.startsWith("image/"),n=r.type==="application/pdf";return l||n});i.length!==a.length&&g("Only images and PDFs are allowed"),j(r=>({...r,files:[...r.files,...i]}))},te=Object.entries(d).filter(([s,a])=>s==="sortBy"||s==="sortOrder"||s==="myTickets"&&a===!1||s==="notResponded"&&a===!1?!1:a!=="").length,na=()=>{F({search:"",projectId:"",projectName:"",myTickets:!1,notResponded:!1,sortBy:"createdAt",sortOrder:"desc"}),V=""},le=t&&!((re=t.discussion[0])!=null&&re.response)&&((ne=t.discussion[0])==null?void 0:ne.issue.selectStaff._id)===(x==null?void 0:x.id);return e.jsxs("main",{className:"h-full w-full !max-w-full !overflow-y-auto bg-gradient-to-br from-blue-50 to-white p-2",children:[e.jsxs("header",{className:" flex justify-between w-full pb-2 border-b border-b-[#aaaaaa] mb-2",children:[Rs&&e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("button",{onClick:()=>Fs(-1),className:"bg-blue-50 hover:bg-slate-300 flex items-center justify-between w-8 h-8 border border-[#a6aab8] text-sm cursor-pointer rounded-md px-2 ",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsxs("h1",{className:"text-3xl font-bold text-blue-600",children:[e.jsx("i",{className:"fa-solid fa-ticket mr-3"}),"Ticket Operations ",ee||null]})]}),e.jsxs(S,{onClick:()=>{C(null),U(!B)},className:"bg-blue-600  hover:bg-blue-700 text-white ml-auto ",disabled:E,children:[e.jsx("i",{className:"fas fa-plus mr-1"}),"Raise Ticket"]})]}),e.jsxs("main",{className:"flex flex-col h-full md:flex-row lg:max-h-[92%] lg:flex-row gap-4 overflow-y-auto",children:[Ss&&e.jsx("div",{className:"w-full lg:w-1/3 flex flex-col border-r border-blue-200",children:e.jsx("div",{className:"flex-shrink-0 !max-h-[100%] overflow-y-auto",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-filter mr-2 text-blue-600"}),"Filters"]}),te>0&&e.jsxs("button",{onClick:na,className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:["Clear All (",te,")"]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx("i",{className:"fas fa-search mr-2"}),"Search"]}),e.jsx("input",{type:"text",autoFocus:!0,placeholder:"description, projects, staff...",value:d.search,onChange:s=>F(a=>({...a,search:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Project"}),e.jsxs("select",{value:(d==null?void 0:d.projectId)||"",onChange:s=>{const a=h==null?void 0:h.find(i=>i._id===s.target.value);F(a?i=>({...i,projectId:a._id,projectName:a.projectName}):i=>({...i,projectId:"",projectName:""}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"All Projects"}),h==null?void 0:h.map(s=>e.jsx("option",{value:s._id,children:s.projectName},s._id))]})]}),e.jsx("div",{children:e.jsxs("label",{htmlFor:"myTickets",className:"flex items-center gap-2 cursor-pointer select-none",children:[e.jsx("input",{id:"myTickets",type:"checkbox",checked:d.myTickets,onChange:()=>F(s=>({...s,myTickets:!d.myTickets})),className:"w-4 h-4 accent-blue-600 cursor-pointer"}),e.jsx("span",{className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:"My Tickets"})]})}),e.jsx("div",{children:e.jsxs("label",{htmlFor:"notResponded",className:"flex items-center gap-2 cursor-pointer select-none",children:[e.jsx("input",{id:"notResponded",type:"checkbox",checked:d.notResponded,onChange:()=>F(s=>({...s,notResponded:!d.notResponded})),className:"w-4 h-4 accent-blue-600 cursor-pointer"}),e.jsx("span",{className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:"Un Resolved Tasks"})]})})]})]})})}),e.jsxs("div",{className:"w-full lg:w-1/2 flex flex-col border-r border-blue-200",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto space-y-3 pr-2",children:[Is?e.jsxs("div",{className:"flex flex-col items-center justify-center h-40",children:[e.jsx("i",{className:"fas fa-spinner fa-spin text-blue-600 text-3xl mb-2"}),e.jsx("p",{className:"text-gray-600",children:"Loading tickets..."})]}):K.length===0?e.jsx("section",{className:"flex items-center justify-center h-[95%]",children:e.jsxs("div",{className:"text-center py-12 text-gray-500 ",children:[e.jsx("i",{className:"fas fa-inbox text-5xl mb-3 opacity-50"}),e.jsx("p",{className:"text-lg",children:"No Tickets yet"}),e.jsx("p",{className:"text-sm",children:"Create your first Ticket to get started"})]})}):K.map(s=>{var i,r;const a=s.discussion[0];return a?e.jsx("div",{onClick:()=>C(s),className:`group relative rounded-xl cursor-pointer border-2 transition-all duration-300 ${(t==null?void 0:t._id)===a._id?"bg-gradient-to-br from-blue-50 to-indigo-50 border-blue-500 shadow-lg":"bg-white border-gray-200 hover:border-blue-300 hover:shadow-md"}`,children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx("i",{className:"fas fa-user text-white text-sm"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-xs text-gray-500 font-medium",children:"Assigned to"}),e.jsx("p",{className:"text-sm font-bold text-gray-800 truncate",children:((i=a.issue.selectStaff)==null?void 0:i.name)||"Unknown Staff"})]})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(va,{variant:"success",children:((r=a.issue.projectId)==null?void 0:r.projectName)||"-"}),e.jsx("span",{className:`text-xs px-3 py-1.5 rounded-full font-semibold flex items-center gap-1.5 whitespace-nowrap ${a.response?"bg-gradient-to-r from-green-500 to-emerald-500 text-white shadow-sm":"bg-gradient-to-r from-amber-400 to-orange-400 text-white shadow-sm"}`,children:a.response?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-check-circle"}),e.jsx("span",{children:"Done"})]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-clock"}),e.jsx("span",{children:"Pending"})]})}),e.jsx(S,{size:"sm",className:"bg-red-500 hover:bg-red-600 text-white px-2.5 py-1.5 rounded-lg shadow-md hover:shadow-lg transition-all opacity-0 group-hover:opacity-100",onClick:l=>{l.stopPropagation(),ea(s._id)},isLoading:_s&&Ds.convoId===s._id,children:e.jsx("i",{className:"fas fa-trash text-xs"})})]})]}),e.jsx("div",{className:"mb-3 pl-10",children:e.jsx("p",{className:"text-sm text-gray-700 line-clamp-2 leading-relaxed",children:a.issue.issue})}),e.jsxs("div",{className:"flex gap-2 items-center flex-wrap pl-10",children:[e.jsxs("span",{className:"bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-xs font-semibold flex items-center gap-1.5 border border-blue-200",children:[a.issue.responseType==="dropdown"&&e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-list-ul"}),e.jsx("span",{children:"Dropdown"})]}),a.issue.responseType==="text"&&e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-align-left"}),e.jsx("span",{children:"Text"})]}),a.issue.responseType==="file"&&e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-file-upload"}),e.jsx("span",{children:"File"})]})]}),a.issue.isMessageRequired&&e.jsxs("span",{className:"bg-purple-100 text-purple-700 px-3 py-1 rounded-full text-xs font-semibold flex items-center gap-1.5 border border-purple-200",children:[e.jsx("i",{className:"fas fa-comment-dots"}),e.jsx("span",{children:"Additional Message Required"})]}),a.issue.files&&a.issue.files.length>0&&e.jsxs("span",{className:"bg-indigo-100 text-indigo-700 px-3 py-1 rounded-full text-xs font-semibold flex items-center gap-1.5 border border-indigo-200",children:[e.jsx("i",{className:"fas fa-paperclip"}),e.jsx("span",{children:a.issue.files.length})]}),e.jsxs("span",{className:"text-xs text-gray-500 ml-auto flex items-center gap-1",children:[e.jsx("i",{className:"far fa-calendar-alt"}),new Date(a.createdAt).toLocaleDateString("en-US",{month:"short",day:"numeric"})]})]})]})},a._id):null}),e.jsx("div",{ref:Gs})]}),Ls&&e.jsxs(S,{onClick:()=>Ms(),className:"w-full mt-3 bg-blue-100 hover:bg-blue-200 text-blue-700 border border-blue-300",children:[e.jsx("i",{className:"fas fa-arrow-down mr-2"}),"Load More Discussions"]})]}),e.jsxs("div",{className:"w-full lg:w-3/4 flex flex-col bg-white rounded-lg border border-blue-200  overflow-y-auto",children:[B&&e.jsxs("div",{className:" bg-white rounded-xl h-full shadow-lg border border-blue-200 overflow-y-scroll",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-white rounded-lg flex items-center justify-center",children:e.jsx("i",{className:"fas fa-plus-circle text-blue-600 text-xl"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:"Create New Ticket"}),e.jsx("p",{className:"text-xs text-blue-100",children:"Fill in the details to raise a new ticket"})]})]})}),e.jsxs("div",{className:"p-6 space-y-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(N,{className:"text-gray-700 font-semibold flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-user-check text-blue-600"}),"Select Staff to Respond"]}),e.jsx(G,{options:A,placeholder:"Choose staff member",searchPlaceholder:"Search by name...",value:c.selectedStaff,onValueChange:s=>{Js(s)},searchBy:"name",displayFormat:"detailed",className:"w-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"Select project"}),e.jsx(G,{options:Vs,placeholder:"Select project",searchPlaceholder:"Search projects...",value:c.projectId||void 0,onValueChange:s=>Qs(s),searchBy:"name",displayFormat:"simple",className:"w-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(N,{className:"text-gray-700 font-semibold flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-comment-dots text-blue-600"}),"Ticket Description"]}),e.jsx(z,{value:c.issue,onChange:s=>j(a=>({...a,issue:s.target.value})),placeholder:"Describe the ticket in detail...",className:"w-full min-h-24 border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 rounded-lg"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(N,{className:"text-gray-700 font-semibold flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-reply text-blue-600"}),"Response Method"]}),e.jsxs("select",{value:u.responseType,onChange:s=>R(a=>({...a,responseType:s.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white",children:[e.jsx("option",{value:"text",children:"ðŸ’¬ Text Response"}),e.jsx("option",{value:"dropdown",children:"ðŸ“‹ Dropdown Selection"}),e.jsx("option",{value:"file",children:"ðŸ“Ž File Upload (Image/PDF)"})]})]}),u.responseType==="dropdown"&&e.jsxs("div",{className:"space-y-3 p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs(N,{className:"text-gray-700 font-semibold flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-list text-blue-600"}),"Dropdown Options"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(pa,{value:c.dropdownOptions,onChange:s=>ta(s.target.value),onKeyDown:s=>{s.key==="Enter"&&(R(a=>({...a,dropdownOptions:[...a.dropdownOptions,s.target.value]})),j(a=>({...a,dropdownOptions:""})))},placeholder:"Enter options: Option 1, Option 2, Option 3",className:"flex-1 border-blue-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200"}),e.jsx(S,{onClick:la,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 shadow-md hover:shadow-lg transition-all",children:e.jsx("i",{className:"fas fa-plus"})})]}),e.jsxs("p",{className:"text-xs text-blue-700 flex items-center gap-1",children:[e.jsx("i",{className:"fas fa-info-circle"}),"Type comma-separated values and press Add or Enter"]}),u.dropdownOptions.length>0&&e.jsx("div",{className:"space-y-2 mt-3",children:u.dropdownOptions.map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between bg-white p-3 rounded-lg border border-blue-200 hover:shadow-md transition-shadow group",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-bold",children:a+1}),e.jsx("span",{className:"text-sm text-gray-700 font-medium",children:s})]}),e.jsx("button",{onClick:()=>R(i=>({...i,dropdownOptions:i.dropdownOptions.filter((r,l)=>l!==a)})),className:"text-red-500 hover:text-white hover:bg-red-500 p-2 rounded-lg transition-all opacity-0 group-hover:opacity-100",children:e.jsx("i",{className:"fas fa-trash text-sm"})})]},a))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(N,{className:"text-gray-700 font-semibold flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-paperclip text-blue-600"}),"Upload Files (Images/PDFs)",e.jsx("span",{className:"text-xs font-normal text-gray-500",children:"(Optional)"})]}),e.jsx("input",{ref:Z,type:"file",multiple:!0,accept:"image/*,.pdf",onChange:ra,className:"hidden"}),e.jsx("div",{onClick:()=>{var s;return(s=Z.current)==null?void 0:s.click()},className:"w-full p-6 border-2 border-dashed border-blue-300 rounded-xl hover:border-blue-500 hover:bg-blue-50 transition-all cursor-pointer group",children:e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"fas fa-cloud-upload-alt text-4xl text-blue-400 group-hover:text-blue-600 mb-2 transition-colors"}),e.jsx("p",{className:"text-blue-600 font-medium group-hover:text-blue-700",children:"Click to upload files"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Support: JPG, PNG, PDF (Max 10MB)"})]})}),c.files.length>0&&e.jsxs("div",{className:"space-y-2 p-4 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("i",{className:"fas fa-check-circle text-green-600"}),e.jsxs("p",{className:"text-sm font-semibold text-gray-700",children:["Uploaded Files (",c.files.length,")"]})]}),e.jsx("div",{className:"max-h-48 overflow-y-auto space-y-2",children:c.files.map((s,a)=>e.jsxs("div",{className:"flex items-center gap-3 bg-white p-3 rounded-lg border border-gray-200 hover:border-blue-300 hover:shadow-md transition-all group",children:[s.type.startsWith("image")?e.jsx("img",{src:URL.createObjectURL(s)||vs,alt:s.name,className:"w-12 h-12 object-cover rounded-lg cursor-pointer hover:opacity-80 ring-2 ring-gray-200",onClick:()=>{T({isOpen:!0,type:"image",url:URL.createObjectURL(s)})}}):e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center",children:e.jsx("i",{className:"fas fa-file-pdf text-red-600 text-xl"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-gray-800 truncate font-medium",children:s.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[(s.size/1024).toFixed(2)," KB"]})]}),e.jsx("button",{onClick:()=>j(i=>({...i,files:i.files.filter((r,l)=>l!==a)})),className:"text-red-500 hover:text-white hover:bg-red-500 p-2 rounded-lg transition-all opacity-0 group-hover:opacity-100",title:"Delete file",children:e.jsx("i",{className:"fas fa-trash text-sm"})})]},a))})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:[e.jsx("input",{type:"checkbox",id:"messageRequired",checked:u.isMessageRequired,onChange:s=>R(a=>({...a,isMessageRequired:s.target.checked})),className:"w-5 h-5 accent-blue-600 cursor-pointer"}),e.jsxs("label",{htmlFor:"messageRequired",className:"text-sm text-gray-700 cursor-pointer font-medium flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-exclamation-circle text-amber-600"}),"Require additional message with response"]})]}),D&&e.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 text-red-700 rounded-lg flex items-start gap-3",children:[e.jsx("i",{className:"fas fa-exclamation-triangle text-xl mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Error"}),e.jsx("p",{className:"text-sm",children:D})]})]})]}),e.jsxs("div",{className:"bg-gray-50 px-6 py-4 border-t border-gray-200 flex gap-3",children:[e.jsx(S,{onClick:Zs,disabled:E,className:"flex-1 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-semibold py-3 rounded-lg shadow-md hover:shadow-lg transition-all disabled:opacity-50",children:E?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin mr-2"}),"Creating Ticket..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-check-circle mr-2"}),"Create Ticket"]})}),e.jsxs(S,{onClick:()=>U(!1),variant:"secondary",className:"flex-1 font-semibold py-3 rounded-lg",children:[e.jsx("i",{className:"fas fa-times-circle mr-2"}),"Cancel"]})]})]}),t?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-500 text-white p-4 rounded-t-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center",children:e.jsx("i",{className:"fas fa-clipboard-list text-blue-600 text-xl"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-white",children:"Ticket Details"}),e.jsxs("p",{className:"text-xs text-blue-100 flex items-center gap-1",children:[e.jsx("i",{className:"far fa-calendar-alt mr-1"}),new Date(t.createdAt).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),e.jsx("span",{className:"mx-1",children:"â€¢"}),new Date(t.createdAt).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})]})]})]}),e.jsx("div",{className:`px-3 py-1.5 rounded-lg font-semibold text-sm flex items-center gap-2 ${(oe=t==null?void 0:t.discussion[0])!=null&&oe.response?"bg-green-500 text-white":"bg-amber-500 text-white"}`,children:(de=t==null?void 0:t.discussion[0])!=null&&de.response?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-check-circle"}),e.jsx("span",{children:"Resolved"})]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-clock"}),e.jsx("span",{children:"Pending"})]})})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx("i",{className:"fas fa-user text-purple-600 text-xl"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Raised By"}),e.jsx("p",{className:"text-gray-900 font-semibold",children:((me=(ce=t.discussion[0])==null?void 0:ce.issue.raisedBy)==null?void 0:me.name)||"Unknown"}),e.jsx("p",{className:"text-xs text-gray-500",children:(pe=(xe=t.discussion[0])==null?void 0:xe.issue.raisedBy)==null?void 0:pe.email})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("i",{className:"fas fa-user-check text-blue-600 text-xl"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Assigned To"}),e.jsx("p",{className:"text-gray-900 font-semibold",children:((ue=(fe=t.discussion[0])==null?void 0:fe.issue.selectStaff)==null?void 0:ue.name)||"Unknown"}),e.jsx("p",{className:"text-xs text-gray-500",children:(ge=(he=t.discussion[0])==null?void 0:he.issue.selectStaff)==null?void 0:ge.email})]})]})})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"px-3 py-1 bg-indigo-100 text-indigo-700 rounded-full text-sm font-medium",children:[((be=t.discussion[0])==null?void 0:be.issue.responseType)==="dropdown"&&e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-list mr-2"}),"Dropdown Response"]}),((je=t.discussion[0])==null?void 0:je.issue.responseType)==="text"&&e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-keyboard mr-2"}),"Text Response"]}),((Ne=t.discussion[0])==null?void 0:Ne.issue.responseType)==="file"&&e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-file-upload mr-2"}),"File Upload Response"]})]})}),((ye=t.discussion[0])==null?void 0:ye.issue.selectStaff._id)===(x==null?void 0:x.id)&&!((ve=t.discussion[0])!=null&&ve.response)&&e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("i",{className:"fas fa-share text-amber-600"}),e.jsx("h3",{className:"font-semibold text-amber-900",children:"Forward Ticket"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"forwardstff",type:"checkbox",checked:q,onChange:()=>Ws(s=>!s),className:"w-4 h-4 text-blue-600 rounded"}),e.jsx(N,{htmlFor:"forwardstff",className:"cursor-pointer text-sm text-gray-700",children:"Enable forwarding (only if other staff is available)"})]}),q&&e.jsx(G,{options:ae,placeholder:"Choose staff to forward",searchPlaceholder:"Search by name...",value:zs,onValueChange:s=>{Xs(s)},searchBy:"name",displayFormat:"detailed",className:"w-full",enabled:q})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("i",{className:"fas fa-info-circle text-blue-600"}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"Ticket Description"})]}),e.jsx("p",{className:"text-gray-700 leading-relaxed whitespace-pre-wrap",children:(we=t.discussion[0])==null?void 0:we.issue.issue})]}),((Re=(ke=t==null?void 0:t.discussion[0])==null?void 0:ke.issue)==null?void 0:Re.files)&&((Ce=(Fe=(Se=t==null?void 0:t.discussion[0])==null?void 0:Se.issue)==null?void 0:Fe.files)==null?void 0:Ce.length)>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("i",{className:"fas fa-paperclip text-blue-600"}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"Ticket Attachments"}),e.jsxs("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full",children:[(Te=(Oe=t==null?void 0:t.discussion[0])==null?void 0:Oe.issue)==null?void 0:Te.files.length," file",((De=(_e=t==null?void 0:t.discussion[0])==null?void 0:_e.issue)==null?void 0:De.files.length)>1?"s":""]})]}),((Ae=(Pe=t==null?void 0:t.discussion[0])==null?void 0:Pe.issue)==null?void 0:Ae.files.some(s=>s.type==="image"))&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("i",{className:"fas fa-images text-purple-600"}),e.jsx("h4",{className:"font-semibold text-gray-800 text-sm",children:"Images"}),e.jsx("span",{className:"text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded-full",children:(Le=(Ie=t==null?void 0:t.discussion[0])==null?void 0:Ie.issue)==null?void 0:Le.files.filter(s=>s.type==="image").length})]}),e.jsx(ws,{imageFiles:(Ee=(Me=t==null?void 0:t.discussion[0])==null?void 0:Me.issue)==null?void 0:Ee.files.filter(s=>s.type==="image"),height:150,minWidth:150,maxWidth:200})]}),((Ue=(Be=t==null?void 0:t.discussion[0])==null?void 0:Be.issue)==null?void 0:Ue.files.some(s=>s.type==="pdf"))&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("i",{className:"fas fa-file-pdf text-red-600"}),e.jsx("h4",{className:"font-semibold text-gray-800 text-sm",children:"Documents"}),e.jsx("span",{className:"text-xs bg-red-100 text-red-700 px-2 py-1 rounded-full",children:(We=(qe=t==null?void 0:t.discussion[0])==null?void 0:qe.issue)==null?void 0:We.files.filter(s=>s.type==="pdf").length})]}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:(Ge=(ze=t==null?void 0:t.discussion[0])==null?void 0:ze.issue)==null?void 0:Ge.files.filter(s=>s.type==="pdf").map((s,a)=>e.jsxs("div",{className:"flex items-center gap-4 bg-gradient-to-r from-red-50 to-orange-50 p-4 rounded-lg border border-red-200 hover:shadow-md transition-all group",children:[e.jsx("div",{onClick:()=>{T({isOpen:!0,type:"pdf",url:s.url})},className:"w-14 h-14 bg-red-100 rounded-lg flex items-center justify-center cursor-pointer hover:bg-red-200 transition-colors",children:e.jsx("i",{className:"fas fa-file-pdf text-red-600 text-2xl"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900 truncate",children:s.originalName||`Document ${a+1}.pdf`}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[e.jsx("i",{className:"far fa-calendar mr-1"}),Na(s.uploadedAt)]})]}),e.jsxs("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"px-3 py-2 bg-white text-red-600 rounded-lg hover:bg-red-600 hover:text-white transition-colors font-medium text-sm group-hover:shadow-md",title:"Open in new tab",children:[e.jsx("i",{className:"fas fa-external-link-alt mr-1"}),"Open"]})]},a))})]})]}),((Ve=t.discussion[0])==null?void 0:Ve.response)&&e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-emerald-50 rounded-lg shadow-sm border border-blue-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx("i",{className:"fas fa-check text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-blue-900 text-lg",children:"Response Provided"}),e.jsxs("p",{className:"text-xs text-blue-700",children:[e.jsx("i",{className:"far fa-clock mr-1"}),new Date(($e=t.discussion[0])==null?void 0:$e.response.createdAt).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 mb-4",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Responded By"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx("i",{className:"fas fa-user text-blue-600 text-sm"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:((Ye=(He=t.discussion[0])==null?void 0:He.response.responsededBy)==null?void 0:Ye.name)||"Unknown"}),e.jsx("p",{className:"text-xs text-gray-500",children:(Je=(Ke=t.discussion[0])==null?void 0:Ke.response.responsededBy)==null?void 0:Je.email})]})]})]}),((Qe=t.discussion[0])==null?void 0:Qe.response.dropdownResponse)&&e.jsxs("div",{className:"bg-white rounded-lg p-4 mb-4",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Selected Option"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-check-circle text-green-600"}),e.jsx("p",{className:"font-bold text-gray-900",children:(Xe=t.discussion[0])==null?void 0:Xe.response.dropdownResponse})]})]}),((Ze=t.discussion[0])==null?void 0:Ze.response.textResponse)&&e.jsxs("div",{className:"bg-white rounded-lg p-4 mb-4",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Response Message"}),e.jsx("p",{className:"text-gray-700 leading-relaxed whitespace-pre-wrap",children:(es=t.discussion[0])==null?void 0:es.response.textResponse})]}),((ss=t.discussion[0])==null?void 0:ss.response.fileResponse)&&((as=t.discussion[0])==null?void 0:as.response.fileResponse.length)>0&&e.jsxs("div",{className:"bg-white rounded-lg p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("i",{className:"fas fa-paperclip text-gray-600"}),e.jsx("p",{className:"font-semibold text-gray-900",children:"Attached Files"}),e.jsx("span",{className:"text-xs bg-gray-100 text-gray-700 px-2 py-1 rounded-full",children:(ts=t.discussion[0])==null?void 0:ts.response.fileResponse.length})]}),((ls=t.discussion[0])==null?void 0:ls.response.fileResponse.some(s=>s.type==="image"))&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("i",{className:"fas fa-images text-purple-600"}),e.jsx("h5",{className:"font-semibold text-gray-800 text-sm",children:"Images"}),e.jsx("span",{className:"text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded-full",children:(is=t.discussion[0])==null?void 0:is.response.fileResponse.filter(s=>s.type==="image").length})]}),e.jsx(ws,{imageFiles:(rs=t.discussion[0])==null?void 0:rs.response.fileResponse.filter(s=>s.type==="image"),height:120,minWidth:120,maxWidth:140})]}),((ns=t.discussion[0])==null?void 0:ns.response.fileResponse.some(s=>s.type==="pdf"))&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("i",{className:"fas fa-file-pdf text-red-600"}),e.jsx("h5",{className:"font-semibold text-gray-800 text-sm",children:"Documents"}),e.jsx("span",{className:"text-xs bg-red-100 text-red-700 px-2 py-1 rounded-full",children:(os=t.discussion[0])==null?void 0:os.response.fileResponse.filter(s=>s.type==="pdf").length})]}),e.jsx("div",{className:"space-y-3",children:(ds=t.discussion[0])==null?void 0:ds.response.fileResponse.filter(s=>s.type==="pdf").map((s,a)=>e.jsxs("div",{className:"flex items-center gap-3 bg-gradient-to-r from-red-50 to-orange-50 p-3 rounded-lg border border-red-200 hover:shadow-md transition-all group",children:[e.jsx("div",{onClick:()=>{T({isOpen:!0,type:"pdf",url:s.url})},className:"w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center cursor-pointer hover:bg-red-200 transition-colors",children:e.jsx("i",{className:"fas fa-file-pdf text-red-600 text-xl"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900 truncate",children:s.originalName||`Document ${a+1}`}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:new Date(s.uploadedAt).toLocaleDateString()})]}),e.jsxs("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"px-3 py-1.5 bg-white text-red-600 rounded-lg hover:bg-red-600 hover:text-white transition-colors text-sm font-medium",title:"Open in new tab",children:[e.jsx("i",{className:"fas fa-external-link-alt mr-1"}),"Open"]})]},a))})]})]}),((cs=t.discussion[0])==null?void 0:cs.response.optionalMessage)&&e.jsxs("div",{className:"bg-white rounded-lg p-4",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Additional Message"}),e.jsx("p",{className:"text-gray-700 leading-relaxed whitespace-pre-wrap",children:(ms=t.discussion[0])==null?void 0:ms.response.optionalMessage})]})]}),le&&!((xs=t.discussion[0])!=null&&xs.response)&&e.jsxs("div",{className:"bg-white rounded-lg shadow-lg border border-blue-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx("i",{className:"fas fa-reply text-white"})}),e.jsx("h3",{className:"font-bold text-blue-900 text-lg",children:"Provide Your Response"})]}),e.jsxs("div",{className:"space-y-5",children:[((ps=t.discussion[0])==null?void 0:ps.issue.responseType)==="text"&&e.jsxs("div",{children:[e.jsxs(N,{className:"text-gray-700 font-semibold mb-2 block",children:[e.jsx("i",{className:"fas fa-keyboard mr-2 text-blue-600"}),"Your Response"]}),e.jsx(z,{value:f.content||"",onChange:s=>O(a=>({...a,content:s.target.value})),placeholder:"Type your detailed response here...",className:"w-full min-h-32 border-gray-300 focus:border-blue-500 focus:ring-blue-500"})]}),((fs=t.discussion[0])==null?void 0:fs.issue.responseType)==="dropdown"&&e.jsxs("div",{children:[e.jsxs(N,{className:"text-gray-700 font-semibold mb-2 block",children:[e.jsx("i",{className:"fas fa-list mr-2 text-blue-600"}),"Select Your Response"]}),e.jsxs("select",{value:f.content||"",onChange:s=>O(a=>({...a,content:s.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"-- Choose an option --"}),(hs=(us=t.discussion[0])==null?void 0:us.issue.dropdownOptions)==null?void 0:hs.map((s,a)=>e.jsx("option",{value:s,children:s},a))]})]}),((gs=t.discussion[0])==null?void 0:gs.issue.responseType)==="file"&&e.jsxs("div",{children:[e.jsxs(N,{className:"text-gray-700 font-semibold mb-2 block",children:[e.jsx("i",{className:"fas fa-upload mr-2 text-blue-600"}),"Upload Response Files"]}),e.jsx("input",{ref:X,type:"file",multiple:!0,accept:"image/*,.pdf",onChange:ia,className:"hidden"}),e.jsxs("div",{onClick:()=>{var s;return(s=X.current)==null?void 0:s.click()},className:"w-full p-8 border-2 border-dashed border-blue-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-all cursor-pointer text-center group",children:[e.jsx("i",{className:"fas fa-cloud-upload-alt text-4xl text-blue-400 group-hover:text-blue-600 mb-3"}),e.jsx("p",{className:"text-blue-600 font-semibold group-hover:text-blue-700",children:"Click to upload files"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Supports Images and PDF documents"})]}),f.files.length>0&&e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-700",children:"Uploaded Files"}),e.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full",children:f.files.length})]}),e.jsx("div",{className:"max-h-64 overflow-y-auto space-y-2",children:f.files.map((s,a)=>e.jsxs("div",{className:"flex items-center gap-3 bg-gray-50 p-3 rounded-lg border border-gray-200 hover:bg-gray-100 transition-colors",children:[s.type.startsWith("image")?e.jsx("img",{src:URL.createObjectURL(s),alt:s.name,className:"w-14 h-14 object-cover rounded-lg cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>{T({isOpen:!0,type:"image",url:URL.createObjectURL(s)})}}):e.jsx("div",{className:"w-14 h-14 bg-red-100 rounded-lg flex items-center justify-center",children:e.jsx("i",{className:"fas fa-file-pdf text-red-600 text-xl"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900 truncate",children:s.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[(s.size/1024).toFixed(2)," KB"]})]}),e.jsx("button",{onClick:()=>O(i=>({...i,files:i.files.filter((r,l)=>l!==a)})),className:"text-red-500 hover:text-white hover:bg-red-500 p-2 rounded-lg transition-colors",title:"Remove file",children:e.jsx("i",{className:"fas fa-trash"})})]},a))})]})]}),((bs=t.discussion[0])==null?void 0:bs.issue.isMessageRequired)&&e.jsxs("div",{children:[e.jsxs(N,{className:"text-gray-700 font-semibold mb-2 block",children:[e.jsx("i",{className:"fas fa-comment mr-2 text-blue-600"}),"Additional Message ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(z,{value:f.message||"",onChange:s=>O(a=>({...a,message:s.target.value})),placeholder:"Add any additional comments or explanations...",className:"w-full min-h-24 border-gray-300 focus:border-blue-500 focus:ring-blue-500"})]}),D&&e.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 text-red-700 rounded-lg flex items-start gap-3",children:[e.jsx("i",{className:"fas fa-exclamation-triangle mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Error"}),e.jsx("p",{className:"text-sm",children:D})]})]}),e.jsx(S,{onClick:aa,disabled:$,className:"w-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-bold py-3 rounded-lg shadow-lg hover:shadow-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:$?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin mr-2"}),"Submitting Response..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-paper-plane mr-2"}),"Submit Response"]})})]})]}),!le&&!((js=t.discussion[0])!=null&&js.response)&&e.jsx("div",{className:"bg-amber-50 border-l-4 border-amber-500 p-6 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("i",{className:"fas fa-info-circle text-amber-600 text-xl mt-1"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-amber-900",children:"Not Assigned"}),e.jsx("p",{className:"text-sm text-amber-700 mt-1",children:"You are not assigned to respond to this ticket. Only the assigned staff member can provide a response."})]})]})}),((Ns=t.discussion[0])==null?void 0:Ns.response)&&e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-6 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("i",{className:"fas fa-check-circle text-blue-600 text-xl mt-1"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-blue-900",children:"Ticket Resolved"}),e.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"This ticket has been successfully resolved."})]})]})})]})]})}):B?null:e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"fas fa-hand-pointer text-5xl mb-4 opacity-50"}),e.jsx("p",{className:"font-semibold",children:"Select a ticket to view details"}),e.jsx("p",{className:"text-sm",children:"Click on any ticket from the left panel"})]})})]}),v.isOpen&&e.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",onClick:()=>T({isOpen:!1,type:null,url:""}),children:e.jsxs("div",{className:"bg-white rounded-lg max-w-3xl w-full max-h-[90vh] overflow-auto flex flex-col",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 sticky top-0 bg-white",children:[e.jsxs("h3",{className:"font-bold text-gray-800",children:[e.jsx("i",{className:`fas ${v.type==="pdf"?"fa-file-pdf text-red-500":"fa-image text-blue-500"} mr-2`}),v.type==="pdf"?"PDF Preview":"Image Preview"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("a",{href:v.url,target:"_blank",rel:"noopener noreferrer",className:"px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white rounded text-sm font-medium flex items-center gap-1",children:[e.jsx("i",{className:"fas fa-external-link-alt"}),"Open in New Tab"]}),e.jsxs("button",{onClick:()=>T({isOpen:!1,type:null,url:""}),className:"px-3 py-1 bg-gray-300 hover:bg-gray-400 text-gray-800 rounded text-sm font-medium",children:[e.jsx("i",{className:"fas fa-times"}),"Close"]})]})]}),e.jsxs("div",{className:"flex-1 flex items-center justify-center p-4 bg-gray-50",children:[v.type==="image"&&e.jsx("img",{src:v.url||vs,alt:"Preview",className:"max-w-full max-h-full object-contain rounded-lg shadow-lg"}),v.type==="pdf"&&e.jsx("iframe",{src:v.url,className:"w-full h-full rounded-lg",title:"PDF Preview"})]})]})})]})]})},Ea=ks,Ba=()=>e.jsx("main",{className:"w-screen h-screen",children:e.jsx(ks,{})});export{Ea as IssueDiscussionPage,Ba as default};
