import{r as T,u as B,a as _,f as fe,F as z,E as K,j as e,L as F,B as G,U as V,V as H,W as Q,X,Y as J,Z,t as U,R as ue}from"./index-ogMTmcqi.js";import{M as xe,b as me,C as D}from"./constants-BoN4q75_.js";import{b as q}from"./CTOApi-AqugB15K.js";import{b as ee}from"./clientApi-Bm5o0Hmq.js";import{b as se}from"./staffApi-BVtzq88e.js";import{d as te}from"./userApi-xFtNT7SR.js";import{b as oe}from"./workerApi-MmsHUaVi.js";import{u as ae}from"./stageSelectionApi-B7pZfvf8.js";function ge(d,f){T.useEffect(()=>{const N=i=>{i.ctrlKey&&i.key==="]"?(i.preventDefault(),f()):i.ctrlKey&&i.key==="["&&(i.preventDefault(),d())};window.addEventListener("keydown",N)},[f,d])}const Ne=(d,f,N,i,h)=>{const L=i==null?void 0:i.some(s=>s.toLowerCase()==="projectdetails");let u={},x={},c={};if(L){let s=["DOCUMENTATION","INVENTORY","WORKERS","INVITECLIENT","PREREQUISTIES","REQUIREMENTFORM","SITEMEASUREMENT","SAMPLEDESIGN","WORKSCHEDULE","TECHNICALCONSULTANT","SELECTSTAGE","PAYMENTCONFIRMATION","QUOTEPDF","ORDERMATERIALS","MATERIALARRIVED","INSTALLATION","QUALITYCHECK","CLEANINGSANITATION","PROJECTDELIVERY"];const o=s.indexOf("TECHNICALCONSULTANT")+1;d==="Manual Flow"?s.splice(o,0,"MATERIALSELECTION","COSTESTIMATION"):d==="Modular Units"&&s.splice(o,0,"MODULARUNIT","EXTERNAL"),d!=null&&(s=s.filter(t=>t!=="SELECTSTAGE"));for(const t of s)f[t]&&h[t]&&N[t]&&(u[t]=f[t],x[t]=h[t],c[t]=N[t])}else u=f,x=h,c=N;let j=1,m=!1;const E={};for(const s of Object.keys(u))s==="REQUIREMENTFORM"&&(m=!0),m?(E[s]=`${j} ${u[s]}`,j++):E[s]=u[s];return{filteredLabels:E,filteredIcons:x,filteredPaths:c}},he=({labels:d,icons:f,path:N,setProjectName:i,projectName:h})=>{const[L,u]=T.useState(!1),{projectId:x}=B(),c=_(),j=fe(),m=j.pathname.split("/"),{organizationId:E}=B(),s=z(),{role:p}=K(n=>n.authStore),[o,t]=T.useState(""),{data:g,isLoading:k}=ae(x),{mutateAsync:v,isPending:S}=q(),{mutateAsync:y,isPending:I}=ee(),{mutateAsync:C,isPending:A}=se(),{mutateAsync:M,isPending:R}=te(),{mutateAsync:$,isPending:r}=oe();T.useEffect(()=>{i&&g&&g.projectName&&i(g.projectName||"Project")},[g]);const a=()=>{u(!1)},b=()=>{u(!0)},ne=m[2]==="projectdetails";T.useEffect(()=>{const l=j.pathname.split("/")[4];t(L?()=>xe[l]:()=>me[l])},[j.pathname,L]),ge(b,a);const ie=!k&&(g==null?void 0:g.mode);let{filteredLabels:re,filteredIcons:le,filteredPaths:O}=Ne(ie,d,N,m,f);const Y=m[2]==="projectdetails",ce=m[1]==="login",de=()=>{Y&&c(`/organizations/${E}/projects`),ce&&c("/organizations")},W=async()=>{var n,l;try{p==="CTO"?await v():p==="client"?await y():p==="staff"?await C():p==="owner"?await M():p==="worker"&&await $(),s(V()),s(H()),s(Q()),s(X()),s(J()),s(Z()),U({title:"Success",description:"logout successfull"}),(!S||!I||!A||!R||!r)&&c("/")}catch(w){U({title:"Error",description:((l=(n=w==null?void 0:w.response)==null?void 0:n.data)==null?void 0:l.message)||"Failed to logout",variant:"destructive"})}};return e.jsx(e.Fragment,{children:L?e.jsxs("aside",{onMouseLeave:()=>u(!1),className:"relative flex flex-col bg-[#2f303a] w-[17%] min-h-screen max-h-screen text-[#9ca3af] select-none transition-all duration-300",children:[e.jsxs("div",{className:"flex flex-col flex-grow overflow-y-auto overflow-x-hidden custom-scrollbar p-2 large-scrollbar",children:[e.jsxs("div",{onClick:de,className:`flex ${Y?"cursor-pointer":""} justify-between items-center border-b-1 py-2`,children:[e.jsx("span",{className:"text-xl",children:ne?h||"Project":D.COMPANY_NAME}),e.jsx("div",{className:"w-[30px] h-[30px]",children:e.jsx("img",{className:"w-full h-full",src:D.COMPANY_LOGO,alt:"LOGO"})})]}),e.jsxs("section",{className:"py-2 space-y-2",children:[" ",Object.entries(re).map(([n,l])=>{const w=o===l;return O[n]&&e.jsx(F,{to:O[n],className:"outline-none",children:e.jsxs("div",{onClick:()=>t(l),className:`cursor-pointer flex justify-between max-w-[95%] py-4 px-4 ${o===l?"bg-[#3a3b45] rounded-xl text-white":"rounded-xl hover:bg-[#3a3b45]"} `,ref:P=>{w&&P&&P.scrollIntoView({behavior:"smooth",block:"center"})},children:[e.jsx("span",{className:"text-lg",children:l}),e.jsx("span",{children:e.jsx("i",{className:"fa-solid fa-chevron-right"})})]})},l)})]})]}),e.jsxs("div",{className:"flex flex-col p-2 border-t border-[#3a3b45]",children:[m[1]!=="login"&&e.jsxs(G,{isLoading:S||I||A||R||r,onClick:W,className:"flex items-center gap-2 px-4 py-3 rounded-lg !bg-[#3a3b45] !text-[#9ca3af] hover:!bg-[#464751] hover:!text-white transition",children:[e.jsx("i",{className:"fa-solid fa-right-from-bracket"}),e.jsx("span",{children:"Logout"})]}),e.jsx("button",{title:"Ctrl+] to close",onClick:a,className:"mt-2 flex items-center justify-center outline-none border border-blue-600 text-blue-500 hover:bg-[#3a3b45] rounded-lg w-full py-2",children:e.jsx("i",{className:"fa-solid fa-chevron-left"})})]})]}):e.jsxs("aside",{onMouseEnter:()=>u(!0),className:"flex flex-col relative justify-between bg-[#2f303a] w-[6%]  max-h-full  text-[#9ca3af] transition-all duration-300 ",children:[e.jsx("div",{className:"max-h-[95%] overflow-y-auto overflow-x-hidden custom-scrollbar ",children:e.jsx("div",{className:"flex items-center flex-col justify-between w-full",children:Object.entries(le).map(([n,l])=>{const w=(o==null?void 0:o.toLowerCase())===n.toLowerCase();return O[n]?e.jsx(F,{to:O[n],className:`${O[n]?"":"cursor-not-allowed"}`,children:e.jsx("div",{onClick:()=>t(n),className:`cursor-pointer flex justify-between max-w-[95%] py-4 px-4 ${(o==null?void 0:o.toLowerCase())===n.toLowerCase()?"bg-[#3a3b45] rounded-xl text-white":"rounded-xl hover:bg-[#3a3b45]"} `,ref:P=>{w&&P&&P.scrollIntoView({behavior:"smooth",block:"center"})},children:e.jsx("i",{className:`${l} ${(o==null?void 0:o.toLowerCase())===n.toLowerCase()?"text-[#4a86f7]":"text-[#9ca3af]"} `})})},n):e.jsx("div",{className:"cursor-not-allowed flex justify-between max-w-[95%] py-4 px-4",children:e.jsx("i",{className:`${l}`})})})})}),e.jsxs("div",{className:"flex flex-col items-center p-2 border-t border-[#3a3b45]",children:[m[1]!=="login"&&e.jsx(G,{isLoading:S||I||A||R||r,title:"logout",onClick:W,className:"w-[40px] h-[40px] flex items-center justify-center !bg-[#3a3b45] !text-[#9ca3af] hover:!text-red-500 transition",children:e.jsx("i",{className:"fa-solid fa-right-from-bracket"})}),e.jsx("button",{title:"Ctrl+[ to open",onClick:b,className:"mt-2 cursor-pointer outline-none border-[#9ca3af] h-[40px] w-[40px] flex items-center justify-center border rounded-lg",children:e.jsx("i",{className:"fa-solid fa-chevron-right text-[#4a86f7]"})})]})]})})},Te=T.memo(he),Se=({isOpen:d,onClose:f,labels:N,path:i})=>{const h=_(),{organizationId:L,projectId:u}=B(),x=z(),{role:c}=K(r=>r.authStore),{data:j,isLoading:m}=ae(u),{mutateAsync:E,isPending:s}=q(),{mutateAsync:p,isPending:o}=ee(),{mutateAsync:t,isPending:g}=se(),{mutateAsync:k,isPending:v}=te(),{mutateAsync:S,isPending:y}=oe(),I=async()=>{var r,a;try{c==="CTO"?await E():c==="client"?await p():c==="staff"?await t():c==="owner"?await k():c==="worker"&&await S(),x(V()),x(H()),x(Q()),x(X()),x(J()),x(Z()),U({title:"Success",description:"logout successfull"}),(!s||!o||!g||!v||!y)&&h("/")}catch(b){U({title:"Error",description:((a=(r=b==null?void 0:b.response)==null?void 0:r.data)==null?void 0:a.message)||"Failed to logout",variant:"destructive"})}};let C=Object.entries(N);const A=location.pathname.split("/"),M=A[2]==="projectdetails";if(A.includes("projectdetails")&&!m){const r=j.mode;C=C.filter(([a])=>{if(r){if(r==="Modular Units")return a!=="MATERIALSELECTION"&&a!=="COSTESTIMATION"&&a!=="SELECTSTAGE";if(r==="Manual Flow")return a!=="MODULARUNIT"&&a!=="SELECTSTAGE"}else return a!=="MODULARUNIT"&&a!=="MATERIALSELECTION"&&a!=="COSTESTIMATION";return!0})}const $=()=>{M&&h(`/organizations/${L}/projects`)};return e.jsxs(e.Fragment,{children:[d&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40",onClick:f}),e.jsxs("aside",{className:`fixed top-0 left-0 z-50 h-screen bg-white w-[75%] flex flex-col transition-transform duration-300 ${d?"translate-x-0":"-translate-x-full"}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsxs("div",{onClick:$,className:`flex items-center gap-3 ${M?"cursor-pointer":""}`,children:[e.jsx("img",{src:D.COMPANY_LOGO,alt:"Logo",className:"w-10 h-10 rounded-full object-cover"}),e.jsx("span",{className:"text-lg font-semibold",children:D.COMPANY_NAME})]}),e.jsx("button",{onClick:f,className:"text-xl text-gray-700",children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsx("nav",{className:"flex flex-col flex-grow overflow-y-auto p-4",children:C.map(([r,a],b)=>e.jsxs(ue.Fragment,{children:[i[r]?e.jsx(F,{to:i[r],onClick:f,className:"text-gray-800 hover:bg-gray-100 p-3 rounded block",children:a}):e.jsx("span",{className:"text-gray-400 p-3 rounded cursor-not-allowed block",children:a}),b<C.length-1&&e.jsx("hr",{className:"border-t border-gray-200 my-1"})]},r))}),e.jsx("div",{className:"border-t border-gray-200 p-4",children:A[1]!=="login"&&e.jsxs(G,{className:"w-full flex items-center justify-center gap-2",isLoading:s||o||g||v||y,onClick:I,children:[e.jsx("i",{className:"fas fa-sign-out-alt"})," Logout"]})})]})]})};export{Se as M,Te as S};
