import{a as ue,u as he,b as ge,r as n,j as e}from"./index-BZjlY-2Z.js";import{t as p}from"./toast-BSC5QTk1.js";import{b as pe,c as xe,d as fe}from"./modularUnitNewApi-QMXF8G8G.js";import{C as T,b as $,d as B,a as z}from"./Card-CmzT6E3j.js";import{L as c}from"./Label-D3bfhfMc.js";import{I as o}from"./Input-BDSEJtPI.js";import{B as f}from"./Button-BGBzZFjk.js";import{T as H}from"./TextArea-B7_xSYCx.js";import"./useQuery-Coz1VCY2.js";import"./useMutation-BRRIqsxx.js";import"./useInfiniteQuery--LmPAkvr.js";import"./roleCheck-DuKNZHKs.js";const je=({mode:l,unitId:j})=>{var k,M;const y=ue(),{organizationId:O}=he(),{mutate:W,isPending:G}=pe(),{mutateAsync:K,isPending:_}=xe(),{data:i,isLoading:J}=fe(l==="edit"&&j?j:""),{role:C,permission:u}=ge(),Q=C==="owner"||((k=u==null?void 0:u.modularunit)==null?void 0:k.create),X=C==="owner"||((M=u==null?void 0:u.modularunit)==null?void 0:M.edit),w={productName:"",serialNo:"",category:"",description:"",dimention:{height:0,width:0,depth:0},totalAreaSqFt:"",materialsNeeded:"",fabricationCost:"",timeRequired:"",attributes:[]},[a,h]=n.useState(w),[I,Y]=n.useState([]),[q,F]=n.useState([]),[S,Z]=n.useState([]),[P,A]=n.useState([]),[R,ee]=n.useState([]),[U,E]=n.useState([]),[te,se]=n.useState(!1),[ae,ie]=n.useState(!1),[re,ce]=n.useState(!1),[N,D]=n.useState("");n.useEffect(()=>{var t,s,r,d,g,V;l==="edit"&&i&&(h({productName:i.productName||"",serialNo:i.serialNo||"",category:i.category||"",description:i.description||"",dimention:{height:((t=i.dimention)==null?void 0:t.height)||0,width:((s=i.dimention)==null?void 0:s.width)||0,depth:((r=i.dimention)==null?void 0:r.depth)||0},totalAreaSqFt:((d=i.totalAreaSqFt)==null?void 0:d.toString())||"",materialsNeeded:i.materialsNeeded||"",fabricationCost:((g=i.fabricationCost)==null?void 0:g.toString())||"",timeRequired:((V=i.timeRequired)==null?void 0:V.toString())||"",attributes:i.attributes||[]}),i.productImages&&F(i.productImages.map(x=>x.url)),i["2dImages"]&&A(i["2dImages"].map(x=>x.url)),i["3dImages"]&&E(i["3dImages"].map(x=>x.url)))},[l,i]);const m=(t,s)=>{h(r=>({...r,[t]:s}))},v=(t,s)=>{h(r=>({...r,dimention:{...r.dimention,[t]:s}}))},le=t=>{const s=Array.from(t.target.files||[]);Y(s);const r=s.map(d=>URL.createObjectURL(d));F(r),l==="edit"&&se(!0)},de=t=>{const s=Array.from(t.target.files||[]);Z(s);const r=s.map(d=>URL.createObjectURL(d));A(r),l==="edit"&&ie(!0)},ne=t=>{const s=Array.from(t.target.files||[]);ee(s);const r=s.map(d=>URL.createObjectURL(d));E(r),l==="edit"&&ce(!0)},L=()=>{N.trim()&&(h(t=>({...t,attributes:[...t.attributes,N.trim()]})),D(""))},oe=t=>{h(s=>({...s,attributes:s.attributes.filter((r,d)=>d!==t)}))},me=async t=>{var r,d;if(t.preventDefault(),!a.productName.trim()){p({title:"Error",description:"Product name is required",variant:"destructive"});return}if(!a.category){p({title:"Error",description:"Category is required",variant:"destructive"});return}if(!a.fabricationCost||Number(a.fabricationCost)<=0){p({title:"Error",description:"Valid fabrication cost is required",variant:"destructive"});return}const s={...a,dimention:{height:a.dimention.height||void 0,width:a.dimention.width||void 0,depth:a.dimention.depth||void 0},totalAreaSqFt:a.totalAreaSqFt||void 0,fabricationCost:a.fabricationCost||void 0,timeRequired:a.timeRequired||void 0};try{l==="create"?(await W({organizationId:O,formValues:s,productImages:I,images2d:S,images3d:R}),p({title:"Success",description:"Product created successfully!"}),h(w)):(await K({unitId:j,formValues:s,productImages:I,images2d:S,images3d:R,replaceProductImages:te,replace2dImages:ae,replace3dImages:re}),p({title:"Success",description:"Product updated successfully!"}))}catch(g){p({title:"Error",description:((d=(r=g==null?void 0:g.response)==null?void 0:r.data)==null?void 0:d.message)||`Failed to ${l} product`,variant:"destructive"})}};if(l==="edit"&&J)return e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx("i",{className:"fas fa-spinner fa-spin text-4xl text-gray-400"})});const b=G||_;return e.jsx("div",{className:"min-h-full bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-full mx-auto",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>y(-1),className:"flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-arrow-left"}),"Back"]}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:l==="create"?"Create New Product":"Edit Product"})]})}),e.jsxs("form",{onSubmit:me,className:"space-y-6",children:[e.jsxs(T,{children:[e.jsx($,{children:e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-images text-blue-600"}),"Product Images"]})}),e.jsx(z,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"productImages",className:"text-sm font-medium",children:[e.jsx("i",{className:"fas fa-image mr-1 text-pink-600"}),"Product Images"]}),e.jsx(o,{id:"productImages",type:"file",accept:"image/*",multiple:!0,onChange:le,className:"cursor-pointer text-xs"}),q.length>0&&e.jsx("div",{className:"grid grid-cols-3 gap-2 mt-2",children:q.map((t,s)=>e.jsx("div",{className:"relative aspect-square rounded overflow-hidden border",children:e.jsx("img",{src:t,alt:`Product ${s+1}`,className:"w-full h-full object-cover"})},s))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"images2d",className:"text-sm font-medium",children:[e.jsx("i",{className:"fas fa-draw-polygon mr-1 text-cyan-600"}),"2D Images"]}),e.jsx(o,{id:"images2d",type:"file",accept:"image/*",multiple:!0,onChange:de,className:"cursor-pointer text-xs"}),P.length>0&&e.jsx("div",{className:"grid grid-cols-3 gap-2 mt-2",children:P.map((t,s)=>e.jsx("div",{className:"relative aspect-square rounded overflow-hidden border border-cyan-200",children:e.jsx("img",{src:t,alt:`2D ${s+1}`,className:"w-full h-full object-cover"})},s))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"images3d",className:"text-sm font-medium",children:[e.jsx("i",{className:"fas fa-cube mr-1 text-indigo-600"}),"3D Images"]}),e.jsx(o,{id:"images3d",type:"file",accept:"image/*",multiple:!0,onChange:ne,className:"cursor-pointer text-xs"}),U.length>0&&e.jsx("div",{className:"grid grid-cols-3 gap-2 mt-2",children:U.map((t,s)=>e.jsx("div",{className:"relative aspect-square rounded overflow-hidden border border-indigo-200",children:e.jsx("img",{src:t,alt:`3D ${s+1}`,className:"w-full h-full object-cover"})},s))})]})]})})]}),e.jsxs(T,{children:[e.jsx($,{children:e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-info-circle text-blue-600"}),"Product Details"]})}),e.jsxs(z,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"productName",children:["Product Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(o,{id:"productName",placeholder:"Enter product name",value:a.productName,onChange:t=>m("productName",t.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"fabricationCost",children:["Fabrication Cost (â‚¹) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(o,{id:"fabricationCost",type:"number",placeholder:"Enter fabrication cost",value:a.fabricationCost,onChange:t=>m("fabricationCost",t.target.value),required:!0})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"category",children:["Category ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(o,{id:"Category",placeholder:"Enter Category",value:a.category,onChange:t=>m("category",t.target.value)})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-ruler-combined text-purple-600"}),"Dimensions (mm)"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{htmlFor:"height",className:"text-xs text-gray-600",children:"Height"}),e.jsx(o,{id:"height",type:"number",placeholder:"H",value:a.dimention.height||"",onChange:t=>v("height",+t.target.value),className:"text-sm"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{htmlFor:"width",className:"text-xs text-gray-600",children:"Width"}),e.jsx(o,{id:"width",type:"number",placeholder:"W",value:a.dimention.width||"",onChange:t=>v("width",+t.target.value),className:"text-sm"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{htmlFor:"depth",className:"text-xs text-gray-600",children:"Depth"}),e.jsx(o,{id:"depth",type:"number",placeholder:"D",value:a.dimention.depth||"",onChange:t=>v("depth",+t.target.value),className:"text-sm"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"timeRequired",children:"Time Required (days)"}),e.jsx(o,{id:"timeRequired",type:"number",placeholder:"Enter time required",value:a.timeRequired,onChange:t=>m("timeRequired",t.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"totalAreaSqFt",children:"Total Area (sq ft)"}),e.jsx(o,{id:"totalAreaSqFt",type:"number",placeholder:"Enter total area",value:a.totalAreaSqFt,onChange:t=>m("totalAreaSqFt",t.target.value)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"materialsNeeded",children:"Materials Needed"}),e.jsx(H,{id:"materialsNeeded",placeholder:"Enter materials needed",value:a.materialsNeeded,onChange:t=>m("materialsNeeded",t.target.value),rows:2,className:"text-sm"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-tags text-orange-600"}),"Attributes"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{placeholder:"Add attribute (e.g., modern, wooden)",value:N,onChange:t=>D(t.target.value),onKeyPress:t=>{t.key==="Enter"&&(t.preventDefault(),L())},className:"text-sm flex-1"}),e.jsx(f,{type:"button",onClick:L,variant:"outline",size:"sm",className:"px-3",children:e.jsx("i",{className:"fas fa-plus"})})]}),a.attributes.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1.5 mt-2",children:a.attributes.map((t,s)=>e.jsxs("span",{className:"px-2 py-1 bg-blue-50 text-blue-700 rounded-full text-xs flex items-center gap-1.5",children:[t,e.jsx("button",{type:"button",onClick:()=>oe(s),className:"hover:text-red-600 transition-colors",children:e.jsx("i",{className:"fas fa-times text-[10px]"})})]},s))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"description",children:"Description"}),e.jsx(H,{id:"description",placeholder:"Enter product description",value:a.description,onChange:t=>m("description",t.target.value),rows:3,className:"text-sm"})]})]})]}),(Q||X)&&e.jsxs("div",{className:"flex items-center justify-end gap-4 sticky bottom-0 bg-white p-4  rounded-lg shadow-lg",children:[e.jsxs(f,{type:"button",variant:"outline",onClick:()=>y(-1),disabled:b,children:[e.jsx("i",{className:"fas fa-times mr-2"}),"Cancel"]}),e.jsx(f,{type:"submit",isLoading:b,className:"min-w-[150px]",children:b?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin mr-2"}),l==="create"?"Creating...":"Updating..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:`fas ${l==="create"?"fa-plus":"fa-save"} mr-2`}),l==="create"?"Create Product":"Update Product"]})})]})]})]})})},Re=()=>e.jsxs("main",{className:"max-h-full overflow-y-auto",children:[e.jsx(je,{mode:"create"}),";"]});export{Re as default};
