import{c as F,b as R,j as e}from"./index-DcYk0AxP.js";import{u as M,c as P,d as T}from"./paymentConfirmationApi-C467RK_a.js";import{t as i}from"./toast-BSC5QTk1.js";import{B as r}from"./Button-BYLj5R3i.js";import $ from"./MaterialOverviewLoading-f9oih_oM.js";import"./useQuery-BPoeBSke.js";import"./useBaseQuery-D96Ix8rH.js";import"./useMutation-BbhnaANP.js";import"./roleCheck-D-Yu12LV.js";import"./Skeleton-ByHYgW3B.js";const E=()=>{var u,j;const{projectId:l,organizationId:f}=F(),N=R(),{data:x,isLoading:v,isError:y,refetch:c,error:n}=M(l),p=P(),g=T(),w=t=>{navigator.clipboard.writeText(t),i({title:"Copied",description:"Link copied to clipboard."})},C=t=>{const a=`Please review and approve the payment consent:

${t}`,s=encodeURIComponent(a);window.open(`https://wa.me/?text=${s}`,"_blank")},k=async()=>{var t,a;try{await p.mutateAsync({projectId:l}),i({title:"Success",description:"Consent requirement updated."}),c()}catch(s){i({title:"Error",description:((a=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:a.message)||s.message,variant:"destructive"})}},L=async()=>{var t,a;try{await g.mutateAsync({projectId:l}),i({title:"Success",description:"Consent link generated."}),c()}catch(s){i({title:"Error",description:((a=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:a.message)||s.message,variant:"destructive"})}};if(v)return e.jsx($,{});if(y||!x)return e.jsxs("div",{className:"max-w-xl mx-auto p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center mb-6",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2",children:"⚠️ Error Occurred"}),e.jsx("p",{className:"text-red-500 text-sm mb-4",children:((j=(u=n==null?void 0:n.response)==null?void 0:u.data)==null?void 0:j.message)||(n==null?void 0:n.message)||"Failed to load cost estimation data"}),e.jsx(r,{onClick:()=>c(),className:"bg-red-600 text-white px-4 py-2",children:"Retry"})]});const{isConsentRequired:m,paymentClientConsent:{content:S,agreedAt:o,isAgreed:h,agreementToken:b,link:d}}=x;return e.jsxs("div",{className:"space-y-6 w-full max-w-full max-h-full sm:overflow-y-auto mx-auto custom-scrollbar",children:[e.jsxs("div",{className:"flex justify-between items-center border-b pb-3",children:[e.jsxs("h2",{className:"text-lg sm:text-2xl  lg:text-3xl font-bold text-blue-700 flex items-center",children:[e.jsx("i",{className:"hidden sm:block fa-solid fa-handshake-angle mr-[3px] sm:mr-2"})," Client Consent"]}),e.jsxs("div",{className:"space-x-1",children:[e.jsx(r,{isLoading:p.isPending,size:"sm",onClick:k,className:`text-sm text-white px-2 py-2 rounded ${m?"bg-red-600 hover:bg-red-700":"bg-green-600 hover:bg-green-700"}`,children:m?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"hidden sm:inline",children:"Make Consent Optional"}),e.jsx("span",{className:"inline sm:hidden",children:"Make Optional"})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"hidden sm:inline",children:"Require Client Consent"}),e.jsx("span",{className:"inline sm:hidden",children:"Make Mandatory"})]})}),e.jsx(r,{variant:"primary",onClick:()=>N(`/${f}/projectdetails/${l}/paymentconfirmation`),children:"Back"})]})]}),e.jsxs("div",{className:"rounded-lg shadow border border-blue-200 overflow-hidden",children:[e.jsx("div",{className:"bg-blue-50 px-5 py-3 flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2 font-semibold text-blue-700 text-lg",children:[e.jsx("i",{className:"fa-solid fa-circle-info"}),"Consent Status"]})}),e.jsx("div",{className:"p-4",children:o?e.jsxs("div",{className:"bg-green-50 p-4 rounded text-green-800 text-sm border border-green-200 shadow-sm",children:[e.jsx("span",{className:"mr-2",children:"Client Status:"}),e.jsx("strong",{className:"mr-2",children:h?e.jsxs(e.Fragment,{children:["Agreed ",e.jsx("i",{className:"fa-solid fa-circle-check text-green-600 mr-2"})]}):h===null?"Not Agreed Yet":e.jsxs(e.Fragment,{children:["Not Agreed ",e.jsx("i",{className:"fa-solid fa-circle-xmark text-red-600 mr-2"})]})}),e.jsx("br",{}),e.jsxs("span",{children:["Agreed on: ",e.jsx("strong",{children:new Date(o).toLocaleDateString()})]})]}):b?e.jsxs("div",{className:"bg-yellow-50 p-4 rounded text-yellow-800 border border-yellow-200 text-sm",children:[e.jsx("i",{className:"fa-solid fa-hourglass-half mr-2"}),"Consent link was generated, waiting for client to approve."]}):e.jsxs("div",{className:"bg-red-50 p-4 rounded text-red-700 border border-red-200 text-sm",children:[e.jsx("i",{className:"fa-solid fa-times-circle mr-2"}),"Client has ",e.jsx("strong",{children:"Not yet agreed"}),".",e.jsx("br",{}),"No consent link generated."]})})]}),m&&!o&&e.jsxs("div",{className:"rounded-lg shadow border border-blue-200 overflow-hidden",children:[e.jsx("div",{className:"bg-blue-50 px-5 py-3 flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2 font-semibold text-blue-700 text-lg",children:[e.jsx("i",{className:"fa-solid fa-link"}),"Consent Link"]})}),e.jsx("div",{className:"p-4 space-y-3",children:!b&&!d?e.jsxs(r,{isLoading:g.isPending,onClick:L,className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded",children:[e.jsx("i",{className:"fa-solid fa-wand-magic-sparkles mr-2"}),"Generate Consent Link"]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg bg-gray-100",children:[e.jsx("span",{className:"text-sm truncate",children:d}),e.jsxs("div",{className:"flex gap-2 ml-4",children:[e.jsxs(r,{variant:"outline",className:"bg-blue-600 text-white hover:bg-blue-700 px-3 py-1 text-sm",onClick:()=>w(d),children:[e.jsx("i",{className:"fa-regular fa-copy mr-1"}),"Copy"]}),e.jsxs(r,{variant:"outline",className:"bg-green-600 text-white hover:bg-green-700 px-3 py-1 text-sm",onClick:()=>C(d),children:[e.jsx("i",{className:"fa-brands fa-whatsapp mr-1"}),"Share"]})]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Share this link with the client to collect consent."})]})})]}),e.jsxs("div",{className:`rounded-lg shadow border border-gray-200 max-h-70 overflow-y-auto custom-scrollbar ${o?"!max-h-[480px]":""} `,children:[e.jsxs("div",{className:"bg-gray-100 px-5 py-3 text-gray-700 font-medium text-lg flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-file-contract"}),"Consent Form Content"]}),e.jsx("div",{className:"prose prose-sm sm:prose base p-5",style:{fontFamily:"Segoe UI, sans-serif"},dangerouslySetInnerHTML:{__html:S||"<p>No content available.</p>"}})]})]})};export{E as default};
