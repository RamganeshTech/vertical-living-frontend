import{u as Y,r as x,j as e}from"./index-C1DtYOG4.js";import{B as i}from"./Button-D6HVPia8.js";import{u as Z}from"./vendorAccApi-C7JB-0We.js";import{S as D}from"./SearchSelectNew-BTjN8GZK.js";import{L as h}from"./Label-CtYe-41D.js";import{I as ee}from"./ImageGalleryMain-6QaierE0.js";import{ORDERMATERIAL_UNIT_OPTIONS as se}from"./OrderMaterialOverview-BPqce2eI.js";import{f as te,g as ae}from"./billAccountApi-Bht4x4k2.js";import{t as f}from"./toast-BSC5QTk1.js";import{C as le,a as ne}from"./Card-CK78z7_O.js";import{d as re}from"./downloadFile-CUpkasnf.js";import{T as de}from"./TextArea-Bj5dO7Eq.js";import{I as oe}from"./InfoToolTip-B5eZ3h2_.js";const ve=({mode:P,initialData:s,onSubmit:V,onQuickUpload:S,isSubmitting:j,organizationId:I,refetch:u})=>{var E;const T=Y(),[p,A]=x.useState(P),{data:y}=Z(I),U=te(),_=async t=>{var l,a;try{await U.mutateAsync({billId:s._id,imageId:t}),u==null||u(),f({title:"Success",description:"deleted successfully"})}catch(d){f({title:"Error",description:((a=(l=d==null?void 0:d.response)==null?void 0:l.data)==null?void 0:a.message)||"failed to delete",variant:"destructive"})}},q={vendorId:null,vendorName:"",billNumber:"",accountsPayable:"",subject:"",billDate:new Date().toISOString().split("T")[0],dueDate:new Date(Date.now()+10*24*60*60*1e3).toISOString().split("T")[0],items:[{itemName:"",rate:0,quantity:1,unit:"nos",totalCost:0}],discountPercentage:0,taxPercentage:0,notes:"",images:[]},[n,o]=x.useState(q),[w,M]=x.useState(!1),[m,R]=x.useState({totalAmount:0,discountAmount:0,taxAmount:0,grandTotal:0});x.useEffect(()=>{var t;s&&o({vendorId:s.vendorId||null,vendorName:s.vendorName||"",billNumber:s.billNumber||"",accountsPayable:s.accountsPayable||"",subject:s.subject||"",billDate:s.billDate?new Date(s.billDate).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],dueDate:s.dueDate?new Date(s.dueDate).toISOString().split("T")[0]:new Date(Date.now()+10*24*60*60*1e3).toISOString().split("T")[0],items:((t=s==null?void 0:s.items)==null?void 0:t.length)&&s.items||[{itemName:"",rate:0,unit:"nos",quantity:1,totalCost:0}],discountPercentage:s.discountPercentage||0,taxPercentage:s.taxPercentage||0,notes:s.notes||"",images:[]})},[s,P]),x.useEffect(()=>{var t;p==="view"&&o({vendorId:s.vendorId||null,vendorName:s.vendorName||"",billNumber:s.billNumber||"",accountsPayable:s.accountsPayable||"",subject:s.subject||"",billDate:s.billDate?new Date(s.billDate).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],dueDate:s.dueDate?new Date(s.dueDate).toISOString().split("T")[0]:new Date(Date.now()+10*24*60*60*1e3).toISOString().split("T")[0],items:((t=s==null?void 0:s.items)==null?void 0:t.length)&&s.items||[{itemName:"",rate:0,unit:"nos",quantity:1,totalCost:0}],discountPercentage:s.discountPercentage||0,taxPercentage:s.taxPercentage||0,notes:s.notes||"",images:[]})},[p]),x.useEffect(()=>{const t=n.items.reduce((c,O)=>c+(O.totalCost||0),0),l=t*n.discountPercentage/100,a=t-l,d=a*n.taxPercentage/100,b=a+d;R({totalAmount:t,discountAmount:l,taxAmount:d,grandTotal:b})},[n.items,n.discountPercentage,n.taxPercentage]);const N=t=>{const{name:l,value:a}=t.target;o(d=>({...d,[l]:a}))},F=t=>{const{name:l,value:a}=t.target;o(d=>({...d,[l]:parseFloat(a)||0}))},L=()=>o(t=>({...t,items:[...t.items,{itemName:"",quantity:1,unit:"nos",rate:0,totalCost:0}]})),W=t=>o(l=>({...l,items:l.items.filter((a,d)=>d!==t)})),v=(t,l,a)=>{o(d=>{const b=[...d.items],c={...b[t]};return l==="itemName"?(t===d.items.length-1&&c.itemName===""&&a!==""&&b.push({itemName:"",unit:"nos",quantity:1,rate:0,totalCost:0}),c.itemName=a):l==="unit"?c.unit=a:(c[l]=typeof a=="string"?parseFloat(a)||0:a,c.totalCost=c.quantity*c.rate),b[t]=c,{...d,items:b}})},G=t=>{const l=y==null?void 0:y.find(a=>a._id===t);o(a=>({...a,vendorId:t||"",vendorName:(l==null?void 0:l.vendorName)||""}))},H=t=>{t.target.files&&o(l=>({...l,images:[...l.images,...Array.from(t.target.files||[])]}))},$=t=>{o(l=>({...l,images:l.images.filter((a,d)=>d!==t)}))},z=async()=>{n.images.length>0&&S&&(await S(n.images),o(t=>({...t,images:[]})))},k=async t=>{t.preventDefault();const l=n.items.filter(d=>d.itemName.trim()!==""),a={...n,items:l,organizationId:I,totalAmount:m.totalAmount,discountAmount:m.discountAmount,taxAmount:m.taxAmount,grandTotal:m.grandTotal};await V(a,n.images),A("view")},r=p==="view",g=p==="create",C=p==="edit",B=()=>A(t=>t==="view"?"edit":"view"),Q=(E=y||[])==null?void 0:E.map(t=>({value:t._id,label:t.vendorName})),{mutateAsync:J,isPending:K}=ae(),X=async()=>{var t,l;try{if(s!=null&&s.isSyncWithPaymentsSection)return f({variant:"destructive",title:"Error",description:"already sent to payments section"});await J({billId:s._id}),u==null||u(),f({title:"Success",description:"Bill sent to Payments Section"})}catch(a){f({variant:"destructive",title:"Error",description:((l=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:l.message)||(a==null?void 0:a.message)||"operation failed"})}};return e.jsxs("div",{className:"max-w-full mx-auto space-y-2",children:[e.jsxs("header",{className:"sticky top-0 z-20 bg-white border-b border-gray-200 pb-4 pt-2 mb-6 flex justify-between items-center",children:[e.jsxs("div",{className:"flex justify-between items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>T(-1),className:"bg-blue-100 hover:bg-slate-300 flex items-center justify-between w-8 h-8 border border-[#a6aab8] text-sm cursor-pointer rounded-md px-2",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-receipt mr-3 text-blue-600"}),g?"Create Bill":C?"Update Bill":"View Bill"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:g?"Fill in details":C?"Update details":"Bill details"})]})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[r&&e.jsxs("div",{className:"flex items-center space-y-1",children:[e.jsx(i,{variant:"primary",className:`${s!=null&&s.isSyncWithPaymentsSection?"!cursor-not-allowed":""}`,title:s!=null&&s.isSyncWithPaymentsSection?"already sent to payment":"",isLoading:K,disabled:s==null?void 0:s.isSyncWithPaymentsSection,onClick:X,children:"Send To Payments Section"}),e.jsx(oe,{content:"Click the button to send the bill to Payments section",type:"info",position:"bottom"})]}),r&&e.jsxs(i,{type:"button",onClick:B,className:r?"bg-blue-600 text-white":"bg-gray-500 hover:bg-gray-500 text-white",children:[e.jsx("i",{className:"fas fa-edit mr-2"}),"Edit"]}),(g||C)&&e.jsxs("div",{className:"flex justify-end items-center gap-4",children:[e.jsx(i,{type:"button",onClick:k,className:"bg-blue-600 text-white px-6 py-2",disabled:j,children:j?e.jsx("i",{className:"fas fa-spinner fa-spin"}):e.jsx(e.Fragment,{children:g?"Create Bill":"Update Bill"})}),e.jsx(i,{variant:"outline",type:"button",onClick:()=>{g?T(-1):B()},className:"bg-gray-500 hover:bg-gray-500 text-white px-6 py-2",children:"Cancel"})]})]})]}),e.jsxs("form",{onSubmit:k,className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{children:"Vendor"}),e.jsx(D,{options:Q,value:n.vendorId?n.vendorId:"",onValueChange:G,className:"w-full",placeholder:"Select Vendor"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"checkbox",id:"vendornameinp",checked:w,onChange:()=>M(t=>!t),disabled:r}),e.jsx(h,{className:"cursor-pointer",htmlFor:"vendornameinp",children:"Manual Entry"})]}),e.jsx("input",{type:"text",name:"vendorName",value:n.vendorName,onChange:t=>{w&&N(t)},disabled:r||!w,className:"w-full px-3 py-2 border rounded-lg",placeholder:"Vendor Name"})]}),e.jsxs("div",{children:[e.jsx(h,{children:"Bill Date"}),e.jsx("input",{type:"date",name:"billDate",value:n.billDate,onChange:N,disabled:r,className:"w-full px-3 py-2 border rounded-lg"})]}),e.jsxs("div",{children:[e.jsx(h,{children:"Due Date"}),e.jsx("input",{type:"date",name:"dueDate",value:n.dueDate,onChange:N,disabled:r,className:"w-full px-3 py-2 border rounded-lg"})]})]}),e.jsxs("div",{children:[e.jsx(h,{children:"Remarks"}),e.jsx(de,{name:"subject",value:n.subject,onChange:N,disabled:r,className:"w-full px-3 py-2 border rounded-lg"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-list mr-2 text-blue-600"})," Items ",e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),!r&&e.jsxs(i,{type:"button",onClick:L,variant:"primary",children:[e.jsx("i",{className:"fas fa-plus mr-2"})," Add Item"]})]}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("div",{className:"grid grid-cols-14 gap-3 mb-2 px-4 py-3 bg-gray-100 rounded-lg font-semibold text-sm",children:[e.jsx("div",{className:"col-span-1",children:"#"}),e.jsx("div",{className:"col-span-4 text-center",children:"Item Name"}),e.jsx("div",{className:"col-span-2 text-center",children:"Unit"}),e.jsx("div",{className:"col-span-2 text-center",children:"Qty"}),e.jsx("div",{className:"col-span-2 text-center",children:"Rate"}),e.jsx("div",{className:"col-span-2 text-center",children:"Total"}),e.jsx("div",{className:"col-span-1 text-center",children:"Action"})]}),e.jsx("div",{className:"space-y-2",children:n.items.map((t,l)=>e.jsxs("div",{className:"grid grid-cols-14 gap-3 px-4 py-3 bg-white rounded-lg items-center",children:[e.jsx("div",{className:"col-span-1",children:l+1}),e.jsx("div",{className:"col-span-4 ",children:e.jsx("input",{value:t.itemName,onChange:a=>v(l,"itemName",a.target.value),disabled:r,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm disabled:bg-gray-100"})}),e.jsx("div",{className:"col-span-2",children:e.jsx("select",{value:t.unit,onChange:a=>v(l,"unit",a.target.value),disabled:r,className:"w-full px-3 py-2 border border-gray-200 rounded-md focus:ring-2 focus:ring-blue-500 bg-white text-sm disabled:bg-gray-100",children:se.map(a=>e.jsx("option",{value:a,children:a},a))})}),e.jsx("div",{className:"col-span-2 ",children:e.jsx("input",{type:"number",value:t.quantity,onChange:a=>v(l,"quantity",a.target.value),disabled:r,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm disabled:bg-gray-100"})}),e.jsx("div",{className:"col-span-2 ",children:e.jsx("input",{type:"number",value:t.rate,onChange:a=>v(l,"rate",a.target.value),disabled:r,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm disabled:bg-gray-100"})}),e.jsxs("div",{className:"col-span-2 text-center",children:["₹",t.totalCost.toFixed(2)]}),e.jsx("div",{className:"col-span-1 text-center",children:!r&&e.jsx("i",{className:"fas fa-trash text-red-500 cursor-pointer",onClick:()=>W(l)})})]},l))}),e.jsxs("div",{className:"grid grid-cols-12 gap-3 px-4 py-3 bg-blue-50 rounded-lg mt-4 font-semibold",children:[e.jsx("div",{className:"col-span-9 text-right",children:"Subtotal:"}),e.jsxs("div",{className:"col-span-2 text-right text-blue-600",children:["₹",m.totalAmount.toFixed(2)]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx("i",{className:"fas fa-calculator mr-2 text-blue-600"}),"Discount & Tax"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Discount Percentage (%)"}),e.jsx("input",{type:"number",name:"discountPercentage",value:n.discountPercentage,onChange:F,disabled:r,min:"0",max:"100",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tax Percentage (%)"}),e.jsx("input",{type:"number",name:"taxPercentage",value:n.taxPercentage,onChange:F,disabled:r,min:"0",max:"100",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",placeholder:"0.00"})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl shadow-sm p-6 border border-blue-100",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx("i",{className:"fas fa-receipt mr-2 text-blue-600"}),"Bill Summary"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-blue-200",children:[e.jsx("span",{className:"text-gray-700 font-medium",children:"Subtotal:"}),e.jsxs("span",{className:"text-xl font-semibold text-gray-900",children:["₹",m.totalAmount.toFixed(2)]})]}),n.discountPercentage>0&&e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-blue-200",children:[e.jsxs("span",{className:"text-gray-700 font-medium",children:["Discount (",n.discountPercentage,"%):"]}),e.jsxs("span",{className:"text-xl font-semibold text-green-600",children:["-₹",m.discountAmount.toFixed(2)]})]}),n.taxPercentage>0&&e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-blue-200",children:[e.jsxs("span",{className:"text-gray-700 font-medium",children:["Tax (",n.taxPercentage,"%):"]}),e.jsxs("span",{className:"text-xl font-semibold text-gray-900",children:["₹",m.taxAmount.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center py-3 bg-blue-100 px-4 rounded-lg",children:[e.jsx("span",{className:"text-lg font-bold text-gray-900",children:"Grand Total:"}),e.jsxs("span",{className:"text-2xl font-bold text-blue-600",children:["₹",m.grandTotal.toFixed(2)]})]})]})]}),r&&s&&s.images&&s.images.length>0&&e.jsxs("section",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 border-b pb-2 flex items-center",children:[e.jsx("i",{className:"fas fa-folder-open mr-2 text-blue-500"})," Existing Documents"]}),e.jsx("div",{className:"mb-6",children:e.jsx(ee,{handleDeleteFile:t=>_(t),imageFiles:s.images,height:150,minWidth:150,maxWidth:200})})]}),r&&e.jsxs("section",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 pb-2 border-b flex justify-between items-center",children:[e.jsxs("span",{children:[e.jsx("i",{className:"fas fa-cloud-upload-alt mr-2 text-blue-500"})," ",g?"Upload Hot Copy of Bill":"Add Hot Copy of Bill"]}),r&&e.jsx("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded",children:"View Mode Upload"})]}),e.jsxs("div",{className:"relative w-full h-32 border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-500 bg-gray-50 flex flex-col items-center justify-center",children:[e.jsx("input",{type:"file",multiple:!0,accept:"image/*,.pdf",onChange:H,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer z-20"}),e.jsx("i",{className:"fas fa-cloud-upload-alt text-3xl text-gray-400 mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Click to upload files"})]}),n.images.length>0&&e.jsxs("div",{className:"mt-4 space-y-2",children:[n.images.map((t,l)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-white border rounded shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("i",{className:`fas ${t.type.includes("pdf")?"fa-file-pdf text-red-500":"fa-file-image text-blue-500"}`}),e.jsx("span",{className:"text-sm text-gray-700",children:t.name})]}),e.jsx("button",{type:"button",onClick:()=>$(l),className:"text-red-500 px-2",children:e.jsx("i",{className:"fas fa-times"})})]},l)),r&&e.jsx("div",{className:"flex justify-end mt-2",children:e.jsx(i,{type:"button",onClick:z,disabled:j,className:"",children:j?"Uploading...":"Upload Files Now"})})]})]}),r&&(s!=null&&s.pdfData)?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"Invoice Pdf"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Generate a PDF document for the invoice"})]})}),e.jsx(le,{className:"border-green-200 bg-green-50",children:e.jsx(ne,{className:"p-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("i",{className:"fas fa-check-circle text-green-600 text-2xl"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-green-900",children:s.pdfData.originalName}),e.jsx("p",{className:"text-sm text-green-700",children:"Invoice PDF is ready"})]})]}),e.jsxs("div",{className:"gap-2 flex items-center",children:[e.jsx(i,{type:"button",variant:"outline",onClick:()=>window.open(s.pdfData.url,"_blank"),className:"",children:"View PDF"}),e.jsx(i,{type:"button",variant:"primary",onClick:()=>re({src:s.pdfData.url,alt:s.pdfData.originalName}),className:"",children:"download PDF"})]})]})})})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"shadow-md flex flex-col items-center justify-center min-h-[150px] w-full bg-white rounded-xl text-center p-6",children:[e.jsx("i",{className:"fas fa-file-invoice text-5xl text-blue-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-1",children:"If No Pdf Found, just click on edit button and update the bill"})]})})]})]})};export{ve as B};
