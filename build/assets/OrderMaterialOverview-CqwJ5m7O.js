import{u as rs,p as ls,a as is,f as ns,b as cs,r as b,j as e,O as ds,M as os,B as u,I as y,t as i}from"./index-MXS_gbde.js";import{C as fe,a as ms}from"./Card-L4jLwmC3.js";import{A as us,S as xs}from"./AssignStaff-BvCba0Ct.js";import{R as hs}from"./ResetStageButton-C8k6xykj.js";import{S as ps}from"./ShareDocumentWhatsapp-BD-efZD6.js";import{b as gs,a as fs,c as bs,d as Ns,e as js,f as vs,g as ys,h as ws,i as Ss,j as Is,k as ks,l as Cs,m as As}from"./orderMaterialHistoryApi-Z3opWWnm.js";import{d as be}from"./downloadFile-BskFWteI.js";import{u as Os}from"./shopLibDetailApi-6RTljr7s.js";import{S as Ps}from"./SearchSelectNew-C8k-FWEO.js";import{I as Es}from"./ImageGalleryMain-LKPoIxi9.js";import{S as Ds}from"./StageGuide-DLy2p25i.js";import{P as Ms}from"./ProcurementPriorityDropdown-DN-th5oY.js";import"./getAllUsersApi-Gbc98a74.js";import"./documentationApi-cFQEq_vS.js";import"./requirementFormApi-R6rJrFKn.js";import"./index-BDg928G7.js";const Ne=["nos","pieces","litre","dozens","kg","mm","cm","meter","feet","inch","sqft","sqmm","packet","roll","sheet","set","coil","pair"],Xs=()=>{var V,$,W,K,Q,J,Y,Z,X,ee,se,te,ae,re,le,ie,ne,ce,de,oe,me,ue,xe,he,pe,ge;const{projectId:c,organizationId:I}=rs(),{isMobile:je,openMobileSidebar:ve}=ls(),O=is(),M=ns(),{role:L,permission:N}=cs(),_=L==="owner"||((V=N==null?void 0:N.ordermaterial)==null?void 0:V.delete),h=L==="owner"||(($=N==null?void 0:N.ordermaterial)==null?void 0:$.create),g=L==="owner"||((W=N==null?void 0:N.ordermaterial)==null?void 0:W.edit),{data:a,isLoading:T,isError:q,error:P,refetch:j}=gs(c),{mutateAsync:ye,isPending:we}=fs(),{mutateAsync:Se,isPending:Ie}=bs(),{mutateAsync:ke}=Ns(),{mutateAsync:Ce,isPending:R}=js(),{mutateAsync:Ae}=vs(),{mutateAsync:Oe,isPending:U}=ys(),Pe=ws(),{mutateAsync:Ee,isPending:De}=Ss(),{mutateAsync:Me,isPending:Le}=Is(),{mutateAsync:_e}=ks(),{mutateAsync:qe}=Cs(),{data:w}=Os(I),{mutateAsync:Ue,isPending:ze}=As(),[Ge,z]=b.useState(!1),[n,k]=b.useState({}),[F,G]=b.useState(!1),[o,S]=b.useState({}),[E,Be]=b.useState({selectedId:null,shopName:null});b.useEffect(()=>{if(E.selectedId){const s=w==null?void 0:w.find(t=>t._id===E.selectedId);console.log("shop",s),s&&S(s)}},[E.selectedId,w]);const Te=(K=w||[])==null?void 0:K.map(s=>({value:s._id,label:s.shopName})),[d,f]=b.useState(null),[m,D]=b.useState({name:"",quantity:1,unit:""}),C=b.useRef(null),Re=async s=>{var t,r;try{const l=s.target.files;if(!l||l.length===0)return;const x=Array.from(l).filter(p=>p.type.startsWith("image/"));if(x.length!==l.length){i({title:"Invalid file type",description:"Only images are allowed (JPG, PNG, etc.)",variant:"destructive"});return}await Oe({files:x,projectId:c}),i({description:"Successfully uploaded images",title:"Success"})}catch(l){i({title:"Error",description:((r=(t=l==null?void 0:l.response)==null?void 0:t.data)==null?void 0:r.message)||l.message||"Failed to upload images",variant:"destructive"})}},Fe=async()=>{var s,t;try{await Me({projectId:c}),i({description:"Completion status updated successfully",title:"Success"}),O("../materialarrival")}catch(r){i({title:"Error",description:((t=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:t.message)||r.message||"Failed to update completion status",variant:"destructive"})}},He=async()=>{var s,t;try{if(!window.confirm("Are you sure need to perform this operation?"))return;await Ue({projectId:c}),i({description:"All Sub Items successfully",title:"Success"})}catch(r){i({title:"Error",description:((t=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:t.message)||r.message||"Failed to delete sub items",variant:"destructive"})}},Ve=async()=>{var s,t;try{await Se({projectId:c}),i({description:"All Sub Items successfully",title:"Success"})}catch(r){i({title:"Error",description:((t=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:t.message)||r.message||"Failed to delete sub items",variant:"destructive"})}},$e=async()=>{var s,t;try{if(n!=null&&n.phoneNumber&&!/^\d{10}$/.test(n==null?void 0:n.phoneNumber.trim()))throw new Error("Phone number should contain exactly 10 digit numbers");await _e({projectId:c,updates:n}),z(!1),i({title:"Success",description:"Delivery Details Updated"}),j()}catch(r){i({variant:"destructive",title:"Error",description:((t=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:t.message)||(r==null?void 0:r.message)||"Update failed"})}},We=async()=>{var s,t;try{if(o.phoneNumber&&!/^\d{10}$/.test(o.phoneNumber.trim()))throw new Error("Phone number should contain exactly 10 digit numbers");await qe({projectId:c,updates:o}),i({title:"Success",description:"Shop Details Updated"}),G(!1),j()}catch(r){i({variant:"destructive",title:"Error",description:((t=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:t.message)||(r==null?void 0:r.message)||"Update failed"})}},Ke=async s=>{var t,r;try{await Pe.mutateAsync({projectId:c,imageId:s}),j==null||j(),i({title:"Success",description:"deleted successfully"})}catch(l){i({title:"Error",description:((r=(t=l==null?void 0:l.response)==null?void 0:t.data)==null?void 0:r.message)||"failed to delete",variant:"destructive"})}};b.useEffect(()=>{d&&C.current&&(C.current.focus(),C.current.select())},[d]);const Qe=c==null?void 0:c.replace(/[^a-zA-Z0-9]/g,"").slice(-3).toLowerCase(),Je=new Date().getFullYear(),H=(((J=(Q=a==null?void 0:a.orderedItems)==null?void 0:Q.map(s=>s==null?void 0:s.orderMaterialNumber))==null?void 0:J.filter(Boolean))||[]).map(s=>{const t=s.split("-").pop();return parseInt(t,10)||0}),Ye=((H.length?Math.max(...H):0)+1).toString().padStart(3,"0"),Ze=((Y=a==null?void 0:a.currentOrder)==null?void 0:Y.orderMaterialNumber)||`ORD-${Qe}-${Je}-${Ye}`||null,A=async(s,t,r)=>{var l,x,p;try{const v=(l=a.currentOrder.subItems)==null?void 0:l.find(as=>as._id===s);if(!v)return;const ts={projectId:c,subItemId:s,subItemName:t==="name"?r:v.subItemName,quantity:t==="quantity"?Number(r)?Number(r):1:v.quantity,unit:t==="unit"?r:v.unit};await Ae(ts),i({title:"Success",description:"Item updated successfully"})}catch(v){console.log("filed",v),i({title:"Error",description:((p=(x=v==null?void 0:v.response)==null?void 0:x.data)==null?void 0:p.message)||"Failed to update item",variant:"destructive"})}},B=async s=>{var r,l;if(!g&&!h)return;const t=s;if(!t&&!(t!=null&&t.name.trim()))return i({title:"Error",description:"Material Name is mandatory",variant:"destructive"});try{await ke({projectId:c,subItemName:t.name,quantity:t.quantity??1,unit:t.unit}),D({name:"",quantity:1,unit:""}),i({title:"Success",description:"Item created successfully"})}catch(x){i({title:"Error",description:((l=(r=x==null?void 0:x.response)==null?void 0:r.data)==null?void 0:l.message)||"Failed to create item",variant:"destructive"})}},Xe=async s=>{var t,r;try{await Ce({projectId:c,subItemId:s}),i({title:"Success",description:"Item deleted successfully"})}catch(l){i({title:"Error",description:((r=(t=l==null?void 0:l.response)==null?void 0:t.data)==null?void 0:r.message)||"Failed to delete item",variant:"destructive"})}},es=async s=>{var t,r;try{const l=await ye({projectId:c,organizationId:I,orderItemId:s});await be({src:l==null?void 0:l.pdfUrl,alt:"Order Material"}),i({title:"Success",description:"Pdf Generated successfully"}),j()}catch(l){i({title:"Error",description:((r=(t=l==null?void 0:l.response)==null?void 0:t.data)==null?void 0:r.message)||(l==null?void 0:l.message)||"Failed to generate link",variant:"destructive"})}},ss=async s=>{var t,r,l,x;try{await be({src:(t=s==null?void 0:s.pdfLink)==null?void 0:t.url,alt:(r=s==null?void 0:s.pdfLink)==null?void 0:r.pdfName}),i({title:"Success",description:"PDF Downloaded successfully"})}catch(p){i({title:"Error",description:((x=(l=p==null?void 0:p.response)==null?void 0:l.data)==null?void 0:x.message)||(p==null?void 0:p.message)||"Failed to generate PDF",variant:"destructive"})}};return M.pathname.includes("siteorders")||M.pathname.includes("shoplib")||M.pathname.includes("singleorder")?e.jsx(ds,{}):T?e.jsx(os,{}):e.jsxs("div",{className:"w-full h-full flex flex-col",children:[e.jsxs("header",{className:"flex-shrink-0 flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-4",children:[e.jsxs("h2",{className:"text-2xl sm:text-2xl lg:text-2xl xl:text-3xl font-semibold text-blue-600 flex items-center",children:[je&&e.jsx("button",{onClick:ve,className:"mr-3 p-2 rounded-md border-gray-300 hover:bg-gray-100",title:"Open Menu",children:e.jsx("i",{className:"fa-solid fa-bars"})}),e.jsx("i",{className:"fa-solid fa-cart-shopping mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Ordering Material"}),e.jsx("span",{className:"sm:hidden",children:"Order Material"})]}),e.jsxs("div",{className:"flex gap-2",children:[(h||g)&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full sm:w-auto",children:[e.jsxs(u,{isLoading:Le,onClick:Fe,className:"bg-green-600 hover:bg-green-700 text-white w-full sm:w-auto whitespace-nowrap",children:[e.jsx("i",{className:"fa-solid fa-circle-check mr-2"}),"Mark as Complete"]}),e.jsx(hs,{projectId:c,stageNumber:8,stagePath:"orderingmaterial"}),!P&&e.jsx(ps,{projectId:c,stageNumber:"8",className:"w-full sm:w-fit",isStageCompleted:a==null?void 0:a.status}),e.jsx(us,{stageName:"OrderMaterialHistoryModel",projectId:c,organizationId:I,currentAssignedStaff:(a==null?void 0:a.assignedTo)||null})]})}),e.jsx("div",{className:"w-full sm:w-auto flex justify-end sm:block",children:e.jsx(Ds,{organizationId:I,stageName:"ordermaterial"})})]})]}),q&&e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"max-w-xl p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2",children:"⚠️ Error Occurred"}),e.jsx("p",{className:"text-red-500 text-sm mb-4",children:((X=(Z=P==null?void 0:P.response)==null?void 0:Z.data)==null?void 0:X.message)||"Failed to load ordering material"}),e.jsx(u,{isLoading:T,onClick:()=>j(),className:"bg-red-600 text-white hover:bg-red-700",children:"Retry"})]})}),!q&&e.jsxs("div",{className:"flex-1 min-h-0 overflow-y-auto space-y-4 sm:space-y-6 ",children:[e.jsxs(fe,{className:"p-4 w-full shadow border-l-4 border-blue-600 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-3 text-blue-700 text-sm font-medium mb-2",children:[e.jsx("i",{className:"fa-solid fa-clock text-blue-500 text-lg"}),e.jsx("span",{children:"Stage Timings"})]}),e.jsx(xs,{completedAt:(ee=a==null?void 0:a.timer)==null?void 0:ee.completedAt,stageName:"orderingmaterial",formId:a==null?void 0:a._id,projectId:c,deadLine:(se=a==null?void 0:a.timer)==null?void 0:se.deadLine,startedAt:(te=a==null?void 0:a.timer)==null?void 0:te.startedAt,refetchStageMutate:j,deadLineMutate:Ee,isPending:De})]}),!q&&e.jsxs("section",{className:"bg-white rounded-3xl shadow-[0_10px_40px_-15px_rgba(0,0,0,0.1)] overflow-hidden",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 w-full mb-3",children:[e.jsxs("section",{className:"border-l-4 flex-1 border-blue-600 rounded-lg p-4 shadow-sm relative bg-white",children:[e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsx("div",{children:e.jsxs("h2",{className:"text-base sm:text-lg font-bold mb-3 text-blue-700 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-store"}),"Shop Details"]})}),F?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Assignee"}),e.jsx(Ps,{options:Te,placeholder:"Select Shop",searchPlaceholder:"Search by shop name...",value:E.selectedId||"",onValueChange:s=>{const t=w==null?void 0:w.find(r=>r._id===s);Be({selectedId:t._id,shopName:t.shopName})},searchBy:"name",displayFormat:"detailed",className:"w-full"})]}):e.jsxs("div",{className:"gap-2 flex",children:[e.jsxs(u,{onClick:()=>O("shoplib"),children:[e.jsx("i",{className:"fas fa-shop mr-2"}),"Shop Library"]}),(g||h)&&e.jsxs("button",{onClick:()=>{S(a==null?void 0:a.shopDetails),G(!0)},className:" text-blue-600 text-xs sm:text-sm underline hover:text-blue-800",children:[e.jsx("i",{className:"fa-solid fa-edit mr-1"}),"Edit"]})]})]}),F?e.jsxs("div",{className:"space-y-3",children:[e.jsx(y,{placeholder:"Shop Name",value:(o==null?void 0:o.shopName)||"",onChange:s=>S({...o,shopName:s.target.value}),className:"w-full"}),e.jsx(y,{placeholder:"Contact Person",value:(o==null?void 0:o.contactPerson)||"",onChange:s=>S({...o,contactPerson:s.target.value}),className:"w-full"}),e.jsx(y,{placeholder:"Phone Number",value:(o==null?void 0:o.phoneNumber)||"",type:"tel",maxLength:10,onChange:s=>S({...o,phoneNumber:s.target.value}),className:"w-full"}),e.jsx(y,{placeholder:"Address",value:(o==null?void 0:o.address)||"",onChange:s=>S({...o,address:s.target.value}),className:"w-full"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mt-3  justify-end ",children:[e.jsxs(u,{onClick:We,className:"w-full sm:w-auto",children:[e.jsx("i",{className:"fa-solid fa-save mr-2"}),"Save"]}),e.jsxs(u,{variant:"outline",onClick:()=>G(!1),className:"w-full sm:w-auto",children:[e.jsx("i",{className:"fa-solid fa-times mr-2"}),"Cancel"]})]})]}):e.jsxs("div",{className:"space-y-2 text-sm sm:text-base",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Shop Name:"})," ",((ae=a==null?void 0:a.shopDetails)==null?void 0:ae.shopName)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Contact Person:"})," ",((re=a==null?void 0:a.shopDetails)==null?void 0:re.contactPerson)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Phone:"})," ",((le=a==null?void 0:a.shopDetails)==null?void 0:le.phoneNumber)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Address:"})," ",((ie=a==null?void 0:a.shopDetails)==null?void 0:ie.address)||"-"]})]})]}),e.jsxs("div",{className:"border-l-4 flex-1 mt-4 border-blue-600 rounded-lg p-4 shadow-sm relative bg-white",children:[e.jsxs("h2",{className:"text-base sm:text-lg font-bold mb-3 text-blue-700 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-truck"}),"Delivery Location"]}),Ge?e.jsxs("div",{className:"space-y-3",children:[e.jsx(y,{placeholder:"Site Name",value:(n==null?void 0:n.siteName)||"",onChange:s=>k({...n,siteName:s.target.value}),className:"w-full"}),e.jsx(y,{placeholder:"Site Supervisor",value:(n==null?void 0:n.siteSupervisor)||"",onChange:s=>k({...n,siteSupervisor:s.target.value}),className:"w-full"}),e.jsx(y,{placeholder:"Phone Number",type:"tel",maxLength:10,value:(n==null?void 0:n.phoneNumber)||"",onChange:s=>k({...n,phoneNumber:s.target.value}),className:"w-full"}),e.jsx(y,{placeholder:"Address",value:(n==null?void 0:n.address)||"",onChange:s=>k({...n,address:s.target.value}),className:"w-full"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mt-3  justify-end ",children:[e.jsxs(u,{onClick:$e,className:"w-full sm:w-auto",children:[e.jsx("i",{className:"fa-solid fa-save mr-2"}),"Save"]}),e.jsxs(u,{variant:"outline",onClick:()=>z(!1),className:"w-full sm:w-auto",children:[e.jsx("i",{className:"fa-solid fa-times mr-2"}),"Cancel"]})]})]}):e.jsxs("div",{className:"space-y-2 text-sm sm:text-base",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Site Name:"})," ",((ne=a==null?void 0:a.deliveryLocationDetails)==null?void 0:ne.siteName)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Supervisor:"})," ",((ce=a==null?void 0:a.deliveryLocationDetails)==null?void 0:ce.siteSupervisor)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Phone:"})," ",((de=a==null?void 0:a.deliveryLocationDetails)==null?void 0:de.phoneNumber)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Address:"})," ",((oe=a==null?void 0:a.deliveryLocationDetails)==null?void 0:oe.address)||"-"]}),(g||h)&&e.jsxs("button",{onClick:()=>{k(a==null?void 0:a.deliveryLocationDetails),z(!0)},className:"absolute top-3 right-4 text-blue-600 text-xs sm:text-sm underline hover:text-blue-800",children:[e.jsx("i",{className:"fa-solid fa-edit mr-1"}),"Edit"]})]})]})]}),e.jsx("section",{className:"w-full",children:e.jsxs("section",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 border-b pb-2 flex items-center",children:[e.jsx("i",{className:"fas fa-folder-open mr-2 text-blue-500"})," Images"]}),e.jsxs("div",{className:"flex items-center justify-between w-full relative",children:[(g||h)&&e.jsx(y,{type:"file",multiple:!0,accept:"image/*",placeholder:"select files",onChange:Re,disabled:U,className:U?"pr-10 opacity-70 cursor-not-allowed w-full mb-4":"mb-4"}),U&&e.jsx("div",{className:"absolute inset-y-0 right-2 flex items-center",children:e.jsxs("svg",{className:"animate-spin h-5 w-5 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4l3.5-3.5L12 0v4a8 8 0 100 16v4l3.5-3.5L12 20v-4a8 8 0 01-8-8z"})]})})]}),e.jsx("div",{className:"mb-6",children:((me=a==null?void 0:a.images)==null?void 0:me.length)>0?e.jsx(Es,{..._?{handleDeleteFile:s=>Ke(s)}:{},imageFiles:a==null?void 0:a.images,height:150,minWidth:150,maxWidth:200}):e.jsx("div",{className:"text-gray-500 text-sm italic bg-gray-50 p-8 rounded-lg text-center border-2 border-dashed border-gray-200",children:"No Images uploaded yet."})})]})}),e.jsxs("div",{className:"mt-6 pt-4 border-t-2 border-blue-200 bg-gradient-to-r from-white to-white rounded-lg p-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-end justify-between pb-4 border-b-2 border-blue-600",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-lg bg-blue-50",children:e.jsx("i",{className:"fa-solid fa-list text-blue-600"})}),e.jsx("h4",{className:"font-bold text-gray-900 text-2xl tracking-tight",children:"Create Material Order"})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-10",children:[e.jsx("span",{className:"flex items-center gap-1 text-[10px] font-bold uppercase tracking-wider text-blue-600 bg-blue-50 px-2 py-0.5 rounded",children:"Instruction"}),e.jsxs("p",{className:"text-xs text-gray-500 italic",children:["Click cells to edit • Press ",e.jsx("span",{className:"font-bold text-gray-700",children:"Enter"})," to save"]})]})]}),e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:e.jsxs("div",{className:"flex items-center self-stretch bg-white rounded-lg border border-gray-200 px-3 py-1 shadow-sm",children:[e.jsxs("div",{className:"flex flex-col leading-none border-r border-gray-200 pr-3 mr-3",children:[e.jsx("span",{className:"text-[9px] font-bold text-gray-400 uppercase tracking-widest",children:"Order ID"}),e.jsx("span",{className:"text-sm font-mono font-black text-blue-700 mt-0.5",children:Ze})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs(u,{variant:"primary",size:"sm",className:"h-8 text-xs px-3 shadow-none",onClick:()=>O("siteorders"),children:[e.jsx("i",{className:"fas fa-box-archive mr-2"}),"View Public Orders"]}),_&&e.jsxs(u,{variant:"danger",size:"sm",className:"h-8 text-xs px-3 bg-red-600 text-white shadow-none",isLoading:ze,onClick:He,children:[e.jsx("i",{className:"fas fa-trash mr-2"}),"Delete All"]})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg border-2 border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"grid grid-cols-17 gap-0 bg-gradient-to-r from-blue-100 to-blue-100 border-b-2 border-blue-200",children:[e.jsx("div",{className:"col-span-3 px-4 py-3 text-sm font-medium text-gray-700 border-r border-gray-200",children:"Ref ID"}),e.jsx("div",{className:"col-span-8 px-4 py-3 text-sm font-medium text-gray-700 border-r border-gray-200",children:"Material Name"}),e.jsx("div",{className:"col-span-2 px-4 py-3 text-sm font-medium text-gray-700 border-r border-gray-200",children:"Quantity"}),e.jsx("div",{className:"col-span-3 px-4 py-3 text-sm font-medium text-gray-700 border-r border-gray-200",children:"Unit"}),e.jsx("div",{className:"col-span-1 px-4 py-3 text-sm font-medium text-gray-700",children:"Action"})]}),a.currentOrder.subItems&&((ue=a.currentOrder)==null?void 0:ue.subItems.length)>0&&a.currentOrder.subItems.map(s=>e.jsxs("div",{className:"grid grid-cols-17 gap-0 border-b border-gray-100 hover:bg-gray-50",children:[e.jsx("div",{className:"col-span-3 border-r border-blue-200",children:e.jsx("div",{className:"w-full px-4 py-3 border-none outline-none focus:bg-blue-50",children:(s==null?void 0:s.refId)||"N/A"})}),e.jsx("div",{className:"col-span-8 border-r border-blue-200",children:(d==null?void 0:d.subItemId)===s._id&&(d==null?void 0:d.field)==="name"?e.jsx("input",{ref:C,type:"text",defaultValue:s.subItemName,className:"w-full px-4 py-3 border-none outline-none focus:bg-blue-50",onBlur:t=>{A(s._id,"name",t.target.value),f(null)},onKeyDown:t=>{if(t.key==="Enter"){const r=t.target.value;A(s._id,"name",r),f(null)}t.key==="Escape"&&f(null)}}):e.jsx("div",{className:"px-4 py-3 cursor-pointer hover:bg-blue-50 transition-colors",onClick:()=>{(h||g)&&f({subItemId:s._id,field:"name"})},children:s.subItemName})}),e.jsx("div",{className:"col-span-2 border-r border-blue-200",children:(d==null?void 0:d.subItemId)===s._id&&(d==null?void 0:d.field)==="quantity"?e.jsx("input",{ref:C,type:"number",defaultValue:s.quantity,min:"0",className:"w-full px-4 py-3 border-none outline-none focus:bg-blue-50",onBlur:t=>{A(s._id,"quantity",t.target.value),f(null)},onKeyDown:t=>{t.key==="Enter"&&(A(s._id,"quantity",t.currentTarget.value),f(null)),t.key==="Escape"&&f(null)}}):e.jsx("div",{className:"px-4 py-3 cursor-pointer hover:bg-blue-50 transition-colors",onClick:()=>{(h||g)&&f({subItemId:s._id,field:"quantity"})},children:s.quantity})}),e.jsx("div",{className:"col-span-3 border-r border-blue-200",children:(d==null?void 0:d.subItemId)===s._id&&(d==null?void 0:d.field)==="unit"?e.jsx("div",{className:"p-2 relative z-50",children:e.jsxs("select",{defaultValue:s.unit,onChange:t=>{A(s._id,"unit",t.target.value),f(null)},className:"w-full relative z-[50] px-3 py-2 border border-gray-200 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-sm",children:[e.jsx("option",{value:"",disabled:!0,children:"Selected unit"}),Ne.map(t=>e.jsx("option",{value:t,children:t},t))]})}):e.jsx("div",{className:"px-4 py-3 cursor-pointer hover:bg-blue-50 transition-colors",onClick:()=>{(h||g)&&f({subItemId:s._id,field:"unit"})},children:s.unit})}),_&&e.jsx("div",{className:"col-span-1 flex items-center justify-center",children:e.jsx(u,{variant:"danger",onClick:()=>Xe(s._id),disabled:R,isLoading:R,className:"p-2 bg-red-600 text-white  hover:bg-red-50 rounded transition-colors disabled:opacity-50",title:"Delete item",children:e.jsx("i",{className:"fa fa-trash text-sm"})})})]},s._id)),e.jsxs("div",{className:"grid grid-cols-17 gap-0 bg-green-50 border-b border-gray-100",children:[e.jsx("div",{className:"col-span-3 border-r border-gray-200",children:e.jsx("div",{className:"w-full px-4 py-3 border-none outline-none focus:bg-blue-50",children:"Ref Id"})}),e.jsx("div",{className:"col-span-8 border-r border-gray-200",children:e.jsx("input",{type:"text",placeholder:"Enter matterial name...",value:(m==null?void 0:m.name)||"",onChange:s=>{D(t=>({...t,name:s.target.value}))},onBlur:()=>{var s;(s=m==null?void 0:m.name)!=null&&s.trim()&&m.quantity&&m.unit&&B(m)},onKeyDown:s=>{s.key==="Enter"&&B(m)},className:"w-full px-4 py-3 bg-transparent border-none outline-none placeholder-gray-400"})}),e.jsx("div",{className:"col-span-2 border-r border-gray-200",children:e.jsx("input",{type:"number",placeholder:"Qty",min:"0",value:(m==null?void 0:m.quantity)||1,onChange:s=>{D(t=>({...t,quantity:Number(s.target.value)||1}))},className:"w-full px-4 py-3 bg-transparent border-none outline-none placeholder-gray-400"})}),e.jsx("div",{className:"col-span-3 border-r border-gray-200",children:e.jsx("div",{className:"p-2",children:e.jsxs("select",{value:(m==null?void 0:m.unit)||"",onChange:async s=>{const t={...m,unit:s.target.value};D(r=>({...r,unit:s.target.value})),await B(t)},className:"w-full relative z-[50] px-3 py-2 border border-gray-200 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-sm",children:[e.jsx("option",{value:"",children:"Selected unit"}),Ne.map(s=>e.jsx("option",{value:s,children:s},s))]})})})]}),(!a.currentOrder.subItems||((he=(xe=a.currentOrder)==null?void 0:xe.subItems)==null?void 0:he.length)===0)&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("i",{className:"fa-solid fa-inbox text-2xl mb-2"}),e.jsx("p",{className:"text-sm",children:"No sub-items yet. Start typing in the row above to add items."})]})]})]})]}),e.jsxs("section",{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"Orders"}),e.jsx("p",{className:"text-sm text-gray-600",children:"view your orders"})]}),h&&e.jsx(u,{onClick:Ve,isLoading:Ie,className:"min-w-[140px] bg-blue-600 hover:bg-blue-700 text-white font-medium",size:"lg",children:"Submit Order"})]}),a!=null&&a.orderedItems&&((pe=a==null?void 0:a.orderedItems)==null?void 0:pe.length)>0?e.jsx("div",{className:"flex flex-col gap-2",children:(ge=a==null?void 0:a.orderedItems)==null?void 0:ge.sort((s,t)=>new Date(t==null?void 0:t.createdAt).getTime()-new Date(s.createdAt).getTime()).map(s=>e.jsx(fe,{className:"border-green-200  !relative bg-green-50 shadow  border-0 rounded-2xl ",children:e.jsx(ms,{className:"p-6 ",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start  sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx("i",{className:"fas fa-check-circle text-green-600"})}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-blue-700 ",children:[e.jsx("span",{className:"!text-sm text-gray-600",children:"Order Id: "})," ",s.orderMaterialNumber]}),e.jsx("span",{className:"text-sm text-gray-900",children:"Order Material"})]})]}),e.jsxs("div",{className:"flex flex-col  sm:flex-row gap-2 w-full sm:w-auto ",children:[e.jsxs(u,{variant:"outline",onClick:()=>O(`singleorder/${s._id}`),className:"border-green-300 text-blue-700 hover:bg-blue-100 hover:border-blue-400",children:[e.jsx("i",{className:"fas mr-2 fa-external-link-alt"}),"View"]}),(h||g)&&e.jsx(u,{variant:"outline",onClick:()=>es(s._id),isLoading:we,className:"border-green-300 text-blue-700 hover:bg-blue-100 hover:border-blue-400",children:"Generate Pdf"}),e.jsx(u,{variant:"secondary",onClick:()=>ss(s),className:"border-blue-300 text-blue-700 hover:bg-blue-100 hover:border-blue-400",children:"Download PDF"}),(h||g)&&e.jsx(Ms,{ele:s,projectId:c,organizationId:I,refetch:j})]})]})})},s._id))}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col items-center  justify-center min-h-[300px] w-full bg-white rounded-xl text-center p-6",children:[e.jsx("i",{className:"fa-solid fa-box text-5xl text-blue-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-1",children:"No Orders Found"})]})})]})]})]})};export{Ne as ORDERMATERIAL_UNIT_OPTIONS,Xs as default};
