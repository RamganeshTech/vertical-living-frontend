import{u as G,d as I,af as T,a as E,k as _,j as e,M as z,O as D,B as N,L as K,t as w}from"./index-BAM0eJUz.js";import{R as H}from"./ResetStageButton-DaUxSSZv.js";import{C as $}from"./Card-CdxfjEr-.js";import{A as q,S as J}from"./AssignStaff-Bt6qrEbL.js";import{u as Q,a as U,b as V}from"./cleaningStageApi-DCTK1vTK.js";import{S as W}from"./StageGuide-e28gQ0h1.js";import"./Input-1UBXZqEj.js";import"./getAllUsersApi-O0JEgRtZ.js";const ie=["Living Room","Bedroom","Kitchen","Dining Room","Balcony","Foyer Area","Terrace","Study Room","Car Parking","Garden","Storage Room","Entertainment Room","Home Gym"];function le(){var x,g,u,h,p,f,b,j;const{projectId:t,organizationId:d}=G(),v=I(),{isMobile:C,openMobileSidebar:y}=T(),S=E();if(!t)return null;const{data:s,isLoading:c,isError:k,refetch:r,error:n}=Q(t),{mutateAsync:A,isPending:L}=U(),{mutateAsync:M,isPending:R}=V(),{role:m,permission:i}=_(),O=m==="owner"||((x=i==null?void 0:i.cleaning)==null?void 0:x.create),P=m==="owner"||((g=i==null?void 0:i.cleaning)==null?void 0:g.edit),B=async()=>{var a,l;try{await M({projectId:t}),w({description:"Cleaning & Sanitation marked as complete.",title:"Success"}),S("../projectdelivery"),r()}catch(o){w({title:"Error",description:((l=(a=o==null?void 0:o.response)==null?void 0:a.data)==null?void 0:l.message)||o.message||"Failed to update completion status",variant:"destructive"})}},F=v.pathname.includes("/cleaningroom/");return c?e.jsx(z,{}):e.jsx("main",{className:"w-full h-full max-h-full overflow-y-auto custom-scrollbar",children:F?e.jsx(D,{}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4 mb-6",children:[e.jsxs("h2",{className:"text-lg sm:text-xl lg:text-3xl font-semibold text-blue-600 flex items-center gap-2",children:[C&&e.jsx("button",{onClick:y,className:"mr-3 p-2 rounded-md border border-gray-300 hover:bg-gray-100",title:"Open Menu",children:e.jsx("i",{className:"fa-solid fa-bars"})}),e.jsx("i",{className:"fas fa-broom"}),e.jsx("span",{className:"hidden sm:inline text-2xl",children:" Cleaning & Sanitation Overview"}),e.jsx("span",{className:"inline sm:hidden text-2xl",children:" Cleaning Stage"})]}),(O||P)&&e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full sm:w-auto",children:[e.jsxs(N,{isLoading:R,onClick:B,className:"bg-blue-600 hover:bg-blue-700 text-white sm:w-auto w-full",children:[e.jsx("i",{className:"fa-solid fa-circle-check mr-2"}),e.jsx("span",{className:"hidden sm:inline-block",children:"Mark as Completed"}),e.jsx("span",{className:"inline sm:hidden",children:"Mark as Completed"})]}),e.jsxs("div",{className:"flex items-center justify-between w-full sm:gap-2",children:[e.jsx(H,{projectId:t,stageNumber:13,stagePath:"cleaning",className:"!w-[48%] sm:!w-auto"}),e.jsx(q,{stageName:"CleaningAndSanitationModel",projectId:t,organizationId:d,currentAssignedStaff:(s==null?void 0:s.assignedTo)||null,className:"!w-[48%] sm:!w-auto"})]})]}),e.jsx("div",{className:"w-full sm:w-auto flex justify-end sm:block",children:e.jsx(W,{organizationId:d,stageName:"cleaning"})})]}),k?e.jsxs("div",{className:"max-w-xl mx-auto p-6 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 text-xl font-semibold mb-2",children:"⚠️ Oops! An Error Occurred"}),e.jsx("p",{className:"text-red-500 text-sm mb-4",children:((h=(u=n==null?void 0:n.response)==null?void 0:u.data)==null?void 0:h.message)||(n==null?void 0:n.message)||"Failed to load, please try again"}),e.jsx(N,{isLoading:c,onClick:()=>r(),className:"px-4 py-2 bg-red-600 text-white text-sm font-medium rounded hover:bg-red-700 transition",children:"Retry"})]}):e.jsxs(e.Fragment,{children:[e.jsxs($,{className:"p-4 mb-6 border-l-4 border-blue-600 bg-white shadow",children:[e.jsxs("div",{className:"flex items-center gap-3 text-blue-600 text-sm font-medium mb-2",children:[e.jsx("i",{className:"fa-solid fa-clock text-lg"}),e.jsx("span",{children:"Stage Timings"})]}),e.jsx(J,{stageName:"cleaning",completedAt:(p=s==null?void 0:s.timer)==null?void 0:p.completedAt,projectId:t,formId:s==null?void 0:s._id,deadLine:(f=s==null?void 0:s.timer)==null?void 0:f.deadLine,startedAt:(b=s==null?void 0:s.timer)==null?void 0:b.startedAt,refetchStageMutate:r,deadLineMutate:A,isPending:L})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-4",children:(j=s==null?void 0:s.rooms)==null?void 0:j.map(a=>{var l;return e.jsx(K,{to:`cleaningroom/${a._id}`,className:"border-l-4 border-blue-600 p-4 rounded-xl shadow hover:shadow-md transition cursor-pointer bg-white",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-base md:text-md font-semibold capitalize text-blue-800 mb-1",children:a.roomName}),e.jsxs("p",{className:"text-xs text-gray-500",children:[((l=a.uploads)==null?void 0:l.length)||0," uploads"]}),e.jsx("p",{className:"text-xs text-gray-500",children:a.completelyCleaned?"✅ Completely Cleaned":"❌ Not Cleaned"})]})},a._id)})})]})]})})}export{le as default,ie as roomKeys};
