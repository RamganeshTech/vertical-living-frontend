import{a as b,q as k,j as e,r as f}from"./index-4xXsHyrq.js";import{g as N}from"./roleCheck-DDX7kp9U.js";import{u as D}from"./useQuery-CnKlDwE3.js";import{u as P}from"./useMutation-DAR9sTyS.js";import{C as S,c as F}from"./Card-CJaK8Drj.js";import{B as j}from"./Button-BmD7QJLN.js";import{d as L}from"./downloadFile-D_4lnteF.js";import{t as E}from"./toast-BSC5QTk1.js";import q from"./MaterialOverviewLoading-CX4w9Avf.js";const R=async({projectId:t,api:r})=>{const{data:s}=await r.get(`/shortlisteddesign/getshortlisteddesigns/${t}`);if(!s.ok)throw new Error(s.message);return s.data},T=async({projectId:t,selections:r,api:s})=>{const{data:a}=await s.post(`/shortlisteddesign/upload/${t}`,{selections:r});if(!a.ok)throw new Error(a.message);return a.data},A=async({projectId:t,api:r})=>{const{data:s}=await r.get(`/shortlisteddesign/getsiteimages/${t}`);if(!s.ok)throw new Error(s.message);return s.data},$=async({organizationId:t,api:r,tags:s})=>{let a="";s&&s.length>0?a=`?${s.map(x=>`tags=${encodeURIComponent(x)}`).join("&")}`:a="?tags=all";const{data:n}=await r.get(`/shortlisteddesign/getreferencedesigns/${t}${a}`);if(!n.ok)throw new Error(n.message);return n.data},I=async(t,r)=>{const{data:s}=await r.delete(`/shortlisteddesign/deletepdf/${t}`);if(!s.ok)throw new Error(s.message);return s.data},K=t=>{const r=["owner","staff","CTO"],{role:s}=b(),a=N(s);return D({queryKey:["shortlistedDesigns",t],queryFn:async()=>{if(!s||!r.includes(s))throw new Error("Not authorized");if(!a)throw new Error("API instance missing");return await R({projectId:t,api:a})},enabled:!!t&&!!s,retry:!1})},J=()=>{const t=["owner","staff","CTO"],{role:r}=b(),s=N(r);return P({mutationFn:async({projectId:a,selections:n})=>{if(!r||!t.includes(r))throw new Error("Not authorized");if(!s)throw new Error("API instance missing");return await T({projectId:a,selections:n,api:s})},onSuccess:(a,{projectId:n})=>{k.invalidateQueries({queryKey:["shortlistedDesigns",n]})}})},O=()=>{const t=["owner","staff","CTO"],{role:r}=b(),s=N(r);return P({mutationFn:async({id:a})=>{if(!r||!t.includes(r))throw new Error("Youre not allowed to delete pdf");if(!s)throw new Error("API instance not available");return await I(a,s)},onSuccess:(a,{projectId:n})=>{k.invalidateQueries({queryKey:["shortlistedDesigns",n]})}})},W=t=>{const r=["owner","staff","CTO"],{role:s}=b(),a=N(s);return D({queryKey:["siteImages",t],queryFn:async()=>{if(!s||!r.includes(s))throw new Error("Not authorized");if(!a)throw new Error("API instance missing");return await A({projectId:t,api:a})},enabled:!!t&&!!s,retry:!1})},X=(t,r)=>{const s=["owner","staff","CTO"],{role:a}=b(),n=N(a);return D({queryKey:["reference-shortlist",t,r],queryFn:async()=>{if(!a||!s.includes(a))throw new Error("Not authorized");if(!n)throw new Error("API instance missing");return await $({organizationId:t,api:n,tags:r})},enabled:!!t&&!!a,retry:!1})},Z=({projectId:t})=>{var m,v,y,h;const{data:r,isLoading:s,isError:a,error:n}=K(t),{mutateAsync:o,isPending:x}=O(),g=async i=>{var w,c;try{await o({id:i,projectId:t}),E({title:"Success",description:"PDF deleted"})}catch(u){E({variant:"destructive",title:"Error",description:((c=(w=u==null?void 0:u.response)==null?void 0:w.data)==null?void 0:c.message)||(u==null?void 0:u.message)||"failed to delete"})}};return s?e.jsx("div",{className:"max-h-50 overflow-y-auto w-full",children:e.jsx(q,{})}):(a&&((v=(m=n==null?void 0:n.response)==null?void 0:m.data)!=null&&v.message||n!=null&&n.message&&((h=(y=n==null?void 0:n.response)==null?void 0:y.data)!=null&&h.message||n!=null&&n.message)),e.jsxs("div",{className:"max-w-full px-4 mx-auto py-2",children:[e.jsx("header",{className:"flex gap-2 items-center justify-between",children:e.jsx("div",{className:"flex gap-2",children:e.jsx("div",{children:e.jsx("h1",{className:"text-xl md:text-3xl font-bold text-gray-900 mb-1",children:"Shortlisted Pdf's"})})})}),e.jsx("section",{className:"gap-4 flex flex-col",children:(r==null?void 0:r.length)>0?r==null?void 0:r.map(i=>{var w;return e.jsx(S,{className:"border-green-200 bg-green-50",children:e.jsx(F,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx("i",{className:"fas fa-check-circle text-green-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-green-900 mb-1",children:(w=i==null?void 0:i.pdfLink)==null?void 0:w.originalName}),e.jsx("p",{className:"text-sm text-green-700",children:"Your Design PDF is ready to view or download"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full sm:w-auto",children:[e.jsxs(j,{variant:"outline",onClick:()=>{var c;return window.open((c=i==null?void 0:i.pdfLink)==null?void 0:c.url,"_blank")},className:"border-green-300 text-blue-700 hover:bg-blue-100 hover:border-blue-400",children:[e.jsx("i",{className:"fas mr-2 fa-external-link-alt"}),"View in New Tab"]}),e.jsx(j,{variant:"secondary",onClick:()=>{var c;return L({src:(c=i==null?void 0:i.pdfLink)==null?void 0:c.url,alt:"Shortlisted designs"})},className:"border-blue-300 text-blue-700 hover:bg-blue-100 hover:border-blue-400",children:"Download PDF"}),e.jsx(j,{variant:"danger",isLoading:x,onClick:()=>g(i._id),className:"border-red-300 bg-red-600 text-white hover:bg-red-600 hover:border-red-400",children:"Delete PDF"})]})]})})},i._id)}):e.jsxs("div",{className:"flex flex-col items-center  justify-center min-h-[300px] w-full bg-white rounded-xl text-center p-6",children:[e.jsx("i",{className:"fa-solid fa-file-lines text-5xl text-blue-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-1",children:"No Pdf Found"}),e.jsx("p",{className:"text-sm text-gray-500",children:"No PDF Generated"})]})})]}))},G=({tags:t,setState:r,suggestions:s=[],suggestionFetcher:a,disableSuggestion:n=!1})=>{const[o,x]=f.useState(""),[g,m]=f.useState([]),[v,y]=f.useState(!1),[h,i]=f.useState("");f.useEffect(()=>{if(n)return;const l=setTimeout(()=>{i(o.trim())},500);return()=>{clearTimeout(l)}},[o,n]),f.useEffect(()=>{if(!o){m([]);return}},[o]),f.useEffect(()=>{if(n||!h)return;(async()=>{try{if(y(!0),a){const p=(await a(h)).filter(C=>!t.includes(C));m(p)}else{const d=s.filter(p=>p.toLowerCase().includes(h.toLowerCase())&&!t.includes(p)).slice(0,10);m(d)}}catch(d){console.error("Suggestion fetch error:",d),m([])}finally{y(!1)}})()},[h,n]);const w=l=>{(l.key==="Enter"||l.key===",")&&o.trim()?(l.preventDefault(),t.includes(o.trim())||r([...t,o.trim()]),x("")):l.key==="Backspace"&&!o&&r(t.slice(0,-1))},c=l=>{t.includes(l)||r([...t,l]),x(""),m([])},u=l=>{r(t.filter((d,p)=>p!==l))};return e.jsxs("div",{className:"relative w-full",children:[e.jsxs("div",{className:"flex flex-wrap items-center border-b-1 border-[#565656] p-2 gap-2 rounded",children:[t.map((l,d)=>e.jsxs("div",{className:"bg-blue-600 text-white text-sm px-2 py-1 rounded-full flex items-center gap-1",children:[l,e.jsx("span",{className:"cursor-pointer ml-1 text-xs",onClick:()=>u(d),children:"Ã—"})]},d)),e.jsx("input",{type:"text",value:o,onChange:l=>x(l.target.value),onKeyDown:w,className:"input flex-1 outline-none text-sm border-none",placeholder:"Type and press Enter"})]}),!n&&(g==null?void 0:g.length)>0&&e.jsxs("div",{className:"absolute left-0 right-0 z-10 mt-1 bg-white border border-gray-300 rounded shadow max-h-40 overflow-auto text-sm",children:[g.map((l,d)=>e.jsxs("div",{onClick:()=>c(l),className:"p-2 py-4 hover:bg-gray-100 cursor-pointer",children:[e.jsx("i",{className:"fa-solid fa-arrow-trend-up hover:bg-gray-50 p-3 rounded-full"}),"                            ",l]},d)),v&&e.jsx("div",{className:"p-8 place-items-center",children:e.jsx("div",{className:"p-2  text-gray-400 text-xs italic animate-spin rounded-full h-5 w-5 border-3 border-b-transparent border-black"})})]})]})},ee=f.memo(G);export{ee as S,Z as a,X as b,J as c,W as u};
