import{b as y,q as F,r as S,j as e,u as W,k as B,a as G,O as Y,L as V}from"./index-IX_jUi_Z.js";import{B as b}from"./Button-D7Kb4xIQ.js";import{g as j}from"./roleCheck-yWEzJ9f0.js";import{u as H}from"./useQuery-BBgvqOK0.js";import{u as N}from"./useMutation-oVcqBODs.js";import{t as h}from"./toast-BSC5QTk1.js";import{A as J,S as X}from"./AssignStaff-qAYH9jLp.js";import{C as D}from"./Card-DYFZZWO8.js";import{d as Z}from"./downloadFile-B22emGgP.js";import{I as ee}from"./ImageGalleryMain-DLf7It45.js";import{R as se}from"./ResetStageButton-0D-lOW1E.js";import te from"./MaterialOverviewLoading-65JYNlHA.js";import{S as ae}from"./ShareDocumentWhatsapp-CuXD4YZs.js";import"./Input-DbCzT9sN.js";import"./getAllUsersApi-DJtnV5Dc.js";import"./constants-CGGnKgPh.js";import"./index-D7NaLUTP.js";import"./Skeleton-BKzIbh6x.js";import"./documentationApi-C7ypTTeM.js";import"./requirementFormApi-BsdalIsK.js";const oe=async({projectId:a,roomName:s,api:t})=>{const{data:o}=await t.post(`/sampledesign/${a}/rooms`,{roomName:s});if(!o.ok)throw new Error(o.message);return o.data},le=async({projectId:a,roomName:s,files:t,api:o})=>{const l=new FormData;t.forEach(x=>l.append("files",x));const{data:c}=await o.post(`/sampledesign/${a}/rooms/${s}/upload`,l,{headers:{"Content-Type":"multipart/form-data"}});return c.data},ie=async({projectId:a,api:s})=>{const{data:t}=await s.get(`/sampledesign/${a}/rooms`);if(!t.ok)throw new Error(t.message);return t.data},ne=async({projectId:a,roomName:s,fileId:t,api:o})=>{const{data:l}=await o.delete(`/sampledesign/${a}/rooms/${s}/delete/${t}`);if(!l.ok)throw new Error(l.message);return l.data},re=async({projectId:a,api:s,roomId:t})=>{const{data:o}=await s.delete(`/sampledesign/${a}/${t}/deleteroom`);if(!o.ok)throw new Error(o.message);return o.data},de=async({projectId:a,api:s})=>{const{data:t}=await s.put(`/sampledesign/completionstatus/${a}`);if(!t.ok)throw new Error(t.message);return t.data},ce=async({formId:a,projectId:s,deadLine:t,api:o})=>{const{data:l}=await o.put(`/sampledesign/deadline/${s}/${a}`,{deadLine:t});if(!l.ok)throw new Error(l.message);return l.data},me=()=>{const a=["owner","staff","CTO","client"],{role:s}=y(),t=j(s);return N({mutationFn:async({projectId:o,roomName:l})=>{if(!s||!a.includes(s))throw new Error("not allowed to make this api call");if(!t)throw new Error("API instance not found for role");return await oe({projectId:o,roomName:l,api:t})},onSuccess:(o,{projectId:l})=>{F.invalidateQueries({queryKey:["sampledesign","roomfiles",l]})}})},ue=()=>{const a=["owner","staff","CTO","client"],{role:s}=y(),t=j(s);return N({mutationFn:async({projectId:o,roomName:l,files:c})=>{if(!s||!a.includes(s))throw new Error("not allowed to make this api call");if(!t)throw new Error("API instance not found for role");return await le({projectId:o,roomName:l,files:c,api:t})},onSuccess:(o,{projectId:l})=>{F.invalidateQueries({queryKey:["sampledesign","roomfiles",l]})}})},xe=a=>{const s=["owner","staff","CTO","client"],{role:t}=y(),o=j(t);return H({queryKey:["sampledesign","roomfiles",a],queryFn:async()=>{if(!t||!s.includes(t))throw new Error("not allowed to make this api call");if(!o)throw new Error("API instance not found for role");return await ie({projectId:a,api:o})},retry:!1,refetchOnWindowFocus:!1})},fe=()=>{const a=["owner","staff","CTO","client"],{role:s}=y(),t=j(s);return N({mutationFn:async({projectId:o,roomName:l,fileId:c})=>{if(!s||!a.includes(s))throw new Error("not allowed to make this api call");if(!t)throw new Error("API instance not found for role");return await ne({projectId:o,roomName:l,fileId:c,api:t})},onSuccess:(o,{projectId:l})=>{F.invalidateQueries({queryKey:["sampledesign","roomfiles",l]})}})},pe=()=>{const a=["owner","staff","CTO","client"],{role:s}=y(),t=j(s);return N({mutationFn:async({projectId:o,roomId:l})=>{if(!s||!a.includes(s))throw new Error("not allowed to make this api call");if(!t)throw new Error("API instance not found for role");return await re({projectId:o,roomId:l,api:t})},onSuccess:(o,{projectId:l})=>{F.invalidateQueries({queryKey:["sampledesign","roomfiles",l]})}})},he=()=>{const a=["owner","staff","CTO","client"],{role:s}=y(),t=j(s);return N({mutationFn:async({projectId:o})=>{if(!s||!a.includes(s))throw new Error("not allowed to make this api call");if(!t)throw new Error("API instance not found for role");return await de({projectId:o,api:t})},onSuccess:(o,{projectId:l})=>{F.invalidateQueries({queryKey:["sampledesign","roomfiles",l]})}})},ge=()=>{const a=["owner","staff","CTO"],{role:s}=y(),t=j(s);return N({mutationFn:async({formId:o,projectId:l,deadLine:c})=>{if(!s)throw new Error("not authorized");if(!a.includes(s))throw new Error("you  dont have the access to make this api");if(!t)throw new Error("api is null");return await ce({formId:o,projectId:l,deadLine:c,api:t})}})},we=({isOpen:a,onClose:s,onSubmit:t,addPending:o})=>{const[l,c]=S.useState(""),x=async f=>{f.preventDefault(),await t(l),c(""),s()};return a?e.jsx("div",{onClick:s,className:"fixed inset-0 bg-black/70 bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{onClick:f=>f.stopPropagation(),className:"bg-white rounded-lg p-6 w-[80%] sm:w-[60%] lg:w-full max-w-md",children:[e.jsx("h2",{className:"text-2xl font-bold text-blue-700 mb-4",children:"Add New Room"}),e.jsxs("form",{onSubmit:x,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 mb-2",children:"Room Name"}),e.jsx("input",{type:"text",value:l,onChange:f=>c(f.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{type:"button",onClick:s,className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"Cancel"}),e.jsx(b,{isLoading:o,type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Add Room"})]})]})]})}):null},be=({files:a,onUpload:s,onDelete:t,uploadPending:o,deletePending:l})=>{const c=S.useRef(null),[x,f]=S.useState([]),R=a.filter(n=>n.type==="pdf"),k=a.filter(n=>n.type==="image"),[v,C]=S.useState(null),A=n=>{var g;(g=n.target.files)!=null&&g.length&&f(Array.from(n.target.files))},i=async()=>{x.length!==0&&await s(x)};return e.jsxs("div",{className:"bg-white h-auto rounded-lg p-2 sm:p-6",children:[e.jsx("div",{className:"flex items-center gap-4 mb-6",children:e.jsxs("div",{className:"w-full space-x-2",children:[e.jsx("input",{id:"fileInput",ref:c,type:"file",accept:".pdf,image/*",multiple:!0,className:"mb-1 sm:mb-0 w-[55%] sm:w-[80%] h-full py-2 border-1 px-2 rounded-lg",onChange:A}),e.jsxs(b,{variant:"primary",onClick:()=>{var n;return(n=c.current)==null?void 0:n.click()},className:"",children:[e.jsx("span",{className:"hidden sm:block",children:" Select Files"}),e.jsx("span",{className:"block sm:hidden",children:" Select"})]}),e.jsx(b,{isLoading:o,onClick:i,className:"px-2 sm:px-4 py-2 rounded-lg",variant:"primary",children:"upload"})]})}),e.jsxs("div",{className:"grid h-auto grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 text-blue-700",children:[e.jsx("i",{className:"fas fa-file-pdf text-lg"}),e.jsx("h3",{className:"font-medium",children:"PDF Files"})]}),e.jsx("div",{className:"max-h-[300px] overflow-y-auto custom-scrollbar max-w-[100%] overflow-x-hidden",children:R.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No PDF files uploaded"}):e.jsx("div",{className:"space-y-2 max-w-[100%]",children:R.map((n,g)=>e.jsxs("div",{className:"flex items-center max-w-full justify-between py-2 px-3 bg-green-50 rounded-lg hover:bg-green-100 transition-colors",children:[e.jsx("span",{className:"text-gray-700 truncate whitespace-wrap max-w-[100%] flex-1 ",children:n.originalName||"Unnamed PDF"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{onClick:()=>Z({src:n==null?void 0:n.url,alt:(n==null?void 0:n.originalName)||"file.pdf"}),size:"sm",className:"text-sm",children:e.jsx("i",{className:"fa-solid fa-download"})}),e.jsx(b,{size:"sm",isLoading:l,onClick:()=>t(n._id),title:"Delete",children:e.jsx("i",{className:"fas fa-trash"})})]})]},g))})})]}),e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 text-blue-700",children:[e.jsx("i",{className:"fas fa-images text-lg"}),e.jsx("h3",{className:"font-medium",children:"Image Files"})]}),e.jsx("div",{className:"max-h-[300px] overflow-y-auto custom-scrollbar max-w-[100%] overflow-x-hidden",children:k.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No image files uploaded"}):e.jsx(ee,{imageFiles:k,handleDeleteFile:t,height:80,minWidth:98,maxWidth:100})})]})]}),v&&e.jsx("div",{onClick:()=>C(null),className:"fixed inset-0 bg-black/70 z-50 p-8 bg-opacity-60 flex items-center justify-center",children:e.jsxs("div",{onClick:n=>n.stopPropagation(),className:"relative bg-white rounded py-8 px-4 max-w-[90vw] max-h-[80vh] shadow-lg",children:[e.jsx("i",{className:"fas fa-times absolute top-2 right-3 text-xl text-gray-700 hover:text-red-500 cursor-pointer",onClick:()=>C(null)}),e.jsx("img",{src:v,alt:"Full View",className:"max-h-[70vh] w-auto object-contain rounded"})]})})]})},ze=()=>{var P,I,L,O,M;const{projectId:a,organizationId:s}=W(),{isMobile:t,openMobileSidebar:o}=B(),l=G();if(!a)return null;const[c,x]=S.useState(!1),f=me(),{mutateAsync:R,isPending:k}=ue(),v=fe(),{mutateAsync:C,isPending:A}=pe(),{data:i,isLoading:n,refetch:g,error:w}=xe(a),{mutateAsync:T,isPending:E}=he(),{mutateAsync:$,isPending:q}=ge(),_=async()=>{var r,d;try{E||(await T({projectId:a}),l("../workmainschedule")),h({description:"Completion status updated successfully",title:"Success"})}catch(m){h({title:"Error",description:((d=(r=m==null?void 0:m.response)==null?void 0:r.data)==null?void 0:d.message)||"Failed to update completion status",variant:"destructive"})}},z=async r=>{var d,m;try{await f.mutateAsync({projectId:a,roomName:r}),h({description:"Room Created successfully",title:"Success"})}catch(u){h({title:"Error",description:((m=(d=u==null?void 0:u.response)==null?void 0:d.data)==null?void 0:m.message)||"Failed to create room status",variant:"destructive"})}},K=async r=>{var d,m;try{E||await C({projectId:a,roomId:r}),h({description:"Room section Deleted successfully",title:"Success"})}catch(u){h({title:"Error",description:((m=(d=u==null?void 0:u.response)==null?void 0:d.data)==null?void 0:m.message)||"Failed to delete the room",variant:"destructive"})}},Q=async(r,d)=>{var m,u;try{await R({projectId:a,roomName:r,files:d}),h({description:"File uploaded successfully",title:"Success"}),g()}catch(p){h({title:"Error",description:((u=(m=p==null?void 0:p.response)==null?void 0:m.data)==null?void 0:u.message)||(p==null?void 0:p.message)||" Failed to upload the files",variant:"destructive"})}},U=async(r,d)=>{var m,u;try{await v.mutateAsync({projectId:a,roomName:r,fileId:d}),h({description:"File deleted successfully",title:"Success"}),g()}catch(p){h({title:"Error",description:((u=(m=p==null?void 0:p.response)==null?void 0:m.data)==null?void 0:u.message)||"Failed to delete the files",variant:"destructive"})}};return n?e.jsx(te,{}):location.pathname.includes("shortlist")?e.jsx(Y,{}):e.jsxs("div",{className:"container mx-auto max-h-full overflow-y-auto max-w-full min-h-full",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4 mb-6",children:[e.jsxs("h2",{className:"text-2xl sm:text-2xl lg:text-2xl xl:text-3xl font-semibold text-blue-600 flex items-center",children:[t&&e.jsx("button",{onClick:o,className:"mr-3 p-2 rounded-md  border-gray-300 hover:bg-gray-100",title:"Open Menu",children:e.jsx("i",{className:"fa-solid fa-bars"})}),e.jsx("i",{className:"fa-solid fa-object-group mr-2"}),"Sample Design Files"]}),e.jsxs("div",{className:"!w-[100%] sm:!w-[100%] lg:!w-[50%] xl:!w-[65%] flex flex-col sm:flex-row gap-3 justify-end",children:[e.jsxs("div",{className:"flex  flex-wrap md:flex-nowrap gap-2 justify-end",children:[e.jsxs(b,{onClick:()=>x(!0),className:"bg-blue-600 hover:bg-blue-700 text-white flex-1 sm:flex-initial min-w-max",disabled:!!w,children:[e.jsx("i",{className:"fas fa-plus mr-2"}),e.jsx("span",{className:"",children:"Add room"})]}),e.jsxs(b,{isLoading:E,onClick:_,className:"bg-green-600 hover:bg-green-700 text-white flex-1 sm:flex-initial min-w-max",disabled:!!w,children:[e.jsx("i",{className:"fa-solid fa-circle-check mr-2"}),"Mark Complete"]})]}),e.jsxs("div",{className:"flex flex-wrap md:flex-nowrap gap-2 justify-end",children:[e.jsx(se,{projectId:a,stageNumber:3,stagePath:"sampledesign",className:"flex-1 sm:flex-initial min-w-max",disabled:!!w}),!w&&e.jsx(ae,{projectId:a,stageNumber:"3",className:"w-full sm:w-fit",isStageCompleted:i==null?void 0:i.status}),e.jsx(J,{stageName:"SampleDesignModel",projectId:a,organizationId:s,currentAssignedStaff:(i==null?void 0:i.assignedTo)||null,className:"flex-1 sm:flex-initial min-w-max"})]})]})]}),w&&e.jsxs("div",{className:"max-w-xl mx-auto p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center mb-6",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2",children:"⚠️ Error Occurred"}),e.jsx("p",{className:"text-red-500 text-sm mb-4",children:((I=(P=w==null?void 0:w.response)==null?void 0:P.data)==null?void 0:I.message)||"Failed to load data"}),e.jsx(b,{onClick:()=>g(),className:"bg-red-600 text-white px-4 py-2",children:"Retry"})]}),!w&&e.jsxs(e.Fragment,{children:[e.jsxs(D,{className:"p-4 mb-6 w-full shadow border-l-4 border-blue-600 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-3 text-blue-700 text-sm font-medium mb-2",children:[e.jsx("i",{className:"fa-solid fa-clock text-blue-500 text-lg"}),e.jsx("span",{children:"Stage Timings"})]}),e.jsx(X,{stageName:"sampledesign",completedAt:(L=i==null?void 0:i.timer)==null?void 0:L.compltedAt,formId:i==null?void 0:i._id,projectId:a,deadLine:(O=i==null?void 0:i.timer)==null?void 0:O.deadLine,startedAt:(M=i==null?void 0:i.timer)==null?void 0:M.startedAt,refetchStageMutate:g,deadLineMutate:$,isPending:q})]}),e.jsx(D,{className:"mb-6  text-blue-600 border-l-4 border-1 border-blue-600",children:e.jsx(V,{to:"shortlist",children:e.jsxs("div",{className:"py-4 ml-2 flex justify-between items-center",children:[e.jsx("p",{className:"text-md sm:text-xl",children:"Sample Reference Designs"}),e.jsx("i",{className:"mr-4 fas fa-arrow-right text-blue-600"})]})})}),!(i!=null&&i.rooms)||i.rooms.length===0?e.jsxs("div",{className:"text-center py-10 sm:py-16 bg-white rounded-lg shadow-sm",children:[e.jsx("i",{className:"fas fa-home text-blue-200 text-5xl sm:text-6xl mb-4"}),e.jsx("h2",{className:"text-xl sm:text-2xl font-semibold text-gray-700 mb-2",children:"No Rooms Added Yet"}),e.jsx("p",{className:"text-gray-500 mb-6 max-w-md mx-auto",children:"Start by adding a room to upload design files"}),e.jsxs("button",{onClick:()=>x(!0),className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 min-w-[200px]",children:[e.jsx("i",{className:"fas fa-plus mr-2"}),"Add Your First Room"]})]}):e.jsx("div",{className:"grid grid-cols-1  gap-6",children:i.rooms.map(r=>e.jsxs("div",{className:"bg-white border-l-4 border-blue-600 rounded-xl shadow-sm p-1 sm:p-6 flex flex-col",children:[e.jsxs("div",{className:"flex sm:flex-row items-center justify-between gap-3 mb-4",children:[e.jsxs("h2",{className:"text-xl font-semibold text-blue-700 truncate",children:[e.jsx("i",{className:"fas fa-door-open mr-2"}),r.roomName]}),e.jsxs(b,{isLoading:A,onClick:()=>K(r._id),variant:"danger",className:"bg-red-600 text-white  sm:w-auto mt-2 sm:mt-0",children:[e.jsx("i",{className:"fa-solid fa-trash mr-2"}),"Delete"]})]}),e.jsx("div",{className:"flex-grow",children:e.jsx(be,{files:r.files,onUpload:d=>Q(r.roomName,d),onDelete:d=>U(r.roomName,d),uploadPending:k,deletePending:v.isPending})})]},r.roomName))})]}),e.jsx(we,{isOpen:c,onClose:()=>x(!1),onSubmit:z,addPending:f.isPending})]})};export{ze as default};
