import{r as o,j as e,B,t as T,af as H,L as U,u as J,ah as K,am as q}from"./index-BAM0eJUz.js";import{a as W,b as X,c as Y,u as Z}from"./projectApi-D7-uwdh2.js";import{a as V}from"./validation-u7TNeOxm.js";import{d as R}from"./dateFormator-BGKi5rfZ.js";import{a as F}from"./currentActiveStageApi-CYcZaWni.js";import{I as ee}from"./Input-1UBXZqEj.js";const E=({message:t,onClick:y})=>{const[N,v]=o.useState(!0),[a,i]=o.useState("in"),n=()=>{i("out")},j=()=>{a==="out"&&(v(!1),y())};return N?e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        @keyframes bounceScaleIn {
          0% { transform: scale(0); }
          60% { transform: scale(1.1); }
          80% { transform: scale(0.95); }
          100% { transform: scale(1); }
        }
        @keyframes bounceScaleOut {
          0% { transform: scale(1); }
          20% { transform: scale(1.1); }
          100% { transform: scale(0); }
        }
      `}),e.jsx("div",{className:"fixed inset-0 bg-[#0a0a0a10] z-[1099] flex items-center justify-center px-4",onClick:()=>n(),children:e.jsxs("div",{onClick:l=>l.stopPropagation(),style:{animation:a==="in"?"bounceScaleIn 0.2s ease-out forwards":"bounceScaleOut 0.2s ease-in forwards"},onAnimationEnd:j,className:"bg-[#2f303a] text-gray-800 rounded-2xl !w-[30%] shadow-lg !px-6 max-w-lg sm:!px-3 sm:py-2 sm:w-full text-center !space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center border-b border-red-500 pb-2",children:[e.jsx("span",{className:"text-white text-lg",children:"Error occured"}),e.jsx("span",{className:"cursor-pointer",onClick:n,children:e.jsx("i",{className:"fa-solid fa-xmark text-red-500 text-lg"})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white text-lg",children:t[0].toUpperCase()+t.slice(1)}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:n,className:"cursor-pointer inline-block bg-red-500 hover:bg-red-800 duration-200 px-5 py-1 rounded-md text-white",children:"OK"})})]})]})})]}):null},te=["none","low","medium","high"],se=["Active","Delayed","In Progress","In Testing","On Track","On Hold","Approved","Cancelled","Planning","Invoice"],ae={Active:"bg-green-100 text-green-800",Delayed:"bg-red-100 text-red-800","In Progress":"bg-blue-100 text-blue-800","In Testing":"bg-yellow-100 text-yellow-800","On Track":"bg-emerald-100 text-emerald-800","On Hold":"bg-gray-100 text-gray-800",Approved:"bg-indigo-100 text-indigo-800",Cancelled:"bg-rose-100 text-rose-800",Planning:"bg-purple-100 text-purple-800",Invoice:"bg-pink-100 text-pink-800"},re=({onClose:t,refetch:y,setShowForm:N,organizationId:v,isEditing:a,setEditForm:i,editForm:n,editProjectId:j})=>{var A,O,d,f;const[l,g]=o.useState({projectName:"",description:"",duration:0,tags:[],startDate:new Date,endDate:null,dueDate:null,priority:"none",status:"Active"}),[p,w]=o.useState({}),u=(s,I)=>{let{name:C,value:x}=s.target;if(C==="tags"){I(P=>({...P,tags:Array.from(new Set([...P.tags,x]))}));return}if(C.includes("Date")){const P=x?new Date(x):null;I(Q=>{const S={...Q,[C]:P};if(S.startDate&&S.dueDate){const z=S.dueDate.getTime()-S.startDate.getTime();z>=0?S.duration=Math.ceil(z/(1e3*3600*24)):S.duration=0}return S});return}I(P=>({...P,[C]:x}))},{mutateAsync:k,isPending:c,error:r,isError:D,reset:m}=W(),{mutateAsync:M,isPending:h,error:b,isError:L,reset:$}=X(),_=async s=>{var I,C;s.preventDefault(),s.stopPropagation();try{const x=a?V(n):V(l);w(x),Object.keys(x).length===0&&(a&&j?h||(await M({projectId:j,formData:n}),T({title:"Success",description:"Project Edited Successfully"})):c||(await k({projectData:l,orgsId:v}),T({title:"Success",description:"Project Created Successfully"})),y(),N(!1))}catch(x){T({title:"Error",description:((C=(I=x==null?void 0:x.response)==null?void 0:I.data)==null?void 0:C.message)||(x==null?void 0:x.message)||"Operation Failed",variant:"destructive"})}};return e.jsx(e.Fragment,{children:e.jsxs("div",{onClick:s=>s.stopPropagation(),className:"bg-white w-full h-full overflow-y-auto custom-scrollbar max-w-3xl mx-auto rounded-2xl shadow-2xl p-4 sm:p-6 md:p-8 border border-gray-200 relative",children:[!c&&D&&e.jsx(E,{message:((O=(A=r==null?void 0:r.response)==null?void 0:A.data)==null?void 0:O.message)||(r==null?void 0:r.message)||"Something went wrong",onClick:()=>m()}),!h&&L&&e.jsx(E,{message:((f=(d=b==null?void 0:b.response)==null?void 0:d.data)==null?void 0:f.message)||(b==null?void 0:b.message)||"Something went wrong",onClick:()=>$()}),e.jsxs("div",{className:"flex justify-between items-center mb-4 sm:mb-6",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-blue-700 flex items-center gap-2",children:a?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa-solid fa-edit"})," Edit Project"]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa-solid fa-plus"})," Create Project"]})}),e.jsx("button",{onClick:t,className:"text-gray-500 hover:text-red-500 text-xl",children:e.jsx("i",{className:"fa-solid fa-xmark"})})]}),e.jsxs("form",{onSubmit:_,className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Project Name"}),e.jsx("input",{autoFocus:!0,name:"projectName",value:a?n.projectName:l.projectName,onChange:s=>u(s,a?i:g),type:"text",placeholder:"Enter name",className:"input outline-none w-full border border-gray-300 rounded-md px-3 py-2"}),p.projectName&&e.jsx("p",{className:"text-red-600 text-xs mt-1",children:p.projectName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Duration (days)"}),e.jsx("input",{disabled:!0,type:"number",name:"duration",onChange:s=>u(s,a?i:g),value:a?n.duration:l.duration,placeholder:"Ex: 15",className:"input outline-none w-full border border-gray-300 rounded-md px-3 py-2 bg-gray-100 cursor-not-allowed"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{rows:3,name:"description",onChange:s=>u(s,a?i:g),value:a?n.description:l.description,placeholder:"Brief project overview",className:"input outline-none w-full border border-gray-300 rounded-md px-3 py-2 resize-none"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Start Date"}),e.jsx("input",{type:"date",onChange:s=>u(s,a?i:g),value:a?n.startDate?n.startDate.toISOString().split("T")[0]:"":l.startDate?l.startDate.toISOString().split("T")[0]:"",name:"startDate",className:"input outline-none w-full border border-gray-300 rounded-md px-3 py-2"}),p.startDate&&e.jsx("p",{className:"text-red-600 text-xs mt-1",children:p.startDate})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"End Date"}),e.jsx("input",{type:"date",name:"endDate",onChange:s=>u(s,a?i:g),value:a?n.endDate?n.endDate.toISOString().split("T")[0]:"":l.endDate?l.endDate.toISOString().split("T")[0]:"",className:"input outline-none w-full border border-gray-300 rounded-md px-3 py-2"}),p.endDate&&e.jsx("p",{className:"text-red-600 text-xs mt-1",children:p.endDate})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Due Date"}),e.jsx("input",{type:"date",name:"dueDate",onChange:s=>u(s,a?i:g),value:a?n.dueDate?n.dueDate.toISOString().split("T")[0]:"":l.dueDate?l.dueDate.toISOString().split("T")[0]:"",className:"input outline-none w-full border border-gray-300 rounded-md px-3 py-2"}),p.dueDate&&e.jsx("p",{className:"text-red-600 text-xs mt-1",children:p.dueDate})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Priority"}),e.jsx("select",{name:"priority",onChange:s=>u(s,a?i:g),value:a?n.priority:l.priority,className:"input w-full border border-gray-300 rounded-md px-3 py-2",children:te.map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsx("select",{name:"status",onChange:s=>u(s,a?i:g),value:a?n.status:l.status,className:"input w-full border border-gray-300 rounded-md px-3 py-2",children:se.map(s=>e.jsx("option",{value:s,children:s},s))})]})]}),e.jsx("div",{className:"text-end",children:e.jsx(B,{isLoading:c||h,type:"submit",disabled:c||h,className:"bg-blue-600 text-white px-6 w-full sm:w-40 py-2 rounded-xl hover:bg-blue-700 transition-all",children:c||h?e.jsx("div",{className:"mx-auto w-5 h-5 border-2 border-white border-t-transparent rounded-full"}):a?"Edit Project":"Create Project"})})]})]})})},le=o.memo(re),ne=({project:t,onEdit:y,organizationId:N,refetch:v})=>{const{setProjectId:a}=H(),{mutateAsync:i,isPending:n}=Y(),{data:j,isLoading:l}=F(t==null?void 0:t._id),g=r=>{a(r)},p=r=>{switch(r){case"high":return"bg-red-100 text-red-500";case"medium":return"bg-yellow-100 text-yellow-600";case"low":return"bg-green-100 text-green-600";default:return"bg-white shadow-sm"}},w=o.useMemo(()=>{var r;return(r=t.projectInformation)!=null&&r.startDate?R(t.projectInformation.startDate):null},[]),u=o.useMemo(()=>{var r;return(r=t.projectInformation)!=null&&r.endDate?R(t.projectInformation.endDate):null},[]),k=o.useMemo(()=>{var r;return(r=t.projectInformation)!=null&&r.dueDate?R(t.projectInformation.dueDate):null},[]),c=async()=>{var r,D;try{if(!window.confirm("Are you sure you want to delete this project?"))return;await i(t._id),T({title:"Success",description:"Project Deleted Successfully"}),v()}catch(m){T({title:"Error",description:((D=(r=m==null?void 0:m.response)==null?void 0:r.data)==null?void 0:D.message)||(m==null?void 0:m.message)||"Failed to Delete",variant:"destructive"})}};return e.jsxs("div",{className:"p-2 sm:p-5 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xl font-semibold text-[#1f2d3d]",children:[e.jsx("i",{className:"fa-solid fa-folder-open text-blue-600"}),t.projectName]}),e.jsxs("span",{className:`text-sm px-3 py-1 rounded-full font-medium ${p(t.projectInformation.priority)}`,children:[t.projectInformation.priority," priority"]})]}),e.jsxs("div",{className:"text-sm text-gray-700 grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-3 gap-y-1 sm:gap-y-2 gap-x-4",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("i",{className:"fa-solid fa-calendar-day text-gray-500"}),e.jsx("strong",{children:"Start:"})," ",w||"N/A"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("i",{className:"fa-solid fa-calendar-check text-gray-500"}),e.jsx("strong",{children:"End:"})," ",u||"N/A"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("i",{className:"fa-solid fa-calendar-check text-gray-500"}),e.jsx("strong",{children:"Due:"})," ",k||"N/A"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("i",{className:"fa-solid fa-hourglass-half text-gray-500"}),e.jsxs("strong",{children:["Duration: ",t.projectInformation.duration," days"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("i",{className:"fa-solid fa-hourglass-half text-gray-500"}),e.jsxs("strong",{children:["Status: ",e.jsx("span",{className:`${ae[t.projectInformation.status]} !bg-transparent`,children:t.projectInformation.status})," "]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Progress"}),e.jsx("div",{className:"mt-1 w-full h-3 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-blue-600",style:{width:`${t.completionPercentage}%`}})}),e.jsxs("div",{className:"text-sm text-right text-gray-600 mt-1",children:[t.completionPercentage,"% Complete"]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-2 text-sm text-blue-600",children:[e.jsx(U,{to:`/${N}/projectdetails/${t._id}/${j}`,onClick:()=>g(t._id),className:`hover:underline ${l?"cursor-block":"cursor-pointer"}  flex items-center gap-1`,children:l?e.jsx("i",{className:"fa fa-spinner animate-spin text-blue-600"}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa-solid fa-eye"})," View"]})}),e.jsxs(B,{isLoading:n,variant:"outline",onClick:c,className:"hover:underline cursor-pointer flex items-center gap-1 text-red-500 !border-0",children:[e.jsx("i",{className:"fa-solid fa-trash"}),"Delete"]}),e.jsxs("button",{onClick:()=>y(t,t._id),className:"hover:underline cursor-pointer flex items-center gap-1 text-amber-500",children:[e.jsx("i",{className:"fa-solid fa-pencil"}),"edit"]})]})]})},oe=o.memo(ne);function ie(t){return{projectName:t.projectName,description:t.description??"",duration:t.projectInformation.duration??0,tags:t.projectInformation.tags??[],startDate:t.projectInformation.startDate?new Date(t.projectInformation.startDate):null,endDate:t.projectInformation.endDate?new Date(t.projectInformation.endDate):null,dueDate:t.projectInformation.dueDate?new Date(t.projectInformation.dueDate):null,priority:t.projectInformation.priority??"none",status:t.projectInformation.status??"Active"}}const G=()=>e.jsxs("div",{className:"animate-pulse bg-white border-l-8 border-blue-600 shadow-md rounded-xl p-4 flex flex-col justify-between min-h-[250px] w-full max-w-[500px]",children:[e.jsx("div",{className:"h-5 w-1/2 bg-gray-200 rounded mb-4"}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"h-4 w-4 bg-gray-300 rounded-full"}),e.jsx("div",{className:"h-3 w-1/3 bg-gray-300 rounded"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"h-4 w-4 bg-gray-300 rounded-full"}),e.jsx("div",{className:"h-3 w-1/3 bg-gray-300 rounded"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"h-4 w-4 bg-gray-300 rounded-full"}),e.jsx("div",{className:"h-3 w-1/3 bg-gray-300 rounded"})]}),e.jsx("div",{className:"h-3 bg-gray-300 rounded w-full mb-4"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"h-3 w-1/4 bg-gray-300 rounded"}),e.jsx("div",{className:"h-3 w-1/4 bg-gray-300 rounded"}),e.jsx("div",{className:"h-3 w-1/4 bg-gray-300 rounded"})]})]}),pe=()=>{var A,O;const{organizationId:t}=J(),{openMobileSidebar:y,isMobile:N}=H(),{role:v}=K(d=>d.authStore),[a,i]=o.useState(!1),[n,j]=o.useState(!1),[l,g]=o.useState(""),[p,w]=o.useState({projectName:"",description:"",duration:0,tags:[],startDate:new Date,endDate:null,dueDate:null,priority:"none",status:"Active"}),[u,k]=o.useState(null);let{data:c,refetch:r,isPending:D,error:m,isLoading:M}=Z(t);const h=o.useMemo(()=>c?c==null?void 0:c.filter(d=>d.projectName.toLowerCase().includes(l.toLowerCase())):[],[c,l]),b=["owner","CTO","staff"],L=o.useCallback((d,f)=>{const s=ie(d);w(s),k(f),j(!0),i(!0)},[]),$=o.useCallback(()=>{i(!1),j(!1)},[]),_=o.useCallback((d,f)=>{L(d,f)},[L]);return M?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4",children:[1,2,3,4].map(d=>e.jsx(G,{},d))}):e.jsxs("div",{className:"w-[100%] flex flex-col h-full min-h-0 ",children:[e.jsxs("header",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex ",children:[N&&e.jsx("button",{onClick:y,className:"mr-3 p-2 rounded-md border-none border-gray-300 hover:bg-gray-100",title:"Open Menu",children:e.jsx("i",{className:"fa-solid fa-bars"})}),e.jsxs("h2",{className:"text-2xl sm:text-3xl font-bold text-[#1f2d3d] flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-diagram-project text-blue-600 text-2xl"}),e.jsx("p",{children:q.PROJECTS})]})]}),e.jsxs("div",{className:"flex items-center gap-3 w-full sm:w-auto",children:[e.jsxs("div",{className:"relative w-full sm:w-64",children:[e.jsx(ee,{placeholder:"Search projects...",value:l,onChange:d=>g(d.target.value),className:"pl-10"}),e.jsx("i",{className:"fa-solid fa-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"})]}),b.includes(v)&&e.jsx("div",{onClick:()=>{i(!a)},className:"bg-blue-600  cursor-pointer !h-[40px] !w-[40px] flex justify-center items-center rounded-full",children:e.jsx("i",{className:`fa-solid fa-plus text-white transition-transform duration-300 ${a?"rotate-135":"rotate-0"}`})})]})]}),e.jsx("hr",{className:"my-2 border-b-1 border-gray-300"}),!m&&!D&&((c==null?void 0:c.length)??0)===0&&e.jsxs("div",{className:"flex h-full flex-col items-center justify-center w-full py-16 text-center text-gray-500",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“‚"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"No Projects Found"}),e.jsx("p",{className:"text-sm text-gray-400 mb-4 max-w-md",children:"Looks like you havenâ€™t added any projects yet. Click the â€œ+â€ button to get started and create your first project."}),e.jsx("button",{onClick:()=>i(!0),className:"bg-blue-600 cursor-pointer hover:bg-blue-700 text-white px-4 py-2 rounded-md transition",children:"Create New Project"})]}),m&&e.jsxs("div",{className:"max-w-xl sm:min-w-[80%]  mx-auto mt-4 p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2 text-xl sm:text-3xl",children:"âš ï¸ Error Occurred"}),e.jsx("p",{className:"text-red-500  mb-4 text-lg sm:text-xl",children:((O=(A=m==null?void 0:m.response)==null?void 0:A.data)==null?void 0:O.message)||"Failed to load the projects"}),e.jsx(B,{onClick:()=>r(),className:"bg-red-600 text-white px-4 py-2",children:"Retry"})]}),!m&&e.jsxs("div",{className:"h-full flex-1 !overflow-y-auto custom-scrollbar grid md:grid-cols-2 gap-6",children:[D&&[...Array(6)].map((d,f)=>e.jsx(o.Fragment,{children:e.jsx(G,{})},f)),(h==null?void 0:h.length)>0?h==null?void 0:h.map((d,f)=>e.jsx(e.Fragment,{children:e.jsx("div",{className:"h-[256px] sm:!h-[270px] md:!h-[330px] lg:!h-[282px] flex flex-col shadow-md rounded-xl overflow-hidden border-l-8 border-blue-600 bg-white",children:e.jsx(oe,{refetch:r,onEdit:_,index:f,project:d,organizationId:t})},d._id)})):e.jsxs("div",{className:"col-span-full text-center py-10 text-gray-500",children:['No projects found matching "',l,'"']})]}),a&&e.jsx("div",{onClick:$,className:"fixed inset-0 z-50 bg-black/40 backdrop-blur-sm flex items-center justify-center p-4",children:e.jsx(le,{onClose:$,refetch:r,setShowForm:i,organizationId:t,isEditing:n,setEditForm:w,editForm:p,editProjectId:u})})]})};export{pe as default};
