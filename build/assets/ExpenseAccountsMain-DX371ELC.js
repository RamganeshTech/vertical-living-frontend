import{j as e,u as M,b as z,a as R,r as x,O as V}from"./index-C0KkMjHg.js";import{B as v}from"./Button-DIkkRbUr.js";import{B as _}from"./Breadcrumb-DmapgPZT.js";import{t as E}from"./toast-BSC5QTk1.js";import{u as U,a as H}from"./expenseApi-B-BrhCqT.js";import"./useQuery-Dp3DvoKb.js";import"./useMutation-CaYNPTtb.js";import"./useInfiniteQuery-CVtQ6J-e.js";import"./roleCheck-DWgWWcQZ.js";const G=({expense:r,index:d,onView:c,onEdit:m,onDelete:p,isDeleting:u})=>e.jsxs("div",{className:"grid grid-cols-16 gap-4 px-6 py-4 border-b border-gray-100 hover:bg-gray-50 transition-colors items-center",children:[e.jsx("div",{className:"col-span-1 text-center text-sm font-medium text-gray-600",children:d+1}),e.jsx("div",{className:"col-span-2 text-center",children:e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-md bg-blue-50 text-blue-700 text-xs font-mono font-semibold",children:r.invoiceNumber})}),e.jsx("div",{className:"col-span-3 text-center",children:e.jsx("p",{className:"font-medium text-gray-900",children:r.vendorName})}),e.jsx("div",{className:"col-span-2 text-center",children:e.jsxs("span",{className:"text-lg font-bold text-green-600",children:["$",r.amount.toLocaleString()]})}),e.jsx("div",{className:"col-span-2 text-center text-sm text-gray-600",children:new Date(r.dateOfPayment).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}),e.jsx("div",{className:"col-span-2 text-center",children:e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full bg-purple-50 text-purple-700 text-xs font-medium",children:[e.jsx("i",{className:"fas fa-credit-card mr-1"}),r.paidThrough]})}),e.jsx("div",{className:"col-span-2 text-center text-sm text-gray-500",children:new Date(r.createdAt).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}),e.jsxs("div",{className:"col-span-2 flex justify-center gap-2",children:[e.jsx("button",{onClick:c,className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"View Details",children:e.jsx("i",{className:"fas fa-eye"})}),e.jsx("button",{onClick:m,className:"p-2 text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"Edit Expense",children:e.jsx("i",{className:"fas fa-edit"})}),e.jsx("button",{onClick:p,disabled:u,className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors disabled:opacity-50",title:"Delete Expense",children:e.jsx("i",{className:`fas ${u?"fa-spinner fa-spin":"fa-trash"}`})})]})]}),se=()=>{var D,C;const r=M(),d=z(),{organizationId:c}=R(),m=x.useRef(null),p=d.pathname.includes("/expensesingle")||d.pathname.includes("/create")||d.pathname.includes("/edit"),u=[{label:"Account",path:`/organizations/${c}/projects/accounting`},{label:"Expenses",path:`/organizations/${c}/projects/expensemain`}],[a,n]=x.useState({search:"",vendorId:"",startDate:"",endDate:"",minAmount:"",maxAmount:"",paidThrough:"",sortBy:"createdAt",sortOrder:"desc"}),[k,S]=x.useState(a.search);x.useEffect(()=>{const s=setTimeout(()=>{S(a.search)},500);return()=>clearTimeout(s)},[a.search]);const{data:o,fetchNextPage:N,hasNextPage:g,isFetchingNextPage:f,isLoading:y,isError:T,error:j,refetch:O}=U({organizationId:c||"",invoiceNumber:k,vendorId:a.vendorId||void 0,startDate:a.startDate||void 0,endDate:a.endDate||void 0,minAmount:a.minAmount?parseFloat(a.minAmount):void 0,maxAmount:a.maxAmount?parseFloat(a.maxAmount):void 0,paidThrough:a.paidThrough||void 0,sortBy:a.sortBy,sortOrder:a.sortOrder,limit:20}),A=H();x.useEffect(()=>{const s=m.current;if(!s)return;const t=()=>{const{scrollTop:h,scrollHeight:l,clientHeight:$}=s;l-h-$<100&&g&&!f&&(console.log("ðŸ“œ Loading more expenses..."),N())};return s.addEventListener("scroll",t),()=>s.removeEventListener("scroll",t)},[g,f,N]);const B=async s=>{var t,h;try{await A.mutateAsync({id:s,_organizationId:c||""}),E({title:"Success",description:"Expense deleted successfully"})}catch(l){E({title:"Error",description:((h=(t=l==null?void 0:l.response)==null?void 0:t.data)==null?void 0:h.message)||(l==null?void 0:l.message)||"Failed to delete the expense",variant:"destructive"})}},P=s=>{r(`expensesingle/${s}`)},F=s=>{r(`edit/${s}`)},b=Object.values(a).filter(s=>s!==""&&s!=="createdAt"&&s!=="desc").length,I=()=>{n({search:"",vendorId:"",startDate:"",endDate:"",minAmount:"",maxAmount:"",paidThrough:"",sortBy:"createdAt",sortOrder:"desc"})},i=(o==null?void 0:o.pages.flatMap(s=>s.data))||[],L=((C=(D=o==null?void 0:o.pages[0])==null?void 0:D.pagination)==null?void 0:C.total)||0,w=i.reduce((s,t)=>s+t.amount,0);return p?e.jsx(V,{}):e.jsxs("div",{className:"space-y-4 h-full",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-receipt mr-3 text-blue-600"}),"Expense Accounts"]}),e.jsx(_,{paths:u})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(v,{onClick:()=>r("statistics"),variant:"outline",children:[e.jsx("i",{className:"fas fa-chart-bar mr-2"}),"Statistics"]}),e.jsxs(v,{onClick:()=>r("create"),children:[e.jsx("i",{className:"fas fa-plus mr-2"}),"Add Expense"]})]})]}),!y&&i.length>0&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-4 text-white shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-100 text-sm font-medium",children:"Total Expenses"}),e.jsx("p",{className:"text-3xl font-bold mt-1",children:L})]}),e.jsx("i",{className:"fas fa-file-invoice text-4xl text-blue-200 opacity-50"})]})}),e.jsx("div",{className:"bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-4 text-white shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-green-100 text-sm font-medium",children:"Total Amount"}),e.jsxs("p",{className:"text-3xl font-bold mt-1",children:["$",w.toLocaleString()]})]}),e.jsx("i",{className:"fas fa-dollar-sign text-4xl text-green-200 opacity-50"})]})}),e.jsx("div",{className:"bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl p-4 text-white shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-purple-100 text-sm font-medium",children:"Average Expense"}),e.jsxs("p",{className:"text-3xl font-bold mt-1",children:["$",i.length>0?(w/i.length).toFixed(2):"0"]})]}),e.jsx("i",{className:"fas fa-chart-line text-4xl text-purple-200 opacity-50"})]})})]}),y?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("i",{className:"fas fa-spinner fa-spin text-blue-600 text-4xl"})}):T?e.jsxs("div",{className:"max-w-xl sm:min-w-[80%] mx-auto mt-4 p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2 text-xl sm:text-3xl",children:"âš ï¸ Error Occurred"}),e.jsx("p",{className:"text-red-500 mb-4 text-lg sm:text-xl",children:(j==null?void 0:j.message)||"Failed to load expenses"}),e.jsx(v,{onClick:()=>O(),className:"bg-red-600 text-white px-4 py-2",children:"Retry"})]}):e.jsxs("main",{className:"flex gap-2 !max-h-[90%]",children:[e.jsx("div",{className:"xl:w-80 flex-shrink-0",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-filter mr-2 text-blue-600"}),"Filters"]}),b>0&&e.jsxs("button",{onClick:I,className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:["Clear All (",b,")"]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx("i",{className:"fas fa-search mr-2"}),"Invoice Number"]}),e.jsx("input",{type:"text",autoFocus:!0,placeholder:"Search by invoice...",value:a.search,onChange:s=>n(t=>({...t,search:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx("i",{className:"fas fa-calendar mr-2"}),"Date Range"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"date",value:a.startDate,onChange:s=>n(t=>({...t,startDate:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Start Date"}),e.jsx("input",{type:"date",value:a.endDate,onChange:s=>n(t=>({...t,endDate:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"End Date"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx("i",{className:"fas fa-dollar-sign mr-2"}),"Amount Range"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"number",placeholder:"Min Amount",value:a.minAmount,onChange:s=>n(t=>({...t,minAmount:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",min:"0",step:"0.01"}),e.jsx("input",{type:"number",placeholder:"Max Amount",value:a.maxAmount,onChange:s=>n(t=>({...t,maxAmount:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",min:"0",step:"0.01"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx("i",{className:"fas fa-credit-card mr-2"}),"Payment Method"]}),e.jsxs("select",{value:a.paidThrough,onChange:s=>n(t=>({...t,paidThrough:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"All Methods"}),e.jsx("option",{value:"Cash",children:"Cash"}),e.jsx("option",{value:"Bank Transfer",children:"Bank Transfer"}),e.jsx("option",{value:"Credit Card",children:"Credit Card"}),e.jsx("option",{value:"Debit Card",children:"Debit Card"}),e.jsx("option",{value:"Check",children:"Check"}),e.jsx("option",{value:"UPI",children:"UPI"}),e.jsx("option",{value:"Other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx("i",{className:"fas fa-sort mr-2"}),"Sort By"]}),e.jsxs("select",{value:a.sortBy,onChange:s=>n(t=>({...t,sortBy:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"createdAt",children:"Created Date"}),e.jsx("option",{value:"dateOfPayment",children:"Payment Date"}),e.jsx("option",{value:"amount",children:"Amount"}),e.jsx("option",{value:"vendorName",children:"Vendor Name"}),e.jsx("option",{value:"invoiceNumber",children:"Invoice Number"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sort Order"}),e.jsxs("select",{value:a.sortOrder,onChange:s=>n(t=>({...t,sortOrder:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"desc",children:"Descending"}),e.jsx("option",{value:"asc",children:"Ascending"})]})]})]})]})}),i.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[300px] w-full bg-white rounded-xl text-center p-6",children:[e.jsx("i",{className:"fas fa-receipt text-5xl text-blue-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-1",children:"No Expenses Found"}),e.jsxs("p",{className:"text-sm text-gray-500",children:[b>0?"Try adjusting your filters to find expenses.":"Looks like there are no expenses yet.",e.jsx("br",{}),"Click on ",e.jsx("strong",{children:'"Add Expense"'})," to get started ðŸš€"]})]}):e.jsxs("div",{ref:m,className:"flex-1 max-h-[100%] overflow-y-auto",children:[e.jsx("div",{className:"bg-white rounded-t-xl border border-gray-200 sticky top-0 z-10",children:e.jsxs("div",{className:"grid grid-cols-16 gap-4 px-6 py-4 bg-gradient-to-r from-blue-50 to-indigo-50 font-semibold text-gray-700 text-sm",children:[e.jsx("div",{className:"col-span-1 text-center",children:"S.No"}),e.jsx("div",{className:"col-span-2 text-center",children:"Invoice #"}),e.jsx("div",{className:"col-span-3 text-center",children:"Vendor Name"}),e.jsx("div",{className:"col-span-2 text-center",children:"Amount"}),e.jsx("div",{className:"col-span-2 text-center",children:"Payment Date"}),e.jsx("div",{className:"col-span-2 text-center",children:"Paid Through"}),e.jsx("div",{className:"col-span-2 text-center",children:"Created At"}),e.jsx("div",{className:"col-span-2 text-center",children:"Actions"})]})}),e.jsx("div",{className:"bg-white rounded-b-xl border-x border-b border-gray-200",children:i.map((s,t)=>e.jsx(G,{expense:s,index:t,onView:()=>P(s._id),onEdit:()=>F(s._id),onDelete:()=>B(s._id),isDeleting:A.isPending},s._id))}),f&&e.jsx("div",{className:"flex justify-center py-8",children:e.jsxs("div",{className:"flex items-center gap-2 text-blue-600",children:[e.jsx("i",{className:"fas fa-spinner fa-spin text-2xl"}),e.jsx("span",{className:"text-sm font-medium",children:"Loading more expenses..."})]})}),!g&&i.length>0&&e.jsx("div",{className:"flex justify-center py-6",children:e.jsxs("p",{className:"text-gray-400 text-sm font-medium",children:[e.jsx("i",{className:"fas fa-check-circle mr-2"}),"You've reached the end of the list"]})})]})]})]})};export{se as default};
