import{d as k,e as L,q as M,f as Z,g as C,a as ee,r as u,u as se,j as e,B as $,S as te,h as re,i as ae,k as le,l as ie,t as p}from"./index-Bp58Hj9Q.js";import{u as oe}from"./sampleDesignApi-2u9WhKtC.js";import{N as b}from"./constants-BhfkdIAq.js";import{u as ne}from"./siteMeasurementApi-B-NQFUGC.js";import de from"./MaterialOverviewLoading-DJzlKxep.js";import"./Skeleton-OQa7E2V5.js";const ce=async({projectId:n,roomName:t,categoryName:d,categoryId:r,formData:i,api:o})=>{const{data:x}=await o.post(`/shortlisteddesign/upload/${n}/${t}/${d}/${r}`,i);if(!x.ok)throw new Error(x.message);return x.data},me=async({projectId:n,roomName:t,categoryName:d,categoryId:r,selectedImages:i,api:o})=>{const{data:x}=await o.post(`/shortlisteddesign/addexising/${n}/${t}/${d}/${r}`,{selectedImages:i});if(!x.ok)throw new Error(x.message);return x.data},xe=async({projectId:n,roomName:t,api:d})=>{const{data:r}=await d.get(`/shortlisteddesign/getroom/${n}/${t}`);if(!r.ok)throw new Error(r.message);return r.data},ge=async({projectId:n,roomName:t,categoryId:d,fileId:r,api:i})=>{const{data:o}=await i.delete(`/shortlisteddesign/remove/${n}/${t}/${r}/${d}`);if(!o.ok)throw new Error(o.message);return o.data},he=()=>{const n=["owner","staff","CTO"],{role:t}=k(),d=C(t);return L({mutationFn:async({projectId:r,roomName:i,categoryName:o,categoryId:x,formData:c})=>{if(!t||!n.includes(t))throw new Error("Not authorized");if(!d)throw new Error("API instance missing");return await ce({projectId:r,roomName:i,categoryName:o,categoryId:x,formData:c,api:d})},onSuccess:(r,{projectId:i,roomName:o})=>{M.invalidateQueries({queryKey:["shortlistedRoomDesigns",i,o]})}})},ue=()=>{const n=["owner","staff","CTO"],{role:t}=k(),d=C(t);return L({mutationFn:async({projectId:r,roomName:i,categoryId:o,categoryName:x,selectedImages:c})=>{if(!t||!n.includes(t))throw new Error("Not authorized");if(!d)throw new Error("API instance missing");return await me({projectId:r,roomName:i,categoryName:x,categoryId:o,selectedImages:c,api:d})},onSuccess:(r,{projectId:i,roomName:o})=>{M.invalidateQueries({queryKey:["shortlistedRoomDesigns",i,o]})}})},fe=({projectId:n,roomName:t})=>{const d=["owner","staff","CTO","client"],{role:r}=k(),i=C(r);return Z({queryKey:["shortlistedRoomDesigns",n,t],queryFn:async()=>{if(!r||!d.includes(r))throw new Error("Not authorized");if(!i)throw new Error("API instance missing");return await xe({projectId:n,roomName:t,api:i})},enabled:!!n&&!!t,retry:!1,refetchOnWindowFocus:!1})},pe=()=>{const n=["owner","staff","CTO"],{role:t}=k(),d=C(t);return L({mutationFn:async({projectId:r,roomName:i,categoryId:o,fileId:x})=>{if(!t||!n.includes(t))throw new Error("Not authorized");if(!d)throw new Error("API instance missing");return await ge({projectId:r,roomName:i,categoryId:o,fileId:x,api:d})},onSuccess:(r,{projectId:i,roomName:o})=>{M.invalidateQueries({queryKey:["shortlistedRoomDesigns",i,o]})}})},Ce=()=>{var T,B,G,V,K;const{projectId:n}=ee(),[t,d]=u.useState("Living Room"),[r,i]=u.useState([]),[o,x]=u.useState(0),[c,I]=u.useState([]),[h,F]=u.useState({categoryId:"",categoryName:""}),Q=se(),{data:f}=oe(n),R=he(),W=pe(),E=ue(),{data:w,refetch:_,isLoading:H}=fe({projectId:n,roomName:t}),{data:N,isLoading:J}=ne({projectId:n}),D=f==null?void 0:f.rooms.map(s=>s.roomName),P=(T=f==null?void 0:f.rooms)==null?void 0:T.find(s=>s.roomName===t),v=(P==null?void 0:P.files.filter(s=>s.type!=="pdf"))||[],j=(()=>{var l,a;if(!N||!t)return[];const s=(l=N.rooms)==null?void 0:l.find(m=>m.name===t);return((a=s==null?void 0:s.uploads)==null?void 0:a.map(m=>({categoryName:m.categoryName,categoryId:m._id})).filter(Boolean))||[]})();if(u.useEffect(()=>{var m;if(!N||!t){I([]),x(0);return}const s=(m=N.rooms)==null?void 0:m.find(g=>g.name===t);if(!s||!s.uploads||s.uploads.length===0){I([]),x(0);return}const l=s.uploads.filter(g=>g.type==="image");c.length===l.length&&c.every((g,S)=>g._id===l[S]._id)||(I(l),x(0))},[t,N]),u.useEffect(()=>{F({categoryId:"",categoryName:""}),i([])},[t]),H||J)return e.jsx(de,{});const U=async(s,l,a)=>{var g,S;if(!s.target.files||!t||!l)return;const m=new FormData;Array.from(s.target.files).forEach(y=>m.append("file",y));try{await R.mutateAsync({projectId:n,roomName:t,categoryId:a,categoryName:l,formData:m}),p({title:"Success",description:"Uploaded successfully"}),_()}catch(y){p({title:"Upload failed",description:((S=(g=y==null?void 0:y.response)==null?void 0:g.data)==null?void 0:S.message)||"Something went wrong",variant:"destructive"})}},X=async(s,l)=>{var a,m;try{await W.mutateAsync({projectId:n,roomName:t,categoryId:l,fileId:s}),p({title:"Success",description:"Deleted successfully"}),_()}catch(g){p({title:"Delete failed",description:((m=(a=g==null?void 0:g.response)==null?void 0:a.data)==null?void 0:m.message)||"Failed to delete",variant:"destructive"})}},q=s=>{const l=r.find(a=>a._id===s._id);i(l?a=>a.filter(m=>m._id!==s._id):a=>[...a,s])},Y=async(s,l)=>{var a,m;if(!(!t||r.length===0||!s))try{await E.mutateAsync({projectId:n,roomName:t,categoryName:s,categoryId:l,selectedImages:r}),p({title:"Success",description:"Images shortlisted successfully"}),i([]),_()}catch(g){p({title:"Failed to shortlist images",description:((m=(a=g==null?void 0:g.response)==null?void 0:a.data)==null?void 0:m.message)||"Try again later",variant:"destructive"})}},z=()=>{c.length!==0&&x(s=>(s-1+c.length)%c.length)},O=()=>{c.length!==0&&x(s=>(s+1)%c.length)},A=(()=>{if(!(w!=null&&w.shortlistedRooms))return[];const s=w.shortlistedRooms.find(l=>l.roomName===t);return(s==null?void 0:s.categories)||[]})();return e.jsx("div",{className:"max-h-full overflow-y-auto bg-gray-50 p-2",children:e.jsxs("div",{className:"max-w-full mx-auto",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-300 p-3 mb-6 flex flex-col md:flex-row justify-between md:items-center items-start gap-2 md:gap-0",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("div",{onClick:()=>Q(-1),className:"flex bg-gray-200 h-fit rounded-full items-center gap-2 backdrop-blur-sm px-4 py-2 cursor-pointer",children:[e.jsx("i",{className:"fas fa-arrow-left text-sm"}),e.jsx("span",{className:"text-sm hidden sm:inline-block font-medium",children:"Back"})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl md:text-3xl font-bold text-gray-900 mb-1",children:"Shortlisting Reference Designs"}),e.jsx("p",{className:"text-gray-600 hidden sm:inline-block text-sm md:text-md",children:"Select and organize your favorite design references for easy access"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-1 md:gap-4 items-start sm:items-center",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 whitespace-nowrap",children:"Select Room:"}),e.jsx("select",{value:t,onChange:s=>d(s.target.value),className:"flex-1 max-w-xs px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white text-gray-900",children:D==null?void 0:D.map(s=>e.jsx("option",{value:s,children:s},s))})]})]}),c.length>0?e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-300 p-6 mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-6 text-center",children:"Site Image Preview"}),e.jsxs("div",{className:"flex flex-col lg:flex-row items-center justify-center gap-6",children:[e.jsxs("div",{className:"p-2 flex-shrink-0 order-1 lg:order-2",children:[e.jsx("div",{className:"w-80 h-60 md:w-96 md:h-72 lg:w-[500px] lg:h-[350px] border-4 border-blue-500 rounded-xl shadow-lg overflow-hidden bg-gray-100",children:e.jsx("img",{src:((B=c[o])==null?void 0:B.url)||b,className:"object-cover w-full h-full",alt:"Selected"})}),e.jsxs("div",{className:"text-center mt-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 truncate max-w-[500px]",children:(G=c[o])==null?void 0:G.categoryName}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[o+1," of ",c.length]})]})]}),e.jsxs("div",{className:"flex lg:contents gap-6 order-2",children:[e.jsx("div",{className:"flex-shrink-0 lg:order-1",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-20 h-20 md:w-24 md:h-24 cursor-pointer rounded-lg overflow-hidden border-2 border-gray-200 hover:border-blue-400 transition-colors duration-200",onClick:z,children:e.jsx("img",{src:((V=c[(o-1+c.length)%c.length])==null?void 0:V.url)||b,className:"object-cover w-full h-full hover:scale-105 transition-transform duration-200",alt:"Previous"})}),e.jsx("p",{className:"text-xs text-gray-500 mt-2 font-medium",children:"Previous"}),e.jsxs($,{onClick:z,className:"mt-2 flex items-center gap-2 px-3 py-1 bg-gray-600 hover:bg-gray-700 text-xs",children:[e.jsx("i",{className:"fas fa-chevron-left"}),"Prev"]})]})}),e.jsx("div",{className:"flex-shrink-0 lg:order-3",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-20 h-20 md:w-24 md:h-24 cursor-pointer rounded-lg overflow-hidden border-2 border-gray-200 hover:border-blue-400 transition-colors duration-200",onClick:O,children:e.jsx("img",{src:((K=c[(o+1)%c.length])==null?void 0:K.url)||b,className:"object-cover w-full h-full hover:scale-105 transition-transform duration-200",alt:"Next"})}),e.jsx("p",{className:"text-xs text-gray-500 mt-2 font-medium",children:"Next"}),e.jsxs($,{onClick:O,className:"mt-2 flex items-center gap-2 px-3 py-1 bg-gray-600 hover:bg-gray-700 text-xs",children:["Next",e.jsx("i",{className:"fas fa-chevron-right"})]})]})})]})]})]}):e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-300 p-8 text-center my-4",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-10 h-10 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),e.jsx("p",{className:"text-gray-500 text-lg mb-2",children:"No Previews Available"}),e.jsx("span",{className:"text-gray-400 text-sm",children:"Upload images in the site measurement"})]}),t&&v.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-300 p-6 mb-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900",children:["Available Designs - ",t]}),e.jsxs("span",{className:"text-sm text-gray-500 bg-gray-100 px-3 py-1 rounded-full",children:[v.length," images"]})]}),e.jsx("span",{className:"text-sm text-gray-500",children:"Select images for shortlisting"})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-8 gap-3",children:v.map(s=>e.jsxs("div",{className:`group relative border-2 rounded-lg overflow-hidden cursor-pointer transition-all duration-200 hover:shadow-lg ${r.find(l=>l._id===s._id)?"ring-4 ring-green-500 border-green-500":"border-gray-200 hover:border-blue-300"}`,onClick:()=>q(s),children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:(s==null?void 0:s.url)||b,alt:s==null?void 0:s.originalName,className:"w-50 h-50 object-cover transition-transform duration-200 group-hover:scale-105"}),r.find(l=>l._id===s._id)&&e.jsx("div",{className:"absolute top-2 left-2 w-6 h-6 bg-green-500 rounded-full flex items-center justify-center",children:e.jsx("i",{className:"fas fa-check text-white text-sm"})}),e.jsx("div",{className:"absolute inset-0 bg-opacity-0 group-hover:bg-opacity-20 transition-all duration-200 flex items-center justify-center"})]}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black to-transparent p-2",children:e.jsx("p",{className:"text-white text-xs truncate font-medium",children:s==null?void 0:s.originalName})})]},s._id))})]}),t&&v.length===0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-300 p-8 text-center my-4",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-10 h-10 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),e.jsxs("p",{className:"text-gray-500 text-lg mb-2",children:["No designs uploaded yet for ",e.jsx("strong",{children:t})]}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Upload some sample designs and start comparing"})]}),r.length>0&&j.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-300 p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Selected for Shortlisting"}),e.jsxs("span",{className:"text-sm text-green-600 bg-green-100 px-3 py-1 rounded-full font-medium",children:[r.length," selected"]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Select Category:"}),e.jsx("div",{className:"max-w-[250px]",children:e.jsxs(te,{value:h.categoryId||void 0,onValueChange:s=>{const l=j.find(a=>a.categoryId===s);l&&F(l)},children:[e.jsx(re,{className:"min-w-[200px] bg-white",children:e.jsx(ae,{placeholder:"Choose a category",selectedValue:h.categoryName})}),e.jsx(le,{children:j.map(s=>e.jsx(ie,{value:s.categoryId,children:s.categoryName},s.categoryId))})]})})]}),e.jsx("div",{className:"flex gap-4 overflow-x-auto pb-2 mb-4",children:r.map(s=>e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-24 h-24 md:w-32 md:h-32 rounded-lg border-2 border-gray-300 shadow-md cursor-pointer",children:e.jsx("img",{src:s.url||b,alt:s.originalName,className:"w-full h-full object-cover"})}),e.jsx("button",{onClick:()=>q(s),className:"absolute top-1 right-1 w-6 h-6 bg-red-500 hover:bg-red-600 rounded-full flex items-center justify-center cursor-pointer transition-colors duration-200",children:e.jsx("i",{className:"fas fa-times text-white text-xs"})})]},s._id))}),e.jsxs($,{className:"w-full sm:w-auto flex items-center justify-center gap-2 px-6 py-3 bg-green-600 hover:bg-green-700 text-white font-medium cursor-pointer disabled:opacity-50",onClick:()=>Y(h==null?void 0:h.categoryName,h==null?void 0:h.categoryId),disabled:!h||E.isPending,children:[E.isPending&&e.jsx("span",{className:"inline-block animate-spin w-5 h-5 border-t-transparent border-2 border-white rounded-full"}),e.jsx("i",{className:"fas fa-star"}),"Add to ",h.categoryName||"Category"]})]}),A.length>0&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900",children:["Shortlisted Designs for ",e.jsx("span",{className:"text-blue-600",children:t})]}),A.map(s=>{var l;return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-300 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-folder text-blue-500"}),(s==null?void 0:s.categoryName)||"Uncategorized"]}),e.jsxs("span",{className:"text-sm text-gray-500 bg-gray-100 px-3 py-1 rounded-full",children:[((l=s.designs)==null?void 0:l.length)||0," images"]})]}),s.designs&&s.designs.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-3 mb-4",children:s.designs.map(a=>e.jsxs("div",{className:"group relative border-2 border-gray-200 rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-all duration-200",children:[e.jsxs("div",{className:"aspect-square relative",children:[e.jsx("img",{src:a.url||b,alt:a.originalName,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-200"}),e.jsx("button",{onClick:m=>{m.stopPropagation(),X(a._id,s.categoryId)},className:"absolute top-2 right-2 p-2 bg-red-600 rounded-full text-white opacity-0 group-hover:opacity-100 hover:bg-red-700 transition-all duration-200 shadow-lg cursor-pointer",children:e.jsx("i",{className:"fas fa-trash text-xs"})}),e.jsxs("div",{className:"absolute top-2 left-2 bg-yellow-500 text-white px-2 py-1 rounded-full text-xs font-medium flex items-center gap-1",children:[e.jsx("i",{className:"fas fa-star text-xs"}),"Shortlisted"]})]}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black to-transparent p-2",children:e.jsx("p",{className:"text-white text-xs truncate font-medium",children:a.originalName})})]},a._id))}),e.jsx("div",{className:"border-t pt-4",children:e.jsxs("label",{className:"cursor-pointer inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200 text-sm font-medium",children:[R.isPending&&e.jsx("span",{className:"inline-block animate-spin w-4 h-4 border-t-transparent border-2 border-white rounded-full"}),e.jsx("i",{className:"fas fa-upload"}),"Upload to ",s.categoryName,e.jsx("input",{type:"file",multiple:!0,accept:"image/*",className:"hidden",onChange:a=>U(a,s.categoryName,s.categoryId)})]})})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center",children:e.jsx("i",{className:"fas fa-images text-2xl text-gray-400"})}),e.jsxs("p",{className:"text-gray-500 text-lg mb-2",children:["No designs in ",s.categoryName]}),e.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Upload some images to get started"}),e.jsxs("label",{className:"cursor-pointer inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200 text-sm font-medium",children:[R.isPending&&e.jsx("span",{className:"inline-block animate-spin w-4 h-4 border-t-transparent border-2 border-white rounded-full"}),e.jsx("i",{className:"fas fa-upload"}),"Upload to ",s.categoryName,e.jsx("input",{type:"file",multiple:!0,accept:"image/*",className:"hidden",onChange:a=>U(a,s.categoryName,s.categoryId)})]})]})]},s.categoryId)})]}),j.length===0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-300 p-8 text-center my-4",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center",children:e.jsx("i",{className:"fas fa-folder-open text-2xl text-gray-400"})}),e.jsx("p",{className:"text-gray-500 text-lg mb-2",children:"No Categories Available"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Categories will appear based on your site measurements"})]}),A.length===0&&j.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-300 p-8 text-center my-4",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center",children:e.jsx("i",{className:"fas fa-star text-2xl text-gray-400"})}),e.jsx("p",{className:"text-gray-500 text-lg mb-2",children:"No Shortlisted Images Available"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Start selecting images above to create your shortlist"})]})]})})};export{Ce as default};
