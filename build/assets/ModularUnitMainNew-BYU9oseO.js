import{e as J,j as e,C as ae,ai as re,f as le,B as y,d as ce,i as ne,c as ie,r as T,F as de,k as E,O as oe,ak as xe,A as W,t as U}from"./index-CBsAK0nv.js";import{S as me}from"./index-CCeqIA1C.js";import{u as ue,a as he}from"./modularUnitNewApi-BZHb7L1s.js";import{u as Y,c as ge}from"./selectedModularUnitNewApi-CgDDsRZv.js";const pe=({unit:t,onView:m,onDelete:g,onAddToCart:u,isDeleting:p=!1,isCartUpdating:A=!1,isProjectDetails:v=!1,cartQuantity:c=0,isAddingToCart:x=!1})=>{var F,I,P,k,b,S,j,N,L;const{role:w,permission:n}=J(),C=w==="owner"||((F=n==null?void 0:n.modularunit)==null?void 0:F.delete),f=w==="owner"||((I=n==null?void 0:n.modularunit)==null?void 0:I.create),M=w==="owner"||((P=n==null?void 0:n.modularunit)==null?void 0:P.edit),r=(i,h)=>{u&&u(i,t,h)},o=c>0;return e.jsxs(ae,{onClick:m,className:"overflow-hidden  cursor-pointer hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"relative h-40 bg-gray-100 cursor-pointer",onClick:m,children:[t.productImages&&t.productImages.length>0?e.jsx("img",{src:((k=t==null?void 0:t.productImages)==null?void 0:k.length)>0?(b=t==null?void 0:t.productImages[0])==null?void 0:b.url:re,alt:t.productName,className:"w-full h-full object-cover"}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:e.jsx("i",{className:"fas fa-image text-3xl"})}),t.category&&e.jsxs("div",{className:"absolute top-2 right-2 bg-white/90 backdrop-blur-sm px-2 py-1 rounded-md text-xs font-medium text-gray-700 shadow",children:[e.jsx("i",{className:"fas fa-tag mr-1 text-blue-600"}),t.category]}),v&&o&&e.jsxs("div",{className:"absolute top-2 left-2 bg-green-500 text-white px-2 py-1 rounded-md text-xs font-medium shadow",children:[e.jsx("i",{className:"fas fa-check-circle mr-1"}),"In Cart (",c,")"]})]}),e.jsxs(le,{className:"p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("h3",{className:"font-semibold text-base text-gray-800 line-clamp-1 cursor-pointer hover:text-blue-600 flex-1",onClick:m,title:t.productName,children:t.productName||"Untitled Product"}),t.fabricationCost&&e.jsxs("div",{className:"text-xs text-gray-600 bg-orange-50 px-2 py-1 rounded whitespace-nowrap",children:[e.jsx("i",{className:"fas fa-hammer text-orange-600 mr-1"}),"â‚¹",t.fabricationCost.toLocaleString()]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("i",{className:"fas fa-clock text-blue-500"}),e.jsxs("span",{className:"font-medium",children:[t.timeRequired||0," days"]})]}),t.totalAreaSqFt&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("i",{className:"fas fa-expand text-green-500"}),e.jsxs("span",{className:"font-medium",children:[t.totalAreaSqFt," sq ft"]})]})]}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-2",children:e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1 text-gray-600",children:[e.jsx("i",{className:"fas fa-ruler-combined text-purple-500 text-sm"}),e.jsx("span",{className:"font-medium",children:"Dimensions:"})]}),e.jsxs("div",{className:"flex items-center gap-2 font-semibold text-gray-700",children:[e.jsxs("span",{className:"flex items-center gap-0.5",children:[e.jsx("span",{className:"text-[10px] text-gray-500",children:"H:"}),((S=t.dimention)==null?void 0:S.height)||0]}),e.jsx("span",{className:"text-gray-400",children:"Ã—"}),e.jsxs("span",{className:"flex items-center gap-0.5",children:[e.jsx("span",{className:"text-[10px] text-gray-500",children:"W:"}),((j=t.dimention)==null?void 0:j.width)||0]}),e.jsx("span",{className:"text-gray-400",children:"Ã—"}),e.jsxs("span",{className:"flex items-center gap-0.5",children:[e.jsx("span",{className:"text-[10px] text-gray-500",children:"D:"}),((N=t.dimention)==null?void 0:N.depth)||0]}),e.jsx("span",{className:"text-[10px] text-gray-500",children:"mm"})]})]})}),e.jsx("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg p-2 flex items-center justify-center",children:e.jsxs("span",{className:"text-2xl font-bold text-green-700 flex items-center gap-1",children:[e.jsx("i",{className:"fas fa-indian-rupee-sign text-lg"}),((L=t.fabricationCost)==null?void 0:L.toLocaleString("en-IN"))||0]})}),t.attributes&&t.attributes.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1",children:[t.attributes.slice(0,3).map((i,h)=>e.jsx("span",{className:"px-2 py-0.5 bg-blue-50 text-blue-700 text-[10px] rounded-full font-medium",children:i},h)),t.attributes.length>3&&e.jsxs("span",{className:"px-2 py-0.5 bg-gray-100 text-gray-600 text-[10px] rounded-full font-medium",children:["+",t.attributes.length-3," more"]})]}),t.serialNo&&e.jsxs("p",{className:"text-[10px] text-gray-500 flex items-center gap-1 border-t pt-2",children:[e.jsx("i",{className:"fas fa-barcode"}),"SN: ",t.serialNo]}),v?e.jsxs("div",{className:"space-y-2 pt-1",children:[e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 rounded-lg p-2",children:[e.jsx("span",{className:"text-xs font-medium text-gray-700",children:"Quantity:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[(f||M)&&e.jsx(y,{variant:"outline",size:"sm",onClick:i=>r(i,c-1),disabled:c<=0||x,className:"h-7 w-7 p-0",children:e.jsx("i",{className:"fas fa-minus text-xs"})}),e.jsx("span",{className:"font-bold text-gray-900 min-w-[30px] text-center",children:A?e.jsx("i",{className:"fas fa-spinner animate-spin"}):c}),(f||M)&&e.jsx(y,{variant:"outline",size:"sm",onClick:i=>r(i,c+1),disabled:x,className:"h-7 w-7 p-0",children:e.jsx("i",{className:"fas fa-plus text-xs"})})]})]}),c>0&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-2 flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-medium text-blue-700",children:"Total:"}),e.jsxs("span",{className:"text-sm font-bold text-blue-700",children:["â‚¹",(t.fabricationCost*c||0).toLocaleString("en-IN")]})]}),e.jsx("div",{className:"flex gap-2"})]}):e.jsx("div",{className:"flex gap-2 pt-1",children:g&&C&&e.jsxs(y,{variant:"danger",size:"sm",isLoading:p,className:"flex-1 bg-red-600 hover:bg-red-700 text-white text-xs py-1.5",onClick:i=>{i.stopPropagation(),g()},disabled:p,children:[e.jsx("i",{className:"fas fa-trash mr-1"}),p?"Deleting...":"Delete"]})})]})]})},ye=()=>{var $,G,H;const t=ce(),m=ne(),{organizationId:g,projectId:u}=ie(),p=T.useRef(null),{isMobile:A,openMobileSidebar:v}=de(),{role:c,permission:x}=J(),w=c==="owner"||(($=x==null?void 0:x.modularunit)==null?void 0:$.list),n=c==="owner"||((G=x==null?void 0:x.modularunit)==null?void 0:G.create),{data:C}=Y(u),f=m.pathname.includes("projectdetails"),M=m.pathname.includes("/create")||m.pathname.includes("/single")||m.pathname.includes("/selectedunitsnew"),[r,o]=T.useState({search:"",category:"",minPrice:"0",maxPrice:"100000",sortBy:"createdAt",sortOrder:"desc"}),F=E(r.search,500),I=E(r.category,500),P=E(r.minPrice,800),k=E(r.maxPrice,800),{data:b,fetchNextPage:S,hasNextPage:j,isFetchingNextPage:N,isLoading:L,isError:i,error:h,refetch:K}=ue({organizationId:g,limit:20,category:I||void 0,minPrice:P?Number(P):void 0,maxPrice:k?Number(k):void 0,search:F||void 0,sortBy:r.sortBy,sortOrder:r.sortOrder}),q=he();T.useEffect(()=>{const s=p.current;if(!s)return;const a=()=>{const{scrollTop:d,scrollHeight:l,clientHeight:O}=s;l-d-O<100&&j&&!N&&(console.log("ðŸ“œ Loading more products..."),S())};return s.addEventListener("scroll",a),()=>s.removeEventListener("scroll",a)},[j,N,S]);const B=(b==null?void 0:b.pages.flatMap(s=>s.units))||[],_=Object.values(r).filter(s=>s!==""&&s!=="createdAt"&&s!=="desc"&&s!=="0"&&s!=="100000").length,V=()=>{o({search:"",category:"",minPrice:"0",maxPrice:"100000",sortBy:"createdAt",sortOrder:"desc"})},{mutateAsync:X,isPending:z,variables:Z}=ge(),{data:D}=Y(u),Q=async(s,a,d)=>{var l,O;s.stopPropagation();try{await X({projectId:u,quantity:d,singleUnitCost:a.price,product:a}),U({title:"Success",description:`${a.productName} updated to cart`})}catch(R){U({title:"Error",description:((O=(l=R==null?void 0:R.response)==null?void 0:l.data)==null?void 0:O.message)||"Failed to update cart",variant:"destructive"})}},ee=s=>{var d;const a=(d=D==null?void 0:D.selectedUnits)==null?void 0:d.find(l=>l.productId.toString()===s.toString());return(a==null?void 0:a.quantity)||0},se=async s=>{var a,d;try{await q.mutateAsync({unitId:s}),U({title:"Success",description:"Product deleted successfully"})}catch(l){U({title:"Error",description:((d=(a=l==null?void 0:l.response)==null?void 0:a.data)==null?void 0:d.message)||"Failed to delete product",variant:"destructive"})}},te=s=>{t(`single/${s}`)};return M?e.jsx(oe,{context:{isMobile:A,openMobileSidebar:v}}):e.jsxs("div",{className:"space-y-4 h-full p-2",children:[e.jsxs("header",{className:"flex justify-between items-center p-0 px-2",children:[e.jsxs("div",{children:[A&&e.jsx("button",{onClick:v,className:"mr-3 p-2 rounded-md border border-gray-300 hover:bg-gray-100",title:"Open Menu",children:e.jsx("i",{className:"fa-solid fa-bars"})}),e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-cubes mr-3 text-blue-600"}),"Modular Units"]})]}),f?e.jsx(xe,{to:`/${g}/projectdetails/${u}/modularunitsnew/selectedunitsnew`,children:e.jsxs("div",{className:"p-2 relative border-2 border-gray-300 rounded-lg",children:[e.jsx("div",{className:"w-6 justify-center items-center flex absolute top-[-12px] right-[-10px] h-6 rounded-full bg-gray-200 text-black",children:e.jsx("p",{className:"text-gray-600 font-medium",children:((H=C==null?void 0:C.selectedUnits)==null?void 0:H.length)??0})}),e.jsx("i",{className:"fas fa-shopping-cart text-xl text-blue-600 "})]})}):e.jsx(e.Fragment,{children:n&&e.jsxs(y,{onClick:()=>t("create"),children:[e.jsx("i",{className:"fas fa-plus mr-2"}),"Add Product"]})})]}),L?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("i",{className:"fas fa-spinner fa-spin text-blue-600 text-4xl"})}):i?e.jsxs("div",{className:"max-w-xl sm:min-w-[80%] mx-auto mt-4 p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2 text-xl sm:text-3xl",children:"âš ï¸ Error Occurred"}),e.jsx("p",{className:"text-red-500 mb-4 text-lg sm:text-xl",children:(h==null?void 0:h.message)||"Failed to load products"}),e.jsx(y,{onClick:()=>K(),className:"bg-red-600 text-white px-4 py-2",children:"Retry"})]}):e.jsxs("main",{className:"flex gap-2 !max-h-[90%]",children:[e.jsx("section",{className:"xl:w-80 flex-shrink-0 !max-h-[85vh] overflow-y-auto custom-scrollbar",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-filter mr-2 text-blue-600"}),"Filters"]}),_>0&&e.jsxs("button",{onClick:V,className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:["Clear All (",_,")"]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx("i",{className:"fas fa-search mr-2"}),"Search"]}),e.jsx("input",{type:"text",placeholder:"Name, serial no...",value:r.search,onChange:s=>o(a=>({...a,search:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),e.jsx("input",{type:"text",placeholder:"Wardrobe, Cabinet...",value:r.category,onChange:s=>o(a=>({...a,category:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Price Range"}),e.jsx("div",{className:"px-2 mb-3",children:e.jsx(me,{range:!0,min:0,max:1e5,step:500,value:[Number(r.minPrice),Number(r.maxPrice)],onChange:s=>{const[a,d]=s;o(l=>({...l,minPrice:String(a),maxPrice:String(d)}))},trackStyle:[{backgroundColor:"#3b82f6",height:6}],handleStyle:[{borderColor:"#3b82f6",backgroundColor:"#fff",boxShadow:"0 2px 6px rgba(59, 130, 246, 0.4)",width:18,height:18,marginTop:-6},{borderColor:"#3b82f6",backgroundColor:"#fff",boxShadow:"0 2px 6px rgba(59, 130, 246, 0.4)",width:18,height:18,marginTop:-6}],railStyle:{backgroundColor:"#e5e7eb",height:6}})}),e.jsxs("div",{className:"flex justify-between items-center gap-2 text-sm",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-xs text-gray-500 block mb-1",children:"Min"}),e.jsxs("div",{className:"bg-blue-50 px-3 py-2 rounded-lg font-semibold text-blue-700 text-center",children:["â‚¹",Number(r.minPrice).toLocaleString("en-IN")]})]}),e.jsx("div",{className:"text-gray-400 mt-5",children:"â€”"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-xs text-gray-500 block mb-1",children:"Max"}),e.jsxs("div",{className:"bg-blue-50 px-3 py-2 rounded-lg font-semibold text-blue-700 text-center",children:["â‚¹",Number(r.maxPrice).toLocaleString("en-IN")]})]})]}),e.jsxs("div",{className:"flex flex-col gap-3 items-center mt-2",children:[e.jsx(W,{type:"number",value:r.minPrice,onChange:s=>o(a=>({...a,minPrice:s.target.value})),placeholder:"Min Price",className:"w-full"}),e.jsx(W,{type:"number",value:r.maxPrice,onChange:s=>o(a=>({...a,maxPrice:s.target.value})),placeholder:"Max Price",className:"w-full"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sort By"}),e.jsxs("select",{value:r.sortBy,onChange:s=>o(a=>({...a,sortBy:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"createdAt",children:"Created Date"}),e.jsx("option",{value:"productName",children:"Product Name"}),e.jsx("option",{value:"price",children:"Price"}),e.jsx("option",{value:"timeRequired",children:"Time Required"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sort Order"}),e.jsxs("select",{value:r.sortOrder,onChange:s=>o(a=>({...a,sortOrder:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"desc",children:"Descending"}),e.jsx("option",{value:"asc",children:"Ascending"})]})]})]})]})}),w&&e.jsx(e.Fragment,{children:B.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[300px] w-full bg-white rounded-xl text-center p-6",children:[e.jsx("i",{className:"fas fa-box-open text-5xl text-blue-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-1",children:"No Products Found"}),e.jsxs("p",{className:"text-sm text-gray-500",children:[r.search||r.category||r.minPrice!=="0"||r.maxPrice!=="100000"?"Try adjusting your filters to find products.":"Looks like there are no products yet.",e.jsx("br",{}),f?e.jsxs(e.Fragment,{children:["click on ",e.jsx(y,{onClick:()=>t(`/organizations/${g}/modularunits`),children:"Add Product"})," to add products"]}):e.jsxs(e.Fragment,{children:["click on ",e.jsx("strong",{children:'"Add Product"'})," to get started ðŸš€ "]})]})]}):e.jsxs("div",{ref:p,className:"flex-1 max-h-[100%] overflow-y-auto",children:[e.jsx("div",{className:"grid gap-6 grid-cols-1 sm:grid-cols-2 xl:grid-cols-3",children:B.map(s=>e.jsx(pe,{unit:s,onView:()=>te(s._id),onDelete:()=>se(s._id),isDeleting:q.isPending,isCartUpdating:z&&Z.product._id===s._id,onAddToCart:Q,isProjectDetails:f,cartQuantity:ee(s._id),isAddingToCart:z},s._id))}),N&&e.jsx("div",{className:"flex justify-center py-8",children:e.jsxs("div",{className:"flex items-center gap-2 text-blue-600",children:[e.jsx("i",{className:"fas fa-spinner fa-spin text-2xl"}),e.jsx("span",{className:"text-sm font-medium",children:"Loading more products..."})]})}),!j&&B.length>0&&e.jsx("div",{className:"flex justify-center py-6",children:e.jsxs("p",{className:"text-gray-400 text-sm font-medium",children:[e.jsx("i",{className:"fas fa-check-circle mr-2"}),"You've reached the end of the list"]})})]})})]})]})};export{ye as default};
