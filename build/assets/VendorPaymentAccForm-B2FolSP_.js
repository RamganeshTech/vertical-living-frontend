import{c as te,r as p,d as re,j as e,B as f,t as A}from"./index-DyM6T-eT.js";import{u as ae}from"./vendorAccApi-BYqYKQFF.js";import{S as ne}from"./SearchSelectNew-BTs46di7.js";import{L as V}from"./Label-B3hr6461.js";import{u as le}from"./projectApi-CMY3yoCw.js";import{e as oe}from"./vendorPaymentApi-Cxy22GR8.js";import{I as de}from"./InfoToolTip-DZNysQ5i.js";const ce=[{label:"Cash",value:"cash"},{label:"Bank Transfer",value:"banktransfer"},{label:"Cheque",value:"cheque"},{label:"UPI",value:"upi"},{label:"Credit Card",value:"creditcard"},{label:"Others",value:"others"}],me=["Cash EOD","weekly salary","pay advance and balance after completion","credit pay as you go"],fe=({mode:v,initialData:a,onSubmit:G,isSubmitting:k,organizationId:w,refetch:C})=>{var R,U,W,$;const T=te(),[u,E]=p.useState(v),{data:N}=ae(w),{mutateAsync:z,isPending:H}=oe(),{role:O,permission:b}=re(),J=O==="owner"||((R=b==null?void 0:b.vendorpayment)==null?void 0:R.create),F=O==="owner"||((U=b==null?void 0:b.vendorpayment)==null?void 0:U.edit),l={organizationId:w,vendorId:"",projectId:null,paymentTerms:"",vendorName:"",vendorPaymentDate:new Date().toISOString().split("T")[0],paymentMode:"Cash",paidThrough:"",items:[{itemName:"",billAmount:0}],totalAmount:0,notes:""},{data:P}=le(w),x=P==null?void 0:P.map(s=>({_id:s._id,projectName:s.projectName})),[S,M]=p.useState(!1),[n,i]=p.useState(l),[_,K]=p.useState({totalAmount:0});p.useEffect(()=>{var s;i({...l,...a&&{vendorId:a.vendorId||l.vendorId,projectId:a.projectId||l.projectId,vendorName:a.vendorName||l.vendorName,vendorPaymentDate:a.vendorPaymentDate?new Date(a.vendorPaymentDate).toISOString().split("T")[0]:l.vendorPaymentDate,paymentMode:a.paymentMode||l.paymentMode,paidThrough:a.paidThrough||l.paidThrough,items:(s=a.items)!=null&&s.length?a.items.map(t=>({itemName:t!=null&&t.itemName?t.itemName:l.items[0].itemName,billAmount:t.billAmount??l.items[0].billAmount})):l.items,totalAmount:a.totalAmount??l.totalAmount,notes:a.notes||l.notes}}),v==="view"&&M(!0)},[a,v]),p.useEffect(()=>{const s=n.items.reduce((t,r)=>t+(r.billAmount||0),0);K({totalAmount:s})},[n.items]);const Q=(W=N||[])==null?void 0:W.map(s=>({value:s._id,label:s.vendorName,email:s.email})),y=s=>{const{name:t,value:r}=s.target;i(o=>({...o,[t]:r}))},X=()=>{i(s=>({...s,items:[...s.items,{itemName:"",billAmount:0}]}))},Y=s=>{i(t=>({...t,items:t.items.filter((r,o)=>o!==s)}))},B=(s,t,r)=>{i(o=>{const d=[...o.items],h={...d[s]};if(t==="billAmount"){let m=0;r===null||r===""?m=0:typeof r=="string"?m=parseFloat(r)||0:m=r,h[t]=m<0?0:m}else t==="itemName"&&(h.itemName=r);if(d[s]=h,s===d.length-1){const m=d[d.length-1];Object.values(m).some(j=>typeof j=="number"?j!==0:j&&j.trim()!=="")&&d.push({itemName:"",billAmount:0})}return{...o,items:d}})},Z=s=>{var r;const t=[];return s.vendorName.trim()||t.push("Vendor name is required"),s!=null&&s.items&&((r=s==null?void 0:s.items)==null?void 0:r.length)===0&&t.push("Atleast one item should be provided"),s.items.forEach((o,d)=>{(!o.itemName||o.itemName.trim()==="")&&t.push(`Item ${d+1}: itemName is required`),o.billAmount<0&&t.push(`Item ${d+1}: Bill amount cannot be negative`)}),t},D=s=>{const t=N==null?void 0:N.find(r=>r._id===s);i(r=>({...r,vendorId:s||"",vendorName:(t==null?void 0:t.vendorName)||""}))},L=async s=>{s.preventDefault();const t=n.items.filter(h=>{var m;return h.billAmount>0||((m=h.itemName)==null?void 0:m.trim())}),r={...n,items:t},o=Z(r);if(o.length>0){alert(o.join(`
`));return}const d={...r,organizationId:"",totalAmount:_.totalAmount};await G(d),u==="edit"&&E("view"),u==="create"&&i(l)},ee=async()=>{var s,t;try{if(a!=null&&a.isSyncWithPaymentsSection)return A({variant:"destructive",title:"Error",description:"already sent to payments section"});await z({id:a==null?void 0:a._id}),C==null||C(),A({title:"Success",description:"Bill sent to Payments Section"})}catch(r){A({variant:"destructive",title:"Error",description:((t=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:t.message)||(r==null?void 0:r.message)||"operation failed"})}},c=u==="view",g=u==="create",I=u==="edit",q=()=>E(s=>s==="view"?"edit":"view");return e.jsxs("div",{className:"max-w-full mx-auto space-y-2",children:[e.jsxs("header",{className:"sticky top-0 z-20 bg-white border-b border-gray-200 pb-4 pt-2 mb-6 flex justify-between items-center",children:[e.jsxs("div",{className:"flex justify-between items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>T(-1),className:"bg-blue-100 hover:bg-slate-300 flex items-center justify-between w-8 h-8 border border-[#a6aab8] text-sm cursor-pointer rounded-md px-2 ",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-credit-card mr-3 text-blue-600"}),g?"Create Vendor Payment Order":I?"Update Vendor Payment  Order":"View Vendor Payment Order"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:g?"Fill in the details to create a new order":I?"Update the Vendor Payment details":"Vendor Payment details"})]})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[c&&(F||J)&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(f,{variant:"primary",className:`${a!=null&&a.isSyncWithPaymentsSection?"!cursor-not-allowed":""}`,title:a!=null&&a.isSyncWithPaymentsSection?"already sent to payment":"",isLoading:H,disabled:a==null?void 0:a.isSyncWithPaymentsSection,onClick:ee,children:"Send To Payments Section"}),e.jsx(de,{content:"Click the button to send the vendor payment order to Payments section",type:"info",position:"bottom"})]}),u==="view"&&F&&e.jsx("div",{className:"flex justify-end",children:e.jsx(f,{onClick:q,className:"bg-blue-600 text-white px-6 py-2",children:"Edit"})})]}),(g||I)&&e.jsxs("div",{className:"flex justify-end items-center gap-4",children:[e.jsx(f,{type:"button",onClick:L,className:"bg-blue-600 text-white px-6 py-2",disabled:k,children:k?e.jsx("i",{className:"fas fa-spinner fa-spin"}):e.jsx(e.Fragment,{children:g?"Create":"Update"})}),e.jsx(f,{variant:"outline",type:"button",onClick:()=>{g?T(-1):q()},className:"bg-gray-500 hover:bg-gray-500 text-white px-6 py-2",children:"Cancel"})]})]}),e.jsxs("form",{onSubmit:L,className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx("i",{className:"fas fa-file-alt mr-2 text-blue-600"}),"Vendor Payment Details"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(V,{children:"Vendor"}),e.jsx(ne,{options:Q,placeholder:"Select Vendor",searchPlaceholder:"Search Vendor...",value:(n==null?void 0:n.vendorId)||void 0,onValueChange:s=>D(s),searchBy:"name",displayFormat:"simple",className:"w-full"})]}),e.jsxs("div",{className:"",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"checkbox",className:"cursor-pointer",checked:S,id:"enableName",onChange:()=>M(s=>!s)}),e.jsx(V,{htmlFor:"enableName",className:"cursor-pointer",children:"Click the check box to enter the name manually, if not available from the drop down"})]}),e.jsx("input",{type:"text",name:"vendorName",value:n.vendorName,onChange:s=>{S&&y(s)},disabled:c||!S,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",placeholder:"Enter Vendor name"})]}),e.jsxs("div",{children:[e.jsx(V,{children:"Project"}),e.jsxs("select",{value:(n==null?void 0:n.projectId)||"",disabled:c,onChange:s=>{const t=x==null?void 0:x.find(r=>r._id===s.target.value);i(t?r=>({...r,projectId:t._id,projectName:t.projectName}):r=>({...r,projectId:null,projectName:null}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white disabled:bg-gray-100 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:"Select Projects"}),x==null?void 0:x.map(s=>e.jsx("option",{value:s._id,children:s.projectName},s._id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date"}),e.jsx("input",{type:"date",name:"vendorPaymentDate",value:n.vendorPaymentDate,onChange:y,disabled:c,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Mode"}),e.jsxs("select",{name:"paymentMode",value:n.paymentMode,onChange:y,disabled:c,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:"Select Payment Mode"}),ce.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Terms"}),e.jsxs("select",{name:"paymentTerms",value:n.paymentTerms,onChange:y,disabled:c,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:"Select Payment Term"}),me.map(s=>e.jsx("option",{value:s,children:s},s))]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-list mr-2 text-blue-600"}),"Items ",e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),!c&&e.jsxs(f,{type:"button",onClick:X,variant:"primary",children:[e.jsx("i",{className:"fas fa-plus mr-2"}),"Add Item"]})]}),(($=n==null?void 0:n.items)==null?void 0:$.length)===0&&v==="view"?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("i",{className:"fas fa-inbox text-4xl mb-2"}),e.jsx("p",{children:"No items added yet. Start typing to add items."})]}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("div",{className:"grid grid-cols-10 gap-3 mb-2 px-4 py-3 bg-gray-100 rounded-lg font-semibold text-gray-700 text-sm",children:[e.jsx("div",{className:"col-span-1 text-center",children:"#"}),e.jsxs("div",{className:"col-span-3 text-center",children:["Item Name",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"col-span-3 text-center",children:"Bill Amount"}),e.jsx("div",{className:"col-span-3 text-center",children:"Action"})]}),e.jsx("div",{className:"space-y-2",children:n.items.map((s,t)=>e.jsxs("div",{className:"grid grid-cols-10 gap-3 px-4 py-3 bg-white border border-gray-200 rounded-lg hover:border-blue-300 transition-colors items-center",children:[e.jsx("div",{className:"col-span-1 text-center text-gray-600 font-medium",children:t+1}),e.jsx("div",{className:"col-span-3",children:e.jsx("input",{type:"itemName",value:s.itemName,onChange:r=>B(t,"itemName",r.target.value),disabled:c,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed text-sm",placeholder:"Enter item name"})}),e.jsx("div",{className:"col-span-3",children:e.jsx("input",{type:"number",value:s.billAmount,onChange:r=>B(t,"billAmount",r.target.value),disabled:c,min:"0",step:"1",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed text-sm",placeholder:"0"})}),e.jsx("div",{className:"col-span-3 text-center",children:!c&&e.jsx("button",{type:"button",onClick:()=>Y(t),disabled:n.items.length===1,className:"text-red-600 cursor-pointer hover:text-red-800 disabled:text-gray-400 disabled:cursor-not-allowed p-2 rounded-full hover:bg-red-50 transition-colors",title:n.items.length===1?"Cannot delete last item":"Delete item",children:e.jsx("i",{className:"fas fa-trash"})})})]},t))}),e.jsx("section",{className:"px-8 py-3 bg-blue-50 rounded-lg mt-4 font-semibold text-gray-800",children:e.jsxs("div",{className:"text-right",children:["Total:",e.jsxs("span",{className:"ml-3 text-right text-blue-600 text-lg",children:["â‚¹",_.totalAmount.toFixed(2)]})]})})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx("i",{className:"fas fa-comment-alt mr-2 text-blue-600"}),"Additional Information"]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("textarea",{name:"notes",value:n.notes,onChange:y,disabled:c,rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed resize-none",placeholder:"Add any notes for the Vendor..."})]})})]})]})]})};export{fe as V};
