import{j as e,r as w,u as L,e as S,a as M,O as E}from"./index-DbiIFs0V.js";import{u as F,a as z,b as $}from"./workLibraryApi-DUkc2P3b.js";import{B as u}from"./Button-CYhE1wjW.js";import{t as T}from"./toast-BSC5QTk1.js";import W from"./MaterialOverviewLoading-BI6MuFHQ.js";import{C as O,a as _,b as P,c as B}from"./Card-CFYiezEn.js";import{L as y}from"./Label-DTqELkF7.js";import{I as v}from"./Input-BKHgys6e.js";import{D as G,a as H,b as R,c as V,d as q}from"./Dialog-BUEwqJgq.js";import{T as J}from"./TextArea-DYzf_-Bc.js";import"./useQuery-BZZcyQnK.js";import"./useMutation-YUV1wh1S.js";import"./roleCheck-Daj0VMmM.js";import"./Skeleton-CKd90k2j.js";const K=({work:r,role:p,onDelete:g,deletePending:n,navigate:o})=>{var m,h,d;return e.jsxs(O,{className:"p-0 border-l-4 border-blue-600",children:[e.jsx(_,{children:e.jsx(P,{children:(r==null?void 0:r.workName)||"No title"})}),e.jsxs(B,{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm",children:[e.jsx("i",{className:"fa-solid fa-file-lines mr-2 text-blue-600"}),"Description: ",r!=null&&r.description?((m=r==null?void 0:r.description)==null?void 0:m.length)>100?`${(h=r==null?void 0:r.description)==null?void 0:h.slice(0,100)}...`:r==null?void 0:r.description:"N/A"]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("i",{className:"fa-solid fa-list-check mr-2 text-purple-600"})," ","Total Tasks: ",((d=r.tasks)==null?void 0:d.length)||0]}),e.jsxs("div",{className:"flex gap-2 mt-3 justify-end",children:[e.jsxs(u,{size:"sm",onClick:()=>o(`single/${r._id}`),children:[e.jsx("i",{className:"fa-solid fa-eye mr-1"}),"View"]}),p!=="staff"&&e.jsxs(u,{size:"sm",onClick:()=>g(r._id),isLoading:n,className:"bg-red-600 hover:bg-red-700 text-white",children:[e.jsx("i",{className:"fa-solid fa-trash mr-1"}),"Delete"]})]})]})]},r._id)},Q=({dialogOpen:r,setDialogOpen:p,organizationId:g})=>{const[n,o]=w.useState({workName:"",description:"",tags:[],tasks:[{title:"",description:"",estimatedTimeInMinutes:0,subtasks:[{title:""}]}]}),m=F(),h=(a,s=!1)=>{const t=[...a],l=c=>((c==null?void 0:c.title)||"").trim()==="";if(t.length===0)return t;for(;t.length>1&&l(t[t.length-1])&&l(t[t.length-2]);)t.pop();return(s||!l(t[t.length-1])&&!s)&&t.push({title:"",estimatedTimeInMinutes:0,subtasks:[]}),!t.some(c=>!l(c))&&t.length>1?[t[0]]:t},d=a=>{const s=Array.isArray(a)?[...a]:[],t=i=>((i==null?void 0:i.title)??"").trim()==="";if(s.length===0)return s;for(;s.length>1&&t(s[s.length-1])&&t(s[s.length-2]);)s.pop();return t(s[s.length-1])||s.push({title:""}),!s.some(i=>!t(i))&&s.length>1?[s[0]]:s},j=(a,s,t)=>{const l=[...n.tasks],i={...l[a]};i[s]=t,l[a]=i;const c=h(l);o(x=>({...x,tasks:c}))},C=()=>{const a={title:"",estimatedTimeInMinutes:0,subtasks:[]},s=[...n.tasks,a];o(t=>({...t,tasks:h(s,!0)}))},D=a=>{o(s=>{const t=s.tasks.filter((l,i)=>i!==a);return{...s,tasks:t}})},b=(a,s,t,l)=>{const i=[...n.tasks],c={...i[a]},x=Array.isArray(c.subtasks)?[...c.subtasks]:[];x[s]||(x[s]={title:""}),x[s][t]=l,c.subtasks=d(x),i[a]=c,o(A=>({...A,tasks:i}))},N=a=>{const s=[...n.tasks],t={...s[a]},l=Array.isArray(t.subtasks)?[...t.subtasks]:[];l.push({title:""}),t.subtasks=d(l),s[a]=t,o(i=>({...i,tasks:s}))},f=(a,s)=>{o(t=>{const l=[...t.tasks],i={...l[a]};return Array.isArray(i.subtasks)&&(i.subtasks=i.subtasks.filter((c,x)=>x!==s)),l[a]=i,{...t,tasks:l}})},k=async()=>{var a,s;try{const t=n.tasks.filter(i=>i.title.trim()!=="").map(i=>({title:i.title.trim(),estimatedTimeInMinutes:Number(i.estimatedTimeInMinutes)||0,subtasks:(i.subtasks||[]).filter(c=>c.title.trim()!=="").map(c=>({title:c.title.trim()}))})),l={workName:n.workName.trim(),description:n.description||"",tags:n.tags||[],organizationId:g,tasks:t};await m.mutateAsync({formData:l}),p(!1),o({workName:"",description:"",tags:[],tasks:[]}),T({description:"Work Flow created successfully",title:"Success"})}catch(t){T({title:"Error",description:((s=(a=t==null?void 0:t.response)==null?void 0:a.data)==null?void 0:s.message)||"Failed to create the work flow",variant:"destructive"})}};return e.jsxs("div",{className:"flex items-center justify-between mb-5",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Work Libraries"}),e.jsx(G,{open:r,onOpenChange:p,children:e.jsxs(H,{className:"w-[95vw] max-w-3xl p-0",children:[e.jsx(R,{className:"px-6 pt-6 pb-2",children:e.jsx(V,{className:"text-lg font-semibold",children:"Add New Work Library"})}),e.jsxs("div",{className:"px-6 pb-6 space-y-5 max-h-[70vh] overflow-auto",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(y,{className:"mb-1 block",children:"Work Name"}),e.jsx(v,{name:"workName",value:n.workName,onChange:a=>o({...n,workName:a.target.value}),placeholder:"Enter the Work Name","aria-label":"Work Name"})]}),e.jsxs("div",{children:[e.jsx(y,{className:"mb-1 block",children:"Description"}),e.jsx(J,{name:"description",value:(n==null?void 0:n.description)||"",onChange:a=>o({...n,description:a.target.value}),placeholder:"Brief description","aria-label":"Description"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-md font-semibold",children:"Tasks"}),e.jsxs(u,{size:"sm",onClick:C,className:"flex items-center gap-1",children:[e.jsx("i",{className:"fa-solid fa-plus","aria-hidden":"true"}),e.jsx("span",{className:"sr-only",children:"Add Task"}),e.jsx("span",{"aria-hidden":"true",children:"Add Task"})]})]}),e.jsx("div",{className:"space-y-4",children:n.tasks.map((a,s)=>{var t;return e.jsxs("div",{className:"p-4 bg-gray-100 rounded-lg space-y-3 relative",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(y,{className:"mb-1 block",children:"Task Title"}),e.jsx(v,{value:a.title,onChange:l=>j(s,"title",l.target.value),placeholder:"e.g. Plywood ,installation","aria-label":`Task ${s+1} Title`})]}),e.jsxs("div",{children:[e.jsx(y,{className:"mb-1 block",children:"Estimated (min)"}),e.jsx(v,{type:"number",value:a.estimatedTimeInMinutes,onChange:l=>j(s,"estimatedTimeInMinutes",l.target.value),placeholder:"0",inputMode:"numeric","aria-label":`Task ${s+1} Estimated Time in Minutes`})]}),e.jsx("div",{className:"flex items-end justify-end",children:e.jsxs(u,{size:"sm",className:"bg-red-600 text-white hover:bg-red-700 flex items-center gap-1",onClick:()=>D(s),children:[e.jsx("i",{className:"fa-solid fa-trash","aria-hidden":"true"}),e.jsx("span",{className:"sr-only",children:"Delete Task"}),e.jsx("span",{"aria-hidden":"true",children:"Delete"})]})})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx("h4",{className:"text-sm font-semibold",children:"Subtasks"}),a.subtasks.length===0&&e.jsxs(u,{size:"sm",onClick:()=>N(s),className:"flex items-center gap-1",children:[e.jsx("i",{className:"fa-solid fa-circle-plus","aria-hidden":"true"}),e.jsx("span",{className:"sr-only",children:"Add Subtask"}),e.jsx("span",{"aria-hidden":"true",children:"Add Subtask"})]})]}),e.jsx("div",{className:"space-y-3",children:(t=a==null?void 0:a.subtasks)==null?void 0:t.map((l,i)=>e.jsxs("div",{className:"flex  gap-3 bg-white p-3 rounded relative",children:[e.jsx("div",{className:"w-full",children:e.jsx(v,{value:l.title,onChange:c=>b(s,i,"title",c.target.value),placeholder:"Subtask title","aria-label":`Task ${s+1} Subtask ${i+1} Title`})}),e.jsx(u,{variant:"danger",type:"button",className:" text-white bg-red-600",onClick:()=>f(s,i),"aria-label":`Delete subtask ${i+1} from task ${s+1}`,title:"Delete Subtask",children:e.jsx("i",{className:"fa-solid fa-trash","aria-hidden":"true"})})]},i))})]},s)})})]}),e.jsx(q,{className:"px-6 pb-6",children:e.jsxs(u,{onClick:k,className:"flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-floppy-disk","aria-hidden":"true"}),e.jsx("span",{children:"Create Work"})]})})]})})]})},U=w.memo(Q),de=()=>{var b,N;const{organizationId:r}=L(),{role:p}=S(),g=M(),[n,o]=w.useState(!1),{data:m=[],isLoading:h,error:d}=z(r),j=$(),C=async f=>{var k,a;try{await j.mutateAsync({workId:f,organizationId:r}),T({description:"Work Flow deleted successfully",title:"Success"})}catch(s){T({title:"Error",description:((a=(k=s==null?void 0:s.response)==null?void 0:k.data)==null?void 0:a.message)||"Failed to delete the work flow",variant:"destructive"})}};return location.pathname.includes("single")?e.jsx(E,{}):h?e.jsx(W,{}):e.jsxs("div",{className:"p-2 max-h-full overflow-y-auto",children:[e.jsxs("header",{className:"flex justify-between items-center w-full pb-2 border-b border-gray-300",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-code-fork mr-3 text-blue-600"}),"Work Library SOP"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your work flows"})]}),e.jsxs(u,{onClick:()=>o(!0),className:"bg-blue-600 flex items-center ",children:[e.jsx("i",{className:"fas fa-plus mr-1 text-white"}),"Add Work"]})]}),d&&e.jsxs("div",{className:"flex flex-col items-center  justify-center min-h-[300px] w-full bg-white rounded-xl text-center p-6",children:[e.jsx("i",{className:"fas fa-note text-5xl text-blue-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-1",children:"No WorkFlows Found"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Looks like there are no work flow created yet.",e.jsx("br",{}),"you can click ",e.jsx("strong",{children:" add work "})," to get started ðŸš€"]}),e.jsx("p",{className:"text-sm text-gray-500",children:((N=(b=d==null?void 0:d.response)==null?void 0:b.data)==null?void 0:N.message)||(d==null?void 0:d.message)||"something went wrong"})]}),n&&e.jsx(U,{organizationId:r,dialogOpen:n,setDialogOpen:o}),h?e.jsx("p",{children:e.jsx(W,{})}):!d&&(m==null?void 0:m.length)===0?e.jsxs("div",{className:"flex flex-col items-center  justify-center min-h-[300px] w-full bg-white rounded-xl text-center p-6",children:[e.jsx("i",{className:"fas fa-note text-5xl text-blue-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-1",children:"No WorkFlows Found"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Looks like there are no work flow created yet.",e.jsx("br",{}),"you can click ",e.jsx("strong",{children:" add work "})," to get started ðŸš€"]})]}):e.jsx("div",{className:"mt-4 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4  gap-4",children:m.map(f=>e.jsx(K,{navigate:g,role:p,work:f,onDelete:C,deletePending:j.isPending},f._id))})]})};export{de as default};
