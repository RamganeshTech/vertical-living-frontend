import{u as R,j as e,r as g,a as V}from"./index-By5P0A7l.js";import{u as U}from"./useQueries-DlmQXfej.js";import{u as $}from"./useMutation-7YLqc7VE.js";import{g as P}from"./roleCheck-YGaMnK_P.js";import{g as K}from"./quoteVariantApi-BgUf8GwQ.js";import{B as D}from"./Button-DLUK8O0t.js";import{L as z}from"./Label-TAdUzpu-.js";import{S as v}from"./SearchSelect-C9Z_8DQE.js";import{u as J}from"./rateConfigApi-kBOyXYUF.js";import"./useQuery-Cc7pLKfK.js";const X=async({file:r,api:p,organizationId:m})=>{const u=new FormData;u.append("file",r);const{data:i}=await p.post(`/cad/extract/${m}`,u);return i},Y=()=>{const r=["owner","staff","CTO","client"],{role:p}=R(),m=P(p);return $({mutationFn:async({file:u,organizationId:i})=>{if(!p||!r.includes(p))throw new Error("not allowed to make this api call");if(!m)throw new Error("API instance not found for role");return await X({file:u,api:m,organizationId:i})},onSuccess:u=>{console.log("Extracted Data:",u.data)},onError:u=>{console.error("Failed to extract CAD:",u.message)}})},Z=(r,p)=>{const m=["owner","staff","CTO"],{role:u}=R(),i=P(u);return U({queries:p.map(x=>({queryKey:["quote-brand-multi",r,x],queryFn:()=>{if(!u||!m.includes(u))throw new Error("Not allowed");if(!i)throw new Error("API instance not found");return K({api:i,organizationId:r,categoryName:x})},enabled:!!r&&!!x&&!!i&&!!u}))})},I="RELIANCE MAPPEDU MULTI MODAL LOGISTICS PARK LIMITED (RMMMLPL) - CANTEEN & ADMIN GROUND FURNITURE FLOOR PLAN",ee=[{work_type:"Carpentry/Furniture Work",rooms:[{room_name:"Office Seating Area",items:[{s_no:"MT-1",description:"Modular Table Type 1",location:"Office Seating Area",quantity:25,uom:"NOS",price:null,total_price:null,metadata:{l:"1200",b:"600"}},{s_no:"MT-2",description:"Modular Table Type 2",location:"Office Seating Area",quantity:4,uom:"NOS",price:null,total_price:null,metadata:{l:"1500",b:"1500",h:"600"}},{s_no:"MT-3",description:"Modular Table Type 3",location:"Office Seating Area",quantity:3,uom:"NOS",price:null,total_price:null,metadata:{l:"1800",b:"1800",h:"600"}},{s_no:"CH-1",description:"Executive Chair Mid Back",location:"Office Seating Area",quantity:43,uom:"NOS",price:null,total_price:null,metadata:{l:"450",b:"450"}},{s_no:"PD-1",description:"Pedestals Below Table",location:"Office Seating Area & Cabins",quantity:31,uom:"NOS",price:null,total_price:null,metadata:{l:"450",b:"450"}}]},{room_name:"VP & Director Cabins",items:[{s_no:"MT-4",description:"Modular Table Type 4",location:"VP, Directors Cabin",quantity:3,uom:"NOS",price:null,total_price:null,metadata:{l:"2100",b:"2100",h:"600"}},{s_no:"CH-4",description:"Senior Executive Chair with High Back",location:"VP & Director Cabin",quantity:3,uom:"NOS",price:null,total_price:null,metadata:null},{s_no:"SF-2",description:"2 Seater Sofa",location:"VP & Director Cabin",quantity:4,uom:"NOS",price:null,total_price:null,metadata:null},{s_no:"ST-1",description:"Side Table Type 1",location:"VP & Director Cabin",quantity:4,uom:"NOS",price:null,total_price:null,metadata:null},{s_no:"RC-3",description:"VP/Director Cabin Credenza",location:"VP & Director Cabin",quantity:3,uom:"NOS",price:null,total_price:null,metadata:{l:"1500",b:"450"}}]},{room_name:"Conference & Meeting Rooms",items:[{s_no:"CT-1",description:"Conference Table Type 1",location:"Conference Room",quantity:1,uom:"NOS",price:null,total_price:null,metadata:{l:"3000",b:"1200"}},{s_no:"CT-2",description:"Conference Table Type 2",location:"Meeting Room 1 & 2",quantity:2,uom:"NOS",price:null,total_price:null,metadata:{l:"1500",b:"900"}},{s_no:"CH-2",description:"Conference Chair with High Back",location:"Conference Room",quantity:10,uom:"NOS",price:null,total_price:null,metadata:null},{s_no:"CH-3",description:"Senior Executive Chair with High Back",location:"Meeting Room 1 & 2",quantity:8,uom:"NOS",price:null,total_price:null,metadata:null},{s_no:"RC-2",description:"Conference Room Credenza",location:"Conference Room",quantity:1,uom:"NOS",price:null,total_price:null,metadata:{l:"2000",b:"450"}}]},{room_name:"Reception & Waiting Area",items:[{s_no:"SF-1",description:"3 Seater Sofa",location:"Reception Area",quantity:1,uom:"NOS",price:null,total_price:null,metadata:null},{s_no:"PT-1",description:"3 Seater Sofa (Waiting)",location:"Reception Area",quantity:2,uom:"NOS",price:null,total_price:null,metadata:null},{s_no:"RC-1",description:"Reception Credenza",location:"Reception Area",quantity:1,uom:"NOS",price:null,total_price:null,metadata:{l:"4400",b:"450"}},{s_no:"FP-1",description:"FRP Planter",location:"Cubicals, Waiting Area",quantity:10,uom:"NOS",price:null,total_price:null,metadata:{l:"380",b:"400"}}]},{room_name:"Cafeteria",items:[{s_no:"DT-1",description:"Dining Table",location:"Cafeteria Seating",quantity:8,uom:"NOS",price:null,total_price:null,metadata:null},{s_no:"DC-1",description:"Dining Chair",location:"Cafeteria Seating",quantity:32,uom:"NOS",price:null,total_price:null,metadata:null}]},{room_name:"Creche",items:[{s_no:"BT-1",description:"Bunk Bed",location:"Creche",quantity:3,uom:"NOS",price:null,total_price:null,metadata:null}]},{room_name:"OHC",items:[{s_no:"BT-2",description:"Bunk Bed",location:"OHC",quantity:2,uom:"NOS",price:null,total_price:null,metadata:null},{s_no:"MT-1",description:"Modular Table Type 1",location:"OHC",quantity:1,uom:"NOS",price:null,total_price:null,metadata:{l:"1200",b:"600"}},{s_no:"CH-1",description:"Executive Chair Mid Back",location:"OHC",quantity:1,uom:"NOS",price:null,total_price:null,metadata:{l:"450",b:"450"}},{s_no:"PD-2",description:"Pedestals Below Table",location:"OHC",quantity:1,uom:"NOS",price:null,total_price:null,metadata:{l:"450",b:"450"}}]}]},{work_type:"Glass Work",rooms:[{room_name:"General Building",items:[{s_no:"TP-1",description:"Glass Partition",location:"Various",quantity:1,uom:"SQFT",price:null,total_price:null,metadata:null},{s_no:"GD1",description:"Single Leaf Glass Door",location:"Various",quantity:5,uom:"NOS",price:null,total_price:null,metadata:{l:"1000",h:"2100"}},{s_no:"GD2",description:"Double Leaf Glass Door",location:"Various",quantity:1,uom:"NOS",price:null,total_price:null,metadata:{l:"1800",h:"2100"}},{s_no:"GD3",description:"Single Leaf Glass Door",location:"Various",quantity:1,uom:"NOS",price:null,total_price:null,metadata:{l:"1000",h:"2100"}},{s_no:"GD4",description:"Double Leaf Glass Door",location:"Various",quantity:1,uom:"NOS",price:null,total_price:null,metadata:{l:"1800",h:"2100"}},{s_no:"GD5",description:"Single Leaf Glass Door",location:"Various",quantity:1,uom:"NOS",price:null,total_price:null,metadata:{l:"1000",h:"2100"}}]}]},{work_type:"Civil/Plumbing Work",rooms:[{room_name:"General Building",items:[{s_no:"W-100",description:"100mm THK AAC Wall",location:"Internal Partitions",quantity:1,uom:"SQFT",price:null,total_price:null,metadata:{thk:"100"}},{s_no:"W-200",description:"200mm THK AAC Wall",location:"External/Main Walls",quantity:1,uom:"SQFT",price:null,total_price:null,metadata:{thk:"200"}},{s_no:"LW-150",description:"150mm THK Ledge Wall",location:"Toilets/Service Areas",quantity:1,uom:"SQFT",price:null,total_price:null,metadata:{thk:"150"}},{s_no:"OT-1",description:"Carpet Flooring",location:"Meeting/Conference Room",quantity:21,uom:"SQM",price:null,total_price:null,metadata:null},{s_no:"RBM",description:"Rubber Matting",location:"Creche",quantity:14.44,uom:"SQM",price:null,total_price:null,metadata:null},{s_no:"WLP",description:"Wall Paper",location:"Creche",quantity:52.8,uom:"SQM",price:null,total_price:null,metadata:null},{s_no:"ACW",description:"Acoustical Wall Panel",location:"Meeting/Conference Room",quantity:33,uom:"SQM",price:null,total_price:null,metadata:null}]}]},{work_type:"False Ceiling Work",rooms:[{room_name:"General Building",items:[{s_no:"MFC",description:"Mineral Fiber Ceiling",location:"Office/Admin Areas",quantity:1,uom:"SQFT",price:null,total_price:null,metadata:null},{s_no:"GBC",description:"Gypsum Board Ceiling",location:"Cabins/Reception",quantity:1,uom:"SQFT",price:null,total_price:null,metadata:null}]}]}],te=["Quantities for walls and ceilings are not explicitly totaled in the legend and require area calculation from plan dimensions.","TP-1 Glass Partition quantity is represented as a symbol; total length/area must be measured from drawing."],k={project_name:I,works:ee,extraction_warnings:te},ae=({step:r,handleStep:p,localExtractionData:m})=>e.jsx("div",{children:e.jsxs("header",{className:"w-full flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center tracking-tight",children:[e.jsx("i",{className:"fas fa-wand-magic-sparkles mr-3 text-blue-600"}),"Project ",e.jsx("span",{className:"ml-2 text-blue-600",children:"Estimator"})]}),e.jsxs("nav",{className:"mt-2 flex items-center gap-3 text-[10px] font-black uppercase tracking-[0.15em] text-gray-400",children:[e.jsxs("span",{onClick:()=>p(1),className:`flex items-center gap-1.5 cursor-pointer hover:opacity-80 transition-all ${r===1?"text-blue-600":"text-emerald-500"}`,children:[e.jsx("i",{className:`fa-solid ${r>1?"fa-circle-check":"fa-circle-1"}`}),e.jsx("span",{children:"Upload PDF"})]}),e.jsx("i",{className:"fa-solid fa-chevron-right text-gray-300 text-[8px]"}),e.jsxs("span",{onClick:()=>{m&&p(2)},className:`flex items-center gap-1.5 transition-all ${m?"cursor-pointer hover:text-blue-500":"cursor-not-allowed opacity-50"} ${r===2?"text-blue-600":"text-gray-300"}`,children:[e.jsx("i",{className:"fa-solid fa-circle-2"}),e.jsx("span",{children:"Calculation Engine"})]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[r===2&&e.jsxs("button",{onClick:()=>p(1),className:"text-gray-500 hover:text-blue-600 text-xs font-bold transition-all flex items-center gap-2 px-2",children:[e.jsx("i",{className:"fa-solid fa-arrow-rotate-left"}),e.jsx("span",{children:"Change Source"})]}),r===1&&m&&e.jsxs("button",{onClick:()=>p(2),className:"bg-blue-600 hover:bg-blue-700 text-white px-5 py-2 rounded-lg text-xs font-bold shadow-lg shadow-blue-100 transition-all flex items-center gap-2",children:[e.jsx("span",{children:"Continue to Results"}),e.jsx("i",{className:"fa-solid fa-arrow-right"})]})]})]})}),xe=()=>{const[r,p]=g.useState(null),[m,u]=g.useState(1),[i,x]=g.useState(k),{organizationId:M}=V();let{mutate:F,data:A,isPending:B,isSuccess:L}=Y();g.useEffect(()=>{x(k),u(2)},[L,A,!0]);const{data:C}=J(M),T=g.useMemo(()=>(C==null?void 0:C.map(s=>s.name))||[],[C]),O=g.useMemo(()=>{if(!(i!=null&&i.works))return[];const s=new Set;return i.works.forEach(n=>{n.selectedMaterial&&s.add(n.selectedMaterial),n.rooms.forEach(o=>{o.selectedMaterial&&s.add(o.selectedMaterial),o.items.forEach(a=>{a.materialCategory&&s.add(a.materialCategory)})})}),Array.from(s)},[i]),q=Z(M,O),_=g.useMemo(()=>{const s={};return O.forEach((n,o)=>{var l;const a=((l=q[o])==null?void 0:l.data)||[],t={};a.forEach(c=>{var j;const f=(c==null?void 0:c.data)||{},b=(j=f.Brand??f.brand)==null?void 0:j.trim(),y=f["thickness (mm)"]||f.thickness||"",S=parseFloat(f.Rs??f.rs??0);if(b){const w=y?`${b} (${y}mm)`:b;t[w]={rate:S,originalName:b,thickness:y}}}),s[n]=t}),s},[q,O]),E=(s,n,o,a)=>{const t={...i};t.works[s].selectedMaterial=n,t.works[s].selectedBrand=o,t.works[s].rooms.forEach(l=>{l.selectedMaterial=n,l.selectedBrand=o,l.roomRate=a,l.items.forEach(c=>{c.price=a,c.materialCategory=n,c.brand=o})}),x(t)},G=(s,n,o,a,t)=>{const l={...i},c=l.works[s].rooms[n];c.selectedMaterial=o,c.selectedBrand=a,c.roomRate=t,c.items.forEach(f=>{f.price=t,f.materialCategory=o,f.brand=a}),x(l)},W=s=>{s.target.files&&s.target.files[0]&&p(s.target.files[0])},H=()=>{r&&F({file:r,organizationId:M})},N=(s,n,o,a,t)=>{const l={...i};l.works[s].rooms[n].items[o][a]=t,x(l)},Q=s=>{u(s)};return e.jsx("div",{className:"min-h-full max-h-full overflow-y-auto  !bg-white pb-20 font-sans text-slate-900",children:e.jsxs("div",{className:"mx-auto max-w-full p-2",children:[e.jsx(ae,{step:m,localExtractionData:i,handleStep:Q}),m===1&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"mb-10 overflow-hidden rounded-2xl bg-white shadow-xl shadow-blue-100/40 border border-gray-100",children:e.jsxs("div",{className:"p-8",children:[e.jsx(z,{className:"mb-4 block text-lg font-bold",children:"CAD Layout Upload"}),e.jsxs("div",{className:`relative rounded-xl border-2 border-dashed transition-all duration-300 p-12 text-center 
              ${r?"border-blue-400 bg-blue-50/20":"border-gray-200 hover:border-blue-500 hover:bg-gray-50"}`,children:[e.jsx("input",{type:"file",accept:".pdf",className:"absolute inset-0 z-10 w-full h-full cursor-pointer opacity-0",onChange:W}),e.jsx("div",{className:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-blue-50 text-blue-600",children:e.jsx("i",{className:"fa-solid fa-cloud-arrow-up text-2xl"})}),e.jsx("p",{className:"text-lg font-semibold text-gray-800",children:r?r.name:"Drop your CAD PDF here"}),e.jsx("p",{className:"mt-1 text-sm text-gray-400 font-medium",children:"Supported: High-resolution Layout PDFs (Max 50MB)"})]}),e.jsxs("div",{className:"mt-8 flex justify-end gap-4",children:[r&&e.jsx(D,{variant:"ghost",onClick:()=>p(null),children:"Clear"}),e.jsxs(D,{variant:"primary",size:"lg",onClick:H,isLoading:B,disabled:!r,className:"min-w-[200px]",children:[e.jsx("i",{className:"fa-solid fa-wand-magic-sparkles mr-2"})," Run Extraction"]})]})]})})}),m===2&&i&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4",children:i.works.map((s,n)=>e.jsxs("div",{className:"bg-white rounded-3xl border border-slate-200 shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"bg-blue-600 px-8 py-3 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("i",{className:"fa-solid fa-hard-hat text-white text-sm"}),e.jsx("input",{value:s.work_type,onChange:o=>{const a={...i};a.works[n].work_type=o.target.value,x(a)},className:"bg-transparent text-white font-bold uppercase tracking-widest text-sm outline-none border-b border-white/30 w-2/3"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] text-white font-bold uppercase mr-2",children:"Master Category:"}),e.jsx("div",{className:"w-50",children:e.jsx(v,{options:T,placeholder:"Material",selectedValue:s.selectedMaterial||"",onSelect:o=>{const a={...i};a.works[n].selectedMaterial=o,x(a)}})}),e.jsx("div",{className:"w-50",children:e.jsx(v,{options:Object.keys(_[s.selectedMaterial]||{}),placeholder:"Brand",selectedValue:s.selectedBrand||"",onSelect:o=>{if(!o)return;const t=(_[s.selectedMaterial]||[]).find(c=>c.name===o),l=(t==null?void 0:t.rate)||0;E(n,s.selectedMaterial,o,l)}})})]})]}),e.jsx("div",{className:"p-4 space-y-12",children:s.rooms.map((o,a)=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center bg-slate-50 p-3 rounded-xl border border-slate-100 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("i",{className:"fa-solid fa-door-open text-blue-600 text-sm"}),e.jsx("input",{value:o.room_name,onChange:t=>{const l={...i};l.works[n].rooms[a].room_name=t.target.value,x(l)},className:"font-black text-slate-700 uppercase tracking-widest text-xs outline-none border-b border-blue-600/30 w-2/3"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[9px] font-black text-slate-400 uppercase",children:"Room Override:"}),e.jsx("div",{className:"w-50",children:e.jsx(v,{options:T,placeholder:"Material",selectedValue:o.selectedMaterial||"",onSelect:t=>{const l={...i};l.works[n].rooms[a].selectedMaterial=t,x(l)}})}),e.jsx("div",{className:"w-50",children:e.jsx(v,{options:Object.keys(_[o.selectedMaterial]||{}),placeholder:"Brand",onSelect:t=>{if(!t)return;const c=(_[o.selectedMaterial]||[]).find(b=>b.name===t),f=(c==null?void 0:c.rate)||0;G(n,a,o.selectedMaterial,t,f)}})})]})]}),e.jsx("div",{className:"overflow-x-auto rounded-xl border border-slate-100",children:e.jsxs("table",{className:"w-full text-sm border-collapse",children:[e.jsx("thead",{className:"bg-slate-50 text-[10px] font-black uppercase text-slate-400",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left w-24",children:"Code"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Description"}),e.jsx("th",{className:"px-4 py-3 text-center w-20",children:"Qty"}),e.jsx("th",{className:"px-4 py-3 text-center w-24",children:"UOM"}),e.jsx("th",{className:"px-4 py-3 text-right w-32",children:"Rate (₹)"}),e.jsx("th",{className:"px-4 py-3 text-right w-32",children:"Total (₹)"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-50",children:o.items.map((t,l)=>{var y,S,j,w;let c=1;if(t.uom==="SQFT"||t.uom==="SQM"){const d=parseFloat(((y=t.metadata)==null?void 0:y.l)||0),h=parseFloat(((S=t.metadata)==null?void 0:S.b)||0);d>0&&h>0&&(c=d*h/92903.04)}const f=parseFloat(t.price||0),b=parseFloat(t.quantity||0)*c*f;return e.jsxs("tr",{className:"hover:bg-blue-50/20 transition-all",children:[e.jsx("td",{className:"px-4 py-4",children:e.jsx("input",{value:t.s_no,onChange:d=>N(n,a,l,"s_no",d.target.value),className:"w-full bg-blue-50 text-blue-700 font-bold px-2 py-1 rounded outline-none text-xs"})}),e.jsxs("td",{className:"px-4 py-4",children:[e.jsx("textarea",{rows:1,value:t.description,onChange:d=>N(n,a,l,"description",d.target.value),className:"w-full font-bold text-slate-700 outline-none bg-transparent"}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsxs("div",{className:"flex items-center bg-slate-50 border border-slate-200 rounded overflow-hidden w-24",children:[e.jsx("span",{className:"bg-slate-200 px-1.5 py-0.5 text-[8px] font-black uppercase border-r border-slate-200",children:"L"}),e.jsx("input",{value:((j=t.metadata)==null?void 0:j.l)??"",onChange:d=>{const h={...i};h.works[n].rooms[a].items[l].metadata||(h.works[n].rooms[a].items[l].metadata={l:"",b:""}),h.works[n].rooms[a].items[l].metadata.l=d.target.value,x(h)},className:"text-[11px] w-full px-2 font-bold outline-none bg-transparent"})]}),e.jsxs("div",{className:"flex items-center bg-slate-50 border border-slate-200 rounded overflow-hidden w-24",children:[e.jsx("span",{className:"bg-slate-200 px-1.5 py-0.5 text-[8px] font-black uppercase border-r border-slate-200",children:"B"}),e.jsx("input",{value:((w=t.metadata)==null?void 0:w.b)??"",onChange:d=>{const h={...i};h.works[n].rooms[a].items[l].metadata||(h.works[n].rooms[a].items[l].metadata={l:"",b:""}),h.works[n].rooms[a].items[l].metadata.b=d.target.value,x(h)},className:"text-[11px] w-full px-2 font-bold outline-none bg-transparent"})]})]})]}),e.jsx("td",{className:"px-4 py-4 text-center",children:e.jsx("input",{type:"number",value:t.quantity,onChange:d=>N(n,a,l,"quantity",d.target.value),className:"w-16 bg-slate-100 rounded text-center font-black p-1"})}),e.jsx("td",{className:"px-4 py-4 text-center",children:e.jsxs("select",{value:t.uom,onChange:d=>N(n,a,l,"uom",d.target.value),className:"text-[10px] font-black border border-slate-200 rounded p-1",children:[e.jsx("option",{value:"nos",children:"NOS"}),e.jsx("option",{value:"sqft",children:"SQFT"}),e.jsx("option",{value:"sqmm",children:"SQMM"})]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-end bg-emerald-50 border border-emerald-100 rounded px-2",children:[e.jsx("span",{className:"text-[10px] text-emerald-600 font-bold mr-1",children:"₹"}),e.jsx("input",{type:"number",value:t.unitPrice||0,onChange:d=>N(n,a,l,"price",d.target.value),className:"w-20 bg-transparent text-right font-black text-emerald-700 text-xs py-1 outline-none"})]})}),e.jsxs("td",{className:"px-4 py-3 text-right font-black text-slate-900 bg-slate-50/30",children:["₹ ",b.toLocaleString("en-IN",{minimumFractionDigits:2})]})]},l)})})]})})]},a))})]},n))})})]})})};export{xe as default};
