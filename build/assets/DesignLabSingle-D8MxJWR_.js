import{a as y,j as d}from"./index-CqEiDvr_.js";import{a as I,b as D}from"./designLabApi-B8CqL0uw.js";import{D as L}from"./DesignLabForm-CjEAQbTZ.js";import{t as m}from"./toast-BSC5QTk1.js";import"./useQuery-DyvuN1xf.js";import"./useMutation-DDHgQq3T.js";import"./useInfiniteQuery-DFFyAdlX.js";import"./roleCheck-BJ07f95N.js";import"./Button-DzcQpMPj.js";const A=()=>{const{id:l}=y(),{data:n,isLoading:u,isError:f}=I(l),{mutateAsync:g,isPending:h}=D(),x=async s=>{try{const i=new FormData,o=[],p=[],c=s.components.map(e=>({...e,materials:e.materials.filter(t=>{var a;return((a=t.materialName)==null?void 0:a.trim())||t.rate!==""&&t.rate!==0||t.image||t.tempFile})})),b=s.sequenceOfOperations.filter(e=>{var t;return(t=e.description)==null?void 0:t.trim()}).map((e,t)=>({...e,stepNumber:t+1})),F=s.referenceImages.filter(e=>!e.url.startsWith("blob:"));s.newRefFiles.forEach(e=>{p.push(e),o.push({target:"reference"})}),c.forEach((e,t)=>{e.materials.forEach((a,E)=>{a.tempFile&&(p.push(a.tempFile),o.push({target:"material",componentIndex:t,materialIndex:E}),a.image=null,delete a.tempFile)})});const r={...s,referenceImages:F,components:c,sequenceOfOperations:b};delete r.newRefFiles,delete r._id,delete r.createdAt,delete r.updatedAt,i.append("data",JSON.stringify(r)),i.append("fileMapping",JSON.stringify(o)),p.forEach(e=>{i.append("files",e)}),await g({id:l,formData:i}),m({title:"Success",description:"Design updated successfully"})}catch(i){console.error("Update Error:",i),m({title:"Error",description:i.message||"Failed to update design",variant:"destructive"})}};return u?d.jsx("div",{className:"p-10 text-center",children:"Loading Design..."}):f?d.jsx("div",{className:"p-10 text-center text-red-500",children:"Error loading design"}):d.jsx(L,{mode:"edit",organizationId:n==null?void 0:n.organizationId,initialData:n,onSubmit:x,isLoading:h})};export{A as default};
