import{y as E,P as K,Q as S,U as N,V as I,u as T,r as Q,j as e,B as P,M as O,t as b,W as U}from"./index-BbUIXOOD.js";const B=async({projectId:n,payload:r,api:a})=>{console.log("paylod from creating",r);const{data:s}=await a.post(`/inventory/create/${n}`,r);if(!s.ok)throw new Error(s.message);return s.data},D=async({projectId:n,subItemId:r,payload:a,api:s})=>{console.log("paylod from updating",a);const{data:o}=await s.put(`/inventory/update/${n}/${r}`,a);if(!o.ok)throw new Error(o.message);return o.data},L=async({projectId:n,subItemId:r,api:a})=>{const{data:s}=await a.delete(`/inventory/delete/${n}/${r}`);if(!s.ok)throw new Error(s.message);return s.data},V=async({projectId:n,api:r})=>{const{data:a}=await r.get(`/inventory/get/${n}`);if(!a.ok)throw new Error(a.message);return a.data},G=()=>{const n=["owner","staff","CTO"],{role:r}=E(),a=I(r);return S({mutationFn:async({projectId:s,payload:o})=>{if(!r||!n.includes(r))throw new Error("not allowed to make this api call");if(!a)throw new Error("API instance not found for role");return await B({projectId:s,payload:o,api:a})},onSuccess:(s,{projectId:o})=>{N.invalidateQueries({queryKey:["inventory",o]})}})},W=()=>{const n=["owner","staff","CTO"],{role:r}=E(),a=I(r);return S({mutationFn:async({projectId:s,subItemId:o,payload:m})=>{if(!r||!n.includes(r))throw new Error("not allowed to make this api call");if(!a)throw new Error("API instance not found for role");return await D({projectId:s,subItemId:o,payload:m,api:a})},onSuccess:(s,{projectId:o})=>{N.invalidateQueries({queryKey:["inventory",o]})}})},H=()=>{const n=["owner","staff","CTO"],{role:r}=E(),a=I(r);return S({mutationFn:async({projectId:s,subItemId:o})=>{if(!r||!n.includes(r))throw new Error("not allowed to make this api call");if(!a)throw new Error("API instance not found for role");return await L({projectId:s,subItemId:o,api:a})},onSuccess:(s,{projectId:o})=>{N.invalidateQueries({queryKey:["inventory",o]})}})},J=n=>{const r=["owner","staff","CTO","worker"],{role:a}=E(),s=I(a);return K({queryKey:["inventory",n],queryFn:async()=>{if(!a||!r.includes(a))throw new Error("not allowed to make this api call");if(!s)throw new Error("API instance not found for role");return await V({projectId:n,api:s})},enabled:!!n&&!!a,retry:!1})},X=async({organizationId:n,projectId:r,api:a})=>{const{data:s}=await a.put(`/recyclematerial/updaterecyclemanually/${n}/${r}`);if(!s.ok)throw new Error(s.message);return s.data},Y=async({organizationId:n,projectId:r,itemId:a,quantity:s,api:o})=>{const{data:m}=await o.patch(`/recyclematerial/updatequantity/${n}/${r}/${a}`,{quantity:s});if(!m.ok)throw new Error(m.message);return m.data},Z=async({organizationId:n,projectId:r,api:a})=>{const{data:s}=await a.get(`/recyclematerial/getsingleprojectmaterial/${n}/${r}`);if(!s.ok)throw new Error(s.message);return s.data},z=()=>{const n=["owner","staff","CTO"],{role:r}=E(),a=I(r);return S({mutationFn:async({organizationId:s,projectId:o})=>{if(!r||!n.includes(r))throw new Error("Not allowed to make this API call");if(!a)throw new Error("API instance not found for role");return await X({organizationId:s,projectId:o,api:a})},onSuccess:(s,{projectId:o,organizationId:m})=>{N.invalidateQueries({queryKey:["recycle-materials",m,o]}),N.invalidateQueries({queryKey:["recycle-materials","global",m]})}})},ee=()=>{const n=["owner","staff","CTO"],{role:r}=E(),a=I(r);return S({mutationFn:async({organizationId:s,projectId:o,itemId:m,quantity:k})=>{if(!r||!n.includes(r))throw new Error("Not allowed to make this API call");if(!a)throw new Error("API instance not found for role");return await Y({organizationId:s,projectId:o,quantity:k,itemId:m,api:a})},onSuccess:(s,{projectId:o,organizationId:m})=>{N.invalidateQueries({queryKey:["recycle-materials",m,o]}),N.invalidateQueries({queryKey:["recycle-materials","global",m]})}})},te=(n,r)=>{const a=["owner","staff","CTO","worker"],{role:s}=E(),o=I(s);return K({queryKey:["recycle-materials",n,r],queryFn:async()=>{if(!s||!a.includes(s))throw new Error("Not allowed to make this API call");if(!o)throw new Error("API instance not found for role");return await Z({organizationId:n,projectId:r,api:o})},enabled:!!n&&!!r&&!!o})},ae=()=>{var j,g,h,v;const{projectId:n,organizationId:r}=T(),{data:a,isLoading:s,error:o,refetch:m}=te(r,n),{mutateAsync:k,isPending:_}=z(),{mutateAsync:A}=ee(),[R,w]=Q.useState(null),i=d=>{w(d)},y=async()=>{var d,p;try{await k({organizationId:r,projectId:n}),b({title:"Success",description:"Sync successfull."})}catch(t){b({title:"Error",description:((p=(d=t==null?void 0:t.response)==null?void 0:d.data)==null?void 0:p.message)||t.message||"Failed to update material",variant:"destructive"})}},c=async(d,p)=>{var t,l;try{await A({organizationId:r,projectId:n,itemId:d,quantity:p}),b({title:"Success",description:"Updated successfully."})}catch(u){b({title:"Error",description:((l=(t=u==null?void 0:u.response)==null?void 0:t.data)==null?void 0:l.message)||u.message||"Failed to update material",variant:"destructive"})}};return console.log("daata",a),o&&((g=(j=o==null?void 0:o.response)==null?void 0:j.data)!=null&&g.message,P),e.jsxs("div",{className:"max-w-full w-full mx-auto bg-white border border-blue-200 rounded-lg shadow-sm px-6 py-5",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 ",children:[e.jsxs("h2",{className:"text-xl font-bold text-blue-700  flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-recycle text-blue-600"}),"Project Recycled Materials"]}),e.jsx(P,{isLoading:_,onClick:y,children:"Sync Recycle Materiasl"})]}),s?e.jsx("p",{className:"text-gray-500",children:e.jsx(O,{})}):a===null||((h=a==null?void 0:a.subItems)==null?void 0:h.length)==0?e.jsx("div",{className:"h-30  flex justify-center items-center",children:e.jsx("p",{className:"text-gray-500",children:"No recycled materials found for this project."})}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-0 bg-gray-100 border-b border-gray-200",children:[e.jsx("div",{className:" px-4 py-3 text-sm font-medium text-gray-700 border-r border-gray-200",children:"Material Name"}),e.jsx("div",{className:" px-4 py-3 text-sm font-medium text-gray-700 border-r border-gray-200",children:"Remaining Quantity"})]}),(v=a==null?void 0:a.subItems)==null?void 0:v.map(d=>e.jsxs("div",{className:"grid grid-cols-2 gap-0 border-b border-gray-100 hover:bg-gray-50",children:[e.jsx("div",{className:"border-r border-gray-200 px-4 py-3 hover:bg-blue-50 transition-colors",children:d.itemName}),e.jsx("div",{className:" border-r border-gray-200",children:R===d._id?e.jsx("input",{type:"number",defaultValue:d.remainingQuantity,min:"0",autoFocus:!0,className:"w-full px-4 py-3 border-none outline-none focus:bg-blue-50",onBlur:p=>{c(d._id,+p.target.value),w(null)},onKeyDown:p=>{p.key==="Enter"&&(c(d._id,+p.target.value),w(null)),p.key==="Escape"&&w(null)}}):e.jsx("div",{className:"px-4 py-3 cursor-pointer hover:bg-blue-50 transition-colors",onClick:()=>i(d._id),children:d.remainingQuantity})})]},d._id))]})]})},$=["nos","pieces","litre","kg","mm","cm","meter","feet","inch","sqft","sqmm","packet","roll","sheet"],se=()=>{const{projectId:n}=T(),{data:r,isLoading:a,isError:s,error:o}=J(n),m=G(),k=W(),_=H(),{isMobile:A,openMobileSidebar:R,projectName:w}=U(),[i,y]=Q.useState(null),[c,j]=Q.useState({name:"",totalQuantity:1,unit:""}),g=Q.useRef(null),h=(r==null?void 0:r.subItems)||[];Q.useEffect(()=>{i&&g.current&&(g.current.focus(),g.current.select())},[i]);const v=async(t,l,u)=>{var x,M,q,F,C;try{await k.mutateAsync({projectId:n,subItemId:t,payload:{itemName:l==="name"?u:(x=h.find(f=>f._id===t))==null?void 0:x.itemName,totalQuantity:l==="totalQuantity"?Number(u)?Number(u):1:(M=h.find(f=>f._id===t))==null?void 0:M.totalQuantity,unit:l==="unit"?u:(q=h.find(f=>f._id===t))==null?void 0:q.unit,note:""}}),b({title:"Success",description:"Item updated successfully"})}catch(f){b({title:"Error",description:((C=(F=f==null?void 0:f.response)==null?void 0:F.data)==null?void 0:C.message)||"Failed to update item",variant:"destructive"})}},d=async t=>{var l,u;if(!t.name.trim()||!t.unit)return b({title:"Error",description:"Material Name and Unit are mandatory",variant:"destructive"});try{const{name:x,...M}=t;await m.mutateAsync({projectId:n,payload:{...M,itemName:x,note:""}}),j({name:"",totalQuantity:1,unit:""}),b({title:"Success",description:"Item created successfully"})}catch(x){b({title:"Error",description:((u=(l=x==null?void 0:x.response)==null?void 0:l.data)==null?void 0:u.message)||"Failed to create item",variant:"destructive"})}},p=async t=>{var l,u;try{await _.mutateAsync({projectId:n,subItemId:t}),b({title:"Success",description:"Item deleted successfully"})}catch(x){b({title:"Error",description:((u=(l=x==null?void 0:x.response)==null?void 0:l.data)==null?void 0:u.message)||"Failed to delete item",variant:"destructive"})}};return a?e.jsx("div",{children:e.jsx(O,{})}):s?e.jsxs("div",{children:["Error: ",o.message]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"w-full max-h-full overflow-y-auto flex flex-col p-2 min-h-full",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl sm:text-3xl font-semibold mb-1 text-blue-600 flex items-center",children:[A&&e.jsx("button",{onClick:R,className:"mr-3 p-2 rounded-md border-gray-300 hover:bg-gray-100",title:"Open Menu",children:e.jsx("i",{className:"fa-solid fa-bars"})}),e.jsx("i",{className:"fa-solid fa-boxes-stacked mr-2"}),"Inventory Items ",w?`for ${w}`:""]}),e.jsx("p",{className:"text-gray-400",children:"Manage and track project materials in one place"})]}),e.jsxs("div",{className:"mt-6 pt-4 border-t border-gray-200 bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("i",{className:"fa-solid fa-list text-blue-600"}),e.jsx("h4",{className:"font-semibold text-gray-800",children:"Material Items"}),e.jsx("span",{className:"text-sm text-gray-500",children:"(Click to edit, changes save by clicking Enter)"})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"grid grid-cols-17 gap-0 bg-gray-100 border-b border-gray-200",children:[e.jsx("div",{className:"col-span-8 px-4 py-3 text-sm font-medium text-gray-700 border-r border-gray-200",children:"Material Name"}),e.jsx("div",{className:"col-span-2 px-4 py-3 text-sm font-medium text-gray-700 border-r border-gray-200",children:"Total Quantity"}),e.jsx("div",{className:"col-span-2 px-4 py-3 text-sm font-medium text-gray-700 border-r border-gray-200",children:"Remaining Quantity"}),e.jsx("div",{className:"col-span-3 px-4 py-3 text-sm font-medium text-gray-700 border-r border-gray-200",children:"Unit"}),e.jsx("div",{className:"col-span-1 px-4 py-3 text-sm font-medium text-gray-700",children:"Action"})]}),h.map(t=>e.jsxs("div",{className:"grid grid-cols-17 gap-0 border-b border-gray-100 hover:bg-gray-50",children:[e.jsx("div",{className:"col-span-8 border-r border-gray-200",children:(i==null?void 0:i.subItemId)===t._id&&(i==null?void 0:i.field)==="name"?e.jsx("input",{ref:g,type:"text",defaultValue:t.itemName,className:"w-full px-4 py-3 border-none outline-none focus:bg-blue-50",onBlur:l=>{var u;(u=c==null?void 0:c.name)!=null&&u.trim()&&(c!=null&&c.unit)&&v(t._id,"name",l.target.value),y(null)},onKeyDown:l=>{l.key==="Enter"&&(v(t._id,"name",l.target.value),y(null)),l.key==="Escape"&&y(null)}}):e.jsx("div",{className:"px-4 py-3 cursor-pointer hover:bg-blue-50 transition-colors",onClick:()=>y({subItemId:t._id,field:"name"}),children:t.itemName})}),e.jsx("div",{className:"col-span-2 border-r border-gray-200",children:(i==null?void 0:i.subItemId)===t._id&&(i==null?void 0:i.field)==="totalQuantity"?e.jsx("input",{ref:g,type:"number",defaultValue:t.totalQuantity,min:"0",className:"w-full px-4 py-3 border-none outline-none focus:bg-blue-50",onBlur:l=>{v(t._id,"totalQuantity",l.target.value),y(null)},onKeyDown:l=>{l.key==="Enter"&&(v(t._id,"totalQuantity",l.target.value),y(null)),l.key==="Escape"&&y(null)}}):e.jsx("div",{className:"px-4 py-3 cursor-pointer hover:bg-blue-50 transition-colors",onClick:()=>y({subItemId:t._id,field:"totalQuantity"}),children:t.totalQuantity})}),e.jsx("div",{className:"col-span-2 border-r border-gray-200",children:e.jsx("div",{className:"px-4 py-3 cursor-pointer hover:bg-blue-50 transition-colors",onClick:()=>y({subItemId:t._id,field:"totalQuantity"}),children:t.remainingQuantity})}),e.jsx("div",{className:"col-span-3 border-r border-gray-200",children:(i==null?void 0:i.subItemId)===t._id&&(i==null?void 0:i.field)==="unit"?e.jsxs("select",{defaultValue:t.unit,onChange:l=>{v(t._id,"unit",l.target.value),y(null)},className:"w-full px-4 py-3 border-none outline-none focus:bg-blue-50",children:[e.jsx("option",{value:"",disabled:!0,children:"Selected unit"}),$.map(l=>e.jsx("option",{value:l,children:l},l))]}):e.jsx("div",{className:"px-4 py-3 cursor-pointer hover:bg-blue-50 transition-colors",onClick:()=>y({subItemId:t._id,field:"unit"}),children:t.unit})}),e.jsx("div",{className:"col-span-1 flex items-center justify-center",children:e.jsx(P,{variant:"danger",isLoading:_.isPending,onClick:()=>p(t._id),className:"p-2 bg-red-600 text-white hover:bg-red-50 rounded transition-colors",title:"Delete item",children:e.jsx("i",{className:"fa fa-trash text-sm"})})})]},t._id)),e.jsxs("div",{className:"grid grid-cols-17 gap-0 bg-green-50 border-b border-gray-100",children:[e.jsx("div",{className:"col-span-8 border-r border-gray-200",children:e.jsx("input",{type:"text",placeholder:"Enter material name...",value:c.name,onChange:t=>j({...c,name:t.target.value}),onBlur:()=>{c.name.trim()&&c.unit&&d(c)},onKeyDown:t=>{t.key==="Enter"&&d(c)},className:"w-full px-4 py-3 bg-transparent border-none outline-none placeholder-gray-400"})}),e.jsx("div",{className:"col-span-2 border-r border-gray-200",children:e.jsx("input",{type:"number",placeholder:"Qty",min:"0",value:c.totalQuantity,onChange:t=>j({...c,totalQuantity:Number(t.target.value)||0}),className:"w-full px-4 py-3 bg-transparent border-none outline-none placeholder-gray-400"})}),e.jsx("div",{className:"col-span-2 border-r border-gray-200",children:e.jsx("input",{type:"number",placeholder:"Remaining Quanitity",disabled:!0,min:"0",value:c.totalQuantity,className:"w-full px-4 py-3 bg-transparent border-none outline-none placeholder-gray-400"})}),e.jsx("div",{className:"col-span-3 border-r border-gray-200",children:e.jsxs("select",{value:c.unit,onChange:async t=>{j({...c,unit:t.target.value});const l={...c,unit:t.target.value};await d(l)},className:"w-full px-4 py-3 border-none outline-none focus:bg-blue-50",children:[e.jsx("option",{value:"",disabled:!0,children:"Selected unit"}),$.map(t=>e.jsx("option",{value:t,children:t},t))]})})]}),h.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("i",{className:"fa-solid fa-inbox text-2xl mb-2"}),e.jsx("p",{className:"text-sm",children:"No sub-items yet. Start typing in the row above to add items."})]})]})]}),e.jsx("section",{className:"mt-4",children:e.jsx(ae,{})})]})})};export{se as default};
