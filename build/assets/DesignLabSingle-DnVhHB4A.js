import{u as y,j as d}from"./index-Dkf7SbMA.js";import{a as I,b as D}from"./designLabApi-CvnqPqeB.js";import{D as L}from"./DesignLabForm-BgJMPBWr.js";import{t as m}from"./toast-BSC5QTk1.js";import"./useQuery-h0LZ4b8f.js";import"./useMutation-DtRxugN4.js";import"./useInfiniteQuery-BUWQcrvt.js";import"./roleCheck-CXq1v0D5.js";import"./Button-ClgICMLF.js";const A=()=>{const{id:l}=y(),{data:n,isLoading:u,isError:f}=I(l),{mutateAsync:g,isPending:h}=D(),x=async a=>{try{const i=new FormData,o=[],p=[],c=a.components.map(e=>({...e,materials:e.materials.filter(t=>{var s;return((s=t.materialName)==null?void 0:s.trim())||t.rate!==""&&t.rate!==0||t.image||t.tempFile})})),b=a.sequenceOfOperations.filter(e=>{var t;return(t=e.description)==null?void 0:t.trim()}).map((e,t)=>({...e,stepNumber:t+1})),F=a.referenceImages.filter(e=>!e.url.startsWith("blob:"));a.newRefFiles.forEach(e=>{p.push(e),o.push({target:"reference"})}),c.forEach((e,t)=>{e.materials.forEach((s,E)=>{s.tempFile&&(p.push(s.tempFile),o.push({target:"material",componentIndex:t,materialIndex:E}),s.image=null,delete s.tempFile)})});const r={...a,referenceImages:F,components:c,sequenceOfOperations:b};delete r.newRefFiles,delete r._id,delete r.createdAt,delete r.updatedAt,i.append("data",JSON.stringify(r)),i.append("fileMapping",JSON.stringify(o)),p.forEach(e=>{i.append("files",e)}),await g({id:l,formData:i}),m({title:"Success",description:"Design updated successfully"})}catch(i){console.error("Update Error:",i),m({title:"Error",description:i.message||"Failed to update design",variant:"destructive"})}};return u?d.jsx("div",{className:"p-10 text-center",children:"Loading Design..."}):f?d.jsx("div",{className:"p-10 text-center text-red-500",children:"Error loading design"}):d.jsx(L,{mode:"edit",organizationId:n==null?void 0:n.organizationId,initialData:n,onSubmit:x,isLoading:h})};export{A as default};
