import{j as e,B as A,a as Ae,u as ke,r as S,b as qe,M as Ie,t as ee}from"./index-MXS_gbde.js";import{u as Be,a as Re,f as te}from"./InternalQuoteEntry-Cp1bBL_5.js";import{c as De,u as Qe}from"./labourRateconfigApi-C3VsaBeF.js";import"./projectApi-BH0dGL_K.js";import"./quoteVariantApi-DV1NXuB1.js";import"./Card-L4jLwmC3.js";import"./dateFormator-BGKi5rfZ.js";import"./StageGuide-DLy2p25i.js";import"./CreateQuoteModal-CZVd6h3V.js";import"./SearchSelectNew-C8k-FWEO.js";import"./Label-BYfdMzSb.js";import"./Select-COWxTY-d.js";const K={plywood:1,innerLaminate:1,outerLaminate:1},Ee=()=>({itemName:"",plywoodNos:{quantity:0,thickness:0},innerLaminate:{quantity:0,thickness:0},outerLaminate:{quantity:0,thickness:0},carpenters:0,days:0,profitOnMaterial:0,profitOnLabour:0,rowTotal:0,remarks:""}),be=()=>({itemName:"",description:"",quantity:0,cost:0,rowTotal:0}),Y=(o,B,I=0,h=0)=>{if(o.length===0)return[];const u=o.length,O=h/u,j=o[0],k=j.carpenters*j.days*B*(1+(j.profitOnLabour||0)/100)/u,g=1+I/100;return o.map(v=>{var y,N,f;const d=((y=v.plywoodNos)==null?void 0:y.quantity)||0,t=((N=v.innerLaminate)==null?void 0:N.quantity)||0,l=((f=v.outerLaminate)==null?void 0:f.quantity)||0,s=d*K.plywood+t*K.innerLaminate+l*K.outerLaminate,r=(v.profitOnMaterial||0)>0,c=s*(1+(v.profitOnMaterial||0)/100),p=r?c+k+O:(s+k+O)*g;return{...v,rowTotal:p}})},Ue=({data:o,isEditing:B,labourCost:I,updateFurniture:h,removeFurniture:u})=>{const O=d=>{const t=d.coreMaterials.reduce((c,p)=>c+p.rowTotal,0),l=d.fittingsAndAccessories.reduce((c,p)=>c+p.rowTotal,0),s=d.glues.reduce((c,p)=>c+p.rowTotal,0),r=d.nonBrandMaterials.reduce((c,p)=>c+p.rowTotal,0);return{core:t,fittings:l,glues:s,nbms:r,furnitureTotal:t+l+s+r}},j=(d,t,l)=>{const s=[...o.coreMaterials];t==="imageUrl"?(B&&(s[d].newImageFile=l),s[d].imageUrl=l,s[d].previewUrl=URL.createObjectURL(l)):t==="plywoodNos"||t==="innerLaminate"||t==="outerLaminate"?s[d][t]={...s[d][t]||{},...l}:s[d][t]=l;const r=Y(s,I,o.furnitureProfit||0),c=r.reduce((q,b)=>q+(b.rowTotal||0),0),p=r.length,y=p>0?Math.round(c/p):0,N=1+(o.furnitureProfit||0)/100,f=(q,b=!1)=>q.map(T=>{if(b||T.itemName==="Glue")return{...T,itemName:"Glue",quantity:1,profitOnMaterial:T.profitOnMaterial,cost:y,rowTotal:y};const C=(T.quantity||0)*(T.cost||0),R=T.profitOnMaterial||0,F=R>0?C*(1+R/100):C*N;return{...T,rowTotal:F}}),M={...o,coreMaterials:r,fittingsAndAccessories:f(o.fittingsAndAccessories),glues:f(o.glues,!0),nonBrandMaterials:f(o.nonBrandMaterials)};M.totals=O(M),h==null||h(M)},_=d=>{const t=d.reduce((y,N)=>y+(N.rowTotal||0),0),l=d.length,s=l>0?Math.round(t/l):0,r=1+(o.furnitureProfit||0)/100,c=(y,N=!1)=>y.map(f=>{if(N||f.itemName==="Glue")return{...f,itemName:"Glue",quantity:1,cost:s,profitOnMaterial:f.profitOnMaterial,rowTotal:s};const M=(f.quantity||0)*(f.cost||0),b=(f.profitOnMaterial||0)>0?M*(1+(f.profitOnMaterial||0)/100):M*r;return{...f,rowTotal:b}}),p={...o,coreMaterials:d,fittingsAndAccessories:c(o.fittingsAndAccessories),glues:c(o.glues,!0),nonBrandMaterials:c(o.nonBrandMaterials)};p.totals=O(p),h==null||h(p)},L=(d,t,l)=>{const s=l?o.coreMaterials.map(b=>({...b,profitOnMaterial:0,profitOnLabour:0})):o.coreMaterials,r=l?o.fittingsAndAccessories.map(b=>({...b,profitOnMaterial:0})):o.fittingsAndAccessories,c=l?o.glues.map(b=>({...b,profitOnMaterial:0})):o.glues,p=l?o.nonBrandMaterials.map(b=>({...b,profitOnMaterial:0})):o.nonBrandMaterials,y=Y(s,I,d,t),N=y.reduce((b,T)=>b+T.rowTotal,0),f=y.length>0?N/y.length:0,M=(b,T=!1)=>b.map(C=>{if(T||C.itemName==="Glue")return{...C,cost:f,rowTotal:f};const R=C.quantity*C.cost,F=C.profitOnMaterial||0;return{...C,rowTotal:F>0?R*(1+F/100):R*(1+d/100)}}),q={...o,furnitureProfit:d,fabricationCost:t,coreMaterials:y,fittingsAndAccessories:M(r),glues:M(c,!0),nonBrandMaterials:M(p)};q.totals=O(q),h==null||h(q)},k=(d,t,l,s)=>{const r=[...o[d]];if(r[t][l]=s,d!=="glues"){const N=(r[t].quantity||0)*(r[t].cost||0),f=N*((r[t].profitOnMaterial||0)/100);r[t].rowTotal=Math.round(N+f)}else{const N=r[t].cost||0,f=N*((r[t].profitOnMaterial||0)/100);r[t].rowTotal=Math.round(N+f)}const c=t===r.length-1,p=r[t].itemName||r[t].description||r[t].quantity||r[t].cost;c&&p&&r.push(be());const y={...o,[d]:r};y.totals=O(y),h&&h(y)},g=()=>{var d;return e.jsxs("div",{className:"mt-4",children:[e.jsxs("h3",{className:"font-semibold text-md mb-2",children:["Core Materials - Total: ₹",(d=o==null?void 0:o.totals)==null?void 0:d.core.toLocaleString("en-IN")]}),e.jsx("div",{className:"overflow-x-auto  rounded-md",children:e.jsxs("table",{className:"min-w-full text-sm bg-white shadow-sm",children:[e.jsxs("thead",{className:"bg-blue-50 text-sm font-semibold text-gray-600",children:[e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Image"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Item Name"}),e.jsx("th",{className:"text-center px-6 py-1 text-xs font-medium text-gray-500 uppercase tracking-wider border-x border-gray-200",colSpan:2,children:"Plywood"}),e.jsx("th",{className:"text-center px-6 py-1 text-xs font-medium text-gray-500 uppercase tracking-wider border-x border-gray-200",colSpan:4,children:"Laminate"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"No. of Carpenters / Day"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"No. of Days"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Profit % Material"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Profit % Labour"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Remarks"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Total"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Actions"})]}),e.jsxs("tr",{className:"",children:[e.jsx("th",{className:"px-2 py-2 text-[10px] uppercase text-gray-500 border-r border-gray-200",children:"Qty"}),e.jsx("th",{className:"px-2 py-2 text-[10px] uppercase text-gray-500 border-r border-gray-200",children:"Thk"}),e.jsx("th",{className:"px-2 py-2 text-[10px]  text-gray-500 uppercase border-r border-gray-200",children:"Inner Qty"}),e.jsx("th",{className:"px-2 py-2 text-[10px]  text-gray-500 uppercase border-r border-gray-200",children:"Inner Thk"}),e.jsx("th",{className:"px-2 py-2 text-[10px]  text-gray-500 uppercase",children:"Outer Qty"}),e.jsx("th",{className:"px-2 py-2 text-[10px]  text-gray-500 uppercase border-r border-gray-200",children:"Outer Thk"})]})]}),e.jsx("tbody",{children:o.coreMaterials.map((t,l)=>e.jsxs("tr",{className:"group relative border-none !border-b-1 px-4 py-2 transition-all duration-150 hover:bg-gray-50",children:[l===0&&e.jsxs("td",{rowSpan:o.coreMaterials.length,children:[e.jsx("input",{type:"file",className:"w-full px-2 py-3 text-center outline-none",onChange:s=>{var r;return j(0,"imageUrl",(r=s.target.files)==null?void 0:r[0])}}),t.previewUrl&&e.jsx("img",{src:t.previewUrl,className:"h-10 mt-2 mx-auto"})]}),e.jsx("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{value:t.itemName,placeholder:"TV Unit | Wardrobe",onChange:s=>j(l,"itemName",s.target.value),className:"w-full px-2 py-1 text-center outline-none"})}),["plywoodNos","innerLaminate","outerLaminate"].map(s=>["quantity","thickness"].map(r=>e.jsx("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",placeholder:`${r==="quantity"?"QTY":"THK"}`,value:t[s][r]||"",onChange:c=>{Number(c.target.value)>=0&&j(l,s,{...t[s],[r]:Math.max(0,Number(c.target.value))})},className:"w-full px-2 py-1 text-center outline-none"})},`${s}-${r}`))),l===0&&e.jsxs(e.Fragment,{children:[e.jsx("td",{rowSpan:o.coreMaterials.length,className:"px-1 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",placeholder:"no of carpentors",value:t.carpenters||"",onChange:s=>j(l,"carpenters",Math.max(0,Number(s.target.value))),className:"w-full px-[2px] py-1 text-center outline-none"})}),e.jsx("td",{rowSpan:o.coreMaterials.length,className:"px-1 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",placeholder:"no of days",value:t.days||"",onChange:s=>j(l,"days",Math.max(0,Number(s.target.value))),className:"w-full px-[2px] py-1 text-center outline-none"})})]}),e.jsx("td",{className:"px-1 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",placeholder:"profit percent",value:t.profitOnMaterial||"",onChange:s=>j(l,"profitOnMaterial",Math.max(0,Number(s.target.value))),className:"w-full px-[2px] py-1 text-center outline-none"})}),l===0&&e.jsx(e.Fragment,{children:e.jsx("td",{rowSpan:o.coreMaterials.length,className:"px-1 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",placeholder:"profit percent",value:t.profitOnLabour||"",onChange:s=>j(l,"profitOnLabour",Math.max(0,Number(s.target.value))),className:"w-full px-[2px] py-1 text-center outline-none"})})}),e.jsx("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{value:t.remarks,placeholder:"remarks",onChange:s=>j(l,"remarks",s.target.value),className:"w-full px-2 py-1 text-center outline-none"})}),e.jsxs("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:["₹",t.rowTotal.toLocaleString("en-IN",{minimumFractionDigits:0,maximumFractionDigits:2})]}),e.jsx("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx(A,{variant:"danger",onClick:()=>{const s=[...o.coreMaterials];s.splice(l,1);const r=Y(s,I,o.furnitureProfit||0);_(r)},className:"px-1 text-xs bg-red-600 text-white",children:"Remove"})})]},l))})]})}),e.jsx("div",{className:"mt-2 text-right",children:e.jsx(A,{onClick:()=>{const t=[...o.coreMaterials,Ee()],l=Y(t,I,o.furnitureProfit||0),s={...o,coreMaterials:l};s.totals=O(s),h==null||h(s)},children:"+ Add Core Material"})})]})},v=(d,t)=>{var l;return e.jsxs("div",{className:"mt-6",children:[e.jsxs("h3",{className:"font-semibold text-md mb-2",children:[d," - Total: ₹",(l=o==null?void 0:o.totals[t==="fittingsAndAccessories"?"fittings":t])==null?void 0:l.toLocaleString("en-IN",{minimumFractionDigits:0,maximumFractionDigits:2})]}),e.jsx("div",{className:"overflow-x-auto  rounded-md",children:e.jsxs("table",{className:"min-w-full text-sm bg-white shadow-sm",children:[e.jsx("thead",{className:"bg-blue-50 text-sm font-semibold text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Item Name"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Description"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Quantity"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cost"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Profit %"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{children:o[t].map((s,r)=>e.jsxs("tr",{className:"group relative border-none !border-b-1 px-4 !py-2 transition-all duration-150 hover:bg-gray-50",children:[e.jsx("td",{className:"p-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{value:s.itemName||"",placeholder:"Item Name",onChange:c=>k(t,r,"itemName",c.target.value),className:"w-full px-2 py-1 text-center outline-none"})}),e.jsx("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{value:s.description,placeholder:"description",onChange:c=>k(t,r,"description",c.target.value),className:"w-full px-2 py-1 text-center outline-none"})}),e.jsx("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",placeholder:"enter quantity",value:s.quantity||"",onChange:c=>{Number(c.target.value)>=0&&k(t,r,"quantity",Math.max(0,Number(c.target.value)))},className:"w-full px-2 py-1 text-center outline-none"})}),e.jsx("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",value:s.cost||"",placeholder:"enter cost",onChange:c=>k(t,r,"cost",Math.max(0,Number(c.target.value))),className:"w-full px-2 py-1 text-center outline-none"})}),e.jsx("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",placeholder:"enter profit",value:(s.profitOnMaterial??0)||"",onChange:c=>k(t,r,"profitOnMaterial",Math.max(0,Number(c.target.value))),className:"w-full px-2 py-1 text-center outline-none"})}),e.jsxs("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:["₹",s.rowTotal.toLocaleString("en-IN",{minimumFractionDigits:0,maximumFractionDigits:2})]}),e.jsx("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx(A,{variant:"danger",onClick:()=>{const c=[...o[t]];c.splice(r,1);const p={...o,[t]:c};p.totals=O(p),h&&h(p)},className:"px-1 text-xs bg-red-600 text-white",children:"Remove"})})]},r))})]})}),e.jsx("div",{className:"mt-2 text-right",children:e.jsxs(A,{onClick:()=>{const s=[...o[t],be()],r={...o,[t]:s};r.totals=O(r),h&&h(r)},children:["+ Add ",d," Item"]})})]})};return e.jsxs("div",{className:"shadow-md p-4 my-4 border rounded-lg bg-white",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-700",children:["Product: ",o.furnitureName]}),u&&e.jsx(A,{variant:"danger",size:"sm",onClick:u,className:"bg-red-600 text-white",children:"Remove Product"})]}),g(),v("Fittings","fittingsAndAccessories"),v("Glues","glues"),v("Non-Branded Materials","nonBrandMaterials"),e.jsxs("div",{className:"mt-6 flex flex-wrap items-center justify-end gap-4 border-t pt-4",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-orange-50 px-3 py-1 rounded-lg border border-orange-100 shadow-sm",children:[e.jsx("label",{className:"text-[11px] font-bold text-orange-600 uppercase tracking-tight",children:"Fabrication Cost"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-orange-600 mr-1 text-sm",children:"₹"}),e.jsx("input",{type:"number",className:"w-20 text-right font-bold bg-transparent outline-none text-orange-800",value:o.fabricationCost??"",placeholder:"0",onChange:d=>L(o.furnitureProfit||0,Math.max(0,Number(d.target.value)),!1)})]})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-blue-50 px-3 py-1 rounded-lg border border-blue-100 shadow-sm",children:[e.jsx("label",{className:"text-[11px] font-bold text-blue-600 uppercase tracking-tight",children:"Product Profit Overlay"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"number",className:"w-12 text-right font-bold bg-transparent outline-none text-blue-800",value:o.furnitureProfit??"",placeholder:"0",onChange:d=>L(Math.max(0,Number(d.target.value)),o.fabricationCost||0,!0)}),e.jsx("span",{className:"text-blue-600 font-bold ml-1 text-sm",children:"%"})]})]}),e.jsxs("div",{className:"text-right text-xl text-green-700 font-bold ml-4",children:["Product Total: ₹",Math.round(o.totals.furnitureTotal).toLocaleString("en-IN")]})]})]})},Ze=()=>{var se,ne;const o=Ae(),{organizationId:B,id:I,quoteType:h}=ke(),{data:u,isLoading:O}=Be({organizationId:B,id:I});S.useEffect(()=>{if((h==="null"||h===null||h==="residential"||h==="basic")&&u!=null&&u.furnitures&&Array.isArray(u.furnitures)){const a=u.furnitures.map(n=>({...n,coreMaterials:n.coreMaterials.map(i=>({...i,innerLaminate:i.innerLaminate||{quantity:0,thickness:0},outerLaminate:i.outerLaminate||{quantity:0,thickness:0}})),totals:{core:n.coreMaterialsTotal||0,fittings:n.fittingsAndAccessoriesTotal||0,glues:n.gluesTotal||0,nbms:n.nonBrandMaterialsTotal||0,furnitureTotal:n.furnitureTotal||0}}));v(a)}},[u]);const[j,_]=S.useState(0),[L,k]=S.useState(0);S.useEffect(()=>{u&&(_((u==null?void 0:u.globalTransportation)||0),k((u==null?void 0:u.globalProfitPercent)||0),y((u==null?void 0:u.commonProfitOverride)||0))},[u]);const[g,v]=S.useState([]),[d,t]=S.useState(!1),[l,s]=S.useState(""),[r,c]=S.useState([]),[p,y]=S.useState(0);S.useEffect(()=>{u!=null&&u.commonMaterials&&c(u.commonMaterials)},[u]);const N=a=>{y(a),c(n=>n.map(i=>({...i,profitOnMaterial:0})))},f=()=>g.reduce((n,i)=>n+i.coreMaterials.length+i.fittingsAndAccessories.length+i.glues.length+i.nonBrandMaterials.length,0)+r.length,M=(a,n,i)=>{const m=[...r];m[a]={...m[a],[n]:i};const Q=(Number(m[a].quantity)||0)*(Number(m[a].cost)||0),x=1+(Number(m[a].profitOnMaterial)||0)/100,D=1+L/100;m[a].rowTotal=Q*x*D,a===m.length-1&&(m[a].itemName||m[a].cost)&&m.push($()),c(m)},q=a=>{c(n=>n.filter((i,m)=>m!==a))},b=()=>e.jsx("div",{className:"overflow-x-auto rounded-md",children:e.jsxs("table",{className:"min-w-full text-sm bg-white shadow-sm",children:[e.jsx("thead",{className:"bg-blue-50 text-sm font-semibold text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Item Name"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Description"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Quantity"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Cost"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Profit %"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{children:(r.length>0?r:[$()]).map((a,n)=>{var i;return e.jsxs("tr",{className:"hover:bg-gray-50 border-b border-gray-100",children:[e.jsx("td",{className:"p-2 border-r border-gray-100",children:e.jsx("input",{value:a.itemName||"",onChange:m=>M(n,"itemName",m.target.value),className:"w-full text-center outline-none bg-transparent",placeholder:"e.g. Screws"})}),e.jsx("td",{className:"p-2 border-r border-gray-100",children:e.jsx("input",{value:a.description||"",onChange:m=>M(n,"description",m.target.value),className:"w-full text-center outline-none bg-transparent",placeholder:"details"})}),e.jsx("td",{className:"p-2 border-r border-gray-100",children:e.jsx("input",{type:"number",value:a.quantity||"",onChange:m=>M(n,"quantity",Number(m.target.value)),className:"w-full text-center outline-none bg-transparent"})}),e.jsx("td",{className:"p-2 border-r border-gray-100",children:e.jsx("input",{type:"number",value:a.cost||"",onChange:m=>M(n,"cost",Number(m.target.value)),className:"w-full text-center outline-none bg-transparent"})}),e.jsx("td",{className:"p-2 border-r border-gray-100",children:e.jsx("input",{type:"number",value:a.profitOnMaterial||"",onChange:m=>M(n,"profitOnMaterial",Number(m.target.value)),className:"w-full text-center outline-none bg-transparent",placeholder:"0"})}),e.jsxs("td",{className:"p-2 border-r border-gray-100 font-bold text-gray-700 text-center",children:["₹",(i=a.rowTotal)==null?void 0:i.toLocaleString("en-IN",{maximumFractionDigits:2})]}),e.jsx("td",{className:"p-2 text-center",children:e.jsx(A,{variant:"danger",size:"sm",onClick:()=>q(n),children:"Remove"})})]},n)})})]})}),{role:T,permission:C}=qe(),R=T==="owner"||((se=C==null?void 0:C.internalquote)==null?void 0:se.create),F=T==="owner"||((ne=C==null?void 0:C.internalquote)==null?void 0:ne.edit),[re,Ne]=S.useState({categoryId:"",categoryName:""});let{data:W=0}=De({organizationId:B,categoryId:re.categoryId}),{data:z=[]}=Qe(B);S.useEffect(()=>{if(z&&(z==null?void 0:z.length)>0&&!re.categoryId){const a=z[0];Ne({categoryId:a._id,categoryName:a.name})}},[z]),S.useEffect(()=>{const a=f(),n=a>0?j/a:0;v(Q=>Q.map(x=>{if(x.coreMaterials.length===0)return x;const D=L??(x.furnitureProfit||0),E=1+D/100,V=x.coreMaterials[0],H=(V.carpenters||0)*(V.days||0)*W*(1+(V.profitOnLabour||0)/100)/x.coreMaterials.length,U=x.coreMaterials.map(w=>{var he,fe,ye;const P=(((he=w.plywoodNos)==null?void 0:he.quantity)||0)*K.plywood,G=(((fe=w.innerLaminate)==null?void 0:fe.quantity)||0)*K.innerLaminate,Z=(((ye=w.outerLaminate)==null?void 0:ye.quantity)||0)*K.outerLaminate,Oe=(P+G+Z)*(1+(w.profitOnMaterial||0)/100);return{...w,rowTotal:(Oe+H)*E+n}}),Se=U.reduce((w,P)=>w+P.rowTotal,0),ie=U.length>0?Se/U.length:0,X=(w,P=!1)=>w.map(G=>{if(P)return{...G,rowTotal:ie+n};const Z=P?ie:(G.quantity||0)*(G.cost||0),ge=1+(G.profitOnMaterial||0)/100;return{...G,rowTotal:Z*ge*E+n}}),le=X(x.fittingsAndAccessories),ce=X(x.glues,!0),me=X(x.nonBrandMaterials),de=U.reduce((w,P)=>w+P.rowTotal,0),xe=le.reduce((w,P)=>w+P.rowTotal,0),ue=ce.reduce((w,P)=>w+P.rowTotal,0),pe=me.reduce((w,P)=>w+P.rowTotal,0);return{...x,furnitureProfit:D,coreMaterials:U,fittingsAndAccessories:le,glues:ce,nonBrandMaterials:me,totals:{core:Math.round(de),fittings:Math.round(xe),glues:Math.round(ue),nbms:Math.round(pe),furnitureTotal:Math.round(de+xe+ue+pe)}}}));const m=1+(p??L)/100;c(Q=>Q.map(x=>{const D=(x.quantity||0)*(x.cost||0),E=1+(x.profitOnMaterial||0)/100;return{...x,rowTotal:D*E*m+n}}))},[j,L,W,p]);const{mutateAsync:je,isPending:ve}=Re(),we=(g==null?void 0:g.reduce((a,n)=>{var i;return a+(((i=n==null?void 0:n.totals)==null?void 0:i.furnitureTotal)||0)},0))||0,Me=(r==null?void 0:r.reduce((a,n)=>a+((n==null?void 0:n.rowTotal)||0),0))||0,J=(g==null?void 0:g.length)>0?we+Me:0,Ce=async()=>{var a,n;try{if(!u.projectId){ee({title:"Error",description:"Please select a project",variant:"destructive"});return}const i=new FormData,m=g.map((x,D)=>{const E=x.coreMaterials.map((V,oe)=>{const{previewUrl:Le,newImageFile:H,...U}=V;return H&&i.append(`images[${D}][${oe}]`,H),{...U,imageUrl:V.imageUrl||null}});return{furnitureName:x.furnitureName,furnitureProfit:x.furnitureProfit,coreMaterials:E,fittingsAndAccessories:te(x.fittingsAndAccessories),glues:te(x.glues),nonBrandMaterials:te(x.nonBrandMaterials),coreMaterialsTotal:x.totals.core,fittingsAndAccessoriesTotal:x.totals.fittings,gluesTotal:x.totals.glues,nonBrandMaterialsTotal:x.totals.nbms,furnitureTotal:x.totals.furnitureTotal}}),Q=r.filter(x=>x.itemName||x.cost>0);i.append("furnitures",JSON.stringify(m)),i.append("commonMaterials",JSON.stringify(Q)),i.append("commonProfitOverride",p.toString()),i.append("grandTotal",J.toString()),i.append("notes","Updated via frontend"),i.append("globalTransportation",j.toString()),i.append("globalProfitPercent",L.toString()),await je({organizationId:B,projectId:u.projectId,formData:i,id:I}),ee({title:"Updated!",description:"Quote edited successfully."})}catch(i){ee({title:"Error",description:((n=(a=i==null?void 0:i.response)==null?void 0:a.data)==null?void 0:n.message)||(i==null?void 0:i.message)||"Failed to Update the Quote",variant:"destructive"})}},ae=a=>{v(n=>[...n,{furnitureName:a,coreMaterials:[Pe()],fittingsAndAccessories:[$()],glues:[$()],nonBrandMaterials:[$()],totals:{core:0,fittings:0,glues:0,nbms:0,furnitureTotal:0}}])},Te=a=>{v(n=>n.filter((i,m)=>m!==a))},Pe=()=>({itemName:"",plywoodNos:{quantity:0,thickness:0},innerLaminate:{quantity:0,thickness:0},outerLaminate:{quantity:0,thickness:0},carpenters:0,days:0,profitOnMaterial:0,profitOnLabour:0,rowTotal:0,remarks:""}),$=()=>({itemName:"",description:"",quantity:0,cost:0,rowTotal:0});return O?e.jsx(Ie,{}):e.jsxs("div",{className:"max-h-full overflow-y-auto",children:[e.jsxs("header",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 py-1 border-b-1 border-[#818283]",children:[e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsx("button",{onClick:()=>o(-1),className:"bg-gray-50 cursor-pointer hover:bg-gray-100 shadow-sm flex items-center justify-center w-10 h-10 border border-gray-200 text-gray-600 rounded-lg transition-all",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-file mr-3 text-blue-600"}),u.mainQuoteName||"Internal Quote"]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-6",children:[(g==null?void 0:g.length)>0&&e.jsxs("div",{className:"flex items-center gap-10",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 tracking-wide",children:"Single Labour Cost"}),e.jsxs("p",{className:"text-[15px] font-semibold text-gray-900",children:["₹",W==null?void 0:W.toLocaleString("en-IN")]})]}),e.jsx("div",{className:"h-8 w-px bg-gray-300"}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-widest",children:"Grand Total"}),e.jsxs("p",{className:"text-xl font-bold text-green-600",children:["₹",J==null?void 0:J.toLocaleString("en-IN")]})]})]}),R&&e.jsxs(A,{className:"flex items-center",onClick:()=>t(!0),children:[e.jsx("i",{className:"fas fa-add mr-1"}),"Create Product"]})]})]}),d&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 bg-opacity-40 backdrop-blur-sm transition",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg p-6 w-full max-w-md relative animate-scaleIn",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-800",children:"Add New Quote"}),e.jsx("input",{className:"w-full border border-gray-300 rounded px-3 py-2 mb-4 outline-none focus:ring-2 focus:ring-blue-400",placeholder:"Enter Product Name",value:l,autoFocus:!0,onChange:a=>s(a.target.value),onKeyDown:a=>{if(a.key==="Enter"){if(!l.trim())return;ae(l),s(""),t(!1)}}}),e.jsxs("div",{className:"flex justify-end gap-3 mt-4",children:[e.jsx(A,{variant:"secondary",onClick:()=>t(!1),children:"Cancel"}),e.jsx(A,{onClick:()=>{l.trim()&&(ae(l),s(""),t(!1))},children:"Create"})]})]})}),(g==null?void 0:g.length)===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[300px] w-full bg-white rounded-xl   text-center p-6",children:[e.jsx("i",{className:"fas fa-box-open text-5xl text-blue-300 mb-4"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Cick on the Create button to start creating the quote",e.jsx("br",{}),e.jsxs(A,{onClick:()=>t(!0),className:"mx-4 my-2",children:[e.jsx("i",{className:"fas fa-plus mr-1 "}),"Create Product"]})]})]}),(g==null?void 0:g.length)>0&&e.jsx("section",{className:"shadow overflow-y-auto max-h-[86%]",children:g==null?void 0:g.map((a,n)=>e.jsx(Ue,{index:n,labourCost:W,data:a,updateFurniture:i=>{const m=[...g];m[n]=i,v(m)},removeFurniture:()=>Te(n),isEditing:!0},n))}),g.length>0&&e.jsxs("div",{className:"bg-gray-50 p-6 rounded-xl border border-gray-200 mt-8 mb-6 shadow-inner",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-800 flex items-center",children:[e.jsx("i",{className:"fas fa-boxes mr-3 text-orange-500"}),"General/Common Site Materials - Total: ₹",r.reduce((a,n)=>a+(n.rowTotal||0),0).toLocaleString("en-IN",{maximumFractionDigits:2})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-orange-50 px-3 py-1 rounded-lg border border-orange-100 shadow-sm",children:[e.jsx("label",{className:"text-[11px] font-bold text-orange-600 uppercase tracking-tight",children:"Common Profit Overlay"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"number",className:"w-12 text-right font-bold bg-transparent outline-none text-orange-800",value:p??L,placeholder:"0",onKeyDown:a=>{(a.key==="-"||a.key==="e")&&a.preventDefault()},onChange:a=>{const n=a.target.value===""?0:parseFloat(a.target.value);N(n)}}),e.jsx("span",{className:"text-orange-600 font-bold ml-1 text-sm",children:"%"})]})]}),e.jsxs("div",{className:"text-right text-xl text-green-700 font-bold",children:["Total: ₹",r.reduce((a,n)=>a+(n.rowTotal||0),0).toLocaleString("en-IN",{maximumFractionDigits:2})]})]})]}),b(),e.jsx("div",{className:"mt-3 text-right",children:e.jsx(A,{onClick:()=>c([...r,$()]),variant:"secondary",size:"sm",children:"+ Add Common Item"})})]}),g.length!==0&&e.jsxs("div",{className:"flex items-center justify-between gap-4 bg-white border border-blue-100 p-3 rounded-xl shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-[9px] font-extrabold text-blue-500 uppercase tracking-tighter",children:"Transport Cost"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-gray-400 mr-1 text-sm",children:"₹"}),e.jsx("input",{type:"number",className:"w-20 font-semibold focus:outline-none text-gray-800",value:j,onChange:a=>_(Math.max(0,Number(a.target.value)))})]})]}),e.jsx("div",{className:"h-8 w-px bg-gray-100"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-[9px] font-extrabold text-green-500 uppercase tracking-tighter",children:"Global Profit Margin"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"number",className:"w-12 text-right font-semibold focus:outline-none text-gray-800",value:L,onChange:a=>{k(Math.max(0,Number(a.target.value))),y(Math.max(0,Number(a.target.value))),v(n=>n.map(i=>({...i,furnitureProfit:0,coreMaterials:i.coreMaterials.map(m=>({...m,profitOnMaterial:0,profitOnLabour:0})),fittingsAndAccessories:i.fittingsAndAccessories.map(m=>({...m,profitOnMaterial:0})),nonBrandMaterials:i.nonBrandMaterials.map(m=>({...m,profitOnMaterial:0}))}))),c(n=>n.map(i=>({...i,profitOnMaterial:0})))}}),e.jsx("span",{className:"text-gray-400 ml-1 text-sm",children:"%"})]})]})]}),e.jsx("div",{className:"mt-1 text-right flex gap-2 justify-end",children:(R||F)&&e.jsx(A,{variant:"primary",isLoading:ve,onClick:Ce,className:"px-6 py-2 bg-blue-600 text-white rounded",children:"Save Quote"})})]})]})};export{Ze as default};
