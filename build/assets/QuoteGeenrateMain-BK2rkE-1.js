import{j as e,B as b,y as O,Q as U,U as _,V as F,C as X,a as Z,H as ee,I as te,t as C,u as B,r as v,g as R,M as ae,N as se,S as re,i as ne,k as oe,l as le,m as ie}from"./index-BbUIXOOD.js";import{d as ce,e as de}from"./quoteVariantApi-CoNtxHsg.js";const L={plywood:1,laminate:1},xe=()=>({itemName:"",plywoodNos:{quantity:0,thickness:0},laminateNos:{quantity:0,thickness:0},carpenters:0,days:0,profitOnMaterial:0,profitOnLabour:0,rowTotal:0,remarks:""}),E=()=>({itemName:"",description:"",quantity:0,cost:0,rowTotal:0}),Q=(t,p)=>{if(t.length===0)return[];const d=t.length,y=t[0],c=y.carpenters*y.days*p*(1+(y.profitOnLabour||0)/100)/d;return t.map(f=>{var r,l;const j=((r=f.plywoodNos)==null?void 0:r.quantity)||0,o=((l=f.laminateNos)==null?void 0:l.quantity)||0,a=(j*L.plywood+o*L.laminate)*(1+(f.profitOnMaterial||0)/100);return{...f,rowTotal:Math.round(a+c)}})},me=({data:t,labourCost:p,updateFurniture:d,removeFurniture:y})=>{const m=o=>{const a=o.coreMaterials.reduce((s,i)=>s+i.rowTotal,0),r=o.fittingsAndAccessories.reduce((s,i)=>s+i.rowTotal,0),l=o.glues.reduce((s,i)=>s+i.rowTotal,0),n=o.nonBrandMaterials.reduce((s,i)=>s+i.rowTotal,0);return{core:a,fittings:r,glues:l,nbms:n,furnitureTotal:a+r+l+n}},g=(o,a,r)=>{const l=[...t.coreMaterials];a==="imageUrl"?(l[o].imageUrl=r,l[o].previewUrl=URL.createObjectURL(r)):a==="plywoodNos"||a==="laminateNos"?l[o][a]={...l[o][a]||{},...r}:l[o][a]=r;const n=Q(l,p),s={...t,coreMaterials:n};s.totals=m(s),d==null||d(s)},c=(o,a,r,l)=>{const n=[...t[o]];n[a][r]=l,o!=="glues"?n[a].rowTotal=n[a].quantity*n[a].cost:n[a].rowTotal=n[a].cost;const s=a===n.length-1,i=n[a].itemName||n[a].description||n[a].quantity||n[a].cost;s&&i&&n.push(E());const w={...t,[o]:n};w.totals=m(w),d&&d(w)},f=()=>e.jsxs("div",{className:"mt-4",children:[e.jsxs("h3",{className:"font-semibold text-md mb-2",children:["Core Materials - Total: ₹",t==null?void 0:t.totals.core.toLocaleString("en-IN")]}),e.jsx("div",{className:"overflow-x-auto  rounded-md",children:e.jsxs("table",{className:"min-w-full text-sm bg-white shadow-sm",children:[e.jsxs("thead",{className:"bg-blue-50 text-sm font-semibold text-gray-600",children:[e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Image"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Item Name"}),e.jsx("th",{className:"text-center px-6 py-1 text-xs font-medium text-gray-500 uppercase tracking-wider",colSpan:2,children:"Plywood"}),e.jsx("th",{className:"text-center px-6 py-1 text-xs font-medium text-gray-500 uppercase tracking-wider",colSpan:2,children:"Laminate"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"No. of Carpenters / Day"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"No. of Days"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Profit % Material"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Profit % Labour"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Remarks"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Total"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Actions"})]}),e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-6 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Qty"}),e.jsx("th",{className:"text-center px-6 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Thk"}),e.jsx("th",{className:"text-center px-6 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Qty"}),e.jsx("th",{className:"text-center px-6 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Thk"})]})]}),e.jsx("tbody",{children:t.coreMaterials.map((o,a)=>e.jsxs("tr",{className:"group relative border-none !border-b-1 px-4 py-2 transition-all duration-150 hover:bg-gray-50",children:[a===0&&e.jsxs("td",{rowSpan:t.coreMaterials.length,children:[e.jsx("input",{type:"file",className:"w-full px-2 py-3 text-center outline-none",onChange:r=>{var l;return g(0,"imageUrl",(l=r.target.files)==null?void 0:l[0])}}),o.previewUrl&&e.jsx("img",{src:o.previewUrl,className:"h-10 mt-2 mx-auto"})]}),e.jsx("td",{className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{value:o.itemName,placeholder:"TV Unit | Wardrobe",onChange:r=>g(a,"itemName",r.target.value),className:"w-full px-2 py-1 text-center outline-none"})}),["plywoodNos","laminateNos"].map(r=>["quantity","thickness"].map(l=>e.jsx("td",{className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",value:o[r][l],onChange:n=>{Number(n.target.value)>=0&&g(a,r,{...o[r],[l]:Number(n.target.value)})},className:"w-full px-2 py-1 text-center outline-none"})},`${r}-${l}`))),a===0&&e.jsxs(e.Fragment,{children:[e.jsx("td",{rowSpan:t.coreMaterials.length,className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",value:o.carpenters,onChange:r=>g(a,"carpenters",Number(r.target.value)),className:"w-full px-2 py-1 text-center outline-none"})}),e.jsx("td",{rowSpan:t.coreMaterials.length,className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",value:o.days,onChange:r=>g(a,"days",Number(r.target.value)),className:"w-full px-2 py-1 text-center outline-none"})})]}),e.jsx("td",{className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",value:o.profitOnMaterial,onChange:r=>g(a,"profitOnMaterial",Number(r.target.value)),className:"w-full px-2 py-1 text-center outline-none"})}),a===0&&e.jsx(e.Fragment,{children:e.jsx("td",{rowSpan:t.coreMaterials.length,className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",value:o.profitOnLabour,onChange:r=>g(a,"profitOnLabour",Number(r.target.value)),className:"w-full px-2 py-1 text-center outline-none"})})}),e.jsx("td",{className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{value:o.remarks,placeholder:"remarks",onChange:r=>g(a,"remarks",r.target.value),className:"w-full px-2 py-1 text-center outline-none"})}),e.jsxs("td",{className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:["₹",o.rowTotal.toLocaleString("en-IN")]}),e.jsx("td",{className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx(b,{variant:"danger",onClick:()=>{const r=[...t.coreMaterials];r.splice(a,1);const l=Q(r,p),n={...t,coreMaterials:l};n.totals=m(n),d==null||d(n)},className:"px-1 text-xs bg-red-600 text-white",children:"Remove"})})]},a))})]})}),e.jsx("div",{className:"mt-2 text-right",children:e.jsx(b,{onClick:()=>{const o=[...t.coreMaterials,xe()],a=Q(o,p),r={...t,coreMaterials:a};r.totals=m(r),d==null||d(r)},children:"+ Add Core Material"})})]}),j=(o,a)=>{var r;return e.jsxs("div",{className:"mt-6",children:[e.jsxs("h3",{className:"font-semibold text-md mb-2",children:[o," - Total: ₹",(r=t==null?void 0:t.totals[a==="fittingsAndAccessories"?"fittings":a])==null?void 0:r.toLocaleString("en-IN")]}),e.jsx("div",{className:"overflow-x-auto  rounded-md",children:e.jsxs("table",{className:"min-w-full text-sm bg-white shadow-sm",children:[e.jsx("thead",{className:"bg-blue-50 text-sm font-semibold text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Item Name"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Description"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Quantity"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cost"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{children:t[a].map((l,n)=>e.jsxs("tr",{className:"group relative border-none !border-b-1 px-4 !py-2 transition-all duration-150 hover:bg-gray-50",children:[e.jsx("td",{className:"p-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{value:l.itemName||"",placeholder:"Item Name",onChange:s=>c(a,n,"itemName",s.target.value),className:"w-full px-2 py-1 text-center outline-none"})}),e.jsx("td",{className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{value:l.description,placeholder:"description",onChange:s=>c(a,n,"description",s.target.value),className:"w-full px-2 py-1 text-center outline-none"})}),e.jsx("td",{className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",value:l.quantity,onChange:s=>{Number(s.target.value)>=0&&c(a,n,"quantity",Number(s.target.value))},className:"w-full px-2 py-1 text-center outline-none"})}),e.jsx("td",{className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",value:l.cost,onChange:s=>c(a,n,"cost",Number(s.target.value)),className:"w-full px-2 py-1 text-center outline-none"})}),e.jsxs("td",{className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:["₹",l.rowTotal.toLocaleString("en-IN")]}),e.jsx("td",{className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx(b,{variant:"danger",onClick:()=>{const s=[...t[a]];s.splice(n,1);const i={...t,[a]:s};i.totals=m(i),d&&d(i)},className:"px-1 text-xs bg-red-600 text-white",children:"Remove"})})]},n))})]})}),e.jsx("div",{className:"mt-2 text-right",children:e.jsxs(b,{onClick:()=>{const l=[...t[a],E()],n={...t,[a]:l};n.totals=m(n),d&&d(n)},children:["+ Add ",o," Item"]})})]})};return e.jsxs("div",{className:"shadow-md p-4 my-4 border rounded-lg bg-white",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-700",children:["Product: ",t.furnitureName]}),y&&e.jsx(b,{variant:"danger",size:"sm",onClick:y,className:"bg-red-600 text-white",children:"Remove Product"})]}),f(),j("Fittings","fittingsAndAccessories"),j("Glues","glues"),j("Non-Branded Materials","nonBrandMaterials"),e.jsxs("div",{className:"mt-6 text-right text-xl text-green-700 font-bold",children:["Product Total: ₹",t.totals.furnitureTotal.toLocaleString("en-IN")]})]})},ue=async({api:t,organizationId:p,projectId:d,formData:y})=>{const{data:m}=await t.post(`/quote/quotegenerate/createquote/${p}/${d}`,y,{headers:{"Content-Type":"multipart/form-data"}});if(!m.ok)throw new Error(m.message||"Failed to create quote.");return m.data},pe=async({api:t,organizationId:p,id:d,projectId:y,formData:m})=>{const g=await t.put(`/quote/quotegenerate/editquote/${p}/${y}/${d}`,m);if(!g.data.ok)throw new Error(g.data.message||"Failed to create quote.");return g.data.data},ge=()=>{const t=["owner","staff","CTO"],{role:p}=O(),d=F(p);return U({mutationFn:async({organizationId:y,projectId:m,formData:g})=>{if(!p||!t.includes(p))throw new Error("Not allowed to create quotes");if(!d)throw new Error("API instance for role not found");return await ue({api:d,organizationId:y,projectId:m,formData:g})},onSuccess:(y,{organizationId:m})=>{_.invalidateQueries({queryKey:["quote-material-items",m]})}})},he=()=>{const t=["owner","staff","CTO"],{role:p}=O(),d=F(p);return U({mutationFn:async({organizationId:y,projectId:m,formData:g,id:c})=>{if(!p||!t.includes(p))throw new Error("Not allowed to create quotes");if(!d)throw new Error("API instance for role not found");return await pe({api:d,organizationId:y,projectId:m,formData:g,id:c})},onSuccess:(y,{organizationId:m})=>{_.invalidateQueries({queryKey:["quote-material-items",m]})}})},ye=({quote:t,organizationId:p,setFurnitures:d,setIsEditingId:y,setQuoteType:m,setEditQuoteNo:g,setFiltersMain:c})=>{var a,r;const{mutateAsync:f,isPending:j}=ce(),o=async l=>{var n,s;try{await f({id:l,organizationId:p}),C({title:"Success",description:"Items deleted successfully"})}catch(i){C({title:"Error",description:((s=(n=i==null?void 0:i.response)==null?void 0:n.data)==null?void 0:s.message)??"Operation failed"})}};return e.jsx(X,{className:"w-full border-l-4 border-blue-600 shadow-md bg-white hover:shadow-lg transition-all",children:e.jsxs(Z,{className:"p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"my-1",children:[e.jsxs("h3",{className:"text-base font-bold text-blue-700 leading-[8px] ",children:["Project: ",e.jsx("span",{className:"text-black",children:((a=t==null?void 0:t.projectId)==null?void 0:a.projectName)||"Project"})]}),e.jsxs("span",{className:"text-[12px] font-semibold text-gray-500",children:["Quote No: ",e.jsx("span",{className:"text-black",children:t.quoteNo||"N/A"})]})]}),e.jsxs("p",{className:"text-xs text-gray-500 ",children:["Created on: ",ee(t.createdAt)," -  ",te(t.createdAt)]})]}),e.jsx("i",{className:"fas fa-file-alt text-gray-400 text-xl"})]}),e.jsxs("p",{className:"text-sm text-gray-500 italic",children:[e.jsx("strong",{children:"Furnitures: "})," ",((r=t.furnitures)==null?void 0:r.length)||0]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsxs(b,{size:"sm",variant:"secondary",onClick:()=>{const{furnitures:l}=t,n=l.map(s=>({furnitureName:s.furnitureName,coreMaterials:s.coreMaterials.map(i=>({itemName:(i==null?void 0:i.itemName)||"",plywoodNos:(i==null?void 0:i.plywoodNos)||{quantity:0,thickness:0},laminateNos:i.laminateNos||{quantity:0,thickness:0},carpenters:i.carpenters||0,days:i.days||0,profitOnMaterial:i.profitOnMaterial||0,profitOnLabour:i.profitOnLabour||0,rowTotal:i.rowTotal||0,remarks:i.remarks||"",imageUrl:i.imageUrl||"",previewUrl:i.imageUrl||""})),fittingsAndAccessories:s.fittingsAndAccessories||[],glues:s.glues||[],nonBrandMaterials:s.nonBrandMaterials||[],totals:{core:s.coreMaterialsTotal||0,fittings:s.fittingsAndAccessoriesTotal||0,glues:s.gluesTotal||0,nbms:s.nonBrandMaterialsTotal||0,furnitureTotal:s.furnitureTotal||0}}));console.log("parsedFurniture",n),g(t==null?void 0:t.quoteNo),d(n),y(t._id),m(()=>{var s;return((s=t==null?void 0:t.furnitures)==null?void 0:s.length)>1?"residential":"single"}),c({projectId:t.projectId._id,projectName:t.projectId.projectName})},children:[e.jsx("i",{className:"fas fa-eye mr-1"})," Edit"]}),e.jsxs(b,{size:"sm",isLoading:j,variant:"danger",className:"bg-red-600 text-white",onClick:()=>o(t._id),children:[e.jsx("i",{className:"fas fa-trash mr-1"})," Delete"]})]})]})})},fe=({setFurnitures:t,setEditQuoteNo:p,setIsEditingId:d,setFiltersMain:y,setQuoteType:m})=>{const{organizationId:g}=B(),[c,f]=v.useState({projectId:"",projectName:"",createdAt:""}),{data:j}=R(g),o=j==null?void 0:j.map(s=>({_id:s._id,projectName:s.projectName})),{data:a,isLoading:r}=de(g,{createdAt:c.createdAt,projectId:c.projectId,quoteNo:""}),l=()=>{f({projectId:"",projectName:"",createdAt:""})},n=Object.values(c).filter(Boolean).length;return e.jsx("div",{children:e.jsxs("main",{className:"flex gap-2 !max-h-[80vh]",children:[e.jsx("div",{className:"xl:w-80 flex-shrink-0",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-filter mr-2 text-blue-600"}),"Filters"]}),n>0&&e.jsxs("button",{onClick:l,className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:["Clear All (",n,")"]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Created Date"}),e.jsx("input",{type:"date",onChange:s=>f(i=>({...i,createdAt:s.target.value})),value:c.createdAt,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Project"}),e.jsx("select",{value:(c==null?void 0:c.projectId)||"",onChange:s=>{const i=o==null?void 0:o.find(w=>w._id===s.target.value);i&&f(w=>({...w,projectId:i._id,projectName:i.projectName}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:o==null?void 0:o.map(s=>e.jsx("option",{value:s._id,children:s.projectName},s._id))})]})]})]})}),e.jsx("section",{className:"w-full max-h-full  gap-2  overflow-y-auto  min-h-full",children:r?e.jsx("p",{children:e.jsx(ae,{})}):a!=null&&a.length?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:a.map(s=>e.jsx(e.Fragment,{children:e.jsx(ye,{setEditQuoteNo:p,setFurnitures:t,setIsEditingId:d,setQuoteType:m,setFiltersMain:y,quote:s,organizationId:g},s._id)}))}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center text-gray-700",children:[e.jsx("i",{className:"fas fa-file-circle-exclamation text-gray-300 text-7xl mb-4"}),e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"No Quotes Found"}),e.jsxs("p",{className:"text-base text-gray-500 leading-relaxed max-w-md",children:["You haven't generated any quote variants yet.",e.jsx("br",{}),"Please create a quote by clicking the + Product section to view brand-wise breakdowns here."]})]})})]})})},be=()=>{const{organizationId:t}=B(),{data:p}=R(t);let{data:d=0}=se(t);const y=v.useMemo(()=>(p==null?void 0:p.map(x=>({_id:x._id,projectName:x.projectName})))||[],[p]),[m,g]=v.useState({projectId:"",projectName:""}),[c,f]=v.useState([]),[j,o]=v.useState(!1),[a,r]=v.useState(""),[l,n]=v.useState(null),[s,i]=v.useState(null),[w,P]=v.useState(null),{mutateAsync:q,isPending:G}=ge(),{mutateAsync:D,isPending:$}=he(),z=x=>{i(x)},V=()=>s==="single"?"Single Quote":s==="residential"?"Residential Quote":"";v.useEffect(()=>{s==="single"&&!l?(f([]),k("Common Category")):s==="residential"&&!l&&(f([]),o(!0))},[s]);const k=x=>{f(N=>[...N,{furnitureName:x,coreMaterials:[W()],fittingsAndAccessories:[A()],glues:[A()],nonBrandMaterials:[A()],totals:{core:0,fittings:0,glues:0,nbms:0,furnitureTotal:0}}])},K=x=>{f(N=>N.filter((h,u)=>u!==x))},W=()=>({itemName:"",plywoodNos:{quantity:0,thickness:0},laminateNos:{quantity:0,thickness:0},carpenters:0,days:0,profitOnMaterial:0,profitOnLabour:0,rowTotal:0,remarks:""}),A=()=>({itemName:"",description:"",quantity:0,cost:0,rowTotal:0}),I=c==null?void 0:c.reduce((x,N)=>x+N.totals.furnitureTotal,0),H=async()=>{var x,N;try{if(!m.projectId){C({title:"Error",description:"Please select a project",variant:"destructive"});return}const h=new FormData;h.append("furnitures",JSON.stringify(c.map(u=>({furnitureName:u.furnitureName,coreMaterials:u.coreMaterials.map(M=>{if(Object.values(M).some(S=>!!S)){const{imageUrl:S,previewUrl:T,...Y}=M;return Y}}),fittingsAndAccessories:u.fittingsAndAccessories,glues:u.glues,nonBrandMaterials:u.nonBrandMaterials,coreMaterialsTotal:u.totals.core,fittingsAndAccessoriesTotal:u.totals.fittings,gluesTotal:u.totals.glues,nonBrandMaterialsTotal:u.totals.nbms,furnitureTotal:u.totals.furnitureTotal})))),c.forEach((u,M)=>{u.coreMaterials.forEach((S,T)=>{S.imageUrl&&h.append(`images[${M}][${T}]`,S.imageUrl)})}),h.append("grandTotal",I.toString()),h.append("notes","Generated"),await q({organizationId:t,projectId:m.projectId,formData:h}),C({title:"Success",description:"Created Successfully, Visit in Quote Generator Section"}),f([]),i(null)}catch(h){C({title:"Error",description:((N=(x=h==null?void 0:h.response)==null?void 0:x.data)==null?void 0:N.message)||(h==null?void 0:h.message)||"failed to generate the items",variant:"destructive"})}},J=async()=>{var x,N;try{if(!m.projectId){C({title:"Error",description:"Please select a project",variant:"destructive"});return}const h={furnitures:c.map(u=>({furnitureName:u.furnitureName,coreMaterials:u.coreMaterials.map(M=>{const{previewUrl:S,...T}=M;return{...T,imageUrl:M.imageUrl||null}}),fittingsAndAccessories:u.fittingsAndAccessories,glues:u.glues,nonBrandMaterials:u.nonBrandMaterials,coreMaterialsTotal:u.totals.core,fittingsAndAccessoriesTotal:u.totals.fittings,gluesTotal:u.totals.glues,nonBrandMaterialsTotal:u.totals.nbms,furnitureTotal:u.totals.furnitureTotal})),grandTotal:I,notes:"Updated via frontend",quoteNo:w};l&&(await D({organizationId:t,projectId:m.projectId,formData:h,id:l}),C({title:"Updated!",description:"Quote edited successfully."}),f([]),i(null),n(null))}catch(h){C({title:"Error",description:((N=(x=h==null?void 0:h.response)==null?void 0:x.data)==null?void 0:N.message)||(h==null?void 0:h.message)||"Failed to Update the Quote",variant:"destructive"})}};return e.jsxs("div",{className:`h-full mx-auto max-h-full ${l?"overflow-y-auto":""} `,children:[e.jsxs("header",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 py-1 border-b-1 border-[#818283]",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-file mr-3 text-blue-600"}),"Internal Quote Entry"]}),(c==null?void 0:c.length)>0&&e.jsxs("p",{className:"ml-[30px] mt-[5px] block text-[15px] text-gray-800",children:["Single Labour cost:  ",e.jsxs("span",{className:"text-black font-semibold",children:["₹",d]})]})]}),e.jsxs("div",{className:"flex gap-6 items-center ",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Select QuoteType"}),e.jsxs(re,{onValueChange:x=>z(x),children:[e.jsx(ne,{className:"w-full",children:e.jsx(oe,{placeholder:"Select Quote",selectedValue:s||""})}),e.jsx(le,{children:["single","residential"].map(x=>e.jsx(ie,{value:x.toString(),children:x},x))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Select Project *"}),e.jsxs("select",{value:m.projectId,onChange:x=>{const N=y.find(h=>h._id===x.target.value);N&&g({projectId:N._id,projectName:N.projectName})},className:" px-2 py-2 rounded-xl border border-blue-200 focus:border-blue-200 active:border-blue-200",children:[e.jsx("option",{value:"",children:"Select a project"}),y.map(x=>e.jsx("option",{value:x._id,children:x.projectName},x._id))]})]}),c.length>0&&e.jsxs("div",{className:"text-right flex gap-2 items-center",children:[e.jsx("div",{className:"text-xs text-gray-600 uppercase tracking-widest",children:"Grand Total"}),e.jsxs("div",{className:"text-xl font-semibold text-green-600",children:["₹",I.toLocaleString("en-IN")]})]}),e.jsxs(b,{className:"flex items-center",onClick:()=>{o(!0)},children:[e.jsx("i",{className:"fas fa-add mr-1",children:" "})," Product"]})]})]}),j&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 bg-opacity-40 backdrop-blur-sm transition",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg p-6 w-full max-w-md relative animate-scaleIn",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-800",children:"Add New Product"}),e.jsx("input",{className:"w-full border border-gray-300 rounded px-3 py-2 mb-4 outline-none focus:ring-2 focus:ring-blue-400",placeholder:"Enter Product Name",value:a,autoFocus:!0,onChange:x=>r(x.target.value),onKeyDown:x=>{if(x.key==="Enter"){if(!a.trim())return;k(a),r(""),o(!1)}}}),e.jsxs("div",{className:"flex justify-end gap-3 mt-4",children:[e.jsx(b,{variant:"secondary",onClick:()=>o(!1),children:"Cancel"}),e.jsx(b,{onClick:()=>{a.trim()&&(k(a),r(""),o(!1))},children:"Create"})]})]})}),c.length>0&&e.jsxs("section",{className:"shadow overflow-y-auto max-h-[86%]",children:[!l&&e.jsx("h1",{className:"text-2xl text-gray-500",children:V()}),c.map((x,N)=>e.jsx(me,{index:N,labourCost:d,data:x,updateFurniture:h=>{const u=[...c];u[N]=h,f(u)},removeFurniture:()=>K(N)},N))]}),c.length!==0&&e.jsxs("div",{className:"mt-1 text-right flex gap-2 justify-end",children:[e.jsx(b,{variant:"primary",isLoading:G||$,onClick:l?J:H,className:"px-6 py-2 bg-blue-600 text-white rounded",children:"Save Quote"}),!l&&e.jsx(b,{variant:"secondary",onClick:()=>{f([]),i(null)},className:"",children:"Cancel"}),l&&e.jsx(b,{variant:"secondary",onClick:()=>{n(null),f([]),i(null),P(null)},className:"",children:"Cancel"})]}),!l&&(c==null?void 0:c.length)===0&&e.jsx("section",{className:"my-4",children:e.jsx(fe,{setEditQuoteNo:P,setIsEditingId:n,setFurnitures:f,setQuoteType:i,setFiltersMain:g})})]})};export{be as default};
