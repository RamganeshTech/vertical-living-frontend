import{r as I,a as $,u as K,w as re,p as W,o as Y,j as e,b as B,B as G,J as z,K as H,M as Q,N as V,P as J,Q as X,t as U,R as le}from"./index-Bp58Hj9Q.js";import{M as ce,e as de,C as D}from"./constants-BhfkdIAq.js";import{d as q}from"./CTOApi-C9SyHtEW.js";import{d as Z}from"./clientApi-Cf3XaYnc.js";import{d as ee}from"./staffApi-DeuI-xi0.js";import{d as se}from"./userApi-kG6_Jg6y.js";import{d as te}from"./workerApi-DgIpwhlP.js";import{u as ae}from"./stageSelectionApi-74MBz9SF.js";function fe(d,f){I.useEffect(()=>{const N=t=>{t.ctrlKey&&t.key==="]"?(t.preventDefault(),f()):t.ctrlKey&&t.key==="["&&(t.preventDefault(),d())};window.addEventListener("keydown",N)},[f,d])}const ue=(d,f,N,t,u)=>{const E=t==null?void 0:t.some(s=>s.toLowerCase()==="projectdetails");let x={},l={},o={};if(E){let s=["DOCUMENTATION","WORKERS","INVITECLIENT","PREREQUIRETIES","REQUIREMENTFORM","SITEMEASUREMENT","SAMPLEDESIGN","TECHNICALCONSULTANT","SELECTSTAGE","PAYMENTCONFIRMATION","ORDERMATERIALS","MATERIALARRIVED","WORKSCHEDULE","INSTALLATION","QUALITYCHECK","CLEANINGSANITATION","PROJECTDELIVERY"];const p=s.indexOf("TECHNICALCONSULTANT")+1;d==="Manual Flow"?s.splice(p,0,"MATERIALSELECTION","COSTESTIMATION"):d==="Modular Units"&&s.splice(p,0,"MODULARUNIT","EXTERNAL"),d!=null&&(s=s.filter(n=>n!=="SELECTSTAGE"));for(const n of s)f[n]&&u[n]&&N[n]&&(x[n]=f[n],l[n]=u[n],o[n]=N[n])}else x=f,l=u,o=N;let b=1,g=!1;const m={};for(const s of Object.keys(x))s==="REQUIREMENTFORM"&&(g=!0),g?(m[s]=`${b} ${x[s]}`,b++):m[s]=x[s];return{filteredLabels:m,filteredIcons:l,filteredPaths:o}},xe=({labels:d,icons:f,path:N})=>{const[t,u]=I.useState(!1),{projectId:E}=$(),x=K(),l=re(),o=l.pathname.split("/"),{organizationId:b}=$(),g=W(),{role:m}=Y(r=>r.authStore),[s,h]=I.useState(""),{data:p,isLoading:n}=ae(E),{mutateAsync:O,isPending:C}=q(),{mutateAsync:y,isPending:w}=Z(),{mutateAsync:P,isPending:S}=ee(),{mutateAsync:A,isPending:j}=se(),{mutateAsync:v,isPending:M}=te(),R=()=>{u(!1)},i=()=>{u(!0)};I.useEffect(()=>{const c=l.pathname.split("/")[4];h(t?()=>ce[c]:()=>de[c])},[l.pathname,t]),fe(i,R);const a=!n&&p;let{filteredLabels:L,filteredIcons:oe,filteredPaths:T}=ue(a,d,N,o,f);const _=o[2]==="projectdetails",ne=o[1]==="login",ie=()=>{_&&x(`/organizations/${b}/projects`),ne&&x("/organizations")},F=async()=>{var r,c;try{m==="CTO"?await O():m==="client"?await y():m==="staff"?await P():m==="owner"?await A():m==="worker"&&await v(),g(z()),g(H()),g(Q()),g(V()),g(J()),g(X()),U({title:"Success",description:"logout successfull"}),(!C||!w||!S||!j||!M)&&x("/")}catch(k){U({title:"Error",description:((c=(r=k==null?void 0:k.response)==null?void 0:r.data)==null?void 0:c.message)||"Failed to logout",variant:"destructive"})}};return e.jsx(e.Fragment,{children:t?e.jsxs("aside",{onMouseLeave:()=>u(!1),className:"relative flex flex-col bg-[#2f303a] w-[17%] min-h-screen max-h-screen text-[#9ca3af] select-none transition-all duration-300",children:[e.jsxs("div",{className:"flex flex-col flex-grow overflow-y-auto overflow-x-hidden custom-scrollbar p-2",children:[e.jsxs("div",{onClick:ie,className:`flex ${_?"cursor-pointer":""} justify-between items-center border-b-1 py-2`,children:[e.jsx("span",{className:"text-xl",children:D.COMPANY_NAME}),e.jsx("div",{className:"w-[30px] h-[30px]",children:e.jsx("img",{className:"w-full h-full",src:D.COMPANY_LOGO,alt:"LOGO"})})]}),e.jsxs("section",{className:"py-2 space-y-2",children:[" ",Object.entries(L).map(([r,c])=>T[r]&&e.jsx(B,{to:T[r],className:"outline-none",children:e.jsxs("div",{onClick:()=>h(c),className:`cursor-pointer flex justify-between max-w-[95%] py-4 px-4 ${s===c?"bg-[#3a3b45] rounded-xl text-white":"rounded-xl hover:bg-[#3a3b45]"} `,children:[e.jsx("span",{className:"text-lg",children:c}),e.jsx("span",{children:e.jsx("i",{className:"fa-solid fa-chevron-right"})})]})},c))]})]}),e.jsxs("div",{className:"flex flex-col p-2 border-t border-[#3a3b45]",children:[o[1]!=="login"&&e.jsxs(G,{isLoading:C||w||S||j||M,onClick:F,className:"flex items-center gap-2 px-4 py-3 rounded-lg !bg-[#3a3b45] !text-[#9ca3af] hover:!bg-[#464751] hover:!text-white transition",children:[e.jsx("i",{className:"fa-solid fa-right-from-bracket"}),e.jsx("span",{children:"Logout"})]}),e.jsx("button",{title:"Ctrl+] to close",onClick:R,className:"mt-2 flex items-center justify-center outline-none border border-blue-600 text-blue-500 hover:bg-[#3a3b45] rounded-lg w-full py-2",children:e.jsx("i",{className:"fa-solid fa-chevron-left"})})]})]}):e.jsxs("aside",{onMouseEnter:()=>u(!0),className:"flex flex-col relative justify-between bg-[#2f303a] w-[6%]  max-h-full  text-[#9ca3af] transition-all duration-300 ",children:[e.jsx("div",{className:"max-h-[95%] overflow-y-auto overflow-x-hidden custom-scrollbar",children:e.jsx("div",{className:"flex items-center flex-col justify-between w-full",children:Object.entries(oe).map(([r,c])=>T[r]?e.jsx(B,{to:T[r],className:`${T[r]?"":"cursor-not-allowed"}`,children:e.jsx("div",{onClick:()=>h(r),className:`cursor-pointer flex justify-between max-w-[95%] py-4 px-4 ${(s==null?void 0:s.toLowerCase())===r.toLowerCase()?"bg-[#3a3b45] rounded-xl text-white":"rounded-xl hover:bg-[#3a3b45]"} `,children:e.jsx("i",{className:`${c} ${(s==null?void 0:s.toLowerCase())===r.toLowerCase()?"text-[#4a86f7]":"text-[#9ca3af]"} `})})}):e.jsx("div",{className:"cursor-not-allowed flex justify-between max-w-[95%] py-4 px-4",children:e.jsx("i",{className:`${c}`})}))})}),e.jsxs("div",{className:"flex flex-col items-center p-2 border-t border-[#3a3b45]",children:[o[1]!=="login"&&e.jsx(G,{isLoading:C||w||S||j||M,title:"logout",onClick:F,className:"w-[40px] h-[40px] flex items-center justify-center !bg-[#3a3b45] !text-[#9ca3af] hover:!text-red-500 transition",children:e.jsx("i",{className:"fa-solid fa-right-from-bracket"})}),e.jsx("button",{title:"Ctrl+[ to open",onClick:i,className:"mt-2 cursor-pointer outline-none border-[#9ca3af] h-[40px] w-[40px] flex items-center justify-center border rounded-lg",children:e.jsx("i",{className:"fa-solid fa-chevron-right text-[#4a86f7]"})})]})]})})},Ae=I.memo(xe),Ee=({isOpen:d,onClose:f,labels:N,path:t})=>{const u=K(),{organizationId:E,projectId:x}=$(),l=W(),{role:o}=Y(i=>i.authStore),{data:b,isLoading:g}=ae(x),{mutateAsync:m,isPending:s}=q(),{mutateAsync:h,isPending:p}=Z(),{mutateAsync:n,isPending:O}=ee(),{mutateAsync:C,isPending:y}=se(),{mutateAsync:w,isPending:P}=te(),S=async()=>{var i,a;try{o==="CTO"?await m():o==="client"?await h():o==="staff"?await n():o==="owner"?await C():o==="worker"&&await w(),l(z()),l(H()),l(Q()),l(V()),l(J()),l(X()),U({title:"Success",description:"logout successfull"}),(!s||!p||!O||!y||!P)&&u("/")}catch(L){U({title:"Error",description:((a=(i=L==null?void 0:L.response)==null?void 0:i.data)==null?void 0:a.message)||"Failed to logout",variant:"destructive"})}};let A=Object.entries(N);const j=location.pathname.split("/"),v=j[2]==="projectdetails";if(j.includes("projectdetails")&&!g){const i=b;A=A.filter(([a])=>{if(i){if(i==="Modular Units")return a!=="MATERIALSELECTION"&&a!=="COSTESTIMATION"&&a!=="SELECTSTAGE";if(i==="Manual Flow")return a!=="MODULARUNIT"&&a!=="SELECTSTAGE"}else return a!=="MODULARUNIT"&&a!=="MATERIALSELECTION"&&a!=="COSTESTIMATION";return!0})}const R=()=>{v&&u(`/organizations/${E}/projects`)};return e.jsxs(e.Fragment,{children:[d&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40",onClick:f}),e.jsxs("aside",{className:`fixed top-0 left-0 z-50 h-screen bg-white w-[75%] flex flex-col transition-transform duration-300 ${d?"translate-x-0":"-translate-x-full"}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsxs("div",{onClick:R,className:`flex items-center gap-3 ${v?"cursor-pointer":""}`,children:[e.jsx("img",{src:D.COMPANY_LOGO,alt:"Logo",className:"w-10 h-10 rounded-full object-cover"}),e.jsx("span",{className:"text-lg font-semibold",children:D.COMPANY_NAME})]}),e.jsx("button",{onClick:f,className:"text-xl text-gray-700",children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsx("nav",{className:"flex flex-col flex-grow overflow-y-auto p-4",children:A.map(([i,a],L)=>e.jsxs(le.Fragment,{children:[t[i]?e.jsx(B,{to:t[i],onClick:f,className:"text-gray-800 hover:bg-gray-100 p-3 rounded block",children:a}):e.jsx("span",{className:"text-gray-400 p-3 rounded cursor-not-allowed block",children:a}),L<A.length-1&&e.jsx("hr",{className:"border-t border-gray-200 my-1"})]},i))}),e.jsx("div",{className:"border-t border-gray-200 p-4",children:j[1]!=="login"&&e.jsxs(G,{className:"w-full flex items-center justify-center gap-2",isLoading:s||p||O||y||P,onClick:S,children:[e.jsx("i",{className:"fas fa-sign-out-alt"})," Logout"]})})]})]})};export{Ee as M,Ae as S};
