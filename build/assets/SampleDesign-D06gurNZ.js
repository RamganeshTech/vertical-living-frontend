import{f as y,h as R,s as A,b as ee,i as N,r as C,j as e,B as w,k as B,u as se,af as te,a as ae,M as le,O as oe,L as ne,t as g}from"./index-BAM0eJUz.js";import{A as ie,S as re}from"./AssignStaff-Bt6qrEbL.js";import{C as G}from"./Card-CdxfjEr-.js";import{d as de}from"./downloadFile-BbGV_BaX.js";import{I as ce}from"./ImageGalleryMain-B3g6b13d.js";import{R as me}from"./ResetStageButton-DaUxSSZv.js";import{S as ue}from"./StageGuide-e28gQ0h1.js";import"./Input-1UBXZqEj.js";import"./getAllUsersApi-O0JEgRtZ.js";import"./index-C8BdbktQ.js";import"./ShortListMain-CkHPlJB3.js";const xe=async({projectId:a,roomName:s,api:t})=>{const{data:l}=await t.post(`/sampledesign/${a}/rooms`,{roomName:s});if(!l.ok)throw new Error(l.message);return l.data},fe=async({projectId:a,roomName:s,files:t,api:l})=>{const o=new FormData;t.forEach(n=>o.append("files",n));const{data:d}=await l.post(`/sampledesign/${a}/rooms/${s}/upload`,o,{headers:{"Content-Type":"multipart/form-data"}});return d.data},pe=async({projectId:a,api:s})=>{const{data:t}=await s.get(`/sampledesign/${a}/rooms`);if(!t.ok)throw new Error(t.message);return t.data},he=async({projectId:a,roomName:s,fileId:t,api:l})=>{const{data:o}=await l.delete(`/sampledesign/${a}/rooms/${s}/delete/${t}`);if(!o.ok)throw new Error(o.message);return o.data},ge=async({projectId:a,api:s,roomId:t})=>{const{data:l}=await s.delete(`/sampledesign/${a}/${t}/deleteroom`);if(!l.ok)throw new Error(l.message);return l.data},we=async({projectId:a,api:s})=>{const{data:t}=await s.put(`/sampledesign/completionstatus/${a}`);if(!t.ok)throw new Error(t.message);return t.data},be=async({formId:a,projectId:s,deadLine:t,api:l})=>{const{data:o}=await l.put(`/sampledesign/deadline/${s}/${a}`,{deadLine:t});if(!o.ok)throw new Error(o.message);return o.data},je=()=>{const a=["owner","staff","CTO","client"],{role:s}=y(),t=N(s);return R({mutationFn:async({projectId:l,roomName:o})=>{if(!s||!a.includes(s))throw new Error("not allowed to make this api call");if(!t)throw new Error("API instance not found for role");return await xe({projectId:l,roomName:o,api:t})},onSuccess:(l,{projectId:o})=>{A.invalidateQueries({queryKey:["sampledesign","roomfiles",o]})}})},ye=()=>{const a=["owner","staff","CTO","client"],{role:s}=y(),t=N(s);return R({mutationFn:async({projectId:l,roomName:o,files:d})=>{if(!s||!a.includes(s))throw new Error("not allowed to make this api call");if(!t)throw new Error("API instance not found for role");return await fe({projectId:l,roomName:o,files:d,api:t})},onSuccess:(l,{projectId:o})=>{A.invalidateQueries({queryKey:["sampledesign","roomfiles",o]})}})},Ne=a=>{const s=["owner","staff","CTO","client"],{role:t}=y(),l=N(t);return ee({queryKey:["sampledesign","roomfiles",a],queryFn:async()=>{if(!t||!s.includes(t))throw new Error("not allowed to make this api call");if(!l)throw new Error("API instance not found for role");return await pe({projectId:a,api:l})},retry:!1,refetchOnWindowFocus:!1})},ve=()=>{const a=["owner","staff","CTO","client"],{role:s}=y(),t=N(s);return R({mutationFn:async({projectId:l,roomName:o,fileId:d})=>{if(!s||!a.includes(s))throw new Error("not allowed to make this api call");if(!t)throw new Error("API instance not found for role");return await he({projectId:l,roomName:o,fileId:d,api:t})},onSuccess:(l,{projectId:o})=>{A.invalidateQueries({queryKey:["sampledesign","roomfiles",o]})}})},Se=()=>{const a=["owner","staff","CTO","client"],{role:s}=y(),t=N(s);return R({mutationFn:async({projectId:l,roomId:o})=>{if(!s||!a.includes(s))throw new Error("not allowed to make this api call");if(!t)throw new Error("API instance not found for role");return await ge({projectId:l,roomId:o,api:t})},onSuccess:(l,{projectId:o})=>{A.invalidateQueries({queryKey:["sampledesign","roomfiles",o]})}})},Fe=()=>{const a=["owner","staff","CTO","client"],{role:s}=y(),t=N(s);return R({mutationFn:async({projectId:l})=>{if(!s||!a.includes(s))throw new Error("not allowed to make this api call");if(!t)throw new Error("API instance not found for role");return await we({projectId:l,api:t})},onSuccess:(l,{projectId:o})=>{A.invalidateQueries({queryKey:["sampledesign","roomfiles",o]})}})},Re=()=>{const a=["owner","staff","CTO"],{role:s}=y(),t=N(s);return R({mutationFn:async({formId:l,projectId:o,deadLine:d})=>{if(!s)throw new Error("not authorized");if(!a.includes(s))throw new Error("you  dont have the access to make this api");if(!t)throw new Error("api is null");return await be({formId:l,projectId:o,deadLine:d,api:t})}})},ke=({isOpen:a,onClose:s,onSubmit:t,addPending:l})=>{const[o,d]=C.useState(""),n=async p=>{p.preventDefault(),await t(o),d(""),s()};return a?e.jsx("div",{onClick:s,className:"fixed inset-0 bg-black/70 bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{onClick:p=>p.stopPropagation(),className:"bg-white rounded-lg p-6 w-[80%] sm:w-[60%] lg:w-full max-w-md",children:[e.jsx("h2",{className:"text-2xl font-bold text-blue-700 mb-4",children:"Add New Room"}),e.jsxs("form",{onSubmit:n,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 mb-2",children:"Room Name"}),e.jsx("input",{type:"text",value:o,onChange:p=>d(p.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{type:"button",onClick:s,className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"Cancel"}),e.jsx(w,{isLoading:l,type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Add Room"})]})]})]})}):null},Ce=({files:a,onUpload:s,onDelete:t,uploadPending:l,deletePending:o})=>{var O,j,f;const{role:d,permission:n}=B(),p=d==="owner"||((O=n==null?void 0:n.sampledesign)==null?void 0:O.delete),v=d==="owner"||((j=n==null?void 0:n.sampledesign)==null?void 0:j.create),S=d==="owner"||((f=n==null?void 0:n.sampledesign)==null?void 0:f.edit),E=C.useRef(null),[F,P]=C.useState([]),I=a.filter(r=>r.type==="pdf"),D=a.filter(r=>r.type==="image"),[k,L]=C.useState(null),M=r=>{var b;(b=r.target.files)!=null&&b.length&&P(Array.from(r.target.files))},i=async()=>{F.length!==0&&await s(F)};return e.jsxs("div",{className:"bg-white h-auto rounded-lg p-2 sm:p-6",children:[e.jsx("div",{className:"flex items-center gap-4 mb-6",children:e.jsx("div",{className:"w-full space-x-2",children:(v||S)&&e.jsxs(e.Fragment,{children:[e.jsx("input",{id:"fileInput",ref:E,type:"file",accept:".pdf,image/*",multiple:!0,className:"mb-1 sm:mb-0 w-[55%] sm:w-[80%] h-full py-2 border-1 px-2 rounded-lg",onChange:M}),e.jsxs(w,{variant:"primary",onClick:()=>{var r;return(r=E.current)==null?void 0:r.click()},className:"",children:[e.jsx("span",{className:"hidden sm:block",children:" Select Files"}),e.jsx("span",{className:"block sm:hidden",children:" Select"})]}),e.jsx(w,{isLoading:l,onClick:i,className:"px-2 sm:px-4 py-2 rounded-lg",variant:"primary",children:"upload"})]})})}),e.jsxs("div",{className:"grid h-auto grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 text-blue-700",children:[e.jsx("i",{className:"fas fa-file-pdf text-lg"}),e.jsx("h3",{className:"font-medium",children:"PDF Files"})]}),e.jsx("div",{className:"max-h-[300px] overflow-y-auto custom-scrollbar max-w-[100%] overflow-x-hidden",children:I.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No PDF files uploaded"}):e.jsx("div",{className:"space-y-2 max-w-[100%]",children:I.map((r,b)=>e.jsxs("div",{className:"flex items-center max-w-full justify-between py-2 px-3 bg-green-50 rounded-lg hover:bg-green-100 transition-colors",children:[e.jsx("span",{className:"text-gray-700 truncate whitespace-wrap max-w-[100%] flex-1 ",children:r.originalName||"Unnamed PDF"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{onClick:()=>de({src:r==null?void 0:r.url,alt:(r==null?void 0:r.originalName)||"file.pdf"}),size:"sm",className:"text-sm",children:e.jsx("i",{className:"fa-solid fa-download"})}),p&&e.jsx(w,{size:"sm",isLoading:o,onClick:()=>t(r._id),title:"Delete",children:e.jsx("i",{className:"fas fa-trash"})})]})]},b))})})]}),e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 text-blue-700",children:[e.jsx("i",{className:"fas fa-images text-lg"}),e.jsx("h3",{className:"font-medium",children:"Image Files"})]}),e.jsx("div",{className:"max-h-[300px] overflow-y-auto custom-scrollbar max-w-[100%] overflow-x-hidden",children:D.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No image files uploaded"}):e.jsx(ce,{imageFiles:D,...p?{handleDeleteFile:t}:{},height:80,minWidth:98,maxWidth:100})})]})]}),k&&e.jsx("div",{onClick:()=>L(null),className:"fixed inset-0 bg-black/70 z-50 p-8 bg-opacity-60 flex items-center justify-center",children:e.jsxs("div",{onClick:r=>r.stopPropagation(),className:"relative bg-white rounded py-8 px-4 max-w-[90vw] max-h-[80vh] shadow-lg",children:[e.jsx("i",{className:"fas fa-times absolute top-2 right-3 text-xl text-gray-700 hover:text-red-500 cursor-pointer",onClick:()=>L(null)}),e.jsx("img",{src:k,alt:"Full View",className:"max-h-[70vh] w-auto object-contain rounded"})]})})]})},ze=()=>{var T,$,q,_,z,K,Q,U;const{projectId:a,organizationId:s}=se(),{isMobile:t,openMobileSidebar:l}=te(),o=ae();if(!a)return null;const{role:d,permission:n}=B(),p=d==="owner"||((T=n==null?void 0:n.sampledesign)==null?void 0:T.delete),v=d==="owner"||(($=n==null?void 0:n.sampledesign)==null?void 0:$.create),S=d==="owner"||((q=n==null?void 0:n.sampledesign)==null?void 0:q.edit),[E,F]=C.useState(!1),P=je(),{mutateAsync:I,isPending:D}=ye(),k=ve(),{mutateAsync:L,isPending:M}=Se(),{data:i,isLoading:O,refetch:j,error:f}=Ne(a),{mutateAsync:r,isPending:b}=Fe(),{mutateAsync:W,isPending:Y}=Re(),V=async()=>{var c,m;try{b||(await r({projectId:a}),o("../workmainschedule")),g({description:"Completion status updated successfully",title:"Success"})}catch(u){g({title:"Error",description:((m=(c=u==null?void 0:u.response)==null?void 0:c.data)==null?void 0:m.message)||"Failed to update completion status",variant:"destructive"})}},H=async c=>{var m,u;try{await P.mutateAsync({projectId:a,roomName:c}),g({description:"Room Created successfully",title:"Success"})}catch(x){g({title:"Error",description:((u=(m=x==null?void 0:x.response)==null?void 0:m.data)==null?void 0:u.message)||"Failed to create room status",variant:"destructive"})}},J=async c=>{var m,u;try{b||await L({projectId:a,roomId:c}),g({description:"Room section Deleted successfully",title:"Success"})}catch(x){g({title:"Error",description:((u=(m=x==null?void 0:x.response)==null?void 0:m.data)==null?void 0:u.message)||"Failed to delete the room",variant:"destructive"})}},X=async(c,m)=>{var u,x;try{await I({projectId:a,roomName:c,files:m}),g({description:"File uploaded successfully",title:"Success"}),j()}catch(h){g({title:"Error",description:((x=(u=h==null?void 0:h.response)==null?void 0:u.data)==null?void 0:x.message)||(h==null?void 0:h.message)||" Failed to upload the files",variant:"destructive"})}},Z=async(c,m)=>{var u,x;try{await k.mutateAsync({projectId:a,roomName:c,fileId:m}),g({description:"File deleted successfully",title:"Success"}),j()}catch(h){g({title:"Error",description:((x=(u=h==null?void 0:h.response)==null?void 0:u.data)==null?void 0:x.message)||"Failed to delete the files",variant:"destructive"})}};return O?e.jsx(le,{}):location.pathname.includes("shortlist")?e.jsx(oe,{}):e.jsxs("div",{className:"container mx-auto max-h-full overflow-y-auto max-w-full min-h-full",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4 mb-6",children:[e.jsxs("h2",{className:"text-2xl sm:text-2xl lg:text-2xl xl:text-3xl font-semibold text-blue-600 flex items-center",children:[t&&e.jsx("button",{onClick:l,className:"mr-3 p-2 rounded-md  border-gray-300 hover:bg-gray-100",title:"Open Menu",children:e.jsx("i",{className:"fa-solid fa-bars"})}),e.jsx("i",{className:"fa-solid fa-object-group mr-2"}),"Sample Design Files"]}),e.jsxs("div",{className:"!w-[100%] sm:!w-[100%] lg:!w-[50%] xl:!w-[65%] flex flex-col sm:flex-row gap-3 justify-end",children:[e.jsxs("div",{className:"flex  flex-wrap md:flex-nowrap gap-2 justify-end",children:[(v||S)&&e.jsxs(w,{onClick:()=>F(!0),className:"bg-blue-600 hover:bg-blue-700 text-white flex-1 sm:flex-initial min-w-max",disabled:!!f,children:[e.jsx("i",{className:"fas fa-plus mr-2"}),e.jsx("span",{className:"",children:"Add room"})]}),(v||S)&&e.jsxs(w,{isLoading:b,onClick:V,className:"bg-green-600 hover:bg-green-700 text-white flex-1 sm:flex-initial min-w-max",disabled:!!f,children:[e.jsx("i",{className:"fa-solid fa-circle-check mr-2"}),"Mark Complete"]})]}),e.jsxs("div",{className:"flex flex-wrap md:flex-nowrap gap-2 justify-end",children:[(v||S)&&e.jsx(me,{projectId:a,stageNumber:3,stagePath:"sampledesign",className:"flex-1 sm:flex-initial min-w-max",disabled:!!f}),e.jsx(ie,{stageName:"SampleDesignModel",projectId:a,organizationId:s,currentAssignedStaff:(i==null?void 0:i.assignedTo)||null,className:"flex-1 sm:flex-initial min-w-max"}),e.jsx("div",{className:"w-full sm:w-auto flex justify-end sm:block",children:e.jsx(ue,{organizationId:s,stageName:"sampledesign"})})]})]})]}),f&&e.jsxs("div",{className:"max-w-xl mx-auto p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center mb-6",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2",children:"⚠️ Error Occurred"}),e.jsx("p",{className:"text-red-500 text-sm mb-4",children:((z=(_=f==null?void 0:f.response)==null?void 0:_.data)==null?void 0:z.message)||"Failed to load data"}),e.jsx(w,{onClick:()=>j(),className:"bg-red-600 text-white px-4 py-2",children:"Retry"})]}),!f&&e.jsxs(e.Fragment,{children:[e.jsxs(G,{className:"p-4 mb-6 w-full shadow border-l-4 border-blue-600 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-3 text-blue-700 text-sm font-medium mb-2",children:[e.jsx("i",{className:"fa-solid fa-clock text-blue-500 text-lg"}),e.jsx("span",{children:"Stage Timings"})]}),e.jsx(re,{stageName:"sampledesign",completedAt:(K=i==null?void 0:i.timer)==null?void 0:K.compltedAt,formId:i==null?void 0:i._id,projectId:a,deadLine:(Q=i==null?void 0:i.timer)==null?void 0:Q.deadLine,startedAt:(U=i==null?void 0:i.timer)==null?void 0:U.startedAt,refetchStageMutate:j,deadLineMutate:W,isPending:Y})]}),e.jsx(G,{className:"mb-6  text-blue-600 border-l-4 border-1 border-blue-600",children:e.jsx(ne,{to:"shortlist",children:e.jsxs("div",{className:"py-4 ml-2 flex justify-between items-center",children:[e.jsx("p",{className:"text-md sm:text-xl",children:"Sample Reference Designs"}),e.jsx("i",{className:"mr-4 fas fa-arrow-right text-blue-600"})]})})}),!(i!=null&&i.rooms)||i.rooms.length===0?e.jsxs("div",{className:"text-center py-10 sm:py-16 bg-white rounded-lg shadow-sm",children:[e.jsx("i",{className:"fas fa-home text-blue-200 text-5xl sm:text-6xl mb-4"}),e.jsx("h2",{className:"text-xl sm:text-2xl font-semibold text-gray-700 mb-2",children:"No Rooms Added Yet"}),e.jsx("p",{className:"text-gray-500 mb-6 max-w-md mx-auto",children:"Start by adding a room to upload design files"}),(v||S)&&e.jsxs("button",{onClick:()=>F(!0),className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 min-w-[200px]",children:[e.jsx("i",{className:"fas fa-plus mr-2"}),"Add Your First Room"]})]}):e.jsx("div",{className:"grid grid-cols-1  gap-6",children:i.rooms.map(c=>e.jsxs("div",{className:"bg-white border-l-4 border-blue-600 rounded-xl shadow-sm p-1 sm:p-6 flex flex-col",children:[e.jsxs("div",{className:"flex sm:flex-row items-center justify-between gap-3 mb-4",children:[e.jsxs("h2",{className:"text-xl font-semibold text-blue-700 truncate",children:[e.jsx("i",{className:"fas fa-door-open mr-2"}),c.roomName]}),p&&e.jsxs(w,{isLoading:M,onClick:()=>J(c._id),variant:"danger",className:"bg-red-600 text-white  sm:w-auto mt-2 sm:mt-0",children:[e.jsx("i",{className:"fa-solid fa-trash mr-2"}),"Delete"]})]}),e.jsx("div",{className:"flex-grow",children:e.jsx(Ce,{files:c.files,onUpload:m=>X(c.roomName,m),onDelete:m=>Z(c.roomName,m),uploadPending:D,deletePending:k.isPending})})]},c.roomName))})]}),e.jsx(ke,{isOpen:E,onClose:()=>F(!1),onSubmit:H,addPending:P.isPending})]})};export{ze as default};
