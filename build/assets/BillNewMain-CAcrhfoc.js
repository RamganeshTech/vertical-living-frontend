import{a as O,e as A,u as E,r as h,j as e,O as P}from"./index-DmIvND9E.js";import{C as T,b as L,c as R,a as S}from"./Card-CDMWR08L.js";import{B as z}from"./Badge-9PU4SjI5.js";import{d as $}from"./dateFormator-BGKi5rfZ.js";import{d as H,e as M}from"./billNewAccountingApi-Djhc9fW-.js";import{B as c}from"./Button-CcLxO5cH.js";import{u as _}from"./useDebounce-vV83sJVf.js";import{B as V}from"./Breadcrumb-BKypCSht.js";import"./useQuery-BHdcKCtG.js";import"./useMutation-CAeBxy3I.js";import"./useInfiniteQuery-iAVIpWnU.js";import"./roleCheck-DZRqXPrB.js";const ae=()=>{const o=O(),i=A(),{organizationId:l}=E(),p=h.useRef(null),[a,r]=h.useState({search:"",projectId:"",createdFromDate:"",createdToDate:"",sortBy:"createdAt",sortOrder:"desc"}),g=_(a.search,700),{data:n,fetchNextPage:f,hasNextPage:d,isFetchingNextPage:x,isLoading:j,isError:b,error:m,refetch:N}=H({organizationId:l,projectId:a.projectId||void 0,limit:12,search:g,createdFromDate:a.createdFromDate,createdToDate:a.createdToDate,sortBy:a.sortBy,sortOrder:a.sortOrder}),y=M(),u=(n==null?void 0:n.pages.flatMap(s=>s.data))||[];h.useEffect(()=>{const s=p.current;if(!s)return;const t=()=>{const{scrollTop:F,scrollHeight:k,clientHeight:I}=s;k-F-I<100&&d&&!x&&f()};return s.addEventListener("scroll",t),()=>s.removeEventListener("scroll",t)},[d,x,f]);const v=s=>{o(`single/${s}`)},w=(s,t)=>{s.stopPropagation(),window.confirm("Are you sure you want to delete this bill?")&&y.mutate({id:t,organizationId:l})},C=()=>{r({search:"",projectId:"",createdFromDate:"",createdToDate:"",sortBy:"createdAt",sortOrder:"desc"})},B=[{label:"Account",path:`/organizations/${l}/projects/accounting`},{label:"Design Bill",path:`/organizations/${l}/projects/billnew`}],D=(a.search?1:0)+(a.projectId?1:0)+(a.createdFromDate?1:0);return i.pathname.includes("/single")||i.pathname.includes("/create")||i.pathname.includes("/billtemplate")?e.jsx(P,{}):e.jsxs("div",{className:"h-full flex flex-col bg-gray-50/50 overflow-hidden",children:[e.jsxs("header",{className:"flex justify-between items-center bg-white border-b border-gray-200 flex-shrink-0",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-file-pdf mr-3 text-blue-600"}),"Bill Designs"]}),e.jsx(V,{paths:B})]}),e.jsxs("div",{className:"gap-2 flex items-center",children:[e.jsxs(c,{onClick:()=>o("create"),className:"bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx("i",{className:"fas fa-plus mr-2"})," Create Bill"]}),e.jsxs(c,{onClick:()=>o("billtemplate"),className:"bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx("i",{className:"fas fa-file-invoice mr-2"})," Bill Template"]})]})]}),j?e.jsxs("div",{className:"flex flex-1 items-center justify-center text-gray-500",children:[e.jsx("i",{className:"fas fa-spinner fa-spin mr-2 text-2xl"})," Loading Bills..."]}):b?e.jsxs("div",{className:"max-w-xl mx-auto mt-10 p-6 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2 text-xl",children:"⚠️ Error Occurred"}),e.jsx("p",{className:"text-red-500 mb-4",children:(m==null?void 0:m.message)||"Failed to load bills."}),e.jsx(c,{onClick:()=>N(),className:"bg-red-600 text-white",children:"Retry"})]}):e.jsxs("main",{className:"flex flex-col xl:flex-row flex-1 overflow-hidden",children:[e.jsxs("div",{className:"xl:w-80 flex-shrink-0 border-r border-gray-200 bg-white overflow-y-auto p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-md font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-filter mr-2 text-blue-600"})," Filters"]}),D>0&&e.jsx("button",{onClick:C,className:"text-xs text-blue-600 hover:underline font-medium",children:"Clear All"})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx("i",{className:"fas fa-search absolute left-3 top-2.5 text-gray-400 text-xs"}),e.jsx("input",{type:"text",placeholder:"Customer or Bill #...",value:a.search,onChange:s=>r(t=>({...t,search:s.target.value})),className:"w-full pl-8 pr-3 py-2 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500 outline-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"Project ID"}),e.jsx("input",{type:"text",placeholder:"Filter by Project ID",value:a.projectId,onChange:s=>r(t=>({...t,projectId:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded text-sm outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"Date Range"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"date",className:"w-full px-3 py-2 border border-gray-300 rounded text-sm outline-none",value:a.createdFromDate,onChange:s=>r(t=>({...t,createdFromDate:s.target.value}))}),e.jsx("input",{type:"date",className:"w-full px-3 py-2 border border-gray-300 rounded text-sm outline-none",value:a.createdToDate,onChange:s=>r(t=>({...t,createdToDate:s.target.value}))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"Sort By"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("select",{value:a.sortBy,onChange:s=>r(t=>({...t,sortBy:s.target.value})),className:"w-full px-2 py-2 border border-gray-300 rounded text-sm outline-none bg-white",children:[e.jsx("option",{value:"createdAt",children:"Created"}),e.jsx("option",{value:"billNumber",children:"Bill #"}),e.jsx("option",{value:"customerName",children:"Customer"})]}),e.jsxs("select",{value:a.sortOrder,onChange:s=>r(t=>({...t,sortOrder:s.target.value})),className:"w-full px-2 py-2 border border-gray-300 rounded text-sm outline-none bg-white",children:[e.jsx("option",{value:"desc",children:"Newest"}),e.jsx("option",{value:"asc",children:"Oldest"})]})]})]})]})]}),e.jsx("div",{ref:p,className:"flex-1 overflow-y-auto bg-gray-50/50 p-4",children:u.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center",children:[e.jsx("div",{className:"w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mb-4",children:e.jsx("i",{className:"fas fa-box-open text-4xl text-gray-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-700",children:"No Bills Found"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:a.search?`No matches for "${a.search}"`:"Create a new bill to get started."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 2xl:grid-cols-4 gap-6",children:u.map(s=>e.jsxs(T,{onClick:()=>v(s._id),className:"cursor-pointer hover:shadow-xl transition-all duration-300 border-l-4 border-l-green-500 relative group",children:[e.jsxs(L,{className:"pb-2",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-bold text-lg text-gray-800 truncate",title:s.customerName,children:s.customerName||"Unknown Customer"}),e.jsx("span",{className:"text-xs text-gray-500 font-mono bg-gray-100 px-2 py-0.5 rounded mt-1 inline-block",children:s.billNumber})]}),e.jsx(c,{variant:"danger",size:"icon",className:"h-7 w-7 opacity-0 group-hover:opacity-100 transition-opacity",onClick:t=>w(t,s._id),children:e.jsx("i",{className:"fas fa-trash text-xs"})})]}),e.jsxs(R,{className:"mt-2 text-xs",children:[e.jsx("i",{className:"far fa-calendar mr-1"}),$(s.createdAt)]})]}),e.jsx(S,{children:e.jsx("div",{className:"flex gap-2 flex-wrap",children:s.projectId&&e.jsxs(z,{variant:"secondary",className:"text-[10px]",children:[e.jsx("i",{className:"fas fa-project-diagram mr-1"}),s.projectId.projectName||"Project"]})})})]},s._id))}),x&&e.jsx("div",{className:"flex justify-center py-8",children:e.jsxs("div",{className:"flex items-center gap-2 text-blue-600",children:[e.jsx("i",{className:"fas fa-spinner fa-spin text-xl"}),e.jsx("span",{className:"text-sm font-medium",children:"Loading more bills..."})]})}),!d&&u.length>0&&e.jsx("div",{className:"flex justify-center py-6 text-gray-400 text-xs",children:e.jsx("p",{children:"End of list"})})]})})]})]})};export{ae as default};
