import{j as e,r as m,e as V,u as X,b as Z}from"./index-B80eZEEO.js";import{t as P}from"./toast-BSC5QTk1.js";import{N as U}from"./constants-D2-iPKn3.js";import{d as O}from"./downloadFile-C7Qt23Fv.js";import{r as ee}from"./index-VDxmD_Zn.js";import{u as te,b as se,c as ae,S as le,a as re}from"./SmartTagInput-D5TWeRWk.js";import H from"./MaterialOverviewLoading-nqEh15Kp.js";import{B as G}from"./Button-N-oyy8vA.js";import"./roleCheck-DSNABiCy.js";import"./useQuery-C1iFPXNz.js";import"./useMutation-BlarAHK3.js";import"./Card-DYeNHzV_.js";import"./Skeleton-Cnb0rjhS.js";function ie({images:r,onDelete:x,onDownload:g,isDeleting:p=!1,refetch:_,className:b="",minWidth:C=100,maxWidth:f=100,heightClass:j=0,showSelectButton:N,onToggleSelect:v,isSelected:i,onImageClick:y,portalId:$,controlledType:R,activePopupType:E,setActivePopupType:S,selectedSiteImage:c,showSiteSelectButton:D,onSiteImageConfirm:w,onPopupOpenChange:h}){const[d,k]=m.useState(null),[L,F]=m.useState(!1),[z,A]=m.useState({}),W=(t,u,T)=>{const B=T/u,J=Math.max(150,Math.min(400,200*B));A(Q=>({...Q,[t]:J}))},s=t=>{k(t),F(!0),h==null||h(!0)},a=()=>{F(!1),k(null),h==null||h(!1)},l=()=>{d!==null&&k((d-1+r.length)%r.length)},n=()=>{d!==null&&k((d+1)%r.length)};m.useEffect(()=>{if(!L||R!==E)return;const t=u=>{u.key==="Escape"?a():u.key==="ArrowRight"?n():u.key==="ArrowLeft"&&l()};return L&&(document.addEventListener("keydown",t),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",t),document.body.style.overflow="unset"}},[L,n,l,a]);const I=async t=>{if(x)try{await x(t),_&&await _(),r.length<=1?a():d!==null&&d>=r.length-1&&k(Math.max(0,r.length-2))}catch(u){console.error("Error deleting image:",u)}},q=t=>{g({src:t==null?void 0:t.url,alt:(t==null?void 0:t.originalName)||"image"})},K=()=>{a()},o=d!==null&&d>=0&&d<r.length?r[d]:null;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`gap-1 flex flex-wrap ${b}`,children:r==null?void 0:r.map((t,u)=>{const T=z[t._id]||200;return e.jsx(e.Fragment,{children:e.jsx("div",{className:"relative cursor-pointer bg-gray-100  mb-1 break-inside-avoid ",style:{flex:`0 1 ${C}px`,minWidth:`${C}px`,maxWidth:`${f}px`,height:`${j||T}px`},onClick:()=>{s(u),y==null||y(t),S("reference")},children:e.jsx("img",{src:(t==null?void 0:t.url)||U,alt:(t==null?void 0:t.originalName)||`Image ${u+1}`,className:"w-full cursor-pointer h-full object-cover",loading:"lazy",onLoad:B=>{const M=B.target;W(t._id,M.naturalWidth,M.naturalHeight)}})},t._id)})})}),L&&o&&ee.createPortal(e.jsxs("div",{className:"absolute inset-0 bg-black/90 text-white p-4 z-50 flex items-center justify-center",onClick:K,style:{margin:0,padding:0,zIndex:1e3},children:[e.jsxs("div",{className:"absolute top-6 right-6 z-[10000] flex items-center gap-4",children:[e.jsx("button",{onClick:t=>{t.stopPropagation(),q(o)},className:"bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-all duration-200",title:"Download",children:e.jsx("i",{className:"fas fa-download text-lg"})}),x&&e.jsx("button",{onClick:t=>{t.stopPropagation(),I(o._id)},className:"bg-black/50 hover:bg-red-600/70 text-white rounded-full p-3 transition-all duration-200",title:"Delete",disabled:p,children:e.jsx("i",{className:`fas ${p?"fa-spinner fa-spin":"fa-trash-can"} text-lg`})}),N&&v&&o&&e.jsx("button",{onClick:t=>{t.stopPropagation();const u=(i==null?void 0:i(o))??!1;v(o,!u)},className:`bg-${i!=null&&i(o)?"red":"green"}-600 hover:bg-${i!=null&&i(o)?"red":"green"}-700 text-white rounded-full p-3 transition-all duration-200`,title:i!=null&&i(o)?"Unselect this image":"Select this image",children:e.jsx("i",{className:`fas ${i!=null&&i(o)?"fa-xmark":"fa-check"} text-lg`})}),D&&e.jsx("button",{onClick:t=>w==null?void 0:w(t,o),className:`${(c==null?void 0:c._id)===o._id?"bg-red-600 hover:bg-red-700":"bg-blue-600 hover:bg-blue-700"} text-white rounded-full p-3 transition-all duration-200`,title:(c==null?void 0:c._id)===o._id?"Unselect this site image":"Select this site image",children:e.jsx("i",{className:`fas ${(c==null?void 0:c._id)===o._id?"fa-xmark":"fa-check"} text-lg`})}),e.jsx("button",{onClick:t=>{t.stopPropagation(),a()},className:"bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-all duration-200",title:"Close",children:e.jsx("i",{className:"fas fa-times text-xl"})})]}),e.jsx("button",{onClick:t=>{t.stopPropagation(),l()},className:"absolute left-6 top-1/2 transform -translate-y-1/2 z-[10000] bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-all duration-200",children:e.jsx("i",{className:"fas fa-chevron-left text-2xl"})}),e.jsx("button",{onClick:t=>{t.stopPropagation(),n()},className:"absolute right-6 top-1/2 transform -translate-y-1/2 z-[10000] bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-all duration-200",children:e.jsx("i",{className:"fas fa-chevron-right text-2xl"})}),e.jsx("div",{className:"relative flex items-center justify-center",style:{width:"70vw",height:"70vh",maxWidth:"70vw",maxHeight:"70vh"},onClick:t=>{t.stopPropagation(),S(R)},children:e.jsx("img",{src:(o==null?void 0:o.url)||U,alt:o.originalName||`Image ${d!==null?d+1:1}`,className:"max-w-full max-h-full object-contain"})}),e.jsxs("div",{className:"absolute bottom-6 left-1/2 transform -translate-x-1/2 text-white text-sm bg-black/50 px-4 py-2 rounded-full",children:[d!==null?d+1:1," of ",r.length]})]}),document.getElementById($))]})}function Y({imageFiles:r=[],height:x,refetch:g,handleDeleteFile:p,className:_="",minWidth:b,maxWidth:C,isSelected:f,onToggleSelect:j,showSelectButton:N,onImageClick:v,portalId:i,setActivePopupType:y,activePopupType:$,controlledType:R,showSiteSelectButton:E,onSiteImageConfirm:S,selecteSiteImage:c,onPopupOpenChange:D}){return e.jsx(e.Fragment,{children:e.jsx(ie,{images:r,onDelete:p,onDownload:O,refetch:g,isDeleting:!1,className:_,heightClass:x,minWidth:b,maxWidth:C,showSelectButton:N,onToggleSelect:j,isSelected:f,onImageClick:v,portalId:i,setActivePopupType:y,activePopupType:$,controlledType:R,selectedSiteImage:c,showSiteSelectButton:E,onSiteImageConfirm:S,onPopupOpenChange:D})})}const ne=r=>V.get(`https://houseofram.in/api/shortlisteddesign/getsuggestedtags?q=${encodeURIComponent(r)}`).then(x=>{var g;return Array.isArray((g=x==null?void 0:x.data)==null?void 0:g.tags)?x.data.tags:[]});function ve(){const{projectId:r,organizationId:x}=X(),[g,p]=m.useState(null),_=Z(),{data:b=[],isLoading:C}=te(r),[f,j]=m.useState(null),[N,v]=m.useState([]),[i,y]=m.useState(!1),[$,R]=m.useState(!1),[E,S]=m.useState([]),{data:c,isLoading:D}=se(x,E);m.useEffect(()=>{j(null),v([]),p(null),R(!1),y(!1)},[c]);const[w,h]=m.useState([]),{mutateAsync:d,isPending:k}=ae();m.useEffect(()=>{const s=i||$;return document.body.style.overflow=s?"hidden":"unset",()=>{document.body.style.overflow="unset"}},[i,$]);const L=(s,a)=>{s.stopPropagation(),j(l=>(l==null?void 0:l._id)===a._id?(P({title:"Success",description:"Unselected, You can now select another one."}),null):(P({title:"Success",description:"Site Image selected"}),a))},F=(s,a)=>{if(!f){P({title:"Error",description:"Please select a Site Image first",variant:"destructive"});return}v(l=>{const n=l.some(I=>I._id===s._id);return a&&!n?[...l,s]:a?l:l.filter(I=>I._id!==s._id)})},z=(s,a)=>{h(l=>l.map(n=>n.siteImage._id===s?{...n,referenceImages:n.referenceImages.filter(I=>I._id!==a)}:n).filter(n=>n.referenceImages.length>0))},A=s=>{h(a=>a.filter(l=>l.siteImage._id!==s))},W=async()=>{if(w.length===0){P({title:"Error",description:"No selections to generate",variant:"destructive"});return}try{const s=await d({projectId:r,selections:w});O({src:s.url,alt:s.fileName}),P({title:"Sucess",description:"Designs Generated Successfully!"}),h([])}catch(s){P({title:"Error",description:s==null?void 0:s.message,variant:"destructive"})}};return e.jsxs("div",{className:"max-w-full overflow-y-auto max-h-full px-4 mx-auto py-2",children:[e.jsxs("header",{className:"flex gap-2 items-center justify-between",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("div",{onClick:()=>_(-1),className:"flex bg-gray-200 h-fit rounded-full items-center gap-2 backdrop-blur-sm px-4 py-2 cursor-pointer",children:[e.jsx("i",{className:"fas fa-arrow-left text-sm"}),e.jsx("span",{className:"text-sm hidden sm:inline-block font-medium",children:"Back"})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl md:text-3xl font-bold text-gray-900 mb-1",children:"Shortlisting Reference Designs"}),e.jsx("p",{className:"text-gray-600 hidden sm:inline-block text-sm md:text-md",children:"Select and organize your favorite design references for easy access"})]})]}),(f||N.length>0)&&e.jsx("button",{className:"mt-6 bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg cursor-pointer",onClick:()=>{if(!f||N.length===0){P({title:"Error",description:"Select site image & at least 1 reference",variant:"destructive"});return}h(s=>[...s.filter(l=>l.siteImage._id!==f._id),{siteImage:f,referenceImages:N}]),j(null),v([])},children:"Confirm Selection"})]}),e.jsx("hr",{className:"my-3 bg-gray-500"}),e.jsxs("div",{className:"mb-4 flex gap-4 w-full  items-end",children:[e.jsxs("div",{className:"flex flex-1 flex-col",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Filter by Categories"}),e.jsx(le,{tags:E,setState:S,suggestionFetcher:ne})]}),e.jsx("div",{children:e.jsx(G,{variant:"outline",onClick:()=>S([]),className:"text-sm ml-2 flex",children:"Reset Filter"})})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-8 border-gray-300 border-2 rounded-2xl p-2",children:[e.jsxs("div",{className:"border-r-1 border-gray-300 pr-8",children:[e.jsx("h2",{className:"font-semibold text-lg mb-2",children:"Reference Designs"}),e.jsx("div",{className:"my-3 w-full h-[1px] bg-gray-200"}),D?e.jsx("div",{children:e.jsx(H,{})}):e.jsx("div",{className:"relative  h-[80vh]",id:"reference-popup-container",children:(c==null?void 0:c.length)>0?e.jsx(Y,{imageFiles:c||[],portalId:"reference-popup-container",height:190,refetch:()=>Promise.resolve(),minWidth:140,maxWidth:190,handleDeleteFile:void 0,showSelectButton:!0,setActivePopupType:p,activePopupType:g,controlledType:"reference",onToggleSelect:(s,a)=>F(s,a),isSelected:s=>N.some(a=>a._id===s._id),onPopupOpenChange:R,className:"overflow-y-auto max-h-[550px] "}):e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[300px] w-full bg-white   text-center p-6",children:[e.jsx("i",{className:"fas fa-box-open text-5xl text-blue-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-1",children:"No Reference Images Available"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Upload the Images in the ",e.jsx("span",{className:"cursor-pointer font-semibold text-blue-600",onClick:()=>_(`/organizations/${x}/projects/shortlistdesign`),children:"Reference Design"})," section",e.jsx("br",{}),"Select multiple Reference images",e.jsx("br",{}),"after selecting ",e.jsx("strong",{children:'"Confirm Selection"'})," to add images ðŸš€"]})]})})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold text-lg mb-2",children:"Site Images"}),e.jsx("div",{className:"my-3 w-full h-[1px] bg-gray-200"}),C?e.jsx("div",{children:e.jsx(H,{})}):e.jsx("div",{className:"relative  h-[80vh]",id:"site-popup-container",children:(b==null?void 0:b.length)>0?e.jsx(Y,{portalId:"site-popup-container",imageFiles:b,height:190,refetch:()=>Promise.resolve(),minWidth:140,maxWidth:190,setActivePopupType:p,activePopupType:g,controlledType:"site",showSiteSelectButton:!0,onSiteImageConfirm:L,selecteSiteImage:f,onImageClick:s=>{j(s),p("site")},onPopupOpenChange:y,className:"overflow-y-auto max-h-[550px] "}):e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[300px] w-full bg-white   text-center p-6",children:[e.jsx("i",{className:"fas fa-box-open text-5xl text-blue-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-1",children:"No Site Images Available"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Upload the Images in the Site Measurement Stage",e.jsx("br",{}),"Select multiple Reference images for single Site Image ",e.jsx("br",{}),"after selection ",e.jsx("strong",{children:'"Confirm Selection"'})," to add images ðŸš€"]})]})})]})]}),w.length>0?e.jsxs("div",{className:"mt-10 space-y-8",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("h3",{className:"font-bold text-xl mb-4",children:"Selected Designs"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(G,{isLoading:k,onClick:W,className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded shadow disabled:opacity-50",children:k?"Generating...":"Generate Pdf"}),e.jsx(G,{onClick:()=>{h([])},variant:"danger",className:"bg-red-600  text-white px-6 py-2 rounded shadow disabled:opacity-50",children:"Clear List"})]})]}),w.map(({siteImage:s,referenceImages:a},l)=>e.jsxs("div",{className:"p-4 py-6 border border-gray-300 rounded-lg bg-white shadow-md",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"",children:[e.jsxs("h2",{className:"text-base font-semibold text-gray-700 min-w-[110px]",children:["Site Image ",l+1]}),e.jsx("br",{}),e.jsx("img",{src:s==null?void 0:s.url,alt:s.originalName||`Site ${l+1}`,className:"h-28 w-auto object-contain border rounded-md"})]}),e.jsxs(G,{variant:"danger",onClick:()=>A(s._id),className:"text-white bg-red-600 text-sm whitespace-nowrap",children:[e.jsx("i",{className:"fas fa-trash !mr-2 "}),"Remove Site + References"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 flex-col",children:[e.jsx("h2",{className:"text-base font-semibold text-gray-700 min-w-[110px]",children:"Referece Images"}),e.jsx("div",{className:"flex flex-wrap gap-4 ",children:a.map(n=>e.jsxs("div",{className:"relative  w-[120px] h-[120px] ",children:[e.jsx("img",{src:n.url,alt:n.originalName,className:"w-full h-full object-cover rounded  shadow-sm"}),e.jsx("button",{onClick:()=>z(s._id,n._id),className:"absolute top-1 right-1 bg-red-600 text-white p-1 px-2 text-xs rounded-full",children:"âœ•"}),e.jsx("p",{className:"text-xs mt-1 text-center max-w-[120px] truncate",children:n.originalName})]},n._id))})]})]},s._id))]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-xl font-semibold text-black-800 my-3",children:"Youre Selections will appear below"}),e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[300px] w-full bg-white rounded-xl shadow-xl border border-gray-100  text-center p-6",children:[e.jsx("i",{className:"fas fa-box-open text-5xl text-blue-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-1",children:"No Selections Created"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Your Selection will appear here.",e.jsx("br",{}),"Select multiple Reference images for single Site Image ",e.jsx("br",{}),"after selection ",e.jsx("strong",{children:'"Confirm Selection"'})," to add images ðŸš€"]})]})]}),e.jsx("section",{className:"mt-6",children:e.jsx(re,{projectId:r})})]})}export{ve as default,ne as fetchSuggestions};
