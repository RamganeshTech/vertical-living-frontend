import{r as w,j as e,B as o,d as L,u as Y,o as _,O as q,b as G,t as m}from"./index-HgTal7lb.js";import{a as V,b as W,c as H,d as J,u as K,e as Q,f as X}from"./sampleDesignApi-DdKKrQVO.js";import{A as Z,S as $}from"./AssignStaff-DpB3_tsB.js";import{C as I}from"./Card-oYkyngJG.js";import{R as ee}from"./ResetStageButton-DQu_pb7e.js";import se from"./MaterialOverviewLoading-BX2Vg6-v.js";import{S as ae}from"./ShareDocumentWhatsapp-fpbkzAJi.js";import"./getAllUsersApi-Bgkugotr.js";import"./Skeleton-Cqfsq_v2.js";import"./documentationApi-Cb8lX8d6.js";const te=({isOpen:i,onClose:p,onSubmit:f,addPending:b})=>{const[h,x]=w.useState(""),g=async u=>{u.preventDefault(),await f(h),x(""),p()};return i?e.jsx("div",{onClick:p,className:"fixed inset-0 bg-black/70 bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{onClick:u=>u.stopPropagation(),className:"bg-white rounded-lg p-6 w-[80%] sm:w-[60%] lg:w-full max-w-md",children:[e.jsx("h2",{className:"text-2xl font-bold text-blue-700 mb-4",children:"Add New Room"}),e.jsxs("form",{onSubmit:g,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 mb-2",children:"Room Name"}),e.jsx("input",{type:"text",value:h,onChange:u=>x(u.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{type:"button",onClick:p,className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"Cancel"}),e.jsx(o,{isLoading:b,type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Add Room"})]})]})]})}):null},le=({files:i,onUpload:p,onDelete:f,uploadPending:b,deletePending:h})=>{const x=w.useRef(null),[g,u]=w.useState([]),y=i.filter(s=>s.type==="pdf"),j=i.filter(s=>s.type==="image"),[v,N]=w.useState(null),a=s=>{var t;(t=s.target.files)!=null&&t.length&&u(Array.from(s.target.files))},S=async()=>{g.length!==0&&await p(g)};return e.jsxs("div",{className:"bg-white h-auto rounded-lg p-2 sm:p-6",children:[e.jsx("div",{className:"flex items-center gap-4 mb-6",children:e.jsxs("div",{className:"w-full space-x-2",children:[e.jsx("input",{id:"fileInput",ref:x,type:"file",accept:".pdf,image/*",multiple:!0,className:"mb-1 sm:mb-0 w-[55%] sm:w-[80%] h-full py-2 border-1 px-2 rounded-lg",onChange:a}),e.jsxs(o,{variant:"primary",onClick:()=>{var s;return(s=x.current)==null?void 0:s.click()},className:"",children:[e.jsx("span",{className:"hidden sm:block",children:" Select Files"}),e.jsx("span",{className:"block sm:hidden",children:" Select"})]}),e.jsx(o,{isLoading:b,onClick:S,className:"px-2 sm:px-4 py-2 rounded-lg",variant:"primary",children:"upload"})]})}),e.jsxs("div",{className:"grid h-auto grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 text-blue-700",children:[e.jsx("i",{className:"fas fa-file-pdf text-lg"}),e.jsx("h3",{className:"font-medium",children:"PDF Files"})]}),e.jsx("div",{className:"max-h-[300px] overflow-y-auto custom-scrollbar max-w-[100%] overflow-x-hidden",children:y.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No PDF files uploaded"}):e.jsx("div",{className:"space-y-2 max-w-[100%]",children:y.map((s,t)=>e.jsxs("div",{className:"flex items-center max-w-full justify-between py-2 px-3 bg-green-50 rounded-lg hover:bg-green-100 transition-colors",children:[e.jsx("span",{className:"text-gray-700 truncate whitespace-wrap max-w-[100%] flex-1 ",children:s.originalName||"Unnamed PDF"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{onClick:()=>L({src:s==null?void 0:s.url,alt:(s==null?void 0:s.originalName)||"file.pdf"}),size:"sm",className:"text-sm",children:e.jsx("i",{className:"fa-solid fa-download"})}),e.jsx(o,{size:"sm",isLoading:h,onClick:()=>f(t),title:"Delete",children:e.jsx("i",{className:"fas fa-trash"})})]})]},t))})})]}),e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 text-blue-700",children:[e.jsx("i",{className:"fas fa-images text-lg"}),e.jsx("h3",{className:"font-medium",children:"Image Files"})]}),e.jsx("div",{className:"max-h-[300px] overflow-y-auto custom-scrollbar max-w-[100%] overflow-x-hidden",children:j.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No image files uploaded"}):e.jsx("div",{className:"space-y-2 max-w-[100%] ",children:j.map((s,t)=>e.jsxs("div",{className:"flex items-center max-w-full justify-between py-2 px-3 bg-green-50 rounded-lg hover:bg-green-100 transition-colors",children:[e.jsx("span",{className:"text-gray-700 truncate whitespace-wrap max-w-[80%] ",children:s.originalName||"Unnamed Image"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{size:"sm",variant:"primary",onClick:()=>N(s==null?void 0:s.url),children:e.jsx("i",{className:"fas fa-eye"})}),e.jsx(o,{onClick:()=>L({src:s==null?void 0:s.url,alt:(s==null?void 0:s.originalName)||"file.pdf"}),size:"sm",className:"text-sm",children:e.jsx("i",{className:"fa-solid fa-download"})}),e.jsx(o,{size:"sm",isLoading:h,onClick:()=>f(t),title:"Delete",children:e.jsx("i",{className:"fas fa-trash"})})]})]},t))})})]})]}),v&&e.jsx("div",{onClick:()=>N(null),className:"fixed inset-0 bg-black/70 z-50 p-8 bg-opacity-60 flex items-center justify-center",children:e.jsxs("div",{onClick:s=>s.stopPropagation(),className:"relative bg-white rounded py-8 px-4 max-w-[90vw] max-h-[80vh] shadow-lg",children:[e.jsx("i",{className:"fas fa-times absolute top-2 right-3 text-xl text-gray-700 hover:text-red-500 cursor-pointer",onClick:()=>N(null)}),e.jsx("img",{src:v,alt:"Full View",className:"max-h-[70vh] w-auto object-contain rounded"})]})})]})},ge=()=>{var F,R,k,A,P;const{projectId:i,organizationId:p}=Y(),{isMobile:f,openMobileSidebar:b}=_();if(!i)return null;const[h,x]=w.useState(!1),g=V(),{mutateAsync:u,isPending:y}=W(),j=H(),{mutateAsync:v,isPending:N}=J(),{data:a,isLoading:S,refetch:s,error:t}=K(i),{mutateAsync:M,isPending:C}=Q(),{mutateAsync:z,isPending:D}=X(),E=async()=>{var l,d;try{C||await M({projectId:i}),m({description:"Completion status updated successfully",title:"Success"})}catch(r){m({title:"Error",description:((d=(l=r==null?void 0:r.response)==null?void 0:l.data)==null?void 0:d.message)||"Failed to update completion status",variant:"destructive"})}},O=async l=>{var d,r;try{await g.mutateAsync({projectId:i,roomName:l}),m({description:"Room Created successfully",title:"Success"})}catch(n){m({title:"Error",description:((r=(d=n==null?void 0:n.response)==null?void 0:d.data)==null?void 0:r.message)||"Failed to create room status",variant:"destructive"})}},U=async l=>{var d,r;try{C||await v({projectId:i,roomId:l}),m({description:"Room section Deleted successfully",title:"Success"})}catch(n){m({title:"Error",description:((r=(d=n==null?void 0:n.response)==null?void 0:d.data)==null?void 0:r.message)||"Failed to delete the room",variant:"destructive"})}},B=async(l,d)=>{var r,n;try{await u({projectId:i,roomName:l,files:d}),m({description:"File uploaded successfully",title:"Success"}),s()}catch(c){m({title:"Error",description:((n=(r=c==null?void 0:c.response)==null?void 0:r.data)==null?void 0:n.message)||(c==null?void 0:c.message)||" Failed to upload the files",variant:"destructive"})}},T=async(l,d)=>{var r,n;try{await j.mutateAsync({projectId:i,roomName:l,fileIndex:d}),m({description:"File deleted successfully",title:"Success"}),s()}catch(c){m({title:"Error",description:((n=(r=c==null?void 0:c.response)==null?void 0:r.data)==null?void 0:n.message)||"Failed to delete the files",variant:"destructive"})}};return S?e.jsx(se,{}):location.pathname.includes("shortlist")?e.jsx(q,{}):e.jsxs("div",{className:"container mx-auto max-h-full overflow-y-auto max-w-full min-h-full",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4 mb-6",children:[e.jsxs("h2",{className:"text-2xl sm:text-2xl lg:text-2xl xl:text-3xl font-semibold text-blue-600 flex items-center",children:[f&&e.jsx("button",{onClick:b,className:"mr-3 p-2 rounded-md  border-gray-300 hover:bg-gray-100",title:"Open Menu",children:e.jsx("i",{className:"fa-solid fa-bars"})}),e.jsx("i",{className:"fa-solid fa-object-group mr-2"}),"Sample Design Files"]}),e.jsxs("div",{className:"!w-[100%] sm:!w-[100%] lg:!w-[50%] xl:!w-[65%] flex flex-col sm:flex-row gap-3 justify-end",children:[e.jsxs("div",{className:"flex  flex-wrap md:flex-nowrap gap-2 justify-end",children:[e.jsxs(o,{onClick:()=>x(!0),className:"bg-blue-600 hover:bg-blue-700 text-white flex-1 sm:flex-initial min-w-max",disabled:!!t,children:[e.jsx("i",{className:"fas fa-plus mr-2"}),e.jsx("span",{className:"",children:"Add room"})]}),e.jsxs(o,{isLoading:C,onClick:E,className:"bg-green-600 hover:bg-green-700 text-white flex-1 sm:flex-initial min-w-max",disabled:!!t,children:[e.jsx("i",{className:"fa-solid fa-circle-check mr-2"}),"Mark Complete"]})]}),e.jsxs("div",{className:"flex flex-wrap md:flex-nowrap gap-2 justify-end",children:[e.jsx(ee,{projectId:i,stageNumber:3,stagePath:"sampledesign",className:"flex-1 sm:flex-initial min-w-max",disabled:!!t}),!t&&e.jsx(ae,{projectId:i,stageNumber:"3",className:"w-full sm:w-fit",isStageCompleted:a==null?void 0:a.status}),e.jsx(Z,{stageName:"SampleDesignModel",projectId:i,organizationId:p,currentAssignedStaff:(a==null?void 0:a.assignedTo)||null,className:"flex-1 sm:flex-initial min-w-max"})]})]})]}),t&&e.jsxs("div",{className:"max-w-xl mx-auto p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center mb-6",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2",children:"⚠️ Error Occurred"}),e.jsx("p",{className:"text-red-500 text-sm mb-4",children:((R=(F=t==null?void 0:t.response)==null?void 0:F.data)==null?void 0:R.message)||"Failed to load data"}),e.jsx(o,{onClick:()=>s(),className:"bg-red-600 text-white px-4 py-2",children:"Retry"})]}),!t&&e.jsxs(e.Fragment,{children:[e.jsxs(I,{className:"p-4 mb-6 w-full shadow border-l-4 border-blue-600 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-3 text-blue-700 text-sm font-medium mb-2",children:[e.jsx("i",{className:"fa-solid fa-clock text-blue-500 text-lg"}),e.jsx("span",{children:"Stage Timings"})]}),e.jsx($,{stageName:"sampledesign",completedAt:(k=a==null?void 0:a.timer)==null?void 0:k.compltedAt,formId:a==null?void 0:a._id,projectId:i,deadLine:(A=a==null?void 0:a.timer)==null?void 0:A.deadLine,startedAt:(P=a==null?void 0:a.timer)==null?void 0:P.startedAt,refetchStageMutate:s,deadLineMutate:z,isPending:D})]}),e.jsx(I,{className:"mb-6  text-blue-600 border-l-4 border-1 border-blue-600",children:e.jsx(G,{to:"shortlist",children:e.jsxs("div",{className:"py-4 ml-2 flex justify-between items-center",children:[e.jsx("p",{className:"text-md sm:text-xl",children:"Sample Reference Designs"}),e.jsx("i",{className:"mr-4 fas fa-arrow-right text-blue-600"})]})})}),!(a!=null&&a.rooms)||a.rooms.length===0?e.jsxs("div",{className:"text-center py-10 sm:py-16 bg-white rounded-lg shadow-sm",children:[e.jsx("i",{className:"fas fa-home text-blue-200 text-5xl sm:text-6xl mb-4"}),e.jsx("h2",{className:"text-xl sm:text-2xl font-semibold text-gray-700 mb-2",children:"No Rooms Added Yet"}),e.jsx("p",{className:"text-gray-500 mb-6 max-w-md mx-auto",children:"Start by adding a room to upload design files"}),e.jsxs("button",{onClick:()=>x(!0),className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 min-w-[200px]",children:[e.jsx("i",{className:"fas fa-plus mr-2"}),"Add Your First Room"]})]}):e.jsx("div",{className:"grid grid-cols-1  gap-6",children:a.rooms.map(l=>e.jsxs("div",{className:"bg-white border-l-4 border-blue-600 rounded-xl shadow-sm p-1 sm:p-6 flex flex-col",children:[e.jsxs("div",{className:"flex sm:flex-row items-center justify-between gap-3 mb-4",children:[e.jsxs("h2",{className:"text-xl font-semibold text-blue-700 truncate",children:[e.jsx("i",{className:"fas fa-door-open mr-2"}),l.roomName]}),e.jsxs(o,{isLoading:N,onClick:()=>U(l._id),variant:"danger",className:"bg-red-600 text-white  sm:w-auto mt-2 sm:mt-0",children:[e.jsx("i",{className:"fa-solid fa-trash mr-2"}),"Delete"]})]}),e.jsx("div",{className:"flex-grow",children:e.jsx(le,{files:l.files,onUpload:d=>B(l.roomName,d),onDelete:d=>T(l.roomName,d),uploadPending:y,deletePending:j.isPending})})]},l.roomName))})]}),e.jsx(te,{isOpen:h,onClose:()=>x(!1),onSubmit:O,addPending:g.isPending})]})};export{ge as default};
