import{a as We,e as Ke,c as Qe,d as Ye,r as f,j as e,O as Je}from"./index-CqEiDvr_.js";import{t as d}from"./toast-BSC5QTk1.js";import{B as h}from"./Button-DzcQpMPj.js";import{C as me,a as Xe}from"./Card-CHisThjm.js";import{A as Ze,S as es}from"./AssignStaff-UIj87bDS.js";import{R as ss}from"./ResetStageButton-MAPDdJVf.js";import{S as ts}from"./ShareDocumentWhatsapp-BOVmxZ6u.js";import as from"./MaterialOverviewLoading-DjqpQRJC.js";import{N as ls}from"./constants-DnylCaPP.js";import{u as rs,a as is,b as ns,c as ds,d as cs,e as os,f as ms,g as xs,h as us,i as hs,j as ps,k as gs,l as fs,m as bs}from"./orderMaterialHistoryApi-BCG3kvIe.js";import{I as N}from"./Input-Bm6t9LQ8.js";import{d as js}from"./downloadFile-BF_lyJpu.js";import{u as Ns}from"./shopLibDetailApi-ofstUEr3.js";import{S as vs}from"./SearchSelectNew-BHCpfa7r.js";import{I as ys}from"./ImageGalleryMain-CHhXwafP.js";import"./useMutation-DDHgQq3T.js";import"./roleCheck-BJ07f95N.js";import"./getAllUsersApi-DU9yASCU.js";import"./useQuery-DyvuN1xf.js";import"./documentationApi-BZ0BXJDf.js";import"./requirementFormApi-DErI9VtO.js";import"./Skeleton-DMaf5_kG.js";import"./index-Dujx1vkm.js";const xe=["nos","pieces","litre","dozens","kg","mm","cm","meter","feet","inch","sqft","sqmm","packet","roll","sheet","set","coil","pair"],Ws=()=>{var K,Q,Y,J,X,Z,ee,se,te,ae,le,re,ie,ne,de,ce,oe;const{projectId:u,organizationId:O}=We(),{isMobile:ue,openMobileSidebar:he}=Ke(),U=Qe(),$=Ye(),{data:t,isLoading:B,isError:q,error:A,refetch:b}=rs(u),{mutateAsync:pe,isPending:z}=is(),{mutateAsync:ge}=ns(),{mutateAsync:fe}=ds(),{mutateAsync:be,isPending:H}=cs(),{mutateAsync:je}=os(),{mutateAsync:Ne,isPending:R}=ms(),ve=xs(),{mutateAsync:ye,isPending:we}=us(),{mutateAsync:Se,isPending:Ie}=hs(),{mutateAsync:_e}=ps(),{mutateAsync:ke}=gs(),{data:v}=Ns(O),{mutateAsync:Ce,isPending:De}=fs(),{mutateAsync:Pe,isPending:Ae}=bs(),[Ee,G]=f.useState(!1),[c,k]=f.useState({}),[V,E]=f.useState(!1),[x,I]=f.useState({}),[L,Le]=f.useState({selectedId:null,shopName:null});f.useEffect(()=>{if(L.selectedId){const s=v==null?void 0:v.find(l=>l._id===L.selectedId);console.log("shop",s),s&&I(s)}},[L.selectedId,v]);const Me=(K=v||[])==null?void 0:K.map(s=>({value:s._id,label:s.shopName})),[y,Oe]=f.useState(null),[m,j]=f.useState(null),[w,M]=f.useState({}),C=f.useRef(null),Ue=async s=>{var l,a;try{const i=s.target.files;if(!i||i.length===0)return;const o=Array.from(i).filter(p=>p.type.startsWith("image/"));if(o.length!==i.length){d({title:"Invalid file type",description:"Only images are allowed (JPG, PNG, etc.)",variant:"destructive"});return}await Ne({files:o,projectId:u}),d({description:"Successfully uploaded images",title:"Success"})}catch(i){d({title:"Error",description:((a=(l=i==null?void 0:i.response)==null?void 0:l.data)==null?void 0:a.message)||i.message||"Failed to upload images",variant:"destructive"})}},qe=async()=>{var s,l;try{await Se({projectId:u}),d({description:"Completion status updated successfully",title:"Success"}),U("../materialarrival")}catch(a){d({title:"Error",description:((l=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:l.message)||a.message||"Failed to update completion status",variant:"destructive"})}},Re=async()=>{var s,l;try{if(!window.confirm("Are you sure need to perform this operation?"))return;await Ce({projectId:u}),d({description:"All Sub Items successfully",title:"Success"})}catch(a){d({title:"Error",description:((l=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:l.message)||a.message||"Failed to delete sub items",variant:"destructive"})}},Ge=async()=>{var s,l;try{if(c!=null&&c.phoneNumber&&!/^\d{10}$/.test(c==null?void 0:c.phoneNumber.trim()))throw new Error("Phone number should contain exactly 10 digit numbers");await _e({projectId:u,updates:c}),G(!1),d({title:"Success",description:"Delivery Details Updated"}),b()}catch(a){d({variant:"destructive",title:"Error",description:((l=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:l.message)||(a==null?void 0:a.message)||"Update failed"})}},Fe=async()=>{var s,l;try{if(x.phoneNumber&&!/^\d{10}$/.test(x.phoneNumber.trim()))throw new Error("Phone number should contain exactly 10 digit numbers");await ke({projectId:u,updates:x}),d({title:"Success",description:"Shop Details Updated"}),E(!1),b()}catch(a){d({variant:"destructive",title:"Error",description:((l=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:l.message)||(a==null?void 0:a.message)||"Update failed"})}},Te=async s=>{var l,a;try{await ve.mutateAsync({projectId:u,imageId:s}),b==null||b(),d({title:"Success",description:"deleted successfully"})}catch(i){d({title:"Error",description:((a=(l=i==null?void 0:i.response)==null?void 0:l.data)==null?void 0:a.message)||"failed to delete",variant:"destructive"})}},$e=async s=>{var l,a;try{await Pe({projectId:u,pdfId:s}),d({title:"Success",description:"PDF deleted"}),E(!1),b()}catch(i){d({variant:"destructive",title:"Error",description:((a=(l=i==null?void 0:i.response)==null?void 0:l.data)==null?void 0:a.message)||(i==null?void 0:i.message)||"failed to delete"})}},F=(t==null?void 0:t.selectedUnits)||[],Be=(t==null?void 0:t.totalCost)||0,W=F.length>0;f.useEffect(()=>{m&&C.current&&(C.current.focus(),C.current.select())},[m]);const D=async(s,l,a,i)=>{var o,p,P;try{const g=F.find(n=>n._id===s),S=(o=g==null?void 0:g.subItems)==null?void 0:o.find(n=>n._id===l);if(!S)return;const r={projectId:u,unitId:s,subItemId:l,subItemName:a==="name"?i:S.subItemName,quantity:a==="quantity"?Number(i)?Number(i):1:S.quantity,unit:a==="unit"?i:S.unit};await je(r),d({title:"Success",description:"Item updated successfully"})}catch(g){console.log("filed",g),d({title:"Error",description:((P=(p=g==null?void 0:g.response)==null?void 0:p.data)==null?void 0:P.message)||"Failed to update item",variant:"destructive"})}},T=async(s,l)=>{var i,o;const a=l;if(!a&&!(a!=null&&a.name.trim()))return d({title:"Error",description:"Material Name is mandatory",variant:"destructive"});try{await fe({projectId:u,unitId:s,subItemName:a.name,quantity:a.quantity??1,unit:a.unit}),M(p=>({...p,[s]:{name:"",quantity:1,unit:""}})),d({title:"Success",description:"Item created successfully"})}catch(p){d({title:"Error",description:((o=(i=p==null?void 0:p.response)==null?void 0:i.data)==null?void 0:o.message)||"Failed to create item",variant:"destructive"})}},ze=async(s,l)=>{var a,i;try{await be({projectId:u,unitId:s,subItemId:l}),d({title:"Success",description:"Item deleted successfully"})}catch(o){d({title:"Error",description:((i=(a=o==null?void 0:o.response)==null?void 0:a.data)==null?void 0:i.message)||"Failed to delete item",variant:"destructive"})}},He=async()=>{var s,l;try{await pe({projectId:u,organizationId:O}),d({title:"Success",description:"Pdf Generated successfully"}),b()}catch(a){d({title:"Error",description:((l=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:l.message)||(a==null?void 0:a.message)||"Failed to generate link",variant:"destructive"})}},Ve=async(s,l)=>{var a,i;try{await ge({projectId:u,pdfId:s,status:l}),d({title:"Success",description:"Pdf status updated successfully"}),b()}catch(o){d({title:"Error",description:((i=(a=o==null?void 0:o.response)==null?void 0:a.data)==null?void 0:i.message)||(o==null?void 0:o.message)||"Failed to update status",variant:"destructive"})}};return $.pathname.includes("siteorders")||$.pathname.includes("shoplib")?e.jsx(Je,{}):B?e.jsx(as,{}):e.jsxs("div",{className:"w-full h-full flex flex-col",children:[e.jsxs("div",{className:"flex-shrink-0 flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-4",children:[e.jsxs("h2",{className:"text-2xl sm:text-2xl lg:text-2xl xl:text-3xl font-semibold text-blue-600 flex items-center",children:[ue&&e.jsx("button",{onClick:he,className:"mr-3 p-2 rounded-md border-gray-300 hover:bg-gray-100",title:"Open Menu",children:e.jsx("i",{className:"fa-solid fa-bars"})}),e.jsx("i",{className:"fa-solid fa-cart-shopping mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Ordering Material"}),e.jsx("span",{className:"sm:hidden",children:"Order Material"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full sm:w-auto",children:[e.jsxs(h,{isLoading:Ie,onClick:qe,className:"bg-green-600 hover:bg-green-700 text-white w-full sm:w-auto whitespace-nowrap",children:[e.jsx("i",{className:"fa-solid fa-circle-check mr-2"}),"Mark as Complete"]}),e.jsx(ss,{projectId:u,stageNumber:8,stagePath:"orderingmaterial"}),!A&&e.jsx(ts,{projectId:u,stageNumber:"8",className:"w-full sm:w-fit",isStageCompleted:t==null?void 0:t.status}),e.jsx(Ze,{stageName:"OrderMaterialHistoryModel",projectId:u,organizationId:O,currentAssignedStaff:(t==null?void 0:t.assignedTo)||null})]})]}),q&&e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"max-w-xl p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2",children:"⚠️ Error Occurred"}),e.jsx("p",{className:"text-red-500 text-sm mb-4",children:((Y=(Q=A==null?void 0:A.response)==null?void 0:Q.data)==null?void 0:Y.message)||"Failed to load ordering material"}),e.jsx(h,{isLoading:B,onClick:()=>b(),className:"bg-red-600 text-white hover:bg-red-700",children:"Retry"})]})}),!q&&e.jsxs("div",{className:"flex-1 min-h-0 overflow-y-auto space-y-4 sm:space-y-6",children:[e.jsxs(me,{className:"p-4 w-full shadow border-l-4 border-blue-600 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-3 text-blue-700 text-sm font-medium mb-2",children:[e.jsx("i",{className:"fa-solid fa-clock text-blue-500 text-lg"}),e.jsx("span",{children:"Stage Timings"})]}),e.jsx(es,{completedAt:(J=t==null?void 0:t.timer)==null?void 0:J.completedAt,stageName:"orderingmaterial",formId:t==null?void 0:t._id,projectId:u,deadLine:(X=t==null?void 0:t.timer)==null?void 0:X.deadLine,startedAt:(Z=t==null?void 0:t.timer)==null?void 0:Z.startedAt,refetchStageMutate:b,deadLineMutate:ye,isPending:we})]}),!q&&e.jsxs("section",{className:"bg-white rounded-3xl shadow-[0_10px_40px_-15px_rgba(0,0,0,0.1)] overflow-hidden",children:[e.jsxs("section",{className:"border-l-4 border-blue-600 rounded-lg p-4 shadow-sm relative bg-white",children:[e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsx("div",{children:e.jsxs("h2",{className:"text-base sm:text-lg font-bold mb-3 text-blue-700 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-store"}),"Shop Details"]})}),V?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Assignee"}),e.jsx(vs,{options:Me,placeholder:"Select Shop",searchPlaceholder:"Search by shop name...",value:L.selectedId||"",onValueChange:s=>{const l=v==null?void 0:v.find(a=>a._id===s);Le({selectedId:l._id,shopName:l.shopName})},searchBy:"name",displayFormat:"detailed",className:"w-full"})]}):e.jsxs("div",{className:"gap-2 flex",children:[e.jsxs(h,{onClick:()=>U("shoplib"),children:[e.jsx("i",{className:"fas fa-shop mr-2"}),"Shop Library"]}),e.jsxs("button",{onClick:()=>{I(t==null?void 0:t.shopDetails),E(!0)},className:" text-blue-600 text-xs sm:text-sm underline hover:text-blue-800",children:[e.jsx("i",{className:"fa-solid fa-edit mr-1"}),"Edit"]})]})]}),V?e.jsxs("div",{className:"space-y-3",children:[e.jsx(N,{placeholder:"Shop Name",value:(x==null?void 0:x.shopName)||"",onChange:s=>I({...x,shopName:s.target.value}),className:"w-full"}),e.jsx(N,{placeholder:"Contact Person",value:(x==null?void 0:x.contactPerson)||"",onChange:s=>I({...x,contactPerson:s.target.value}),className:"w-full"}),e.jsx(N,{placeholder:"Phone Number",value:(x==null?void 0:x.phoneNumber)||"",type:"tel",maxLength:10,onChange:s=>I({...x,phoneNumber:s.target.value}),className:"w-full"}),e.jsx(N,{placeholder:"Address",value:(x==null?void 0:x.address)||"",onChange:s=>I({...x,address:s.target.value}),className:"w-full"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mt-3  justify-end ",children:[e.jsxs(h,{onClick:Fe,className:"w-full sm:w-auto",children:[e.jsx("i",{className:"fa-solid fa-save mr-2"}),"Save"]}),e.jsxs(h,{variant:"outline",onClick:()=>E(!1),className:"w-full sm:w-auto",children:[e.jsx("i",{className:"fa-solid fa-times mr-2"}),"Cancel"]})]})]}):e.jsxs("div",{className:"space-y-2 text-sm sm:text-base",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Shop Name:"})," ",((ee=t==null?void 0:t.shopDetails)==null?void 0:ee.shopName)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Contact Person:"})," ",((se=t==null?void 0:t.shopDetails)==null?void 0:se.contactPerson)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Phone:"})," ",((te=t==null?void 0:t.shopDetails)==null?void 0:te.phoneNumber)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Address:"})," ",((ae=t==null?void 0:t.shopDetails)==null?void 0:ae.address)||"-"]})]})]}),e.jsxs("div",{className:"border-l-4 mt-4 border-blue-600 rounded-lg p-4 shadow-sm relative bg-white",children:[e.jsxs("h2",{className:"text-base sm:text-lg font-bold mb-3 text-blue-700 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-truck"}),"Delivery Location"]}),Ee?e.jsxs("div",{className:"space-y-3",children:[e.jsx(N,{placeholder:"Site Name",value:(c==null?void 0:c.siteName)||"",onChange:s=>k({...c,siteName:s.target.value}),className:"w-full"}),e.jsx(N,{placeholder:"Site Supervisor",value:(c==null?void 0:c.siteSupervisor)||"",onChange:s=>k({...c,siteSupervisor:s.target.value}),className:"w-full"}),e.jsx(N,{placeholder:"Phone Number",type:"tel",maxLength:10,value:(c==null?void 0:c.phoneNumber)||"",onChange:s=>k({...c,phoneNumber:s.target.value}),className:"w-full"}),e.jsx(N,{placeholder:"Address",value:(c==null?void 0:c.address)||"",onChange:s=>k({...c,address:s.target.value}),className:"w-full"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mt-3  justify-end ",children:[e.jsxs(h,{onClick:Ge,className:"w-full sm:w-auto",children:[e.jsx("i",{className:"fa-solid fa-save mr-2"}),"Save"]}),e.jsxs(h,{variant:"outline",onClick:()=>G(!1),className:"w-full sm:w-auto",children:[e.jsx("i",{className:"fa-solid fa-times mr-2"}),"Cancel"]})]})]}):e.jsxs("div",{className:"space-y-2 text-sm sm:text-base",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Site Name:"})," ",((le=t==null?void 0:t.deliveryLocationDetails)==null?void 0:le.siteName)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Supervisor:"})," ",((re=t==null?void 0:t.deliveryLocationDetails)==null?void 0:re.siteSupervisor)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Phone:"})," ",((ie=t==null?void 0:t.deliveryLocationDetails)==null?void 0:ie.phoneNumber)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Address:"})," ",((ne=t==null?void 0:t.deliveryLocationDetails)==null?void 0:ne.address)||"-"]}),e.jsxs("button",{onClick:()=>{k(t==null?void 0:t.deliveryLocationDetails),G(!0)},className:"absolute top-3 right-4 text-blue-600 text-xs sm:text-sm underline hover:text-blue-800",children:[e.jsx("i",{className:"fa-solid fa-edit mr-1"}),"Edit"]})]})]}),e.jsx("section",{className:"w-full",children:e.jsxs("section",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 border-b pb-2 flex items-center",children:[e.jsx("i",{className:"fas fa-folder-open mr-2 text-blue-500"})," Images"]}),e.jsxs("div",{className:"flex items-center justify-between w-full relative",children:[e.jsx(N,{type:"file",multiple:!0,accept:"image/*",placeholder:"select files",onChange:Ue,disabled:R,className:R?"pr-10 opacity-70 cursor-not-allowed w-full mb-4":"mb-4"}),R&&e.jsx("div",{className:"absolute inset-y-0 right-2 flex items-center",children:e.jsxs("svg",{className:"animate-spin h-5 w-5 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4l3.5-3.5L12 0v4a8 8 0 100 16v4l3.5-3.5L12 20v-4a8 8 0 01-8-8z"})]})})]}),e.jsx("div",{className:"mb-6",children:((de=t==null?void 0:t.images)==null?void 0:de.length)>0?e.jsx(ys,{handleDeleteFile:s=>Te(s),imageFiles:t==null?void 0:t.images,height:150,minWidth:150,maxWidth:200}):e.jsx("div",{className:"text-gray-500 text-sm italic bg-gray-50 p-8 rounded-lg text-center border-2 border-dashed border-gray-200",children:"No Images uploaded yet."})})]})}),e.jsxs("div",{className:"p-6 border-b mt-4 border-gray-100 relative",children:[e.jsx("div",{className:"absolute top-0 left-0 h-full w-1.5 bg-blue-600 "}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 pl-3",children:[e.jsx("div",{children:e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Your Orders"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(h,{variant:"primary",className:"",onClick:()=>U("siteorders"),children:[e.jsx("i",{className:"fas fa-box-archive !mr-2"}),"View Orders from Site"]}),e.jsxs(h,{variant:"danger",className:"bg-red-600 text-white",isLoading:De,onClick:Re,children:[e.jsx("i",{className:"fas fa-trash !mr-2"}),"Delete All SubItems"]}),W&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-500 text-sm",children:"Total:"}),e.jsxs("span",{className:"text-xl font-bold text-blue-600",children:["₹",Be.toFixed(2)]})]})]})]})]}),e.jsx("div",{className:"py-2 overflow-y-auto custom-scrollbar ",children:W?e.jsx("div",{className:"grid gap-5",children:F.map((s,l)=>{var a,i,o,p,P,g,S;return e.jsxs("div",{className:`group relative p-5 transition-all duration-200
                    ${y===s._id?"border-2 border-blue-500 shadow-lg bg-gradient-to-r from-blue-50 to-blue-50 ring-2 ring-blue-200":"border-l-4 border-blue-600 hover:border-blue-600 hover:shadow-md bg-white"}
                    rounded-xl shadow-[0_3px_10px_rgba(0,0,0,0.02)] hover:shadow-[0_6px_20px_rgba(0,0,0,0.08)]`,children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-5",children:[e.jsxs("div",{className:"relative w-full md:w-32 h-32 bg-gray-50 rounded-lg overflow-hidden",children:[e.jsx("img",{src:(s==null?void 0:s.image)||ls,alt:s.customId||"Product image",className:"w-full h-full object-contain p-3"}),e.jsxs("div",{className:"absolute top-2 right-2 bg-blue-600 text-white text-xs font-bold px-2.5 py-1 rounded-full shadow-sm",children:["×",s.quantity]})]}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:`text-lg font-semibold mb-1.5 ${y===s._id?"text-blue-800":"text-gray-800"}`,children:s.unitName}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("span",{className:`flex cursor-pointer gap-1 items-center px-3 py-1.5 text-sm font-medium rounded-lg transition-colors ${y===s._id?"text-blue-700 bg-blue-100 hover:bg-blue-200":"text-blue-600 bg-blue-50 hover:bg-blue-100"}`,children:[" Total Sub Items : ",e.jsx("span",{className:"",children:((a=s==null?void 0:s.subItems)==null?void 0:a.length)||0})]}),e.jsxs("button",{onClick:()=>Oe(y===s._id?null:s._id),className:`flex cursor-pointer items-center gap-2 px-3 py-1.5 text-sm font-medium rounded-lg transition-all duration-200 ${y===s._id?"text-white bg-blue-600 hover:bg-blue-700 shadow-md":"text-blue-600 bg-blue-50 hover:bg-blue-100"}`,children:[e.jsx("span",{className:"hidden sm:inline",children:"Create Material Items"}),e.jsx("i",{className:`fa ${y===s._id?"fa-chevron-up":"fa-chevron-down"} transition-transform`})]})]})]}),e.jsx("div",{className:"flex items-center gap-2 mb-3",children:e.jsx("span",{className:`px-2.5 py-1 text-xs font-medium rounded-full ${y===s._id?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:s.category||"Generic"})}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Unit Price"}),e.jsxs("p",{className:"font-medium",children:["₹",s.singleUnitCost.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Quantity"}),e.jsx("p",{className:"font-medium",children:s.quantity})]}),(s==null?void 0:s.dimention)&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Dimentions"}),e.jsxs("p",{className:"font-medium",children:["Height: ",((i=s==null?void 0:s.dimention)==null?void 0:i.height)||0,"mm"]}),e.jsxs("p",{className:"font-medium",children:["depth: ",((o=s==null?void 0:s.dimention)==null?void 0:o.depth)||0,"mm"]}),e.jsxs("p",{className:"font-medium",children:["width: ",((p=s==null?void 0:s.dimention)==null?void 0:p.width)||0,"mm"]})]})]})]}),e.jsx("div",{className:"mt-4 pt-3 border-t border-gray-100",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Item Total"}),e.jsxs("p",{className:"text-lg font-bold text-blue-600",children:["₹",(s.singleUnitCost*s.quantity).toFixed(2)]})]})})]})]}),y===s._id&&e.jsxs("div",{className:"mt-6 pt-4 border-t-2 border-blue-200 bg-gradient-to-r from-white to-white rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("i",{className:"fa-solid fa-list text-blue-600"}),e.jsx("h4",{className:"font-semibold text-blue-800",children:"Sub Items"}),e.jsx("span",{className:"text-sm text-gray-500",children:"(Click to edit, changes save by clicking Enter)"})]}),e.jsxs("div",{className:"bg-white rounded-lg border-2 border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"grid grid-cols-17 gap-0 bg-gradient-to-r from-blue-100 to-blue-100 border-b-2 border-blue-200",children:[e.jsx("div",{className:"col-span-3 px-4 py-3 text-sm font-medium text-gray-700 border-r border-gray-200",children:"Ref ID"}),e.jsx("div",{className:"col-span-8 px-4 py-3 text-sm font-medium text-gray-700 border-r border-gray-200",children:"Material Name"}),e.jsx("div",{className:"col-span-2 px-4 py-3 text-sm font-medium text-gray-700 border-r border-gray-200",children:"Quantity"}),e.jsx("div",{className:"col-span-3 px-4 py-3 text-sm font-medium text-gray-700 border-r border-gray-200",children:"Unit"}),e.jsx("div",{className:"col-span-1 px-4 py-3 text-sm font-medium text-gray-700",children:"Action"})]}),s.subItems&&s.subItems.length>0&&s.subItems.map(r=>e.jsxs("div",{className:"grid grid-cols-17 gap-0 border-b border-gray-100 hover:bg-gray-50",children:[e.jsx("div",{className:"col-span-3 border-r border-blue-200",children:e.jsx("div",{className:"w-full px-4 py-3 border-none outline-none focus:bg-blue-50",children:(r==null?void 0:r.refId)||"N/A"})}),e.jsx("div",{className:"col-span-8 border-r border-blue-200",children:(m==null?void 0:m.subItemId)===r._id&&(m==null?void 0:m.field)==="name"?e.jsx("input",{ref:C,type:"text",defaultValue:r.subItemName,className:"w-full px-4 py-3 border-none outline-none focus:bg-blue-50",onBlur:n=>{D(s._id,r._id,"name",n.target.value),j(null)},onKeyDown:n=>{if(n.key==="Enter"){const _=n.target.value;D(s._id,r._id,"name",_),j(null)}n.key==="Escape"&&j(null)}}):e.jsx("div",{className:"px-4 py-3 cursor-pointer hover:bg-blue-50 transition-colors",onClick:()=>j({subItemId:r._id,field:"name"}),children:r.subItemName})}),e.jsx("div",{className:"col-span-2 border-r border-blue-200",children:(m==null?void 0:m.subItemId)===r._id&&(m==null?void 0:m.field)==="quantity"?e.jsx("input",{ref:C,type:"number",defaultValue:r.quantity,min:"0",className:"w-full px-4 py-3 border-none outline-none focus:bg-blue-50",onBlur:n=>{D(s._id,r._id,"quantity",n.target.value),j(null)},onKeyDown:n=>{n.key==="Enter"&&(D(s._id,r._id,"quantity",n.currentTarget.value),j(null)),n.key==="Escape"&&j(null)}}):e.jsx("div",{className:"px-4 py-3 cursor-pointer hover:bg-blue-50 transition-colors",onClick:()=>j({subItemId:r._id,field:"quantity"}),children:r.quantity})}),e.jsx("div",{className:"col-span-3 border-r border-blue-200",children:(m==null?void 0:m.subItemId)===r._id&&(m==null?void 0:m.field)==="unit"?e.jsx("div",{className:"p-2 relative z-50",children:e.jsxs("select",{defaultValue:r.unit,onChange:n=>{D(s._id,r._id,"unit",n.target.value),j(null)},className:"w-full relative z-[50] px-3 py-2 border border-gray-200 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-sm",children:[e.jsx("option",{value:"",disabled:!0,children:"Selected unit"}),xe.map(n=>e.jsx("option",{value:n,children:n},n))]})}):e.jsx("div",{className:"px-4 py-3 cursor-pointer hover:bg-blue-50 transition-colors",onClick:()=>j({subItemId:r._id,field:"unit"}),children:r.unit})}),e.jsx("div",{className:"col-span-1 flex items-center justify-center",children:e.jsx(h,{variant:"danger",onClick:()=>ze(s._id,r._id),disabled:H,isLoading:H,className:"p-2 bg-red-600 text-white  hover:bg-red-50 rounded transition-colors disabled:opacity-50",title:"Delete item",children:e.jsx("i",{className:"fa fa-trash text-sm"})})})]},r._id)),e.jsxs("div",{className:"grid grid-cols-17 gap-0 bg-green-50 border-b border-gray-100",children:[e.jsx("div",{className:"col-span-3 border-r border-gray-200",children:e.jsx("div",{className:"w-full px-4 py-3 border-none outline-none focus:bg-blue-50",children:"Ref Id"})}),e.jsx("div",{className:"col-span-8 border-r border-gray-200",children:e.jsx("input",{type:"text",placeholder:"Enter matterial name...",value:((P=w[s._id])==null?void 0:P.name)||"",onChange:r=>{M(n=>({...n,[s._id]:{...n[s._id],name:r.target.value}}))},onBlur:()=>{var r,n,_;(n=(r=w[s._id])==null?void 0:r.name)!=null&&n.trim()&&((_=w[s._id])!=null&&_.unit)&&T(s._id,w)},onKeyDown:r=>{r.key==="Enter"&&T(s._id,w)},className:"w-full px-4 py-3 bg-transparent border-none outline-none placeholder-gray-400"})}),e.jsx("div",{className:"col-span-2 border-r border-gray-200",children:e.jsx("input",{type:"number",placeholder:"Qty",min:"0",value:((g=w[s._id])==null?void 0:g.quantity)||1,onChange:r=>{M(n=>({...n,[s._id]:{...n[s._id],quantity:Number(r.target.value)||1}}))},className:"w-full px-4 py-3 bg-transparent border-none outline-none placeholder-gray-400"})}),e.jsx("div",{className:"col-span-3 border-r border-gray-200",children:e.jsx("div",{className:"p-2",children:e.jsxs("select",{value:((S=w[s._id])==null?void 0:S.unit)||"",onChange:async r=>{const n={...w[s._id],unit:r.target.value};M(_=>({..._,[s._id]:n})),await T(s._id,n)},className:"w-full relative z-[50] px-3 py-2 border border-gray-200 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-sm",children:[e.jsx("option",{value:"",children:"Selected unit"}),xe.map(r=>e.jsx("option",{value:r,children:r},r))]})})})]}),(!s.subItems||s.subItems.length===0)&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("i",{className:"fa-solid fa-inbox text-2xl mb-2"}),e.jsx("p",{className:"text-sm",children:"No sub-items yet. Start typing in the row above to add items."})]})]})]})]},s._id||l)})}):e.jsxs("div",{className:"py-16 text-center",children:[e.jsx("div",{className:"mx-auto w-24 h-24 bg-blue-50 rounded-full flex items-center justify-center mb-5",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-blue-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})})}),e.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-2",children:"No Order History"}),e.jsx("p",{className:"text-gray-500 max-w-md mx-auto mb-6",children:"Your completed orders will appear here"})]})})]}),e.jsx("section",{className:"mt-4",children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"Export Order Material"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Generate a PDF document of your order materials"})]}),e.jsx(h,{onClick:He,disabled:z,className:"min-w-[140px] bg-blue-600 hover:bg-blue-700 text-white font-medium",size:"lg",children:z?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-file-pdf"}),"Generate PDF"]})})]}),t!=null&&t.generatedLink&&((ce=t==null?void 0:t.generatedLink)==null?void 0:ce.length)>0?(oe=t==null?void 0:t.generatedLink)==null?void 0:oe.map(s=>e.jsx(me,{className:"border-green-200 bg-green-50 ",children:e.jsx(Xe,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx("i",{className:"fas fa-check-circle text-green-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-green-900 mb-1",children:s.pdfName}),e.jsxs("span",{className:"text-sm",children:["Order Number: ",s.refUniquePdf||"N/A"]}),e.jsx("p",{className:"text-sm text-green-700",children:"Your order material PDF is ready to view or download"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full sm:w-auto ",children:[e.jsxs(h,{variant:"outline",onClick:()=>window.open(s.url,"_blank"),className:"border-green-300 text-blue-700 hover:bg-blue-100 hover:border-blue-400",children:[e.jsx("i",{className:"fas mr-2 fa-external-link-alt"}),"View in New Tab"]}),e.jsx(h,{variant:"secondary",onClick:()=>js({src:s.url,alt:"order material"}),className:"border-blue-300 text-blue-700 hover:bg-blue-100 hover:border-blue-400",children:"Download PDF"}),e.jsxs("div",{className:"relative  min-w-[160px]",children:[e.jsx("label",{htmlFor:`pdf-status-${s._id}`,className:"hidden md:block mb-1 text-sm font-medium text-gray-600 absolute top-[-20px]",children:"Order Status"}),e.jsx("select",{id:`pdf-status-${s._id}`,value:s.status||"pending",onChange:async l=>{const a=l.target.value;await Ve(s._id,a)},className:`\r
                                                                                    w-full h-[45px] px-3 py-2 text-md  bg-white border  rounded-xl shadow \r
                                                                                    focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 \r
                                                                                    disabled:opacity-50 appearance-none transition ease-in-out\r
                                                                                    border-blue-300 text-blue-800  hover:border-blue-400\r
                                                                                    `,children:["pending","delivered","shipped","ordered","cancelled"].map(l=>e.jsx("option",{value:l,children:l.charAt(0).toUpperCase()+l.slice(1)},l))}),e.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-3 flex items-center text-gray-500",children:e.jsx("i",{className:"fas fa-chevron-down text-xs"})})]}),e.jsx(h,{variant:"danger",isLoading:Ae,onClick:()=>$e(s._id),className:"border-red-300 bg-red-600 text-white hover:bg-red-600 hover:border-red-400",children:"Delete PDF"})]})]})})},s._id)):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col items-center  justify-center min-h-[300px] w-full bg-white rounded-xl text-center p-6",children:[e.jsx("i",{className:"fa-solid fa-file-lines text-5xl text-blue-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-1",children:"No Pdf Found"}),e.jsx("p",{className:"text-sm text-gray-500",children:"No PDF Generated"})]})})]})})})]})]})};export{xe as ORDERMATERIAL_UNIT_OPTIONS,Ws as default};
