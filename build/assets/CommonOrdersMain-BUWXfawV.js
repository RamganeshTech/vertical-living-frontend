import{u as H,f as K,a as V,r as d,b as $,j as e,O as q}from"./index-Dkf7SbMA.js";import{u as J,a as Q,b as W,c as X}from"./commonOrderHistoryMaterialApi-BbGpmsCk.js";import{B as r}from"./Button-ClgICMLF.js";import{I as k}from"./Input-BRDEoxOp.js";import{C as Y,b as Z,d as ee,a as ae,c as se}from"./Card-BI-_ii1r.js";import{t as te}from"./toast-BSC5QTk1.js";import{L as re}from"./Label-DXAdVnik.js";import{S as ie}from"./StageGuide-CjTD8LTi.js";import"./roleCheck-CXq1v0D5.js";import"./useQuery-h0LZ4b8f.js";import"./useMutation-DtRxugN4.js";const pe=()=>{var y,w,b,P;const{organizationId:m}=H(),{openMobileSidebar:E,isMobile:S}=K(),D=V(),[x,u]=d.useState(""),[N,n]=d.useState(!1),[o,f]=d.useState(null),[h,l]=d.useState(""),{role:c,permission:t}=$(),L=c==="owner"||((y=t==null?void 0:t.commonorder)==null?void 0:y.delete),z=c==="owner"||((w=t==null?void 0:t.commonorder)==null?void 0:w.list),I=c==="owner"||((b=t==null?void 0:t.commonorder)==null?void 0:b.create),j=c==="owner"||((P=t==null?void 0:t.commonorder)==null?void 0:P.edit),{data:i,isLoading:_,error:A,refetch:g}=J(m),{mutateAsync:F,isPending:M}=Q(),{mutateAsync:O,isPending:R}=W(),{mutateAsync:T,isPending:U}=X(),C=location.pathname.split("/");if(C[C.length-1]!=="commonorder")return e.jsx(q,{context:{openMobileSidebar:E,isMobile:S}});const v=async()=>{x.trim()||te({title:"Error",description:"Project Name is mandatory",variant:"destructive"});try{await F({organizationId:m,payload:{projectName:x}}),u(""),n(!1),await g()}catch(a){console.error(a)}},B=async a=>{if(window.confirm("Are you sure?"))try{await O({id:a}),await g()}catch(s){console.error(s)}},G=async()=>{if(!(!h.trim()||!o))try{await T({id:o,payload:{projectName:h}}),f(null),l(""),await g()}catch(a){console.error(a)}};return e.jsxs("div",{className:"max-w-full mx-auto p-2 space-y-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("h1",{className:"text-2xl font-bold text-blue-600",children:[e.jsx("i",{className:"fas fa-layer-group mr-2"}),"Common Projects"]}),e.jsxs("div",{className:"flex gap-3 items-center",children:[!N&&I&&e.jsxs(r,{variant:"primary",onClick:()=>n(!0),children:[e.jsx("i",{className:"fas fa-plus mr-2"}),"Create New Project"]}),e.jsx("div",{className:"w-full sm:w-auto flex justify-end sm:block",children:e.jsx(ie,{organizationId:m,stageName:"commonorder"})})]})]}),N&&e.jsx("div",{onClick:()=>n(!1),className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:e.jsxs("div",{onClick:a=>a.stopPropagation(),className:"flex rounded-2xl bg-white flex-col p-6 gap-3 max-w-lg items-start",children:[e.jsx(re,{className:"text-2xl",children:"Create Project"}),e.jsx(k,{placeholder:"Enter project name",value:x,onChange:a=>u(a.target.value),autoFocus:!0,onKeyDown:a=>{a.key==="Enter"&&v()}}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(r,{variant:"primary",onClick:v,isLoading:M,children:[e.jsx("i",{className:"fas fa-save mr-2"}),"Save"]}),e.jsx(r,{variant:"ghost",onClick:()=>{n(!1),u("")},children:"Cancel"})]})]})}),_&&e.jsx("p",{children:"Loading projects..."}),A&&e.jsx("p",{className:"text-red-500",children:"Something went wrong while loading projects."}),(i==null?void 0:i.length)===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center text-gray-500",children:[e.jsx("i",{className:"fas fa-folder-open text-5xl text-blue-300 mb-4"}),e.jsx("h2",{className:"text-xl font-semibold",children:"No Projects Found"}),e.jsx("p",{children:"Create a project to start managing materials more efficiently."})]}),z&&e.jsx("div",{className:"grid gap-6 grid-cols-1 sm:grid-cols-2 md:grid-cols-3",children:i==null?void 0:i.map(a=>{var p;return e.jsx("div",{className:"transition-transform hover:scale-[1.02] cursor-pointer",children:e.jsxs(Y,{className:"shadow-md hover:shadow-lg border-l-4 border-blue-600",children:[e.jsx(Z,{children:o===a._id?e.jsx(k,{value:h,onChange:s=>{l(s.target.value)},autoFocus:!0,onKeyDown:s=>{s.key},placeholder:"Edit project name"}):e.jsxs(ee,{className:"line-clamp-1",children:[e.jsx("i",{className:"fas fa-project-diagram mr-2 text-blue-500"}),a.projectName||"Untitled"]})}),e.jsxs(ae,{className:"space-y-4",children:[e.jsxs(se,{children:[e.jsx("i",{className:"fas fa-tasks mr-1 text-gray-400"}),"Order Units:"," ",e.jsx("span",{className:"font-medium text-blue-600",children:(p=a==null?void 0:a.selectedUnits)==null?void 0:p.length})]}),e.jsx("div",{className:"flex gap-3 flex-wrap",children:o===a._id?e.jsxs(e.Fragment,{children:[j&&e.jsxs(r,{size:"sm",variant:"primary",onClick:s=>{s.stopPropagation(),G()},isLoading:U,children:[e.jsx("i",{className:"fas fa-check mr-1"}),"Save"]}),j&&e.jsx(r,{size:"sm",variant:"ghost",onClick:s=>{s.stopPropagation(),f(null),l("")},children:"Cancel"})]}):e.jsxs(e.Fragment,{children:[j&&e.jsxs(r,{size:"sm",variant:"outline",onClick:s=>{s.stopPropagation(),f(a._id),l(a.projectName||"")},children:[e.jsx("i",{className:"fas fa-edit mr-1 text-blue-500"}),"Edit"]}),L&&e.jsxs(r,{size:"sm",variant:"danger",onClick:s=>{s.stopPropagation(),B(a._id)},isLoading:R,className:"hover:text-white",children:[e.jsx("i",{className:"fas fa-trash-alt mr-1"}),"Delete"]}),e.jsxs(r,{size:"sm",variant:"secondary",onClick:s=>{s.stopPropagation(),D(`${a._id}`)},children:[e.jsx("i",{className:"fas fa-eye mr-1 text-blue-600"}),"View"]})]})})]})]})},a._id)})})]})};export{pe as default};
