import{u as h,a as R,b as v,q as P,g,d as A,e as C,F as L,j as e,M as O,B as b,t as p}from"./index-D5hl8ps7.js";import{l as E}from"./loadScript-B3Gdq1pJ.js";const F=async({projectId:a,clientId:r,api:n})=>(await n.post(`/paymentconfirmation/createorder/${a}`,{clientId:r})).data.data,$=async({projectId:a,razorpay_order_id:r,razorpay_payment_id:n,razorpay_signature:s,api:i})=>(await i.post(`/paymentconfirmation/verifypayment/${a}`,{razorpay_order_id:r,razorpay_payment_id:n,razorpay_signature:s})).data.data,q=async({projectId:a,api:r})=>(await r.get(`/paymentconfirmation/gettransaction/${a}`)).data.data,D=()=>{const a=["client","staff","owner"],{role:r}=h(),n=g(r);return v({mutationFn:async({projectId:s,clientId:i})=>{if(!r||!a.includes(r))throw new Error("Not allowed");if(!n)throw new Error("API instance missing");return await F({projectId:s,clientId:i,api:n})},onSuccess:(s,{projectId:i})=>{P.invalidateQueries({queryKey:["payment-confirmation",i]})}})},G=()=>{const a=["client","owner","staff"],{role:r}=h(),n=g(r);return v({mutationFn:async({projectId:s,razorpay_order_id:i,razorpay_payment_id:o,razorpay_signature:l})=>{if(!r||!a.includes(r))throw new Error("Not allowed");if(!n)throw new Error("API instance missing");return await $({projectId:s,razorpay_order_id:i,razorpay_payment_id:o,razorpay_signature:l,api:n})},onSuccess:(s,{projectId:i})=>{P.invalidateQueries({queryKey:["payment-confirmation",i]})}})},K=a=>{const r=["client","staff","owner","CTO"],{role:n}=h(),s=g(n);return R({queryKey:["payment-confirmation",a,"transaction"],queryFn:async()=>{if(!n||!r.includes(n))throw new Error("Not allowed");if(!s)throw new Error("API instance missing");return await q({projectId:a,api:s})},enabled:!!a&&!!s&&!!n,retry:!1,refetchOnMount:!1})},U=()=>{var j,w;const{projectId:a,organizationId:r}=A(),n=C(),{data:s,refetch:i,isError:o,error:l,isLoading:k}=K(a),t=s==null?void 0:s.paymentTransaction,x=s==null?void 0:s.totalAmount,{mutateAsync:z,isPending:u}=D(),{mutateAsync:_,isPending:y}=G(),d=L(m=>m.clientProfileStore);if(k)return e.jsx(O,{});if(o||!s)return e.jsxs("div",{className:"max-w-xl mx-auto p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center mb-6",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2",children:"⚠️ Error Occurred"}),e.jsx("p",{className:"text-red-500 text-sm mb-4",children:((w=(j=l==null?void 0:l.response)==null?void 0:j.data)==null?void 0:w.message)||(l==null?void 0:l.message)||"Failed to load cost estimation data"}),e.jsx(b,{onClick:()=>i(),className:"bg-red-600 text-white px-4 py-2",children:"Retry"})]});const I=async()=>{var m,N;try{const c=await z({projectId:a,clientId:d.clientId});if(!await E("https://checkout.razorpay.com/v1/checkout.js")){p({title:"Error",description:"Failed to load Razorpay SDK.",variant:"destructive"});return}const S={key:"rzp_test_Lc5DxL3uS4I6F9",amount:c.amount,currency:"INR",name:"Vertical Living",description:"Project Payment",order_id:c.orderId,handler:async function(f){await _({projectId:a,razorpay_order_id:f.razorpay_order_id,razorpay_payment_id:f.razorpay_payment_id,razorpay_signature:f.razorpay_signature}),p({title:"Success",description:"Payment successful!"})},prefill:{name:d.clientName||"",email:d.email||"",contact:d.phoneNo||""},theme:{color:"#0050b3"}};new window.Razorpay(S).open()}catch(c){p({title:"Error",description:((N=(m=c==null?void 0:c.response)==null?void 0:m.data)==null?void 0:N.message)||(c==null?void 0:c.message)||"Payment failed. Please try again.",variant:"destructive"})}};return e.jsxs("div",{className:"w-full h-full flex flex-col bg-gray-50 p-2 sm:p-4",children:[e.jsxs("div",{className:"flex-shrink-0 flex justify-between items-start sm:items-center mb-4 sm:mb-6 gap-4",children:[e.jsx("div",{className:"flex items-center gap-3 justify-between",children:e.jsxs("h1",{className:"text-xl sm:text-2xl lg:text-3xl font-bold text-blue-700 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-money-check-dollar"}),e.jsx("span",{className:"hidden sm:inline",children:"Payment Transaction"}),e.jsx("span",{className:"sm:hidden",children:"Payment"})]})}),e.jsxs(b,{onClick:()=>n(`/${r}/projectdetails/${a}/paymentconfirmation`),variant:"primary",children:[e.jsx("i",{className:"fa-solid fa-arrow-left mr-1"}),"Go Back"]})]}),e.jsx("div",{className:"flex-1 flex items-center justify-center min-h-0",children:e.jsxs("div",{className:"bg-white w-full max-w-lg rounded-xl shadow-lg border border-gray-200 p-4 sm:p-6 space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("h2",{className:"text-lg sm:text-xl font-semibold text-blue-700 flex items-center justify-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-shield-halved text-blue-600"}),"Secure Payment Gateway"]}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500 mt-1",children:"Securely make your payment to proceed with the project."})]}),e.jsxs("div",{className:"border border-blue-200 rounded-lg p-4 sm:p-5 bg-blue-50 text-center shadow-sm",children:[e.jsx("p",{className:"text-gray-700 text-xs sm:text-sm mb-1",children:"Amount Payable"}),e.jsxs("div",{className:"text-2xl sm:text-3xl font-bold text-blue-800",children:["₹ ",(x==null?void 0:x.toLocaleString("en-IN"))||"0"]})]}),(t==null?void 0:t.status)&&e.jsxs("div",{className:"bg-gray-100 p-3 sm:p-4 rounded-lg border border-gray-300 space-y-2 text-xs sm:text-sm",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("i",{className:`fa-solid ${t.status==="successful"?"fa-circle-check text-green-600":"fa-circle-xmark text-red-600"}`}),e.jsx("span",{className:"font-medium",children:"Status:"})]}),e.jsx("span",{className:`font-semibold ${t.status==="successful"?"text-green-700":"text-red-700"}`,children:t.status.toUpperCase()})]}),t.status==="successful"&&e.jsxs("p",{className:"text-green-700 break-words",children:[e.jsx("span",{className:"font-medium",children:"Paid At:"})," ",new Date(t.paidAt).toLocaleString()]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-gray-600 break-words",children:[e.jsx("span",{className:"font-medium",children:"Order ID:"})," ",e.jsx("span",{className:"text-gray-800 text-xs",children:t.gatewayOrderId})]}),t.gatewayPaymentId&&e.jsxs("p",{className:"text-gray-600 break-words",children:[e.jsx("span",{className:"font-medium",children:"Payment ID:"})," ",e.jsx("span",{className:"text-gray-800 text-xs",children:t.gatewayPaymentId})]})]})]}),e.jsx("div",{className:"pt-2",children:e.jsx("button",{onClick:I,disabled:u||y||(t==null?void 0:t.status)==="successful",className:`w-full py-3 sm:py-4 rounded-md text-white text-base sm:text-lg font-medium transition ${u||y?"bg-blue-400 cursor-not-allowed":(t==null?void 0:t.status)==="successful"?"bg-green-600 cursor-default":"bg-blue-600 hover:bg-blue-700 active:bg-blue-800"}`,children:(t==null?void 0:t.status)==="successful"?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-circle-check"}),"Payment Completed"]}):u||y?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-circle-notch fa-spin"}),e.jsx("span",{className:"hidden sm:inline",children:"Processing Payment..."}),e.jsx("span",{className:"sm:hidden",children:"Processing..."})]}):e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-wallet"}),"Pay Now"]})})}),e.jsx("div",{className:"text-center pt-2",children:e.jsxs("p",{className:"text-xs text-gray-500 flex items-center justify-center gap-1",children:[e.jsx("i",{className:"fa-solid fa-shield-halved text-green-600"}),"Secured by Razorpay"]})})]})})]})};export{U as default};
