import{j as e,u as R,a as E,b as U,r as v,O as q}from"./index-B0GkKy4g.js";import{u,S as T}from"./useDebounce-Du0J4RZ6.js";import{u as z,a as H}from"./modularUnitNewApi-BgEjl7Xn.js";import{B as h}from"./Button-BiqmKnns.js";import{I as M}from"./Input-D-wkkyrL.js";import{t as A}from"./toast-BSC5QTk1.js";import{C as _,a as W}from"./Card-DznFrinu.js";import"./index-C2xk2gLH.js";import"./useQuery-Y36MjM7d.js";import"./useMutation-BZsHp3-C.js";import"./useInfiniteQuery-WWOOGr2-.js";import"./roleCheck-BEAfMS_i.js";const $=({unit:t,onView:c,onDelete:g,isDeleting:o})=>{var m,a,l;return e.jsxs(_,{className:"overflow-hidden hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"relative h-40 bg-gray-100 cursor-pointer",onClick:c,children:[t.productImages&&t.productImages.length>0?e.jsx("img",{src:t.productImages[0].url,alt:t.productName,className:"w-full h-full object-cover"}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:e.jsx("i",{className:"fas fa-image text-3xl"})}),t.category&&e.jsxs("div",{className:"absolute top-2 right-2 bg-white/90 backdrop-blur-sm px-2 py-1 rounded-md text-xs font-medium text-gray-700 shadow",children:[e.jsx("i",{className:"fas fa-tag mr-1 text-blue-600"}),t.category]})]}),e.jsxs(W,{className:"p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("h3",{className:"font-semibold text-base text-gray-800 line-clamp-1 cursor-pointer hover:text-blue-600 flex-1",onClick:c,title:t.productName,children:t.productName||"Untitled Product"}),t.fabricationCost&&e.jsxs("div",{className:"text-xs text-gray-600 bg-orange-50 px-2 py-1 rounded whitespace-nowrap",children:[e.jsx("i",{className:"fas fa-hammer text-orange-600 mr-1"}),"â‚¹",t.fabricationCost.toLocaleString()]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("i",{className:"fas fa-clock text-blue-500"}),e.jsxs("span",{className:"font-medium",children:[t.timeRequired||0," days"]})]}),t.totalAreaSqFt&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("i",{className:"fas fa-expand text-green-500"}),e.jsxs("span",{className:"font-medium",children:[t.totalAreaSqFt," sq ft"]})]})]}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-2",children:e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1 text-gray-600",children:[e.jsx("i",{className:"fas fa-ruler-combined text-purple-500 text-sm"}),e.jsx("span",{className:"font-medium",children:"Dimensions:"})]}),e.jsxs("div",{className:"flex items-center gap-2 font-semibold text-gray-700",children:[e.jsxs("span",{className:"flex items-center gap-0.5",children:[e.jsx("span",{className:"text-[10px] text-gray-500",children:"H:"}),((m=t.dimention)==null?void 0:m.height)||0]}),e.jsx("span",{className:"text-gray-400",children:"Ã—"}),e.jsxs("span",{className:"flex items-center gap-0.5",children:[e.jsx("span",{className:"text-[10px] text-gray-500",children:"W:"}),((a=t.dimention)==null?void 0:a.width)||0]}),e.jsx("span",{className:"text-gray-400",children:"Ã—"}),e.jsxs("span",{className:"flex items-center gap-0.5",children:[e.jsx("span",{className:"text-[10px] text-gray-500",children:"D:"}),((l=t.dimention)==null?void 0:l.depth)||0]}),e.jsx("span",{className:"text-[10px] text-gray-500",children:"mm"})]})]})}),t.attributes&&t.attributes.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1",children:[t.attributes.slice(0,3).map((d,p)=>e.jsx("span",{className:"px-2 py-0.5 bg-blue-50 text-blue-700 text-[10px] rounded-full font-medium",children:d},p)),t.attributes.length>3&&e.jsxs("span",{className:"px-2 py-0.5 bg-gray-100 text-gray-600 text-[10px] rounded-full font-medium",children:["+",t.attributes.length-3," more"]})]}),t.serialNo&&e.jsxs("p",{className:"text-[10px] text-gray-500 flex items-center gap-1 border-t pt-2",children:[e.jsx("i",{className:"fas fa-barcode"}),"SN: ",t.serialNo]}),e.jsxs("div",{className:"flex gap-2 pt-1",children:[e.jsxs(h,{variant:"outline",size:"sm",className:"flex-1 text-xs py-1.5",onClick:c,children:[e.jsx("i",{className:"fas fa-eye mr-1"}),"View"]}),e.jsxs(h,{variant:"danger",size:"sm",isLoading:o,className:"flex-1 bg-red-600 hover:bg-red-700 text-white text-xs py-1.5",onClick:d=>{d.stopPropagation(),g()},children:[e.jsx("i",{className:"fas fa-trash mr-1"}),o?"Deleting...":"Delete"]})]})]})]})},re=()=>{const t=R(),c=E(),{organizationId:g}=U(),o=v.useRef(null),m=c.pathname.includes("/create")||c.pathname.includes("/single"),[a,l]=v.useState({search:"",category:"",minPrice:"0",maxPrice:"100000",sortBy:"createdAt",sortOrder:"desc"}),d=u(a.search,500),p=u(a.category,500),w=u(a.minPrice,800),P=u(a.maxPrice,800),{data:f,fetchNextPage:C,hasNextPage:b,isFetchingNextPage:j,isLoading:L,isError:O,error:N,refetch:D}=z({organizationId:g,limit:20,category:p||void 0,minPrice:w?Number(w):void 0,maxPrice:P?Number(P):void 0,search:d||void 0,sortBy:a.sortBy,sortOrder:a.sortOrder}),k=H();v.useEffect(()=>{const s=o.current;if(!s)return;const r=()=>{const{scrollTop:i,scrollHeight:n,clientHeight:x}=s;n-i-x<100&&b&&!j&&(console.log("ðŸ“œ Loading more products..."),C())};return s.addEventListener("scroll",r),()=>s.removeEventListener("scroll",r)},[b,j,C]);const y=(f==null?void 0:f.pages.flatMap(s=>s.units))||[],S=Object.values(a).filter(s=>s!==""&&s!=="createdAt"&&s!=="desc"&&s!=="0"&&s!=="100000").length,F=()=>{l({search:"",category:"",minPrice:"0",maxPrice:"100000",sortBy:"createdAt",sortOrder:"desc"})},B=async(s,r)=>{var i,n;if(window.confirm(`Are you sure you want to delete "${r}"?`))try{await k.mutateAsync({unitId:s}),A({title:"Success",description:"Product deleted successfully"})}catch(x){A({title:"Error",description:((n=(i=x==null?void 0:x.response)==null?void 0:i.data)==null?void 0:n.message)||"Failed to delete product",variant:"destructive"})}},I=s=>{t(`single/${s}`)};return m?e.jsx(q,{}):e.jsxs("div",{className:"space-y-4 h-full p-2",children:[e.jsxs("header",{className:"flex justify-between items-center p-2",children:[e.jsx("div",{children:e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-cubes mr-3 text-blue-600"}),"Modular Units"]})}),e.jsxs(h,{onClick:()=>t("create"),children:[e.jsx("i",{className:"fas fa-plus mr-2"}),"Add Product"]})]}),L?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("i",{className:"fas fa-spinner fa-spin text-blue-600 text-4xl"})}):O?e.jsxs("div",{className:"max-w-xl sm:min-w-[80%] mx-auto mt-4 p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2 text-xl sm:text-3xl",children:"âš ï¸ Error Occurred"}),e.jsx("p",{className:"text-red-500 mb-4 text-lg sm:text-xl",children:(N==null?void 0:N.message)||"Failed to load products"}),e.jsx(h,{onClick:()=>D(),className:"bg-red-600 text-white px-4 py-2",children:"Retry"})]}):e.jsxs("main",{className:"flex gap-2 !max-h-[90%]",children:[e.jsx("section",{className:"xl:w-80 flex-shrink-0 !max-h-[85vh] overflow-y-auto custom-scrollbar",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-filter mr-2 text-blue-600"}),"Filters"]}),S>0&&e.jsxs("button",{onClick:F,className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:["Clear All (",S,")"]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx("i",{className:"fas fa-search mr-2"}),"Search"]}),e.jsx("input",{type:"text",placeholder:"Name, serial no...",value:a.search,onChange:s=>l(r=>({...r,search:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),e.jsx("input",{type:"text",placeholder:"Wardrobe, Cabinet...",value:a.category,onChange:s=>l(r=>({...r,category:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Price Range"}),e.jsx("div",{className:"px-2 mb-3",children:e.jsx(T,{range:!0,min:0,max:1e5,step:500,value:[Number(a.minPrice),Number(a.maxPrice)],onChange:s=>{const[r,i]=s;l(n=>({...n,minPrice:String(r),maxPrice:String(i)}))},trackStyle:[{backgroundColor:"#3b82f6",height:6}],handleStyle:[{borderColor:"#3b82f6",backgroundColor:"#fff",boxShadow:"0 2px 6px rgba(59, 130, 246, 0.4)",width:18,height:18,marginTop:-6},{borderColor:"#3b82f6",backgroundColor:"#fff",boxShadow:"0 2px 6px rgba(59, 130, 246, 0.4)",width:18,height:18,marginTop:-6}],railStyle:{backgroundColor:"#e5e7eb",height:6}})}),e.jsxs("div",{className:"flex justify-between items-center gap-2 text-sm",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-xs text-gray-500 block mb-1",children:"Min"}),e.jsxs("div",{className:"bg-blue-50 px-3 py-2 rounded-lg font-semibold text-blue-700 text-center",children:["â‚¹",Number(a.minPrice).toLocaleString("en-IN")]})]}),e.jsx("div",{className:"text-gray-400 mt-5",children:"â€”"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-xs text-gray-500 block mb-1",children:"Max"}),e.jsxs("div",{className:"bg-blue-50 px-3 py-2 rounded-lg font-semibold text-blue-700 text-center",children:["â‚¹",Number(a.maxPrice).toLocaleString("en-IN")]})]})]}),e.jsxs("div",{className:"flex flex-col gap-3 items-center mt-2",children:[e.jsx(M,{type:"number",value:a.minPrice,onChange:s=>l(r=>({...r,minPrice:s.target.value})),placeholder:"Min Price",className:"w-full"}),e.jsx(M,{type:"number",value:a.maxPrice,onChange:s=>l(r=>({...r,maxPrice:s.target.value})),placeholder:"Max Price",className:"w-full"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sort By"}),e.jsxs("select",{value:a.sortBy,onChange:s=>l(r=>({...r,sortBy:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"createdAt",children:"Created Date"}),e.jsx("option",{value:"productName",children:"Product Name"}),e.jsx("option",{value:"price",children:"Price"}),e.jsx("option",{value:"timeRequired",children:"Time Required"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sort Order"}),e.jsxs("select",{value:a.sortOrder,onChange:s=>l(r=>({...r,sortOrder:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"desc",children:"Descending"}),e.jsx("option",{value:"asc",children:"Ascending"})]})]})]})]})}),y.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[300px] w-full bg-white rounded-xl text-center p-6",children:[e.jsx("i",{className:"fas fa-box-open text-5xl text-blue-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-1",children:"No Products Found"}),e.jsxs("p",{className:"text-sm text-gray-500",children:[a.search||a.category||a.minPrice!=="0"||a.maxPrice!=="100000"?"Try adjusting your filters to find products.":"Looks like there are no products yet.",e.jsx("br",{}),"Click on ",e.jsx("strong",{children:'"Add Product"'})," to get started ðŸš€"]})]}):e.jsxs("div",{ref:o,className:"flex-1 max-h-[100%] overflow-y-auto",children:[e.jsx("div",{className:"grid gap-6 grid-cols-1 sm:grid-cols-2 xl:grid-cols-3",children:y.map(s=>e.jsx($,{unit:s,onView:()=>I(s._id),onDelete:()=>B(s._id,s.productName||"Untitled Product"),isDeleting:k.isPending},s._id))}),j&&e.jsx("div",{className:"flex justify-center py-8",children:e.jsxs("div",{className:"flex items-center gap-2 text-blue-600",children:[e.jsx("i",{className:"fas fa-spinner fa-spin text-2xl"}),e.jsx("span",{className:"text-sm font-medium",children:"Loading more products..."})]})}),!b&&y.length>0&&e.jsx("div",{className:"flex justify-center py-6",children:e.jsxs("p",{className:"text-gray-400 text-sm font-medium",children:[e.jsx("i",{className:"fas fa-check-circle mr-2"}),"You've reached the end of the list"]})})]})]})]})};export{re as default};
