import{b as pe,c as ue,e as fe,a2 as ge,a3 as Ne,a4 as je,a5 as ye,a6 as be,a7 as ve,a8 as we,d as Se,r as y,j as e,M as Pe,O as Ce,B as m,I as f,t as c,a9 as De}from"./index-DyM6T-eT.js";import{C as ae,a as ie}from"./Card-CnQJFMCV.js";import{d as ke}from"./downloadFile-CQDFTv8V.js";import{I as Ae}from"./InfoToolTip-DZNysQ5i.js";import{d as Le}from"./dateFormator-BGKi5rfZ.js";import{B as ne}from"./Badge-zJ_n6Uf_.js";import{T as Te}from"./TextArea-D3aqW0sD.js";const ze=()=>{var Q,_,z,G,M,O,B,V,Y,H,J,K,X,Z,F,q,ee;const{id:i}=pe(),g=ue(),b=fe(),{data:s,isLoading:k,refetch:h}=ge(i),{mutateAsync:A}=Ne(),{mutateAsync:L}=je(),{mutateAsync:N,isPending:x}=ye(),{mutateAsync:u,isPending:o}=be(),{mutateAsync:T,isPending:E}=ve(),{mutateAsync:I,isPending:v}=we(),{role:w,permission:j}=Se(),le=w==="owner"||((Q=j==null?void 0:j.procurement)==null?void 0:Q.list),$=w==="owner"||((_=j==null?void 0:j.procurement)==null?void 0:_.edit),[W,C]=y.useState(!1),[n,S]=y.useState({}),[R,D]=y.useState(!1),[r,P]=y.useState({}),re=async()=>{var t,l;try{if(n!=null&&n.phoneNumber&&!/^\d{10}$/.test(n==null?void 0:n.phoneNumber.trim()))throw new Error("Phone number should contain exactly 10 digit numbers");await L({id:i,payload:n}),C(!1),c({title:"Success",description:"Delivery Details Updated"})}catch(a){c({variant:"destructive",title:"Error",description:((l=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:l.message)||(a==null?void 0:a.message)||"Update failed"})}},ce=async()=>{var t,l;try{if(r.phoneNumber&&!/^\d{10}$/.test(r.phoneNumber.trim()))throw new Error("Phone number should contain exactly 10 digit numbers");await A({id:i,payload:r}),c({title:"Success",description:"Shop Details Updated"}),D(!1)}catch(a){c({variant:"destructive",title:"Error",description:((l=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:l.message)||(a==null?void 0:a.message)||"Update failed"})}},oe=async()=>{var t,l;try{await N({id:i}),c({title:"Success",description:"Pdf Generated successfully"})}catch(a){c({title:"Error",description:((l=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:l.message)||(a==null?void 0:a.message)||"Failed to generate link",variant:"destructive"})}},de=async t=>{var l,a;try{await u({id:i,pdfId:t}),c({title:"Success",description:"PDF deleted"})}catch(d){c({variant:"destructive",title:"Error",description:((a=(l=d==null?void 0:d.response)==null?void 0:l.data)==null?void 0:a.message)||(d==null?void 0:d.message)||"failed to delete"})}},xe=async()=>{var t,l;try{if(s!=null&&s.isSyncWithPaymentsSection)return c({variant:"destructive",title:"Error",description:"already sent to payments section"});await T({id:s._id}),h==null||h(),c({title:"Success",description:"Procurement order sent to Payments Section"})}catch(a){c({variant:"destructive",title:"Error",description:((l=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:l.message)||(a==null?void 0:a.message)||"operation failed"})}},me=async(t,l)=>{var a,d;try{t.stopPropagation(),await I({id:i,quoteId:l}),h==null||h(),c({title:"Success",description:"Shop quote selected successfully"})}catch(p){c({variant:"destructive",title:"Error",description:((d=(a=p==null?void 0:p.response)==null?void 0:a.data)==null?void 0:d.message)||(p==null?void 0:p.message)||"operation failed"})}};if(k)return e.jsx(Pe,{});if(b.pathname.includes("shopquote"))return e.jsx(Ce,{});if(le)return e.jsxs("div",{className:"p-1 max-w-full max-h-full overflow-y-auto space-y-8",children:[e.jsx("header",{className:"flex gap-2 items-center",children:e.jsxs("section",{className:"flex flex-1 justify-between items-center",children:[e.jsxs("div",{className:"flex gap-2 justify-between items-center",children:[e.jsx("div",{onClick:()=>g(-1),className:"bg-blue-50 hover:bg-slate-300 flex items-center justify-between w-8 h-8 border border-[#a6aab8] text-sm cursor-pointer rounded-md px-2 ",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsxs("h1",{className:"text-2xl sm:text-3xl font-bold text-blue-700",children:[e.jsx("span",{className:"!text-gray-600 text-2xl",children:"Procurement No:"})," "," ",s!=null&&s.procurementNumber?s.procurementNumber:s!=null&&s.refPdfId?(z=s.refPdfId)==null?void 0:z.replace(/-pdf$/,""):"N/A"]})]}),e.jsx("div",{className:"flex gap-2 items-center ",children:e.jsxs("div",{className:"flex gap-1 items-center",children:[e.jsx(Ae,{content:"Click the button to send the details to  payments dept",position:"bottom",className:""}),e.jsx(m,{variant:"primary",disabled:s.isSyncWithPaymentsSection,isLoading:E,className:"disabled:cursor-not-allowed",onClick:xe,children:"Send To Payments"}),!s.isSyncWithPaymentsSection&&e.jsx(Ee,{data:s,refetch:h})]})})]})}),e.jsx("section",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 min-h-[140px] divide-y md:divide-y-0 md:divide-x divide-gray-100",children:[e.jsxs("div",{className:"p-4 flex flex-col relative group transition-all hover:bg-slate-50/50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-50 flex items-center justify-center text-blue-600",children:e.jsx("i",{className:"fa-solid fa-store text-sm"})}),e.jsx("h4",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Shop Details"}),!R&&$&&e.jsx("button",{onClick:()=>{P(s==null?void 0:s.shopDetails),D(!0)},className:"ml-auto cursor-pointer text-gray-400 hover:text-blue-600 transition-colors",title:"Edit Shop Details",children:e.jsx("i",{className:"fa-solid fa-pen-to-square text-sm"})})]}),R?e.jsxs("div",{className:"space-y-2 animate-in fade-in zoom-in-95 duration-200",children:[e.jsx(f,{placeholder:"Shop Name",value:(r==null?void 0:r.shopName)||"",onChange:t=>P({...r,shopName:t.target.value}),className:"h-8 text-xs"}),e.jsx(f,{placeholder:"Contact Person",value:(r==null?void 0:r.contactPerson)||"",onChange:t=>P({...r,contactPerson:t.target.value}),className:"h-8 text-xs"}),e.jsx(f,{placeholder:"Phone",value:(r==null?void 0:r.phoneNumber)||"",onChange:t=>{/^\d*$/.test(t.target.value)&&P({...r,phoneNumber:t.target.value})},className:"h-8 text-xs",maxLength:10}),e.jsx(Te,{placeholder:"Address",value:(r==null?void 0:r.address)||"",onChange:t=>P({...r,address:t.target.value}),className:" text-xs"}),e.jsxs("div",{className:"flex gap-2 pt-1",children:[e.jsx(m,{size:"sm",onClick:()=>{ce(),D(!1)},className:"h-7 text-xs px-3 bg-blue-600",children:"Save"}),e.jsx(m,{size:"sm",variant:"outline",onClick:()=>D(!1),className:"h-7 text-xs px-3",children:"Cancel"})]})]}):e.jsxs("div",{className:"flex flex-col gap-1.5 mt-1",children:[e.jsx("p",{className:"font-bold text-gray-900 text-base leading-tight truncate",children:((G=s==null?void 0:s.shopDetails)==null?void 0:G.shopName)||e.jsx("span",{className:"text-gray-400 italic",children:"No Shop Name"})}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx("i",{className:"fa-solid fa-user text-gray-400 w-3"}),e.jsx("span",{className:"truncate",children:((M=s==null?void 0:s.shopDetails)==null?void 0:M.contactPerson)||"-"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx("i",{className:"fa-solid fa-phone text-gray-400 w-3"}),e.jsx("span",{className:"font-mono",children:((O=s==null?void 0:s.shopDetails)==null?void 0:O.phoneNumber)||"-"})]}),e.jsxs("div",{className:"flex items-start gap-2 text-xs text-gray-500 mt-1",children:[e.jsx("i",{className:"fa-solid fa-location-dot text-gray-400 w-3 mt-0.5"}),e.jsx("p",{className:"line-clamp-2 leading-snug",children:((B=s==null?void 0:s.shopDetails)==null?void 0:B.address)||"-"})]})]})]}),e.jsxs("div",{className:"p-4 flex flex-col relative group transition-all hover:bg-slate-50/50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-orange-50 flex items-center justify-center text-orange-600",children:e.jsx("i",{className:"fa-solid fa-truck-fast text-sm"})}),e.jsx("h4",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Delivery Details"}),!W&&$&&e.jsx("button",{onClick:()=>{S(s==null?void 0:s.deliveryLocationDetails),C(!0)},className:"ml-auto cursor-pointer text-gray-400 hover:text-orange-600 transition-colors",title:"Edit Delivery Details",children:e.jsx("i",{className:"fa-solid fa-pen-to-square text-sm"})})]}),W?e.jsxs("div",{className:"space-y-2 animate-in fade-in zoom-in-95 duration-200",children:[e.jsx(f,{placeholder:"Site Name",value:(n==null?void 0:n.siteName)||"",onChange:t=>S({...n,siteName:t.target.value}),className:"h-8 text-xs"}),e.jsx(f,{placeholder:"Supervisor",value:(n==null?void 0:n.siteSupervisor)||"",onChange:t=>S({...n,siteSupervisor:t.target.value}),className:"h-8 text-xs"}),e.jsx(f,{placeholder:"Phone",value:(n==null?void 0:n.phoneNumber)||"",onChange:t=>{/^\d*$/.test(t.target.value)&&S({...n,phoneNumber:t.target.value})},className:"h-8 text-xs",maxLength:10}),e.jsx(f,{placeholder:"Address",value:(n==null?void 0:n.address)||"",onChange:t=>S({...n,address:t.target.value}),className:"w-full"}),e.jsxs("div",{className:"flex gap-2 pt-1",children:[e.jsx(m,{size:"sm",onClick:()=>{re(),C(!1)},className:"h-7 text-xs px-3 bg-blue-600",children:"Save"}),e.jsx(m,{size:"sm",variant:"outline",onClick:()=>C(!1),className:"h-7 text-xs px-3",children:"Cancel"})]})]}):e.jsxs("div",{className:"flex flex-col gap-1.5 mt-1",children:[e.jsx("p",{className:"font-bold text-gray-900 text-base leading-tight truncate",children:((V=s==null?void 0:s.deliveryLocationDetails)==null?void 0:V.siteName)||e.jsx("span",{className:"text-gray-400 italic",children:"No Site Name"})}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx("i",{className:"fa-solid fa-helmet-safety text-gray-400 w-3"}),e.jsx("span",{children:((Y=s==null?void 0:s.deliveryLocationDetails)==null?void 0:Y.siteSupervisor)||"No Supervisor"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx("i",{className:"fa-solid fa-mobile-screen text-gray-400 w-3"}),e.jsx("span",{className:"font-mono",children:((H=s==null?void 0:s.deliveryLocationDetails)==null?void 0:H.phoneNumber)||"-"})]}),e.jsxs("div",{className:"flex items-start gap-2 text-xs text-gray-500 mt-1",children:[e.jsx("i",{className:"fa-solid fa-map-pin text-gray-400 w-3 mt-0.5"}),e.jsx("p",{className:"line-clamp-2 leading-snug",children:((J=s==null?void 0:s.deliveryLocationDetails)==null?void 0:J.address)||"No Address"})]})]})]}),e.jsxs("div",{className:"px-4  flex flex-col justify-center border-dashed border-l border-gray-200 bg-gray-50/30",children:[e.jsxs("div",{className:"mb-2 flex gap-[3px]",children:[e.jsx("span",{className:"text-[10px] text-gray-400 uppercase font-semibold",children:"From:"}),e.jsx(ne,{className:"mbg-blue-100 uppercase text-[10px] !px-1 !font-bold",children:(s==null?void 0:s.fromDeptName)||"Order Material"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] text-gray-400 uppercase font-semibold",children:"Order Number"}),e.jsxs("h2",{className:"text-2xl font-mono font-bold text-gray-800 tracking-tight leading-none",children:["#",(s==null?void 0:s.fromDeptNumber)||"N/A"]})]}),(s==null?void 0:s.quoteNumber)&&(s==null?void 0:s.quoteNumber)>1&&e.jsx("div",{className:"",children:e.jsxs("span",{className:"text-[10px] text-gray-400 uppercase font-semibold",children:["Quote Number: ",s==null?void 0:s.quoteNumber," "]})}),e.jsx("div",{className:"mt-4 pt-3 border-t border-gray-100 border-dashed",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Rate Status"}),s!=null&&s.isConfirmedRate?e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2 py-1 rounded-full text-[10px] font-bold bg-green-100 text-green-700 border border-green-200",children:[e.jsx("i",{className:"fa-solid fa-check-circle"})," Confirmed"]}):e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2 py-1 rounded-full text-[10px] font-bold bg-yellow-100 text-yellow-700 border border-yellow-200",children:[e.jsx("i",{className:"fa-solid fa-clock"})," Pending"]})]})})]}),e.jsxs("div",{className:"p-4 flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("i",{className:"fa-regular fa-calendar-check text-gray-400"}),e.jsx("h4",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Timeline"})]}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"flex justify-between items-center text-xs",children:[e.jsx("span",{className:"text-gray-500",children:"Created"}),e.jsx("span",{className:"font-medium text-gray-900 font-mono bg-gray-100 px-1.5 py-0.5 rounded",children:Le(s==null?void 0:s.createdAt)})]})})]}),e.jsx("div",{className:"mt-auto",children:e.jsxs("div",{className:`p-2 rounded-lg border flex items-center gap-3 ${s!=null&&s.isSyncWithPaymentsSection?"bg-purple-50 border-purple-100":"bg-gray-50 border-gray-100"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${s!=null&&s.isSyncWithPaymentsSection?"bg-purple-100 text-purple-600":"bg-gray-200 text-gray-400"}`,children:e.jsx("i",{className:`fa-solid ${s!=null&&s.isSyncWithPaymentsSection?"fa-file-invoice-dollar":"fa-hourglass"}`})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] uppercase font-bold text-gray-400",children:"Payment Process"}),e.jsx("span",{className:`text-xs font-bold ${s!=null&&s.isSyncWithPaymentsSection?"text-purple-700":"text-gray-500"}`,children:s!=null&&s.isSyncWithPaymentsSection?"Sent to Payment":"Not Sent Yet"})]})]})})]})]})}),e.jsxs("section",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-bold text-indigo-700 flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-file-invoice"})," Vendor Quotes Received"]}),e.jsxs(ne,{variant:"secondary",className:"bg-indigo-50 text-indigo-700",children:[((K=s==null?void 0:s.shopQuotes)==null?void 0:K.length)||0," Quotes"]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:((X=s==null?void 0:s.shopQuotes)==null?void 0:X.length)>0?s.shopQuotes.map((t,l)=>{var d,p,se,te;const a=(d=t.selectedUnits)==null?void 0:d.reduce((U,he)=>U+(he.totalCost||0),0);return e.jsxs("div",{onClick:()=>g(`shopquote/${t._id}`),className:"group cursor-pointer bg-white border border-gray-200 rounded-xl p-4 shadow-sm hover:shadow-md hover:border-indigo-300 transition-all relative overflow-hidden",children:[e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1 bg-indigo-500 group-hover:w-1.5 transition-all"}),e.jsxs("div",{className:"flex justify-between items-start mb-3 pl-2",children:[e.jsx("div",{children:e.jsx("h4",{className:"text-sm font-bold text-gray-900 group-hover:text-indigo-600 transition-colors",children:(t==null?void 0:t.shopId).shopName||`Vendor ${l+1}`})}),e.jsx("div",{className:"flex items-center gap-2",children:((p=s==null?void 0:s.selectedShopId)==null?void 0:p._id)===((se=t==null?void 0:t.shopId)==null?void 0:se._id)?e.jsxs("div",{className:"h-7 px-3 rounded-lg bg-green-100 text-green-700 text-[10px] font-bold uppercase flex items-center border border-green-200 animate-in fade-in zoom-in duration-300",children:[e.jsx("i",{className:"fas fa-check mr-1"})," Selected"]}):e.jsxs(m,{onClick:U=>me(U,t._id),disabled:v,className:"flex items-center justify-center h-7 px-3 rounded-lg bg-indigo-600 text-white text-[10px] font-bold uppercase tracking-tight hover:bg-indigo-700 active:scale-95 transition-all shadow-sm disabled:opacity-50",children:[v?e.jsx("i",{className:"fas fa-spinner fa-spin mr-1"}):null,"Select Shop"]})})]}),e.jsxs("div",{className:"pl-2 space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-end mt-4",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Total Quoted Price:"}),e.jsxs("span",{className:"text-lg font-black text-indigo-700",children:["â‚¹",a==null?void 0:a.toLocaleString()]})]}),e.jsxs("div",{className:"pt-2 border-t border-dashed border-gray-100 flex items-center justify-between text-[10px] text-gray-400",children:[e.jsxs("span",{children:[((te=t.selectedUnits)==null?void 0:te.length)||0," Items quoted"]}),e.jsxs("span",{className:"group-hover:translate-x-1 transition-transform text-indigo-500 font-bold",children:["View Details ",e.jsx("i",{className:"fas fa-arrow-right ml-1"})]})]})]})]},t._id)}):e.jsxs("div",{className:"col-span-full py-8 text-center bg-gray-50 rounded-xl border border-dashed border-gray-300",children:[e.jsx("i",{className:"fas fa-link text-gray-300 text-3xl mb-2"}),e.jsx("p",{className:"text-sm text-gray-500 italic",children:"No quotes received from vendors yet."})]})})]}),e.jsx(ae,{children:e.jsx(ie,{className:"py-6 space-y-5",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center",children:[e.jsx("h3",{className:"text-lg font-bold text-indigo-700 mb-2 sm:mb-0",children:"Items List ðŸ“‹"}),e.jsx("div",{})]}),e.jsx("div",{className:"overflow-x-auto rounded border border-gray-200",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-100",children:[e.jsx("thead",{className:"bg-gray-200 text-sm text-gray-700 font-medium",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-5 py-2 text-center",children:"S.No"}),e.jsx("th",{className:"px-5 py-2 text-center",children:"Item Name"}),e.jsx("th",{className:"px-5 py-2 text-center",children:"Quantity"}),e.jsx("th",{className:"px-5 py-2 text-center",children:"Unit"}),e.jsx("th",{className:"px-5 py-2 text-center",children:"Rate"}),e.jsx("th",{className:"px-5 py-2 text-center",children:"Total"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-100 text-sm",children:((Z=s.selectedUnits)==null?void 0:Z.length)>0?(F=s.selectedUnits)==null?void 0:F.map((t,l)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-5 py-2 text-center",children:l+1}),e.jsx("td",{className:"px-5 py-2 text-center",children:t.subItemName}),e.jsx("td",{className:"px-5 py-2 text-center",children:t.quantity}),e.jsx("td",{className:"px-5 py-2 text-center",children:t.unit}),e.jsx("td",{className:"px-5 py-2 text-center",children:t.rate}),e.jsx("td",{className:"px-5 py-2 text-center",children:t.totalCost})]},l)):e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-5 py-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-indigo-50 flex items-center justify-center",children:e.jsx("i",{className:"fas fa-hand-pointer text-indigo-400 text-xl"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-base font-bold text-slate-700",children:"No Shop Selected"}),e.jsxs("p",{className:"text-xs text-slate-500 max-w-[250px] mx-auto mt-1",children:["Please review the vendor quotes above and click",e.jsx("span",{className:"text-indigo-600 font-bold mx-1",children:"Select Shop"}),"to finalize the rates for this order."]})]})]})})})})]})}),e.jsxs("div",{className:"flex !ml-auto w-fit mr-[20px] sm:flex-row items-start sm:items-center gap-2",children:[e.jsx("h3",{className:"text-lg font-bold text-blue-700",children:"Total Cost "}),e.jsx("div",{className:"flex  items-center gap-3 text-sm",children:e.jsxs("p",{className:"text-base font-semibold text-gray-800",children:["â‚¹ ",(s==null?void 0:s.totalCost)||0]})})]})]})})}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"Export Procurement Material"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Generate a PDF document of your Procurements"})]}),e.jsx(m,{onClick:oe,disabled:x,className:"min-w-[140px] bg-blue-600 hover:bg-blue-700 text-white font-medium",size:"lg",children:x?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-file-pdf"}),"Generate PDF"]})})]}),s!=null&&s.procurementPdfs&&((q=s==null?void 0:s.procurementPdfs)==null?void 0:q.length)>0?(ee=s==null?void 0:s.procurementPdfs)==null?void 0:ee.map(t=>e.jsx(ae,{className:"border-green-200 bg-green-50 ",children:e.jsx(ie,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx("i",{className:"fas fa-check-circle text-green-600"})}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-green-900 mb-1",children:[e.jsx("span",{className:"text-sm text-black",children:"Pdf Reference Id: "}),t.refUniquePdf||"N/A"]}),e.jsx("p",{className:"text-sm text-green-700",children:"Your Procurement PDF is ready to view or download"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full sm:w-auto ",children:[e.jsxs(m,{variant:"outline",onClick:()=>window.open(t.url,"_blank"),className:"border-green-300 text-blue-700 hover:bg-blue-100 hover:border-blue-400",children:[e.jsx("i",{className:"fas mr-2 fa-external-link-alt"}),"View in New Tab"]}),e.jsx(m,{variant:"secondary",onClick:()=>ke({src:t.url,alt:"Procurement"}),className:"border-blue-300 text-blue-700 hover:bg-blue-100 hover:border-blue-400",children:"Download PDF"}),e.jsx(m,{variant:"danger",isLoading:o,onClick:()=>de(t._id),className:"border-red-300 bg-red-600 text-white hover:bg-red-600 hover:border-red-400",children:"Delete PDF"})]})]})})},t._id)):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col items-center  justify-center min-h-[300px] w-full bg-white rounded-xl text-center p-6",children:[e.jsx("i",{className:"fa-solid fa-file-lines text-5xl text-blue-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-1",children:"No Pdf Found"}),e.jsx("p",{className:"text-sm text-gray-500",children:"No PDF Generated"})]})})]})})]})},Ee=({data:i,refetch:g})=>{const[b,s]=y.useState(900),{mutateAsync:k,isPending:h}=De();y.useEffect(()=>{if(i!=null&&i.isSyncWithPaymentsSection)return;const x=()=>{var w;const E=((w=new Date(i==null?void 0:i.createdAt))==null?void 0:w.getTime())+2*60*1e3,I=new Date().getTime(),v=Math.floor((E-I)/1e3);return v<=0?(s(0),!1):(s(v),!0)};if(!x())return;const o=setInterval(()=>{x()||clearInterval(o)},1e3);return()=>clearInterval(o)},[i==null?void 0:i.createdAt,i==null?void 0:i.isSyncWithPaymentsSection]);const A=x=>{const u=Math.floor(x/60),o=x%60;return`${u.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`},L=async()=>{var x,u;try{if(i!=null&&i.isSyncWithPaymentsSection||b===0)return c({variant:"destructive",title:"Action Restricted",description:"Automation has already processed this record."});await k({id:i._id}),g==null||g(),c({title:"Automation Disabled",description:"This procurement will no longer be automatically moved to payments."})}catch(o){c({variant:"destructive",title:"Error",description:((u=(x=o==null?void 0:o.response)==null?void 0:x.data)==null?void 0:u.message)||(o==null?void 0:o.message)||"Operation failed"})}},N=(i==null?void 0:i.isSyncWithPaymentsSection)||b===0;return e.jsx(m,{variant:"danger",disabled:N,isLoading:h,className:`min-w-[140px] flex items-center justify-center gap-2 transition-all ${N?"bg-gray-400 opacity-70":"bg-red-600 hover:bg-red-700"}`,onClick:L,children:e.jsxs("div",{className:"flex items-center justify-between w-full gap-3",children:[e.jsx("span",{children:N?"Automation Done":"Cancel Automation"}),!N&&e.jsx("span",{className:"bg-white/20 px-2 py-0.5 rounded text-xs font-mono border-l border-white/30",children:A(b)})]})})};export{ze as default};
