import{j as e,B as A,c as Z,e as ee,q as te,g as re,b as K,t as E,u as ae,r as Q,M as xe,a as pe,O as ge}from"./index-hYGmCEO1.js";import{u as se}from"./projectApi-Gwage_AH.js";import{S as he,a as fe,b as ye,c as Ne,d as je}from"./Select-DnRgplP7.js";import{e as be,f as ve}from"./quoteVariantApi-DvPnd4Sz.js";import{C as we,a as Ce}from"./Card-ChYAICVg.js";import{d as Me,f as Se}from"./dateFormator-BGKi5rfZ.js";import{c as Te,u as Ae}from"./labourRateconfigApi-BiMEe7s8.js";import{S as ke}from"./StageGuide-BKWoPeLK.js";const H={plywood:1,laminate:1},Ie=()=>({itemName:"",plywoodNos:{quantity:0,thickness:0},laminateNos:{quantity:0,thickness:0},carpenters:0,days:0,profitOnMaterial:0,profitOnLabour:0,rowTotal:0,remarks:""}),X=()=>({itemName:"",description:"",quantity:0,cost:0,rowTotal:0}),z=(r,g)=>{if(r.length===0)return[];const f=r.length,i=r[0],h=i.carpenters*i.days*g*(1+(i.profitOnLabour||0)/100)/f;return r.map(w=>{var o,t;const v=((o=w.plywoodNos)==null?void 0:o.quantity)||0,C=((t=w.laminateNos)==null?void 0:t.quantity)||0,T=(v*H.plywood+C*H.laminate)*(1+(w.profitOnMaterial||0)/100);return{...w,rowTotal:Math.round(T+h)}})},Qe=({data:r,isEditing:g,labourCost:f,updateFurniture:i,removeFurniture:N})=>{const y=o=>{const t=o.coreMaterials.reduce((c,m)=>c+m.rowTotal,0),n=o.fittingsAndAccessories.reduce((c,m)=>c+m.rowTotal,0),s=o.glues.reduce((c,m)=>c+m.rowTotal,0),a=o.nonBrandMaterials.reduce((c,m)=>c+m.rowTotal,0);return{core:t,fittings:n,glues:s,nbms:a,furnitureTotal:t+n+s+a}},h=(o,t,n)=>{var k;const s=[...r.coreMaterials];t==="imageUrl"?(g&&(s[o].newImageFile=n),s[o].imageUrl=n,s[o].previewUrl=URL.createObjectURL(n)):t==="plywoodNos"||t==="laminateNos"?s[o][t]={...s[o][t]||{},...n}:s[o][t]=n;const a=z(s,f),c=a.reduce((I,O)=>I+(O.rowTotal||0),0),m=a.length,u=m>0?Math.round(c/m):0,l=((k=a==null?void 0:a[0])==null?void 0:k.profitOnMaterial)||0,p=(I,O=!1)=>I.map(P=>{const B=l,U=O?u:(P.quantity||0)*(P.cost||0),R=U*(B/100),$=Math.round(U+R);return{...P,itemName:O?"Glue":P.itemName,quantity:O?1:P.quantity,cost:O?u:P.cost,profitOnMaterial:B,rowTotal:$}}),M={...r,coreMaterials:a,fittingsAndAccessories:p(r.fittingsAndAccessories),glues:p(r.glues,!0),nonBrandMaterials:p(r.nonBrandMaterials)};M.totals=y(M),i==null||i(M)},w=o=>{var u;const t=o.reduce((l,p)=>l+(p.rowTotal||0),0),n=o.length,s=n>0?Math.round(t/n):0,a=((u=o==null?void 0:o[0])==null?void 0:u.profitOnMaterial)||0,c=(l,p=!1)=>l.map(M=>{const k=p?s:M.cost||0,I=p?k:(M.quantity||0)*k,O=I*(a/100);return{...M,cost:k,profitOnMaterial:a,rowTotal:Math.round(I+O)}}),m={...r,coreMaterials:o,fittingsAndAccessories:c(r.fittingsAndAccessories),glues:c(r.glues,!0),nonBrandMaterials:c(r.nonBrandMaterials)};m.totals=y(m),i==null||i(m)},v=(o,t,n,s)=>{const a=[...r[o]];if(a[t][n]=s,o!=="glues"){const l=(a[t].quantity||0)*(a[t].cost||0),p=l*((a[t].profitOnMaterial||0)/100);a[t].rowTotal=Math.round(l+p)}else{const l=a[t].cost||0,p=l*((a[t].profitOnMaterial||0)/100);a[t].rowTotal=Math.round(l+p)}const c=t===a.length-1,m=a[t].itemName||a[t].description||a[t].quantity||a[t].cost;c&&m&&a.push(X());const u={...r,[o]:a};u.totals=y(u),i&&i(u)},C=()=>e.jsxs("div",{className:"mt-4",children:[e.jsxs("h3",{className:"font-semibold text-md mb-2",children:["Core Materials - Total: ₹",r==null?void 0:r.totals.core.toLocaleString("en-IN")]}),e.jsx("div",{className:"overflow-x-auto  rounded-md",children:e.jsxs("table",{className:"min-w-full text-sm bg-white shadow-sm",children:[e.jsxs("thead",{className:"bg-blue-50 text-sm font-semibold text-gray-600",children:[e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Image"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Item Name"}),e.jsx("th",{className:"text-center px-6 py-1 text-xs font-medium text-gray-500 uppercase tracking-wider",colSpan:2,children:"Plywood"}),e.jsx("th",{className:"text-center px-6 py-1 text-xs font-medium text-gray-500 uppercase tracking-wider",colSpan:2,children:"Laminate"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"No. of Carpenters / Day"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"No. of Days"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Profit % Material"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Profit % Labour"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Remarks"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Total"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Actions"})]}),e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-6 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Qty"}),e.jsx("th",{className:"text-center px-6 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Thk"}),e.jsx("th",{className:"text-center px-6 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Qty"}),e.jsx("th",{className:"text-center px-6 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Thk"})]})]}),e.jsx("tbody",{children:r.coreMaterials.map((o,t)=>e.jsxs("tr",{className:"group relative border-none !border-b-1 px-4 py-2 transition-all duration-150 hover:bg-gray-50",children:[t===0&&e.jsxs("td",{rowSpan:r.coreMaterials.length,children:[e.jsx("input",{type:"file",className:"w-full px-2 py-3 text-center outline-none",onChange:n=>{var s;return h(0,"imageUrl",(s=n.target.files)==null?void 0:s[0])}}),o.previewUrl&&e.jsx("img",{src:o.previewUrl,className:"h-10 mt-2 mx-auto"})]}),e.jsx("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{value:o.itemName,placeholder:"TV Unit | Wardrobe",onChange:n=>h(t,"itemName",n.target.value),className:"w-full px-2 py-1 text-center outline-none"})}),["plywoodNos","laminateNos"].map(n=>["quantity","thickness"].map(s=>e.jsx("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",placeholder:`${s==="quantity"?"QTY":"THK"}`,value:o[n][s]||"",onChange:a=>{Number(a.target.value)>=0&&h(t,n,{...o[n],[s]:Number(a.target.value)})},className:"w-full px-2 py-1 text-center outline-none"})},`${n}-${s}`))),t===0&&e.jsxs(e.Fragment,{children:[e.jsx("td",{rowSpan:r.coreMaterials.length,className:"px-1 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",placeholder:"no of carpentors",value:o.carpenters||"",onChange:n=>h(t,"carpenters",Number(n.target.value)),className:"w-full px-[2px] py-1 text-center outline-none"})}),e.jsx("td",{rowSpan:r.coreMaterials.length,className:"px-1 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",placeholder:"no of days",value:o.days||"",onChange:n=>h(t,"days",Number(n.target.value)),className:"w-full px-[2px] py-1 text-center outline-none"})})]}),e.jsx("td",{className:"px-1 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",placeholder:"profit percent",value:o.profitOnMaterial||"",onChange:n=>h(t,"profitOnMaterial",Number(n.target.value)),className:"w-full px-[2px] py-1 text-center outline-none"})}),t===0&&e.jsx(e.Fragment,{children:e.jsx("td",{rowSpan:r.coreMaterials.length,className:"px-1 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",placeholder:"profit percent",value:o.profitOnLabour||"",onChange:n=>h(t,"profitOnLabour",Number(n.target.value)),className:"w-full px-[2px] py-1 text-center outline-none"})})}),e.jsx("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{value:o.remarks,placeholder:"remarks",onChange:n=>h(t,"remarks",n.target.value),className:"w-full px-2 py-1 text-center outline-none"})}),e.jsxs("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:["₹",o.rowTotal.toLocaleString("en-IN")]}),e.jsx("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx(A,{variant:"danger",onClick:()=>{const n=[...r.coreMaterials];n.splice(t,1);const s=z(n,f);w(s)},className:"px-1 text-xs bg-red-600 text-white",children:"Remove"})})]},t))})]})}),e.jsx("div",{className:"mt-2 text-right",children:e.jsx(A,{onClick:()=>{const o=[...r.coreMaterials,Ie()],t=z(o,f),n={...r,coreMaterials:t};n.totals=y(n),i==null||i(n)},children:"+ Add Core Material"})})]}),T=(o,t)=>{var n;return e.jsxs("div",{className:"mt-6",children:[e.jsxs("h3",{className:"font-semibold text-md mb-2",children:[o," - Total: ₹",(n=r==null?void 0:r.totals[t==="fittingsAndAccessories"?"fittings":t])==null?void 0:n.toLocaleString("en-IN")]}),e.jsx("div",{className:"overflow-x-auto  rounded-md",children:e.jsxs("table",{className:"min-w-full text-sm bg-white shadow-sm",children:[e.jsx("thead",{className:"bg-blue-50 text-sm font-semibold text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Item Name"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Description"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Quantity"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cost"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Profit %"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{children:r[t].map((s,a)=>e.jsxs("tr",{className:"group relative border-none !border-b-1 px-4 !py-2 transition-all duration-150 hover:bg-gray-50",children:[e.jsx("td",{className:"p-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{value:s.itemName||"",placeholder:"Item Name",onChange:c=>v(t,a,"itemName",c.target.value),className:"w-full px-2 py-1 text-center outline-none"})}),e.jsx("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{value:s.description,placeholder:"description",onChange:c=>v(t,a,"description",c.target.value),className:"w-full px-2 py-1 text-center outline-none"})}),e.jsx("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",placeholder:"enter quantity",value:s.quantity||"",onChange:c=>{Number(c.target.value)>=0&&v(t,a,"quantity",Number(c.target.value))},className:"w-full px-2 py-1 text-center outline-none"})}),e.jsx("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",value:s.cost||"",placeholder:"enter cost",onChange:c=>v(t,a,"cost",Number(c.target.value)),className:"w-full px-2 py-1 text-center outline-none"})}),e.jsx("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",placeholder:"enter profit",value:(s.profitOnMaterial??0)||"",onChange:c=>v(t,a,"profitOnMaterial",Number(c.target.value)),className:"w-full px-2 py-1 text-center outline-none"})}),e.jsxs("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:["₹",s.rowTotal.toLocaleString("en-IN")]}),e.jsx("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx(A,{variant:"danger",onClick:()=>{const c=[...r[t]];c.splice(a,1);const m={...r,[t]:c};m.totals=y(m),i&&i(m)},className:"px-1 text-xs bg-red-600 text-white",children:"Remove"})})]},a))})]})}),e.jsx("div",{className:"mt-2 text-right",children:e.jsxs(A,{onClick:()=>{const s=[...r[t],X()],a={...r,[t]:s};a.totals=y(a),i&&i(a)},children:["+ Add ",o," Item"]})})]})};return e.jsxs("div",{className:"shadow-md p-4 my-4 border rounded-lg bg-white",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-700",children:["Product: ",r.furnitureName]}),N&&e.jsx(A,{variant:"danger",size:"sm",onClick:N,className:"bg-red-600 text-white",children:"Remove Product"})]}),C(),T("Fittings","fittingsAndAccessories"),T("Glues","glues"),T("Non-Branded Materials","nonBrandMaterials"),e.jsxs("div",{className:"mt-6 text-right text-xl text-green-700 font-bold",children:["Product Total: ₹",r.totals.furnitureTotal.toLocaleString("en-IN")]})]})},Oe=async({api:r,organizationId:g,projectId:f,formData:i})=>{const{data:N}=await r.post(`/quote/quotegenerate/createquote/${g}/${f}`,i,{headers:{"Content-Type":"multipart/form-data"}});if(!N.ok)throw new Error(N.message||"Failed to create quote.");return N.data},Pe=async({api:r,organizationId:g,id:f,projectId:i,formData:N})=>{const y=await r.put(`/quote/quotegenerate/editquote/${g}/${i}/${f}`,N);if(!y.data.ok)throw new Error(y.data.message||"Failed to create quote.");return y.data.data},Ee=()=>{const r=["owner","staff","CTO"],{role:g}=Z(),f=re(g);return ee({mutationFn:async({organizationId:i,projectId:N,formData:y})=>{if(!g||!r.includes(g))throw new Error("Not allowed to create quotes");if(!f)throw new Error("API instance for role not found");return await Oe({api:f,organizationId:i,projectId:N,formData:y})},onSuccess:(i,{organizationId:N})=>{te.invalidateQueries({queryKey:["quote-material-items",N]})}})},Le=()=>{const r=["owner","staff","CTO"],{role:g}=Z(),f=re(g);return ee({mutationFn:async({organizationId:i,projectId:N,formData:y,id:h})=>{if(!g||!r.includes(g))throw new Error("Not allowed to create quotes");if(!f)throw new Error("API instance for role not found");return await Pe({api:f,organizationId:i,projectId:N,formData:y,id:h})},onSuccess:(i,{organizationId:N})=>{te.invalidateQueries({queryKey:["quote-material-items",N]})}})},qe=({quote:r,organizationId:g,setFurnitures:f,setIsEditingId:i,setQuoteType:N,setEditQuoteNo:y,setFiltersMain:h})=>{var n,s,a;const{mutateAsync:w,isPending:v}=be(),{role:C,permission:T}=K(),o=C==="owner"||((n=T==null?void 0:T.internalquote)==null?void 0:n.delete),t=async c=>{var m,u;try{await w({id:c,organizationId:g}),E({title:"Success",description:"Items deleted successfully"})}catch(l){E({title:"Error",description:((u=(m=l==null?void 0:l.response)==null?void 0:m.data)==null?void 0:u.message)??"Operation failed"})}};return e.jsx(we,{className:"w-full border-l-4 border-blue-600 shadow-md bg-white hover:shadow-lg transition-all",children:e.jsxs(Ce,{className:"p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"my-1",children:[e.jsxs("h3",{className:"text-sm font-bold text-blue-700  ",children:["Project: ",e.jsx("span",{className:"text-black",children:((s=r==null?void 0:r.projectId)==null?void 0:s.projectName)||"Project"})]}),e.jsxs("span",{className:"text-[12px] font-semibold text-gray-500",children:["Quote No: ",e.jsx("span",{className:"text-black",children:r.quoteNo||"N/A"})]})]}),e.jsxs("p",{className:"text-xs text-gray-500 ",children:["Created on: ",Me(r.createdAt)," -  ",Se(r.createdAt)]})]}),e.jsx("i",{className:"fas fa-file-alt text-gray-400 text-xl"})]}),e.jsxs("p",{className:"text-sm text-gray-500 italic",children:[e.jsx("strong",{children:"Furnitures: "})," ",((a=r.furnitures)==null?void 0:a.length)||0]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsxs(A,{size:"sm",variant:"secondary",onClick:()=>{const{furnitures:c}=r,m=c.map(u=>({furnitureName:u.furnitureName,coreMaterials:u.coreMaterials.map(l=>({itemName:(l==null?void 0:l.itemName)||"",plywoodNos:(l==null?void 0:l.plywoodNos)||{quantity:0,thickness:0},laminateNos:l.laminateNos||{quantity:0,thickness:0},carpenters:l.carpenters||0,days:l.days||0,profitOnMaterial:l.profitOnMaterial||0,profitOnLabour:l.profitOnLabour||0,rowTotal:l.rowTotal||0,remarks:l.remarks||"",imageUrl:l.imageUrl||"",previewUrl:l.imageUrl||""})),fittingsAndAccessories:u.fittingsAndAccessories||[],glues:u.glues||[],nonBrandMaterials:u.nonBrandMaterials||[],totals:{core:u.coreMaterialsTotal||0,fittings:u.fittingsAndAccessoriesTotal||0,glues:u.gluesTotal||0,nbms:u.nonBrandMaterialsTotal||0,furnitureTotal:u.furnitureTotal||0}}));console.log("parsedFurniture",m),y(r==null?void 0:r.quoteNo),f(m),i(r._id),N(()=>{var u;return((u=r==null?void 0:r.furnitures)==null?void 0:u.length)>1?"residential":"single"}),h({projectId:r.projectId._id,projectName:r.projectId.projectName})},children:[e.jsx("i",{className:"fas fa-eye mr-1"})," Edit"]}),o&&e.jsxs(A,{size:"sm",isLoading:v,variant:"danger",className:"bg-red-600 text-white",onClick:()=>t(r._id),children:[e.jsx("i",{className:"fas fa-trash mr-1"})," Delete"]})]})]})})},Be=({setFurnitures:r,setEditQuoteNo:g,setIsEditingId:f,setFiltersMain:i,setQuoteType:N})=>{var u;const{organizationId:y}=ae(),[h,w]=Q.useState({projectId:"",projectName:"",createdAt:""}),{role:v,permission:C}=K(),T=v==="owner"||((u=C==null?void 0:C.internalquote)==null?void 0:u.list),{data:o}=se(y),t=o==null?void 0:o.map(l=>({_id:l._id,projectName:l.projectName})),{data:n,isLoading:s}=ve(y,{createdAt:h.createdAt,projectId:h.projectId,quoteNo:""}),a=n==null?void 0:n.filter(l=>l.furnitures.length),c=()=>{w({projectId:"",projectName:"",createdAt:""})},m=Object.values(h).filter(Boolean).length;return e.jsx("div",{children:e.jsxs("main",{className:"flex gap-2 !max-h-[80vh]",children:[e.jsx("div",{className:"xl:w-80 flex-shrink-0",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-filter mr-2 text-blue-600"}),"Filters"]}),m>0&&e.jsxs("button",{onClick:c,className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:["Clear All (",m,")"]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Created Date"}),e.jsx("input",{type:"date",onChange:l=>w(p=>({...p,createdAt:l.target.value})),value:h.createdAt,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Project"}),e.jsx("select",{value:(h==null?void 0:h.projectId)||"",onChange:l=>{const p=t==null?void 0:t.find(M=>M._id===l.target.value);p&&w(M=>({...M,projectId:p._id,projectName:p.projectName}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:t==null?void 0:t.map(l=>e.jsx("option",{value:l._id,children:l.projectName},l._id))})]})]})]})}),T&&e.jsx("section",{className:"w-full max-h-full  gap-2  overflow-y-auto  min-h-full",children:s?e.jsx(xe,{}):a!=null&&a.length?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:a==null?void 0:a.map(l=>e.jsx(e.Fragment,{children:e.jsx(qe,{setEditQuoteNo:g,setFurnitures:r,setIsEditingId:f,setQuoteType:N,setFiltersMain:i,quote:l,organizationId:y},l._id)}))}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center text-gray-700",children:[e.jsx("i",{className:"fas fa-file-circle-exclamation text-gray-300 text-7xl mb-4"}),e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"No Quotes Found"}),e.jsxs("p",{className:"text-base text-gray-500 leading-relaxed max-w-md",children:["You haven't generated any quote variants yet.",e.jsx("br",{}),"Please create a quote by clicking the + Product section to view brand-wise breakdowns here."]})]})})]})})},q=r=>r.filter(g=>{var f,i;return!!((f=g.itemName)!=null&&f.trim())||!!((i=g.description)!=null&&i.trim())}),We=()=>{var W,J;const r=pe(),{organizationId:g}=ae(),{data:f}=se(g),[i,N]=Q.useState({categoryId:"",categoryName:""});let{data:y=0}=Te({organizationId:g,categoryId:i.categoryId}),{data:h=[]}=Ae(g);Q.useEffect(()=>{if(h&&(h==null?void 0:h.length)>0&&!i.categoryId){const d=h[0];N({categoryId:d._id,categoryName:d.name})}},[h]);const{role:w,permission:v}=K(),C=w==="owner"||((W=v==null?void 0:v.internalquote)==null?void 0:W.create),T=w==="owner"||((J=v==null?void 0:v.internalquote)==null?void 0:J.edit),o=Q.useMemo(()=>(f==null?void 0:f.map(d=>({_id:d._id,projectName:d.projectName})))||[],[f]),[t,n]=Q.useState({projectId:"",projectName:""}),[s,a]=Q.useState([]),[c,m]=Q.useState(!1),[u,l]=Q.useState(""),[p,M]=Q.useState(null),[k,I]=Q.useState(null),[O,P]=Q.useState(null),{mutateAsync:B,isPending:U}=Ee(),{mutateAsync:R,isPending:$}=Le(),ne=d=>{I(d)},oe=()=>k==="single"?"Single Quote":k==="residential"?"Residential Quote":"";Q.useEffect(()=>{k==="single"&&!p?(a([]),D("Common Category")):k==="residential"&&!p&&(a([]),m(!0))},[k]),console.log("furnitures",s);const D=d=>{a(j=>[...j,{furnitureName:d,coreMaterials:[ie()],fittingsAndAccessories:[G()],glues:[G()],nonBrandMaterials:[G()],totals:{core:0,fittings:0,glues:0,nbms:0,furnitureTotal:0}}])},le=d=>{a(j=>j.filter((x,b)=>b!==d))},ie=()=>({itemName:"",plywoodNos:{quantity:0,thickness:0},laminateNos:{quantity:0,thickness:0},carpenters:0,days:0,profitOnMaterial:0,profitOnLabour:0,rowTotal:0,remarks:""}),G=()=>({itemName:"",description:"",quantity:0,cost:0,rowTotal:0}),V=s==null?void 0:s.reduce((d,j)=>d+j.totals.furnitureTotal,0),ce=async()=>{var d,j;try{if(!t.projectId){E({title:"Error",description:"Please select a project",variant:"destructive"});return}const x=new FormData;x.append("furnitures",JSON.stringify(s.map(b=>({furnitureName:b.furnitureName,coreMaterials:b.coreMaterials.map(S=>{if(Object.values(S).some(L=>!!L)){const{imageUrl:L,previewUrl:F,..._}=S;return _}return null}).filter(Boolean),fittingsAndAccessories:q(b.fittingsAndAccessories),glues:q(b.glues),nonBrandMaterials:q(b.nonBrandMaterials),coreMaterialsTotal:b.totals.core,fittingsAndAccessoriesTotal:b.totals.fittings,gluesTotal:b.totals.glues,nonBrandMaterialsTotal:b.totals.nbms,furnitureTotal:b.totals.furnitureTotal})))),s.forEach((b,S)=>{b.coreMaterials.forEach((L,F)=>{L.imageUrl&&x.append(`images[${S}][${F}]`,L.imageUrl)})}),x.append("grandTotal",V.toString()),x.append("notes","Generated"),await B({organizationId:g,projectId:t.projectId,formData:x}),E({title:"Success",description:"Created Successfully, Visit in Quote Generator Section"}),a([]),I(null)}catch(x){E({title:"Error",description:((j=(d=x==null?void 0:x.response)==null?void 0:d.data)==null?void 0:j.message)||(x==null?void 0:x.message)||"failed to generate the items",variant:"destructive"})}},de=async()=>{var d,j;try{if(!t.projectId){E({title:"Error",description:"Please select a project",variant:"destructive"});return}const x=new FormData,b=s.map((S,L)=>{const F=S.coreMaterials.map((_,me)=>{const{previewUrl:Fe,newImageFile:Y,...ue}=_;return Y&&x.append(`images[${L}][${me}]`,Y),{...ue,imageUrl:_.imageUrl||null}});return{furnitureName:S.furnitureName,coreMaterials:F,fittingsAndAccessories:q(S.fittingsAndAccessories),glues:q(S.glues),nonBrandMaterials:q(S.nonBrandMaterials),coreMaterialsTotal:S.totals.core,fittingsAndAccessoriesTotal:S.totals.fittings,gluesTotal:S.totals.glues,nonBrandMaterialsTotal:S.totals.nbms,furnitureTotal:S.totals.furnitureTotal}});x.append("furnitures",JSON.stringify(b)),x.append("grandTotal",V.toString()),x.append("notes","Updated via frontend"),O&&x.append("quoteNo",O),p&&(await R({organizationId:g,projectId:t.projectId,formData:x,id:p}),E({title:"Updated!",description:"Quote edited successfully."}),a([]),I(null),M(null))}catch(x){E({title:"Error",description:((j=(d=x==null?void 0:x.response)==null?void 0:d.data)==null?void 0:j.message)||(x==null?void 0:x.message)||"Failed to Update the Quote",variant:"destructive"})}};return location.pathname.includes("internalquotenew")?e.jsx(ge,{}):e.jsxs("div",{className:`h-full mx-auto max-h-full ${p?"overflow-y-auto":""} `,children:[e.jsxs("header",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 py-1 border-b-1 border-[#818283]",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-file mr-3 text-blue-600"}),"Internal Quote Entry"]}),(s==null?void 0:s.length)>0&&e.jsxs("p",{className:"ml-[30px] mt-[5px] block text-[15px] text-gray-800",children:["Single Labour cost:  ",e.jsxs("span",{className:"text-black font-semibold",children:["₹",y]})]})]}),e.jsxs("div",{className:"flex gap-6 items-center ",children:[e.jsx("div",{children:e.jsxs(A,{className:"flex items-center",onClick:()=>{r("internalquotenew")},children:[e.jsx("i",{className:"fas fa-new mr-1",children:" "})," New Version"]})}),C&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Select QuoteType"}),e.jsxs(he,{onValueChange:d=>ne(d),children:[e.jsx(fe,{className:"w-full",children:e.jsx(ye,{placeholder:"Select Quote",selectedValue:k||""})}),e.jsx(Ne,{children:["single","residential"].map(d=>e.jsx(je,{value:d.toString(),children:d},d))})]})]}),C&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Select Project *"}),e.jsxs("select",{value:t.projectId,onChange:d=>{const j=o.find(x=>x._id===d.target.value);j&&n({projectId:j._id,projectName:j.projectName})},className:" px-2 py-2 rounded-xl border border-blue-200 focus:border-blue-200 active:border-blue-200",children:[e.jsx("option",{value:"",children:"Select a project"}),o.map(d=>e.jsx("option",{value:d._id,children:d.projectName},d._id))]})]}),s.length>0&&e.jsxs("div",{className:"text-right flex gap-2 items-center",children:[e.jsx("div",{className:"text-xs text-gray-600 uppercase tracking-widest",children:"Grand Total"}),e.jsxs("div",{className:"text-xl font-semibold text-green-600",children:["₹",V.toLocaleString("en-IN")]})]}),C&&e.jsxs(A,{className:"flex items-center",onClick:()=>{m(!0)},children:[e.jsx("i",{className:"fas fa-add mr-1",children:" "})," Create"]}),e.jsx("div",{className:"w-full sm:w-auto flex justify-end sm:block",children:e.jsx(ke,{organizationId:g,stageName:"materialquote"})})]})]}),c&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 bg-opacity-40 backdrop-blur-sm transition",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg p-6 w-full max-w-md relative animate-scaleIn",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-800",children:"Add New Quote"}),e.jsx("input",{className:"w-full border border-gray-300 rounded px-3 py-2 mb-4 outline-none focus:ring-2 focus:ring-blue-400",placeholder:"Enter Product Name",value:u,autoFocus:!0,onChange:d=>l(d.target.value),onKeyDown:d=>{if(d.key==="Enter"){if(!u.trim())return;D(u),l(""),m(!1)}}}),e.jsxs("div",{className:"flex justify-end gap-3 mt-4",children:[e.jsx(A,{variant:"secondary",onClick:()=>m(!1),children:"Cancel"}),e.jsx(A,{onClick:()=>{u.trim()&&(D(u),l(""),m(!1))},children:"Create"})]})]})}),s.length>0&&e.jsxs("section",{className:"shadow overflow-y-auto max-h-[86%]",children:[!p&&e.jsx("h1",{className:"text-2xl text-gray-500",children:oe()}),s.map((d,j)=>e.jsx(Qe,{index:j,labourCost:y,data:d,updateFurniture:x=>{const b=[...s];b[j]=x,a(b)},removeFurniture:()=>le(j),isEditing:!!p},j))]}),s.length!==0&&e.jsxs("div",{className:"mt-1 text-right flex gap-2 justify-end",children:[(C||T)&&e.jsx(A,{variant:"primary",isLoading:U||$,onClick:p?de:ce,className:"px-6 py-2 bg-blue-600 text-white rounded",children:"Save Quote"}),!p&&(C||T)&&e.jsx(A,{variant:"secondary",onClick:()=>{a([]),I(null)},className:"",children:"Cancel"}),p&&e.jsx(A,{variant:"secondary",onClick:()=>{M(null),a([]),I(null),P(null)},className:"",children:"Cancel"})]}),!p&&(s==null?void 0:s.length)===0&&e.jsx("section",{className:"my-4",children:e.jsx(Be,{setEditQuoteNo:P,setIsEditingId:M,setFurnitures:a,setQuoteType:I,setFiltersMain:n})})]})};export{We as default,q as filterValidSimpleRows};
