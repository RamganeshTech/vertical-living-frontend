import{r as x,c as Y,j as e,N as xe,a as fe,b as he}from"./index-By5P0A7l.js";import{B as p}from"./Button-DLUK8O0t.js";import{t as j}from"./toast-BSC5QTk1.js";import{d as ge,b as pe}from"./materialInventoryApi-v2on_EC-.js";import ue from"./MaterialOverviewLoading-9Ck4pGPe.js";import{u as be}from"./projectApi-_duyp5-I.js";import{u as ve,a as je,b as Ne,c as ye}from"./MaterialInventoryCartApi-ClXjHct3.js";import{S as Ce}from"./SearchSelectNew-B6SBCGTt.js";import{C as K,a as X,b as we,d as ke,c as Se}from"./Card-CFqBlVQz.js";import{L as T}from"./Label-TAdUzpu-.js";import{I as Ie}from"./Input-DKpmFZl7.js";import{B as z}from"./Badge-BHW6q2S6.js";import"./roleCheck-YGaMnK_P.js";import"./useQuery-Cc7pLKfK.js";import"./useMutation-7YLqc7VE.js";import"./useInfiniteQuery-DQF0m-E9.js";import"./Skeleton-FCBR4RgB.js";const Ee=({navigate:c,data:l,editMode:N,projectOptions:d,selectedProjectId:y,handleSelectProjectId:r,handleCancel:u,handleSave:w,updateMutation:k,handleEdit:n})=>{var s,S,b;const{role:C,permission:f}=Y(),E=C==="owner"||((s=f==null?void 0:f.productinventory)==null?void 0:s.edit);return e.jsx("div",{children:e.jsxs("header",{className:"mb-4 flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("div",{onClick:()=>c(-1),className:"bg-white hover:bg-slate-300 flex items-center justify-between w-8 h-8 border border-[#a6aab8] text-sm cursor-pointer rounded-md px-2",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold bg-gradient-to-r from-violet-600 to-blue-600 bg-clip-text text-transparent",children:((S=l==null?void 0:l.specification)==null?void 0:S.subcategory)||((b=l==null?void 0:l.specification)==null?void 0:b.type)||"Material Details"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"View and manage material inventory information"})]})]}),e.jsx("div",{className:"flex gap-3",children:N?e.jsxs(e.Fragment,{children:[e.jsxs(p,{onClick:u,variant:"outline",className:"border-2 border-gray-300 hover:bg-gray-50",children:[e.jsx("i",{className:"fas fa-times mr-2"}),"Cancel"]}),e.jsx(p,{onClick:w,disabled:k.isPending,className:"bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white shadow-lg",children:k.isPending?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin mr-2"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-save mr-2"}),"Save Changes"]})})]}):e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-full sm:w-64",children:e.jsx(Ce,{options:d,placeholder:"Select project",searchPlaceholder:"Search projects...",value:y||void 0,onValueChange:F=>r(F||""),searchBy:"name",displayFormat:"simple",className:"w-full"})}),E&&e.jsxs(p,{onClick:n,className:"bg-gradient-to-r from-violet-600 to-blue-600 hover:from-violet-700 hover:to-blue-700 text-white shadow-lg",children:[e.jsx("i",{className:"fas fa-edit mr-2"}),"Edit Details"]})]})})]})})},Fe=x.memo(Ee),Me=({displayValues:c,form:l,editMode:N,selectedVariant:d,handleVariantSelect:y,handleChange:r,handleEdit:u,editableFields:w,hasVariants:k,handleAddToCart:n,handleUpdateCartQuantity:C,handleRemoveFromCart:f,cartQuantity:E,isInCart:s,selectedProjectId:S,addToCartMutation:b,updateCartQuantityMutation:F,removeFromCartMutation:m,projects:v})=>{var I,M,L;return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsx(K,{className:"overflow-hidden border-2 border-violet-100 shadow-xl hover:shadow-2xl transition-shadow duration-300",children:e.jsxs(X,{className:"p-0",children:[c!=null&&c.image?e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:c.image,alt:c.itemCode||"Material",className:"w-full h-auto object-cover rounded-t-xl",onError:t=>{t.target.src=xe}}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/50 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 rounded-t-xl"})]}):e.jsx("div",{className:"bg-gradient-to-br from-violet-100 to-blue-100 h-80 flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-violet-300",children:[e.jsx("i",{className:"fas fa-image text-6xl mb-3"}),e.jsx("p",{className:"text-sm",children:"No Image Available"})]})}),k&&e.jsxs("div",{className:"p-4 bg-white border-b",children:[e.jsx(T,{className:"text-sm text-gray-600 mb-2 block",children:"Select Color Variant"}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:(I=l.variants)==null?void 0:I.map((t,h)=>e.jsx("button",{onClick:()=>y(t),className:`px-3 py-2 rounded-lg border-2 transition-all ${(d==null?void 0:d.color)===t.color?"border-violet-500 bg-violet-50 text-violet-700":"border-gray-300 hover:border-violet-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full border border-gray-300",style:{backgroundColor:t.color.toLowerCase()==="white"?"#ffffff":t.color.toLowerCase()==="gold"?"#FFD700":t.color.toLowerCase()==="grey"?"#808080":t.color}}),e.jsx("span",{className:"capitalize text-sm",children:t.color})]})},h))})]}),e.jsx("div",{className:"p-6 bg-gradient-to-br from-violet-50 to-blue-50",children:e.jsxs("div",{className:"space-y-4",children:[c.mrp&&e.jsx("div",{children:e.jsxs("p",{className:"text-2xl font-bold text-gray-900 mb-3",children:["₹",c.mrp,e.jsx("span",{className:"text-xs font-normal text-gray-500 ml-2",children:"MRP"})]})}),e.jsxs("div",{className:"space-y-2 text-sm",children:[(l==null?void 0:l.category)&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(T,{className:"text-gray-500",children:"Category"}),e.jsx(z,{variant:"default",children:l.category})]}),c.itemCode&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(T,{className:"text-gray-500",children:"Code"}),e.jsx(z,{variant:"success",className:"font-mono",children:c.itemCode})]}),c.color&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(T,{className:"text-gray-500",children:"Color"}),e.jsx(z,{variant:"outline",className:"capitalize",children:c.color})]})]}),e.jsxs("div",{className:"pt-4 border-t border-violet-200",children:[s?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between bg-white rounded-lg p-2",children:[e.jsx(p,{size:"sm",variant:"outline",onClick:()=>C(-1),disabled:F.isPending||m.isPending,className:"h-8 w-8 p-0",children:e.jsx("i",{className:"fas fa-minus"})}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Quantity"}),e.jsx("span",{className:"font-bold text-lg",children:E})]}),e.jsx(p,{size:"sm",variant:"outline",onClick:()=>C(1),disabled:F.isPending,className:"h-8 w-8 p-0",children:e.jsx("i",{className:"fas fa-plus"})})]}),e.jsxs(p,{variant:"danger",size:"sm",className:"w-full bg-red-600 text-white",onClick:f,isLoading:m.isPending,children:[e.jsx("i",{className:"fas fa-trash mr-2"}),"Remove from Cart"]})]}):e.jsxs(p,{className:"w-full bg-gradient-to-r from-violet-600 to-blue-600 hover:from-violet-700 hover:to-blue-700 text-white",onClick:n,disabled:!S,isLoading:b.isPending,children:[e.jsx("i",{className:"fas fa-shopping-cart mr-2"}),"Add to Cart"]}),s&&e.jsx("div",{className:"mt-3 p-2 bg-green-50 rounded-lg",children:e.jsxs("p",{className:"text-xs text-green-700 text-center",children:[e.jsx("i",{className:"fas fa-check-circle mr-1"}),"Item in cart for ",(M=v==null?void 0:v.find(t=>t._id===S))==null?void 0:M.projectName]})})]})]})})]})})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(K,{className:"border-2 border-violet-100 shadow-xl",children:[e.jsxs(we,{className:"bg-gradient-to-r from-violet-50 to-blue-50 border-b-2 border-violet-100",children:[e.jsxs(ke,{className:"text-2xl text-violet-700 flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-info-circle"}),"Specifications"]}),e.jsx(Se,{children:N?"Edit material specifications below":"Detailed material information"})]}),e.jsxs(X,{className:"p-6",children:[N?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:w.map(t=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs(T,{htmlFor:t.key,className:"flex items-center gap-2 text-violet-700",children:[e.jsx("i",{className:`fas ${t.icon} text-sm`}),t.label]}),e.jsx(Ie,{id:t.key,name:t.key,type:t.type,value:l[t.key]||"",onChange:r,placeholder:`Enter ${t.label.toLowerCase()}`,className:"transition-all duration-200 hover:border-violet-300"})]},t.key))}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:w.map(t=>{if(t.key==="Variant")return null;const h=l[t==null?void 0:t.key];return h?e.jsx("div",{className:"bg-gradient-to-br from-white to-violet-50 p-4 rounded-xl border border-violet-100 hover:shadow-md transition-all duration-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-violet-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx("i",{className:`fas ${t.icon} text-violet-600`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wider mb-1",children:t.label}),e.jsx("p",{className:"text-gray-900 font-semibold truncate",children:t.key==="mrp"?`₹${h}`:t.key==="watt"?`${h}W`:h})]})]})},t.key):null})}),!N&&k&&e.jsxs("div",{className:"mt-8 pt-6 border-t-2 border-violet-100",children:[e.jsxs("h3",{className:"text-lg font-semibold text-violet-700 mb-4 flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-palette"}),"Available Variants"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:(L=l.variants)==null?void 0:L.map((t,h)=>e.jsxs("div",{className:`p-4 rounded-xl border-2 cursor-pointer transition-all ${(d==null?void 0:d.color)===t.color?"border-violet-500 bg-violet-50":"border-gray-200 hover:border-violet-300"}`,onClick:()=>y(t),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full border-2 border-gray-300",style:{backgroundColor:t.color.toLowerCase()==="white"?"#ffffff":t.color.toLowerCase()==="gold"?"#FFD700":t.color.toLowerCase()==="grey"?"#808080":t.color}}),e.jsx("span",{className:"font-semibold capitalize",children:t.color})]}),(d==null?void 0:d.color)===t.color&&e.jsx("i",{className:"fas fa-check-circle text-violet-600"})]}),e.jsx("p",{className:"text-sm text-gray-600 font-mono",children:t.itemCode}),e.jsxs("p",{className:"text-lg font-bold text-gray-900 mt-1",children:["₹",t.mrp]})]},h))})]}),!N&&Object.keys(l).filter(t=>t!=="image"&&t!=="variants").length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-20 h-20 bg-violet-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("i",{className:"fas fa-inbox text-3xl text-violet-400"})}),e.jsx("p",{className:"text-gray-500",children:"No specifications available"}),e.jsxs(p,{onClick:u,className:"mt-4 bg-violet-600 hover:bg-violet-700 text-white",children:[e.jsx("i",{className:"fas fa-plus mr-2"}),"Add Specifications"]})]})]})]})})]})},Ke=()=>{var D,U;const{organizationId:c,id:l}=fe(),N=he(),[d,y]=x.useState(!1),[r,u]=x.useState({}),[w,k]=x.useState(null),[n,C]=x.useState(null),[f,E]=x.useState(""),{data:s,isLoading:S,error:b,isError:F}=ge(l),{data:m,refetch:v}=ve({organizationId:c,projectId:f}),I=pe(),M=je(),L=Ne(),t=ye(),{role:h,permission:_}=Y(),Z=h==="owner"||((D=_==null?void 0:_.productinventory)==null?void 0:D.list);x.useEffect(()=>{var a,i;s!=null&&s.specification&&(u(s==null?void 0:s.specification),(a=s==null?void 0:s.specification)!=null&&a.variants&&((i=s==null?void 0:s.specification)==null?void 0:i.variants.length)>0&&C(s.specification.variants[0]))},[s]);const{data:P}=be(c),A=P==null?void 0:P.map(a=>({_id:a._id,projectName:a.projectName})),V=x.useMemo(()=>{var a;return(a=P||[])==null?void 0:a.map(i=>({value:i._id,label:i.projectName}))},[P]);x.useEffect(()=>{A&&A.length>0&&!f&&E(A[0]._id)},[A,f]),x.useEffect(()=>{var a,i;s!=null&&s.specification&&(u(s==null?void 0:s.specification),(a=s==null?void 0:s.specification)!=null&&a.variants&&((i=s==null?void 0:s.specification)==null?void 0:i.variants.length)>0&&C(s.specification.variants[0]))},[s]);const R=x.useCallback(()=>{y(!0),s!=null&&s.specification&&u({...s.specification})},[s]),H=x.useCallback(()=>{y(!1),s!=null&&s.specification&&u({...s.specification})},[s]),ee=a=>{u(i=>({...i,[a.target.name]:a.target.value}))},te=x.useCallback(a=>{E(a||"")},[]),Q=x.useCallback(async()=>{var a,i;try{if(!l||!r)return;await I.mutateAsync({id:l,specification:r}),j({title:"✓ Updated",description:"Material inventory updated successfully",variant:"default"}),y(!1),v()}catch(o){j({title:"Error",description:((i=(a=o==null?void 0:o.response)==null?void 0:a.data)==null?void 0:i.message)||(o==null?void 0:o.message)||"something has went wrong",variant:"destructive"})}},[l,r,I,v]),se=a=>{C(a)},ae=()=>n?{image:n.image,mrp:n.mrp,itemCode:n.itemCode,color:n.color}:{image:r==null?void 0:r.image,mrp:r==null?void 0:r.mrp,itemCode:r==null?void 0:r.itemCode,color:null},B=()=>n?n.itemCode:(r==null?void 0:r.itemCode)||"",G=a=>!(m!=null&&m.items)||!a?null:m.items.find(i=>{var o;return((o=i==null?void 0:i.specification)==null?void 0:o.itemCode)===a}),ie=()=>{const a=B(),i=G(a);return i?i==null?void 0:i.quantity:0},re=()=>{const a={...r,variants:void 0};return n?{...a,itemCode:n.itemCode,mrp:n.mrp,color:n.color,image:n.image}:a},le=async()=>{var i,o;if(!f){j({title:"Error",description:"Please select a project first",variant:"destructive"});return}const a=re();try{await M.mutateAsync({organizationId:c,projectId:f,productId:l,quantity:1,specification:a}),j({title:"Success",description:"Added to cart"}),v()}catch(g){j({title:"Error",description:((o=(i=g==null?void 0:g.response)==null?void 0:i.data)==null?void 0:o.message)||"Failed to add item to cart",variant:"destructive"})}},oe=async a=>{var W,J;if(!(m!=null&&m._id))return;const i=B(),o=G(i);if(!o)return;const g=o.quantity+a;if(g<=0){O();return}try{await L.mutateAsync({cartId:m._id,itemCode:i,quantity:g}),j({title:"Success",description:"Cart updated successfully"}),v()}catch($){j({title:"Error",description:((J=(W=$==null?void 0:$.response)==null?void 0:W.data)==null?void 0:J.message)||"Failed to update cart",variant:"destructive"})}},O=async()=>{var i,o;if(!(m!=null&&m._id))return;const a=B();try{await t.mutateAsync({cartId:m._id,itemCode:a}),j({title:"Success",description:"Item removed from cart",variant:"default"}),await v()}catch(g){j({title:"Error",description:((o=(i=g==null?void 0:g.response)==null?void 0:i.data)==null?void 0:o.message)||"Failed to remove item from cart",variant:"destructive"})}},ce=ae(),ne=(r==null?void 0:r.variants)&&((U=r==null?void 0:r.variants)==null?void 0:U.length)>0,q=ie(),de=q>0;if(S)return e.jsx(ue,{});if(F||w||b)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-violet-50 via-blue-50 to-white p-6 flex items-center justify-center",children:e.jsx("div",{className:"bg-red-50 border-2 border-red-200 text-red-700 rounded-2xl p-6 shadow-lg max-w-xl w-full",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx("i",{className:"fas fa-exclamation-triangle text-red-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Error Loading Data"}),e.jsx("p",{className:"text-sm text-red-600",children:w||(b==null?void 0:b.message)||"Failed to load data"})]})]}),e.jsx("button",{onClick:()=>k(null),className:"text-red-400 hover:text-red-700 transition-colors",children:e.jsx("i",{className:"fas fa-times text-xl"})})]})})});if(!s)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-violet-50 via-blue-50 to-white flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-gray-400 py-12",children:[e.jsx("i",{className:"fas fa-box-open text-6xl mb-4"}),e.jsx("p",{className:"text-xl",children:"No data found"})]})});const me=(()=>{const a=[{key:"brand",label:"Brand",icon:"fa-trademark",type:"text"},{key:"category",label:"Category",icon:"fa-tag",type:"text"},{key:"description",label:"Description",icon:"fa-align-left",type:"text"}];return(r==null?void 0:r.category)==="light"?[...a,{key:"mrp",label:"MRP",icon:"fa-indian-rupee-sign",type:"number"},{key:"subcategory",label:"Sub Category",icon:"fa-tags",type:"text"},{key:"model",label:"Model",icon:"fa-cube",type:"text"},{key:"watt",label:"Watt",icon:"fa-bolt",type:"number"},{key:"itemCode",label:"Item Code",icon:"fa-barcode",type:"text"},{key:"cct",label:"CCT",icon:"fa-lightbulb",type:"text"},{key:"series",label:"Series",icon:"fa-layer-group",type:"text"}]:[...a,{key:"HSN",label:"HSN",icon:"fa-hashtag",type:"text"},{key:"styleType",label:"Style Type",icon:"fa-palette",type:"text"},{key:"type",label:"Type",icon:"fa-shapes",type:"text"},{key:"materialType",label:"Material Type",icon:"fa-cubes",type:"text"}]})();if(Z)return e.jsx("div",{className:"max-h-full min-h-full overflow-y-auto bg-gradient-to-br from-violet-50 via-blue-50 to-white p-4",children:e.jsxs("div",{className:"max-w-full mx-auto",children:[e.jsx(Fe,{navigate:N,data:s,editMode:d,projectOptions:V,selectedProjectId:f,handleSelectProjectId:te,handleCancel:H,handleSave:Q,updateMutation:I,handleEdit:R}),e.jsx(Me,{displayValues:ce,form:r,editMode:d,selectedVariant:n,handleVariantSelect:se,handleChange:ee,handleEdit:R,editableFields:me,hasVariants:ne,handleAddToCart:le,handleUpdateCartQuantity:oe,handleRemoveFromCart:O,cartQuantity:q,isInCart:de,selectedProjectId:f,addToCartMutation:M,updateCartQuantityMutation:L,removeFromCartMutation:t,projects:A}),d&&e.jsx("div",{className:"mt-8 lg:hidden",children:e.jsx("div",{className:"bg-white border-2 border-violet-100 rounded-xl p-4 shadow-xl",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(p,{onClick:H,variant:"outline",className:"flex-1 border-2 border-gray-300 hover:bg-gray-50",children:[e.jsx("i",{className:"fas fa-times mr-2"}),"Cancel"]}),e.jsxs(p,{onClick:Q,isLoading:I.isPending,className:"flex-1 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white shadow-lg",children:[e.jsx("i",{className:"fas fa-save mr-2"}),"Save"]})]})})})]})})};export{Ke as default};
