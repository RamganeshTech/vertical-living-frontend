import{r as k,j as e,I as _,B as N,t as u,q as $,W as F,F as R,H as T,u as z,J as D,d as Q,M as W,C as B}from"./index-CKvTvGhg.js";import{A as U,S as H}from"./AssignStaff-DCnoFv1w.js";import{R as K}from"./ResetStageButton-PvGYzXm2.js";import{S as J}from"./ShareDocumentWhatsapp-1TcTGZ9M.js";import{u as Y,a as X,b as Z}from"./materialArrivalNewApi-BeoqPkTi.js";import{N as V}from"./constants-CP15s2Qq.js";import"./documentationApi-CrWeFyHi.js";import"./requirementFormApi-DtR29HbM.js";const ee=({projectId:s,context:i,label:t,generateLink:d,isPending:l,data:a})=>{const[n,o]=k.useState(""),[m,g]=k.useState(!1);k.useEffect(()=>{typeof a=="string"&&o(a)},[a]);const p=async()=>{try{await navigator.clipboard.writeText(n),g(!0),setTimeout(()=>g(!1),1500)}catch{u({title:"Error",description:"Failed to copy link",variant:"destructive"})}},h=()=>{const c=encodeURIComponent(`Hey, please check this ${i} link:\`${n}`);window.open(`https://wa.me/?text=${c}`,"_blank")},j=async()=>{var c,y;try{const r=await d({projectId:s});r!=null&&r.shareableUrl&&(o(r.shareableUrl),u({title:"Link generated",description:"You can now share the link",variant:"default"}))}catch(r){u({title:"Error",description:((y=(c=r==null?void 0:r.response)==null?void 0:c.data)==null?void 0:y.message)||(r==null?void 0:r.message)||"Failed to generate link",variant:"destructive"})}};return e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 shadow-sm w-full max-w-xl",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("h3",{className:"text-lg font-semibold text-blue-800 flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-link"})," ",t||"Generate Shareable Link"]})}),n?e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 items-center",children:[e.jsx(_,{readOnly:!0,value:n,className:"flex-1 text-sm cursor-default"}),e.jsxs(N,{onClick:p,variant:"outline",className:"flex gap-2",children:[e.jsx("i",{className:`fas ${m?"fa-check-circle":"fa-copy"}`}),m?"Copied":"Copy"]}),e.jsxs(N,{onClick:h,className:"bg-green-500 hover:bg-green-600 text-white flex gap-2",children:[e.jsx("i",{className:"fab fa-whatsapp"}),"Share"]})]}):e.jsx(N,{onClick:j,disabled:l,className:"bg-blue-600 hover:bg-blue-700 text-white",children:l?"Generating...":"Generate Link"})]})},se=async({formId:s,projectId:i,deadLine:t,api:d})=>{const{data:l}=await d.put(`/materialarrivalcheck/deadline/${i}/${s}`,{deadLine:t});if(!l.ok)throw new Error(l.message);return l.data},ae=async({projectId:s,api:i})=>{const{data:t}=await i.put(`/materialarrivalcheck/completionstatus/${s}`);if(!t.ok)throw new Error(t.message);return t.data},te=()=>{const s=["owner","staff","CTO"],{role:i}=$(),t=T(i),d=F();return R({mutationFn:async({formId:l,projectId:a,deadLine:n})=>{if(!i||!s.includes(i))throw new Error("not allowed to make this api call");if(!t)throw new Error("API instance missing");return await se({formId:l,projectId:a,deadLine:n,api:t})},onSuccess:(l,a)=>{d.invalidateQueries({queryKey:["ordering-material",a.formId]})}})},ie=()=>{const s=["owner","staff","CTO"],{role:i}=$(),t=T(i),d=F();return R({mutationFn:async({projectId:l})=>{if(!i||!s.includes(i))throw new Error("not allowed to make this api call");if(!t)throw new Error("API instance missing");return await ae({projectId:l,api:t})},onSuccess:(l,{projectId:a})=>{d.invalidateQueries({queryKey:["material-arrival",a]})}})},le=({item:s,projectId:i,index:t})=>{var m,g,p;const{mutateAsync:d,isPending:l}=Y(),[a,n]=k.useState(!1),o=async()=>{var h,j;try{await d({projectId:i,unitName:s.unitName,toggle:!(s!=null&&s.isVerified)}),u({title:"Success",description:"Verification status updated."})}catch(c){u({title:"Error",description:((j=(h=c==null?void 0:c.response)==null?void 0:h.data)==null?void 0:j.message)||c.message||"Failed to update",variant:"destructive"})}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`grid grid-cols-5 gap-4 px-4 py-4 hover:bg-gray-50 transition-colors duration-200 ${t%2===0?"bg-white":"bg-gray-25"}`,children:[e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 text-xs font-semibold",children:t+1}),e.jsx("span",{className:"font-medium text-gray-800 truncate",children:(s==null?void 0:s.unitName)||"N/A"})]})}),e.jsx("div",{className:"flex items-center",children:e.jsx("div",{className:"bg-gray-100 px-3 py-1 rounded-full",children:e.jsx("span",{className:"font-semibold text-gray-700",children:s.quantity})})}),e.jsx("div",{className:"flex items-center",children:s!=null&&s.image?e.jsxs("div",{className:"relative group cursor-pointer",onClick:()=>n(!0),children:[e.jsx("div",{className:"w-45 h-45 border-2 border-gray-200 rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-shadow duration-200",children:e.jsx("img",{src:((m=s==null?void 0:s.image)==null?void 0:m.url)||V,alt:s.image.originalName||"Material Image",className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-200"})}),e.jsx("div",{className:"absolute inset-0  bg-opacity-0 group-hover:bg-opacity-20 rounded-lg transition-all duration-200 flex items-center justify-center",children:e.jsx("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity duration-200"})})]}):e.jsx("div",{className:"w-45 h-45 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"fa-solid fa-image text-gray-400 text-lg mb-1"}),e.jsx("p",{className:"text-xs text-gray-400",children:"No Image"})]})})}),e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{className:`inline-flex items-center gap-2 px-3 py-1 rounded-full text-sm font-medium ${s.isVerified?"bg-green-100 text-green-700 border border-green-200":"bg-gray-100 text-gray-600 border border-gray-200"}`,children:[e.jsx("i",{className:`fa-solid ${s.isVerified?"fa-check-circle":"fa-clock"} text-xs`}),s.isVerified?"Verified":"Pending"]})}),e.jsx("div",{className:"flex items-center",children:e.jsxs(N,{onClick:o,disabled:l,size:"sm",className:`flex items-center gap-2 px-4 py-2 text-sm font-medium transition-colors duration-200 ${s.isVerified?"bg-orange-500 hover:bg-orange-600 text-white":"bg-green-500 hover:bg-green-600 text-white"}`,children:[l?e.jsx("i",{className:"fa-solid fa-spinner fa-spin"}):e.jsx("i",{className:`fa-solid ${s.isVerified?"fa-times":"fa-check"}`}),s.isVerified?"Not Confirm":"Confirm"]})})]}),a&&s.image&&e.jsx("div",{className:"fixed inset-0 bg-black/70  flex items-center justify-center z-50 p-4",onClick:()=>n(!1),children:e.jsxs("div",{className:"relative w-[80vw] h-[80vh] max-w-4xl",children:[e.jsx("button",{onClick:()=>n(!1),className:"absolute -top-10 right-0 text-white hover:text-gray-300 transition-colors duration-200 z-10",children:e.jsx("i",{className:"fa-solid fa-times text-2xl"})}),e.jsx("img",{src:((g=s==null?void 0:s.image)==null?void 0:g.url)||V,alt:((p=s==null?void 0:s.image)==null?void 0:p.originalName)||"Material Image",className:"w-full h-full object-cover rounded-lg shadow-2xl",onClick:h=>h.stopPropagation()}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-black  text-white p-4 rounded-b-lg",children:[e.jsx("p",{className:"text-sm font-medium",children:s.image.originalName||"Material Image"}),e.jsx("p",{className:"text-xs text-gray-300",children:"Click outside to close"})]})]})})]})},he=()=>{var A,S,I,L,P,E;const{projectId:s,organizationId:i}=z(),{isMobile:t,openMobileSidebar:d}=D(),l=Q(),{data:a,isLoading:n,error:o,isError:m,refetch:g}=X(s),{mutateAsync:p,isPending:h}=Z(),{mutateAsync:j,isPending:c}=te(),{mutateAsync:y,isPending:r}=ie();if(n)return e.jsx(W,{});const{timer:x,generatedLink:G}=a||{},O=async()=>{var f,w;try{await y({projectId:s}),u({description:"Completion status updated successfully",title:"Success"}),l("../installation")}catch(v){u({title:"Error",description:((w=(f=v==null?void 0:v.response)==null?void 0:f.data)==null?void 0:w.message)||(v==null?void 0:v.message)||"Failed to update completion status",variant:"destructive"})}},b=((A=a==null?void 0:a.materialArrivalList)==null?void 0:A.length)||0,C=((I=(S=a==null?void 0:a.materialArrivalList)==null?void 0:S.filter(f=>f.isVerified))==null?void 0:I.length)||0,q=b-C,M=b>0?Math.round(C/b*100):0;return e.jsxs("div",{className:"w-full h-full flex flex-col p-2 ",children:[e.jsxs("div",{className:"flex-shrink-0 flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-4 pb-3 ",children:[e.jsxs("h2",{className:"text-2xl sm:text-2xl lg:text-2xl xl:text-3xl font-semibold text-blue-600 flex items-center",children:[t&&e.jsx("button",{onClick:d,className:"mr-3 p-2 rounded-md border-gray-300 hover:bg-gray-100",title:"Open Menu",children:e.jsx("i",{className:"fa-solid fa-bars"})}),e.jsx("i",{className:"fa-solid fa-receipt mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Material Checking"}),e.jsx("span",{className:"sm:hidden",children:"Material Check"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full sm:w-auto",children:[e.jsxs(N,{isLoading:r,onClick:O,className:"bg-green-600 hover:bg-green-700 text-white w-full sm:w-auto whitespace-nowrap",children:[e.jsx("i",{className:"fa-solid fa-circle-check mr-2"}),"Mark as Complete"]}),e.jsx(K,{projectId:s,stageNumber:9,stagePath:"materialarrivalcheck"}),!o&&e.jsx(J,{projectId:s,stageNumber:"9",className:"w-full sm:w-fit",isStageCompleted:a==null?void 0:a.status}),e.jsx(U,{stageName:"MaterialArrivalModel",projectId:s,organizationId:i,currentAssignedStaff:(a==null?void 0:a.assignedTo)||null})]})]}),m&&e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"max-w-xl p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2",children:"⚠️ Error Occurred"}),e.jsx("p",{className:"text-red-500 text-sm mb-4",children:((P=(L=o==null?void 0:o.response)==null?void 0:L.data)==null?void 0:P.message)||"Failed to load material arrival data"}),e.jsx(N,{onClick:()=>g(),className:"bg-red-600 text-white hover:bg-red-700",children:"Retry"})]})}),!m&&e.jsxs("div",{className:"flex-1 min-h-0 overflow-y-auto space-y-4 sm:space-y-6",children:[e.jsxs(B,{className:"p-4 w-full shadow border-l-4 border-blue-600 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-3 text-blue-700 text-sm font-medium mb-2",children:[e.jsx("i",{className:"fa-solid fa-clock text-blue-500 text-lg"}),e.jsx("span",{children:"Stage Timings"})]}),e.jsx(H,{stageName:"materialarrivalcheck",completedAt:x==null?void 0:x.completedAt,projectId:s,formId:a==null?void 0:a._id,deadLine:x==null?void 0:x.deadLine,startedAt:x==null?void 0:x.startedAt,refetchStageMutate:g,deadLineMutate:j,isPending:c})]}),e.jsxs("section",{className:"w-full  rounded-xl shadow-lg border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:" bg-gradient-to-r from-slate-800 to-gray-900 p-6 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12  bg-opacity-20 rounded-lg flex items-center justify-center",children:e.jsx("i",{className:"fa-solid fa-boxes-stacked text-2xl text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold",children:"Material Verification Center"}),e.jsx("p",{className:"text-gray-300 text-sm mt-1",children:"Review and verify material arrivals"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold",children:b}),e.jsx("div",{className:"text-gray-300 text-sm",children:"Total Items"})]})]}),b>0&&e.jsxs("div",{className:"mt-6 grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-slate-600 bg-opacity-10 rounded-lg p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-emerald-500 bg-opacity-30 rounded-full flex items-center justify-center",children:e.jsx("i",{className:"fa-solid fa-check text-emerald-300 text-lg"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:C}),e.jsx("div",{className:"text-gray-300 text-sm",children:"Verified"})]})]})}),e.jsx("div",{className:"bg-slate-600 bg-opacity-10 rounded-lg p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-amber-500 bg-opacity-30 rounded-full flex items-center justify-center",children:e.jsx("i",{className:"fa-solid fa-clock text-amber-300 text-lg"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:q}),e.jsx("div",{className:"text-gray-300 text-sm",children:"Pending"})]})]})}),e.jsx("div",{className:"bg-slate-600 bg-opacity-10 rounded-lg p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-indigo-500 bg-opacity-30 rounded-full flex items-center justify-center",children:e.jsx("i",{className:"fa-solid fa-chart-line text-indigo-300 text-lg"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-2xl font-bold text-white",children:[M,"%"]}),e.jsx("div",{className:"text-gray-300 text-sm",children:"Progress"})]})]})})]}),b>0&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-300 mb-2",children:[e.jsx("span",{children:"Verification Progress"}),e.jsxs("span",{children:[M,"% Complete"]})]}),e.jsx("div",{className:"w-full bg-white bg-opacity-20 rounded-full h-2",children:e.jsx("div",{className:"bg-emerald-400 h-2 rounded-full transition-all duration-500 ease-out",style:{width:`${M}%`}})})]})]}),e.jsx("div",{className:"bg-gray-50 border-b border-gray-200",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"min-w-[800px]",children:e.jsxs("div",{className:"grid grid-cols-5 gap-4 px-6 py-4 font-semibold text-gray-700 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-hashtag text-blue-500"}),e.jsx("span",{children:"Item Name"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-calculator text-blue-500"}),e.jsx("span",{children:"Quantity"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-image text-blue-500"}),e.jsx("span",{children:"Image"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-shield-check text-blue-500"}),e.jsx("span",{children:"Status"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-cog text-blue-500"}),e.jsx("span",{children:"Action"})]})]})})})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"min-w-[800px]",children:((E=a==null?void 0:a.materialArrivalList)==null?void 0:E.length)>0?e.jsx("div",{className:"divide-y divide-gray-100",children:a.materialArrivalList.map((f,w)=>e.jsx(le,{item:f,projectId:s,index:w},f._id))}):e.jsx("div",{className:"p-12 text-center bg-gray-50",children:e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-6 bg-gradient-to-br from-gray-100 to-gray-200 rounded-full flex items-center justify-center shadow-inner",children:e.jsx("i",{className:"fa-solid fa-box-open text-3xl text-gray-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-600 mb-3",children:"No Materials Found"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Material data will appear here once available. Check back later or contact your administrator."}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-gray-400",children:[e.jsx("i",{className:"fa-solid fa-info-circle"}),e.jsx("span",{children:"Materials are automatically synced from your project"})]})]})})})})]}),e.jsx("section",{className:"mt-4",children:e.jsx(ee,{projectId:s,context:"Material",stage:"materialarrival",data:G,isPending:h,generateLink:p})})]})]})};export{he as default};
