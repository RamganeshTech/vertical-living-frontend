import{j as e,a as C,c as k,r as I,O as S}from"./index-CqEiDvr_.js";import{C as _,a as F}from"./Card-CHisThjm.js";import{B as v}from"./Button-DzcQpMPj.js";import{u as E}from"./projectApi-vSAHE0yY.js";import{i as L,j as O}from"./procurementApi-BzOYbAUj.js";import R from"./MaterialOverviewLoading-DjqpQRJC.js";import{t as y}from"./toast-BSC5QTk1.js";import"./useQuery-DyvuN1xf.js";import"./useMutation-DDHgQq3T.js";import"./roleCheck-BJ07f95N.js";import"./Skeleton-DMaf5_kG.js";const A=({procurementNumber:i,shopDetails:t,totalCost:n,itemCount:m,projectName:c,fromDeptName:l,fromDeptNumber:x,isConfirmedRate:f,isSyncWithPaymentsSection:p,onView:o,onDelete:g,deletePending:j})=>{const h=p?"border-purple-500 bg-purple-50/10":f?"border-green-500 bg-green-50/10":"border-blue-500 bg-white";return e.jsx(_,{onClick:o,className:`w-full cursor-pointer group hover:shadow-md transition-all duration-200 border-l-[5px] ${h} shadow-sm overflow-hidden bg-white`,children:e.jsxs(F,{className:"p-0",children:[e.jsxs("div",{className:"p-3 flex justify-between items-start border-b border-gray-50 pb-2",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] uppercase font-bold text-gray-400 tracking-wider",children:"Procurement No"}),e.jsx("h3",{className:"text-lg font-bold text-gray-800 font-mono tracking-tight leading-none group-hover:text-blue-600 transition-colors",children:i||"N/A"})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1.5",children:[p?e.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded text-[9px] font-bold bg-purple-100 text-purple-700 uppercase tracking-wide border border-purple-200",children:[e.jsx("i",{className:"fas fa-file-invoice-dollar text-[8px]"})," In Payment"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded text-[9px] font-bold bg-gray-100 text-gray-500 uppercase tracking-wide",children:[e.jsx("i",{className:"fas fa-hourglass-start text-[8px]"})," Pre-Payment"]}),f?e.jsxs("span",{className:"inline-flex items-center gap-1 text-[10px] font-bold text-green-600",children:[e.jsx("i",{className:"fas fa-check-circle"})," Rates Added"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 text-[10px] font-bold text-orange-500",children:[e.jsx("i",{className:"fas fa-exclamation-circle"})," Rates Pending"]})]})]}),e.jsxs("div",{className:"px-3 py-2 space-y-1.5 grid grid-cols-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-700",children:[e.jsx("div",{className:"w-4 flex justify-center",children:e.jsx("i",{className:"fas fa-folder text-gray-400 text-[10px]"})}),e.jsx("span",{className:"font-semibold truncate w-full",title:c,children:c||"Unknown Project"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx("div",{className:"w-4 flex justify-center",children:e.jsx("i",{className:"fas fa-share-alt text-gray-400 text-[10px]"})}),e.jsxs("span",{className:"truncate",children:["From ",e.jsx("span",{className:"font-medium",children:l}),x&&e.jsxs("span",{className:"font-mono ml-1 text-gray-600",children:["#",x]})]})]}),(t==null?void 0:t.contactPerson)&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx("div",{className:"w-4 flex justify-center",children:e.jsx("i",{className:"fas fa-user-tie text-blue-400 text-[10px]"})}),e.jsx("span",{className:"font-medium truncate text-blue-700",children:(t==null?void 0:t.contactPerson)||"Vendor Unassigned"})]}),(t==null?void 0:t.shopName)&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx("div",{className:"w-4 flex justify-center",children:e.jsx("i",{className:"fas fa-shop text-blue-400 text-[10px]"})}),e.jsx("span",{className:"font-medium truncate text-blue-700",children:(t==null?void 0:t.shopName)||"Vendor Unassigned"})]})]}),e.jsxs("div",{className:"mt-1 bg-gray-50 px-3 py-2 border-t border-gray-100 flex items-center justify-between",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex flex-col leading-none",children:[e.jsx("span",{className:"text-[9px] font-bold text-gray-400 uppercase",children:"Items"}),e.jsx("span",{className:"text-xs font-bold text-gray-700",children:m})]}),e.jsxs("div",{className:"flex flex-col leading-none border-l border-gray-200 pl-4",children:[e.jsx("span",{className:"text-[9px] font-bold text-gray-400 uppercase",children:"Total"}),e.jsx("span",{className:"text-xs font-bold text-blue-700",children:n>0?`â‚¹ ${n.toLocaleString()}`:"-"})]})]}),e.jsx(v,{size:"sm",variant:"ghost",isLoading:j,onClick:u=>{u.stopPropagation(),g(u)},className:"h-7 w-7 p-0 rounded-full hover:bg-red-100 text-gray-400 hover:text-red-600 transition-colors",children:e.jsx("i",{className:"fas fa-trash-alt text-xs"})})]})]})})},K=()=>{var N,b;const{organizationId:i}=C(),t=k(),[n,m]=I.useState({projectId:"",projectName:""}),{data:c}=E(i),l=c==null?void 0:c.map(s=>({_id:s._id,projectName:s.projectName})),{data:x,isLoading:f,isError:p,error:o,refetch:g}=L(i,n),{mutateAsync:j,isPending:h,variables:u}=O(),w=async({id:s})=>{var a,r;try{await j({id:s}),y({title:"Success",description:"Deleted Successfully"})}catch(d){y({variant:"destructive",title:"Error",description:((r=(a=d==null?void 0:d.response)==null?void 0:a.data)==null?void 0:r.message)||(d==null?void 0:d.message)||"Failed to delete"})}},P=()=>{m({projectId:"",projectName:""})};return location.pathname.includes("sub")?e.jsx(S,{}):e.jsxs("div",{className:"p-2 space-y-6 max-w-full h-full ",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-box-open mr-3 text-blue-600"}),"Procurement Department"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage the Projects Material Items"})]})}),f?e.jsx(R,{}):p?e.jsxs("div",{className:"max-w-xl sm:min-w-[80%]  mx-auto mt-4 p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2 text-xl sm:text-3xl",children:"âš ï¸ Error Occurred"}),e.jsx("p",{className:"text-red-500  mb-4 text-lg sm:text-xl",children:((b=(N=o==null?void 0:o.response)==null?void 0:N.data)==null?void 0:b.message)||"Failed to load data"}),e.jsx(v,{onClick:()=>g(),className:"bg-red-600 text-white px-4 py-2",children:"Retry"})]}):e.jsxs("main",{className:"flex gap-2 h-[88%] ",children:[e.jsx("div",{className:"xl:w-80 flex-shrink-0",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-filter mr-2 text-blue-600"}),"Filters"]}),e.jsx("button",{onClick:P,className:"text-sm text-blue-600 cursor-pointer hover:text-blue-800 font-medium",children:"Clear All"})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Project"}),e.jsx("select",{value:(n==null?void 0:n.projectId)||"",onChange:s=>{const a=l==null?void 0:l.find(r=>r._id===s.target.value);a&&m(r=>({...r,projectId:a._id,projectName:a.projectName}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:l==null?void 0:l.map(s=>e.jsx("option",{value:s._id,children:s.projectName},s._id))})]})})]})}),x.length===0?e.jsxs("div",{className:"flex flex-col items-center  justify-center min-h-[300px] w-full bg-white rounded-xl text-center p-6",children:[e.jsx("i",{className:"fas fa-box-open text-5xl text-blue-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-1",children:"No Procurements Found"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Looks like there are no Procurements yet for this project.",e.jsx("br",{}),"Once you have ",e.jsx("strong",{children:" generated the Pdf "}),"  items will be listed here  to get started ðŸš€"]})]}):e.jsx("div",{className:"flex-1 max-h-[100%]  overflow-y-auto",children:e.jsx("div",{className:"grid gap-6 grid-cols-1 sm:grid-cols-2 xl:grid-cols-2 ",children:x.map(s=>{var a,r;return e.jsx(e.Fragment,{children:e.jsx(A,{procurementNumber:(s==null?void 0:s.procurementNumber)||(s==null?void 0:s.refPdfId),fromDeptName:s==null?void 0:s.fromDeptName,fromDeptNumber:s==null?void 0:s.fromDeptNumber,isConfirmedRate:s==null?void 0:s.isConfirmedRate,isSyncWithPaymentsSection:s==null?void 0:s.isSyncWithPaymentsSection,projectName:(a=s==null?void 0:s.projectId)==null?void 0:a.projectName,shopDetails:s==null?void 0:s.shopDetails,itemCount:((r=s==null?void 0:s.selectedUnits)==null?void 0:r.length)||0,totalCost:(s==null?void 0:s.totalCost)||0,onView:()=>t(`sub/${s._id}`),onDelete:()=>w({id:s._id}),deletePending:h&&u.id===s._id})})})})})]})]})};export{K as default};
