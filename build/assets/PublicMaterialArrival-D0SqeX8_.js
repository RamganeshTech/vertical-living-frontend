import{u as T,r as u,j as e,C as O,ae as Y,B as q,t as p}from"./index-BAM0eJUz.js";import{I as B}from"./Input-1UBXZqEj.js";import{h as K,i as H,j as J}from"./materialArrivalNewApi-DZ-ZzQcg.js";import{r as W}from"./index-C8BdbktQ.js";const te=()=>{var E;const{projectId:y,token:S}=T(),{data:o,isLoading:F,isError:Q,refetch:L}=K(y,S),{mutateAsync:U,isPending:b}=H(),{mutateAsync:$,isPending:w}=J(),[f,k]=u.useState({}),[x,C]=u.useState({}),[i,n]=u.useState(null),[M,_]=u.useState([]),V=t=>{_(a=>a.includes(t)?a.filter(l=>l!==t):[...a,t])};o&&M.length===0&&((E=o.materialArrivalList)==null?void 0:E.length)>0&&_(o.materialArrivalList.map(t=>t.orderMaterialDeptNumber)),u.useEffect(()=>{const t=a=>{i&&(a.key==="ArrowRight"?n(l=>l?{...l,index:(l.index+1)%l.images.length}:null):a.key==="ArrowLeft"?n(l=>l?{...l,index:(l.index-1+l.images.length)%l.images.length}:null):a.key==="Escape"&&n(null))};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[i]);const G=(t,a)=>{const l=a===""?0:parseFloat(a);k(r=>({...r,[t]:l}))},A=(t,a)=>{if(!a||a.length===0)return;const l=Array.from(a);C(r=>({...r,[t]:l}))},z=async(t,a)=>{var g,c;const l=f[a],r=x[a],s=new FormData;l!==void 0&&s.append("arrivedQuantity",String(l)),r&&r.length>0&&r.forEach(d=>{s.append("upload",d)});const m=l!==void 0,j=r&&r.length>0;if(!m&&!j){p({title:"No Changes",description:"Please enter a quantity or select images.",variant:"destructive"});return}try{await U({projectId:y,orderNumber:t,subItemId:a,formData:s}),p({title:"Success",description:"Updated successfully"}),k(d=>{const h={...d};return delete h[a],h}),C(d=>{const h={...d};return delete h[a],h}),L()}catch(d){p({title:"Error",description:((c=(g=d==null?void 0:d.response)==null?void 0:g.data)==null?void 0:c.message)||d.message||"Failed to update",variant:"destructive"})}},R=(t,a,l)=>{n({images:t.images,index:l,orderNumber:a,subItemId:t._id})},I=(o==null?void 0:o.materialArrivalList)||[],P=I.flatMap(t=>t.subItems),N=P.length,D=P.filter(t=>t.arrivedQuantity>0||t.images&&t.images.length>0).length,v=N>0?Math.round(D/N*100):0;return F?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:e.jsx("i",{className:"fas fa-circle-notch fa-spin text-4xl text-blue-600"})}):Q?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-red-50 text-red-600",children:e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"fa-solid fa-triangle-exclamation text-4xl mb-4"}),e.jsx("h2",{className:"text-xl font-bold",children:"Unable to load portal"})]})}):e.jsxs("div",{className:"min-h-screen bg-slate-50 font-sans pb-32",children:[e.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200 sticky top-0 z-40",children:e.jsxs("div",{className:"w-full px-4 sm:px-6 py-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:O.COMPANY_LOGO||Y,alt:"Logo",className:"w-10 h-10 rounded-full border border-gray-200 object-cover shadow-sm"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-bold text-gray-900 leading-tight",children:O.COMPANY_NAME}),e.jsx("p",{className:"text-xs text-gray-500 font-medium uppercase tracking-wide",children:"Material Arrival Portal"})]})]}),e.jsxs("div",{className:"hidden sm:flex items-center gap-2 px-3 py-1 bg-green-50 text-green-700 rounded-full text-xs font-bold border border-green-200",children:[e.jsx("i",{className:"fa-solid fa-check-circle"}),v,"% Complete"]})]})}),e.jsxs("div",{className:"w-full px-2 sm:px-6 py-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200 shadow-sm",children:[e.jsx("div",{className:"text-gray-500 text-xs uppercase font-bold",children:"Total Items"}),e.jsx("div",{className:"text-2xl font-bold text-gray-800",children:N})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200 shadow-sm",children:[e.jsx("div",{className:"text-gray-500 text-xs uppercase font-bold",children:"Updated"}),e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:D})]}),e.jsxs("div",{className:"col-span-2 bg-slate-800 p-4 rounded-lg shadow-sm text-white flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-400 text-xs uppercase font-bold",children:"Overall Progress"}),e.jsxs("div",{className:"text-xl font-bold",children:[v,"% Done"]})]}),e.jsx("div",{className:"w-12 h-12 rounded-full border-4 border-slate-600 flex items-center justify-center text-xs font-bold",children:v})]})]}),e.jsx("div",{className:"space-y-4",children:I.map(t=>{const a=M.includes(t.orderMaterialDeptNumber),l=t.subItems.length,r=t.subItems.filter(s=>s.isVerified).length;return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("div",{onClick:()=>V(t.orderMaterialDeptNumber),className:"bg-white hover:bg-gray-50 cursor-pointer px-4 py-4 flex items-center justify-between transition-colors border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center text-lg shadow-sm ${a?"bg-blue-600 text-white":"bg-gray-100 text-gray-500"}`,children:e.jsx("i",{className:"fa-solid fa-box-open"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-gray-800 text-base",children:["Order #",t.orderMaterialDeptNumber]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-500 mt-0.5",children:[e.jsxs("span",{children:[l," Items"]}),e.jsxs("span",{className:r===l?"text-green-600 font-bold":"text-orange-500",children:[r,"/",l," Verified"]})]})]})]}),e.jsx("i",{className:`fa-solid fa-chevron-down text-gray-400 transition-transform duration-300 ${a?"rotate-180":""}`})]}),a&&e.jsx("div",{className:"border-t border-gray-200 bg-gray-50/50",children:e.jsx("div",{className:"overflow-x-auto w-full",children:e.jsxs("table",{className:"w-full min-w-[1000px] text-left border-collapse",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-500 font-bold text-xs uppercase border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 w-[250px]",children:"Material Details"}),e.jsx("th",{className:"px-4 py-3 w-[100px] text-center",children:"Ordered"}),e.jsx("th",{className:"px-4 py-3 w-[80px] text-center",children:"Unit"}),e.jsx("th",{className:"px-4 py-3 w-[150px]",children:"Arrived Qty"}),e.jsx("th",{className:"px-4 py-3 w-[250px]",children:"Photo Evidence"}),e.jsx("th",{className:"px-4 py-3 w-[120px] text-center",children:"Action"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100 bg-white",children:t.subItems.map(s=>{var j,g;const m=f[s._id]!==void 0||x[s._id]!==void 0;return e.jsxs("tr",{className:"hover:bg-blue-50/20 transition-colors",children:[e.jsxs("td",{className:"px-6 py-4 align-middle",children:[e.jsx("div",{className:"font-bold text-gray-800 text-sm",children:s.subItemName}),s.refId&&e.jsx("div",{className:"text-xs text-gray-400 font-mono mt-1",children:s.refId}),s.isVerified&&e.jsx("span",{className:"inline-block mt-1 px-2 py-0.5 bg-green-100 text-green-700 text-[10px] font-bold rounded border border-green-200",children:"VERIFIED"})]}),e.jsx("td",{className:"px-4 py-4 text-center align-middle",children:e.jsx("span",{className:"bg-gray-100 text-gray-700 px-3 py-1 rounded-full text-sm font-bold",children:s.orderedQuantity})}),e.jsx("td",{className:"px-4 py-4 text-center align-middle",children:e.jsx("span",{className:"text-xs font-bold text-gray-500 uppercase bg-gray-50 border border-gray-200 px-2 py-1 rounded",children:s.unit})}),e.jsx("td",{className:"px-4 py-4 align-middle",children:e.jsxs("div",{className:"relative",children:[e.jsx(B,{type:"number",min:"0",placeholder:String(s.arrivedQuantity||0),value:f[s._id]??s.arrivedQuantity??"",onChange:c=>G(s._id,c.target.value),className:"w-full font-bold text-center border-gray-300 focus:border-blue-500 focus:ring-blue-500"}),s.arrivedQuantity>0&&f[s._id]===void 0&&e.jsx("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 text-green-500 text-xs",children:e.jsx("i",{className:"fa-solid fa-check"})})]})}),e.jsx("td",{className:"px-6 py-4 text-center align-middle",children:s.images&&s.images.length>0?e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{onClick:()=>R(s,t.orderMaterialDeptNumber,s.images.length-1),className:"relative h-20 w-28 mx-auto rounded-lg border border-gray-200 overflow-hidden cursor-pointer shadow-sm hover:shadow-md hover:ring-2 hover:ring-blue-400 transition-all bg-white group-hover:scale-105 duration-200",children:[e.jsx("img",{src:s.images[s.images.length-1].url,alt:"Proof",className:"w-full h-full object-cover"}),s.images.length>1&&e.jsxs("div",{className:"absolute top-1 right-1 bg-black/70 text-white text-[10px] px-1.5 py-0.5 rounded-md font-bold flex items-center gap-1 backdrop-blur-sm",children:[e.jsx("i",{className:"fa-solid fa-images text-[8px]"}),"+",s.images.length-1]}),e.jsx("div",{className:"absolute inset-0 bg-black/0 hover:bg-black/10 transition-colors flex items-center justify-center",children:e.jsx("i",{className:"fa-solid fa-magnifying-glass-plus text-white opacity-0 hover:opacity-100 shadow-lg"})})]}),e.jsxs("label",{className:"mt-2 block text-xs text-blue-600 cursor-pointer text-center hover:bg-blue-100 bg-blue-50 rounded-2xl w-fit mx-auto px-3 border border-blue-200",children:[b?e.jsx("i",{className:"fas fa-spinner animate-spin"}):"Add Photo",e.jsx("input",{type:"file",multiple:!0,accept:"image/*",className:"hidden",onChange:c=>A(s._id,c.target.files)})]})]}):e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("label",{htmlFor:`img-upload-${s._id}`,className:"h-20 cursor-pointer w-28 mx-auto rounded-lg bg-gray-50 border border-gray-200 border-dashed flex flex-col items-center justify-center text-gray-400 hover:bg-gray-100 transition-colors",children:b?e.jsx("i",{className:"fas fa-spinner animate-spin text-xl"}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:`${(((j=x[s._id])==null?void 0:j.length)??0)>0?"fa-solid fa-circle-check":"fa-regular fa-image"} text-xl mb-1`}),e.jsx("span",{className:"text-[10px] font-bold tracking-tight px-2 text-center leading-tight",children:(((g=x[s._id])==null?void 0:g.length)??0)>0?`${x[s._id].length} image${x[s._id].length>1?"s":""} selected`:"Tap to Upload"})]})}),e.jsx("input",{id:`img-upload-${s._id}`,multiple:!0,type:"file",className:"hidden",accept:"image/*",onChange:c=>A(s._id,c.target.files)})]})}),e.jsx("td",{className:"px-4 py-4 text-center align-middle",children:e.jsx(q,{size:"sm",variant:"primary",disabled:b||!m,onClick:()=>z(t.orderMaterialDeptNumber,s._id),className:"w-full text-xs font-bold shadow-sm",children:b?e.jsx("i",{className:"fas fa-spinner fa-spin"}):"Update"})})]},s._id)})})]})})})]},t.orderMaterialDeptNumber)})})]}),i&&W.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[9999] bg-black/90 flex items-center justify-center backdrop-blur-sm",onClick:()=>n(null),children:[e.jsxs("div",{className:"absolute top-6 right-6 flex items-center gap-4",children:[e.jsx("button",{disabled:w,onClick:async t=>{var a,l;try{t.stopPropagation();const r=i.images[i.index];await $({projectId:y,orderNumber:i.orderNumber,subItemId:i.subItemId,imageId:r._id}),i.images.length<=1?n(null):n(s=>s?{...s,images:s.images.filter(m=>m._id!==r._id),index:Math.max(0,s.index-1)}:null),p({description:"Successfully deleted",title:"Success"})}catch(r){p({title:"Error",description:((l=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:l.message)||r.message||"Failed to delete images",variant:"destructive"})}},className:"bg-white/10 hover:bg-red-500/40 text-white rounded-full p-3 backdrop-blur-md transition-all",children:e.jsx("i",{className:`fas ${w?"fa-spinner fa-spin":"fa-trash-alt"} text-lg`})}),e.jsx("button",{onClick:()=>n(null),className:"bg-white/10 hover:bg-white/20 text-white rounded-full p-3 backdrop-blur-md transition-all",children:e.jsx("i",{className:"fas fa-times text-xl"})})]}),i.images.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:t=>{t.stopPropagation(),n(a=>a?{...a,index:(a.index-1+a.images.length)%a.images.length}:null)},className:"absolute left-6 top-1/2 -translate-y-1/2 bg-white/10 hover:bg-white/20 text-white rounded-full p-4 backdrop-blur-md transition-all active:scale-95",children:e.jsx("i",{className:"fas fa-chevron-left text-2xl"})}),e.jsx("button",{onClick:t=>{t.stopPropagation(),n(a=>a?{...a,index:(a.index+1)%a.images.length}:null)},className:"absolute right-6 top-1/2 -translate-y-1/2 bg-white/10 hover:bg-white/20 text-white rounded-full p-4 backdrop-blur-md transition-all active:scale-95",children:e.jsx("i",{className:"fas fa-chevron-right text-2xl"})})]}),e.jsx("div",{className:"w-[85vw] h-[80vh] flex items-center justify-center",onClick:t=>t.stopPropagation(),children:e.jsx("img",{src:i.images[i.index].url,className:"max-w-full max-h-full object-contain shadow-2xl rounded-sm",alt:"Gallery View"})}),e.jsx("div",{className:"absolute bottom-10 left-1/2 -translate-x-1/2 flex flex-col items-center gap-2",children:e.jsxs("div",{className:"text-white text-sm bg-blue-600 px-4 py-1.5 rounded-full font-bold shadow-lg",children:[i.index+1," / ",i.images.length]})})]}),document.body)]})};export{te as default};
