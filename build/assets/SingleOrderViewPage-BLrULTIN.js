import{u as Y,a as Z,k as D,r as ee,j as e,B as f,t as o}from"./index-BAM0eJUz.js";import{C as _,a as O}from"./Card-CdxfjEr-.js";import{n as se,b as ae,o as te,p as re,q as le}from"./orderMaterialHistoryApi-CM4FQ_Il.js";import{I as ne}from"./ImageGalleryMain-B3g6b13d.js";import{d as C}from"./downloadFile-BbGV_BaX.js";import{P as ie,O as de}from"./OrderMaterialOverview-6X9CUgR9.js";import{d as E,f as ce}from"./dateFormator-BGKi5rfZ.js";import"./index-C8BdbktQ.js";import"./ShortListMain-CkHPlJB3.js";import"./AssignStaff-Bt6qrEbL.js";import"./Input-1UBXZqEj.js";import"./getAllUsersApi-O0JEgRtZ.js";import"./ResetStageButton-DaUxSSZv.js";import"./SearchSelectNew-IGAHiELy.js";import"./StageGuide-e28gQ0h1.js";import"./vendorAccApi-m3R96_-K.js";import"./useInfiniteQuery-BGz0VllC.js";const ke=()=>{var I,S,P,k;const{projectId:c,orderItemId:m,organizationId:F}=Y(),v=Z(),{role:w,permission:x}=D(),j=w==="owner"||((I=x==null?void 0:x.ordermaterial)==null?void 0:I.create),p=w==="owner"||((S=x==null?void 0:x.ordermaterial)==null?void 0:S.edit),{data:t,isLoading:q,isError:V,refetch:b}=se(c,m),{mutateAsync:W,isPending:z}=ae(),G=async()=>{var a,l;try{if(!c||!m)return;const s=await W({projectId:c,organizationId:t==null?void 0:t.organizationId,orderItemId:m});await C({src:s==null?void 0:s.pdfUrl,alt:"Order Material"}),o({title:"Success",description:"PDF Generated successfully"}),b()}catch(s){o({title:"Error",description:((l=(a=s==null?void 0:s.response)==null?void 0:a.data)==null?void 0:l.message)||(s==null?void 0:s.message)||"Failed to generate PDF",variant:"destructive"})}},[u,h]=ee.useState(null),{mutateAsync:B,isPending:M,variables:U}=te(),{mutateAsync:R,isPending:T,variables:N}=re(),{mutateAsync:H,isPending:L,variables:K}=le(),y=async(a,l,s)=>{var r,A;try{const d=g==null?void 0:g.find(X=>X._id===a);if(!d)return;const J={projectId:c,orderItemId:m,subItemId:a,subItemName:l==="name"?s:d.subItemName,quantity:l==="quantity"?Number(s):d.quantity,unit:l==="unit"?s:d.unit};if(d[l==="name"?"subItemName":l]===s){h(null);return}await R(J),b(),h(null)}catch(d){o({title:"Update Failed",description:((A=(r=d==null?void 0:d.response)==null?void 0:r.data)==null?void 0:A.message)||"Check your connectivity",variant:"destructive"})}},Q=async a=>{var l,s;try{await B({projectId:c,orderItemId:m,subItemName:"",quantity:0,unit:"",index:a+1}),b(),o({title:"Success",description:"Row Added Successfully"})}catch(r){o({title:"Error",description:((s=(l=r==null?void 0:r.response)==null?void 0:l.data)==null?void 0:s.message)||(r==null?void 0:r.message)||"failed to added",variant:"destructive"})}},$=async a=>{var l,s;try{await H({projectId:c,orderItemId:m,subItemId:a}),b(),o({title:"Success",description:"Deleted Successfully"})}catch(r){o({title:"Error",description:((s=(l=r==null?void 0:r.response)==null?void 0:l.data)==null?void 0:s.message)||(r==null?void 0:r.message)||"failed to delete",variant:"destructive"})}};if(q)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"flex flex-col items-center gap-2 text-blue-600",children:[e.jsx("i",{className:"fas fa-spinner fa-spin text-4xl"}),e.jsx("p",{className:"font-medium",children:"Loading Order Details..."})]})});if(V||!t)return e.jsx("div",{className:"p-8 text-center",children:e.jsxs("div",{className:"bg-red-50 text-red-600 p-4 rounded-lg inline-block",children:[e.jsx("i",{className:"fas fa-exclamation-triangle text-2xl mb-2"}),e.jsx("p",{children:"Failed to load order details."}),e.jsx(f,{onClick:()=>v(-1),className:"mt-4",variant:"outline",children:"Go Back"})]})});const{shopDetails:n,deliveryLocationDetails:i,subItems:g}=t;return e.jsx("div",{className:"min-h-full max-h-full overflow-y-auto bg-gray-50/50 p-4 sm:p-6 lg:p-8 font-sans pb-24",children:e.jsxs("div",{className:"max-w-full mx-auto space-y-6",children:[e.jsxs("header",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 bg-white p-4 rounded-xl shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>v(-1),className:"w-8 h-8 flex items-center justify-center rounded-lg bg-gray-100 hover:bg-gray-200 text-gray-600 transition-colors",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl sm:text-2xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx("i",{className:"fa-solid fa-file-invoice text-blue-600"}),"Order Details"]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-y-2 gap-x-3 mt-1.5",children:[e.jsxs("p",{className:"text-sm text-gray-500 flex items-center gap-1.5",children:[e.jsx("span",{className:" text-[10px] font-bold tracking-widest text-gray-800",children:"Order ID:"}),e.jsx("span",{className:"font-mono font-bold text-gray-700 bg-gray-100 px-1.5 py-0.5 rounded border border-gray-200",children:t.orderMaterialNumber||"N/A"})]}),e.jsx("span",{className:"hidden sm:block w-1 h-1 bg-gray-300 rounded-full"}),e.jsxs("div",{className:"flex items-center gap-2 px-2.5 py-1 bg-blue-50 rounded-full border border-blue-100 shadow-sm",children:[e.jsx("i",{className:"far fa-calendar-alt text-[10px] text-blue-500"}),e.jsxs("span",{className:"text-[10px] sm:text-[11px] font-bold text-blue-600 uppercase tracking-tight",children:[E(t.createdAt)," ",e.jsx("span",{className:"mx-1 text-blue-300 opacity-50",children:"|"})," ",ce(t.createdAt)]})]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[t.isSyncWithProcurement&&e.jsxs("span",{className:"px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-xs font-bold flex items-center gap-1 border border-purple-200",children:[e.jsx("i",{className:"fas fa-check-circle"})," Synced with Procurement"]}),t.isPublicOrder&&e.jsxs("span",{className:"px-3 py-1 bg-green-100 text-green-700 rounded-full text-xs font-bold flex items-center gap-1 border border-green-200",children:[e.jsx("i",{className:"fas fa-globe"})," Public Order"]}),(j||p)&&e.jsx(ie,{ele:t,projectId:c,organizationId:F,refetch:b})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(_,{className:"bg-white border-l-4 border-l-purple-500 shadow-sm",children:e.jsxs(O,{className:"p-5",children:[e.jsxs("h3",{className:"text-md font-bold text-gray-800 mb-3 flex items-center gap-2 border-b border-gray-100 pb-2",children:[e.jsx("i",{className:"fas fa-store text-purple-600"})," Shop Details"]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-700",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Name:"})," ",e.jsx("span",{className:"font-semibold",children:(n==null?void 0:n.shopName)||"-"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Contact:"})," ",e.jsx("span",{children:(n==null?void 0:n.contactPerson)||"-"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Phone:"})," ",e.jsx("span",{className:"font-mono",children:(n==null?void 0:n.phoneNumber)||"-"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Location:"})," ",e.jsx("span",{className:"truncate max-w-[200px]",children:(n==null?void 0:n.address)||"-"})]})]})]})}),e.jsx(_,{className:"bg-white border-l-4 border-l-orange-500 shadow-sm",children:e.jsxs(O,{className:"p-5",children:[e.jsxs("h3",{className:"text-md font-bold text-gray-800 mb-3 flex items-center gap-2 border-b border-gray-100 pb-2",children:[e.jsx("i",{className:"fas fa-truck text-orange-600"})," Delivery Location"]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-700",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Site:"})," ",e.jsx("span",{className:"font-semibold",children:(i==null?void 0:i.siteName)||"-"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Supervisor:"})," ",e.jsx("span",{children:(i==null?void 0:i.siteSupervisor)||"-"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Phone:"})," ",e.jsx("span",{className:"font-mono",children:(i==null?void 0:i.phoneNumber)||"-"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Address:"})," ",e.jsx("span",{className:"truncate max-w-[200px]",children:(i==null?void 0:i.address)||"-"})]})]})]})})]}),(t==null?void 0:t.images)&&((P=t==null?void 0:t.images)==null?void 0:P.length)>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-image text-blue-600"})," Images"]}),((k=t==null?void 0:t.images)==null?void 0:k.length)>0?e.jsx(ne,{imageFiles:t==null?void 0:t.images,height:150,minWidth:150,maxWidth:200}):e.jsx("div",{className:"text-gray-500 text-sm italic bg-gray-50 p-8 rounded-lg text-center border-2 border-dashed border-gray-200",children:"No Images uploaded yet."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-cubes text-blue-600"})," Ordered Items"]}),e.jsxs("div",{className:"relative overflow-hidden rounded-lg border-2 border-blue-100 bg-white",children:[e.jsxs("div",{className:"grid grid-cols-12 bg-blue-50/50 border-b border-blue-100 text-[10px] font-bold text-blue-800 uppercase tracking-wide",children:[e.jsx("div",{className:"col-span-1 px-4 py-3 border-r border-blue-100",children:"Ref"}),e.jsx("div",{className:"col-span-5 px-4 py-3 border-r border-blue-100",children:"Material Name"}),e.jsx("div",{className:"col-span-2 px-4 py-3 border-r border-blue-100 text-center",children:"Qty"}),e.jsx("div",{className:"col-span-2 px-4 py-3 border-r border-blue-100 text-center",children:"Unit"}),e.jsx("div",{className:"col-span-2 px-4 py-3 text-center",children:"Actions"})]}),g==null?void 0:g.map((a,l)=>e.jsxs("div",{className:`grid grid-cols-12 border-b border-gray-100 transition-colors text-sm items-center ${t.isSyncWithProcurement?"opacity-80":"hover:bg-blue-50/30"}`,children:[e.jsx("div",{className:"col-span-1 px-4 py-2 border-r border-gray-100 font-semibold text-[10px] text-gray-800",children:a.refId}),e.jsx("div",{className:"col-span-5 px-4 py-2 border-r border-gray-100",children:e.jsx("input",{className:"w-full bg-transparent border-none outline-none focus:bg-blue-50/50 rounded px-1 font-medium disabled:cursor-not-allowed transition-colors",defaultValue:a.subItemName,disabled:t.isSyncWithProcurement||!p,placeholder:"Enter Item Name",onBlur:s=>{const r=s.target.value.trim();r!==a.subItemName&&r!==""?y(a._id,"name",r):s.target.value=a.subItemName},onKeyDown:s=>s.key==="Enter"&&s.currentTarget.blur()})}),e.jsx("div",{className:"col-span-2 px-4 py-2 border-r border-gray-100 text-center",children:e.jsx("input",{type:"number",className:"w-full bg-transparent border-none text-center outline-none focus:bg-blue-50/50 rounded px-1 disabled:cursor-not-allowed transition-colors",defaultValue:a.quantity,disabled:t.isSyncWithProcurement||!p,placeholder:"Quantity",onBlur:s=>{const r=Number(s.target.value);r!==a.quantity&&!isNaN(r)?y(a._id,"quantity",r):s.target.value=a.quantity.toString()},onKeyDown:s=>s.key==="Enter"&&s.currentTarget.blur()})}),e.jsx("div",{className:"col-span-2 px-4 py-2 border-r border-gray-100 text-center",children:(u==null?void 0:u.subItemId)===a._id&&(u==null?void 0:u.field)==="unit"?e.jsx("div",{className:"p-2 relative z-50",children:e.jsxs("select",{autoFocus:!0,defaultValue:a.unit,onChange:s=>y(a._id,"unit",s.target.value),onBlur:()=>h(null),className:"w-full relative z-[50] px-3 py-2 border border-blue-400 rounded-md outline-none bg-white text-sm shadow-sm",children:[e.jsx("option",{value:"",disabled:!0,children:"Select unit"}),de.map(s=>e.jsx("option",{value:s,children:s},s))]})}):e.jsx("div",{className:"px-4 py-3 cursor-pointer mx-auto hover:bg-blue-50 transition-colors h-full flex items-center",onClick:()=>{!t.isSyncWithProcurement&&p&&h({subItemId:a._id,field:"unit"})},children:e.jsx("p",{className:a.unit?"":"text-gray-300 italic text-center",children:a.unit||"Set Unit"})})}),e.jsxs("div",{className:"col-span-2 px-2 py-2 flex items-center justify-center gap-2",children:[!t.isSyncWithProcurement&&j&&e.jsx("button",{onClick:()=>Q(l),className:"p-1.5 cursor-pointer text-blue-600 hover:bg-blue-100 rounded-full transition-colors",title:"Add Item Below",children:M&&U.index-1===l?e.jsx("i",{className:"fas fa-spinner animate-spin"}):e.jsx("i",{className:"fas fa-plus-circle"})}),!t.isSyncWithProcurement&&p&&e.jsx("button",{onClick:()=>$(a._id),className:"p-1.5 cursor-pointer text-red-500 hover:bg-red-50 rounded-full transition-colors",title:"Delete Item",children:L&&K.subItemId===a._id?e.jsx("i",{className:"fas fa-spinner animate-spin"}):e.jsx("i",{className:"fas fa-trash-alt"})}),T&&(N==null?void 0:N.subItemId)===a._id&&e.jsxs("div",{className:"flex items-center gap-1 text-[9px] font-bold text-blue-600 animate-pulse bg-blue-50 px-1.5 py-0.5 rounded border border-blue-100",children:[e.jsx("i",{className:"fas fa-circle-notch fa-spin"}),e.jsx("span",{className:"uppercase tracking-tighter",children:"Saving"})]})]})]},a._id||l))]})]}),e.jsx("section",{className:"bg-white border-t border-gray-200 p-6 shadow-[0_-4px_10px_rgba(0,0,0,0.05)] z-40",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4 border-b border-gray-100 pb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800",children:"Order Documents"}),e.jsx("p",{className:"text-xs text-gray-500",children:"View and download existing pdf"})]}),(p||j)&&e.jsxs(f,{onClick:G,isLoading:z,className:"w-full sm:w-auto bg-blue-600 hover:bg-blue-700 text-white px-6 shadow-md",children:[e.jsx("i",{className:"fas fa-file-pdf mr-2"})," Generate New PDF"]})]}),e.jsx("div",{className:"grid gap-3",children:t!=null&&t.pdfLink&&t.pdfLink.length>0?t.pdfLink.map((a,l)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-xl border border-gray-200 hover:border-blue-300 transition-all group",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-red-50 text-red-500 rounded-lg flex items-center justify-center",children:e.jsx("i",{className:"fas fa-file-pdf text-lg"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-700",children:a.pdfName||`Order_Document_${l+1}.pdf`}),e.jsxs("p",{className:"text-[10px] text-gray-400 uppercase font-bold tracking-wider",children:["Generated on: ",E(a==null?void 0:a.uploadedAt)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(f,{variant:"secondary",size:"sm",onClick:()=>window.open(a.url,"_blank"),children:[e.jsx("i",{className:"fas fa-eye mr-2"})," View"]}),e.jsxs(f,{variant:"primary",size:"sm",onClick:()=>C({src:a.url,alt:a.pdfName}),children:[e.jsx("i",{className:"fas fa-download mr-2"})," Download"]})]})]},a._id||l)):e.jsxs("div",{className:"py-8 text-center border-2 border-dashed border-gray-200 rounded-2xl",children:[e.jsx("i",{className:"fas fa-file-import text-gray-300 text-3xl mb-2"}),e.jsx("p",{className:"text-sm text-gray-500",children:"No PDFs have been generated for this order yet."})]})})]})})]})})};export{ke as default};
