import{j as e,d as G,q as D,c as $,a as M}from"./index-ftjmZ4WH.js";import{u as z}from"./useMutation-CSGCjuCw.js";import{g as V}from"./roleCheck-BuedAs3v.js";import{t as C}from"./toast-BSC5QTk1.js";import{u as K}from"./projectApi-DV972SNS.js";import{B as v}from"./Button-BhpUbe89.js";import{S as Z,a as ee,b as te,c as re,d as ae}from"./Select--aVvXKPg.js";import{u as se,e as ne}from"./quoteVariantApi-Qvh3e2Ay.js";import oe from"./MaterialOverviewLoading-D7Qp4omS.js";import{C as le,a as ie}from"./Card-BB2WhPtT.js";import{d as ce,f as de}from"./dateFormator-B0AlGPNQ.js";import{e as me}from"./labourRateconfigApi-BbXk8Wks.js";import"./useQuery-DmDT-v30.js";import"./Skeleton-DF3ynh9X.js";const R={plywood:1,laminate:1},xe=()=>({itemName:"",plywoodNos:{quantity:0,thickness:0},laminateNos:{quantity:0,thickness:0},carpenters:0,days:0,profitOnMaterial:0,profitOnLabour:0,rowTotal:0,remarks:""}),q=()=>({itemName:"",description:"",quantity:0,cost:0,rowTotal:0}),F=(t,u)=>{if(t.length===0)return[];const c=t.length,g=t[0],d=g.carpenters*g.days*u*(1+(g.profitOnLabour||0)/100)/c;return t.map(y=>{var n,l;const j=((n=y.plywoodNos)==null?void 0:n.quantity)||0,i=((l=y.laminateNos)==null?void 0:l.quantity)||0,r=(j*R.plywood+i*R.laminate)*(1+(y.profitOnMaterial||0)/100);return{...y,rowTotal:Math.round(r+d)}})},ue=({data:t,labourCost:u,updateFurniture:c,removeFurniture:g})=>{const x=i=>{const r=i.coreMaterials.reduce((a,o)=>a+o.rowTotal,0),n=i.fittingsAndAccessories.reduce((a,o)=>a+o.rowTotal,0),l=i.glues.reduce((a,o)=>a+o.rowTotal,0),s=i.nonBrandMaterials.reduce((a,o)=>a+o.rowTotal,0);return{core:r,fittings:n,glues:l,nbms:s,furnitureTotal:r+n+l+s}},h=(i,r,n)=>{var w;const l=[...t.coreMaterials];r==="imageUrl"?(l[i].imageUrl=n,l[i].previewUrl=URL.createObjectURL(n)):r==="plywoodNos"||r==="laminateNos"?l[i][r]={...l[i][r]||{},...n}:l[i][r]=n;const s=F(l,u),a=((w=s==null?void 0:s[0])==null?void 0:w.profitOnMaterial)||0,o=(S,E=!1)=>S.map(A=>{const P=a,O=E?A.cost||0:(A.quantity||0)*(A.cost||0),U=O*(P/100),Q=Math.round(O+U);return{...A,profitOnMaterial:P,rowTotal:Q}}),b={...t,coreMaterials:s,fittingsAndAccessories:o(t.fittingsAndAccessories),glues:o(t.glues,!0),nonBrandMaterials:o(t.nonBrandMaterials)};b.totals=x(b),c==null||c(b)},d=(i,r,n,l)=>{const s=[...t[i]];if(s[r][n]=l,i!=="glues"){const w=(s[r].quantity||0)*(s[r].cost||0),S=w*((s[r].profitOnMaterial||0)/100);s[r].rowTotal=Math.round(w+S)}else{const w=s[r].cost||0,S=w*((s[r].profitOnMaterial||0)/100);s[r].rowTotal=Math.round(w+S)}const a=r===s.length-1,o=s[r].itemName||s[r].description||s[r].quantity||s[r].cost;a&&o&&s.push(q());const b={...t,[i]:s};b.totals=x(b),c&&c(b)},y=()=>e.jsxs("div",{className:"mt-4",children:[e.jsxs("h3",{className:"font-semibold text-md mb-2",children:["Core Materials - Total: ₹",t==null?void 0:t.totals.core.toLocaleString("en-IN")]}),e.jsx("div",{className:"overflow-x-auto  rounded-md",children:e.jsxs("table",{className:"min-w-full text-sm bg-white shadow-sm",children:[e.jsxs("thead",{className:"bg-blue-50 text-sm font-semibold text-gray-600",children:[e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Image"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Item Name"}),e.jsx("th",{className:"text-center px-6 py-1 text-xs font-medium text-gray-500 uppercase tracking-wider",colSpan:2,children:"Plywood"}),e.jsx("th",{className:"text-center px-6 py-1 text-xs font-medium text-gray-500 uppercase tracking-wider",colSpan:2,children:"Laminate"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"No. of Carpenters / Day"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"No. of Days"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Profit % Material"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Profit % Labour"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Remarks"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Total"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Actions"})]}),e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-6 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Qty"}),e.jsx("th",{className:"text-center px-6 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Thk"}),e.jsx("th",{className:"text-center px-6 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Qty"}),e.jsx("th",{className:"text-center px-6 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Thk"})]})]}),e.jsx("tbody",{children:t.coreMaterials.map((i,r)=>e.jsxs("tr",{className:"group relative border-none !border-b-1 px-4 py-2 transition-all duration-150 hover:bg-gray-50",children:[r===0&&e.jsxs("td",{rowSpan:t.coreMaterials.length,children:[e.jsx("input",{type:"file",className:"w-full px-2 py-3 text-center outline-none",onChange:n=>{var l;return h(0,"imageUrl",(l=n.target.files)==null?void 0:l[0])}}),i.previewUrl&&e.jsx("img",{src:i.previewUrl,className:"h-10 mt-2 mx-auto"})]}),e.jsx("td",{className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{value:i.itemName,placeholder:"TV Unit | Wardrobe",onChange:n=>h(r,"itemName",n.target.value),className:"w-full px-2 py-1 text-center outline-none"})}),["plywoodNos","laminateNos"].map(n=>["quantity","thickness"].map(l=>e.jsx("td",{className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",value:i[n][l],onChange:s=>{Number(s.target.value)>=0&&h(r,n,{...i[n],[l]:Number(s.target.value)})},className:"w-full px-2 py-1 text-center outline-none"})},`${n}-${l}`))),r===0&&e.jsxs(e.Fragment,{children:[e.jsx("td",{rowSpan:t.coreMaterials.length,className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",value:i.carpenters,onChange:n=>h(r,"carpenters",Number(n.target.value)),className:"w-full px-2 py-1 text-center outline-none"})}),e.jsx("td",{rowSpan:t.coreMaterials.length,className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",value:i.days,onChange:n=>h(r,"days",Number(n.target.value)),className:"w-full px-2 py-1 text-center outline-none"})})]}),e.jsx("td",{className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",value:i.profitOnMaterial,onChange:n=>h(r,"profitOnMaterial",Number(n.target.value)),className:"w-full px-2 py-1 text-center outline-none"})}),r===0&&e.jsx(e.Fragment,{children:e.jsx("td",{rowSpan:t.coreMaterials.length,className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",value:i.profitOnLabour,onChange:n=>h(r,"profitOnLabour",Number(n.target.value)),className:"w-full px-2 py-1 text-center outline-none"})})}),e.jsx("td",{className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{value:i.remarks,placeholder:"remarks",onChange:n=>h(r,"remarks",n.target.value),className:"w-full px-2 py-1 text-center outline-none"})}),e.jsxs("td",{className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:["₹",i.rowTotal.toLocaleString("en-IN")]}),e.jsx("td",{className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx(v,{variant:"danger",onClick:()=>{const n=[...t.coreMaterials];n.splice(r,1);const l=F(n,u),s={...t,coreMaterials:l};s.totals=x(s),c==null||c(s)},className:"px-1 text-xs bg-red-600 text-white",children:"Remove"})})]},r))})]})}),e.jsx("div",{className:"mt-2 text-right",children:e.jsx(v,{onClick:()=>{const i=[...t.coreMaterials,xe()],r=F(i,u),n={...t,coreMaterials:r};n.totals=x(n),c==null||c(n)},children:"+ Add Core Material"})})]}),j=(i,r)=>{var n;return e.jsxs("div",{className:"mt-6",children:[e.jsxs("h3",{className:"font-semibold text-md mb-2",children:[i," - Total: ₹",(n=t==null?void 0:t.totals[r==="fittingsAndAccessories"?"fittings":r])==null?void 0:n.toLocaleString("en-IN")]}),e.jsx("div",{className:"overflow-x-auto  rounded-md",children:e.jsxs("table",{className:"min-w-full text-sm bg-white shadow-sm",children:[e.jsx("thead",{className:"bg-blue-50 text-sm font-semibold text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Item Name"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Description"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Quantity"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cost"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Profit %"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{children:t[r].map((l,s)=>e.jsxs("tr",{className:"group relative border-none !border-b-1 px-4 !py-2 transition-all duration-150 hover:bg-gray-50",children:[e.jsx("td",{className:"p-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{value:l.itemName||"",placeholder:"Item Name",onChange:a=>d(r,s,"itemName",a.target.value),className:"w-full px-2 py-1 text-center outline-none"})}),e.jsx("td",{className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{value:l.description,placeholder:"description",onChange:a=>d(r,s,"description",a.target.value),className:"w-full px-2 py-1 text-center outline-none"})}),e.jsx("td",{className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",value:l.quantity,onChange:a=>{Number(a.target.value)>=0&&d(r,s,"quantity",Number(a.target.value))},className:"w-full px-2 py-1 text-center outline-none"})}),e.jsx("td",{className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",value:l.cost,onChange:a=>d(r,s,"cost",Number(a.target.value)),className:"w-full px-2 py-1 text-center outline-none"})}),e.jsx("td",{className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",value:l.profitOnMaterial??0,onChange:a=>d(r,s,"profitOnMaterial",Number(a.target.value)),className:"w-16 text-center border border-gray-300 rounded px-2 py-1 text-sm"})}),e.jsxs("td",{className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:["₹",l.rowTotal.toLocaleString("en-IN")]}),e.jsx("td",{className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx(v,{variant:"danger",onClick:()=>{const a=[...t[r]];a.splice(s,1);const o={...t,[r]:a};o.totals=x(o),c&&c(o)},className:"px-1 text-xs bg-red-600 text-white",children:"Remove"})})]},s))})]})}),e.jsx("div",{className:"mt-2 text-right",children:e.jsxs(v,{onClick:()=>{const l=[...t[r],q()],s={...t,[r]:l};s.totals=x(s),c&&c(s)},children:["+ Add ",i," Item"]})})]})};return e.jsxs("div",{className:"shadow-md p-4 my-4 border rounded-lg bg-white",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-700",children:["Product: ",t.furnitureName]}),g&&e.jsx(v,{variant:"danger",size:"sm",onClick:g,className:"bg-red-600 text-white",children:"Remove Product"})]}),y(),j("Fittings","fittingsAndAccessories"),j("Glues","glues"),j("Non-Branded Materials","nonBrandMaterials"),e.jsxs("div",{className:"mt-6 text-right text-xl text-green-700 font-bold",children:["Product Total: ₹",t.totals.furnitureTotal.toLocaleString("en-IN")]})]})},pe=async({api:t,organizationId:u,projectId:c,formData:g})=>{const{data:x}=await t.post(`/quote/quotegenerate/createquote/${u}/${c}`,g,{headers:{"Content-Type":"multipart/form-data"}});if(!x.ok)throw new Error(x.message||"Failed to create quote.");return x.data},ge=async({api:t,organizationId:u,id:c,projectId:g,formData:x})=>{const h=await t.put(`/quote/quotegenerate/editquote/${u}/${g}/${c}`,x);if(!h.data.ok)throw new Error(h.data.message||"Failed to create quote.");return h.data.data},he=()=>{const t=["owner","staff","CTO"],{role:u}=G(),c=V(u);return z({mutationFn:async({organizationId:g,projectId:x,formData:h})=>{if(!u||!t.includes(u))throw new Error("Not allowed to create quotes");if(!c)throw new Error("API instance for role not found");return await pe({api:c,organizationId:g,projectId:x,formData:h})},onSuccess:(g,{organizationId:x})=>{D.invalidateQueries({queryKey:["quote-material-items",x]})}})},fe=()=>{const t=["owner","staff","CTO"],{role:u}=G(),c=V(u);return z({mutationFn:async({organizationId:g,projectId:x,formData:h,id:d})=>{if(!u||!t.includes(u))throw new Error("Not allowed to create quotes");if(!c)throw new Error("API instance for role not found");return await ge({api:c,organizationId:g,projectId:x,formData:h,id:d})},onSuccess:(g,{organizationId:x})=>{D.invalidateQueries({queryKey:["quote-material-items",x]})}})},ye=({quote:t,organizationId:u,setFurnitures:c,setIsEditingId:g,setQuoteType:x,setEditQuoteNo:h,setFiltersMain:d})=>{var r,n;const{mutateAsync:y,isPending:j}=se(),i=async l=>{var s,a;try{await y({id:l,organizationId:u}),C({title:"Success",description:"Items deleted successfully"})}catch(o){C({title:"Error",description:((a=(s=o==null?void 0:o.response)==null?void 0:s.data)==null?void 0:a.message)??"Operation failed"})}};return e.jsx(le,{className:"w-full border-l-4 border-blue-600 shadow-md bg-white hover:shadow-lg transition-all",children:e.jsxs(ie,{className:"p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"my-1",children:[e.jsxs("h3",{className:"text-base font-bold text-blue-700 leading-[8px] ",children:["Project: ",e.jsx("span",{className:"text-black",children:((r=t==null?void 0:t.projectId)==null?void 0:r.projectName)||"Project"})]}),e.jsxs("span",{className:"text-[12px] font-semibold text-gray-500",children:["Quote No: ",e.jsx("span",{className:"text-black",children:t.quoteNo||"N/A"})]})]}),e.jsxs("p",{className:"text-xs text-gray-500 ",children:["Created on: ",ce(t.createdAt)," -  ",de(t.createdAt)]})]}),e.jsx("i",{className:"fas fa-file-alt text-gray-400 text-xl"})]}),e.jsxs("p",{className:"text-sm text-gray-500 italic",children:[e.jsx("strong",{children:"Furnitures: "})," ",((n=t.furnitures)==null?void 0:n.length)||0]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsxs(v,{size:"sm",variant:"secondary",onClick:()=>{const{furnitures:l}=t,s=l.map(a=>({furnitureName:a.furnitureName,coreMaterials:a.coreMaterials.map(o=>({itemName:(o==null?void 0:o.itemName)||"",plywoodNos:(o==null?void 0:o.plywoodNos)||{quantity:0,thickness:0},laminateNos:o.laminateNos||{quantity:0,thickness:0},carpenters:o.carpenters||0,days:o.days||0,profitOnMaterial:o.profitOnMaterial||0,profitOnLabour:o.profitOnLabour||0,rowTotal:o.rowTotal||0,remarks:o.remarks||"",imageUrl:o.imageUrl||"",previewUrl:o.imageUrl||""})),fittingsAndAccessories:a.fittingsAndAccessories||[],glues:a.glues||[],nonBrandMaterials:a.nonBrandMaterials||[],totals:{core:a.coreMaterialsTotal||0,fittings:a.fittingsAndAccessoriesTotal||0,glues:a.gluesTotal||0,nbms:a.nonBrandMaterialsTotal||0,furnitureTotal:a.furnitureTotal||0}}));console.log("parsedFurniture",s),h(t==null?void 0:t.quoteNo),c(s),g(t._id),x(()=>{var a;return((a=t==null?void 0:t.furnitures)==null?void 0:a.length)>1?"residential":"single"}),d({projectId:t.projectId._id,projectName:t.projectId.projectName})},children:[e.jsx("i",{className:"fas fa-eye mr-1"})," Edit"]}),e.jsxs(v,{size:"sm",isLoading:j,variant:"danger",className:"bg-red-600 text-white",onClick:()=>i(t._id),children:[e.jsx("i",{className:"fas fa-trash mr-1"})," Delete"]})]})]})})},Ne=({setFurnitures:t,setEditQuoteNo:u,setIsEditingId:c,setFiltersMain:g,setQuoteType:x})=>{const{organizationId:h}=$(),[d,y]=M.useState({projectId:"",projectName:"",createdAt:""}),{data:j}=K(h),i=j==null?void 0:j.map(a=>({_id:a._id,projectName:a.projectName})),{data:r,isLoading:n}=ne(h,{createdAt:d.createdAt,projectId:d.projectId,quoteNo:""}),l=()=>{y({projectId:"",projectName:"",createdAt:""})},s=Object.values(d).filter(Boolean).length;return e.jsx("div",{children:e.jsxs("main",{className:"flex gap-2 !max-h-[80vh]",children:[e.jsx("div",{className:"xl:w-80 flex-shrink-0",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-filter mr-2 text-blue-600"}),"Filters"]}),s>0&&e.jsxs("button",{onClick:l,className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:["Clear All (",s,")"]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Created Date"}),e.jsx("input",{type:"date",onChange:a=>y(o=>({...o,createdAt:a.target.value})),value:d.createdAt,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Project"}),e.jsx("select",{value:(d==null?void 0:d.projectId)||"",onChange:a=>{const o=i==null?void 0:i.find(b=>b._id===a.target.value);o&&y(b=>({...b,projectId:o._id,projectName:o.projectName}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:i==null?void 0:i.map(a=>e.jsx("option",{value:a._id,children:a.projectName},a._id))})]})]})]})}),e.jsx("section",{className:"w-full max-h-full  gap-2  overflow-y-auto  min-h-full",children:n?e.jsx("p",{children:e.jsx(oe,{})}):r!=null&&r.length?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:r.map(a=>e.jsx(e.Fragment,{children:e.jsx(ye,{setEditQuoteNo:u,setFurnitures:t,setIsEditingId:c,setQuoteType:x,setFiltersMain:g,quote:a,organizationId:h},a._id)}))}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center text-gray-700",children:[e.jsx("i",{className:"fas fa-file-circle-exclamation text-gray-300 text-7xl mb-4"}),e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"No Quotes Found"}),e.jsxs("p",{className:"text-base text-gray-500 leading-relaxed max-w-md",children:["You haven't generated any quote variants yet.",e.jsx("br",{}),"Please create a quote by clicking the + Product section to view brand-wise breakdowns here."]})]})})]})})},I=t=>t.filter(u=>{var c,g;return!!((c=u.itemName)!=null&&c.trim())||!!((g=u.description)!=null&&g.trim())}),Le=()=>{const{organizationId:t}=$(),{data:u}=K(t);let{data:c=0}=me(t);const g=M.useMemo(()=>(u==null?void 0:u.map(m=>({_id:m._id,projectName:m.projectName})))||[],[u]),[x,h]=M.useState({projectId:"",projectName:""}),[d,y]=M.useState([]),[j,i]=M.useState(!1),[r,n]=M.useState(""),[l,s]=M.useState(null),[a,o]=M.useState(null),[b,w]=M.useState(null),{mutateAsync:S,isPending:E}=he(),{mutateAsync:A,isPending:P}=fe(),O=m=>{o(m)},U=()=>a==="single"?"Single Quote":a==="residential"?"Residential Quote":"";M.useEffect(()=>{a==="single"&&!l?(y([]),Q("Common Category")):a==="residential"&&!l&&(y([]),i(!0))},[a]);const Q=m=>{y(N=>[...N,{furnitureName:m,coreMaterials:[J()],fittingsAndAccessories:[B()],glues:[B()],nonBrandMaterials:[B()],totals:{core:0,fittings:0,glues:0,nbms:0,furnitureTotal:0}}])},W=m=>{y(N=>N.filter((f,p)=>p!==m))},J=()=>({itemName:"",plywoodNos:{quantity:0,thickness:0},laminateNos:{quantity:0,thickness:0},carpenters:0,days:0,profitOnMaterial:0,profitOnLabour:0,rowTotal:0,remarks:""}),B=()=>({itemName:"",description:"",quantity:0,cost:0,rowTotal:0}),_=d==null?void 0:d.reduce((m,N)=>m+N.totals.furnitureTotal,0),Y=async()=>{var m,N;try{if(!x.projectId){C({title:"Error",description:"Please select a project",variant:"destructive"});return}const f=new FormData;f.append("furnitures",JSON.stringify(d.map(p=>({furnitureName:p.furnitureName,coreMaterials:p.coreMaterials.map(T=>{if(Object.values(T).some(k=>!!k)){const{imageUrl:k,previewUrl:L,...X}=T;return X}}),fittingsAndAccessories:I(p.fittingsAndAccessories),glues:I(p.glues),nonBrandMaterials:I(p.nonBrandMaterials),coreMaterialsTotal:p.totals.core,fittingsAndAccessoriesTotal:p.totals.fittings,gluesTotal:p.totals.glues,nonBrandMaterialsTotal:p.totals.nbms,furnitureTotal:p.totals.furnitureTotal})))),d.forEach((p,T)=>{p.coreMaterials.forEach((k,L)=>{k.imageUrl&&f.append(`images[${T}][${L}]`,k.imageUrl)})}),f.append("grandTotal",_.toString()),f.append("notes","Generated"),await S({organizationId:t,projectId:x.projectId,formData:f}),C({title:"Success",description:"Created Successfully, Visit in Quote Generator Section"}),y([]),o(null)}catch(f){C({title:"Error",description:((N=(m=f==null?void 0:f.response)==null?void 0:m.data)==null?void 0:N.message)||(f==null?void 0:f.message)||"failed to generate the items",variant:"destructive"})}},H=async()=>{var m,N;try{if(!x.projectId){C({title:"Error",description:"Please select a project",variant:"destructive"});return}const f={furnitures:d.map(p=>({furnitureName:p.furnitureName,coreMaterials:p.coreMaterials.map(T=>{const{previewUrl:k,...L}=T;return{...L,imageUrl:T.imageUrl||null}}),fittingsAndAccessories:I(p.fittingsAndAccessories),glues:I(p.glues),nonBrandMaterials:I(p.nonBrandMaterials),coreMaterialsTotal:p.totals.core,fittingsAndAccessoriesTotal:p.totals.fittings,gluesTotal:p.totals.glues,nonBrandMaterialsTotal:p.totals.nbms,furnitureTotal:p.totals.furnitureTotal})),grandTotal:_,notes:"Updated via frontend",quoteNo:b};l&&(await A({organizationId:t,projectId:x.projectId,formData:f,id:l}),C({title:"Updated!",description:"Quote edited successfully."}),y([]),o(null),s(null))}catch(f){C({title:"Error",description:((N=(m=f==null?void 0:f.response)==null?void 0:m.data)==null?void 0:N.message)||(f==null?void 0:f.message)||"Failed to Update the Quote",variant:"destructive"})}};return e.jsxs("div",{className:`h-full mx-auto max-h-full ${l?"overflow-y-auto":""} `,children:[e.jsxs("header",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 py-1 border-b-1 border-[#818283]",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-file mr-3 text-blue-600"}),"Internal Quote Entry"]}),(d==null?void 0:d.length)>0&&e.jsxs("p",{className:"ml-[30px] mt-[5px] block text-[15px] text-gray-800",children:["Single Labour cost:  ",e.jsxs("span",{className:"text-black font-semibold",children:["₹",c]})]})]}),e.jsxs("div",{className:"flex gap-6 items-center ",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Select QuoteType"}),e.jsxs(Z,{onValueChange:m=>O(m),children:[e.jsx(ee,{className:"w-full",children:e.jsx(te,{placeholder:"Select Quote",selectedValue:a||""})}),e.jsx(re,{children:["single","residential"].map(m=>e.jsx(ae,{value:m.toString(),children:m},m))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Select Project *"}),e.jsxs("select",{value:x.projectId,onChange:m=>{const N=g.find(f=>f._id===m.target.value);N&&h({projectId:N._id,projectName:N.projectName})},className:" px-2 py-2 rounded-xl border border-blue-200 focus:border-blue-200 active:border-blue-200",children:[e.jsx("option",{value:"",children:"Select a project"}),g.map(m=>e.jsx("option",{value:m._id,children:m.projectName},m._id))]})]}),d.length>0&&e.jsxs("div",{className:"text-right flex gap-2 items-center",children:[e.jsx("div",{className:"text-xs text-gray-600 uppercase tracking-widest",children:"Grand Total"}),e.jsxs("div",{className:"text-xl font-semibold text-green-600",children:["₹",_.toLocaleString("en-IN")]})]}),e.jsxs(v,{className:"flex items-center",onClick:()=>{i(!0)},children:[e.jsx("i",{className:"fas fa-add mr-1",children:" "})," Product"]})]})]}),j&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 bg-opacity-40 backdrop-blur-sm transition",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg p-6 w-full max-w-md relative animate-scaleIn",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-800",children:"Add New Product"}),e.jsx("input",{className:"w-full border border-gray-300 rounded px-3 py-2 mb-4 outline-none focus:ring-2 focus:ring-blue-400",placeholder:"Enter Product Name",value:r,autoFocus:!0,onChange:m=>n(m.target.value),onKeyDown:m=>{if(m.key==="Enter"){if(!r.trim())return;Q(r),n(""),i(!1)}}}),e.jsxs("div",{className:"flex justify-end gap-3 mt-4",children:[e.jsx(v,{variant:"secondary",onClick:()=>i(!1),children:"Cancel"}),e.jsx(v,{onClick:()=>{r.trim()&&(Q(r),n(""),i(!1))},children:"Create"})]})]})}),d.length>0&&e.jsxs("section",{className:"shadow overflow-y-auto max-h-[86%]",children:[!l&&e.jsx("h1",{className:"text-2xl text-gray-500",children:U()}),d.map((m,N)=>e.jsx(ue,{index:N,labourCost:c,data:m,updateFurniture:f=>{const p=[...d];p[N]=f,y(p)},removeFurniture:()=>W(N)},N))]}),d.length!==0&&e.jsxs("div",{className:"mt-1 text-right flex gap-2 justify-end",children:[e.jsx(v,{variant:"primary",isLoading:E||P,onClick:l?H:Y,className:"px-6 py-2 bg-blue-600 text-white rounded",children:"Save Quote"}),!l&&e.jsx(v,{variant:"secondary",onClick:()=>{y([]),o(null)},className:"",children:"Cancel"}),l&&e.jsx(v,{variant:"secondary",onClick:()=>{s(null),y([]),o(null),w(null)},className:"",children:"Cancel"})]}),!l&&(d==null?void 0:d.length)===0&&e.jsx("section",{className:"my-4",children:e.jsx(Ne,{setEditQuoteNo:w,setIsEditingId:s,setFurnitures:y,setQuoteType:o,setFiltersMain:h})})]})};export{Le as default,I as filterValidSimpleRows};
