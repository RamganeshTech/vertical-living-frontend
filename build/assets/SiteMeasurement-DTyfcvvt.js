import{k as y,q as N,b as K,r as F,j as e,B as C,I as re,t as g,d as ne}from"./index-B7U0voEN.js";import{u as oe}from"./useQuery-B4RrmMvA.js";import{u as f,g as b}from"./roleCheck-DCYFBDfO.js";import{c as W}from"./Card-CInTFOVP.js";import{A as le,S as ie}from"./AssignStaff-s8Id0Omb.js";import{R as de}from"./StageFileUploader-D6tMTais.js";import{d as z}from"./downloadFile-BOh4X7Gv.js";import{N as ce,e as ue}from"./constants-BAzBevij.js";import{R as me}from"./ResetStageButton-Br8Vm6ww.js";import he from"./MaterialOverviewLoading-BCZy2_Zm.js";import{S as ge}from"./ShareDocumentWhatsapp-Cgazew4b.js";import"./getAllUsersApi-CWX5sC3d.js";import"./Skeleton-DbVjxyY1.js";import"./documentationApi-D-pWxgHG.js";const pe=async({projectId:t,siteDetails:s,api:a})=>{const{data:r}=await a.post(`/sitemeasurement/createmeasurement/${t}`,{siteDetails:s});if(!r.ok)throw new Error(r.message);return r.data},xe=async({projectId:t,room:s,api:a})=>{const{data:r}=await a.post(`/sitemeasurement/createroom/${t}`,{room:s});if(!r.ok)throw new Error(r.message);return r.data},fe=async({projectId:t,api:s})=>{const{data:a}=await s.get(`/sitemeasurement/getmeasurement/${t}`);if(!a.ok)throw new Error(a.message);return a.data},be=async({projectId:t,api:s,payload:a})=>{const{data:r}=await s.put(`/sitemeasurement/updatecommonmeasurement/${t}`,a);if(!r.ok)throw new Error(r.message);return r.data},we=async({projectId:t,api:s,roomId:a,room:r})=>{const{data:n}=await s.put(`/sitemeasurement/updateroommeasurement/${t}/${a}`,{room:r});if(!n.ok)throw new Error(n.message);return n.data},ye=async({projectId:t,api:s})=>{const{data:a}=await s.put(`/sitemeasurement/completionstatus/${t}`);if(!a.ok)throw new Error(a.message);return a.data},je=async({projectId:t,roomId:s,api:a})=>{const{data:r}=await a.patch(`/sitemeasurement/deleteroom/${t}/${s}`);if(!r.ok)throw new Error(r.message);return r.data},ve=async({projectId:t,api:s})=>{const{data:a}=await s.put(`/sitemeasurement/deletesitemeasurement/${t}`);if(!a.ok)throw new Error(a.message);return a.data},Ne=async({formId:t,projectId:s,deadLine:a,api:r})=>{const{data:n}=await r.put(`/sitemeasurement/deadline/${s}/${t}`,{deadLine:a});if(!n.ok)throw new Error(n.message);return n.data},Se=async({formId:t,files:s,api:a,projectId:r})=>{const n=new FormData;return s.forEach(w=>n.append("file",w)),(await a.post(`/sitemeasurement/upload/multiple/${r}/${t}`,n,{headers:{"Content-Type":"multipart/form-data"}})).data},Fe=async(t,s,a)=>{const{data:r}=await a.patch(`/sitemeasurement/${t}/deleteuploadedfile/${s}`);if(!r.ok)throw new Error(r.message);return r.data},Ce=()=>{const{role:t}=f(),s=b(t),a=["owner","staff","CTO","client"];return y({mutationFn:async({projectId:r,fileId:n})=>{if(!t||!a.includes(t))throw new Error("not allowed to make this api call");if(!s)throw new Error("API instance not found for role");return await Fe(r,n,s)},onSuccess:(r,{projectId:n})=>{N.invalidateQueries({queryKey:["siteMeasurement",n]})}})},ke=({projectId:t})=>{const s=["owner","staff","CTO","client"],{role:a}=f(),r=b(a);return oe({queryKey:["siteMeasurement"],queryFn:async()=>{if(!a||!s.includes(a))throw new Error("not allowed to make this api call");if(!r)throw new Error("API instance not found for role");return await fe({projectId:t,api:r})},retry:!1,refetchOnWindowFocus:!1})},Ee=()=>{const t=["owner","staff","CTO","client"],{role:s}=f(),a=b(s);return y({mutationFn:async({projectId:r,siteDetails:n})=>{if(!s||!t.includes(s))throw new Error("not allowed to make this api call");if(!a)throw new Error("API instance not found for role");return await pe({projectId:r,api:a,siteDetails:n})},onSuccess:()=>{N.invalidateQueries({queryKey:["siteMeasurement"]})}})},Re=()=>{const t=["owner","staff","CTO","client"],{role:s}=f(),a=b(s);return y({mutationFn:async({projectId:r,room:n})=>{if(!s||!t.includes(s))throw new Error("not allowed to make this api call");if(!a)throw new Error("API instance not found for role");return await xe({projectId:r,api:a,room:n})},onSuccess:()=>{N.invalidateQueries({queryKey:["siteMeasurement"]})}})},Ae=()=>{const t=["owner","staff","CTO","client"],{role:s}=f(),a=b(s);return y({mutationFn:async({projectId:r,payload:n})=>{if(!s||!t.includes(s))throw new Error("not allowed to make this api call");if(!a)throw new Error("API instance not found for role");return await be({projectId:r,api:a,payload:n})},onSuccess:()=>{N.invalidateQueries({queryKey:["siteMeasurement"]})}})},Me=()=>{const t=["owner","staff","CTO","client"],{role:s}=f(),a=b(s);return y({mutationFn:async({projectId:r,roomId:n,room:o})=>{if(!s||!t.includes(s))throw new Error("not allowed to make this api call");if(!a)throw new Error("API instance not found for role");return await we({projectId:r,api:a,roomId:n,room:o})},onSuccess:()=>{N.invalidateQueries({queryKey:["siteMeasurement"]})}})},Pe=()=>{const t=["owner","staff","CTO","client"],{role:s}=f(),a=b(s);return y({mutationFn:async({projectId:r})=>{if(!s||!t.includes(s))throw new Error("not allowed to make this api call");if(!a)throw new Error("API instance not found for role");return await ye({projectId:r,api:a})},onSuccess:()=>{N.invalidateQueries({queryKey:["siteMeasurement"]})}})},qe=()=>{const t=["owner","staff","CTO","client"],{role:s}=f(),a=b(s);return y({mutationFn:async({projectId:r,roomId:n})=>{if(!s||!t.includes(s))throw new Error("not allowed to make this api call");if(!a)throw new Error("API instance not found for role");return await je({projectId:r,api:a,roomId:n})},onSuccess:()=>{N.invalidateQueries({queryKey:["siteMeasurement"]})}})},Ie=()=>{const t=["owner","staff","CTO","client"],{role:s}=f(),a=b(s);return y({mutationFn:async({projectId:r})=>{if(!s||!t.includes(s))throw new Error("not allowed to make this api call");if(!a)throw new Error("API instance not found for role");return await ve({projectId:r,api:a})},onSuccess:()=>{N.invalidateQueries({queryKey:["siteMeasurement"]})}})},Oe=()=>{const t=["owner","staff","CTO"],{role:s}=f(),a=b(s);return y({mutationFn:async({formId:r,projectId:n,deadLine:o})=>{if(!s)throw new Error("not authorized");if(!t.includes(s))throw new Error("you  dont have the access to make this api");if(!a)throw new Error("api is null");return await Ne({formId:r,deadLine:o,projectId:n,api:a})}})},$e=()=>{const t=["owner","staff","CTO","client"],{role:s}=f(),a=b(s);return y({mutationFn:async({formId:r,files:n,projectId:o})=>{if(!s)throw new Error("not authorized");if(!t.includes(s))throw new Error("you  dont have the access to make this api");if(!a)throw new Error("api is null");return await Se({formId:r,files:n,projectId:o,api:a})}})},Le=async({roomId:t,files:s,api:a,projectId:r})=>(await a.post(`/sitemeasurement/uploadroom/${r}/${t}`,s,{headers:{"Content-Type":"multipart/form-data"}})).data,Te=async({roomId:t,uploadId:s,api:a,projectId:r})=>(await a.delete(`/sitemeasurement/deleteroom/${r}/${t}/${s}`)).data,Ue=()=>{const t=["owner","staff","CTO","client"],{role:s}=f(),a=b(s);return y({mutationFn:async({roomId:r,files:n,projectId:o})=>{if(!s)throw new Error("not authorized");if(!t.includes(s))throw new Error("you  dont have the access to make this api");if(!a)throw new Error("api is null");return await Le({roomId:r,files:n,projectId:o,api:a})},onSuccess:()=>{N.invalidateQueries({queryKey:["siteMeasurement"]})}})},Be=()=>{const t=["owner","staff","CTO","client"],{role:s}=f(),a=b(s);return y({mutationFn:async({roomId:r,uploadId:n,projectId:o})=>{if(!s)throw new Error("not authorized");if(!t.includes(s))throw new Error("you  dont have the access to make this api");if(!a)throw new Error("api is null");return await Te({roomId:r,uploadId:n,projectId:o,api:a})},onSuccess:()=>{N.invalidateQueries({queryKey:["siteMeasurement"]})}})},We=({room:t,onEdit:s,onDelete:a,deleteRoomLoading:r})=>{const{projectId:n}=K(),o=t.length&&t.breadth?(t.length*t.breadth).toFixed(2):null,[w,c]=F.useState(null),v=(t==null?void 0:t.uploads)||[];console.log("uploads",t.uploads);const{mutateAsync:q,isPending:j}=Ue(),{mutateAsync:A,isPending:k}=Be(),P=async l=>{var d,h;try{const p=l.target.files;if(!p||p.length===0)return;const E=Array.from(p).filter(R=>R.type.startsWith("image/"));if(E.length===0){g({title:"Error",description:"Please select only image files",variant:"destructive"});return}E.length!==p.length&&g({title:"Warning",description:"Only image files were uploaded. PDFs were skipped.",variant:"destructive"});const M=new FormData;E.forEach(R=>M.append("file",R)),await q({roomId:t._id,files:M,projectId:n}),g({title:"Success",description:"Images uploaded successfully"}),l.target.value=""}catch(p){g({title:"Error",description:((h=(d=p==null?void 0:p.response)==null?void 0:d.data)==null?void 0:h.message)||"Failed to upload",variant:"destructive"})}},i=async l=>{var d,h;try{await A({roomId:t._id,uploadId:l,projectId:n}),g({title:"Success",description:"Image deleted successfully"})}catch(p){g({title:"Error",description:((h=(d=p==null?void 0:p.response)==null?void 0:d.data)==null?void 0:h.message)||"Failed to delete",variant:"destructive"})}};return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-2 sm:p-6 mb-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold text-blue-700",children:t.name}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>s(t),className:"text-blue-600 hover:text-blue-800",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx(C,{isLoading:r,onClick:a,variant:"ghost",className:"!text-red-600 hover:text-red-800 bg-white shadow-none hover:!bg-none",children:e.jsx("i",{className:"fas fa-trash-can"})})]})]}),e.jsxs("div",{className:"space-y-4 w-full",children:[e.jsxs("div",{className:"flex items-center justify-between w-full relative",children:[e.jsx(re,{type:"file",multiple:!0,accept:"image/*",placeholder:"Select images",onChange:P,disabled:j,className:j?"pr-10 opacity-70 cursor-not-allowed w-full":""}),j&&e.jsx("div",{className:"absolute inset-y-0 right-2 flex items-center",children:e.jsxs("svg",{className:"animate-spin h-5 w-5 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4l3.5-3.5L12 0v4a8 8 0 100 16v4l3.5-3.5L12 20v-4a8 8 0 01-8-8z"})]})})]}),e.jsxs("div",{className:"my-6",children:[e.jsx("h4",{className:"text-lg font-semibold mb-4 text-gray-800",children:"Room Images"}),v.length===0?e.jsx("div",{className:"text-gray-500 text-sm italic bg-gray-50 p-8 rounded-lg text-center border-2 border-dashed border-gray-200",children:"No images uploaded yet."}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 p-4 bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl",children:v.map(l=>e.jsx("div",{className:"group transition-all duration-300 hover:scale-105 hover:z-10",children:e.jsxs("div",{className:"relative w-full bg-white rounded-lg shadow-md overflow-hidden border-4 border-white group-hover:shadow-xl transition-all duration-300 cursor-pointer",onClick:()=>c(l==null?void 0:l.url),children:[e.jsx("div",{className:"aspect-square w-full",children:e.jsx("img",{src:l.url||ce,alt:l.originalName,className:"w-full h-full transition-transform duration-300 group-hover:scale-110"})}),e.jsx("div",{className:"absolute inset-0 bg-opacity-0 group-hover:bg-opacity-40 transition-all duration-300 items-center justify-center hidden md:flex",children:e.jsx("div",{className:"flex space-x-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300 transform translate-y-4 group-hover:translate-y-0",children:["eye","trash","download"].map(d=>e.jsx(C,{variant:"secondary",size:"sm",onClick:h=>{h.stopPropagation(),d==="eye"?c(l==null?void 0:l.url):d==="trash"?i(l._id):z({src:l==null?void 0:l.url,alt:(l==null?void 0:l.originalName)||"image"})},disabled:d==="trash"&&k,className:`rounded-full bg-white hover:bg-gray-100 shadow-lg transition-all duration-200 ${d==="trash"?"hover:bg-red-50":""}`,children:e.jsx("i",{className:`w-3 h-3 fas fa-${d} ${d==="trash"?"text-red-500":d==="download"?"text-blue-500":"text-gray-600"}`})},d))})}),e.jsx("div",{className:"absolute top-2 right-[2px] flex flex-col space-y-1 sm:hidden",children:["eye","trash","download"].map(d=>e.jsx(C,{variant:"secondary",size:"sm",onClick:h=>{h.stopPropagation(),d==="eye"?c(l==null?void 0:l.url):d==="trash"?i(l._id):z({src:l==null?void 0:l.url,alt:(l==null?void 0:l.originalName)||"image"})},disabled:d==="trash"&&k,className:`w-6 h-6 p-0 rounded-full bg-white/90 backdrop-blur-sm border shadow-sm transition-all duration-200 ${d==="trash"?"border-red-200 hover:border-red-300 hover:bg-red-50":d==="download"?"border-blue-200 hover:border-blue-300 hover:bg-blue-50":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,children:e.jsx("i",{className:`w-3 h-3 fas fa-${d} ${d==="trash"?"text-red-500":d==="download"?"text-blue-500":"text-gray-600"}`})},d))})]})},l._id))})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Length"}),e.jsxs("p",{className:"font-semibold text-gray-800",children:[t.length||0," ft"]})]}),e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Breadth"}),e.jsxs("p",{className:"font-semibold text-gray-800",children:[t.breadth||0," ft"]})]}),e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Height"}),e.jsxs("p",{className:"font-semibold text-gray-800",children:[t.height||0," ft"]})]})]}),o&&e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:e.jsxs("p",{className:"text-blue-700 font-medium text-center",children:["Total Area: ",o," sq.ft"]})}),w&&e.jsx("div",{onClick:()=>c(null),className:"fixed inset-0 z-50 flex items-center justify-center bg-opacity-80 backdrop-blur-sm",children:e.jsxs("div",{onClick:l=>l.stopPropagation(),className:"relative bg-white rounded-xl shadow-2xl max-w-[90%] max-h-[90%] p-2 overflow-hidden",children:[e.jsx("button",{onClick:()=>c(null),className:"absolute top-4 right-4 z-10 w-8 h-8 bg-opacity-50 hover:bg-opacity-70 text-white rounded-full flex items-center justify-center transition-all duration-200",children:e.jsx("i",{className:"fas fa-times text-sm"})}),e.jsx("img",{src:w||"/placeholder.svg",alt:"Preview",className:"w-full max-h-[80vh] object-contain mx-auto rounded-lg"})]})})]})},ze=({measurementData:t,handleDeleteSiteMeasurement:s,deleteRoomLoading:a,setShowSiteForm:r,setShowRoomForm:n,handleEditRoom:o,handleDeleteRoom:w})=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Site Measurements"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>r(!0),className:"px-2 sm:px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Edit"}),e.jsx("button",{onClick:()=>s(),className:"px-2 sm:px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"Delete"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total Plot Area"}),e.jsx("p",{className:"text-lg font-semibold text-blue-700",children:t.siteDetails.totalPlotAreaSqFt!==null?`${t.siteDetails.totalPlotAreaSqFt} sq.ft`:"Not mentioned"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Built-up Area"}),e.jsx("p",{className:"text-lg font-semibold text-blue-700",children:t.siteDetails.builtUpAreaSqFt!=null?`${t.siteDetails.builtUpAreaSqFt} sq.ft`:"Not mentioned"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Road Facing"}),e.jsx("p",{className:"text-lg font-semibold text-blue-700",children:t.siteDetails.roadFacing===!0?"YES":t.siteDetails.roadFacing===!1?"NO":"Not mentioned"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Number of Floors"}),e.jsx("p",{className:"text-lg font-semibold text-blue-700",children:t.siteDetails.numberOfFloors!=null?t.siteDetails.numberOfFloors:"Not mentioned"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Is having Slope"}),e.jsx("p",{className:"text-lg font-semibold text-blue-700",children:t.siteDetails.hasSlope===!0?"YES":t.siteDetails.hasSlope===!1?"NO":"Not mentioned"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Is Boundary Wall exists"}),e.jsx("p",{className:"text-lg font-semibold text-blue-700",children:t.siteDetails.boundaryWallExists===!0?"YES":t.siteDetails.boundaryWallExists===!1?"NO":"Not mentioned"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Additional Notes"}),e.jsx("p",{className:"text-lg font-semibold text-blue-700",children:t.siteDetails.additionalNotes?t.siteDetails.additionalNotes:"Not mentioned"})]})]})]}),t.siteDetails.totalPlotAreaSqFt!==null&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Rooms"}),e.jsx("button",{onClick:()=>n(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"+ Add Room"})]}),t.rooms.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})})}),e.jsx("p",{className:"text-gray-500",children:"No rooms added yet"})]}):e.jsx("div",{className:"mt-4 grid grid-cols-1 gap-6",children:t.rooms.map((c,v)=>e.jsx(We,{room:c,onEdit:()=>o(c),onDelete:()=>w(c._id),deleteRoomLoading:a},v))})]})]}),_e=F.memo(ze),Ke=({roomDetails:t,setRoomDetails:s,handleRoomSubmit:a,setShowRoomForm:r,updateRoomLoading:n,createRoomLoading:o,editingRoomId:w})=>e.jsx("div",{className:"fixed inset-0 bg-black/70 bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-md p-6",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-6",children:w?"Edit Room":"Add New Room"}),e.jsxs("select",{value:t.name||"",onChange:c=>s(v=>({...v,name:c.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent mb-4",children:[e.jsx("option",{value:"",children:"Select Room Type"}),ue.map(c=>e.jsx("option",{value:c,children:c}))]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"",children:"Length (ft)"}),e.jsx("input",{type:"number",placeholder:"Length (ft)",value:t.length||0,onChange:c=>s({...t,length:Number(c.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"",children:"Breadth (ft)"}),e.jsx("input",{type:"number",placeholder:"Breadth (ft)",value:t.breadth||0,onChange:c=>s({...t,breadth:Number(c.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"",children:"Height (ft)"}),e.jsx("input",{type:"number",placeholder:"Height (ft)",value:t.height||0,onChange:c=>s({...t,height:Number(c.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),t.length&&t.breadth&&e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg mb-4",children:e.jsxs("p",{className:"text-blue-700 font-medium",children:["Calculated Area: ",(Number(t.length)*Number(t.breadth)).toFixed(2)," sq.ft"]})}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{onClick:()=>r(!1),className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsx(C,{isLoading:w?n:o,onClick:a,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:w?"Edit Room":"Add Room"})]})]})}),Qe=({siteDetails:t,updatePending:s,setSiteDetails:a,handleSiteSubmit:r,setShowSiteForm:n})=>e.jsx("div",{className:"fixed inset-0 bg-black/70 bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-2xl p-6",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-6",children:"Site Measurements"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"",children:"Total Plot Area (sq.ft)"}),e.jsx("input",{type:"number",placeholder:"Total Plot Area (sq.ft)",value:t.totalPlotAreaSqFt||0,onChange:o=>a({...t,totalPlotAreaSqFt:Number(o.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"",children:"Built-up Area (sq.ft)"}),e.jsx("input",{type:"number",placeholder:"Built-up Area (sq.ft)",value:t.builtUpAreaSqFt||0,onChange:o=>a({...t,builtUpAreaSqFt:Number(o.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"",children:"Number of Floors"}),e.jsx("input",{type:"number",placeholder:"Number of Floors",value:t.numberOfFloors||0,onChange:o=>a({...t,numberOfFloors:Number(o.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 mb-4",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:t.hasSlope??!1,onChange:o=>a({...t,hasSlope:o.target.checked}),className:"mr-2"}),"Has Slope"]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:t.roadFacing??!1,onChange:o=>a({...t,roadFacing:o.target.checked}),className:"mr-2"}),"Road Facing"]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:t.boundaryWallExists??!1,onChange:o=>a({...t,boundaryWallExists:o.target.checked}),className:"mr-2"}),"Boundary Wall Exists"]})]}),e.jsx("textarea",{placeholder:"Additional Notes",value:t.additionalNotes||"",onChange:o=>a({...t,additionalNotes:o.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent mb-4",rows:4}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(C,{variant:"secondary",onClick:()=>n(!1),className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsx(C,{variant:"primary",onClick:r,isLoading:s,children:"Save Details"})]})]})}),He=F.memo(Qe),Ge={totalPlotAreaSqFt:null,builtUpAreaSqFt:null,roadFacing:null,numberOfFloors:null,hasSlope:!1,boundaryWallExists:!1,additionalNotes:null},_={name:null,length:null,breadth:null,height:null,uploads:[]};function it(){var $,L,T,U,B;const{projectId:t,organizationId:s}=K(),{isMobile:a,openMobileSidebar:r}=ne();if(!t)return;const[n,o]=F.useState(!1),[w,c]=F.useState(!1),[v,q]=F.useState(Ge),[j,A]=F.useState(_),[k,P]=F.useState(null);let{data:i,isLoading:l,refetch:d,error:h}=ke({projectId:t});const p=Ee(),E=Re(),M=Ae(),R=Me(),I=qe(),Q=Ie(),O=Pe(),{mutateAsync:H,isPending:G}=Oe(),{mutateAsync:Y,isPending:V}=$e(),{mutateAsync:J,isPending:X}=Ce(),Z=async()=>{var m,x;try{Object.values(i.siteDetails).some(S=>typeof S=="number")?await M.mutateAsync({projectId:t,payload:v}):await p.mutateAsync({projectId:t,siteDetails:v}),o(!1),g({description:"Site details updated successfully",title:"Success"})}catch(u){g({title:"Error",description:((x=(m=u==null?void 0:u.response)==null?void 0:m.data)==null?void 0:x.message)||u.message||"Failed to save site details",variant:"destructive"})}},D=async()=>{var m,x;try{if(!j.name)throw new Error("please select the name");const u=j.length&&j.breadth?(Number(j.length)*Number(j.breadth)).toFixed(2):null,S={...j,area:u};k?await R.mutateAsync({projectId:t,roomId:k,room:S}):await E.mutateAsync({projectId:t,room:S}),c(!1),P(null),A(_),g({description:k?"Room updated":"Room added",title:"Success"})}catch(u){g({title:"Error",description:((x=(m=u==null?void 0:u.response)==null?void 0:m.data)==null?void 0:x.message)||(u==null?void 0:u.message)||"Operation failed",variant:"destructive"})}},ee=async m=>{var x,u;try{await I.mutateAsync({projectId:t,roomId:m}),g({description:"Room deleted",title:"Success"})}catch(S){g({title:"Error",description:((u=(x=S==null?void 0:S.response)==null?void 0:x.data)==null?void 0:u.message)||"Delete failed",variant:"destructive"})}},te=async()=>{var m,x;try{await Q.mutateAsync({projectId:t}),g({description:"Site measurement deleted",title:"Success"})}catch(u){g({title:"Error",description:((x=(m=u==null?void 0:u.response)==null?void 0:m.data)==null?void 0:x.message)||"Delete failed",variant:"destructive"})}},se=async()=>{var m,x;try{await O.mutateAsync({projectId:t}),g({description:"Completion updated",title:"Success"})}catch(u){g({title:"Error",description:((x=(m=u==null?void 0:u.response)==null?void 0:m.data)==null?void 0:x.message)||"Update failed",variant:"destructive"})}},ae=m=>{A(m),P(m==null?void 0:m._id),c(!0)};return l?e.jsx(he,{}):e.jsxs("div",{className:"container mx-auto px-2 py-2 max-w-full h-full w-full overflow-y-auto custom-scrollbar",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center mb-6 gap-4",children:[e.jsxs("div",{className:"w-full sm:w-auto",children:[e.jsxs("h2",{className:"text-2xl sm:text-3xl font-semibold text-blue-600 flex items-center",children:[a&&e.jsx("button",{onClick:r,className:"mr-3 p-2 rounded-md border border-gray-300 hover:bg-gray-100",title:"Open Menu",children:e.jsx("i",{className:"fa-solid fa-bars"})}),e.jsx("i",{className:"fa-solid fa-receipt mr-2"})," Site Measurement"]}),e.jsx("p",{className:"text-gray-600 hidden sm:block text-sm sm:text-base",children:"Plan your dream home"})]}),e.jsxs("div",{className:"flex flex-wrap sm:flex-nowrap items-center gap-2  !w-[100%] sm:!w-[50%] lg:!w-[60%] justify-start lg:justify-end",children:[e.jsxs(C,{isLoading:O.isPending,onClick:se,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2  w-full sm:w-auto",children:[e.jsx("i",{className:"fa-solid fa-circle-check mr-2"})," Mark Complete"]}),e.jsx(me,{projectId:t,stageNumber:2,stagePath:"sitemeasurement",className:"sm:!max-w-[20%] w-full"}),!h&&e.jsx(ge,{projectId:t,stageNumber:"2",className:"w-full sm:w-fit",isStageCompleted:i==null?void 0:i.status}),e.jsx(le,{stageName:"SiteMeasurementModel",projectId:t,organizationId:s,currentAssignedStaff:(i==null?void 0:i.assignedTo)||null,className:"w-full sm:w-auto"})]})]}),h&&e.jsxs("div",{className:"max-w-xl mx-auto mt-4 p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2",children:"⚠️ Error Occurred"}),e.jsx("p",{className:"text-red-500 text-sm mb-4",children:((L=($=h==null?void 0:h.response)==null?void 0:$.data)==null?void 0:L.message)||"Failed to load data"}),e.jsx(C,{onClick:()=>d(),className:"bg-red-600 text-white px-4 py-2",children:"Retry"})]}),!h&&e.jsxs(W,{className:"p-4 mb-4 shadow border-l-4 border-blue-600 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-3 text-blue-700 text-sm font-medium mb-2",children:[e.jsx("i",{className:"fa-solid fa-clock text-blue-500 text-lg"}),e.jsx("span",{children:"Stage Timings"})]}),e.jsx(ie,{completedAt:(T=i==null?void 0:i.timer)==null?void 0:T.compltedAt,stageName:"sitemeasurement",formId:i==null?void 0:i._id,projectId:t,deadLine:(U=i==null?void 0:i.timer)==null?void 0:U.deadLine,startedAt:(B=i==null?void 0:i.timer)==null?void 0:B.startedAt,refetchStageMutate:d,deadLineMutate:H,isPending:G})]}),!h&&e.jsx("div",{className:"mb-6",children:e.jsx(W,{className:"p-4 shadow border-l-4 border-blue-500 bg-white",children:e.jsx(de,{autoUpload:!0,formId:i==null?void 0:i._id,refetch:d,existingUploads:i==null?void 0:i.uploads,onUploadComplete:d,uploadFilesMutate:Y,uploadPending:V,projectId:t,onDeleteUpload:J,deleteFilePending:X})})}),!h&&e.jsxs(e.Fragment,{children:[!Object.values((i==null?void 0:i.siteDetails)||{}).some(m=>m!==null)&&!n?e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})})}),e.jsx("p",{className:"text-gray-600 mb-4",children:"No Site Details Added"}),e.jsx("button",{onClick:()=>o(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"Add Site Details"})]}):e.jsx(_e,{measurementData:i,handleDeleteSiteMeasurement:te,setShowSiteForm:o,setShowRoomForm:c,handleEditRoom:ae,handleDeleteRoom:ee,deleteRoomLoading:I.isPending}),n&&e.jsx(He,{siteDetails:v,setSiteDetails:q,handleSiteSubmit:Z,setShowSiteForm:o,updatePending:M.isPending}),w&&e.jsx(Ke,{handleRoomSubmit:D,setShowRoomForm:c,roomDetails:j,setRoomDetails:A,updateRoomLoading:R.isPending,createRoomLoading:E.isPending,editingRoomId:k})]})]})}export{it as default};
