import{b as O,a as U,r as p,j as e,B as o,t as n}from"./index-B7U0voEN.js";import{u as $,c as T,d as V,e as q}from"./installationWorkApi-BSd2zCge.js";import{R as H}from"./RoomDetailLoading-8TGnCh9A.js";import{d as J}from"./dateFormator-BKpEn5i3.js";import"./useQuery-B4RrmMvA.js";import"./roleCheck-DCYFBDfO.js";import"./Skeleton-DbVjxyY1.js";function ae(){var y,k;const{roomkey:c,projectId:d,organizationId:C}=O(),I=U(),[j,x]=p.useState(null),{data:u,isLoading:E,refetch:v,error:f,isError:S}=$(d),{mutateAsync:A,isPending:F}=T(),{mutateAsync:P,isPending:L}=V(),{mutateAsync:R,isPending:_}=q(),[s,l]=p.useState({workName:"",descritpion:"",completedDate:"",file:void 0}),[g,m]=p.useState(!1),[h,N]=p.useState(null),b=(u==null?void 0:u[c])||[],W=async()=>{var a,r;try{if(!s.workName.trim())throw new Error("work Name field is mandatory");const t=new FormData;t.append("workName",s.workName),s.descritpion&&t.append("descritpion",s.descritpion),s.completedDate&&t.append("completedDate",s.completedDate),s.file&&t.append("file",s.file),await A({projectId:d,roomName:c,formData:t}),m(!1),n({description:"created successfully",title:"Success"})}catch(t){n({title:"Error",description:((r=(a=t==null?void 0:t.response)==null?void 0:a.data)==null?void 0:r.message)||t.message||"Failed to update completion status",variant:"destructive"})}},z=async()=>{var a,r;try{if(!h)return;if(!s.workName.trim())throw new Error("work Name field is mandatory");const t=new FormData;t.append("itemId",h),s.workName&&t.append("workName",s.workName),s.descritpion&&t.append("descritpion",s.descritpion),s.completedDate&&t.append("completedDate",s.completedDate),s.file&&t.append("file",s.file),await P({projectId:d,roomName:c,formData:t},{onSuccess:()=>{l({workName:"",descritpion:"",completedDate:"",file:void 0}),N(null)}}),n({description:"edited successfully",title:"Success"})}catch(t){n({title:"Error",description:((r=(a=t==null?void 0:t.response)==null?void 0:a.data)==null?void 0:r.message)||t.message||"Failed to update completion status",variant:"destructive"})}},B=async a=>{var r,t;try{await R({projectId:d,roomName:c,itemId:a}),n({description:"deleted successfully",title:"Success"}),v()}catch(i){n({title:"Error",description:((t=(r=i==null?void 0:i.response)==null?void 0:r.data)==null?void 0:t.message)||i.message||"Failed to update completion status",variant:"destructive"})}},w=()=>{l({workName:"",descritpion:"",completedDate:"",file:void 0}),m(!1),N(null)};return E?e.jsx(H,{}):(S&&((k=(y=f==null?void 0:f.response)==null?void 0:y.data)!=null&&k.message,o),e.jsxs("div",{className:"w-full h-full",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h1",{className:"text-xl font-bold mb-4",children:["Room: ",c]}),e.jsx(o,{variant:"primary",className:"",onClick:()=>I(`/${C}/projectdetails/${d}/installation`),children:"Go Back"})]}),b.length===0&&!g?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-5 mb-2  gap-2 font-semibold bg-blue-100  text-blue-900 p-2 rounded ",children:[e.jsx("div",{className:"text-center",children:"Work Name"}),e.jsx("div",{className:"text-center",children:"Description"}),e.jsx("div",{className:"text-center",children:"Completed Date"}),e.jsx("div",{className:"text-center",children:"Upload"}),e.jsx("div",{className:"text-center",children:"Actions"})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center p-12 shadow rounded-lg bg-white",children:[e.jsx("i",{className:"fas fa-tasks text-3xl text-blue-400 mb-2"}),e.jsx("p",{className:"text-blue-600 mb-4 text-sm",children:"No works added yet for this room."}),e.jsxs(o,{onClick:()=>m(!0),variant:"primary",className:"",children:[e.jsx("i",{className:"fas fa-plus mr-2"})," Add Work"]})]})]}):e.jsx("div",{className:"w-full overflow-x-auto h-[95%]  custom-scrollbar",children:e.jsxs("div",{className:"min-w-[1000px]",children:[e.jsxs("div",{className:"grid grid-cols-5 text-blue-900 gap-2 font-semibold bg-blue-100 p-2 rounded",children:[e.jsx("div",{className:"text-center",children:"Work Name"}),e.jsx("div",{className:"text-center",children:"Description"}),e.jsx("div",{className:"text-center",children:"Completed Date"}),e.jsx("div",{className:"text-center",children:"Upload"}),e.jsx("div",{className:"text-center",children:"Actions"})]}),e.jsxs("section",{className:"!max-h-[100%] overflow-y-auto",children:[b.map(a=>{var r,t;return h===a._id?e.jsxs("div",{className:"grid grid-cols-5 gap-2 px-4 py-3 border-b border-gray-200 items-center bg-white",children:[e.jsx("input",{className:"border-b p-1 focus:outline-none",value:s.workName,onChange:i=>l({...s,workName:i.target.value})}),e.jsx("input",{className:"border-b p-1 focus:outline-none",value:s.descritpion,onChange:i=>l({...s,descritpion:i.target.value})}),e.jsx("input",{type:"date",className:"border-b p-1 focus:outline-none",value:s.completedDate,onChange:i=>l({...s,completedDate:i.target.value})}),e.jsx("input",{className:"border-b p-2 text-xs max-w-[80%] ",type:"file",accept:"image/*",onChange:i=>{var D;const G=(D=i.target.files)==null?void 0:D[0];l({...s,file:G})}}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(o,{variant:"primary",isLoading:L,onClick:z,children:[e.jsx("i",{className:"fas fa-save mr-1"})," Save"]}),e.jsxs(o,{variant:"secondary",onClick:w,children:[e.jsx("i",{className:"fas fa-times mr-1"})," Cancel"]})]})]},a._id):e.jsxs("div",{className:"grid grid-cols-5 gap-2 px-4 py-3 border-b border-gray-200 items-center bg-white",children:[e.jsx("div",{className:"text-center",children:a.workName||"N/A"}),e.jsx("div",{className:"text-center",children:a.descritpion||"N/A"}),e.jsx("div",{className:"text-center",children:a.completedDate?J(a.completedDate.toLocaleString()):"N/A"}),e.jsx("div",{className:"text-center",children:((r=a.upload)==null?void 0:r.type)==="image"?e.jsx("img",{loading:"lazy",src:a.upload.url,alt:"preview",className:"w-10 mx-auto block h-10 object-cover border rounded shadow cursor-pointer",onClick:()=>{var i;return x((i=a.upload)==null?void 0:i.url)}}):((t=a.upload)==null?void 0:t.type)==="pdf"?e.jsx("a",{href:a.upload.url,target:"_blank",rel:"noreferrer",className:"text-blue-600 underline",children:"View PDF"}):"No image"}),e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsxs(o,{onClick:()=>{N(a._id),m(!1),l({workName:a.workName||"",descritpion:a.descritpion||"",completedDate:a.completedDate?new Date(a.completedDate).toISOString().split("T")[0]:"",file:void 0})},className:"bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded",children:[e.jsx("i",{className:"fas fa-edit mr-1"})," Edit"]}),e.jsxs(o,{isLoading:_,variant:"danger",onClick:()=>B(a._id),className:"bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded",children:[e.jsx("i",{className:"fas fa-trash mr-1"})," Delete"]})]})]},a._id)}),g&&e.jsxs("div",{className:"grid grid-cols-5 gap-4 px-4 py-3 border-b border-gray-200 items-center bg-white",children:[e.jsx("input",{className:"border-b p-1 focus:outline-none",placeholder:"Work Name",value:s.workName,onChange:a=>l({...s,workName:a.target.value})}),e.jsx("input",{className:"border-b p-1 focus:outline-none",placeholder:"Description",value:s.descritpion,onChange:a=>l({...s,descritpion:a.target.value})}),e.jsx("input",{type:"date",className:"border-b  p-1 focus:outline-none",value:s.completedDate,onChange:a=>l({...s,completedDate:a.target.value})}),e.jsx("div",{className:"flex flex-col items-center gap-1",children:e.jsx("input",{className:"border-b max-w-[80%]",type:"file",accept:"image/*",onChange:a=>{var t;const r=(t=a.target.files)==null?void 0:t[0];l({...s,file:r})}})}),e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsxs(o,{isLoading:F,variant:"primary",onClick:W,children:[e.jsx("i",{className:"fas fa-save mr-1"})," Save"]}),e.jsxs("button",{onClick:w,className:"bg-gray-400 text-white px-3 py-1 rounded",children:[e.jsx("i",{className:"fas fa-times mr-1"})," Cancel"]})]})]}),!g&&e.jsxs(o,{onClick:()=>m(!0),variant:"primary",className:"",children:[e.jsx("i",{className:"fas fa-plus mr-2"})," Add Work"]})]})]})}),j&&e.jsx("div",{onClick:()=>x(null),className:"fixed inset-0  bg-black/70 bg-opacity-60 z-50 flex items-center justify-center",children:e.jsxs("div",{onClick:a=>a.stopPropagation(),className:"relative bg-white rounded p-4 lg:p-8 max-w-[90vw] max-h-[80vh] shadow-lg",children:[e.jsx("i",{className:"fas fa-times absolute top-3 right-4 text-xl text-gray-700 hover:text-red-500 cursor-pointer",onClick:()=>x(null)}),e.jsx("img",{loading:"lazy",src:j,alt:"Full Preview",className:"max-h-[70vh] w-auto object-contain rounded"})]})})]}))}export{ae as default};
