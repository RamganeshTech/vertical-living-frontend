import{r as S,b as $,a as K,i as re,c as W,u as Y,F as z,G as H,H as Q,J as V,K as J,j as e,L as G,B,M as q,N as X,P as Z,Q as ee,S as se,T as te,t as R,R as le}from"./index-N5JcrWW5.js";import{M as ce,f as de,C as U}from"./constants-GxzOlS2B.js";import{u as ae}from"./stageSelectionApi-sjeaKBn1.js";function fe(c,d){S.useEffect(()=>{const x=t=>{t.ctrlKey&&t.key==="]"?(t.preventDefault(),d()):t.ctrlKey&&t.key==="["&&(t.preventDefault(),c())};window.addEventListener("keydown",x)},[d,c])}const ue=(c,d,x,t,g)=>{const L=t==null?void 0:t.some(f=>f.toLowerCase()==="projectdetails");let m={},r={},n={};if(L){let f=["DOCUMENTATION","WORKERS","INVITECLIENT","PREREQUIRETIES","REQUIREMENTFORM","SITEMEASUREMENT","SAMPLEDESIGN","TECHNICALCONSULTANT","SELECTSTAGE","PAYMENTCONFIRMATION","ORDERMATERIALS","MATERIALARRIVED","WORKSCHEDULE","INSTALLATION","QUALITYCHECK","CLEANINGSANITATION","PROJECTDELIVERY"];const u=f.indexOf("TECHNICALCONSULTANT")+1;c==="Manual Flow"?f.splice(u,0,"MATERIALSELECTION","COSTESTIMATION"):c==="Modular Units"&&f.splice(u,0,"MODULARUNIT"),c!=null&&(f=f.filter(s=>s!=="SELECTSTAGE"));for(const s of f)d[s]&&g[s]&&x[s]&&(m[s]=d[s],r[s]=g[s],n[s]=x[s])}else m=d,r=g,n=x;return{filteredLabels:m,filteredIcons:r,filteredPaths:n}},xe=({labels:c,icons:d,path:x})=>{const[t,g]=S.useState(!0),{projectId:L}=$(),m=K(),r=re(),n=r.pathname.split("/"),{organizationId:f}=$(),N=W(),{role:u}=Y(o=>o.authStore),[s,p]=S.useState(""),{data:T,isLoading:D}=ae(L),{mutateAsync:I,isPending:b}=z(),{mutateAsync:O,isPending:E}=H(),{mutateAsync:P,isPending:C}=Q(),{mutateAsync:A,isPending:h}=V(),{mutateAsync:y,isPending:v}=J(),M=()=>{g(!1)},i=()=>{g(!0)};S.useEffect(()=>{const l=r.pathname.split("/")[4];p(t?()=>ce[l]:()=>de[l])},[r.pathname,t]),fe(i,M);const a=!D&&T;let{filteredLabels:j,filteredIcons:ne,filteredPaths:w}=ue(a,c,x,n,d);const _=n[2]==="projectdetails",ie=n[1]==="login",oe=()=>{_&&m(`/organizations/${f}/projects`),ie&&m("/organizations")},F=async()=>{var o,l;try{u==="CTO"?await I():u==="client"?await O():u==="staff"?await P():u==="owner"?await A():u==="worker"&&await y(),N(q()),N(X()),N(Z()),N(ee()),N(se()),N(te()),R({title:"Success",description:"logout successfull"}),(!b||!E||!C||!h||!v)&&m("/")}catch(k){R({title:"Error",description:((l=(o=k==null?void 0:k.response)==null?void 0:o.data)==null?void 0:l.message)||"Failed to logout",variant:"destructive"})}};return e.jsx(e.Fragment,{children:t?e.jsxs("aside",{className:"relative flex flex-col bg-[#2f303a] w-[17%] min-h-screen max-h-screen text-[#9ca3af] select-none transition-all duration-300",children:[e.jsxs("div",{className:"flex flex-col flex-grow overflow-y-auto overflow-x-hidden custom-scrollbar p-2",children:[e.jsxs("div",{onClick:oe,className:`flex ${_?"cursor-pointer":""} justify-between items-center border-b-1 py-2`,children:[e.jsx("span",{className:"text-xl",children:U.COMPANY_NAME}),e.jsx("div",{className:"w-[30px] h-[30px]",children:e.jsx("img",{className:"w-full h-full",src:U.COMPANY_LOGO,alt:"LOGO"})})]}),e.jsxs("section",{className:"py-2 space-y-2",children:[" ",Object.entries(j).map(([o,l])=>w[o]&&e.jsx(G,{to:w[o],className:"outline-none",children:e.jsxs("div",{onClick:()=>p(l),className:`cursor-pointer flex justify-between max-w-[95%] py-4 px-4 ${s===l?"bg-[#3a3b45] rounded-xl text-white":"rounded-xl hover:bg-[#3a3b45]"} `,children:[e.jsx("span",{className:"text-lg",children:l}),e.jsx("span",{children:e.jsx("i",{className:"fa-solid fa-chevron-right"})})]})},l))]})]}),e.jsxs("div",{className:"flex flex-col p-2 border-t border-[#3a3b45]",children:[n[1]!=="login"&&e.jsxs(B,{isLoading:b||E||C||h||v,onClick:F,className:"flex items-center gap-2 px-4 py-3 rounded-lg !bg-[#3a3b45] !text-[#9ca3af] hover:!bg-[#464751] hover:!text-white transition",children:[e.jsx("i",{className:"fa-solid fa-right-from-bracket"}),e.jsx("span",{children:"Logout"})]}),e.jsx("button",{title:"Ctrl+] to close",onClick:M,className:"mt-2 flex items-center justify-center outline-none border border-blue-600 text-blue-500 hover:bg-[#3a3b45] rounded-lg w-full py-2",children:e.jsx("i",{className:"fa-solid fa-chevron-left"})})]})]}):e.jsxs("aside",{className:"flex flex-col relative justify-between bg-[#2f303a] w-[6%]  max-h-full  text-[#9ca3af] transition-all duration-300 ",children:[e.jsx("div",{className:"max-h-[95%] overflow-y-auto overflow-x-hidden custom-scrollbar",children:e.jsx("div",{className:"flex items-center flex-col justify-between w-full",children:Object.entries(ne).map(([o,l])=>w[o]?e.jsx(G,{to:w[o],className:`${w[o]?"":"cursor-not-allowed"}`,children:e.jsx("div",{onClick:()=>p(o),className:`cursor-pointer flex justify-between max-w-[95%] py-4 px-4 ${(s==null?void 0:s.toLowerCase())===o.toLowerCase()?"bg-[#3a3b45] rounded-xl text-white":"rounded-xl hover:bg-[#3a3b45]"} `,children:e.jsx("i",{className:`${l} ${(s==null?void 0:s.toLowerCase())===o.toLowerCase()?"text-[#4a86f7]":"text-[#9ca3af]"} `})})}):e.jsx("div",{className:"cursor-not-allowed flex justify-between max-w-[95%] py-4 px-4",children:e.jsx("i",{className:`${l}`})}))})}),e.jsxs("div",{className:"flex flex-col items-center p-2 border-t border-[#3a3b45]",children:[n[1]!=="login"&&e.jsx(B,{isLoading:b||E||C||h||v,title:"logout",onClick:F,className:"w-[40px] h-[40px] flex items-center justify-center !bg-[#3a3b45] !text-[#9ca3af] hover:!text-red-500 transition",children:e.jsx("i",{className:"fa-solid fa-right-from-bracket"})}),e.jsx("button",{title:"Ctrl+[ to open",onClick:i,className:"mt-2 cursor-pointer outline-none border-[#9ca3af] h-[40px] w-[40px] flex items-center justify-center border rounded-lg",children:e.jsx("i",{className:"fa-solid fa-chevron-right text-[#4a86f7]"})})]})]})})},he=S.memo(xe),je=({isOpen:c,onClose:d,labels:x,path:t})=>{const g=K(),{organizationId:L,projectId:m}=$(),r=W(),{role:n}=Y(i=>i.authStore),{data:f,isLoading:N}=ae(m),{mutateAsync:u,isPending:s}=z(),{mutateAsync:p,isPending:T}=H(),{mutateAsync:D,isPending:I}=Q(),{mutateAsync:b,isPending:O}=V(),{mutateAsync:E,isPending:P}=J(),C=async()=>{var i,a;try{n==="CTO"?await u():n==="client"?await p():n==="staff"?await D():n==="owner"?await b():n==="worker"&&await E(),r(q()),r(X()),r(Z()),r(ee()),r(se()),r(te()),R({title:"Success",description:"logout successfull"}),(!s||!T||!I||!O||!P)&&g("/")}catch(j){R({title:"Error",description:((a=(i=j==null?void 0:j.response)==null?void 0:i.data)==null?void 0:a.message)||"Failed to logout",variant:"destructive"})}};let A=Object.entries(x);const h=location.pathname.split("/"),y=h[2]==="projectdetails";if(h.includes("projectdetails")&&!N){const i=f;A=A.filter(([a])=>{if(i){if(i==="Modular Units")return a!=="MATERIALSELECTION"&&a!=="COSTESTIMATION"&&a!=="SELECTSTAGE";if(i==="Manual Flow")return a!=="MODULARUNIT"&&a!=="SELECTSTAGE"}else return a!=="MODULARUNIT"&&a!=="MATERIALSELECTION"&&a!=="COSTESTIMATION";return!0})}const M=()=>{y&&g(`/organizations/${L}/projects`)};return e.jsxs(e.Fragment,{children:[c&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40",onClick:d}),e.jsxs("aside",{className:`fixed top-0 left-0 z-50 h-screen bg-white w-[75%] flex flex-col transition-transform duration-300 ${c?"translate-x-0":"-translate-x-full"}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsxs("div",{onClick:M,className:`flex items-center gap-3 ${y?"cursor-pointer":""}`,children:[e.jsx("img",{src:U.COMPANY_LOGO,alt:"Logo",className:"w-10 h-10 rounded-full object-cover"}),e.jsx("span",{className:"text-lg font-semibold",children:U.COMPANY_NAME})]}),e.jsx("button",{onClick:d,className:"text-xl text-gray-700",children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsx("nav",{className:"flex flex-col flex-grow overflow-y-auto p-4",children:A.map(([i,a],j)=>e.jsxs(le.Fragment,{children:[t[i]?e.jsx(G,{to:t[i],onClick:d,className:"text-gray-800 hover:bg-gray-100 p-3 rounded block",children:a}):e.jsx("span",{className:"text-gray-400 p-3 rounded cursor-not-allowed block",children:a}),j<A.length-1&&e.jsx("hr",{className:"border-t border-gray-200 my-1"})]},i))}),e.jsx("div",{className:"border-t border-gray-200 p-4",children:h[1]!=="login"&&e.jsxs(B,{className:"w-full flex items-center justify-center gap-2",isLoading:s||T||I||O||P,onClick:C,children:[e.jsx("i",{className:"fas fa-sign-out-alt"})," Logout"]})})]})]})};export{je as M,he as S};
