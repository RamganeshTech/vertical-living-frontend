import{u as de,b as me,r as c,j as e}from"./index-D7MAv7ev.js";import{t as y}from"./toast-BSC5QTk1.js";import{d as oe,c as xe}from"./modularUnitNewApi-CdLJ634Y.js";import{C as x,c as h,a as u,b as f}from"./Card-BfzjSi8a.js";import{L as n}from"./Label-58KnhCEc.js";import{I as d}from"./Input-BxXWEoUK.js";import{B as j}from"./Button-DedhS7G-.js";import{T as Y}from"./TextArea-CqwYwMy4.js";import he from"./MaterialOverviewLoading-CTC_hAas.js";import"./useQuery-IYS47mTn.js";import"./useMutation-JyxZ92cu.js";import"./useInfiniteQuery-CVNeVFgw.js";import"./roleCheck-CpGScjhV.js";import"./Skeleton-CJFlVgVa.js";const Ae=()=>{var G,W,_,J,Q,X;const $=de(),{unitId:B}=me(),[m,V]=c.useState(!1),[g,I]=c.useState("product"),[S,v]=c.useState(0),{data:a,isLoading:Z}=oe(B),{mutateAsync:ee,isPending:F}=xe(),[r,o]=c.useState({productName:"",serialNo:"",category:"",description:"",dimention:{height:0,width:0,depth:0},totalAreaSqFt:"",materialsNeeded:"",fabricationCost:"",timeRequired:"",attributes:[]}),[q,A]=c.useState([]),[D,k]=c.useState([]),[R,E]=c.useState([]),[se,P]=c.useState(!1),[ae,M]=c.useState(!1),[te,T]=c.useState(!1),[U,z]=c.useState("");c.useEffect(()=>{var s,t,l,i,N,b;a&&o({productName:a.productName||"",serialNo:a.serialNo||"",category:a.category||"",description:a.description||"",dimention:{height:((s=a.dimention)==null?void 0:s.height)||0,width:((t=a.dimention)==null?void 0:t.width)||0,depth:((l=a.dimention)==null?void 0:l.depth)||0},totalAreaSqFt:((i=a.totalAreaSqFt)==null?void 0:i.toString())||"",materialsNeeded:a.materialsNeeded||"",fabricationCost:((N=a.fabricationCost)==null?void 0:N.toString())||"",timeRequired:((b=a.timeRequired)==null?void 0:b.toString())||"",attributes:a.attributes||[]})},[a]);const C=(s,t)=>{o(l=>({...l,[s]:t}))},L=(s,t)=>{const l=Math.max(0,Number(t)||0);o(i=>({...i,dimention:{...i.dimention,[s]:l}}))},p=s=>{(s.key==="-"||s.key==="e"||s.key==="E"||s.key==="+")&&s.preventDefault()},K=(s,t)=>{const l=t.replace(/-/g,"");o(i=>({...i,[s]:l}))},re=s=>{const t=Array.from(s.target.files||[]);A(t),P(!0)},ie=s=>{const t=Array.from(s.target.files||[]);k(t),M(!0)},le=s=>{const t=Array.from(s.target.files||[]);E(t),T(!0)},H=()=>{U.trim()&&(o(s=>({...s,attributes:[...s.attributes,U.trim()]})),z(""))},ce=s=>{o(t=>({...t,attributes:t.attributes.filter((l,i)=>i!==s)}))},O=()=>{var s,t,l,i,N,b;m&&(a&&o({productName:a.productName||"",serialNo:a.serialNo||"",category:a.category||"",description:a.description||"",dimention:{height:((s=a.dimention)==null?void 0:s.height)||0,width:((t=a.dimention)==null?void 0:t.width)||0,depth:((l=a.dimention)==null?void 0:l.depth)||0},totalAreaSqFt:((i=a.totalAreaSqFt)==null?void 0:i.toString())||"",materialsNeeded:a.materialsNeeded||"",fabricationCost:((N=a.fabricationCost)==null?void 0:N.toString())||"",timeRequired:((b=a.timeRequired)==null?void 0:b.toString())||"",attributes:a.attributes||[]}),A([]),k([]),E([]),P(!1),M(!1),T(!1)),V(!m)},ne=async()=>{var t,l;if(!r.productName.trim()){y({title:"Error",description:"Product name is required",variant:"destructive"});return}if(!r.category){y({title:"Error",description:"Category is required",variant:"destructive"});return}if(!r.fabricationCost||Number(r.fabricationCost)<=0){y({title:"Error",description:"Valid fabrication cost is required",variant:"destructive"});return}const s={...r,totalAreaSqFt:r.totalAreaSqFt||void 0,fabricationCost:r.fabricationCost||void 0,timeRequired:r.timeRequired||void 0};try{await ee({unitId:B,formValues:s,productImages:q,images2d:D,images3d:R,replaceProductImages:se,replace2dImages:ae,replace3dImages:te}),y({title:"Success",description:"Product updated successfully!"}),V(!1),A([]),k([]),E([]),P(!1),M(!1),T(!1)}catch(i){y({title:"Error",description:((l=(t=i==null?void 0:i.response)==null?void 0:t.data)==null?void 0:l.message)||"Failed to update product",variant:"destructive"})}},w=(()=>{if(!a)return[];switch(g){case"product":return a.productImages||[];case"2d":return a["2dImages"]||[];case"3d":return a["3dImages"]||[];default:return[]}})();return Z?e.jsx(he,{}):a?e.jsxs("div",{className:"max-h-full overflow-hidden bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b sticky top-0 z-10",children:e.jsxs("div",{className:"max-w-full mx-auto px-6 py-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(j,{variant:"ghost",size:"sm",onClick:()=>$(-1),className:"flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-arrow-left"}),"Back"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:a.productName||"Untitled Product"}),a.serialNo&&e.jsxs("p",{className:"text-sm text-gray-500",children:["Serial: ",a.serialNo]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[!m&&e.jsxs(j,{onClick:O,className:"flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-edit"}),"Edit"]}),m&&e.jsxs(e.Fragment,{children:[e.jsxs(j,{variant:"outline",onClick:O,disabled:F,children:[e.jsx("i",{className:"fas fa-times mr-2"}),"Cancel"]}),e.jsx(j,{onClick:ne,isLoading:F,className:"min-w-[120px]",children:F?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin mr-2"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-save mr-2"}),"Save"]})})]})]})]})}),e.jsx("div",{className:"max-w-full !max-h-full mx-auto p-3",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx(x,{children:e.jsxs(h,{className:"p-0",children:[e.jsx("div",{className:"aspect-video bg-gray-100 relative rounded-lg",children:w.length>0?e.jsx("img",{src:(G=w[S])==null?void 0:G.url,alt:`${g} image ${S+1}`,className:"w-full h-full object-contain rounded-lg"}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center text-gray-400",children:[e.jsx("i",{className:"fas fa-image text-6xl mb-4"}),e.jsxs("p",{children:["No ",g," images available"]})]})})}),e.jsxs("div",{className:"flex border-b",children:[e.jsxs("button",{onClick:()=>{I("product"),v(0)},className:`flex-1 py-3 px-4 text-sm font-medium transition-colors ${g==="product"?"bg-blue-50 text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:bg-gray-50"}`,children:[e.jsx("i",{className:"fas fa-images mr-2"}),"Product Images (",((W=a.productImages)==null?void 0:W.length)||0,")"]}),e.jsxs("button",{onClick:()=>{I("2d"),v(0)},className:`flex-1 py-3 px-4 text-sm font-medium transition-colors ${g==="2d"?"bg-cyan-50 text-cyan-600 border-b-2 border-cyan-600":"text-gray-600 hover:bg-gray-50"}`,children:[e.jsx("i",{className:"fas fa-draw-polygon mr-2"}),"2D Images (",((_=a["2dImages"])==null?void 0:_.length)||0,")"]}),e.jsxs("button",{onClick:()=>{I("3d"),v(0)},className:`flex-1 py-3 px-4 text-sm font-medium transition-colors ${g==="3d"?"bg-indigo-50 text-indigo-600 border-b-2 border-indigo-600":"text-gray-600 hover:bg-gray-50"}`,children:[e.jsx("i",{className:"fas fa-cube mr-2"}),"3D Images (",((J=a["3dImages"])==null?void 0:J.length)||0,")"]})]}),w.length>0&&e.jsx("div",{className:"p-4 border-t h-[200px] ",children:e.jsx("div",{className:"grid grid-cols-3 gap-2 h-full overflow-y-auto ",children:w.map((s,t)=>e.jsx("button",{onClick:()=>v(t),className:`aspect-square h-full w-full rounded-lg overflow-hidden border-2 transition-all ${S===t?"border-blue-500 ring-2 ring-blue-200":"border-gray-200 hover:border-gray-300"}`,children:e.jsx("img",{src:s.url,alt:`Thumbnail ${t+1}`,className:"w-full h-full object-cover"})},t))})})]})}),m&&e.jsxs(x,{children:[e.jsx(u,{children:e.jsxs(f,{className:"flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-cloud-upload-alt text-blue-600"}),"Upload New Images"]})}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"productImages",children:"Product Images"}),e.jsx(d,{id:"productImages",type:"file",accept:"image/*",multiple:!0,onChange:re,className:"cursor-pointer"}),q.length>0&&e.jsxs("p",{className:"text-sm text-green-600",children:[e.jsx("i",{className:"fas fa-check-circle mr-1"}),q.length," new image(s) selected"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"images2d",children:"2D Design Images"}),e.jsx(d,{id:"images2d",type:"file",accept:"image/*",multiple:!0,onChange:ie,className:"cursor-pointer"}),D.length>0&&e.jsxs("p",{className:"text-sm text-green-600",children:[e.jsx("i",{className:"fas fa-check-circle mr-1"}),D.length," new image(s) selected"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"images3d",children:"3D Render Images"}),e.jsx(d,{id:"images3d",type:"file",accept:"image/*",multiple:!0,onChange:le,className:"cursor-pointer"}),R.length>0&&e.jsxs("p",{className:"text-sm text-green-600",children:[e.jsx("i",{className:"fas fa-check-circle mr-1"}),R.length," new image(s) selected"]})]}),e.jsxs("p",{className:"text-xs text-orange-600",children:[e.jsx("i",{className:"fas fa-info-circle mr-1"}),"Note: Uploading new images will replace existing images of that type"]})]})]})]}),e.jsxs("div",{className:"overflow-y-auto !max-h-[57%]  col-span-2  space-y-6 custom-scrollbar ",children:[e.jsxs(x,{children:[e.jsx(u,{children:e.jsxs(f,{className:"flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-info-circle text-blue-600"}),"Basic Information"]})}),e.jsx(h,{className:"space-y-4",children:m?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(n,{htmlFor:"productName",children:["Product Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(d,{id:"productName",placeholder:"Enter product name",value:r.productName,onChange:s=>C("productName",s.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(n,{htmlFor:"category",children:["Category ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(d,{id:"Category",placeholder:"Enter Category",value:r.category,onChange:s=>C("category",s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"description",children:"Description"}),e.jsx(Y,{id:"description",placeholder:"Enter product description",value:r.description,onChange:s=>C("description",s.target.value),rows:4})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Product Name"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-box text-gray-400"}),e.jsx("span",{className:"font-medium capitalize",children:(a==null?void 0:a.productName)||"N/A"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Category"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-tag text-gray-400"}),e.jsx("span",{className:"font-medium capitalize",children:a.category||"N/A"})]})]}),a.description&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Description"}),e.jsx("p",{className:"text-gray-700",children:a.description})]})]})})]}),e.jsxs(x,{children:[e.jsx(u,{children:e.jsxs(f,{className:"flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-ruler-combined text-purple-600"}),"Dimensions"]})}),e.jsx(h,{className:"space-y-4",children:m?e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"height",className:"text-xs",children:"Height (mm)"}),e.jsx(d,{id:"height",type:"number",min:"0",placeholder:"H",value:r.dimention.height||"",onChange:s=>L("height",s.target.value),onKeyDown:p,className:"text-sm"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"width",className:"text-xs",children:"Width (mm)"}),e.jsx(d,{id:"width",type:"number",min:"0",placeholder:"W",value:r.dimention.width||"",onChange:s=>L("width",s.target.value),onKeyDown:p,className:"text-sm"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"depth",className:"text-xs",children:"Depth (mm)"}),e.jsx(d,{id:"depth",type:"number",min:"0",placeholder:"D",value:r.dimention.depth||"",onChange:s=>L("depth",s.target.value),onKeyDown:p,className:"text-sm"})]})]}):e.jsx("div",{className:" rounded-lg p-3",children:e.jsx("div",{className:"flex items-center gap-2 font-semibold text-gray-700",children:(a==null?void 0:a.dimention)&&((Q=Object.entries(a.dimention))==null?void 0:Q.map(([s,t],l)=>{var i;return e.jsxs(c.Fragment,{children:[e.jsxs("span",{className:"flex items-center gap-0.5",children:[e.jsxs("span",{className:"text-[16px] text-gray-500",children:[s[0].toUpperCase()+s.slice(1),":"]}),t||0,"mm"]}),l!==((i=Object.keys(a.dimention))==null?void 0:i.length)-1&&e.jsx("span",{className:"text-[12px] text-gray-500",children:","})]},l)}))})})})]}),e.jsxs(x,{children:[e.jsx(u,{children:e.jsxs(f,{className:"flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-indian-rupee-sign text-green-600"}),"Pricing & Details"]})}),e.jsx(h,{className:"space-y-4",children:m?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(n,{htmlFor:"fabricationCost",children:["Fabrication Cost (₹) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(d,{id:"fabricationCost",type:"number",min:"0",step:"0.01",placeholder:"Enter fabrication cost",value:r.fabricationCost,onChange:s=>K("fabricationCost",s.target.value),onKeyDown:p,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"timeRequired",children:"Time Required (days)"}),e.jsx(d,{id:"timeRequired",type:"number",min:"0",placeholder:"Enter time required",value:r.timeRequired,onChange:s=>K("timeRequired",s.target.value),onKeyDown:p})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"totalAreaSqFt",children:"Total Area (sq ft)"}),e.jsx(d,{id:"totalAreaSqFt",type:"number",min:"0",step:"0.01",placeholder:"Enter total area",value:r.totalAreaSqFt,onChange:s=>K("totalAreaSqFt",s.target.value),onKeyDown:p})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"materialsNeeded",children:"Materials Needed"}),e.jsx(Y,{id:"materialsNeeded",placeholder:"Enter materials needed",value:r.materialsNeeded,onChange:s=>C("materialsNeeded",s.target.value),rows:3})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between py-2 border-b",children:[e.jsxs("span",{className:"text-gray-600 flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-hammer"}),"Fabrication Cost"]}),e.jsxs("span",{className:"text-2xl font-bold text-green-600",children:["₹",((X=a.fabricationCost)==null?void 0:X.toLocaleString())||0]})]}),a.timeRequired&&e.jsxs("div",{className:"flex items-center justify-between py-2 border-b",children:[e.jsxs("span",{className:"text-gray-600 flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-clock"}),"Time Required"]}),e.jsxs("span",{className:"font-semibold",children:[a.timeRequired," days"]})]}),a.totalAreaSqFt&&e.jsxs("div",{className:"flex items-center justify-between py-2 border-b",children:[e.jsxs("span",{className:"text-gray-600 flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-expand"}),"Total Area"]}),e.jsxs("span",{className:"font-semibold",children:[a.totalAreaSqFt," sq ft"]})]}),a.materialsNeeded&&e.jsxs("div",{className:"py-2",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Materials Needed"}),e.jsx("p",{className:"text-gray-700",children:a.materialsNeeded})]})]})})]}),e.jsxs(x,{children:[e.jsx(u,{children:e.jsxs(f,{className:"flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-tags text-orange-600"}),"Attributes"]})}),e.jsx(h,{className:"space-y-4",children:m?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{placeholder:"Add attribute (e.g., modern, wooden)",value:U,onChange:s=>z(s.target.value),onKeyPress:s=>{s.key==="Enter"&&(s.preventDefault(),H())},className:"text-sm"}),e.jsx(j,{type:"button",onClick:H,variant:"outline",size:"sm",className:"px-3",children:e.jsx("i",{className:"fas fa-plus"})})]}),r.attributes.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1.5",children:r.attributes.map((s,t)=>e.jsxs("span",{className:"px-2 py-1 bg-blue-50 text-blue-700 rounded-full text-xs flex items-center gap-1.5",children:[s,e.jsx("button",{type:"button",onClick:()=>ce(t),className:"hover:text-red-600 transition-colors",children:e.jsx("i",{className:"fas fa-times text-[10px]"})})]},t))})]}):e.jsx(e.Fragment,{children:a.attributes&&a.attributes.length>0?e.jsx("div",{className:"flex flex-wrap gap-1.5",children:a.attributes.map((s,t)=>e.jsxs("span",{className:"px-2 py-1 bg-blue-50 text-blue-700 rounded-full text-xs flex items-center gap-1",children:[e.jsx("i",{className:"fas fa-star text-[10px]"}),s]},t))}):e.jsx("p",{className:"text-gray-500 text-sm",children:"No attributes added"})})})]}),e.jsxs(x,{children:[e.jsx(u,{children:e.jsxs(f,{className:"flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-calendar text-gray-600"}),"Metadata"]})}),e.jsxs(h,{className:"space-y-3",children:[a.createdAt&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-600 flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-calendar-plus"}),"Created At"]}),e.jsx("span",{className:"font-medium",children:new Date(a.createdAt).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"})})]}),a.updatedAt&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-600 flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-calendar-check"}),"Updated At"]}),e.jsx("span",{className:"font-medium",children:new Date(a.updatedAt).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"})})]})]})]})]})]})})]}):e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"fas fa-exclamation-triangle text-4xl text-red-500 mb-4"}),e.jsx("p",{className:"text-red-500",children:"Product not found"}),e.jsx(j,{onClick:()=>$(-1),className:"mt-4",children:"Go Back"})]})})};export{Ae as default};
