import{j as e,h,I as i,B as l,b as D,a as G,r as u,t as g}from"./index-JxDlpqED.js";import M from"./MaterialOverviewLoading-BSabl9op.js";import{g as H,h as J,i as K,j as Q}from"./costEstimationApi-B7Q2cXmw.js";import"./Skeleton-DUWdTQlJ.js";const U=({handleAdd:o,newData:n,setNewData:x,addPending:v,setShowForm:f})=>e.jsxs("div",{className:"space-y-3 bg-white px-6 py-3 sm:w-[40%] w-[80%] rounded-2xl",children:[e.jsx("h2",{className:"font-medium text-gray-700 text-center",children:"Add Labour"}),e.jsxs("div",{children:[e.jsx(h,{children:"Work Type"}),e.jsx(i,{required:!0,placeholder:"Work Type",value:n.workType,onChange:s=>x({...n,workType:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(h,{children:"No.Of People"}),e.jsx(i,{placeholder:"No of people",value:n.noOfPeople,onChange:s=>x({...n,noOfPeople:+s.target.value})})]}),e.jsxs("div",{children:[e.jsx(h,{children:"No of Days"}),e.jsx(i,{placeholder:"Days",type:"number",value:n.daysPlanned,onChange:s=>x({...n,daysPlanned:+s.target.value})})]}),e.jsxs("div",{children:[e.jsx(h,{children:"Per Day Salary"}),e.jsx(i,{placeholder:"Per Day Salary",type:"number",value:n.perdaySalary,onChange:s=>x({...n,perdaySalary:+s.target.value})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{children:"Weekly Cost:"}),e.jsxs("p",{className:"font-medium text-center  text-gray-700 leading-10 ",children:["₹",n.perdaySalary*n.noOfPeople*7||0]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{children:"Total Cost:"}),":",e.jsxs("div",{className:"font-medium text-center  text-gray-700 leading-10",children:["₹",n.daysPlanned*n.perdaySalary*n.noOfPeople||0]})]}),e.jsxs("div",{className:"flex  items-center justify-center gap-2",children:[e.jsx(l,{onClick:o,isLoading:v,children:"Add"}),e.jsx(l,{variant:"outline",onClick:()=>f(!1),children:"Cancel"})]})]}),ee=()=>{var E,T;const{projectId:o,organizationId:n}=D(),x=G(),[v,f]=u.useState(null),[s,m]=u.useState({workType:"",noOfPeople:0,daysPlanned:0,perdaySalary:0}),[r,p]=u.useState({workType:"",noOfPeople:0,daysPlanned:0,perdaySalary:0}),[O,w]=u.useState(!1),[A,P]=u.useState(!1),{data:d,isLoading:b,isError:L,error:y,refetch:N}=H(o),{mutateAsync:F,isPending:I}=J(),{mutateAsync:W,isPending:_}=K(),{mutateAsync:$,isPending:S}=Q(),k=u.useMemo(()=>d==null?void 0:d.reduce((a,t)=>a+(t==null?void 0:t.totalCost),0),[d]);if(b)return e.jsx(M,{});if(L)return e.jsxs("div",{className:"max-w-xl mx-auto mt-12 p-6 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 text-xl font-semibold mb-2",children:"⚠️ Oops! An Error Occurred"}),e.jsx("p",{className:"text-red-500 text-sm mb-4",children:((T=(E=y==null?void 0:y.response)==null?void 0:E.data)==null?void 0:T.message)||(y==null?void 0:y.message)||"Failed to load , please try again"}),e.jsx(l,{isLoading:b,onClick:()=>N(),className:"inline-flex items-center px-4 py-2 bg-red-600 text-white text-sm font-medium rounded hover:bg-red-700 transition",children:"Retry"})]});const R=a=>{f(a._id),m({workType:a.workType,noOfPeople:a.noOfPeople,daysPlanned:a.daysPlanned,perdaySalary:a.perdaySalary})},q=()=>{f(null),m({workType:"",noOfPeople:0,daysPlanned:0,perdaySalary:0})},B=async a=>{var t,j;try{await F({projectId:o,labourId:a}),g({description:"Deleted successfully",title:"Success"}),N()}catch(c){g({title:"Error",description:((j=(t=c==null?void 0:c.response)==null?void 0:t.data)==null?void 0:j.message)||c.message||"Failed to update completion status",variant:"destructive"})}},z=async a=>{var t,j;try{if(!s.workType)throw new Error("workType is mandatory");await W({projectId:o,labourId:a,updates:s}),g({description:"edited successfully",title:"Success"}),q(),N()}catch(c){g({title:"Error",description:((j=(t=c==null?void 0:c.response)==null?void 0:t.data)==null?void 0:j.message)||c.message||"Failed to update completion status",variant:"destructive"})}},C=async()=>{try{if(!r.workType)throw new Error("Please Enter the workType");await $({projectId:o,labourData:r}),p({workType:"",noOfPeople:0,daysPlanned:0,perdaySalary:0}),w(!1),P(!1),g({title:"Success",description:"Labour estimation added"}),N()}catch(a){g({title:"Error",description:a.message,variant:"destructive"})}};return e.jsxs("main",{className:"h-full w-full",children:[e.jsxs("div",{className:"w-full flex justify-between ",children:[e.jsx("h2",{className:"text-xl font-bold text-blue-600 mb-5",children:"Labour Estimation"}),e.jsx(l,{variant:"primary",className:"h-10",onClick:()=>x(`/${n}/projectdetails/${o}/costestimation`),children:"Go Back"})]}),!(d!=null&&d.length)&&e.jsxs("div",{className:"w-full bg-white border border-gray-200 rounded-lg p-10 h-[60%] shadow-sm flex flex-col items-center justify-center text-center",children:[e.jsx("i",{className:"fa-solid fa-person-digging text-7xl text-gray-400 mb-6"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"No Labour Estimations"}),e.jsx("p",{className:"text-sm text-gray-500 mb-6",children:"Create your first labour estimation to start managing your workforce"}),e.jsxs(l,{onClick:()=>P(!0),className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 text-lg font-medium rounded",children:[e.jsx("i",{className:"fa-solid fa-plus mr-2"})," Create Labour Estimation"]})]}),e.jsx("section",{children:A&&e.jsx("div",{className:"fixed bg-black/70 flex justify-center items-center h-full w-full z-50 top-0 left-0",children:e.jsx(U,{handleAdd:C,newData:r,setNewData:p,addPending:S,setShowForm:P})})}),(d==null?void 0:d.length)>0&&e.jsxs("div",{className:"bg-white rounded  overflow-hidden",children:[e.jsx("section",{children:e.jsx("div",{className:"mb-4 p-4 bg-blue-50 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-blue-900",children:"Total Labour Cost:"}),e.jsxs("span",{className:"text-lg font-bold  text-blue-900",children:["₹",(k==null?void 0:k.toLocaleString())||e.jsx("span",{children:"0"})]})]})})}),e.jsx("div",{className:"w-full overflow-x-auto h-[95%]  custom-scrollbar",children:e.jsx("div",{className:"min-w-[1000px]",children:e.jsxs("section",{className:"shadow-lg !rounded-lg",children:[e.jsxs("div",{className:"grid grid-cols-7 bg-blue-50 px-6 py-3 font-semibold text-gray-700 text-sm",children:[e.jsx("div",{className:"text-left px-3 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Work Type"}),e.jsx("div",{className:"text-center px-3 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"No.Of People"}),e.jsx("div",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Days Planned"}),e.jsx("div",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Per Day Salary"}),e.jsx("div",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Weekly Salary"}),e.jsx("div",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Cost"}),e.jsx("div",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]}),e.jsxs("div",{className:"divide-y divide-gray-100 shadow-md  rounded-lg max-h-[65vh] overflow-y-auto bg-white",children:[d==null?void 0:d.map(a=>e.jsx("div",{className:`grid grid-cols-7 rounded-lg items-center gap-2 px-6 py-4 text-sm ${v===a._id?"":"hover:bg-[#f7fbff]"}`,children:v===a._id?e.jsxs(e.Fragment,{children:[e.jsx(i,{required:!0,value:s.workType,onChange:t=>m({...s,workType:t.target.value})}),e.jsx(i,{type:"number",value:s.noOfPeople,onChange:t=>m({...s,noOfPeople:+t.target.value})}),e.jsx(i,{type:"number",value:s.daysPlanned,onChange:t=>m({...s,daysPlanned:+t.target.value})}),e.jsx(i,{type:"number",value:s.perdaySalary,onChange:t=>m({...s,perdaySalary:+t.target.value})}),e.jsxs("div",{className:"text-gray-700",children:["₹",s.perdaySalary*7||0]}),e.jsxs("div",{className:"text-gray-700",children:["₹",s.daysPlanned*s.perdaySalary||0]}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(l,{onClick:()=>z(a._id),isLoading:_,children:e.jsx("i",{className:"fas fa-check"})}),e.jsx(l,{variant:"ghost",onClick:()=>f(null),children:"✖"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-medium text-left   text-gray-700",children:a.workType||"N/A"}),e.jsx("div",{className:"font-medium text-center text-gray-700",children:(a==null?void 0:a.noOfPeople)||"N/A"}),e.jsx("div",{className:"font-medium text-center text-gray-700",children:a.daysPlanned||"N/A"}),e.jsx("div",{className:"font-medium text-center text-gray-700",children:`₹${a.perdaySalary}`||"N/A"}),e.jsx("div",{className:"font-medium text-center text-gray-700",children:`₹${a.weeklySalary}`||"N/A"}),e.jsxs("div",{className:"text-gray-800 font-medium text-center",children:["₹",a.totalCost||0]}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsxs(l,{onClick:()=>R(a),children:[" ",e.jsx("i",{className:"fas fa-pen"})]}),e.jsxs(l,{variant:"danger",className:"bg-red-500 text-white",isLoading:I,onClick:()=>B(a._id),children:[" ",e.jsx("i",{className:"fas fa-trash-can"})," "]})]})]})},a._id)),O&&e.jsxs("div",{className:"grid grid-cols-7 gap-2  px-6 py-4 text-sm  !bg-none",children:[e.jsx(i,{required:!0,placeholder:"Work Type",value:r.workType,onChange:a=>p({...r,workType:a.target.value})}),e.jsx(i,{placeholder:"No of people",value:r.noOfPeople,onChange:a=>p({...r,noOfPeople:+a.target.value})}),e.jsx(i,{placeholder:"Days",type:"number",value:r.daysPlanned,onChange:a=>p({...r,daysPlanned:+a.target.value})}),e.jsx(i,{placeholder:"Per Day Salary",type:"number",value:r.perdaySalary,onChange:a=>p({...r,perdaySalary:+a.target.value})}),e.jsxs("p",{className:"font-medium text-center  text-gray-700 leading-10 ",children:["₹",r.perdaySalary*r.noOfPeople*7||0]}),e.jsxs("div",{className:"font-medium text-center  text-gray-700 leading-10",children:["₹",r.daysPlanned*r.perdaySalary*r.noOfPeople||0]}),e.jsxs("div",{className:"flex  items-center justify-center gap-2",children:[e.jsx(l,{onClick:C,isLoading:S,children:"Add"}),e.jsx(l,{variant:"outline",onClick:()=>w(!1),children:"Cancel"})]})]})]}),e.jsx("div",{className:"mt-2",children:e.jsx(l,{variant:"primary",onClick:()=>w(!0),children:"+ Add Labour Estimation"})})]})})})]})]})};export{ee as default};
