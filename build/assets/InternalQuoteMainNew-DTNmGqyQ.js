import{a as Q,u as E,r as p,j as e,O as F,B as v,M,t as f,b as O}from"./index-MXS_gbde.js";import{u as L,a as $}from"./internalQuoteNewVersionApi-BGW4vCTu.js";import{u as I}from"./projectApi-BH0dGL_K.js";import{f as z,e as B}from"./quoteVariantApi-DV1NXuB1.js";import{C as G,a as R}from"./Card-L4jLwmC3.js";import{d as T,f as U}from"./dateFormator-BGKi5rfZ.js";import{C as V}from"./CreateQuoteModal-CZVd6h3V.js";import"./SearchSelectNew-C8k-FWEO.js";import"./Label-BYfdMzSb.js";import"./Select-COWxTY-d.js";const re=()=>{const a=Q(),{organizationId:i}=E(),[r,n]=p.useState({projectId:"",projectName:"",createdAt:""}),[N,x]=p.useState(!1),[o,b]=p.useState(!1),[j,h]=p.useState(null),[s,g]=p.useState({mainQuoteName:"",quoteCategory:"commercial",quoteType:"basic",projectId:""}),{data:d}=I(i),l=d==null?void 0:d.map(t=>({_id:t._id,projectName:t.projectName})),{data:c,isLoading:k}=z(i,{createdAt:r.createdAt,projectId:r.projectId,quoteNo:""}),m=c==null?void 0:c.filter(t=>!t.furnitures.length),A=()=>{n({projectId:"",projectName:"",createdAt:""})},C=Object.values(r).filter(Boolean).length,P=L(),S=$(),{data:_=[]}=I(i),D=async()=>{if(!s.mainQuoteName||!s.projectId||!s.quoteCategory)return f({title:"Error",description:"Please fill all fields",variant:"destructive"});try{if(o&&j)await S.mutateAsync({organizationId:i,projectId:s.projectId,id:j,mainQuoteName:s.mainQuoteName,quoteCategory:s.quoteCategory}),f({title:"Success",description:"Quote updated successfully"});else{const t=await P.mutateAsync({organizationId:i,projectId:s.projectId,mainQuoteName:s.mainQuoteName,quoteCategory:s.quoteCategory});console.log("response",t),a(`create/${t._id}/${t.quoteCategory}`)}x(!1),w()}catch(t){f({title:"Error",description:t.message,variant:"destructive"})}},w=()=>{g({mainQuoteName:"",quoteCategory:"",projectId:"",quoteType:""}),b(!1),h(null)};return location.pathname.includes("create")||location.pathname.includes("single")?e.jsx(F,{}):e.jsxs("div",{className:"p-2 h-full w-full",children:[e.jsxs("header",{className:"flex mb-3 flex-col md:flex-row md:items-center md:justify-between gap-4 py-1 border-b-1 border-[#818283]",children:[e.jsx("div",{children:e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-file mr-3 text-blue-600"}),"Internal Quote Entry ",e.jsx("span",{className:"text-[20px] text-blue-600 ml-4",children:"(In Development)"})]})}),e.jsx("div",{className:"flex gap-6 items-center",children:e.jsxs(v,{className:"flex items-center",onClick:()=>{w(),x(!0)},children:[e.jsx("i",{className:"fas fa-add mr-1"})," Create"]})})]}),N&&e.jsx(V,{isEditing:o,formData:s,projectsData:_,setModalOpen:x,setFormData:g,handleSubmit:D}),e.jsxs("main",{className:"flex gap-2 !max-h-[80vh]",children:[e.jsx("div",{className:"xl:w-80 flex-shrink-0",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-filter mr-2 text-blue-600"}),"Filters"]}),C>0&&e.jsxs("button",{onClick:A,className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:["Clear All (",C,")"]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Created Date"}),e.jsx("input",{type:"date",onChange:t=>n(u=>({...u,createdAt:t.target.value})),value:r.createdAt,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Project"}),e.jsx("select",{value:(r==null?void 0:r.projectId)||"",onChange:t=>{const u=l==null?void 0:l.find(y=>y._id===t.target.value);u&&n(y=>({...y,projectId:u._id,projectName:u.projectName}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:l==null?void 0:l.map(t=>e.jsx("option",{value:t._id,children:t.projectName},t._id))})]})]})]})}),e.jsx("section",{className:"w-full max-h-full  gap-2  overflow-y-auto  min-h-full",children:k?e.jsx("p",{children:e.jsx(M,{})}):m!=null&&m.length?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:m==null?void 0:m.map(t=>e.jsx(e.Fragment,{children:e.jsx(Y,{quote:t,organizationId:i},t._id)}))}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center text-gray-700",children:[e.jsx("i",{className:"fas fa-file-circle-exclamation text-gray-300 text-7xl mb-4"}),e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"No Quotes Found"}),e.jsxs("p",{className:"text-base text-gray-500 leading-relaxed max-w-md",children:["You haven't generated any quote variants yet.",e.jsx("br",{}),"Please create a quote by clicking the + Product section to view brand-wise breakdowns here."]})]})})]})]})},Y=({quote:a,organizationId:i})=>{var h,s;const{mutateAsync:r,isPending:n}=B(),N=Q(),{role:x,permission:o}=O(),b=x==="owner"||((h=o==null?void 0:o.internalquote)==null?void 0:h.delete),j=async g=>{var d,l;try{await r({id:g,organizationId:i}),f({title:"Success",description:"Items deleted successfully"})}catch(c){f({title:"Error",description:((l=(d=c==null?void 0:c.response)==null?void 0:d.data)==null?void 0:l.message)??"Operation failed"})}};return e.jsx(G,{className:"w-full border-l-4 border-blue-600 shadow-md bg-white hover:shadow-lg transition-all",children:e.jsxs(R,{className:"p-5 space-y-4",children:[" ",e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-3",children:[" ",e.jsxs("div",{className:"space-y-1.5",children:[" ",e.jsx("h3",{className:"text-lg font-black text-slate-900 tracking-tight leading-tight uppercase",children:(a==null?void 0:a.mainQuote.mainQuoteName)||"Untitled Quote"}),e.jsxs("div",{className:"space-y-0.5",children:[" ",e.jsxs("h3",{className:"text-[12px] font-bold text-blue-700 leading-normal",children:["Project: ",e.jsx("span",{className:"text-black font-semibold",children:((s=a==null?void 0:a.projectId)==null?void 0:s.projectName)||"Project"})]}),e.jsxs("p",{className:"text-[12px] font-semibold text-gray-500 leading-normal",children:["Quote No: ",e.jsx("span",{className:"text-black",children:a.quoteNo||"N/A"})]})]})]}),e.jsx("div",{className:"pt-1",children:e.jsxs("p",{className:"text-[11px] text-gray-400 font-medium flex items-center gap-1",children:[e.jsx("i",{className:"far fa-clock text-[10px]"}),"Created on: ",T(a.createdAt)," â€” ",U(a.createdAt)]})})]}),e.jsx("div",{className:"pt-1",children:e.jsx("i",{className:"fas fa-file-alt text-gray-300 text-xl"})})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-3 border-t border-gray-50",children:[e.jsxs(v,{size:"sm",isLoading:n,variant:"secondary",className:"h-8 px-4 text-[11px] font-bold uppercase tracking-wider",onClick:()=>N(`single/${a._id}/${a==null?void 0:a.quoteCategory}`),children:[e.jsx("i",{className:"fas fa-eye mr-1.5"})," View"]}),b&&e.jsxs(v,{size:"sm",isLoading:n,variant:"danger",className:"h-8 px-4 text-[11px] font-bold uppercase tracking-wider bg-red-600 text-white",onClick:()=>j(a._id),children:[e.jsx("i",{className:"fas fa-trash mr-1.5"})," Delete"]})]})]})})};export{re as default};
