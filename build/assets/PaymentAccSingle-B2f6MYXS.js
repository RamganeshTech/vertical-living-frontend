import{u as te,a as ae,b as ne,r as re,j as e}from"./index-BZjlY-2Z.js";import{b as le,c as ce}from"./paymentAccApi-Dk-eI8uo.js";import{t as m}from"./toast-BSC5QTk1.js";import{B as o}from"./Button-BGBzZFjk.js";import{d as g}from"./dateFormator-BGKi5rfZ.js";import{C as ie,a as oe}from"./Card-CmzT6E3j.js";import{I as de}from"./InfoToolTip-0lhuhhlF.js";import"./useQuery-Coz1VCY2.js";import"./useMutation-BRRIqsxx.js";import"./useInfiniteQuery--LmPAkvr.js";import"./roleCheck-DuKNZHKs.js";const xe=r=>{switch(r==null?void 0:r.toLowerCase()){case"paid":return{bg:"bg-green-100",text:"text-green-700",icon:"fa-check-circle",badge:"bg-green-100 text-green-700"};case"processing":return{bg:"bg-blue-100",text:"text-blue-700",icon:"fa-spinner fa-spin",badge:"bg-blue-100 text-blue-700"};case"failed":return{bg:"bg-red-100",text:"text-red-700",icon:"fa-times-circle",badge:"bg-red-100 text-red-700"};default:return{bg:"bg-orange-100",text:"text-orange-700",icon:"fa-clock",badge:"bg-orange-100 text-orange-700"}}},we=()=>{var f,h,u,b,j,N,y,v,w,P,A,S,I,k,C,L,T,D,z,E,F,R,_,M,$,B,U;const{id:r}=te(),O=ae(),{data:s,isLoading:Q,isError:H,refetch:J}=le(r),{role:p,permission:l}=ne(),c=p==="owner"||((f=l==null?void 0:l.payments)==null?void 0:f.edit),i=p==="owner"||((h=l==null?void 0:l.payments)==null?void 0:h.create),{mutateAsync:K,isPending:V}=ce(),[W,X]=re.useState(new Set),Y=async()=>{var t,n;try{await K({id:r}),m({title:"Success",description:"Bill sent to Accounts Department"})}catch(a){m({variant:"destructive",title:"Error",description:((n=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:n.message)||(a==null?void 0:a.message)||"operation failed"})}},d=(t,n)=>{X(a=>new Set(a).add(t)),m({title:"Dummy Payment",description:"Payment integration coming soon",variant:"default"})},Z=((u=s==null?void 0:s.fromSection)==null?void 0:u.toLowerCase())==="expense";if(Q)return e.jsx("div",{className:"flex items-center justify-center h-[50vh]",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("i",{className:"fas fa-spinner fa-spin text-3xl text-blue-600"}),e.jsx("p",{className:"text-gray-500",children:"Loading payment details..."})]})});if(H||!s)return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[300px] bg-white rounded-xl p-6 border border-red-100",children:[e.jsx("i",{className:"fas fa-exclamation-triangle text-4xl text-red-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Could not load details"}),e.jsx(o,{onClick:()=>J(),variant:"secondary",children:"Retry"})]});const x=xe(s.generalStatus),ee=s.items&&s.items.length>0?s.items[0].itemName:"Expense Item";return e.jsxs("div",{className:"p-4 h-full overflow-y-auto custom-scrollbar space-y-6 bg-gray-50/50",children:[e.jsxs("div",{className:"flex justify-between items-center border-b border-gray-200 pb-4",children:[e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsx("div",{onClick:()=>O(-1),className:"bg-white hover:bg-gray-100 shadow-sm flex items-center justify-center w-9 h-9 border border-gray-200 text-gray-600 text-sm cursor-pointer rounded-lg transition-all",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-800 flex items-center gap-2",children:["Payment: ",e.jsx("span",{className:"text-blue-600",children:s.paymentNumber})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-0.5",children:["Created on ",g(s.createdAt)]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[(c||i)&&e.jsxs("div",{className:"flex items-center space-y-1",children:[e.jsx(o,{variant:"primary",isLoading:V,onClick:Y,children:"Send To Accounts Dept"}),e.jsx(de,{content:"Click to send the payment to accounts department",type:"info",position:"bottom"})]}),e.jsxs("div",{className:`px-4 py-1.5 rounded-full text-sm font-bold border ${x.bg} ${x.text} border-current/20 capitalize flex items-center gap-2`,children:[e.jsx("i",{className:`fas ${x.icon}`}),s.generalStatus]})]})]}),e.jsx(ie,{className:"shadow-sm border border-gray-200 bg-white",children:e.jsxs(oe,{className:"p-6 space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 p-3 bg-gray-50/80 rounded-xl border border-gray-200/60 min-h-[80px]",children:[e.jsxs("div",{className:"md:col-span-1 flex gap-3 items-start overflow-hidden",children:[e.jsx("div",{className:"flex-shrink-0",children:(j=(b=s.paymentPersonId)==null?void 0:b.mainImage)!=null&&j.url?e.jsx("img",{src:s.paymentPersonId.mainImage.url,alt:"Profile",className:"w-10 h-10 rounded-lg object-cover border border-gray-200 shadow-sm"}):e.jsx("div",{className:"w-10 h-10 rounded-lg bg-white border border-gray-200 flex items-center justify-center text-gray-400 shadow-sm",children:e.jsx("i",{className:"fas fa-user text-sm"})})}),e.jsxs("div",{className:"flex flex-col min-w-0 space-y-0.5",children:[e.jsx("p",{className:"font-bold text-gray-800 text-sm leading-tight truncate",title:s.paymentPersonName,children:s==null?void 0:s.paymentPersonName}),s.paymentPersonModel&&e.jsx("span",{className:"text-[10px] text-blue-600 font-semibold uppercase tracking-wide leading-none",children:e.jsx("p",{className:"text-xs text-gray-500 capitalize",children:(N=s.paymentPersonModel)==null?void 0:N.replace("Model","")})}),e.jsxs("div",{className:"flex items-center gap-1 text-[10px] text-gray-500 leading-none pt-0.5",children:[e.jsx("i",{className:"fas fa-phone-alt text-[8px]"}),e.jsx("span",{children:((v=(y=s==null?void 0:s.paymentPersonId)==null?void 0:y.phone)==null?void 0:v.mobile)||"No Ph"}),e.jsx("span",{children:(P=(w=s==null?void 0:s.paymentPersonId)==null?void 0:w.phone)==null?void 0:P.work})]}),e.jsxs("div",{className:"flex items-center gap-1 text-[10px] text-gray-400 leading-tight pt-0.5 truncate",children:[e.jsx("i",{className:"fas fa-map-marker-alt text-[8px]"}),e.jsx("span",{className:"truncate",children:(A=s==null?void 0:s.paymentPersonId)!=null&&A.address?(S=s==null?void 0:s.paymentPersonId)==null?void 0:S.address:"No Address"})]})]})]}),e.jsxs("div",{className:"md:col-span-1 flex flex-col justify-center space-y-1 pl-2 md:border-l border-gray-200 border-dashed",children:[s.fromSection&&e.jsx("span",{className:"inline-flex text-[10px] font-bold text-gray-500 uppercase tracking-wider bg-gray-200/50 px-1.5 rounded w-fit",children:s==null?void 0:s.fromSection}),s.fromSectionNumber&&e.jsxs("div",{className:"font-mono text-sm font-bold text-gray-800 leading-none",children:["#",s==null?void 0:s.fromSectionNumber]}),(s==null?void 0:s.paymentType)&&e.jsxs("div",{className:"text-[10px] text-gray-500 font-medium capitalize flex items-center gap-1 pt-0.5",children:[e.jsx("i",{className:"fas fa-credit-card text-[9px]"}),s==null?void 0:s.paymentType]}),((I=s==null?void 0:s.projectId)==null?void 0:I.projectName)&&e.jsxs("div",{className:"text-[10px] text-gray-900 font-medium capitalize flex items-center gap-1 pt-0.5",children:[e.jsx("i",{className:"fas fa-folder-open text-[9px]"}),e.jsx("span",{className:"text-gray-500",children:"project:"}),"  "," ",(k=s==null?void 0:s.projectId)==null?void 0:k.projectName]})]}),e.jsxs("div",{className:"md:col-span-1 flex flex-col justify-center space-y-1.5 pl-2 md:border-l border-gray-200 border-dashed",children:[e.jsxs("div",{className:"flex items-center justify-between md:justify-start md:gap-2 text-xs",children:[e.jsx("span",{className:"text-[10px] text-gray-500 uppercase tracking-wide w-18",children:"Payment Date"}),e.jsx("span",{className:"font-medium text-gray-700",children:g(s==null?void 0:s.paymentDate)})]}),s.dueDate&&e.jsxs("div",{className:"flex items-center justify-between md:justify-start md:gap-2 text-xs",children:[e.jsx("span",{className:"text-[10px] text-gray-500 uppercase tracking-wide w-18",children:"Due"}),e.jsx("span",{className:"font-medium text-red-600 bg-red-50 px-1 rounded",children:g(s==null?void 0:s.dueDate)})]})]}),e.jsxs("div",{className:"md:col-span-1 flex flex-col items-end justify-center pl-4 md:border-l border-gray-200",children:[e.jsx("p",{className:"text-[10px] text-gray-400 uppercase font-semibold tracking-wider mb-0.5",children:"Payable"}),e.jsxs("h2",{className:"text-2xl font-bold text-gray-900 leading-none",children:["₹",(C=s==null?void 0:s.grandTotal)==null?void 0:C.toLocaleString("en-IN")]}),s.taxAmount>0&&e.jsxs("p",{className:"text-[9px] text-gray-400 mt-1",children:["+ ₹",s==null?void 0:s.taxAmount," Tax"]})]})]}),Z?e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden flex flex-col md:flex-row min-h-[250px]",children:[e.jsxs("div",{className:"flex-1 p-6 md:p-8 flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6 border-b border-gray-100 pb-4",children:[e.jsx("div",{className:"bg-orange-50 text-orange-600 w-10 h-10 rounded-full flex items-center justify-center shadow-sm shrink-0",children:e.jsx("i",{className:"fas fa-shopping-basket text-lg"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-bold text-gray-700 leading-tight",children:ee}),e.jsx("p",{className:"text-xs text-gray-400",children:"Expense / Small Purchase"})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsxs("label",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider mb-3 flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-align-left"})," Description / Notes"]}),e.jsx("div",{className:"flex-1 bg-gray-50 rounded-xl p-5 border border-gray-100 relative group hover:border-blue-200 transition-colors",children:e.jsx("div",{className:"relative z-10",children:s.notes?e.jsx("p",{className:"text-gray-800 text-base md:text-lg leading-relaxed font-medium whitespace-pre-wrap",children:s.notes}):e.jsx("p",{className:"text-gray-400 italic",children:"No additional details provided for this expense."})})})]})]}),e.jsxs("div",{className:"w-full md:w-80 bg-gray-50/50 border-t md:border-t-0 md:border-l border-gray-200 p-6 flex flex-col justify-center items-center text-center relative",children:[e.jsx("div",{className:"hidden md:block absolute left-0 top-6 bottom-6 w-[1px] border-l border-dashed border-gray-300/50"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-xs text-gray-500 font-bold uppercase tracking-widest mb-2",children:"Total Payable"}),e.jsxs("h2",{className:"text-4xl font-bold text-blue-900 font-mono tracking-tight",children:["₹",(L=s==null?void 0:s.grandTotal)==null?void 0:L.toLocaleString("en-IN")]})]}),((T=s==null?void 0:s.generalStatus)==null?void 0:T.toLowerCase())!=="paid"?e.jsx(e.Fragment,{children:(i||c)&&e.jsxs("div",{className:"w-full space-y-3",children:[e.jsxs(o,{onClick:()=>d(s._id,s.grandTotal),className:"w-full bg-blue-600 hover:bg-blue-700 text-white shadow-lg hover:shadow-blue-200 hover:-translate-y-0.5 transition-all py-6 text-lg rounded-xl font-semibold group",children:["Pay Now ",e.jsx("i",{className:"fas fa-arrow-right ml-2 group-hover:translate-x-1 transition-transform"})]}),e.jsx("p",{className:"text-[10px] text-gray-400",children:"Clicking pay will process the full amount."})]})}):e.jsxs("div",{className:"w-full flex flex-col items-center gap-2 animate-in fade-in zoom-in duration-300",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 text-green-600 rounded-full flex items-center justify-center mb-1",children:e.jsx("i",{className:"fas fa-check text-3xl"})}),e.jsx("div",{className:"text-green-700 font-bold text-lg",children:"Paid Successfully"}),e.jsx("p",{className:"text-xs text-green-600/80",children:"No further action needed."})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"bg-blue-600 w-1 h-6 rounded-full"}),e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Payment Items"}),e.jsx("span",{className:"px-2 py-0.5 bg-gray-100 text-gray-600 rounded-full text-xs font-semibold",children:((D=s.items)==null?void 0:D.length)||0})]})}),e.jsxs("div",{className:"border border-gray-200 rounded-xl overflow-hidden shadow-sm",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 text-white",children:e.jsxs("div",{className:"grid grid-cols-11 gap-2 px-4 py-3 font-semibold text-xs uppercase tracking-wider items-center",children:[e.jsx("div",{className:"col-span-1 text-center",children:"S.No"}),e.jsx("div",{className:"col-span-2",children:"Item Name"}),e.jsx("div",{className:"col-span-1",children:"Unit"}),e.jsx("div",{className:"col-span-1 text-center",children:"Qty"}),e.jsx("div",{className:"col-span-1 text-center",children:"Rate"}),e.jsx("div",{className:"col-span-1 text-center",children:"Total"}),e.jsx("div",{className:"col-span-1 text-center",children:"Order ID"}),e.jsx("div",{className:"col-span-2 text-center",children:"Txn ID"}),e.jsx("div",{className:"col-span-1 text-center",children:"Pay"})]})}),e.jsx("div",{className:"bg-white divide-y divide-gray-100",children:!s.items||s.items.length===0?e.jsx("div",{className:"p-8 text-center text-gray-400",children:"No items found in this payment record."}):s.items.map((t,n)=>{var q,G;const a=W.has(t._id||n.toString()),se=t.status||"pending";return e.jsxs("div",{className:"grid grid-cols-11 gap-2 px-4 py-3 items-center text-sm hover:bg-blue-50/30 transition-colors",children:[e.jsx("div",{className:"col-span-1 text-center text-gray-500 font-medium",children:n+1}),e.jsx("div",{className:"col-span-2 font-medium text-gray-800 truncate",title:t.itemName,children:t.itemName}),e.jsx("div",{className:"col-span-1 text-gray-500 text-xs",children:t.unit||"-"}),e.jsx("div",{className:"col-span-1 text-center text-gray-700",children:t.quantity}),e.jsx("div",{className:"col-span-1 text-center text-gray-600 font-mono text-xs",children:(q=t.rate)==null?void 0:q.toLocaleString()}),e.jsxs("div",{className:"col-span-1 text-center text-gray-500 font-mono text-xs",children:["₹",(G=t.totalCost)==null?void 0:G.toLocaleString()]}),e.jsx("div",{className:"col-span-1 text-center",children:t.orderId?e.jsxs("span",{className:"bg-gray-100 text-gray-600 px-1.5 py-0.5 rounded text-[10px] font-mono truncate block",title:t.orderId,children:[t.orderId.slice(-6),".."]}):e.jsx("span",{className:"text-gray-900 text-lg ",children:"-"})}),e.jsx("div",{className:"col-span-2 text-center",children:t.transactionId?e.jsx("span",{className:"bg-green-50 text-green-700 border border-green-100 px-2 py-0.5 rounded text-[10px] font-mono truncate block",title:t.transactionId,children:t.transactionId}):e.jsx("span",{className:"text-gray-300 text-xs italic",children:"Pending"})}),(c||i)&&e.jsx("div",{className:"col-span-1 text-center",children:se==="paid"?e.jsxs("span",{className:"text-green-600 text-xs font-bold flex justify-center items-center gap-1",children:[e.jsx("i",{className:"fas fa-check-double"})," Paid"]}):e.jsx("button",{onClick:()=>d(t._id||n.toString(),t.totalCost),disabled:a,className:`cursor-pointer px-3 py-1.5 rounded-lg text-xs font-semibold transition-all shadow-sm flex items-center justify-center gap-1 w-full
                                                                ${a?"bg-gray-100 text-gray-400 cursor-wait":"bg-white border border-blue-600 text-blue-600 hover:bg-blue-600 hover:text-white"}
                                                            `,children:a?e.jsx("i",{className:"fas fa-spinner fa-spin"}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-rupee-sign"})," Pay"]})})})]},n)})}),e.jsx("div",{className:"bg-gray-50 border-t border-gray-200 px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsxs("span",{children:["Showing ",(z=s.items)==null?void 0:z.length," items"]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500"})," Paid"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-600"})," Unpaid"]})]})]})})]}),e.jsx("section",{className:"flex flex-col items-end justify-end mt-6 pt-2",children:e.jsxs("div",{className:"w-full md:w-1/2 lg:w-[40%] bg-gray-50/50 p-6 rounded-xl border border-gray-100 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Sub Total"}),e.jsxs("span",{className:"font-mono font-semibold text-gray-800",children:["₹",((E=s.totalAmount)==null?void 0:E.toLocaleString("en-IN"))||0]})]}),s.discountAmount>0||s.discountPercentage&&s.discountPercentage>0?e.jsxs("div",{className:"flex justify-between items-center text-sm text-green-700",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2",children:["Discount",s.discountPercentage?e.jsxs("span",{className:"text-[10px] bg-green-100 border border-green-200 px-1.5 py-0.5 rounded-md font-bold",children:[s.discountPercentage,"%"]}):null]}),e.jsxs("span",{className:"font-mono font-semibold",children:["- ₹",(F=s.discountAmount)==null?void 0:F.toLocaleString("en-IN")]})]}):null,s.taxAmount>0||s.taxPercentage&&s.taxPercentage>0?e.jsxs("div",{className:"flex justify-between items-center text-sm text-gray-600",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2",children:["Tax",s.taxPercentage?e.jsxs("span",{className:"text-[10px] bg-blue-50 border border-blue-100 text-blue-700 px-1.5 py-0.5 rounded-md font-bold",children:[s.taxPercentage,"%"]}):null]}),e.jsxs("span",{className:"font-mono font-semibold",children:["+ ₹",(R=s.taxAmount)==null?void 0:R.toLocaleString("en-IN")]})]}):null,s.advancedAmount&&s.advancedAmount>0&&e.jsxs("div",{className:"flex justify-between items-center text-sm text-blue-600",children:[e.jsx("span",{className:"font-medium",children:"Advanced Paid"}),e.jsxs("span",{className:"font-mono font-semibold",children:["- ₹",(_=s.advancedAmount)==null?void 0:_.toLocaleString("en-IN")]})]}),e.jsx("div",{className:"border-t border-dashed border-gray-300 my-3"}),((M=s==null?void 0:s.advancedAmount)==null?void 0:M.totalAmount)>0&&e.jsxs("div",{className:"flex items-center justify-between rounded-xl",children:[e.jsx("div",{className:"flex flex-col",children:e.jsx("span",{className:"text-lg font-bold text-gray-800",children:"Advance Amount"})}),e.jsxs("div",{className:"flex flex-col items-end gap-3",children:[e.jsxs("span",{className:"text-2xl font-bold text-purple-700 font-mono",children:["₹",s.advancedAmount.totalAmount.toLocaleString("en-IN")]}),(c||i)&&e.jsxs(o,{onClick:()=>d(s._id,s.advancedAmount.totalAmount),className:"bg-purple-600 hover:bg-purple-700 text-white shadow-md hover:shadow-lg transition-all w-32",size:"sm",children:["Pay Advance ",e.jsx("i",{className:"fas fa-arrow-right ml-2 text-xs"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-lg font-bold text-gray-800",children:($=s==null?void 0:s.advancedAmount)!=null&&$.totalAmount?"Remaining Amount To Pay":"Total Amount"}),e.jsx("span",{className:"text-xs text-gray-400 font-medium",children:"Total Payable"})]}),e.jsxs("div",{className:"flex flex-col items-end gap-3",children:[e.jsxs("span",{className:"text-2xl font-bold text-blue-700 font-mono",children:["₹",(B=s.amountRemaining.totalAmount)==null?void 0:B.toLocaleString("en-IN")]}),((U=s==null?void 0:s.generalStatus)==null?void 0:U.toLowerCase())!=="paid"?e.jsx(e.Fragment,{children:(i||c)&&e.jsx(o,{onClick:()=>{var t;return d(s._id,(t=s==null?void 0:s.amountRemaining)==null?void 0:t.totalAmount)},className:"bg-blue-600 hover:bg-blue-700 text-white shadow-md hover:shadow-lg transition-all w-32",size:"sm",children:e.jsxs(e.Fragment,{children:["Pay Now ",e.jsx("i",{className:"fas fa-arrow-right ml-2 text-xs"})]})})}):e.jsxs("div",{className:"flex items-center gap-1.5 bg-green-50 border border-green-200 text-green-700 px-3 py-1.5 rounded-lg text-sm font-bold",children:[e.jsx("i",{className:"fas fa-check-circle"})," Fully Paid"]})]})]})]})})]}),s.notes&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-100 rounded-lg p-4",children:[e.jsxs("h4",{className:"text-sm font-bold text-yellow-800 mb-1",children:[e.jsx("i",{className:"fas fa-sticky-note mr-2"}),"Notes"]}),e.jsx("p",{className:"text-sm text-yellow-800/80",children:s.notes})]})]})]})})]})};export{we as default};
