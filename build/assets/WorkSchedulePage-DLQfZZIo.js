import{b as O,a as q,r as h,j as e,B as o,t as u}from"./index-N5JcrWW5.js";import{d as H,e as J,f as K,g as M,h as Q,i as X}from"./workScheduleApi-ebKGL1YF.js";import{R as Y}from"./RoomDetailLoading-DOtpLQmX.js";import{S as Z,a as ee,b as te,c as se,d as ae}from"./Select-CEqf-iCJ.js";import"./roleCheck-B8-FOucE.js";import"./useQuery-sYFIGfif.js";import"./Skeleton-Buq8V7lI.js";const xe=()=>{var C,w,D,E,T;const{sectionId:W,projectId:d,organizationId:A}=O(),_=q();if(!d)return;const{data:a,isLoading:P,refetch:p,error:g}=H(d),{data:c}=J(d),{mutateAsync:F,isPending:L}=K(),N=M(),b=Q(),f=X(),[l,x]=h.useState(null),[v,j]=h.useState(null),[n,m]=h.useState(null),[y,U]=h.useState("pending"),[z,S]=h.useState(!1);if(P)return e.jsx(Y,{});g&&((w=(C=g==null?void 0:g.response)==null?void 0:C.data)!=null&&w.message,o);const k=()=>{x({workType:"",startDate:"",endDate:"",assignedTo:"",notes:""})},R=()=>S(!0),B=async()=>{var t,r;try{if(!d||!(a!=null&&a._id))throw new Error("Invalid project or schedule ID");await F({projectId:d,workScheduleId:a._id,payload:{status:y}}),u({title:"Success",description:"Work Schedule status updated successfully."}),S(!1),p()}catch(i){u({title:"Error",description:((r=(t=i==null?void 0:i.response)==null?void 0:t.data)==null?void 0:r.message)||i.message||"Failed to update status.",variant:"destructive"})}},G=async()=>{var t,r,i;try{if(!l)return;if(!((t=l.workType)!=null&&t.trim()))throw new Error("work field is mandatory");await N.mutateAsync({workScheduleId:W,formData:l,projectId:d}),x(null),u({title:"Success",description:"Item Saved"}),p()}catch(s){u({variant:"destructive",title:"Error",description:((i=(r=s==null?void 0:s.response)==null?void 0:r.data)==null?void 0:i.message)||(s==null?void 0:s.message)||"failed to add"})}},V=async()=>{var t,r,i;try{if(!n||!v)return;if(!((t=n.workType)!=null&&t.trim()))throw new Error("work field is mandatory");await b.mutateAsync({workScheduleId:a._id,planId:v,formData:n,projectId:d}),j(null),m(null),u({title:"Success",description:"Item Saved"}),p()}catch(s){u({variant:"destructive",title:"Error",description:((i=(r=s==null?void 0:s.response)==null?void 0:r.data)==null?void 0:i.message)||(s==null?void 0:s.message)||"Update failed"})}},$=async t=>{var r,i;try{await f.mutateAsync({workScheduleId:a._id,planId:t,projectId:d}),u({title:"Success",description:"Item deleted"}),p()}catch(s){u({variant:"destructive",title:"Error",description:((i=(r=s==null?void 0:s.response)==null?void 0:r.data)==null?void 0:i.message)||(s==null?void 0:s.message)||"Update failed"})}};return e.jsxs("div",{className:"w-full h-full overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between w-full items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-blue-800 mb-6 px-4",children:"ðŸ“‹ Work Plans"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"flex gap-2",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-gray-700 font-medium",children:"Status:"}),z?e.jsxs(e.Fragment,{children:[e.jsxs(Z,{value:y,onValueChange:t=>U(t),children:[e.jsx(ee,{children:e.jsx(te,{placeholder:"Select status",selectedValue:y})}),e.jsx(se,{children:["pending","completed"].map(t=>e.jsx(ae,{value:t,children:t},t))})]}),e.jsx(o,{size:"sm",variant:"primary",disabled:L,onClick:B,children:"Save"})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:`inline-block px-3 py-1 text-xs font-semibold rounded-full ${(a==null?void 0:a.status)==="completed"?"bg-green-200 text-green-700":"bg-yellow-100 text-yellow-800"}`,children:a==null?void 0:a.status}),e.jsx(o,{size:"sm",onClick:R,children:e.jsx("i",{className:"fas fa-pencil"})})]})]})}),e.jsx(o,{variant:"primary",className:"h-10",onClick:()=>_(`/${A}/projectdetails/${d}/workmainschedule`),children:"Go Back"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("div",{className:"min-w-[1024px]",children:[e.jsxs("div",{className:"grid grid-cols-7 gap-3 px-4 py-3 bg-blue-100 text-sm font-semibold text-blue-900 rounded-t-lg shadow-md",children:[e.jsx("div",{className:"text-center",children:"S.No"}),e.jsx("div",{className:"text-center",children:"Work Type"}),e.jsx("div",{className:"text-center",children:"Start Date"}),e.jsx("div",{className:"text-center",children:"End Date"}),e.jsx("div",{className:"text-center",children:"Assigned To"}),e.jsx("div",{className:"text-center",children:"Notes"}),e.jsx("div",{className:"text-center",children:"Actions"})]}),e.jsxs("div",{className:"flex flex-col divide-y",children:[((D=a==null?void 0:a.plans)==null?void 0:D.length)>0?a.plans.map((t,r)=>{var i;return e.jsxs("div",{className:"grid grid-cols-7 gap-3 px-4 py-3 border-b border-[#5557584a] items-center bg-white hover:bg-blue-50 transition",children:[e.jsx("div",{className:"font-medium text-gray-700 text-center",children:r+1}),v===t._id?e.jsxs(e.Fragment,{children:[e.jsx("input",{className:"border-b px-2 py-1 text-sm",value:n==null?void 0:n.workType,onChange:s=>m({...n,workType:s.target.value})}),e.jsx("input",{type:"date",className:"border-b px-2 py-1 text-sm",value:n==null?void 0:n.startDate,onChange:s=>m({...n,startDate:s.target.value})}),e.jsx("input",{type:"date",className:"border-b px-2 py-1 text-sm",value:n==null?void 0:n.endDate,onChange:s=>m({...n,endDate:s.target.value})}),e.jsxs("select",{className:"border-b px-2 py-1 text-sm",value:n==null?void 0:n.assignedTo,onChange:s=>m({...n,assignedTo:s.target.value}),children:[e.jsx("option",{value:"",children:"Select"}),c==null?void 0:c.map(s=>e.jsx("option",{value:s==null?void 0:s._id,children:s.workerName},s==null?void 0:s._id))]}),e.jsx("input",{className:"border-b px-2 py-1 text-sm",value:n==null?void 0:n.notes,onChange:s=>m({...n,notes:s.target.value})}),e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx(o,{variant:"primary",isLoading:b.isPending,onClick:V,children:"Save"}),e.jsx("button",{onClick:()=>{j(null),m(null)},className:"bg-gray-500 hover:bg-gray-600 text-white text-xs px-3 py-1 rounded",children:"Cancel"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-gray-700 text-center",children:t.workType||"N/A"}),e.jsx("div",{className:"text-gray-700 text-center",children:t.startDate||"N/A"}),e.jsx("div",{className:"text-gray-700 text-center",children:t.endDate||"N/A"}),e.jsx("div",{className:"text-gray-700 text-center",children:((i=c==null?void 0:c.find(s=>{var I;return s._id===((I=t.assignedTo)==null?void 0:I._id)}))==null?void 0:i.workerName)||"Not Assigned"}),e.jsx("div",{className:"text-gray-700 text-center",children:t.notes||"N/A"}),e.jsxs("div",{className:"flex justify-center gap-3 text-sm",children:[e.jsx("button",{onClick:()=>{j(t._id),m(t)},className:"text-blue-600 hover:text-blue-800",title:"Edit",children:e.jsx("i",{className:"fas fa-pen"})}),e.jsx(o,{isLoading:f.isPending,onClick:()=>$(t._id),title:"Delete",children:e.jsx("i",{className:"fas fa-trash"})})]})]})]},t._id)}):!l&&e.jsxs("div",{className:"mt-6 text-center border border-blue-100 p-8 rounded-lg bg-blue-50",children:[e.jsx("p",{className:"text-blue-600 text-sm",children:"No work plans created yet."}),e.jsxs("button",{onClick:k,className:"mt-3 px-5 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:[e.jsx("i",{className:"fas fa-plus mr-1"})," Add Work Plan"]})]}),l&&e.jsxs("div",{className:"grid grid-cols-7 gap-3 px-4 py-3 items-center bg-white",children:[e.jsx("div",{className:"text-center font-medium text-gray-700",children:(E=a==null?void 0:a.plans)!=null&&E.length?a.plans.length+1:1}),e.jsx("input",{className:"border-b px-2 py-1 text-sm",placeholder:"Work Type",value:l.workType,onChange:t=>x({...l,workType:t.target.value})}),e.jsx("input",{type:"date",className:"border-b px-2 py-1 text-sm",value:l.startDate,onChange:t=>x({...l,startDate:t.target.value})}),e.jsx("input",{type:"date",className:"border-b px-2 py-1 text-sm",value:l.endDate,onChange:t=>x({...l,endDate:t.target.value})}),e.jsxs("select",{className:"border-b px-2 py-1 text-sm",value:l.assignedTo,onChange:t=>x({...l,assignedTo:t.target.value}),children:[e.jsx("option",{value:"",children:"Select"}),c==null?void 0:c.map(t=>e.jsx("option",{value:t._id,children:t.workerName},t._id))]}),e.jsx("input",{className:"border-b px-2 py-1 text-sm",placeholder:"Notes",value:l.notes,onChange:t=>x({...l,notes:t.target.value})}),e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx(o,{variant:"primary",isLoading:N.isPending,onClick:G,children:"Save"}),e.jsx(o,{variant:"secondary",onClick:()=>x(null),children:"Cancel"})]})]})]}),!l&&((T=a==null?void 0:a.plans)==null?void 0:T.length)>0&&e.jsx("div",{className:"mt-5 text-left",children:e.jsxs(o,{size:"sm",variant:"primary",onClick:k,children:[e.jsx("i",{className:"fas fa-plus mr-1"}),"Add Work"]})})]})})]})};export{xe as default};
