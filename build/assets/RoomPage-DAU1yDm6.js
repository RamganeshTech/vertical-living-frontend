import{r as v,j as e,u as V,b as W}from"./index-4xXsHyrq.js";import{u as z,a as B,b as G,c as O,d as Q}from"./requirementFormApi-BUF7s3IG.js";import{B as y}from"./Button-BmD7QJLN.js";import{t as m}from"./toast-BSC5QTk1.js";import{I as q}from"./Input-Dg780vof.js";import{d as K}from"./downloadFile-D_4lnteF.js";import{I as L}from"./ImageGalleryMain-x5DcJ4XC.js";import{V as T}from"./VideoGalleryMain-D1OwA30Z.js";import"./useQuery-CnKlDwE3.js";import"./useMutation-DAR9sTyS.js";import"./roleCheck-DDX7kp9U.js";import"./constants-FaVgBbKC.js";import"./index-DwopESOh.js";const Y=({projectId:g,sectionName:f,refetch:j,existingUploads:i})=>{const[E,R]=v.useState(null),{mutateAsync:S,isPending:w}=z(),{mutateAsync:C,isPending:u}=B(),k=async n=>{var c,p;try{const o=n.target.files;if(!o||o.length===0)return;const _=new FormData;for(const I of Array.from(o))_.append("file",I);await S({projectId:g,sectionName:f,files:_}),j(),m({title:"Success",description:"file uploaded successfully"})}catch(o){m({title:"Error",description:((p=(c=o==null?void 0:o.response)==null?void 0:c.data)==null?void 0:p.message)||"Failed to upload",variant:"destructive"})}},b=async n=>{var c,p;try{await C({projectId:g,sectionName:f,fileId:n}),j(),m({title:"Success",description:"file deleted successfully"})}catch(o){m({title:"Error",description:((p=(c=o==null?void 0:o.response)==null?void 0:c.data)==null?void 0:p.message)||"Failed to delete",variant:"destructive"})}},x=i.filter(n=>n.type==="image"),d=i==null?void 0:i.filter(n=>n.type==="pdf"),h=i==null?void 0:i.filter(n=>n.type==="video");return e.jsxs("div",{className:"space-y-4 w-full",children:[e.jsxs("div",{className:"flex relative items-center justify-between w-full",children:[e.jsx(q,{type:"file",multiple:!0,placeholder:"select files",onChange:k,disabled:w,className:w?"pr-10 opacity-70 cursor-not-allowed w-full":""}),w&&e.jsx("div",{className:"absolute inset-y-0 right-2 flex items-center",children:e.jsx("div",{className:"animate-spin h-5 w-5 border-t-transparent rounded-full border-2 border-gray-500"})})]}),e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-800",children:"PDFs"}),d.length===0&&e.jsx("div",{className:"text-gray-500 text-sm italic bg-gray-50 p-8 rounded-lg text-center border-2 border-dashed border-gray-200",children:"No Pdfs uploaded yet."}),d==null?void 0:d.map(n=>e.jsx("div",{className:"mt-6",children:e.jsxs("div",{className:"relative space-y-4 group flex justify-between items-center px-4 py-3 border rounded-lg shadow-sm bg-white",children:[e.jsxs("div",{className:"flex items-center space-x-3 w-[190px] sm:w-3/2 lg:w-full",children:[e.jsx("div",{className:"w-10 h-10 bg-red-100 flex items-center justify-center rounded-lg text-red-600",children:e.jsx("i",{className:"fas fa-file-pdf text-xl"})}),e.jsx("span",{className:"text-sm font-medium !truncate max-w-[100%] whitespace-wrap",children:n.originalName})]}),e.jsx("div",{className:"flex ",children:["eye","trash","download"].map(c=>e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>c==="eye"?window.open(n.url,"_blank"):c==="trash"?b(n._id):K({src:n==null?void 0:n.url,alt:(n==null?void 0:n.originalName)||"file.pdf"}),disabled:c==="trash"&&u,className:"hover:bg-gray-100 shadow-sm",children:e.jsx("i",{className:` fas fa-${c} ${c==="trash"?"text-red-500":c==="download"?"text-blue-500":"text-gray-600"}`})},c))})]})},n.url)),e.jsxs("div",{className:"mt-6 w-full ",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-800",children:" Images "}),(x==null?void 0:x.length)===0?e.jsx("div",{className:"text-gray-500 text-sm italic bg-gray-50 p-8 rounded-lg text-center border-2 border-dashed border-gray-200",children:"No Images uploaded yet."}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"",children:e.jsx(L,{imageFiles:x,refetch:j,handleDeleteFile:b,height:190,minWidth:156,maxWidth:100})})})]}),e.jsxs("div",{className:"mt-6 w-full ",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-800",children:" Videos "}),(h==null?void 0:h.length)===0?e.jsx("div",{className:"text-gray-500 text-sm italic bg-gray-50 p-8 rounded-lg text-center border-2 border-dashed border-gray-200",children:"No Videos uploaded yet."}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"",children:e.jsx(T,{videoFiles:h,refetch:j,handleDeleteFile:b,isDeleting:u,height:190,minWidth:156,maxWidth:100})})})]}),E&&e.jsx("div",{onClick:()=>R(null),className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:e.jsx("div",{onClick:n=>n.stopPropagation(),className:"relative bg-black/70 rounded-lg shadow-lg max-w-[80%] max-h-[80%] p-2",children:e.jsx("img",{src:E,alt:"preview image",className:"w-[80vw] max-h-[70vh] object-cpntain mx-auto"})})})]})},re=()=>{var F,A;const{projectId:g,roomId:f}=V(),j=W(),{data:i,isLoading:E,refetch:R}=G({roomId:f,projectId:g}),{mutateAsync:S}=O(),{mutateAsync:w,isPending:C}=Q(),[u,k]=v.useState({}),[b,x]=v.useState(!1),[d,h]=v.useState([{itemName:"",quantity:1,unit:"unit"}]),n=["unit","sqft","cm","mm","length","nos"];v.useEffect(()=>{var s;if((s=i==null?void 0:i.items)!=null&&s.length){const a={};i.items.forEach(t=>{a[t._id]={id:t._id,itemName:t.itemName||"",quantity:t.quantity||0,unit:t.unit||"unit"}}),k(a)}},[i]);const c=(s,a,t)=>{h(l=>{const r=l.map((N,M)=>M===s?{...N,[a]:a==="quantity"?Number(t):t,unit:a==="unit"?String(t):(N==null?void 0:N.unit)||"unit"}:N),P=r[r.length-1];return P.itemName.trim()!==""&&!r.some(N=>N.itemName==="")&&r.push({itemName:"",quantity:1,unit:"unit"}),r.length>1&&P.itemName.trim()===""&&r[r.length-2].itemName.trim()===""&&r.pop(),console.log("updated",r),r})},p=(s,a,t)=>{k(l=>({...l,[s]:{...l[s],[a]:a==="quantity"?Number(t):t}}))},o=s=>{h(a=>a.filter((t,l)=>l!==s))};v.useEffect(()=>{d.length===0&&x(!1)},[d]);const _=async()=>{var a,t;console.log("newItems",d);const s=d.filter(l=>l.itemName.trim()!==""&&l.quantity>0&&l.unit!=="");if(console.log(s),s.length===0)return m({title:"Error",description:"every row should be filled with Item name, quanitty, and unit",variant:"destructive"});try{for(const l of s)await S({projectId:g,roomId:f,itemId:null,payload:{itemName:l.itemName,quantity:l.quantity,unit:l.unit}});m({title:"Success",description:"All items saved successfully"}),h([{itemName:"",quantity:1,unit:"unit"}]),x(!1)}catch(l){m({title:"Error",description:((t=(a=l==null?void 0:l.response)==null?void 0:a.data)==null?void 0:t.message)||"Failed to save items",variant:"destructive"})}},I=async s=>{var a,t;if(!s.itemName.trim()||s.quantity<=0||!s.unit)return m({title:"Error",description:"Please fill all fields correctly",variant:"destructive"});try{await S({projectId:g,roomId:f,itemId:s.id,payload:{itemName:s.itemName,quantity:s.quantity,unit:s.unit}}),m({title:"Success",description:"Item updated successfully"})}catch(l){m({title:"Error",description:((t=(a=l==null?void 0:l.response)==null?void 0:a.data)==null?void 0:t.message)||"Failed to update item",variant:"destructive"})}},D=async s=>{var a,t;try{await w({projectId:g,roomId:f,itemId:s}),m({title:"Success",description:"Item Deleted successfully"})}catch(l){m({title:"Error",description:((t=(a=l==null?void 0:l.response)==null?void 0:a.data)==null?void 0:t.message)||(l==null?void 0:l.message)||"Failed to update room data",variant:"destructive"})}};return E?e.jsx("div",{className:"min-h-full  bg-slate-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-600",children:"Loading room details..."})]})}):e.jsxs("div",{className:"max-h-full overflow-y-auto bg-slate-50",children:[e.jsx("div",{className:"bg-white border-b border-slate-200 sticky top-0 z-10",children:e.jsx("div",{className:"w-full px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between py-4",children:[e.jsx("div",{className:"flex items-center space-x-4",children:e.jsxs("button",{onClick:()=>j(-1),className:"flex cursor-pointer items-center space-x-2 text-slate-600 hover:text-blue-600 transition-colors duration-200 group",children:[e.jsx("div",{className:"bg-slate-100 group-hover:bg-blue-50 rounded-lg p-2 transition-colors duration-200",children:e.jsx("i",{className:"fas fa-arrow-left text-sm"})}),e.jsx("span",{className:"font-medium",children:"Back to Rooms"})]})}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-blue-50 rounded-lg p-2",children:e.jsx("i",{className:"fas fa-door-open text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-slate-800",children:(i==null?void 0:i.roomName)||"Room"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Manage items and requirements"})]})]})]})})}),e.jsxs("div",{className:"w-full px-4 sm:px-6 lg:px-8 py-8 space-y-8",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-200 p-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between mb-6 gap-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-blue-50 rounded-lg p-2",children:e.jsx("i",{className:"fas fa-list-ul text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-800",children:"Room Items"}),e.jsxs("p",{className:"text-sm text-slate-500",children:["Manage quantities and specifications ",e.jsx("span",{children:"(Click to Edit, Press Enter to save)"})]})]})]})}),e.jsx("div",{className:"space-y-4",children:((F=i==null?void 0:i.items)==null?void 0:F.length)===0&&!b?e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"bg-slate-100 rounded-full p-8 w-24 h-24 mx-auto mb-6 flex items-center justify-center",children:e.jsx("i",{className:"fas fa-inbox text-3xl text-slate-400"})}),e.jsx("h3",{className:"text-xl font-medium text-slate-600 mb-3",children:"No Items Yet"}),e.jsx("p",{className:"text-slate-500 mb-6 max-w-md mx-auto",children:"Start by adding your first item to this room. You can specify quantities and manage specifications."}),e.jsxs(y,{onClick:()=>x(!0),className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-xl flex items-center space-x-2 mx-auto",children:[e.jsx("i",{className:"fas fa-plus text-sm"}),e.jsx("span",{children:"Add First Item"})]})]}):e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("div",{className:"min-w-[600px] grid grid-cols-4 gap-3 px-3 py-2 bg-gray-100 text-sm font-semibold rounded-t-lg",children:[e.jsx("p",{className:"text-center",children:"Item Name"}),e.jsx("p",{className:"text-center",children:"Quantity"}),e.jsx("p",{className:"text-center",children:"Unit"}),e.jsx("p",{className:"text-center",children:"Action"})]}),e.jsx("div",{className:"space-y-2",children:(A=i==null?void 0:i.items)==null?void 0:A.map(s=>{var a,t,l;return e.jsxs("div",{className:"min-w-[600px] grid grid-cols-4 gap-3 items-center px-3 py-2 border-b bg-white ",children:[e.jsx(q,{placeholder:"Item name",value:((a=u[s._id])==null?void 0:a.itemName)??s.itemName??"",onChange:r=>p(s._id,"itemName",r.target.value),onKeyDown:r=>{r.key==="Enter"&&I(u[s._id]??s)},className:"!border-none focus:ring-0 text-center"}),e.jsx(q,{type:"number",placeholder:"Qty",value:((t=u[s._id])==null?void 0:t.quantity)??s.quantity??0,onChange:r=>p(s._id,"quantity",r.target.value),onKeyDown:r=>{r.key==="Enter"&&I(u[s._id]??s)},className:"!border-none focus:ring-0  text-center"}),e.jsxs("select",{value:((l=u[s._id])==null?void 0:l.unit)??s.unit??"",onChange:r=>{p(s._id,"unit",r.target.value),I(u[s._id]??s)},className:"border px-2 py-1 rounded",children:[e.jsx("option",{value:"",children:"Unit"}),n.map(r=>e.jsx("option",{value:r,children:r},r))]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(y,{onClick:()=>D(s._id),disabled:C,className:"bg-red-600 hover:bg-red-700 text-white px-3 py-1",children:C?"Deleting...":"Delete"})})]},s._id)})}),b?e.jsxs("div",{className:"space-y-2 mt-4",children:[d==null?void 0:d.map((s,a)=>e.jsxs("div",{className:"min-w-[600px] grid grid-cols-4 gap-3 items-center  border-b bg-white ",children:[e.jsx(q,{placeholder:"Item name",value:s.itemName,onChange:t=>c(a,"itemName",t.target.value),className:"!border-none focus:ring-0  text-center",autoFocus:a===0}),e.jsx(q,{type:"number",placeholder:"Qty",value:s.quantity,onChange:t=>c(a,"quantity",t.target.value),className:"!border-none focus:ring-0  text-center"}),e.jsx("select",{value:s.unit,onChange:t=>c(a,"unit",t.target.value),className:"border px-2 py-1 rounded",children:n.map(t=>e.jsx("option",{value:t,children:t},t))}),e.jsx("div",{className:"flex justify-center",children:e.jsx(y,{onClick:()=>o(a),className:"bg-red-500 hover:bg-red-600 text-white px-3 py-1 mx-auto",children:"Remove"})})]},a)),e.jsx("div",{className:"flex justify-end mt-3",children:e.jsx(y,{onClick:_,disabled:d.every(s=>Object.entries(s).every(([a,t])=>!(a==="itemName"&&!t))),className:"bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg",children:"Save All Items"})})]}):e.jsx("div",{className:"w-full  flex justify-end",children:e.jsx(y,{onClick:()=>{x(!0),h([{itemName:"",quantity:1,unit:"unit"}])},className:"mt-4 bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg  ",children:"+ Add Item"})})]})})})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-200 p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[e.jsx("div",{className:"bg-green-50 rounded-lg p-2",children:e.jsx("i",{className:"fas fa-cloud-upload-alt text-green-600 text-lg"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-800",children:"File Uploads"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Upload requirements and documents"})]})]}),e.jsx(Y,{projectId:g,sectionName:(i==null?void 0:i.roomName)||"",existingUploads:(i==null?void 0:i.uploads)||[],refetch:R})]})]})]})};export{re as default};
