import{r as x,R as Y,v as J,q as ge,a4 as k,j as e,b as T,u as _,f as he,z as Q,a5 as X,as as pe,at as je,C as S,a1 as M,B as G,au as Z,av as ee,aw as se,ax as te,ay as ae,az as ne,t as E}from"./index-CUvv9ev0.js";import{b as ie}from"./CTOApi-_3vSU2Pl.js";import{b as oe}from"./clientApi-B9ZJpSCb.js";import{b as re}from"./staffApi-DuMYQv-Z.js";import{b as le}from"./userApi-qEKbX3yc.js";import{b as ce}from"./workerApi-DT64gopP.js";import{u as be}from"./currentActiveStageApi-DQdoSrbz.js";import{c as we}from"./notificationApi-C_PMKJkS.js";import{f as Ne}from"./issueDiscussionApi-D5Fmy4CE.js";function ye(r,s){x.useEffect(()=>{const a=t=>{t.ctrlKey&&t.key==="]"?(t.preventDefault(),s()):t.ctrlKey&&t.key==="["&&(t.preventDefault(),r())};window.addEventListener("keydown",a)},[s,r])}const D=Y.memo(({size:r="small"})=>{const{data:s,isLoading:a}=we(),t=J(),n=x.useCallback(()=>{console.log("calling ðŸ“Š Unread count updated:",s),s!==void 0&&ge.invalidateQueries({queryKey:["notifications","unread-count"]})},[]);return x.useEffect(()=>{const i=t==null?void 0:t.id;if(i)return k.emit("join_notifications",{userId:i}),console.log(`ðŸ”Œ Joining notification room for user: ${i}`),k.on("unread_count_update",n),()=>{k.off("unread_count_update",n)}},[t==null?void 0:t.id,n]),!a&&typeof s=="number"&&s>0?r==="large"?e.jsx("span",{className:"absolute -top-2 -right-4 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:s>99?"99+":s}):e.jsx("span",{className:"absolute -top-2 -right-4 bg-red-500 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center",children:s>9?"9+":s}):null});D.displayName="NotificationBadge";const H=({isExpanded:r=!1,isActive:s=!1})=>{const a=T(),{organizationId:t}=_(),n=()=>{a(`/${t}/notification`)};return r?e.jsxs("div",{onClick:n,className:`cursor-pointer w-full flex justify-between items-center max-w-[95%] py-4 px-4 ${s?"bg-[#3a3b45] rounded-xl text-white":"rounded-xl hover:bg-[#3a3b45]"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("i",{className:`fa-solid fa-bell text-lg ${s?"text-[#4a86f7]":"text-[#9ca3af]"}`}),e.jsx(D,{size:"large"})]}),e.jsx("span",{className:"text-lg",children:"Notifications"})]}),e.jsx("span",{children:e.jsx("i",{className:"fa-solid fa-chevron-right"})})]}):e.jsx("div",{onClick:n,className:`cursor-pointer flex justify-center items-center py-4 px-4 ${s?"bg-[#3a3b45] rounded-xl text-white":"rounded-xl hover:bg-[#3a3b45]"}`,children:e.jsxs("div",{className:"relative",children:[e.jsx("i",{className:`fa-solid fa-bell ${s?"text-[#4a86f7]":"text-[#9ca3af]"}`}),e.jsx(D,{size:"small"})]})})},W=Y.memo(({size:r="small",organizationId:s})=>{const{data:a,isLoading:t}=Ne({organizationId:s}),n=J(),[c,i]=x.useState(0);return x.useEffect(()=>{typeof a=="number"&&i(a)},[a]),x.useEffect(()=>{if(!(n==null?void 0:n.id)||!k||!s)return;const g=m=>{console.log("ðŸ”” unread_ticket_count_update:",m.count),i(m.count)};return k.on("unread_ticket_count_update",g),()=>{k.off("unread_ticket_count_update",g)}},[]),!t&&typeof c=="number"&&c>0?r==="large"?e.jsx("span",{className:"absolute -top-2 -right-4 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:c>99?"99+":c}):e.jsx("span",{className:"absolute -top-2 -right-4 bg-red-500 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center",children:c>9?"9+":c}):null});W.displayName="TicketOperationBadge";const V=({isExpanded:r=!1,isActive:s=!1})=>{const a=T(),{organizationId:t}=_(),n=()=>{a(`/${t}/ticket`)};return r?e.jsxs("div",{onClick:n,className:`cursor-pointer flex w-full justify-between items-center max-w-[95%] py-4 px-4 ${s?"bg-[#3a3b45] rounded-xl text-white":"rounded-xl hover:bg-[#3a3b45]"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("i",{className:`fa-solid fa-ticket text-lg ${s?"text-[#4a86f7]":"text-[#9ca3af]"}`}),e.jsx(W,{organizationId:t,size:"large"})]}),e.jsx("span",{className:"text-lg",children:"Tickets"})]}),e.jsx("span",{children:e.jsx("i",{className:"fa-solid fa-chevron-right"})})]}):e.jsx("div",{onClick:n,className:`cursor-pointer flex justify-center items-center py-4 px-4 ${s?"bg-[#3a3b45] rounded-xl text-white":"rounded-xl hover:bg-[#3a3b45]"}`,children:e.jsxs("div",{className:"relative",children:[e.jsx("i",{className:`fa-solid fa-ticket ${s?"text-[#4a86f7]":"text-[#9ca3af]"}`}),e.jsx(W,{size:"small",organizationId:t})]})})},ve=({labels:r,icons:s,path:a,setProjectName:t,projectName:n})=>{const[c,i]=x.useState(!1),{projectId:p}=_(),v=T(),g=he(),m=g.pathname.split("/"),{organizationId:A}=_(),j=Q(),{role:f}=X(o=>o.authStore),[d,w]=x.useState(""),{data:b,isLoading:P}=be(p),{mutateAsync:B,isPending:C}=ie(),{mutateAsync:$,isPending:L}=oe(),{mutateAsync:I,isPending:u}=re(),{mutateAsync:N,isPending:h}=le(),{mutateAsync:de,isPending:z}=ce();x.useEffect(()=>{t&&b&&b.projectName&&!P&&t((b==null?void 0:b.projectName)||"Project")},[b,P]);const fe=()=>{i(!1)},ue=()=>{i(!0)},xe=m[2]==="projectdetails";x.useEffect(()=>{const l=g.pathname.split("/")[4];w(c?()=>pe[l]:()=>je[l])},[g.pathname,c]),ye(ue,fe);const U=m[2]==="projectdetails",me=m[1]==="login",K=()=>{U&&v(`/organizations/${A}/projects`),me&&v("/organizations")},R=f&&["owner","CTO","staff","worker"].includes(f),q=f&&["owner","CTO","staff"].includes(f)&&A,F=async()=>{var o,l;try{f==="CTO"?await B():f==="client"?await $():f==="staff"?await I():f==="owner"?await N():f==="worker"&&await de(),j(Z()),j(ee()),j(se()),j(te()),j(ae()),j(ne()),E({title:"Success",description:"logout successfull"}),(!C||!L||!u||!h||!z)&&v("/")}catch(y){E({title:"Error",description:((l=(o=y==null?void 0:y.response)==null?void 0:o.data)==null?void 0:l.message)||"Failed to logout",variant:"destructive"})}};return e.jsx(e.Fragment,{children:c?e.jsxs("aside",{onMouseLeave:()=>i(!1),className:"relative flex flex-col bg-[#2f303a] w-[17%] min-h-screen max-h-screen text-[#9ca3af] select-none transition-all duration-300",children:[e.jsxs("div",{onClick:K,className:`flex ${U?"cursor-pointer":""} justify-between items-center border-b border-[#3a3b45] px-2 py-2 bg-[#2f303a] z-10`,children:[e.jsx("span",{className:"text-xl font-bold truncate pr-2",children:xe?n||"Project":S.COMPANY_NAME}),e.jsx("div",{className:"w-[30px] h-[30px] flex-shrink-0",children:e.jsx("img",{className:"w-full h-full object-contain",src:S.COMPANY_LOGO,alt:"LOGO"})})]}),e.jsx("div",{className:"flex flex-col flex-grow overflow-y-auto overflow-x-hidden custom-scrollbar p-2 large-scrollbar",children:e.jsxs("section",{className:"py-0 space-y-2",children:[" ",Object.entries(r).map(([o,l])=>{const y=d===l;return a[o]&&e.jsx(M,{to:a[o],className:"outline-none",children:e.jsxs("div",{onClick:()=>w(l),className:`cursor-pointer flex justify-between max-w-[95%] py-4 px-4 ${d===l?"bg-[#3a3b45] rounded-xl text-white":"rounded-xl hover:bg-[#3a3b45]"} `,ref:O=>{y&&O&&O.scrollIntoView({behavior:"smooth",block:"center"})},children:[e.jsx("span",{className:"text-lg",children:l}),e.jsx("span",{children:e.jsx("i",{className:"fa-solid fa-chevron-right"})})]})},l)})]})}),e.jsxs("div",{className:"flex flex-col p-2 border-t border-[#3a3b45]",children:[m[1]!=="login"&&e.jsxs(G,{isLoading:C||L||u||h||z,onClick:F,className:"flex items-center gap-2 px-4 py-3 rounded-lg !bg-[#3a3b45] !text-[#9ca3af] hover:!bg-[#464751] hover:!text-white transition",children:[e.jsx("i",{className:"fa-solid fa-right-from-bracket"}),e.jsx("span",{children:"Logout"})]}),e.jsxs("div",{className:"mt-2 flex gap-2 w-full",children:[R&&e.jsx(H,{isExpanded:!1,isActive:!1}),q&&e.jsx(V,{isExpanded:!1,isActive:!1})]})]})]}):e.jsxs("aside",{onMouseEnter:()=>i(!0),className:"flex flex-col relative justify-between bg-[#2f303a] w-[6%]  max-h-full  text-[#9ca3af] transition-all duration-300 ",children:[e.jsx("div",{onClick:K,className:"flex justify-center items-center border-b border-[#3a3b45] pt-2 bg-[#2f303a] z-10 cursor-pointer",children:e.jsx("div",{className:"w-[30px] h-[30px]",children:e.jsx("img",{className:"w-full h-full object-contain",src:S.COMPANY_LOGO,alt:"LOGO"})})}),e.jsx("div",{className:"flex-grow overflow-y-auto overflow-x-hidden custom-scrollbar py-4",children:e.jsx("div",{className:"flex items-center flex-col justify-between w-full",children:Object.entries(s).map(([o,l])=>{const y=(d==null?void 0:d.toLowerCase())===o.toLowerCase();return a[o]?e.jsx(M,{to:a[o],className:`${a[o]?"":"cursor-not-allowed"}`,children:e.jsx("div",{onClick:()=>w(o),className:`cursor-pointer flex justify-between max-w-[95%] py-4 px-4 ${(d==null?void 0:d.toLowerCase())===o.toLowerCase()?"bg-[#3a3b45] rounded-xl text-white":"rounded-xl hover:bg-[#3a3b45]"} `,ref:O=>{y&&O&&O.scrollIntoView({behavior:"smooth",block:"center"})},children:e.jsx("i",{className:`${l} ${(d==null?void 0:d.toLowerCase())===o.toLowerCase()?"text-[#4a86f7]":"text-[#9ca3af]"} `})})},o):e.jsx("div",{className:"cursor-not-allowed flex justify-between max-w-[95%] py-4 px-4",children:e.jsx("i",{className:`${l}`})})})})}),e.jsxs("div",{className:"flex flex-col items-center p-2 border-t border-[#3a3b45]",children:[m[1]!=="login"&&e.jsx(G,{isLoading:C||L||u||h||z,title:"logout",onClick:F,className:"w-[40px] h-[40px] flex items-center justify-center !bg-[#3a3b45] !text-[#9ca3af] hover:!text-red-500 transition",children:e.jsx("i",{className:"fa-solid fa-right-from-bracket"})}),e.jsxs("div",{className:"",children:[R&&e.jsx(H,{isExpanded:!1,isActive:!1}),q&&e.jsx(V,{isExpanded:!1,isActive:!1})]})]})]})})},Ee=x.memo(ve),Te=({isOpen:r,onClose:s,labels:a,path:t})=>{const n=T(),{organizationId:c}=_(),i=Q(),{role:p}=X(u=>u.authStore),{mutateAsync:v,isPending:g}=ie(),{mutateAsync:m,isPending:A}=oe(),{mutateAsync:j,isPending:f}=re(),{mutateAsync:d,isPending:w}=le(),{mutateAsync:b,isPending:P}=ce(),B=async()=>{var u,N;try{p==="CTO"?await v():p==="client"?await m():p==="staff"?await j():p==="owner"?await d():p==="worker"&&await b(),i(Z()),i(ee()),i(se()),i(te()),i(ae()),i(ne()),E({title:"Success",description:"logout successfull"}),(!g||!A||!f||!w||!P)&&n("/")}catch(h){E({title:"Error",description:((N=(u=h==null?void 0:h.response)==null?void 0:u.data)==null?void 0:N.message)||"Failed to logout",variant:"destructive"})}};let C=Object.entries(a);const $=location.pathname.split("/"),L=$[2]==="projectdetails",I=()=>{L&&n(`/organizations/${c}/projects`)};return e.jsxs(e.Fragment,{children:[r&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40",onClick:s}),e.jsxs("aside",{className:`fixed top-0 left-0 z-50 h-screen bg-white w-[75%] flex flex-col transition-transform duration-300 ${r?"translate-x-0":"-translate-x-full"}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsxs("div",{onClick:I,className:`flex items-center gap-3 ${L?"cursor-pointer":""}`,children:[e.jsx("img",{src:S.COMPANY_LOGO,alt:"Logo",className:"w-10 h-10 rounded-full object-cover"}),e.jsx("span",{className:"text-lg font-semibold",children:S.COMPANY_NAME})]}),e.jsx("button",{onClick:s,className:"text-xl text-gray-700",children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsx("nav",{className:"flex flex-col flex-grow overflow-y-auto p-4",children:C.map(([u,N],h)=>e.jsxs(Y.Fragment,{children:[t[u]?e.jsx(M,{to:t[u],onClick:s,className:"text-gray-800 hover:bg-gray-100 p-3 rounded block",children:N}):e.jsx("span",{className:"text-gray-400 p-3 rounded cursor-not-allowed block",children:N}),h<C.length-1&&e.jsx("hr",{className:"border-t border-gray-200 my-1"})]},u))}),e.jsx("div",{className:"border-t border-gray-200 p-4",children:$[1]!=="login"&&e.jsxs(G,{className:"w-full flex items-center justify-center gap-2",isLoading:g||A||f||w||P,onClick:B,children:[e.jsx("i",{className:"fas fa-sign-out-alt"})," Logout"]})})]})]})};export{Te as M,Ee as S};
