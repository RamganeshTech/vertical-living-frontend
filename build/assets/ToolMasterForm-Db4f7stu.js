import{a as X,u as Z,r as p,k as Q,j as e,B as g,T as A,t as m}from"./index-BAM0eJUz.js";import{L as t}from"./Label-C8i6KaZe.js";import{I as M}from"./ImageGalleryMain-B3g6b13d.js";import{S as D}from"./SearchSelectNew-IGAHiELy.js";import{u as ee}from"./toolOtpApi-CWL7ydhf.js";import{g as se,h as re}from"./toolMasterApi-DZ9UD44t.js";const le=["carpentry","tiling","electrical","plumbing","falseCeiling","painting","finishing","measurement","handTools","powerTools","safety","cleaning","other"],ae=["new","good","repair"],ie=({mode:W,initialData:r,isSubmitting:f,onSubmit:L,onQuickUpload:b,onQuickUploadWarranty:j,isWarrantyUploading:y,isToolUploading:N})=>{var T,R,P,E;const v=X(),{organizationId:O}=Z(),[c,w]=p.useState(W),{role:V,permission:i}=Q(),_=V==="owner"||((T=i==null?void 0:i.toolhardware)==null?void 0:T.edit),B={toolName:"",toolCategory:"Drill",brand:"",modelNumber:"",toolRoomId:null,conditionStatus:"",purchaseDate:new Date().toISOString().split("T")[0],purchaseValue:0,remarks:"",warrantyDuration:"",serviceLocation:"",warrantyDetails:"",images:[],warrantyFiles:[]},{data:z=[]}=ee(O),G=se(),q=re(),[a,x]=p.useState(B);p.useEffect(()=>{var s;r&&x({toolName:r.toolName||"",toolCategory:r.toolCategory||"Drill",brand:r.brand||"",modelNumber:r.modelNumber||"",toolRoomId:((s=r==null?void 0:r.toolRoomId)==null?void 0:s._id)||null,conditionStatus:(r==null?void 0:r.conditionStatus)||"",purchaseDate:r!=null&&r.purchaseDate?new Date(r==null?void 0:r.purchaseDate).toISOString().split("T")[0]:"",purchaseValue:(r==null?void 0:r.purchaseValue)||0,remarks:(r==null?void 0:r.remarks)||"",warrantyDuration:r==null?void 0:r.warrantyDuration,serviceLocation:r==null?void 0:r.serviceLocation,warrantyDetails:r==null?void 0:r.warrantyDetails,images:[],warrantyFiles:[]})},[r,c]);const d=s=>{const{name:l,value:u}=s.target;x(h=>({...h,[l]:u}))},H=async s=>{if(s.target.files&&s.target.files.length>0&&b){const l=Array.from(s.target.files);await b(l)}},Y=async s=>{if(s.target.files&&s.target.files.length>0&&j){const l=Array.from(s.target.files);await j(l)}},$=async s=>{s.preventDefault();const{images:l,warrantyFiles:u,...h}=a;await L(h,l,u),c==="edit"&&w("view")},J=async s=>{try{await G.mutateAsync({toolId:r._id,fileId:s}),m({title:"Success",description:"Tool image removed successfully"})}catch(l){m({title:"Delete Failed",description:(l==null?void 0:l.message)||"Could not delete tool image",variant:"destructive"})}},C=async s=>{try{await q.mutateAsync({toolId:r._id,fileId:s}),m({title:"Success",description:"Warranty file removed successfully"})}catch(l){m({title:"Delete Failed",description:(l==null?void 0:l.message)||"Could not delete warranty file",variant:"destructive"})}},K=z.map(s=>({value:s._id,label:`${s.toolRoomName}`})),U=s=>{x(l=>({...l,toolRoomId:s}))},F=((R=r==null?void 0:r.warrantyFiles)==null?void 0:R.filter(s=>s.type==="image"))||[],S=((P=r==null?void 0:r.warrantyFiles)==null?void 0:P.filter(s=>s.type==="pdf"))||[],o=c==="view",n=c==="create",k=c==="edit",I=()=>w(s=>s==="view"?"edit":"view");return e.jsxs("div",{className:"max-w-full mx-auto space-y-0",children:[e.jsxs("header",{className:"sticky top-0 z-20 bg-white border-b border-gray-200 pb-2 mb-3 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:()=>v(-1),className:"bg-blue-50 hover:bg-blue-100 flex items-center justify-center w-9 h-9 border border-blue-200 text-blue-600 cursor-pointer rounded-lg",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:n?"Register Tool":k?"Update Tool":"Tool Details"}),e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wider font-semibold",children:(r==null?void 0:r.toolCode)||"New Asset"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[o&&_&&e.jsxs(g,{type:"button",onClick:I,variant:"outline",className:"border-blue-600 text-blue-600",children:[e.jsx("i",{className:"fas fa-edit mr-2"}),"Edit Details"]}),(n||k)&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(g,{type:"button",onClick:$,disabled:f,className:"bg-blue-600 text-white",children:[f?e.jsx("i",{className:"fas fa-spinner fa-spin mr-2"}):e.jsx("i",{className:"fas fa-save mr-2"}),n?"Save Tool":"Save Changes"]}),e.jsx(g,{variant:"outline",type:"button",onClick:()=>n?v(-1):I(),className:"bg-white",children:"Cancel"})]})]})]}),e.jsxs("form",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("section",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("h3",{className:"text-sm font-black text-blue-600 uppercase tracking-widest mb-4 flex items-center",children:[e.jsx("i",{className:"fas fa-info-circle mr-2"})," Identity & Brand"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{children:"Tool Name"}),e.jsx("input",{name:"toolName",value:a.toolName,onChange:d,disabled:o,className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none mt-1",placeholder:"e.g., Bosch Hammer Drill"})]}),e.jsxs("div",{children:[e.jsx(t,{children:"Category"}),e.jsx("select",{name:"toolCategory",value:a.toolCategory,onChange:d,disabled:o,className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 bg-white mt-1",children:le.map(s=>e.jsx("option",{value:s,children:s[0].toUpperCase()+s.slice(1)},s))})]}),e.jsxs("div",{children:[e.jsx(t,{children:"Brand"}),e.jsx("input",{name:"brand",value:a.brand,onChange:d,disabled:o,className:"w-full px-3 py-2 border rounded-lg mt-1"})]}),e.jsxs("div",{children:[e.jsx(t,{children:"Model Number"}),e.jsx("input",{name:"modelNumber",value:a.modelNumber,onChange:d,disabled:o,className:"w-full px-3 py-2 border rounded-lg mt-1",placeholder:"Required for issue"})]}),e.jsxs("div",{children:[e.jsx(t,{children:"Conditional Status"}),e.jsx("select",{name:"conditionStatus",value:a.conditionStatus,onChange:d,disabled:o,className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 bg-white mt-1",children:ae.map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Search Room"}),e.jsx(D,{options:K,placeholder:"Enter Tool Room Name...",value:a.toolRoomId||"",onValueChange:U,displayFormat:"detailed",className:"w-full"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("h3",{className:"text-sm font-black text-blue-600 uppercase tracking-widest mb-4 flex items-center",children:[e.jsx("i",{className:"fas fa-file-invoice-dollar mr-2"})," Procurement"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{children:"Purchase Date"}),e.jsx("input",{type:"date",name:"purchaseDate",value:a.purchaseDate,onChange:d,disabled:o,className:"w-full px-3 py-2 border rounded-lg mt-1"})]}),e.jsxs("div",{children:[e.jsx(t,{children:"Purchase Value (â‚¹)"}),e.jsx("input",{type:"number",name:"purchaseValue",value:a.purchaseValue||"",onChange:d,disabled:o,className:"w-full px-3 py-2 border rounded-lg mt-1"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("h3",{className:"text-sm font-black text-blue-600 uppercase tracking-widest mb-4 flex items-center",children:[e.jsx("i",{className:"fas fa-shield-alt mr-2"})," Warranty & Service"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{children:"Warranty Expires In"}),e.jsx("input",{name:"warrantyDuration",value:a.warrantyDuration,onChange:d,disabled:o,className:"w-full px-3 py-2 border rounded-lg mt-1"})]}),e.jsxs("div",{children:[e.jsx(t,{children:"Service Location / Center"}),e.jsx("input",{name:"serviceLocation",value:a.serviceLocation,onChange:d,disabled:o,className:"w-full px-3 py-2 border rounded-lg mt-1",placeholder:"e.g. Authorized Bosch Center"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(t,{children:"Warranty Policy Details"}),e.jsx(A,{name:"warrantyDetails",value:a.warrantyDetails,onChange:d,rows:4,disabled:o,className:"w-full px-3 py-2 border rounded-lg mt-1",placeholder:"e.g. 1 Year limited warranty on motor"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsx(t,{children:"Remarks & Maintenance Notes"}),e.jsx(A,{name:"remarks",value:a.remarks,onChange:d,disabled:o,className:"w-full mt-2",placeholder:"Describe current condition or missing accessories...",rows:4})]})]}),e.jsx("section",{className:"flex flex-col gap-3",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("section",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("header",{className:"flex items-center justify-between border-b pb-2 mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("h3",{className:"text-sm font-black text-gray-900 uppercase tracking-widest flex items-center",children:[e.jsx("i",{className:"fas fa-camera-retro mr-2 text-blue-500"})," Tool Photos"]})}),e.jsxs("label",{className:"cursor-pointer bg-blue-50 hover:bg-blue-100 text-blue-600 px-3 py-1 rounded-full text-[10px] font-bold transition-colors flex items-center gap-1",children:[N?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin text-blue-500 text-xs"})," Uploading"]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-plus"})," ADD"]}),e.jsx("input",{type:"file",multiple:!0,accept:"image/*",onChange:H,className:"hidden",disabled:N})]})]}),((E=r==null?void 0:r.toolImages)==null?void 0:E.length)>0?e.jsx("div",{className:"h-[300px] max-h-[300px] overflow-y-auto",children:e.jsx(M,{imageFiles:r.toolImages.map(s=>({...s,url:s.url})),height:120,minWidth:120,handleDeleteFile:J})}):e.jsxs("div",{className:"py-8 flex flex-col items-center justify-center bg-gray-50/50 rounded-xl border border-dashed border-gray-200",children:[e.jsx("i",{className:"fas fa-images text-gray-300 text-2xl mb-2"}),e.jsx("p",{className:"text-[11px] font-medium text-gray-400",children:"No photos available."})]})]}),e.jsxs("section",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("header",{className:"flex items-center justify-between border-b pb-2 mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("h3",{className:"text-sm font-black text-gray-900 uppercase tracking-widest flex items-center",children:[e.jsx("i",{className:"fas fa-shield-alt mr-2 text-red-500"})," Warranty Media"]})}),e.jsxs("label",{className:"cursor-pointer bg-red-50 hover:bg-red-100 text-red-600 px-3 py-1 rounded-full text-[10px] font-bold transition-colors flex items-center gap-1",children:[y?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin text-red-500 text-xs"})," Uploading"]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-plus"})," ADD"]}),e.jsx("input",{type:"file",multiple:!0,accept:"image/*,.pdf",onChange:Y,className:"hidden",disabled:y})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-[10px] font-bold text-gray-400 uppercase mb-2",children:"Photo Proofs"}),F.length>0?e.jsx("div",{className:"max-h-[300px] overflow-y-auto",children:e.jsx(M,{imageFiles:F.map(s=>({...s,url:s.url})),height:100,minWidth:100,handleDeleteFile:C})}):e.jsx("div",{className:"py-4 border border-dashed border-gray-100 rounded-lg flex items-center justify-center bg-gray-50/30",children:e.jsx("span",{className:"text-[10px] text-gray-400 italic",children:"No image proofs uploaded."})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-bold text-gray-400 uppercase mb-2",children:"Document Proofs (PDF)"}),S.length>0?e.jsx("div",{className:"space-y-2",children:S.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 border rounded-lg group",children:[e.jsxs("a",{href:s.url,target:"_blank",rel:"noreferrer",className:"flex items-center gap-2 flex-1 truncate",children:[e.jsx("i",{className:"fas fa-file-pdf text-red-500"}),e.jsx("span",{className:"text-[11px] font-semibold text-gray-700 truncate",children:s.originalName})]}),e.jsx("button",{type:"button",onClick:()=>C(s._id),className:"text-gray-300 hover:text-red-500 transition-colors",children:e.jsx("i",{className:"fas fa-trash-alt text-xs"})})]},s._id))}):e.jsx("div",{className:"p-3 border border-dashed border-gray-100 rounded-lg bg-gray-50/30",children:e.jsx("span",{className:"text-[10px] text-gray-400 italic",children:"No PDF documents found."})})]})]})]})})]})]})};export{ie as T};
