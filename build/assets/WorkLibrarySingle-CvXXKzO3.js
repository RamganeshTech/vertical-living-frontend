import{u as R,b as U,r as p,a as q,j as s,M as J,I as x,B as h,t as C}from"./index-CUvv9ev0.js";import{L as g}from"./Label-CX2gOFKV.js";import{C as K,b as Q,d as V,a as X}from"./Card-CHHq377-.js";import{c as Y,d as Z}from"./workLibraryApi-CUbsrsqp.js";const as=()=>{var v,T,y;const{id:k}=R(),w=U(),{data:f,isLoading:S,error:m}=Y(k),I=Z(),[a,r]=p.useState(null),[M,_]=p.useState([]),[D,W]=p.useState([]),{role:A,permission:j}=q(),L=A==="owner"||((v=j==null?void 0:j.stafftask)==null?void 0:v.edit);p.useEffect(()=>{f&&r(f)},[f]);const b=(t,i)=>{r(e=>({...e,[t]:i}))},N=(t,i,e)=>{const l=[...a.tasks];l[t][i]=e,r(n=>({...n,tasks:l}))},E=(t,i,e,l)=>{const n=[...a.tasks];n[t].subtasks[i][e]=l,r(o=>({...o,tasks:n}))},B=()=>{r(t=>({...t,tasks:[...t.tasks,{title:"",description:"",category:"",subtasks:[]}]}))},F=t=>{const i=a.tasks[t];i._id&&W(l=>[...l,i._id]);const e=[...a.tasks];e.splice(t,1),r(l=>({...l,tasks:e}))},z=t=>{const i=[...a.tasks];i[t].subtasks.push({title:"",description:"",estimatedTimeInMinutes:null}),r(e=>({...e,tasks:i}))},G=(t,i)=>{const e=a.tasks[t],l=e.subtasks[i];l._id&&e._id&&_(o=>[...o,{taskId:e._id,subtaskId:l._id}]);const n=[...a.tasks];n[t].subtasks.splice(i,1),r(o=>({...o,tasks:n}))},H=async()=>{var t,i;try{const e=[],l=[],n=[],o=[];for(const d of a.tasks)if(d._id){e.push({_id:d._id,title:d.title,estimatedTimeInMinutes:Number(d.estimatedTimeInMinutes)||0});const u=d.subtasks.filter(c=>!c._id),P=d.subtasks.filter(c=>c._id);u.length&&o.push({taskId:d._id,subtasks:u.map(c=>({title:c.title,estimatedTimeInMinutes:Number(c.estimatedTimeInMinutes)||0}))}),n.push(...P.map(c=>({taskId:d._id,subtaskId:c._id,title:c.title,estimatedTimeInMinutes:Number(c.estimatedTimeInMinutes)||0})))}else l.push({title:d.title,estimatedTimeInMinutes:Number(d.estimatedTimeInMinutes)||0,subtasks:d.subtasks.map(u=>({title:u.title,estimatedTimeInMinutes:Number(u.estimatedTimeInMinutes)||0}))});const O={workName:a==null?void 0:a.workName,description:a==null?void 0:a.description,tags:(a==null?void 0:a.tags)??[],addTasks:l,deleteTaskIds:D,updateTasks:e,addSubtasks:o,deleteSubtaskIds:M,updateSubtasks:n};await I.mutateAsync({workId:k,formData:O}),C({title:"Success",description:"Workflow updated successfully"})}catch(e){C({title:"Error",description:((i=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:i.message)||(e==null?void 0:e.message)||"Failed to update",variant:"destructive"})}};return S?s.jsx(J,{}):!f||m?s.jsxs("div",{className:"flex flex-col items-center  justify-center min-h-[300px] w-full bg-white rounded-xl text-center p-6",children:[s.jsx("i",{className:"fas fa-note text-5xl text-blue-300 mb-4"}),s.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-1",children:"No WorkFlow Found"}),s.jsx("p",{className:"text-sm text-gray-500",children:((y=(T=m==null?void 0:m.response)==null?void 0:T.data)==null?void 0:y.message)||(m==null?void 0:m.message)||"something went wrong"})]}):s.jsxs("div",{className:"p-2 max-h-full overflow-y-auto mx-auto space-y-10",children:[s.jsx("header",{className:"flex items-center justify-between w-full bg-white border-b border-gray-200 px-4 py-3 rounded-md",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("button",{onClick:()=>w(-1),className:"flex items-center gap-2 px-3 py-1.5 bg-gray-100 hover:bg-gray-200 text-gray-800 text-sm font-medium rounded-md transition-colors",children:[s.jsx("i",{className:"fas fa-arrow-left text-sm"}),s.jsx("span",{children:"Back"})]}),s.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Workflow Details"})]})}),s.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx(g,{children:"Work Name"}),s.jsx(x,{value:(a==null?void 0:a.workName)||"",onChange:t=>b("workName",t.target.value)})]}),s.jsxs("div",{children:[s.jsx(g,{children:"Description"}),s.jsx(x,{value:(a==null?void 0:a.description)||"",onChange:t=>b("description",t.target.value)})]})]}),s.jsxs("div",{className:"flex justify-between items-center !mb-3",children:[s.jsx("h2",{className:"text-lg font-semibold",children:"Tasks"}),s.jsxs(h,{onClick:B,children:[s.jsx("i",{className:"fa-solid fa-plus mr-2"})," Add Task"]})]}),s.jsx("div",{className:"space-y-6",children:a==null?void 0:a.tasks.map((t,i)=>s.jsxs(K,{className:"border-l-4 border-blue-600",children:[s.jsxs(Q,{className:"flex flex-row justify-between items-center space-y-0",children:[s.jsxs(V,{className:"text-lg",children:["Task ",i+1]}),s.jsxs(h,{size:"sm",className:"bg-red-600 text-white hover:bg-red-700",onClick:()=>F(i),children:[s.jsx("i",{className:"fa-solid fa-trash mr-1"}),"Delete Task"]})]}),s.jsxs(X,{className:"space-y-4",children:[s.jsxs("div",{className:"grid md:grid-cols-2 gap-3",children:[s.jsxs("div",{children:[s.jsx(g,{children:"Task Title"}),s.jsx(x,{value:(t==null?void 0:t.title)||"",onChange:e=>N(i,"title",e.target.value)})]}),s.jsxs("div",{children:[s.jsx(g,{children:"Estimated Time (min)"}),s.jsx(x,{type:"number",value:(t==null?void 0:t.estimatedTimeInMinutes)||0,onChange:e=>N(i,"estimatedTimeInMinutes",e.target.value)})]})]}),s.jsxs("div",{className:"flex justify-between items-center mt-4",children:[s.jsx("h3",{className:"text-sm font-semibold",children:"Subtasks"}),s.jsxs(h,{onClick:()=>z(i),children:[s.jsx("i",{className:"fa-solid fa-circle-plus mr-2"}),"Add Subtask"]})]}),s.jsx("div",{className:"space-y-3",children:t==null?void 0:t.subtasks.map((e,l)=>s.jsxs("div",{className:"flex gap-3 bg-gray-50 p-3 rounded-lg relative",children:[s.jsx("div",{className:"flex flex-1",children:s.jsx(x,{value:(e==null?void 0:e.title)||"",onChange:n=>E(i,l,"title",n.target.value)})}),s.jsx(h,{size:"icon",className:"bg-red-600 hover:bg-red-600 text-white",onClick:()=>G(i,l),children:s.jsx("i",{className:"fa-solid fa-trash"})})]},e==null?void 0:e._id))})]})]},t._id))}),s.jsx("div",{className:"flex justify-end mt-6",children:L&&s.jsxs(h,{onClick:H,children:[s.jsx("i",{className:"fa-solid fa-floppy-disk mr-2"})," Save All Changes"]})})]})};export{as as default};
