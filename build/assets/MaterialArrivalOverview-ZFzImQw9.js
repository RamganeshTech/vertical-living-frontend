import{b as H,a as J,d as Q,r as f,j as e,O as V}from"./index-DkfQDeIt.js";import{t as x}from"./toast-BSC5QTk1.js";import{B as u}from"./Button-C-chqFKc.js";import{I as m}from"./Input-lr8I7tVA.js";import{c as X}from"./Card-Dx_Z9f0D.js";import{G as Y}from"./GenerateWhatsappLink-C30QwXyD.js";import{A as K,S as D}from"./AssignStaff-DXCssW_O.js";import{R as ee}from"./ResetStageButton-DPKiOhg7.js";import se from"./MaterialOverviewLoading-CgXl-m5l.js";import{u as ae,a as te,b as le,c as re,d as ie,e as ne}from"./materialArrivalApi-DE4-7Qnd.js";import"./useMutation-BWlLDX_I.js";import"./roleCheck-DNL7PxQZ.js";import"./getAllUsersApi-CuWWGdu9.js";import"./useQuery-mUmMtORz.js";import"./Skeleton-CVtEMTN7.js";const Se=()=>{var S,y;const{projectId:d,organizationId:C}=H(),A=J(),{isMobile:k,openMobileSidebar:P}=Q(),M=location.pathname.includes("/materialarrivalroom/"),[E,j]=f.useState(!1),[L,v]=f.useState(!1),[i,h]=f.useState({}),[n,p]=f.useState({}),{data:t,isLoading:I,isError:b,error:N,refetch:g}=ae(d),{mutateAsync:O}=te(),{mutateAsync:F}=le(),{mutateAsync:U,isPending:R}=re(),{mutateAsync:G,isPending:$}=ie(),{mutateAsync:B,isPending:T}=ne();if(I)return e.jsx(se,{});const{shopDetails:l,deliveryLocationDetails:r,materialArrivalList:w,timer:c,generatedLink:z}=t||{},W=Object.keys(w||{}),Z=async()=>{var s,o;try{if(i.phoneNumber&&!/^\d{10}$/.test(i.phoneNumber.trim()))throw new Error("Phone number should contain exactly 10 digit numbers");await O({projectId:d,updates:i}),x({title:"Success",description:"Shop details updated"}),j(!1),g()}catch(a){x({variant:"destructive",title:"Error",description:((o=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:o.message)||(a==null?void 0:a.message)||"Update failed"})}},_=async()=>{var s,o;try{if(n.phoneNumber&&!/^\d{10}$/.test(n.phoneNumber.trim()))throw new Error("Phone number should contain exactly 10 digit numbers");await F({projectId:d,updates:n}),x({title:"Success",description:"Delivery location updated"}),v(!1),g()}catch(a){x({variant:"destructive",title:"Error",description:((o=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:o.message)||(a==null?void 0:a.message)||"Update failed"})}},q=async()=>{var s,o;try{await B({projectId:d}),x({description:"Completion status updated successfully",title:"Success"})}catch(a){x({title:"Error",description:((o=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:o.message)||(a==null?void 0:a.message)||"Failed to update completion status",variant:"destructive"})}};return e.jsx("div",{className:"w-full h-full flex flex-col p-2 ",children:M?e.jsx(V,{}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex-shrink-0 flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-4 pb-3 ",children:[e.jsxs("h2",{className:"text-2xl sm:text-2xl lg:text-2xl xl:text-3xl font-semibold text-blue-600 flex items-center",children:[k&&e.jsx("button",{onClick:P,className:"mr-3 p-2 rounded-md border-gray-300 hover:bg-gray-100",title:"Open Menu",children:e.jsx("i",{className:"fa-solid fa-bars"})}),e.jsx("i",{className:"fa-solid fa-receipt mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Material Checking"}),e.jsx("span",{className:"sm:hidden",children:"Material Check"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full sm:w-auto",children:[e.jsxs(u,{isLoading:T,onClick:q,className:"bg-green-600 hover:bg-green-700 text-white w-full sm:w-auto whitespace-nowrap",children:[e.jsx("i",{className:"fa-solid fa-circle-check mr-2"}),"Mark as Complete"]}),e.jsx(ee,{projectId:d,stageNumber:9,stagePath:"materialarrivalcheck"}),e.jsx(K,{stageName:"MaterialArrivalModel",projectId:d,organizationId:C,currentAssignedStaff:(t==null?void 0:t.assignedTo)||null})]})]}),b&&e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"max-w-xl p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2",children:"⚠️ Error Occurred"}),e.jsx("p",{className:"text-red-500 text-sm mb-4",children:((y=(S=N==null?void 0:N.response)==null?void 0:S.data)==null?void 0:y.message)||"Failed to load material arrival data"}),e.jsx(u,{onClick:()=>g(),className:"bg-red-600 text-white hover:bg-red-700",children:"Retry"})]})}),!b&&e.jsxs("div",{className:"flex-1 min-h-0 overflow-y-auto space-y-4 sm:space-y-6",children:[e.jsxs(X,{className:"p-4 w-full shadow border-l-4 border-blue-600 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-3 text-blue-700 text-sm font-medium mb-2",children:[e.jsx("i",{className:"fa-solid fa-clock text-blue-500 text-lg"}),e.jsx("span",{children:"Stage Timings"})]}),e.jsx(D,{stageName:"materialarrivalcheck",completedAt:c==null?void 0:c.completedAt,projectId:d,formId:t==null?void 0:t._id,deadLine:c==null?void 0:c.deadLine,startedAt:c==null?void 0:c.startedAt,refetchStageMutate:g,deadLineMutate:G,isPending:$})]}),e.jsxs("div",{className:"border-l-4 border-blue-600  rounded-lg p-4 shadow-sm relative bg-white",children:[e.jsxs("h2",{className:"text-base sm:text-lg font-bold mb-3 text-blue-700 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-store"}),"Shop Details"]}),E?e.jsxs("div",{className:"space-y-3",children:[e.jsx(m,{placeholder:"Shop Name",value:i.shopName||"",onChange:s=>h({...i,shopName:s.target.value}),className:"w-full"}),e.jsx(m,{placeholder:"Contact Person",value:i.contactPerson||"",onChange:s=>h({...i,contactPerson:s.target.value}),className:"w-full"}),e.jsx(m,{placeholder:"Phone Number",type:"tel",maxLength:10,value:i.phoneNumber||"",onChange:s=>h({...i,phoneNumber:s.target.value}),className:"w-full"}),e.jsx(m,{placeholder:"Address",value:i.address||"",onChange:s=>h({...i,address:s.target.value}),className:"w-full"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mt-3",children:[e.jsxs(u,{onClick:Z,className:"w-full sm:w-auto",children:[e.jsx("i",{className:"fa-solid fa-save mr-2"}),"Save"]}),e.jsxs(u,{variant:"outline",onClick:()=>j(!1),className:"w-full sm:w-auto",children:[e.jsx("i",{className:"fa-solid fa-times mr-2"}),"Cancel"]})]})]}):e.jsxs("div",{className:"space-y-2 text-sm sm:text-base",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Shop Name:"})," ",(l==null?void 0:l.shopName)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Contact Person:"})," ",(l==null?void 0:l.contactPerson)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Phone:"})," ",(l==null?void 0:l.phoneNumber)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Address:"})," ",(l==null?void 0:l.address)||"-"]}),(t==null?void 0:t.status)!=="completed"&&e.jsxs("button",{onClick:()=>{h(l),j(!0)},className:"absolute top-3 right-4 text-blue-600 text-xs sm:text-sm underline hover:text-blue-800",children:[e.jsx("i",{className:"fa-solid fa-edit mr-1"}),"Edit"]})]})]}),e.jsxs("div",{className:"border-l-4 border-blue-600  rounded-lg p-4 shadow-sm relative bg-white",children:[e.jsxs("h2",{className:"text-base sm:text-lg font-bold mb-3 text-blue-700 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-truck"}),"Delivery Location"]}),L?e.jsxs("div",{className:"space-y-3",children:[e.jsx(m,{placeholder:"Site Name",value:n.siteName||"",onChange:s=>p({...n,siteName:s.target.value}),className:"w-full"}),e.jsx(m,{placeholder:"Site Supervisor",value:n.siteSupervisor||"",onChange:s=>p({...n,siteSupervisor:s.target.value}),className:"w-full"}),e.jsx(m,{placeholder:"Phone Number",type:"tel",maxLength:10,value:n.phoneNumber||"",onChange:s=>p({...n,phoneNumber:s.target.value}),className:"w-full"}),e.jsx(m,{placeholder:"Address",value:n.address||"",onChange:s=>p({...n,address:s.target.value}),className:"w-full"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mt-3",children:[e.jsxs(u,{onClick:_,className:"w-full sm:w-auto",children:[e.jsx("i",{className:"fa-solid fa-save mr-2"}),"Save"]}),e.jsxs(u,{variant:"outline",onClick:()=>v(!1),className:"w-full sm:w-auto",children:[e.jsx("i",{className:"fa-solid fa-times mr-2"}),"Cancel"]})]})]}):e.jsxs("div",{className:"space-y-2 text-sm sm:text-base",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Site Name:"})," ",(r==null?void 0:r.siteName)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Supervisor:"})," ",(r==null?void 0:r.siteSupervisor)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Phone:"})," ",(r==null?void 0:r.phoneNumber)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Address:"})," ",(r==null?void 0:r.address)||"-"]}),(t==null?void 0:t.status)!=="completed"&&e.jsxs("button",{onClick:()=>{p(r),v(!0)},className:"absolute top-3 right-4 text-blue-600 text-xs sm:text-sm underline hover:text-blue-800",children:[e.jsx("i",{className:"fa-solid fa-edit mr-1"}),"Edit"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:W.map(s=>{const o=w[s]||[];return e.jsxs("div",{className:"border-l-4 border-blue-600 p-4 rounded-xl shadow hover:shadow-md transition cursor-pointer bg-white",onClick:()=>A(`materialarrivalroom/${s}`),children:[e.jsx("h3",{className:"text-md font-semibold capitalize text-blue-800",children:s.replace(/([A-Z])/g," $1")}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Items: ",o.length]}),e.jsx("p",{className:"text-xs text-gray-400",children:"Click to view details"})]},s)})}),e.jsx("section",{className:"mt-4",children:e.jsx(Y,{projectId:d,context:"Material",stage:"materialarrival",data:z,isPending:R,generateLink:U})})]})]})})};export{Se as default};
