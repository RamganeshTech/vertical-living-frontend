import{ab as te,b as se,a as ae,r as y,j as e,B as c,I as L,t as h}from"./index-N5JcrWW5.js";import{f as re,g as ie,h as ne,i as le}from"./orderingMaterialApi-m4xkJ_jZ.js";import{r as m,g as de,h as E}from"./constants-GxzOlS2B.js";import{S as P,a as M,b as O,c as V,d as T}from"./Select-CEqf-iCJ.js";import{R as oe}from"./RoomDetailLoading-DOtpLQmX.js";import{u as ce}from"./useQuery-sYFIGfif.js";import"./roleCheck-B8-FOucE.js";import"./Skeleton-Buq8V7lI.js";const me=async({category:l})=>{const{data:s}=await te.get(`/api/ai/brands/${l}`);return s.data},xe=l=>{const b=["electricalFittings","ceramicSanitaryware","upholsteryCurtains","falseCeilingMaterials"].includes(l);return ce({queryKey:["brands",l],queryFn:()=>me({category:l}),enabled:!!l&&!b})},we=()=>{var A,R,$,B,D;const{projectId:l,roomKey:s,organizationId:b}=se(),K=ae();if(!s)return;const[p,v]=y.useState({}),[S,g]=y.useState(!1),[I,w]=y.useState(null),[u,N]=y.useState({}),{data:z,isLoading:Z,isError:_,refetch:f,error:C}=re(l,s),{mutateAsync:G,isPending:Q}=ie(),{mutateAsync:U,isPending:W}=ne(),{mutateAsync:H,isPending:J}=le(),{data:F}=xe(s);if(Z)return e.jsx(oe,{});if(_)return e.jsxs("div",{className:"max-w-xl mx-auto mt-4 p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2",children:"⚠️ Error Occurred"}),e.jsx("p",{className:"text-red-500 text-sm mb-4",children:((R=(A=C==null?void 0:C.response)==null?void 0:A.data)==null?void 0:R.message)||"Failed to load data"}),e.jsx(c,{onClick:()=>f(),className:"bg-red-600 text-white px-4 py-2",children:"Retry"})]});const x=z||[],k=(a,r)=>{N(t=>({...t,[a]:r}))},X=async a=>{try{const r=m[s];if(!r||r.length===0)throw new Error("Invalid room type or no fields defined.");const t=r[0],i=u[t];if(!i||i.toString().trim()==="")throw new Error(`The field "${t}" is required.`);if(Object.values(u).every(n=>!n||n.toString().trim()===""))throw new Error("At least one field must be filled.");await U({itemId:a,projectId:l,roomKey:s,updates:[u]}),h({title:"Success",description:"Item updated."}),w(null),N({}),g(!1),f()}catch(r){h({title:"Error",description:(r==null?void 0:r.message)||"Failed",variant:"destructive"})}},Y=async()=>{var a,r;try{const t=m[s];if(!t||t.length===0)throw new Error("Invalid room type or no fields defined.");const i=t[0],d=p[i];if(!d||d.toString().trim()==="")throw new Error(`The field "${i}" is required.`);if(Object.values(p).every(j=>!j||j.toString().trim()===""))throw new Error("At least one field must be filled.");if(x==null?void 0:x.some(j=>{var q;return((q=j[i])==null?void 0:q.toString().trim().toLowerCase())===d.toString().trim().toLowerCase()}))throw new Error(`"${d}" already exists. Please use a unique value.`);await G({projectId:l,roomKey:s,newItem:p}),h({title:"Success",description:"Item added."}),v({}),g(!1),f()}catch(t){h({title:"Error",description:((r=(a=t==null?void 0:t.response)==null?void 0:a.data)==null?void 0:r.message)||(t==null?void 0:t.message)||"Failed",variant:"destructive"})}},ee=async a=>{var r,t;try{await H({projectId:l,roomKey:s,itemId:a}),h({title:"Deleted",description:"Item removed"}),f()}catch(i){h({title:"Error",description:((t=(r=i==null?void 0:i.response)==null?void 0:r.data)==null?void 0:t.message)||(i==null?void 0:i.message)||"Failed to delete",variant:"destructive"})}};return e.jsxs("div",{className:"w-full h-full",children:[e.jsxs("div",{className:"w-full flex justify-between items-center mb-2",children:[e.jsx("h2",{className:"text-xl font-bold text-blue-800 capitalize ",children:s}),e.jsxs("div",{className:" px-6 flex gap-2",children:[e.jsx(c,{onClick:()=>g(()=>!0),children:"Add Item"}),e.jsx(c,{variant:"primary",className:"h-10",onClick:()=>K(`/${b}/projectdetails/${l}/ordermaterial`),children:"Go Back"})]})]}),e.jsx("div",{className:"w-full !min-h-[85vh] rounded-lg ",children:e.jsx("div",{className:"overflow-x-auto custom-scrollbar min-w-full flex-grow min-h-0",children:e.jsxs("div",{className:" w-full flex flex-col border-2 border-gray-100 rounded-lg",style:{minWidth:`${((($=m[s])==null?void 0:$.length)+1)*190}px`},children:[e.jsxs("div",{className:"grid items-center px-6 py-3 bg-blue-100 text-blue-800 text-sm font-semibold",style:{gridTemplateColumns:`repeat(${m[s].length+1}, minmax(120px, 1fr))`},children:[(B=m[s])==null?void 0:B.map((a,r)=>e.jsx("div",{className:"text-center text-xs font-medium uppercase tracking-wider",children:a},r)),e.jsx("div",{className:"text-center text-xs font-medium uppercase tracking-wider",children:"Actions"})]}),e.jsx("div",{className:"text-sm text-blue-900 divide-y  !h-[75vh] overflow-y-auto divide-blue-100",children:!S&&x.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center text-gray-500 bg-gray-50",children:[e.jsx("i",{className:"fas fa-users text-4xl text-gray-300 mb-4"}),e.jsxs("h3",{className:"text-lg font-semibold text-gray-700",children:["No ",s.replace(/([A-Z])/g," $1")," Items"]}),e.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:["Add your first ",s.replace(/([A-Z])/g," $1").toLowerCase()," item to start tracking"]}),e.jsxs("button",{onClick:()=>g(!0),className:"bg-blue-600 hover:bg-blue-700 text-white text-sm px-4 py-2 rounded font-medium",children:["Add ",s.replace(/([A-Z])/g," $1")," Item"]})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{children:[x==null?void 0:x.map((a,r)=>e.jsxs("div",{className:"grid border text-center px-6 py-3 gap-2 border-b border-gray-200 hover:bg-gray-50 transition-colors",style:{gridTemplateColumns:`repeat(${m[s].length+1}, minmax(120px, 1fr))`},children:[m[s].map((t,i)=>{const d=t==="brandName"&&E.brandName[s],o=t==="fabric"&&s==="upholsteryCurtains";return e.jsx("div",{className:"text-center px-6 py-3 gap-4 hover:bg-gray-50 transition-colors text-sm min-w-[120px]",children:I===r?d||o?e.jsxs(P,{value:u[t]||"",onValueChange:n=>k(t,n),children:[e.jsx(M,{children:e.jsx(O,{selectedValue:u[t],placeholder:`Select ${t==="brandName"?"brand":"fabric"}`})}),e.jsx(V,{children:F==null?void 0:F.map(n=>e.jsx(T,{value:n,children:n},n))})]}):e.jsx(L,{className:"text-xs",value:u[t]||"",onChange:n=>k(t,n.target.value)}):a[t]||"-"},i)}),e.jsx("div",{className:"flex justify-center gap-2 items-center",children:I===r?e.jsxs(e.Fragment,{children:[e.jsx(c,{size:"sm",isLoading:W,onClick:()=>X(a._id),children:e.jsx("i",{className:"fas fa-check"})}),e.jsx(c,{size:"sm",variant:"ghost",onClick:()=>w(null),children:e.jsx("i",{className:"fas fa-xmark text-red-600"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(c,{variant:"primary",children:e.jsx("i",{className:"fas fa-pen",onClick:()=>{N(a),w(r)}})}),e.jsx(c,{isLoading:J,variant:"ghost",children:e.jsx("i",{className:"fas fa-trash text-red-500 cursor-pointer",onClick:()=>ee(a._id)})})]})})]},a._id)),S&&e.jsxs("div",{className:"grid items-center px-6 py-3 gap-2 bg-white mt-2",style:{gridTemplateColumns:`repeat(${m[s].length+1}, minmax(120px, 1fr))`},children:[(D=m[s])==null?void 0:D.map((a,r)=>{const t=a==="brandName"&&E.brandName[s];if(t||a==="fabric"&&s==="upholsteryCurtains"){const d=t?de[s]:E.fabric[s];return e.jsx("div",{className:"text-center min-w-[120px]",children:e.jsxs(P,{onValueChange:o=>v(n=>({...n,[a]:o})),children:[e.jsx(M,{children:e.jsx(O,{selectedValue:p[a],placeholder:`Select ${a==="brandName"?"brand":"fabric"}`})}),e.jsx(V,{children:d.map(o=>e.jsx(T,{value:o,children:o},o))})]})},r)}return e.jsx("div",{className:"text-center min-w-[120px]",children:e.jsx(L,{className:"text-xs text-center",placeholder:a,value:p[a]||"",onChange:d=>v(o=>({...o,[a]:d.target.value}))})},r)}),e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx(c,{isLoading:Q,onClick:Y,children:e.jsx("i",{className:"fas fa-check"})}),e.jsx(c,{onClick:()=>g(()=>!1),children:e.jsx("i",{className:"fas fa-xmark"})})]})]})]})})})]})})})]})};export{we as default};
