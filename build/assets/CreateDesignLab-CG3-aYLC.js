import{u as I,j as b,t as p}from"./index-MXS_gbde.js";import{u as y}from"./designLabApi-C-1GBf5T.js";import{D as E}from"./DesignLabForm-CrMN1JQB.js";const O=()=>{const{organizationId:s}=I(),{mutateAsync:u,isPending:g}=y(),f=async a=>{var c,d,l;try{const t=new FormData;if(!a.productName||!((c=a==null?void 0:a.productName)!=null&&c.trim())){p({title:"Error",description:"Enter the product name",variant:"destructive"});return}const o=[],m=a.components.map(e=>{const i=e.materials.filter(n=>{var r;return((r=n.materialName)==null?void 0:r.trim())||n.rate!==""&&n.rate!==0||n.image});return{...e,materials:i}}),v=a.sequenceOfOperations.filter(e=>e.description&&e.description.trim()!=="").map((e,i)=>({...e,stepNumber:i+1})),h={...a,organizationId:s,sequenceOfOperations:v,referenceImages:[],components:m.map(e=>({...e,materials:e.materials.map(i=>({...i,vendorId:i.vendorId===""?void 0:i.vendorId}))}))};a.newRefFiles.forEach(e=>{t.append("files",e),o.push({target:"reference"})}),m.forEach((e,i)=>{e.materials.forEach((n,r)=>{n.tempFile&&(t.append("files",n.tempFile),o.push({target:"material",componentIndex:i,materialIndex:r}))})}),t.append("data",JSON.stringify(h)),t.append("fileMapping",JSON.stringify(o)),t.append("organizationId",s),await u({organizationId:s,formData:t}),p({title:"Success",description:"Design created successfully"})}catch(t){console.error(t),p({title:"Error",description:((l=(d=t==null?void 0:t.response)==null?void 0:d.data)==null?void 0:l.message)||"Failed to update design",variant:"destructive"})}};return b.jsx(E,{mode:"create",organizationId:s,onSubmit:f,isLoading:g})};export{O as default};
