import{j as e,B as D,b as Qe,R as De,r as T,h as Z,S as Xe,I as ce,t as ee,u as Ye,l as Ze,a as et,M as tt}from"./index-CUvv9ev0.js";import{u as rt,a as st,b as at,c as nt,f as ge}from"./InternalQuoteEntry-BsJPsARi.js";import{c as ot,u as lt}from"./labourRateconfigApi-C3xWGadp.js";import{C as Be}from"./CreateQuoteModal-NZC6xFae.js";import{u as it,a as ct}from"./materialLabourRateConfigApi-D_07w6qj.js";import"./quoteVariantApi-DXhk0qe8.js";import"./Card-CHHq377-.js";import"./dateFormator-BGKi5rfZ.js";import"./StageGuide-n_FMHWm4.js";import"./Label-CX2gOFKV.js";import"./Select-Dr5p0XuH.js";const re={plywood:1,innerLaminate:1,outerLaminate:1},xt=()=>({itemName:"",plywoodNos:{quantity:0,thickness:0},innerLaminate:{quantity:0,thickness:0},outerLaminate:{quantity:0,thickness:0},carpenters:0,days:0,profitOnMaterial:0,profitOnLabour:0,rowTotal:0,remarks:""}),Re=()=>({itemName:"",description:"",quantity:0,cost:0,rowTotal:0}),ie=(t,B,A=0,W=0)=>{if(t.length===0)return[];const r=t.length,U=W/r,g=t[0],C=g.carpenters*g.days*B*(1+(g.profitOnLabour||0)/100)/r,w=1+A/100;return t.map(M=>{var u,k,v;const E=((u=M.plywoodNos)==null?void 0:u.quantity)||0,d=((k=M.innerLaminate)==null?void 0:k.quantity)||0,a=((v=M.outerLaminate)==null?void 0:v.quantity)||0,x=E*re.plywood+d*re.innerLaminate+a*re.outerLaminate,s=(M.profitOnMaterial||0)>0,i=x*(1+(M.profitOnMaterial||0)/100),n=s?i+C+U:(x+C+U)*w;return{...M,rowTotal:n}})},dt=({data:t,isEditing:B,labourCost:A,duplicateFurniture:W,updateFurniture:r,removeFurniture:U})=>{const g=d=>{const a=d.coreMaterials.reduce((n,u)=>n+u.rowTotal,0),x=d.fittingsAndAccessories.reduce((n,u)=>n+u.rowTotal,0),s=d.glues.reduce((n,u)=>n+u.rowTotal,0),i=d.nonBrandMaterials.reduce((n,u)=>n+u.rowTotal,0);return{core:a,fittings:x,glues:s,nbms:i,furnitureTotal:a+x+s+i}},y=(d,a,x)=>{const s=[...t.coreMaterials];a==="imageUrl"?(B&&(s[d].newImageFile=x),s[d].imageUrl=x,s[d].previewUrl=URL.createObjectURL(x)):a==="plywoodNos"||a==="innerLaminate"||a==="outerLaminate"?s[d][a]={...s[d][a]||{},...x}:s[d][a]=x;const i=ie(s,A,t.furnitureProfit||0),n=i.reduce((j,N)=>j+(N.rowTotal||0),0),u=i.length,k=u>0?Math.round(n/u):0,v=1+(t.furnitureProfit||0)/100,b=(j,N=!1)=>j.map(L=>{if(N||L.itemName==="Glue")return{...L,itemName:"Glue",quantity:1,profitOnMaterial:L.profitOnMaterial,cost:k,rowTotal:k};const G=(L.quantity||0)*(L.cost||0),_=L.profitOnMaterial||0,z=_>0?G*(1+_/100):G*v;return{...L,rowTotal:z}}),R={...t,coreMaterials:i,fittingsAndAccessories:b(t.fittingsAndAccessories),glues:b(t.glues,!0),nonBrandMaterials:b(t.nonBrandMaterials)};R.totals=g(R),r==null||r(R)},q=d=>{const a=d.reduce((k,v)=>k+(v.rowTotal||0),0),x=d.length,s=x>0?Math.round(a/x):0,i=1+(t.furnitureProfit||0)/100,n=(k,v=!1)=>k.map(b=>{if(v||b.itemName==="Glue")return{...b,itemName:"Glue",quantity:1,cost:s,profitOnMaterial:b.profitOnMaterial,rowTotal:s};const R=(b.quantity||0)*(b.cost||0),N=(b.profitOnMaterial||0)>0?R*(1+(b.profitOnMaterial||0)/100):R*i;return{...b,rowTotal:N}}),u={...t,coreMaterials:d,fittingsAndAccessories:n(t.fittingsAndAccessories),glues:n(t.glues,!0),nonBrandMaterials:n(t.nonBrandMaterials)};u.totals=g(u),r==null||r(u)},C=(d,a,x)=>{const s=x?t.coreMaterials.map(N=>({...N,profitOnMaterial:0,profitOnLabour:0})):t.coreMaterials,i=x?t.fittingsAndAccessories.map(N=>({...N,profitOnMaterial:0})):t.fittingsAndAccessories,n=x?t.glues.map(N=>({...N,profitOnMaterial:0})):t.glues,u=x?t.nonBrandMaterials.map(N=>({...N,profitOnMaterial:0})):t.nonBrandMaterials,k=ie(s,A,d,a),v=k.reduce((N,L)=>N+L.rowTotal,0),b=k.length>0?v/k.length:0,R=(N,L=!1)=>N.map(G=>{if(L||G.itemName==="Glue")return{...G,cost:b,rowTotal:b};const _=G.quantity*G.cost,z=G.profitOnMaterial||0;return{...G,rowTotal:z>0?_*(1+z/100):_*(1+d/100)}}),j={...t,furnitureProfit:d,fabricationCost:a,coreMaterials:k,fittingsAndAccessories:R(i),glues:R(n,!0),nonBrandMaterials:R(u)};j.totals=g(j),r==null||r(j)},w=(d,a,x,s)=>{const i=[...t[d]];if(i[a][x]=s,d!=="glues"){const v=(i[a].quantity||0)*(i[a].cost||0),b=v*((i[a].profitOnMaterial||0)/100);i[a].rowTotal=Math.round(v+b)}else{const v=i[a].cost||0,b=v*((i[a].profitOnMaterial||0)/100);i[a].rowTotal=Math.round(v+b)}const n=a===i.length-1,u=i[a].itemName||i[a].description||i[a].quantity||i[a].cost;n&&u&&i.push(Re());const k={...t,[d]:i};k.totals=g(k),r&&r(k)},M=()=>{var d;return e.jsxs("div",{className:"mt-4",children:[e.jsxs("h3",{className:"font-semibold text-md mb-2",children:["Core Materials - Total: ₹",(d=t==null?void 0:t.totals)==null?void 0:d.core.toLocaleString("en-IN")]}),e.jsx("div",{className:"overflow-x-auto  rounded-md",children:e.jsxs("table",{className:"min-w-full text-sm bg-white shadow-sm",children:[e.jsxs("thead",{className:"bg-blue-50 text-sm font-semibold text-gray-600",children:[e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Image"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Item Name"}),e.jsx("th",{className:"text-center px-6 py-1 text-xs font-medium text-gray-500 uppercase tracking-wider border-x border-gray-200",colSpan:2,children:"Plywood"}),e.jsx("th",{className:"text-center px-6 py-1 text-xs font-medium text-gray-500 uppercase tracking-wider border-x border-gray-200",colSpan:4,children:"Laminate"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"No. of Carpenters / Day"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"No. of Days"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Profit % Material"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Profit % Labour"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Remarks"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Total"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Actions"})]}),e.jsxs("tr",{className:"",children:[e.jsx("th",{className:"px-2 py-2 text-[10px] uppercase text-gray-500 border-r border-gray-200",children:"Thk"}),e.jsx("th",{className:"px-2 py-2 text-[10px] uppercase text-gray-500 border-r border-gray-200",children:"Qty"}),e.jsx("th",{className:"px-2 py-2 text-[10px]  text-gray-500 uppercase border-r border-gray-200",children:"Outer Thk"}),e.jsx("th",{className:"px-2 py-2 text-[10px]  text-gray-500 uppercase border-r border-gray-200",children:"Outer Qty"}),e.jsx("th",{className:"px-2 py-2 text-[10px]  text-gray-500 uppercase border-r border-gray-200",children:"Inner Thk"}),e.jsx("th",{className:"px-2 py-2 text-[10px]  text-gray-500 uppercase border-r border-gray-200",children:"Inner Qty"})]})]}),e.jsx("tbody",{children:t.coreMaterials.map((a,x)=>e.jsxs("tr",{className:"group relative border-none !border-b-1 px-4 py-2 transition-all duration-150 hover:bg-gray-50",children:[x===0&&e.jsxs("td",{rowSpan:t.coreMaterials.length,children:[e.jsx("input",{type:"file",className:"w-full px-2 py-3 text-center outline-none",onChange:s=>{var i;return y(0,"imageUrl",(i=s.target.files)==null?void 0:i[0])}}),(a.previewUrl||a.imageUrl)&&e.jsx("div",{className:"mt-2 relative group",children:e.jsx("img",{src:a.previewUrl||a.imageUrl,className:"h-16 w-16 object-cover mt-2 mx-auto rounded-lg border shadow-sm",alt:"Product"})})]}),e.jsx("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{value:a.itemName,placeholder:"TV Unit | Wardrobe",onChange:s=>y(x,"itemName",s.target.value),className:"w-full px-2 py-1 text-center outline-none"})}),["plywoodNos","outerLaminate","innerLaminate"].map(s=>["thickness","quantity"].map(i=>e.jsx("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",placeholder:`${i==="quantity"?"QTY":"THK"}`,value:a[s][i]||"",onChange:n=>{Number(n.target.value)>=0&&y(x,s,{...a[s],[i]:Math.max(0,Number(n.target.value))})},className:"w-full px-2 py-1 text-center outline-none"})},`${s}-${i}`))),x===0&&e.jsxs(e.Fragment,{children:[e.jsx("td",{rowSpan:t.coreMaterials.length,className:"px-1 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",placeholder:"no of carpentors",value:a.carpenters||"",onChange:s=>y(x,"carpenters",Math.max(0,Number(s.target.value))),className:"w-full px-[2px] py-1 text-center outline-none"})}),e.jsx("td",{rowSpan:t.coreMaterials.length,className:"px-1 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",placeholder:"no of days",value:a.days||"",onChange:s=>y(x,"days",Math.max(0,Number(s.target.value))),className:"w-full px-[2px] py-1 text-center outline-none"})})]}),e.jsx("td",{className:"px-1 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",placeholder:"profit percent",value:a.profitOnMaterial||"",onChange:s=>y(x,"profitOnMaterial",Math.max(0,Number(s.target.value))),className:"w-full px-[2px] py-1 text-center outline-none"})}),x===0&&e.jsx(e.Fragment,{children:e.jsx("td",{rowSpan:t.coreMaterials.length,className:"px-1 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",placeholder:"profit percent",value:a.profitOnLabour||"",onChange:s=>y(x,"profitOnLabour",Math.max(0,Number(s.target.value))),className:"w-full px-[2px] py-1 text-center outline-none"})})}),e.jsx("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{value:a.remarks,placeholder:"remarks",onChange:s=>y(x,"remarks",s.target.value),className:"w-full px-2 py-1 text-center outline-none"})}),e.jsxs("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:["₹",a.rowTotal.toLocaleString("en-IN",{minimumFractionDigits:0,maximumFractionDigits:2})]}),e.jsx("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx(D,{variant:"danger",onClick:()=>{const s=[...t.coreMaterials];s.splice(x,1);const i=ie(s,A,t.furnitureProfit||0);q(i)},className:"px-1 text-xs bg-red-600 text-white",children:"Remove"})})]},x))})]})}),e.jsx("div",{className:"mt-2 text-right",children:e.jsx(D,{onClick:()=>{const a=[...t.coreMaterials,xt()],x=ie(a,A,t.furnitureProfit||0),s={...t,coreMaterials:x};s.totals=g(s),r==null||r(s)},children:"+ Add Core Material"})})]})},E=(d,a)=>{var x;return e.jsxs("div",{className:"mt-6",children:[e.jsxs("h3",{className:"font-semibold text-md mb-2",children:[d," - Total: ₹",(x=t==null?void 0:t.totals[a==="fittingsAndAccessories"?"fittings":a])==null?void 0:x.toLocaleString("en-IN",{minimumFractionDigits:0,maximumFractionDigits:2})]}),e.jsx("div",{className:"overflow-x-auto  rounded-md",children:e.jsxs("table",{className:"min-w-full text-sm bg-white shadow-sm",children:[e.jsx("thead",{className:"bg-blue-50 text-sm font-semibold text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Item Name"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Description"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Quantity"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cost"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Profit %"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{children:t[a].map((s,i)=>e.jsxs("tr",{className:"group relative border-none !border-b-1 px-4 !py-2 transition-all duration-150 hover:bg-gray-50",children:[e.jsx("td",{className:"p-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{value:s.itemName||"",placeholder:"Item Name",onChange:n=>w(a,i,"itemName",n.target.value),className:"w-full px-2 py-1 text-center outline-none"})}),e.jsx("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{value:s.description,placeholder:"description",onChange:n=>w(a,i,"description",n.target.value),className:"w-full px-2 py-1 text-center outline-none"})}),e.jsx("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",placeholder:"enter quantity",value:s.quantity||"",onChange:n=>{Number(n.target.value)>=0&&w(a,i,"quantity",Math.max(0,Number(n.target.value)))},className:"w-full px-2 py-1 text-center outline-none"})}),e.jsx("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",value:s.cost||"",placeholder:"enter cost",onChange:n=>w(a,i,"cost",Math.max(0,Number(n.target.value))),className:"w-full px-2 py-1 text-center outline-none"})}),e.jsx("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",placeholder:"enter profit",value:(s.profitOnMaterial??0)||"",onChange:n=>w(a,i,"profitOnMaterial",Math.max(0,Number(n.target.value))),className:"w-full px-2 py-1 text-center outline-none"})}),e.jsxs("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:["₹",s.rowTotal.toLocaleString("en-IN",{minimumFractionDigits:0,maximumFractionDigits:2})]}),e.jsx("td",{className:"px-2 border border-gray-200 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx(D,{variant:"danger",onClick:()=>{const n=[...t[a]];n.splice(i,1);const u={...t,[a]:n};u.totals=g(u),r&&r(u)},className:"px-1 text-xs bg-red-600 text-white",children:"Remove"})})]},i))})]})}),e.jsx("div",{className:"mt-2 text-right",children:e.jsxs(D,{onClick:()=>{const s=[...t[a],Re()],i={...t,[a]:s};i.totals=g(i),r&&r(i)},children:["+ Add ",d," Item"]})})]})};return e.jsxs("div",{className:"shadow-md p-4 my-4 border rounded-lg bg-white",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-xs font-bold text-gray-400 uppercase",children:"Product Name:"}),e.jsx("input",{value:t.furnitureName,onChange:d=>r==null?void 0:r({...t,furnitureName:d.target.value}),className:"text-xl font-semibold text-gray-700 border-b border-transparent hover:border-gray-300 focus:border-blue-500 outline-none bg-transparent"})]}),e.jsxs("div",{className:"flex gap-2",children:[W&&e.jsx(D,{size:"sm",onClick:W,className:"bg-blue-600 text-white",children:"Duplicate Product"}),U&&e.jsx(D,{variant:"danger",size:"sm",onClick:U,className:"bg-red-600 text-white",children:"Remove Product"})]})]}),M(),E("Fittings","fittingsAndAccessories"),E("Glues","glues"),E("Non-Branded Materials","nonBrandMaterials"),e.jsxs("div",{className:"mt-6 flex flex-wrap items-center justify-end gap-4 border-t pt-4",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-orange-50 px-3 py-1 rounded-lg border border-orange-100 shadow-sm",children:[e.jsx("label",{className:"text-[11px] font-bold text-orange-600 uppercase tracking-tight",children:"Fabrication Cost"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-orange-600 mr-1 text-sm",children:"₹"}),e.jsx("input",{type:"number",className:"w-20 text-right font-bold bg-transparent outline-none text-orange-800",value:t.fabricationCost??"",placeholder:"0",onChange:d=>C(t.furnitureProfit||0,Math.max(0,Number(d.target.value)),!1)})]})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-blue-50 px-3 py-1 rounded-lg border border-blue-100 shadow-sm",children:[e.jsx("label",{className:"text-[11px] font-bold text-blue-600 uppercase tracking-tight",children:"Product Profit Overlay"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"number",className:"w-12 text-right font-bold bg-transparent outline-none text-blue-800",value:t.furnitureProfit??"",placeholder:"0",onChange:d=>C(Math.max(0,Number(d.target.value)),t.fabricationCost||0,!0)}),e.jsx("span",{className:"text-blue-600 font-bold ml-1 text-sm",children:"%"})]})]}),e.jsxs("div",{className:"text-right text-xl text-green-700 font-bold ml-4",children:["Product Total: ₹",Math.round(t.totals.furnitureTotal).toLocaleString("en-IN")]})]})]})},mt=({data:t,id:B,organizationId:A,projectData:W})=>{var _,z;const r=Qe(),{data:U}=it(A),g=((_=U==null?void 0:U[0])==null?void 0:_._id)||null,{data:y}=ct(A,g),q=De.useMemo(()=>!y||!Array.isArray(y)?[]:y.map(m=>{var h,f;return{_id:m._id,workType:((h=m.data)==null?void 0:h["work type"])||m.categoryName||"Unknown Work",rs:Number((f=m.data)==null?void 0:f.Rs)||0,categoryId:m.categoryId}}),[y]),C={workType:"",workId:null,sqftRate:0,sections:[],totalArea:0,profit:0,totalCost:0},[w,M]=T.useState(()=>{const m=t==null?void 0:t.sqftRateWork;return m&&m.length>0?m:[C]}),[E,d]=T.useState((t==null?void 0:t.globalProfitPercent)||0),[a,x]=T.useState(!1),[s,i]=T.useState(null),[n,u]=T.useState({mainQuoteName:(t==null?void 0:t.mainQuoteName)||"",quoteCategory:(t==null?void 0:t.quoteCategory)||"",quoteType:(t==null?void 0:t.quoteType)||"sqft_rate",projectId:((z=t==null?void 0:t.projectId)==null?void 0:z._id)||(t==null?void 0:t.projectId)}),k=Z(w,500),v=Z(E,500);T.useEffect(()=>{if(w.filter(f=>f.workId!==null).length===0)return;(async()=>{await G(!1)})()},[k,v]);const{mutateAsync:b,isPending:R}=rt(),j=(m,h)=>{const f=m.map(S=>{var oe;const O=((oe=S.sections)==null?void 0:oe.reduce((V,$)=>V+($.totalArea||0),0))||0,H=O*(S.sqftRate||0),ae=h!==void 0?h:S.profit??E,ne=H+H*ae/100;return{...S,totalArea:O,profit:ae,totalCost:ne}});M(f)},N=m=>{d(m);const h=w.map(f=>({...f,profit:m}));j(h,m)},L=(m,h)=>{const f=[...w];f[m].profit=h,j(f)},G=async(m=!1)=>{const h=w.filter(S=>S.workId!==null),f=h.reduce((S,O)=>S+(O.totalCost||0),0);try{await b({id:B,organizationId:A,projectId:n.projectId,formData:{sqftRateWork:h,grandTotal:f,globalProfitPercent:E,notes:"Updated via frontend"}}),m&&ee({title:"Success",description:"Quote saved successfully"})}catch(S){ee({title:"Error",description:S.message,variant:"destructive"})}};return e.jsxs("div",{className:"max-h-full overflow-y-auto flex flex-col h-full bg-slate-50",children:[e.jsx("header",{className:"bg-white border-b px-6 py-4 shadow-sm sticky top-0 z-40",children:e.jsxs("div",{className:"max-w-[1600px] mx-auto flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>r(-1),className:"p-2.5 hover:bg-slate-100 text-slate-600 rounded-xl border border-slate-200 transition-colors",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h1",{className:"text-2xl font-black text-slate-900",children:t==null?void 0:t.mainQuoteName}),e.jsx("button",{onClick:()=>{u(()=>({mainQuoteName:t==null?void 0:t.mainQuoteName,quoteCategory:t==null?void 0:t.quoteCategory,quoteType:t==null?void 0:t.quoteType,projectId:t==null?void 0:t.projectId})),x(!0)},className:"p-1.5 hidden text-blue-600 hover:bg-blue-50 rounded-md transition-colors",children:e.jsx("i",{className:"fas fa-edit text-sm"})})]}),e.jsxs("p",{className:"text-[10px] text-slate-400 font-bold uppercase tracking-[0.2em]",children:["Sqft Rate Mode • ",t.quoteNo]})]})]}),e.jsxs("div",{className:"flex items-center gap-10",children:[e.jsxs("div",{className:"bg-blue-50/50 border border-blue-100 p-2 px-4 rounded-2xl flex items-center gap-3",children:[e.jsx("p",{className:"text-[10px] font-black text-blue-600 uppercase tracking-tighter",children:"Global Profit"}),e.jsxs("div",{className:"flex items-center bg-white border border-blue-200 rounded-lg px-2 shadow-sm",children:[e.jsx("input",{type:"number",className:"w-10 bg-transparent text-center font-black text-blue-700 outline-none h-8",value:E,onChange:m=>N(Math.max(0,Number(m.target.value)))}),e.jsx("span",{className:"text-blue-300 font-bold text-[10px]",children:"%"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"flex items-center justify-end gap-2 mb-1",children:R?e.jsxs("span",{className:"text-[10px] text-blue-500 animate-pulse font-bold uppercase flex items-center",children:[e.jsx("i",{className:"fas fa-sync fa-spin mr-1"})," Syncing..."]}):e.jsxs("span",{className:"text-[10px] text-slate-400 font-bold uppercase flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle mr-1 text-green-500"})," Saved"]})}),e.jsx("p",{className:"text-[10px] font-black text-slate-400 uppercase mb-0.5",children:"Grand Total Estimate"}),e.jsxs("p",{className:"text-3xl font-black text-green-600 leading-none",children:["₹",w.reduce((m,h)=>m+(h.totalCost||0),0).toLocaleString("en-IN")]})]}),e.jsx("div",{className:"flex gap-3",children:e.jsx(D,{onClick:()=>G(!0),isLoading:R,className:"bg-blue-600 hover:bg-blue-700 shadow-lg shadow-blue-100 min-w-[140px]",children:"Save Changes"})})]})]})}),e.jsx("main",{className:"flex-1 p-8 overflow-visible",children:e.jsxs("div",{className:"bg-white rounded-[2rem] shadow-sm border border-slate-200 p-8 overflow-visible max-w-[1400px] mx-auto",children:[e.jsx("div",{className:"overflow-visible",children:e.jsxs("table",{className:"w-full border-separate border-spacing-y-2",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-[11px] uppercase font-black text-slate-800 tracking-wider",children:[e.jsxs("th",{className:"text-left px-4 w-[35%]",children:["Work Type ",e.jsx("span",{className:"text-slate-900",children:"*"})]}),e.jsx("th",{className:"text-left px-4",children:"Rate/Sqft"}),e.jsx("th",{className:"text-left px-4",children:"Area (Sqft)"}),e.jsx("th",{className:"text-left px-4",children:"Profit %"}),e.jsx("th",{className:"text-right px-4",children:"Subtotal"}),e.jsx("th",{className:"w-10"})]})}),e.jsx("tbody",{children:w.map((m,h)=>e.jsxs("tr",{className:"group relative z-10 hover:z-20",children:[e.jsx("td",{className:"px-2 py-1",children:e.jsx("div",{className:"relative min-w-[280px]",children:e.jsx(Xe,{options:q.map(f=>({value:f._id,label:f.workType})),value:m.workId,onValueChange:f=>{const S=q.find(H=>H._id===f),O=[...w];O[h]={...O[h],workId:f,workType:(S==null?void 0:S.workType)||"",sqftRate:(S==null?void 0:S.rs)||0,profit:E},h===O.length-1&&f&&O.push({...C,profit:E}),j(O)}})})}),e.jsx("td",{className:"px-4 py-1",children:e.jsxs("div",{className:"flex items-center gap-1 font-bold text-slate-600",children:[e.jsx("span",{className:"text-[10px] opacity-40",children:"₹"}),m.sqftRate]})}),e.jsx("td",{className:"px-4 py-1",children:e.jsxs("button",{onClick:()=>i(h),className:"flex items-center gap-2 bg-blue-50 text-blue-700 px-3 py-2 rounded-xl border border-blue-100 hover:bg-blue-600 hover:text-white transition-all font-bold text-sm",children:[e.jsx("i",{className:"fas fa-calculator text-[10px] opacity-50"}),m.totalArea.toFixed(2)]})}),e.jsx("td",{className:"px-4 py-1",children:e.jsxs("div",{className:"relative w-20",children:[e.jsx(ce,{type:"number",className:"h-9 font-black text-center pr-6 border-slate-200 focus:border-blue-400",value:m.profit!==void 0?m.profit:"",onChange:f=>L(h,Math.max(0,Number(f.target.value)))}),e.jsx("span",{className:"absolute right-2 top-1/2 -translate-y-1/2 text-[10px] font-bold text-slate-400",children:"%"})]})}),e.jsxs("td",{className:"px-4 py-1 text-right font-black text-slate-900",children:["₹",m.totalCost.toLocaleString("en-in")]}),e.jsx("td",{className:"px-4 py-1",children:e.jsx("button",{onClick:()=>{const f=w.filter((S,O)=>O!==h);f.length===0&&f.push({workType:"",workId:null,sqftRate:0,sections:[],totalArea:0,profit:E,totalCost:0}),M(f)},className:"text-red-500 cursor-pointer transition-opacity",children:e.jsx("i",{className:"fas fa-trash-alt"})})})]},h))})]})}),e.jsx("div",{className:"flex justify-end mt-6",children:e.jsxs(D,{variant:"ghost",className:"text-blue-600 hover:bg-blue-50 font-bold border-2 border-dashed border-blue-100 rounded-xl",onClick:()=>{M([...w,{workType:"",workId:null,sqftRate:0,sections:[],totalArea:0,profit:void 0,totalCost:0}])},children:[e.jsx("i",{className:"fas fa-plus-circle mr-2"})," Add Work"]})})]})}),a&&e.jsx(Be,{isEditing:!0,formData:n,projectsData:W,setModalOpen:x,setFormData:u,handleSubmit:()=>x(!1)}),s!==null&&e.jsx(ut,{work:w[s],onClose:()=>{j(w),i(null)},onUpdate:m=>{const h=[...w];h[s].sections=m,M(h)}})]})},ut=({work:t,onClose:B,onUpdate:A})=>{const W=t.sections||[],r=()=>{A([...W,{height:0,width:0,multiplier:1,totalArea:0}])};De.useEffect(()=>{W.length===0&&A([{height:0,width:0,multiplier:1,totalArea:0}])},[]);const U=(g,y,q)=>{const C=[...W];C[g][y]=q,C[g].totalArea=C[g].height*C[g].width*(C[g].multiplier||1),g===C.length-1&&q>0&&C.push({height:0,width:0,multiplier:1,totalArea:0}),A(C)};return e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-slate-900/60 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"bg-white rounded-[2rem] w-full max-w-3xl shadow-2xl animate-in zoom-in-95 duration-200",children:[e.jsxs("div",{className:"p-8 border-b flex justify-between items-center bg-blue-600 rounded-t-[2rem]",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-black text-xl leading-none mb-1",children:"Area Measurement"}),e.jsx("p",{className:"text-blue-100 text-[10px] font-bold uppercase tracking-widest",children:t.workType||"Calculation"})]}),e.jsx("button",{onClick:B,className:"w-10 h-10 flex items-center justify-center text-white/60 hover:text-white hover:bg-white/10 rounded-full transition-all",children:e.jsx("i",{className:"fas fa-times text-xl"})})]}),e.jsxs("div",{className:"p-8 overflow-visible",children:[e.jsxs("table",{className:"w-full border-separate border-spacing-y-3",children:[e.jsx("thead",{className:"text-slate-400 text-[10px] uppercase font-black tracking-widest",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-2",children:"Height / Length"}),e.jsx("th",{className:"text-left px-2",children:"Width / Breadth"}),e.jsx("th",{className:"text-left px-2",children:"Multiplier"}),e.jsx("th",{className:"text-right px-2",children:"Total Area"}),e.jsx("th",{className:"w-10"})]})}),e.jsx("tbody",{children:W.map((g,y)=>e.jsxs("tr",{className:"group",children:[e.jsx("td",{className:"px-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(ce,{type:"number",value:g.height,onChange:q=>U(y,"height",Math.max(0,Number(q.target.value))),className:"h-11 w-full font-bold pl-8"}),e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-[10px] font-bold text-slate-300",children:"H"})]})}),e.jsx("td",{className:"px-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(ce,{type:"number",value:g.width,onChange:q=>U(y,"width",Math.max(0,Number(q.target.value))),className:"h-11 w-full font-bold pl-8"}),e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-[10px] font-bold text-slate-300",children:"W"})]})}),e.jsx("td",{className:"px-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(ce,{type:"number",value:g.multiplier,onChange:q=>U(y,"multiplier",Math.max(0,Number(q.target.value))),className:"h-11 w-full font-bold pl-8"}),e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-[10px] font-bold text-slate-300",children:"X"})]})}),e.jsxs("td",{className:"px-2 text-right",children:[e.jsx("span",{className:"text-lg font-black text-blue-600",children:g.totalArea.toFixed(2)}),e.jsx("span",{className:"text-[10px] font-bold text-slate-300 ml-1",children:"SQFT"})]}),e.jsx("td",{className:"px-2 text-right",children:e.jsx("button",{onClick:()=>A(W.filter((q,C)=>C!==y)),className:"w-8 h-8 flex items-center justify-center text-slate-300 hover:text-red-500 transition-colors",children:e.jsx("i",{className:"fas fa-trash-alt"})})})]},y))})]}),e.jsx("div",{className:"flex justify-end mt-6",children:e.jsxs(D,{variant:"outline",size:"sm",className:"border-blue-200 text-blue-600 font-bold px-4",onClick:r,children:[e.jsx("i",{className:"fas fa-plus mr-2"})," Add Measurement"]})})]}),e.jsxs("div",{className:"p-8 border-t bg-slate-50 flex justify-between items-center rounded-b-[2rem]",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"bg-white p-3 rounded-2xl border border-slate-200 shadow-sm",children:[e.jsx("p",{className:"text-[9px] font-black text-slate-400 uppercase tracking-tighter leading-none mb-1",children:"Total Square Footage"}),e.jsxs("p",{className:"text-2xl font-black text-slate-900 leading-none",children:[W.reduce((g,y)=>g+y.totalArea,0).toFixed(2)," ",e.jsx("span",{className:"text-sm font-bold text-slate-400",children:"Sqft"})]})]})}),e.jsx(D,{onClick:B,className:"bg-blue-600 hover:bg-blue-700 px-10 h-12 rounded-xl shadow-lg shadow-blue-100 font-bold",children:"Apply & Save"})]})]})})},Ct=()=>{var be,Ne,ye;const t=Qe(),{organizationId:B,id:A,quoteType:W}=Ye(),{data:r,isLoading:U,refetch:g}=st({organizationId:B,id:A}),[y,q]=T.useState(!1),{data:C=[]}=Ze(B),w=at(),[M,E]=T.useState({mainQuoteName:"",quoteCategory:"residential",quoteType:"basic",projectId:""}),d=async()=>{if(console.log("Submitting Form Data:",M),!M.mainQuoteName||!M.projectId||!M.quoteCategory)return ee({title:"Error",description:"Please fill all fields",variant:"destructive"});try{console.log("Calling API..."),await w.mutateAsync({organizationId:B,id:A,projectId:M.projectId,mainQuoteName:M.mainQuoteName,quoteCategory:M.quoteCategory,quoteType:M.quoteType}),q(!1),ee({title:"Success",description:"Updated successfully"}),g()}catch(o){ee({title:"Error",description:o.message,variant:"destructive"})}};T.useEffect(()=>{if(W==="basic"&&r!=null&&r.furnitures&&Array.isArray(r.furnitures)){const o=r.furnitures.map(l=>({...l,coreMaterials:l.coreMaterials.map(p=>({...p,innerLaminate:p.innerLaminate||{quantity:0,thickness:0},outerLaminate:p.outerLaminate||{quantity:0,thickness:0}})),totals:{core:l.coreMaterialsTotal||0,fittings:l.fittingsAndAccessoriesTotal||0,glues:l.gluesTotal||0,nbms:l.nonBrandMaterialsTotal||0,furnitureTotal:l.furnitureTotal||0}}));u(o)}},[r]);const[a,x]=T.useState(0),[s,i]=T.useState(0);T.useEffect(()=>{r&&(x((r==null?void 0:r.globalTransportation)||0),i((r==null?void 0:r.globalProfitPercent)||0),G((r==null?void 0:r.commonProfitOverride)||0))},[r]);const[n,u]=T.useState([]),[k,v]=T.useState(!1),[b,R]=T.useState(""),[j,N]=T.useState([]),[L,G]=T.useState(0);T.useEffect(()=>{r!=null&&r.commonMaterials&&N(r.commonMaterials)},[r]);const _=o=>{G(o),N(l=>l.map(p=>({...p,profitOnMaterial:0})))},z=()=>n.reduce((l,p)=>l+p.coreMaterials.length+p.fittingsAndAccessories.length+p.glues.length+p.nonBrandMaterials.length,0)+j.length,m=(o,l,p)=>{const c=[...j];c[o]={...c[o],[l]:p};const K=(Number(c[o].quantity)||0)*(Number(c[o].cost)||0),I=1+(Number(c[o].profitOnMaterial)||0)/100,P=1+s/100;c[o].rowTotal=K*I*P,o===c.length-1&&(c[o].itemName||c[o].cost)&&c.push(te()),N(c)},h=o=>{N(l=>l.filter((p,c)=>c!==o))},f=()=>e.jsx("div",{className:"overflow-x-auto rounded-md",children:e.jsxs("table",{className:"min-w-full text-sm bg-white shadow-sm",children:[e.jsx("thead",{className:"bg-blue-50 text-sm font-semibold text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Item Name"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Description"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Quantity"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Cost"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Profit %"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{children:(j.length>0?j:[te()]).map((o,l)=>{var p;return e.jsxs("tr",{className:"hover:bg-gray-50 border-b border-gray-100",children:[e.jsx("td",{className:"p-2 border-r border-gray-100",children:e.jsx("input",{value:o.itemName||"",onChange:c=>m(l,"itemName",c.target.value),className:"w-full text-center outline-none bg-transparent",placeholder:"e.g. Screws"})}),e.jsx("td",{className:"p-2 border-r border-gray-100",children:e.jsx("input",{value:o.description||"",onChange:c=>m(l,"description",c.target.value),className:"w-full text-center outline-none bg-transparent",placeholder:"details"})}),e.jsx("td",{className:"p-2 border-r border-gray-100",children:e.jsx("input",{type:"number",value:o.quantity||"",onChange:c=>m(l,"quantity",Number(c.target.value)),className:"w-full text-center outline-none bg-transparent"})}),e.jsx("td",{className:"p-2 border-r border-gray-100",children:e.jsx("input",{type:"number",value:o.cost||"",onChange:c=>m(l,"cost",Number(c.target.value)),className:"w-full text-center outline-none bg-transparent"})}),e.jsx("td",{className:"p-2 border-r border-gray-100",children:e.jsx("input",{type:"number",value:o.profitOnMaterial||"",onChange:c=>m(l,"profitOnMaterial",Number(c.target.value)),className:"w-full text-center outline-none bg-transparent",placeholder:"0"})}),e.jsxs("td",{className:"p-2 border-r border-gray-100 font-bold text-gray-700 text-center",children:["₹",(p=o.rowTotal)==null?void 0:p.toLocaleString("en-IN",{maximumFractionDigits:2})]}),e.jsx("td",{className:"p-2 text-center",children:e.jsx(D,{variant:"danger",size:"sm",onClick:()=>h(l),children:"Remove"})})]},l)})})]})}),{role:S,permission:O}=et(),H=S==="owner"||((be=O==null?void 0:O.internalquote)==null?void 0:be.create),ae=S==="owner"||((Ne=O==null?void 0:O.internalquote)==null?void 0:Ne.edit),[ne,oe]=T.useState({categoryId:"",categoryName:""});let{data:V=0}=ot({organizationId:B,categoryId:ne.categoryId}),{data:$=[]}=lt(B);T.useEffect(()=>{if($&&($==null?void 0:$.length)>0&&!ne.categoryId){const o=$[0];oe({categoryId:o._id,categoryName:o.name})}},[$]),T.useEffect(()=>{const o=z(),l=o>0?a/o:0;u(K=>K.map(I=>{if(I.coreMaterials.length===0)return I;const P=s??(I.furnitureProfit||0),X=1+P/100,se=I.coreMaterials[0],ve=(se.carpenters||0)*(se.days||0)*V*(1+(se.profitOnLabour||0)/100)/I.coreMaterials.length,J=I.coreMaterials.map(Q=>{var Le,Oe,Ie;const F=(((Le=Q.plywoodNos)==null?void 0:Le.quantity)||0)*re.plywood,Y=(((Oe=Q.innerLaminate)==null?void 0:Oe.quantity)||0)*re.innerLaminate,pe=(((Ie=Q.outerLaminate)==null?void 0:Ie.quantity)||0)*re.outerLaminate,Ke=(F+Y+pe)*(1+(Q.profitOnMaterial||0)/100);return{...Q,rowTotal:(Ke+ve)*X+l}}),me=J.reduce((Q,F)=>Q+F.rowTotal,0),we=J.length>0?me/J.length:0,ue=(Q,F=!1)=>Q.map(Y=>{if(F)return{...Y,rowTotal:we+l};const pe=F?we:(Y.quantity||0)*(Y.cost||0),qe=1+(Y.profitOnMaterial||0)/100;return{...Y,rowTotal:pe*qe*X+l}}),Me=ue(I.fittingsAndAccessories),Ce=ue(I.glues,!0),ke=ue(I.nonBrandMaterials),Te=J.reduce((Q,F)=>Q+F.rowTotal,0),Se=Me.reduce((Q,F)=>Q+F.rowTotal,0),Pe=Ce.reduce((Q,F)=>Q+F.rowTotal,0),Ae=ke.reduce((Q,F)=>Q+F.rowTotal,0);return{...I,furnitureProfit:P,coreMaterials:J,fittingsAndAccessories:Me,glues:Ce,nonBrandMaterials:ke,totals:{core:Math.round(Te),fittings:Math.round(Se),glues:Math.round(Pe),nbms:Math.round(Ae),furnitureTotal:Math.round(Te+Se+Pe+Ae)}}}));const c=1+(L??s)/100;N(K=>K.map(I=>{const P=(I.quantity||0)*(I.cost||0),X=1+(I.profitOnMaterial||0)/100;return{...I,rowTotal:P*X*c+l}}))},[a,s,V,L]);const{mutateAsync:Ee,isPending:xe}=nt(),Ge=(n==null?void 0:n.reduce((o,l)=>{var p;return o+(((p=l==null?void 0:l.totals)==null?void 0:p.furnitureTotal)||0)},0))||0,We=(j==null?void 0:j.reduce((o,l)=>o+((l==null?void 0:l.rowTotal)||0),0))||0,le=(n==null?void 0:n.length)>0?Ge+We:0,he=async(o=!0)=>{var l,p;try{const c=new FormData,K=n.map((P,X)=>{const se=P.coreMaterials.map((de,je)=>{const{previewUrl:ve,newImageFile:J,...me}=de;return J&&c.append(`images[${X}][${je}]`,J),{...me,imageUrl:de.imageUrl||null}});return{furnitureName:P.furnitureName,furnitureProfit:P.furnitureProfit,coreMaterials:se,fittingsAndAccessories:ge(P.fittingsAndAccessories),glues:ge(P.glues),nonBrandMaterials:ge(P.nonBrandMaterials),coreMaterialsTotal:P.totals.core,fittingsAndAccessoriesTotal:P.totals.fittings,gluesTotal:P.totals.glues,nonBrandMaterialsTotal:P.totals.nbms,furnitureTotal:P.totals.furnitureTotal}}),I=j.filter(P=>P.itemName||P.cost>0);c.append("furnitures",JSON.stringify(K)),c.append("commonMaterials",JSON.stringify(I)),c.append("commonProfitOverride",L.toString()),c.append("grandTotal",le.toString()),c.append("notes","Updated via frontend"),c.append("globalTransportation",a.toString()),c.append("globalProfitPercent",s.toString()),await Ee({organizationId:B,projectId:r.projectId,formData:c,id:A}),o&&ee({title:"Updated!",description:"Quote edited successfully."})}catch(c){ee({title:"Error",description:((p=(l=c==null?void 0:c.response)==null?void 0:l.data)==null?void 0:p.message)||(c==null?void 0:c.message)||"Failed to Update the Quote",variant:"destructive"})}},Ue=Z(n,700),Fe=Z(j,700),_e=Z(a,700),ze=Z(s,700),Ve=Z(L,700);T.useEffect(()=>{if(!(r!=null&&r.projectId)||n.length===0)return;(async()=>{console.log("Auto-saving quote..."),await he(!1)})()},[Ue,Fe,_e,ze,Ve]);const fe=o=>{u(l=>[...l,{furnitureName:o,coreMaterials:[He()],fittingsAndAccessories:[te()],glues:[te()],nonBrandMaterials:[te()],totals:{core:0,fittings:0,glues:0,nbms:0,furnitureTotal:0}}])},$e=o=>{u(l=>l.filter((p,c)=>c!==o))},Je=o=>{const l=JSON.parse(JSON.stringify(n[o])),p=[...n];p.splice(o+1,0,l),u(p)},He=()=>({itemName:"",plywoodNos:{quantity:0,thickness:0},innerLaminate:{quantity:0,thickness:0},outerLaminate:{quantity:0,thickness:0},carpenters:0,days:0,profitOnMaterial:0,profitOnLabour:0,rowTotal:0,remarks:""}),te=()=>({itemName:"",description:"",quantity:0,cost:0,rowTotal:0});return U?e.jsx(tt,{}):e.jsxs(e.Fragment,{children:[(r==null?void 0:r.quoteType)==="sqft_rate"?e.jsx(mt,{data:r,id:A,organizationId:B,projectData:C}):e.jsxs("div",{className:"max-h-full overflow-y-auto",children:[e.jsxs("header",{className:"flex sticky top-0 z-50 !bg-white flex-col md:flex-row md:items-center md:justify-between gap-4 py-1 border-b-1 border-[#818283]",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>t(-1),className:"p-2.5 hover:bg-slate-100 text-slate-600 rounded-xl border border-slate-200 transition-colors",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h1",{className:"text-2xl font-black text-slate-900",children:r==null?void 0:r.mainQuoteName}),e.jsx("button",{onClick:()=>{E(()=>({mainQuoteName:r==null?void 0:r.mainQuoteName,quoteCategory:r==null?void 0:r.quoteCategory,quoteType:r==null?void 0:r.quoteType,projectId:r==null?void 0:r.projectId})),q(!0)},className:"p-1.5 text-blue-600 hover:bg-blue-50 rounded-md transition-colors",children:e.jsx("i",{className:"fas fa-edit text-sm"})})]}),e.jsx("div",{children:e.jsx("p",{className:"text-[10px] text-slate-400 font-bold uppercase tracking-[0.2em]",children:((ye=r==null?void 0:r.projectId)==null?void 0:ye.projectName)||"Project"})}),e.jsxs("p",{className:"text-[10px] text-slate-400 font-bold uppercase tracking-[0.2em]",children:["Basic Quote • ",r==null?void 0:r.quoteNo]})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-6",children:[xe&&e.jsxs("span",{className:"text-[10px] text-blue-500 animate-pulse font-bold uppercase",children:[e.jsx("i",{className:"fas fa-sync fa-spin mr-1"})," Auto-saving..."]}),!xe&&e.jsxs("span",{className:"text-[10px] text-gray-400 font-bold uppercase",children:[e.jsx("i",{className:"fas fa-check-circle mr-1"})," All changes saved"]}),(n==null?void 0:n.length)>0&&e.jsxs("div",{className:"flex items-center gap-10",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 tracking-wide",children:"Single Labour Cost"}),e.jsxs("p",{className:"text-[15px] font-semibold text-gray-900",children:["₹",V==null?void 0:V.toLocaleString("en-IN")]})]}),e.jsx("div",{className:"h-8 w-px bg-gray-300"}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-widest",children:"Grand Total"}),e.jsxs("p",{className:"text-xl font-bold text-green-600",children:["₹",le==null?void 0:le.toLocaleString("en-IN")]})]})]}),H&&e.jsxs(D,{className:"flex items-center",onClick:()=>v(!0),children:[e.jsx("i",{className:"fas fa-add mr-1"}),"Create Product"]})]})]}),k&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 bg-opacity-40 backdrop-blur-sm transition",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg p-6 w-full max-w-md relative animate-scaleIn",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-800",children:"Add New Quote"}),e.jsx("input",{className:"w-full border border-gray-300 rounded px-3 py-2 mb-4 outline-none focus:ring-2 focus:ring-blue-400",placeholder:"Enter Product Name",value:b,autoFocus:!0,onChange:o=>R(o.target.value),onKeyDown:o=>{if(o.key==="Enter"){if(!b.trim())return;fe(b),R(""),v(!1)}}}),e.jsxs("div",{className:"flex justify-end gap-3 mt-4",children:[e.jsx(D,{variant:"secondary",onClick:()=>v(!1),children:"Cancel"}),e.jsx(D,{onClick:()=>{b.trim()&&(fe(b),R(""),v(!1))},children:"Create"})]})]})}),(n==null?void 0:n.length)===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[300px] w-full bg-white rounded-xl   text-center p-6",children:[e.jsx("i",{className:"fas fa-box-open text-5xl text-blue-300 mb-4"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Cick on the Create button to start creating the quote",e.jsx("br",{}),e.jsxs(D,{onClick:()=>v(!0),className:"mx-4 my-2",children:[e.jsx("i",{className:"fas fa-plus mr-1 "}),"Create Product"]})]})]}),(n==null?void 0:n.length)>0&&e.jsx("section",{className:"shadow overflow-y-auto max-h-[86%]",children:n==null?void 0:n.map((o,l)=>e.jsx(dt,{index:l,labourCost:V,data:o,duplicateFurniture:()=>Je(l),updateFurniture:p=>{const c=[...n];c[l]={...p},u(c)},removeFurniture:()=>$e(l),isEditing:!0},l))}),n.length>0&&e.jsxs("div",{className:"bg-gray-50 p-6 rounded-xl border border-gray-200 mt-8 mb-6 shadow-inner",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-800 flex items-center",children:[e.jsx("i",{className:"fas fa-boxes mr-3 text-orange-500"}),"General/Common Site Materials - Total: ₹",j.reduce((o,l)=>o+(l.rowTotal||0),0).toLocaleString("en-IN",{maximumFractionDigits:2})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-orange-50 px-3 py-1 rounded-lg border border-orange-100 shadow-sm",children:[e.jsx("label",{className:"text-[11px] font-bold text-orange-600 uppercase tracking-tight",children:"Common Profit Overlay"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"number",className:"w-12 text-right font-bold bg-transparent outline-none text-orange-800",value:L??s,placeholder:"0",onKeyDown:o=>{(o.key==="-"||o.key==="e")&&o.preventDefault()},onChange:o=>{const l=o.target.value===""?0:parseFloat(o.target.value);_(l)}}),e.jsx("span",{className:"text-orange-600 font-bold ml-1 text-sm",children:"%"})]})]}),e.jsxs("div",{className:"text-right text-xl text-green-700 font-bold",children:["Total: ₹",j.reduce((o,l)=>o+(l.rowTotal||0),0).toLocaleString("en-IN",{maximumFractionDigits:2})]})]})]}),f(),e.jsx("div",{className:"mt-3 text-right",children:e.jsx(D,{onClick:()=>N([...j,te()]),variant:"secondary",size:"sm",children:"+ Add Common Item"})})]}),n.length!==0&&e.jsxs("div",{className:"flex items-center justify-between gap-4 bg-white border border-blue-100 p-3 rounded-xl shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-[9px] font-extrabold text-blue-500 uppercase tracking-tighter",children:"Transport Cost"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-gray-400 mr-1 text-sm",children:"₹"}),e.jsx("input",{type:"number",className:"w-20 font-semibold focus:outline-none text-gray-800",value:a,onChange:o=>x(Math.max(0,Number(o.target.value)))})]})]}),e.jsx("div",{className:"h-8 w-px bg-gray-100"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-[9px] font-extrabold text-green-500 uppercase tracking-tighter",children:"Global Profit Margin"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"number",className:"w-12 text-right font-semibold focus:outline-none text-gray-800",value:s,onChange:o=>{i(Math.max(0,Number(o.target.value))),G(Math.max(0,Number(o.target.value))),u(l=>l.map(p=>({...p,furnitureProfit:0,coreMaterials:p.coreMaterials.map(c=>({...c,profitOnMaterial:0,profitOnLabour:0})),fittingsAndAccessories:p.fittingsAndAccessories.map(c=>({...c,profitOnMaterial:0})),nonBrandMaterials:p.nonBrandMaterials.map(c=>({...c,profitOnMaterial:0}))}))),N(l=>l.map(p=>({...p,profitOnMaterial:0})))}}),e.jsx("span",{className:"text-gray-400 ml-1 text-sm",children:"%"})]})]})]}),e.jsx("div",{className:"mt-1 text-right flex gap-2 justify-end",children:(H||ae)&&e.jsx(D,{variant:"primary",isLoading:xe,onClick:()=>he(!0),className:"px-6 py-2 bg-blue-600 text-white rounded",children:"Save Quote"})})]})]}),y&&e.jsx(Be,{isEditing:!0,formData:M,projectsData:C,setModalOpen:q,setFormData:E,handleSubmit:d})]})};export{Ct as default};
