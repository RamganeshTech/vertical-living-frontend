import{r as w,j as e,B as u,i as W,c as _,d as G,f as Y,M as q,O as V,C as I,L as H,t as c}from"./index-DXj62qt7.js";import{a as J,b as K,c as Q,d as X,u as Z,e as $,f as ee}from"./sampleDesignApi-C6L2OeXu.js";import{A as se,S as te}from"./AssignStaff-DbZ4NCmL.js";import{I as ae}from"./ImageGalleryMain-BUYOB0HH.js";import{R as le}from"./ResetStageButton-XnuHVNH0.js";import{S as ie}from"./ShareDocumentWhatsapp-DojDIFuX.js";import"./getAllUsersApi-DD9iSPWA.js";import"./constants-Btil2AS0.js";import"./documentationApi-Ce4UTRDS.js";import"./requirementFormApi-GXr4_YSH.js";const de=({isOpen:l,onClose:h,onSubmit:f,addPending:j})=>{const[b,g]=w.useState(""),p=async o=>{o.preventDefault(),await f(b),g(""),h()};return l?e.jsx("div",{onClick:h,className:"fixed inset-0 bg-black/70 bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{onClick:o=>o.stopPropagation(),className:"bg-white rounded-lg p-6 w-[80%] sm:w-[60%] lg:w-full max-w-md",children:[e.jsx("h2",{className:"text-2xl font-bold text-blue-700 mb-4",children:"Add New Room"}),e.jsxs("form",{onSubmit:p,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 mb-2",children:"Room Name"}),e.jsx("input",{type:"text",value:b,onChange:o=>g(o.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{type:"button",onClick:h,className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"Cancel"}),e.jsx(u,{isLoading:j,type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Add Room"})]})]})]})}):null},ne=({files:l,onUpload:h,onDelete:f,uploadPending:j,deletePending:b})=>{const g=w.useRef(null),[p,o]=w.useState([]),y=l.filter(t=>t.type==="pdf"),v=l.filter(t=>t.type==="image"),[N,S]=w.useState(null),F=t=>{var m;(m=t.target.files)!=null&&m.length&&o(Array.from(t.target.files))},s=async()=>{p.length!==0&&await h(p)};return e.jsxs("div",{className:"bg-white h-auto rounded-lg p-2 sm:p-6",children:[e.jsx("div",{className:"flex items-center gap-4 mb-6",children:e.jsxs("div",{className:"w-full space-x-2",children:[e.jsx("input",{id:"fileInput",ref:g,type:"file",accept:".pdf,image/*",multiple:!0,className:"mb-1 sm:mb-0 w-[55%] sm:w-[80%] h-full py-2 border-1 px-2 rounded-lg",onChange:F}),e.jsxs(u,{variant:"primary",onClick:()=>{var t;return(t=g.current)==null?void 0:t.click()},className:"",children:[e.jsx("span",{className:"hidden sm:block",children:" Select Files"}),e.jsx("span",{className:"block sm:hidden",children:" Select"})]}),e.jsx(u,{isLoading:j,onClick:s,className:"px-2 sm:px-4 py-2 rounded-lg",variant:"primary",children:"upload"})]})}),e.jsxs("div",{className:"grid h-auto grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 text-blue-700",children:[e.jsx("i",{className:"fas fa-file-pdf text-lg"}),e.jsx("h3",{className:"font-medium",children:"PDF Files"})]}),e.jsx("div",{className:"max-h-[300px] overflow-y-auto custom-scrollbar max-w-[100%] overflow-x-hidden",children:y.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No PDF files uploaded"}):e.jsx("div",{className:"space-y-2 max-w-[100%]",children:y.map((t,m)=>e.jsxs("div",{className:"flex items-center max-w-full justify-between py-2 px-3 bg-green-50 rounded-lg hover:bg-green-100 transition-colors",children:[e.jsx("span",{className:"text-gray-700 truncate whitespace-wrap max-w-[100%] flex-1 ",children:t.originalName||"Unnamed PDF"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{onClick:()=>W({src:t==null?void 0:t.url,alt:(t==null?void 0:t.originalName)||"file.pdf"}),size:"sm",className:"text-sm",children:e.jsx("i",{className:"fa-solid fa-download"})}),e.jsx(u,{size:"sm",isLoading:b,onClick:()=>f(t._id),title:"Delete",children:e.jsx("i",{className:"fas fa-trash"})})]})]},m))})})]}),e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 text-blue-700",children:[e.jsx("i",{className:"fas fa-images text-lg"}),e.jsx("h3",{className:"font-medium",children:"Image Files"})]}),e.jsx("div",{className:"max-h-[300px] overflow-y-auto custom-scrollbar max-w-[100%] overflow-x-hidden",children:v.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No image files uploaded"}):e.jsx(ae,{imageFiles:v,handleDeleteFile:f,height:80,minWidth:98,maxWidth:100})})]})]}),N&&e.jsx("div",{onClick:()=>S(null),className:"fixed inset-0 bg-black/70 z-50 p-8 bg-opacity-60 flex items-center justify-center",children:e.jsxs("div",{onClick:t=>t.stopPropagation(),className:"relative bg-white rounded py-8 px-4 max-w-[90vw] max-h-[80vh] shadow-lg",children:[e.jsx("i",{className:"fas fa-times absolute top-2 right-3 text-xl text-gray-700 hover:text-red-500 cursor-pointer",onClick:()=>S(null)}),e.jsx("img",{src:N,alt:"Full View",className:"max-h-[70vh] w-auto object-contain rounded"})]})})]})},je=()=>{var R,k,A,P,L;const{projectId:l,organizationId:h}=_(),{isMobile:f,openMobileSidebar:j}=G(),b=Y();if(!l)return null;const[g,p]=w.useState(!1),o=J(),{mutateAsync:y,isPending:v}=K(),N=Q(),{mutateAsync:S,isPending:F}=X(),{data:s,isLoading:t,refetch:m,error:x}=Z(l),{mutateAsync:M,isPending:C}=$(),{mutateAsync:D,isPending:E}=ee(),O=async()=>{var a,i;try{C||(await M({projectId:l}),b("../workmainschedule")),c({description:"Completion status updated successfully",title:"Success"})}catch(d){c({title:"Error",description:((i=(a=d==null?void 0:d.response)==null?void 0:a.data)==null?void 0:i.message)||"Failed to update completion status",variant:"destructive"})}},U=async a=>{var i,d;try{await o.mutateAsync({projectId:l,roomName:a}),c({description:"Room Created successfully",title:"Success"})}catch(n){c({title:"Error",description:((d=(i=n==null?void 0:n.response)==null?void 0:i.data)==null?void 0:d.message)||"Failed to create room status",variant:"destructive"})}},z=async a=>{var i,d;try{C||await S({projectId:l,roomId:a}),c({description:"Room section Deleted successfully",title:"Success"})}catch(n){c({title:"Error",description:((d=(i=n==null?void 0:n.response)==null?void 0:i.data)==null?void 0:d.message)||"Failed to delete the room",variant:"destructive"})}},B=async(a,i)=>{var d,n;try{await y({projectId:l,roomName:a,files:i}),c({description:"File uploaded successfully",title:"Success"}),m()}catch(r){c({title:"Error",description:((n=(d=r==null?void 0:r.response)==null?void 0:d.data)==null?void 0:n.message)||(r==null?void 0:r.message)||" Failed to upload the files",variant:"destructive"})}},T=async(a,i)=>{var d,n;try{await N.mutateAsync({projectId:l,roomName:a,fileId:i}),c({description:"File deleted successfully",title:"Success"}),m()}catch(r){c({title:"Error",description:((n=(d=r==null?void 0:r.response)==null?void 0:d.data)==null?void 0:n.message)||"Failed to delete the files",variant:"destructive"})}};return t?e.jsx(q,{}):location.pathname.includes("shortlist")?e.jsx(V,{}):e.jsxs("div",{className:"container mx-auto max-h-full overflow-y-auto max-w-full min-h-full",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4 mb-6",children:[e.jsxs("h2",{className:"text-2xl sm:text-2xl lg:text-2xl xl:text-3xl font-semibold text-blue-600 flex items-center",children:[f&&e.jsx("button",{onClick:j,className:"mr-3 p-2 rounded-md  border-gray-300 hover:bg-gray-100",title:"Open Menu",children:e.jsx("i",{className:"fa-solid fa-bars"})}),e.jsx("i",{className:"fa-solid fa-object-group mr-2"}),"Sample Design Files"]}),e.jsxs("div",{className:"!w-[100%] sm:!w-[100%] lg:!w-[50%] xl:!w-[65%] flex flex-col sm:flex-row gap-3 justify-end",children:[e.jsxs("div",{className:"flex  flex-wrap md:flex-nowrap gap-2 justify-end",children:[e.jsxs(u,{onClick:()=>p(!0),className:"bg-blue-600 hover:bg-blue-700 text-white flex-1 sm:flex-initial min-w-max",disabled:!!x,children:[e.jsx("i",{className:"fas fa-plus mr-2"}),e.jsx("span",{className:"",children:"Add room"})]}),e.jsxs(u,{isLoading:C,onClick:O,className:"bg-green-600 hover:bg-green-700 text-white flex-1 sm:flex-initial min-w-max",disabled:!!x,children:[e.jsx("i",{className:"fa-solid fa-circle-check mr-2"}),"Mark Complete"]})]}),e.jsxs("div",{className:"flex flex-wrap md:flex-nowrap gap-2 justify-end",children:[e.jsx(le,{projectId:l,stageNumber:3,stagePath:"sampledesign",className:"flex-1 sm:flex-initial min-w-max",disabled:!!x}),!x&&e.jsx(ie,{projectId:l,stageNumber:"3",className:"w-full sm:w-fit",isStageCompleted:s==null?void 0:s.status}),e.jsx(se,{stageName:"SampleDesignModel",projectId:l,organizationId:h,currentAssignedStaff:(s==null?void 0:s.assignedTo)||null,className:"flex-1 sm:flex-initial min-w-max"})]})]})]}),x&&e.jsxs("div",{className:"max-w-xl mx-auto p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center mb-6",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2",children:"⚠️ Error Occurred"}),e.jsx("p",{className:"text-red-500 text-sm mb-4",children:((k=(R=x==null?void 0:x.response)==null?void 0:R.data)==null?void 0:k.message)||"Failed to load data"}),e.jsx(u,{onClick:()=>m(),className:"bg-red-600 text-white px-4 py-2",children:"Retry"})]}),!x&&e.jsxs(e.Fragment,{children:[e.jsxs(I,{className:"p-4 mb-6 w-full shadow border-l-4 border-blue-600 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-3 text-blue-700 text-sm font-medium mb-2",children:[e.jsx("i",{className:"fa-solid fa-clock text-blue-500 text-lg"}),e.jsx("span",{children:"Stage Timings"})]}),e.jsx(te,{stageName:"sampledesign",completedAt:(A=s==null?void 0:s.timer)==null?void 0:A.compltedAt,formId:s==null?void 0:s._id,projectId:l,deadLine:(P=s==null?void 0:s.timer)==null?void 0:P.deadLine,startedAt:(L=s==null?void 0:s.timer)==null?void 0:L.startedAt,refetchStageMutate:m,deadLineMutate:D,isPending:E})]}),e.jsx(I,{className:"mb-6  text-blue-600 border-l-4 border-1 border-blue-600",children:e.jsx(H,{to:"shortlist",children:e.jsxs("div",{className:"py-4 ml-2 flex justify-between items-center",children:[e.jsx("p",{className:"text-md sm:text-xl",children:"Sample Reference Designs"}),e.jsx("i",{className:"mr-4 fas fa-arrow-right text-blue-600"})]})})}),!(s!=null&&s.rooms)||s.rooms.length===0?e.jsxs("div",{className:"text-center py-10 sm:py-16 bg-white rounded-lg shadow-sm",children:[e.jsx("i",{className:"fas fa-home text-blue-200 text-5xl sm:text-6xl mb-4"}),e.jsx("h2",{className:"text-xl sm:text-2xl font-semibold text-gray-700 mb-2",children:"No Rooms Added Yet"}),e.jsx("p",{className:"text-gray-500 mb-6 max-w-md mx-auto",children:"Start by adding a room to upload design files"}),e.jsxs("button",{onClick:()=>p(!0),className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 min-w-[200px]",children:[e.jsx("i",{className:"fas fa-plus mr-2"}),"Add Your First Room"]})]}):e.jsx("div",{className:"grid grid-cols-1  gap-6",children:s.rooms.map(a=>e.jsxs("div",{className:"bg-white border-l-4 border-blue-600 rounded-xl shadow-sm p-1 sm:p-6 flex flex-col",children:[e.jsxs("div",{className:"flex sm:flex-row items-center justify-between gap-3 mb-4",children:[e.jsxs("h2",{className:"text-xl font-semibold text-blue-700 truncate",children:[e.jsx("i",{className:"fas fa-door-open mr-2"}),a.roomName]}),e.jsxs(u,{isLoading:F,onClick:()=>z(a._id),variant:"danger",className:"bg-red-600 text-white  sm:w-auto mt-2 sm:mt-0",children:[e.jsx("i",{className:"fa-solid fa-trash mr-2"}),"Delete"]})]}),e.jsx("div",{className:"flex-grow",children:e.jsx(ne,{files:a.files,onUpload:i=>B(a.roomName,i),onDelete:i=>T(a.roomName,i),uploadPending:v,deletePending:N.isPending})})]},a.roomName))})]}),e.jsx(de,{isOpen:g,onClose:()=>p(!1),onSubmit:U,addPending:o.isPending})]})};export{je as default};
