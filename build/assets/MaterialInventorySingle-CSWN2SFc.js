import{r as f,j as e,b as oe,c as ce}from"./index-ImEMNTCY.js";import{B as p}from"./Button-DA5f_eiE.js";import{t as j}from"./toast-BSC5QTk1.js";import{d as ne,b as de}from"./materialInventoryApi-DhFggyUG.js";import me from"./MaterialOverviewLoading-BsiFWndK.js";import{u as xe}from"./projectApi-Cpm6t89K.js";import{u as fe,a as ge,b as he,c as pe}from"./MaterialInventoryCartApi-D2nikElU.js";import{S as ue}from"./SearchSelectNew-lRJMa0Wi.js";import{C as U,c as W,a as be,b as ve,d as je}from"./Card-CVBrouUH.js";import{L as P}from"./Label-Cji2EFXP.js";import{I as Ne}from"./Input-BgP4Xp1N.js";import{N as ye}from"./constants-Dsaf8__L.js";import{B}from"./Badge-C9khFJHV.js";import"./roleCheck-CTzQsMpA.js";import"./useQuery-C1eLZ9CZ.js";import"./useMutation-Dbtyr3lY.js";import"./useInfiniteQuery-vrH4x_Ex.js";import"./Skeleton-CsHeHv79.js";const Ce=({navigate:c,data:l,editMode:N,projectOptions:d,selectedProjectId:y,handleSelectProjectId:r,handleCancel:u,handleSave:C,updateMutation:w,handleEdit:n})=>{var b,g;return e.jsx("div",{children:e.jsxs("header",{className:"mb-4 flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("div",{onClick:()=>c(-1),className:"bg-white hover:bg-slate-300 flex items-center justify-between w-8 h-8 border border-[#a6aab8] text-sm cursor-pointer rounded-md px-2",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold bg-gradient-to-r from-violet-600 to-blue-600 bg-clip-text text-transparent",children:((b=l==null?void 0:l.specification)==null?void 0:b.subcategory)||((g=l==null?void 0:l.specification)==null?void 0:g.type)||"Material Details"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"View and manage material inventory information"})]})]}),e.jsx("div",{className:"flex gap-3",children:N?e.jsxs(e.Fragment,{children:[e.jsxs(p,{onClick:u,variant:"outline",className:"border-2 border-gray-300 hover:bg-gray-50",children:[e.jsx("i",{className:"fas fa-times mr-2"}),"Cancel"]}),e.jsx(p,{onClick:C,disabled:w.isPending,className:"bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white shadow-lg",children:w.isPending?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin mr-2"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-save mr-2"}),"Save Changes"]})})]}):e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-full sm:w-64",children:e.jsx(ue,{options:d,placeholder:"Select project",searchPlaceholder:"Search projects...",value:y||void 0,onValueChange:S=>r(S||""),searchBy:"name",displayFormat:"simple",className:"w-full"})}),e.jsxs(p,{onClick:n,className:"bg-gradient-to-r from-violet-600 to-blue-600 hover:from-violet-700 hover:to-blue-700 text-white shadow-lg",children:[e.jsx("i",{className:"fas fa-edit mr-2"}),"Edit Details"]})]})})]})})},we=f.memo(Ce),ke=({displayValues:c,form:l,editMode:N,selectedVariant:d,handleVariantSelect:y,handleChange:r,handleEdit:u,editableFields:C,hasVariants:w,handleAddToCart:n,handleUpdateCartQuantity:b,handleRemoveFromCart:g,cartQuantity:S,isInCart:t,selectedProjectId:L,addToCartMutation:I,updateCartQuantityMutation:A,removeFromCartMutation:m,projects:v})=>{var k,E,F;return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsx(U,{className:"overflow-hidden border-2 border-violet-100 shadow-xl hover:shadow-2xl transition-shadow duration-300",children:e.jsxs(W,{className:"p-0",children:[c!=null&&c.image?e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:c.image,alt:c.itemCode||"Material",className:"w-full h-auto object-cover rounded-t-xl",onError:s=>{s.target.src=ye}}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/50 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 rounded-t-xl"})]}):e.jsx("div",{className:"bg-gradient-to-br from-violet-100 to-blue-100 h-80 flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-violet-300",children:[e.jsx("i",{className:"fas fa-image text-6xl mb-3"}),e.jsx("p",{className:"text-sm",children:"No Image Available"})]})}),w&&e.jsxs("div",{className:"p-4 bg-white border-b",children:[e.jsx(P,{className:"text-sm text-gray-600 mb-2 block",children:"Select Color Variant"}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:(k=l.variants)==null?void 0:k.map((s,x)=>e.jsx("button",{onClick:()=>y(s),className:`px-3 py-2 rounded-lg border-2 transition-all ${(d==null?void 0:d.color)===s.color?"border-violet-500 bg-violet-50 text-violet-700":"border-gray-300 hover:border-violet-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full border border-gray-300",style:{backgroundColor:s.color.toLowerCase()==="white"?"#ffffff":s.color.toLowerCase()==="gold"?"#FFD700":s.color.toLowerCase()==="grey"?"#808080":s.color}}),e.jsx("span",{className:"capitalize text-sm",children:s.color})]})},x))})]}),e.jsx("div",{className:"p-6 bg-gradient-to-br from-violet-50 to-blue-50",children:e.jsxs("div",{className:"space-y-4",children:[c.mrp&&e.jsx("div",{children:e.jsxs("p",{className:"text-2xl font-bold text-gray-900 mb-3",children:["₹",c.mrp,e.jsx("span",{className:"text-xs font-normal text-gray-500 ml-2",children:"MRP"})]})}),e.jsxs("div",{className:"space-y-2 text-sm",children:[(l==null?void 0:l.category)&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(P,{className:"text-gray-500",children:"Category"}),e.jsx(B,{variant:"default",children:l.category})]}),c.itemCode&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(P,{className:"text-gray-500",children:"Code"}),e.jsx(B,{variant:"success",className:"font-mono",children:c.itemCode})]}),c.color&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(P,{className:"text-gray-500",children:"Color"}),e.jsx(B,{variant:"outline",className:"capitalize",children:c.color})]})]}),e.jsxs("div",{className:"pt-4 border-t border-violet-200",children:[t?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between bg-white rounded-lg p-2",children:[e.jsx(p,{size:"sm",variant:"outline",onClick:()=>b(-1),disabled:A.isPending||m.isPending,className:"h-8 w-8 p-0",children:e.jsx("i",{className:"fas fa-minus"})}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Quantity"}),e.jsx("span",{className:"font-bold text-lg",children:S})]}),e.jsx(p,{size:"sm",variant:"outline",onClick:()=>b(1),disabled:A.isPending,className:"h-8 w-8 p-0",children:e.jsx("i",{className:"fas fa-plus"})})]}),e.jsxs(p,{variant:"danger",size:"sm",className:"w-full bg-red-600 text-white",onClick:g,isLoading:m.isPending,children:[e.jsx("i",{className:"fas fa-trash mr-2"}),"Remove from Cart"]})]}):e.jsxs(p,{className:"w-full bg-gradient-to-r from-violet-600 to-blue-600 hover:from-violet-700 hover:to-blue-700 text-white",onClick:n,disabled:!L,isLoading:I.isPending,children:[e.jsx("i",{className:"fas fa-shopping-cart mr-2"}),"Add to Cart"]}),t&&e.jsx("div",{className:"mt-3 p-2 bg-green-50 rounded-lg",children:e.jsxs("p",{className:"text-xs text-green-700 text-center",children:[e.jsx("i",{className:"fas fa-check-circle mr-1"}),"Item in cart for ",(E=v==null?void 0:v.find(s=>s._id===L))==null?void 0:E.projectName]})})]})]})})]})})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(U,{className:"border-2 border-violet-100 shadow-xl",children:[e.jsxs(be,{className:"bg-gradient-to-r from-violet-50 to-blue-50 border-b-2 border-violet-100",children:[e.jsxs(ve,{className:"text-2xl text-violet-700 flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-info-circle"}),"Specifications"]}),e.jsx(je,{children:N?"Edit material specifications below":"Detailed material information"})]}),e.jsxs(W,{className:"p-6",children:[N?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:C.map(s=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs(P,{htmlFor:s.key,className:"flex items-center gap-2 text-violet-700",children:[e.jsx("i",{className:`fas ${s.icon} text-sm`}),s.label]}),e.jsx(Ne,{id:s.key,name:s.key,type:s.type,value:l[s.key]||"",onChange:r,placeholder:`Enter ${s.label.toLowerCase()}`,className:"transition-all duration-200 hover:border-violet-300"})]},s.key))}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:C.map(s=>{if(s.key==="Variant")return null;const x=l[s==null?void 0:s.key];return x?e.jsx("div",{className:"bg-gradient-to-br from-white to-violet-50 p-4 rounded-xl border border-violet-100 hover:shadow-md transition-all duration-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-violet-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx("i",{className:`fas ${s.icon} text-violet-600`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wider mb-1",children:s.label}),e.jsx("p",{className:"text-gray-900 font-semibold truncate",children:s.key==="mrp"?`₹${x}`:s.key==="watt"?`${x}W`:x})]})]})},s.key):null})}),!N&&w&&e.jsxs("div",{className:"mt-8 pt-6 border-t-2 border-violet-100",children:[e.jsxs("h3",{className:"text-lg font-semibold text-violet-700 mb-4 flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-palette"}),"Available Variants"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:(F=l.variants)==null?void 0:F.map((s,x)=>e.jsxs("div",{className:`p-4 rounded-xl border-2 cursor-pointer transition-all ${(d==null?void 0:d.color)===s.color?"border-violet-500 bg-violet-50":"border-gray-200 hover:border-violet-300"}`,onClick:()=>y(s),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full border-2 border-gray-300",style:{backgroundColor:s.color.toLowerCase()==="white"?"#ffffff":s.color.toLowerCase()==="gold"?"#FFD700":s.color.toLowerCase()==="grey"?"#808080":s.color}}),e.jsx("span",{className:"font-semibold capitalize",children:s.color})]}),(d==null?void 0:d.color)===s.color&&e.jsx("i",{className:"fas fa-check-circle text-violet-600"})]}),e.jsx("p",{className:"text-sm text-gray-600 font-mono",children:s.itemCode}),e.jsxs("p",{className:"text-lg font-bold text-gray-900 mt-1",children:["₹",s.mrp]})]},x))})]}),!N&&Object.keys(l).filter(s=>s!=="image"&&s!=="variants").length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-20 h-20 bg-violet-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("i",{className:"fas fa-inbox text-3xl text-violet-400"})}),e.jsx("p",{className:"text-gray-500",children:"No specifications available"}),e.jsxs(p,{onClick:u,className:"mt-4 bg-violet-600 hover:bg-violet-700 text-white",children:[e.jsx("i",{className:"fas fa-plus mr-2"}),"Add Specifications"]})]})]})]})})]})},De=()=>{var O;const{organizationId:c,id:l}=oe(),N=ce(),[d,y]=f.useState(!1),[r,u]=f.useState({}),[C,w]=f.useState(null),[n,b]=f.useState(null),[g,S]=f.useState(""),{data:t,isLoading:L,error:I,isError:A}=ne(l),{data:m,refetch:v}=fe({organizationId:c,projectId:g}),k=de(),E=ge(),F=he(),s=pe();f.useEffect(()=>{var a,i;t!=null&&t.specification&&(u(t==null?void 0:t.specification),(a=t==null?void 0:t.specification)!=null&&a.variants&&((i=t==null?void 0:t.specification)==null?void 0:i.variants.length)>0&&b(t.specification.variants[0]))},[t]);const{data:x}=xe(c),M=x==null?void 0:x.map(a=>({_id:a._id,projectName:a.projectName})),J=f.useMemo(()=>{var a;return(a=x||[])==null?void 0:a.map(i=>({value:i._id,label:i.projectName}))},[x]);f.useEffect(()=>{M&&M.length>0&&!g&&S(M[0]._id)},[M,g]),f.useEffect(()=>{var a,i;t!=null&&t.specification&&(u(t==null?void 0:t.specification),(a=t==null?void 0:t.specification)!=null&&a.variants&&((i=t==null?void 0:t.specification)==null?void 0:i.variants.length)>0&&b(t.specification.variants[0]))},[t]);const $=f.useCallback(()=>{y(!0),t!=null&&t.specification&&u({...t.specification})},[t]),z=f.useCallback(()=>{y(!1),t!=null&&t.specification&&u({...t.specification})},[t]),K=a=>{u(i=>({...i,[a.target.name]:a.target.value}))},X=f.useCallback(a=>{S(a||"")},[]),R=f.useCallback(async()=>{var a,i;try{if(!l||!r)return;await k.mutateAsync({id:l,specification:r}),j({title:"✓ Updated",description:"Material inventory updated successfully",variant:"default"}),y(!1),v()}catch(o){j({title:"Error",description:((i=(a=o==null?void 0:o.response)==null?void 0:a.data)==null?void 0:i.message)||(o==null?void 0:o.message)||"something has went wrong",variant:"destructive"})}},[l,r,k,v]),Y=a=>{b(a)},Z=()=>n?{image:n.image,mrp:n.mrp,itemCode:n.itemCode,color:n.color}:{image:r==null?void 0:r.image,mrp:r==null?void 0:r.mrp,itemCode:r==null?void 0:r.itemCode,color:null},T=()=>n?n.itemCode:(r==null?void 0:r.itemCode)||"",H=a=>!(m!=null&&m.items)||!a?null:m.items.find(i=>{var o;return((o=i==null?void 0:i.specification)==null?void 0:o.itemCode)===a}),V=()=>{const a=T(),i=H(a);return i?i==null?void 0:i.quantity:0},ee=()=>{const a={...r,variants:void 0};return n?{...a,itemCode:n.itemCode,mrp:n.mrp,color:n.color,image:n.image}:a},se=async()=>{var i,o;if(!g){j({title:"Error",description:"Please select a project first",variant:"destructive"});return}const a=ee();try{await E.mutateAsync({organizationId:c,projectId:g,productId:l,quantity:1,specification:a}),j({title:"Success",description:"Added to cart"}),v()}catch(h){j({title:"Error",description:((o=(i=h==null?void 0:h.response)==null?void 0:i.data)==null?void 0:o.message)||"Failed to add item to cart",variant:"destructive"})}},te=async a=>{var q,D;if(!(m!=null&&m._id))return;const i=T(),o=H(i);if(!o)return;const h=o.quantity+a;if(h<=0){Q();return}try{await F.mutateAsync({cartId:m._id,itemCode:i,quantity:h}),j({title:"Success",description:"Cart updated successfully"}),v()}catch(_){j({title:"Error",description:((D=(q=_==null?void 0:_.response)==null?void 0:q.data)==null?void 0:D.message)||"Failed to update cart",variant:"destructive"})}},Q=async()=>{var i,o;if(!(m!=null&&m._id))return;const a=T();try{await s.mutateAsync({cartId:m._id,itemCode:a}),j({title:"Success",description:"Item removed from cart",variant:"default"}),await v()}catch(h){j({title:"Error",description:((o=(i=h==null?void 0:h.response)==null?void 0:i.data)==null?void 0:o.message)||"Failed to remove item from cart",variant:"destructive"})}},ae=Z(),ie=(r==null?void 0:r.variants)&&((O=r==null?void 0:r.variants)==null?void 0:O.length)>0,G=V(),re=G>0;if(L)return e.jsx(me,{});if(A||C||I)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-violet-50 via-blue-50 to-white p-6 flex items-center justify-center",children:e.jsx("div",{className:"bg-red-50 border-2 border-red-200 text-red-700 rounded-2xl p-6 shadow-lg max-w-xl w-full",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx("i",{className:"fas fa-exclamation-triangle text-red-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Error Loading Data"}),e.jsx("p",{className:"text-sm text-red-600",children:C||(I==null?void 0:I.message)||"Failed to load data"})]})]}),e.jsx("button",{onClick:()=>w(null),className:"text-red-400 hover:text-red-700 transition-colors",children:e.jsx("i",{className:"fas fa-times text-xl"})})]})})});if(!t)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-violet-50 via-blue-50 to-white flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-gray-400 py-12",children:[e.jsx("i",{className:"fas fa-box-open text-6xl mb-4"}),e.jsx("p",{className:"text-xl",children:"No data found"})]})});const le=(()=>{const a=[{key:"brand",label:"Brand",icon:"fa-trademark",type:"text"},{key:"category",label:"Category",icon:"fa-tag",type:"text"},{key:"description",label:"Description",icon:"fa-align-left",type:"text"}];return(r==null?void 0:r.category)==="light"?[...a,{key:"mrp",label:"MRP",icon:"fa-indian-rupee-sign",type:"number"},{key:"subcategory",label:"Sub Category",icon:"fa-tags",type:"text"},{key:"model",label:"Model",icon:"fa-cube",type:"text"},{key:"watt",label:"Watt",icon:"fa-bolt",type:"number"},{key:"itemCode",label:"Item Code",icon:"fa-barcode",type:"text"},{key:"cct",label:"CCT",icon:"fa-lightbulb",type:"text"},{key:"series",label:"Series",icon:"fa-layer-group",type:"text"}]:[...a,{key:"HSN",label:"HSN",icon:"fa-hashtag",type:"text"},{key:"styleType",label:"Style Type",icon:"fa-palette",type:"text"},{key:"type",label:"Type",icon:"fa-shapes",type:"text"},{key:"materialType",label:"Material Type",icon:"fa-cubes",type:"text"}]})();return e.jsx("div",{className:"max-h-full min-h-full overflow-y-auto bg-gradient-to-br from-violet-50 via-blue-50 to-white p-4",children:e.jsxs("div",{className:"max-w-full mx-auto",children:[e.jsx(we,{navigate:N,data:t,editMode:d,projectOptions:J,selectedProjectId:g,handleSelectProjectId:X,handleCancel:z,handleSave:R,updateMutation:k,handleEdit:$}),e.jsx(ke,{displayValues:ae,form:r,editMode:d,selectedVariant:n,handleVariantSelect:Y,handleChange:K,handleEdit:$,editableFields:le,hasVariants:ie,handleAddToCart:se,handleUpdateCartQuantity:te,handleRemoveFromCart:Q,cartQuantity:G,isInCart:re,selectedProjectId:g,addToCartMutation:E,updateCartQuantityMutation:F,removeFromCartMutation:s,projects:M}),d&&e.jsx("div",{className:"mt-8 lg:hidden",children:e.jsx("div",{className:"bg-white border-2 border-violet-100 rounded-xl p-4 shadow-xl",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(p,{onClick:z,variant:"outline",className:"flex-1 border-2 border-gray-300 hover:bg-gray-50",children:[e.jsx("i",{className:"fas fa-times mr-2"}),"Cancel"]}),e.jsxs(p,{onClick:R,isLoading:k.isPending,className:"flex-1 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white shadow-lg",children:[e.jsx("i",{className:"fas fa-save mr-2"}),"Save"]})]})})})]})})};export{De as default};
