import{c as D,j as l,t as g}from"./index-CBsAK0nv.js";import{a as L,b as N}from"./designLabApi-DVWrkhZD.js";import{D as w}from"./DesignLabForm-CHPcTLyN.js";const U=()=>{const{id:p}=D(),{data:r,isLoading:f,isError:h}=L(p),{mutateAsync:x,isPending:b}=N(),F=async a=>{var c,m;try{const i=new FormData,o=[],d=[],u=a.components.map(e=>({...e,materials:e.materials.filter(t=>{var s;return((s=t.materialName)==null?void 0:s.trim())||t.rate!==""&&t.rate!==0||t.image||t.tempFile})})),E=a.sequenceOfOperations.filter(e=>{var t;return(t=e.description)==null?void 0:t.trim()}).map((e,t)=>({...e,stepNumber:t+1})),y=a.referenceImages.filter(e=>!e.url.startsWith("blob:"));a.newRefFiles.forEach(e=>{d.push(e),o.push({target:"reference"})}),u.forEach((e,t)=>{e.materials.forEach((s,I)=>{s.tempFile&&(d.push(s.tempFile),o.push({target:"material",componentIndex:t,materialIndex:I}),s.image=null,delete s.tempFile)})});const n={...a,referenceImages:y,components:u,sequenceOfOperations:E};delete n.newRefFiles,delete n._id,delete n.createdAt,delete n.updatedAt,i.append("data",JSON.stringify(n)),i.append("fileMapping",JSON.stringify(o)),d.forEach(e=>{i.append("files",e)}),await x({id:p,formData:i}),g({title:"Success",description:"Design updated successfully"})}catch(i){console.error("Update Error:",i),g({title:"Error",description:((m=(c=i==null?void 0:i.response)==null?void 0:c.data)==null?void 0:m.message)||"Failed to update design",variant:"destructive"})}};return f?l.jsx("div",{className:"p-10 text-center",children:"Loading Design..."}):h?l.jsx("div",{className:"p-10 text-center text-red-500",children:"Error loading design"}):l.jsx(w,{mode:"edit",organizationId:r==null?void 0:r.organizationId,initialData:r,onSubmit:F,isLoading:b})};export{U as default};
