import{j as e,b as C,c as S,r as _,O as k}from"./index-CVfwS1G2.js";import{C as F,c as I}from"./Card-BTEDxIug.js";import{B as p}from"./Button-BgglITRW.js";import{u as D}from"./projectApi-hBsbo22C.js";import{h as E,i as L}from"./procurementApi-qJKLi3wQ.js";import O from"./MaterialOverviewLoading-DTo76WG5.js";import{t as j}from"./toast-BSC5QTk1.js";import"./useQuery-BBoMICzh.js";import"./useMutation-DuqS-NT9.js";import"./roleCheck-DROzFqxW.js";import"./Skeleton-Bp98LuPO.js";const M=({shopDetails:r,siteDetails:n,totalCost:l,onView:o,onDelete:d,refPdfId:t,deletePending:m})=>e.jsx(F,{onClick:o,className:"w-full cursor-pointer border-l-4 border-blue-600 shadow-sm",children:e.jsxs(I,{className:"p-4 space-y-3",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("h3",{className:"text-base font-semibold text-blue-800 truncate",children:["Ref No:  ",t?t.replace(/-pdf$/,""):"N/A"]})}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Shop:"})," ",e.jsx("span",{className:"text-gray-900",children:(r==null?void 0:r.shopName)||"Shop Name"})]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Delivery Site:"})," ",e.jsx("span",{className:"text-gray-900",children:(n==null?void 0:n.siteName)||"Delivery Site Name"})]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Total Cost:"})," ",e.jsxs("span",{className:"text-gray-900",children:["â‚¹ ",l||0]})]})]}),e.jsx("div",{className:"flex justify-end gap-2 pt-3",children:e.jsxs(p,{size:"sm",variant:"danger",isLoading:m,onClick:d,className:"text-white bg-red-600",children:[e.jsx("i",{className:"fas fa-trash mr-1"}),"Delete"]})})]})}),Q=()=>{var u,h;const{organizationId:r}=C(),n=S(),[l,o]=_.useState({projectId:"",projectName:""}),{data:d}=D(r),t=d==null?void 0:d.map(s=>({_id:s._id,projectName:s.projectName})),{data:m,isLoading:f,isError:g,error:x,refetch:N}=E(r,l),{mutateAsync:b,isPending:y,variables:v}=L(),w=async({id:s})=>{var a,i;try{await b({id:s}),j({title:"Success",description:"Deleted Successfully"})}catch(c){j({variant:"destructive",title:"Error",description:((i=(a=c==null?void 0:c.response)==null?void 0:a.data)==null?void 0:i.message)||(c==null?void 0:c.message)||"Failed to delete"})}},P=()=>{o({projectId:"",projectName:""})};return location.pathname.includes("sub")?e.jsx(k,{}):e.jsxs("div",{className:"p-2 space-y-6 max-w-full h-full ",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-box-open mr-3 text-blue-600"}),"Procurement Department"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage the Projects Material Items"})]})}),f?e.jsx(O,{}):g?e.jsxs("div",{className:"max-w-xl sm:min-w-[80%]  mx-auto mt-4 p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2 text-xl sm:text-3xl",children:"âš ï¸ Error Occurred"}),e.jsx("p",{className:"text-red-500  mb-4 text-lg sm:text-xl",children:((h=(u=x==null?void 0:x.response)==null?void 0:u.data)==null?void 0:h.message)||"Failed to load data"}),e.jsx(p,{onClick:()=>N(),className:"bg-red-600 text-white px-4 py-2",children:"Retry"})]}):e.jsxs("main",{className:"flex gap-2 h-[88%] ",children:[e.jsx("div",{className:"xl:w-80 flex-shrink-0",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-filter mr-2 text-blue-600"}),"Filters"]}),e.jsx("button",{onClick:P,className:"text-sm text-blue-600 cursor-pointer hover:text-blue-800 font-medium",children:"Clear All"})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Project"}),e.jsx("select",{value:(l==null?void 0:l.projectId)||"",onChange:s=>{const a=t==null?void 0:t.find(i=>i._id===s.target.value);a&&o(i=>({...i,projectId:a._id,projectName:a.projectName}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:t==null?void 0:t.map(s=>e.jsx("option",{value:s._id,children:s.projectName},s._id))})]})})]})}),m.length===0?e.jsxs("div",{className:"flex flex-col items-center  justify-center min-h-[300px] w-full bg-white rounded-xl text-center p-6",children:[e.jsx("i",{className:"fas fa-box-open text-5xl text-blue-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-1",children:"No Procurements Found"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Looks like there are no Procurements yet for this project.",e.jsx("br",{}),"Once you have ",e.jsx("strong",{children:" generated the Pdf "}),"  items will be listed here  to get started ðŸš€"]})]}):e.jsx("div",{className:"flex-1 max-h-[100%]  overflow-y-auto",children:e.jsx("div",{className:"grid gap-6 grid-cols-1 sm:grid-cols-2 xl:grid-cols-2 ",children:m.map(s=>e.jsx(e.Fragment,{children:e.jsx(M,{shopDetails:s.shopDetails,siteDetails:s.deliveryLocationDetails,totalCost:s.totalCost,refPdfId:s.refPdfId,onView:()=>n(`sub/${s._id}`),onDelete:a=>{a.stopPropagation(),w({id:s._id})},deletePending:y&&v.id===s._id},s._id)}))})})]})]})};export{Q as default};
