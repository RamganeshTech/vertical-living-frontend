import{u as R,h as B,a as W,q as _,g as S,b as M,p as O,c as I,d as F,j as e,B as A,t as w,r as C}from"./index-DyM6T-eT.js";import{S as z}from"./StageGuide-DzUcb6ZB.js";const K=async({api:a,id:i,section:t,notes:n})=>{const{data:s}=await a.patch(`/prerequireties/update/${i}/notes/${t}`,{notes:n});if(s.ok)return s;throw new Error(s.message||"Failed to update notes")},U=async({api:a,id:i,section:t,isRequired:n})=>{const{data:s}=await a.patch(`/prerequireties/update/${i}/boolean/${t}`,{isRequired:n});if(s.ok)return s;throw new Error(s.message||"Failed to update boolean")},L=async({api:a,projectId:i})=>{const{data:t}=await a.get(`/prerequireties/getalldetails/${i}`);if(t.ok)return t;throw new Error(t.message||"Failed to get all PreRequireties")},G=()=>{const{role:a}=R(),i=S(a),t=["owner","staff","CTO"];return W({mutationFn:async({id:n,section:s,notes:u})=>{if(!a)throw new Error("Not Authorized");if(!t.includes(a))throw new Error("Not allowed");if(!i)throw new Error("API not found");return await K({api:i,id:n,section:s,notes:u})},onSuccess:()=>{_.invalidateQueries({queryKey:["preRequireties"]})}})},Q=()=>{const{role:a}=R(),i=S(a),t=["owner","staff","CTO"];return W({mutationFn:async({id:n,section:s,isRequired:u})=>{if(!a)throw new Error("Not Authorized");if(!t.includes(a))throw new Error("Not allowed");if(!i)throw new Error("API not found");return await U({api:i,id:n,section:s,isRequired:u})},onSuccess:()=>{_.invalidateQueries({queryKey:["preRequireties"]})}})},T=a=>{const{role:i}=R(),t=S(i),n=["owner","staff","CTO"];return B({queryKey:["preRequireties",a],queryFn:async()=>{if(!i)throw new Error("Not Authorized");if(!n.includes(i))throw new Error("Not allowed");if(!t)throw new Error("API not found");return await L({api:t,projectId:a})},retry:!1,refetchOnMount:!1})},D=({title:a,section:i,isRequired:t,notes:n,formId:s,onUpdate:u})=>{var b,j;const{role:x,permission:l}=F(),h=x==="owner"||((b=l==null?void 0:l.prerequisites)==null?void 0:b.create),m=x==="owner"||((j=l==null?void 0:l.prerequisites)==null?void 0:j.edit),[c,E]=C.useState(!1),[p,g]=C.useState(n),[v,f]=C.useState(!1),d=Q(),k=G(),y=async r=>{try{await d.mutateAsync({id:s,section:i,isRequired:r}),w({title:"Success",description:`${a} requirement updated successfully`}),u()}catch(o){w({title:"Error",description:o instanceof Error?o.message:"Failed to update requirement",variant:"destructive"})}},N=async()=>{if(p!==n){f(!0);try{await k.mutateAsync({id:s,section:i,notes:p}),w({title:"Success",description:`${a} notes updated successfully`}),u()}catch(r){w({title:"Error",description:r instanceof Error?r.message:"Failed to update notes",variant:"destructive"}),g(n)}finally{f(!1)}}},q=()=>{N()},P=r=>{r.key==="Enter"&&r.ctrlKey&&N()};return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg shadow-sm mb-4",children:[e.jsx("div",{className:"p-4 cursor-pointer hover:bg-gray-50 transition-colors border-b border-gray-100",onClick:()=>E(!c),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("i",{className:`fas ${c?"fa-chevron-down":"fa-chevron-right"} text-gray-400`}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:a}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Status:"}),t?e.jsxs("span",{className:"flex items-center text-green-600 text-sm",children:[e.jsx("i",{className:"fas fa-check-circle mr-1"}),"Required"]}):e.jsxs("span",{className:"flex items-center text-gray-500 text-sm",children:[e.jsx("i",{className:"fas fa-exclamation-circle mr-1"}),"Not Required"]})]})]})]}),(h||m)&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t,onChange:r=>{r.stopPropagation(),y(r.target.checked)},disabled:d.isPending,className:"sr-only"}),e.jsx("div",{className:`w-11 h-6 rounded-full transition-colors ${t?"bg-blue-600":"bg-gray-200"} ${d.isPending?"opacity-50":""}`,children:e.jsx("div",{className:`w-5 h-5 bg-white rounded-full shadow transform transition-transform ${t?"translate-x-5":"translate-x-0"} mt-0.5 ml-0.5`})})]}),d.isPending&&e.jsx("i",{className:"fas fa-spinner fa-spin text-gray-400"})]})]})}),c&&e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"space-y-4",children:[(h||m)&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t,onChange:r=>y(r.target.checked),disabled:d.isPending,className:"sr-only"}),e.jsx("div",{className:`w-11 h-6 rounded-full transition-colors ${t?"bg-blue-600":"bg-gray-200"} ${d.isPending?"opacity-50":""}`,children:e.jsx("div",{className:`w-5 h-5 bg-white rounded-full shadow transform transition-transform ${t?"translate-x-5":"translate-x-0"} mt-0.5 ml-0.5`})})]}),e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"This work is required for the project"})]}),(h||m)&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Notes & Additional Details"}),e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{placeholder:`Add notes about ${a.toLowerCase()}...`,value:p,onChange:r=>g(r.target.value),onBlur:q,onKeyDown:P,className:"w-full min-h-[100px] p-3 border border-gray-300 rounded-md resize-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none",disabled:v}),v&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("i",{className:"fas fa-spinner fa-spin text-gray-400"})})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Press Ctrl+Enter to save or click outside the text area"})]})]})})]})},J=()=>{var d,k,y,N,q,P,b,j;const{projectId:a,organizationId:i}=M(),{isMobile:t,openMobileSidebar:n}=O(),{data:s,isLoading:u,error:x,refetch:l}=T(a),h=I(),{role:m,permission:c}=F(),E=m==="owner"||((d=c==null?void 0:c.prerequisites)==null?void 0:d.create),p=m==="owner"||((k=c==null?void 0:c.prerequisites)==null?void 0:k.edit),g=[{key:"modularWork",title:"Modular Work",description:"Prefabricated components and modular construction",_id:(y=s==null?void 0:s.data)==null?void 0:y._id},{key:"electricalWork",title:"Electrical Work",description:"Wiring, fixtures, and electrical installations",_id:(N=s==null?void 0:s.data)==null?void 0:N._id},{key:"plumbingWork",title:"Plumbing Work",dzescription:"Water supply, drainage, and plumbing fixtures",_id:(q=s==null?void 0:s.data)==null?void 0:q._id},{key:"civilWork",title:"Civil Work",description:"Structural work, foundations, and civil engineering",_id:(P=s==null?void 0:s.data)==null?void 0:P._id},{key:"decorationWork",title:"Decoration Work",description:"Interior design, painting, and finishing touches",_id:(b=s==null?void 0:s.data)==null?void 0:b._id},{key:"carpentryWork",title:"Carpentry Work",description:"Woodwork including doors, windows, furniture, partitions, and fittings",_id:(j=s==null?void 0:s.data)==null?void 0:j._id}],v=()=>{l()};if(u)return e.jsx("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("i",{className:"fas fa-spinner fa-spin text-4xl text-blue-600"}),e.jsx("p",{className:"text-gray-600",children:"Loading project prerequisites..."})]})});if(x)return e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-exclamation-circle text-red-600 mr-2"}),e.jsx("p",{className:"text-red-800",children:x instanceof Error?x.message:"Failed to load prerequisites"})]})}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx("button",{onClick:()=>l(),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors",children:"Try Again"})})]});if(!(s!=null&&s.data))return e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-exclamation-circle text-yellow-600 mr-2"}),e.jsx("p",{className:"text-yellow-800",children:"No prerequisites data found for this project. Please ensure the project exists and try again."})]})}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx("button",{onClick:()=>l(),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors",children:"Refresh"})})]});const f=s.data;return e.jsx(e.Fragment,{children:e.jsx("div",{className:"max-h-full overflow-y-auto mx-auto px-4  custom-scrollbar",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("header",{className:"flex justify-between items-center mb-2 pb-2  border-b border-gray-100 gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center sm:hidden",children:[t&&e.jsx("button",{onClick:n,className:"mr-3 p-2 h-10 w-10 flex items-center justify-center rounded-md border border-gray-200 text-gray-600 hover:bg-gray-50 active:bg-gray-100 transition-colors",title:"Open Menu",children:e.jsx("i",{className:"fa-solid fa-bars text-lg"})}),e.jsx("h1",{className:"text-xl font-bold text-gray-800 leading-tight",children:"Project Prerequisites"})]}),e.jsxs("div",{className:"hidden sm:block space-y-2",children:[e.jsx("h1",{className:"text-3xl font-bold text-blue-700 tracking-tight",children:"Project Prerequisites"}),e.jsx("p",{className:"text-gray-500 text-sm md:text-base max-w-2xl leading-relaxed",children:"Configure the required work types for your project. These prerequisites must be completed before proceeding to the 14-step process."})]})]}),e.jsx("div",{className:"shrink-0 pt-1",children:e.jsx(z,{organizationId:i,stageName:"prerequisites"})})]}),e.jsx("div",{className:"space-y-4",children:g.map(r=>{const o=f[r.key];return e.jsx(D,{title:r.title,section:r.key,isRequired:(o==null?void 0:o.isRequired)||!1,notes:(o==null?void 0:o.notes)||"",formId:r._id,onUpdate:v},r.key)})}),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Prerequisites Summary"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-6 gap-4",children:g.map(r=>{const o=f[r.key],$=(o==null?void 0:o.isRequired)||!1;return e.jsxs("div",{className:"flex items-center space-x-2",children:[$?e.jsx("i",{className:"fas fa-check-circle text-green-600"}):e.jsx("i",{className:"fas fa-exclamation-circle text-gray-400"}),e.jsx("span",{className:`text-sm ${$?"text-green-600 font-medium":"text-gray-500"}`,children:r.title})]},r.key)})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[e.jsx(A,{variant:"ghost",onClick:()=>l(),className:"px-6 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors",children:"Refresh Data"}),(E||p)&&e.jsx(A,{onClick:()=>{h("../requirementform"),w({title:"Success",description:"Prerequisites configured successfully. You can now proceed to the 14-step process."})},className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Continue to Next Steps"})]})]})})})};export{J as default};
