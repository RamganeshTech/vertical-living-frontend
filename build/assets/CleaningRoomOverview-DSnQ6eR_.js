import{u as J,a as K,r as m,j as e,B as i,L as Q,I as X,t as o}from"./index-DCvjwNGU.js";import{c as Y,d as Z,e as ee,f as se,g as te}from"./cleaningStageApi-pRaiGsnb.js";import{C as p}from"./Card-D6Sc2MI-.js";import ae from"./MaterialOverviewLoading-DwCp8CV2.js";import{T as le}from"./TextArea-Bc7DfC5R.js";import{d as ie}from"./downloadFile-D54BbfBR.js";import{I as re}from"./ImageGalleryMain-_Iit753U.js";import"./Skeleton-C14joy6B.js";import"./constants-B0HHjZgX.js";function he(){var S,E,I,D,P,R;const{projectId:n,roomId:c,organizationId:U}=J(),L=K(),{data:t,isLoading:z,refetch:u,isError:A,error:g}=Y(n,c),[N,v]=m.useState(null),{mutateAsync:M,isPending:h}=Z(),{mutateAsync:T,isPending:y}=ee(),{mutateAsync:$,isPending:B}=se(),{mutateAsync:G,isPending:w}=te(),[x,O]=m.useState((t==null?void 0:t.completelyCleaned)||!1),[b,f]=m.useState((t==null?void 0:t.notes)||""),[C,j]=m.useState(!1),[d,k]=m.useState(null),W=s=>{var l;(l=s.target.files)!=null&&l.length&&k(s.target.files)},_=async()=>{var s,l;try{if(!d)throw new Error("select the files before uploading");const a=new FormData;for(let r=0;r<d.length;r++)a.append("files",d[r]);await M({projectId:n,roomId:c,formData:a}),o({title:"Success",description:"Files uploaded successfully."}),k(null),u()}catch(a){o({title:"Error",description:((l=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:l.message)||a.message,variant:"destructive"})}},F=async s=>{var l,a;try{await T({projectId:n,roomId:c,fileId:s}),o({title:"Deleted",description:"File deleted successfully."}),u()}catch(r){o({title:"Error",description:((a=(l=r==null?void 0:r.response)==null?void 0:l.data)==null?void 0:a.message)||r.message,variant:"destructive"})}},V=async()=>{var s,l;try{if(!b.trim())throw new Error("please enter some notes");await G({projectId:n,roomId:c,notes:b}),o({title:"Notes updated!",description:"Room notes saved."}),j(!1)}catch(a){o({title:"Error",description:((l=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:l.message)||(a==null?void 0:a.message)||"Failed to update",variant:"destructive"})}},q=async()=>{var s,l;try{await $({projectId:n,roomId:c,completelyCleaned:!x}),o({title:"Updated",description:`Marked as ${x?"not cleaned":"completely cleaned"}.`}),O(!x),u()}catch(a){o({title:"Error",description:((l=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:l.message)||a.message,variant:"destructive"})}};if(z)return e.jsx(ae,{});A&&((E=(S=g==null?void 0:g.response)==null?void 0:S.data)!=null&&E.message,i);const H=(I=(t==null?void 0:t.uploads)||[])==null?void 0:I.filter(s=>s.type==="image");return e.jsxs("div",{className:"w-full h-full max-h-full overflow-y-auto custom-scrollbar-none sm:custom-scrollbar",children:[e.jsxs("div",{className:"mb-4 flex justify-between items-center w-full",children:[e.jsxs("h2",{className:"text-md sm:text-2xl font-semibold mb-4 text-blue-700 flex items-center",children:[e.jsx("i",{className:"fas fa-broom mr-2"})," ",t==null?void 0:t.roomName," - Details"]}),e.jsxs("div",{className:"flex gap-1 items-center",children:[e.jsx(i,{isLoading:B,onClick:q,className:"bg-blue-600 hover:bg-blue-700 text-white text-sm !p-2 lg:p-4 ",children:x?"Mark as Not Cleaned":"Mark as Cleaned"}),e.jsx(i,{variant:"primary",className:"",onClick:()=>L(`/${U}/projectdetails/${n}/cleaning`),children:"Go Back"})]})]}),e.jsxs("div",{className:"mb-2 grid grid-cols-1 md:grid-cols-2 gap-1 items-center place-content-center",children:[e.jsxs(p,{className:"p-2 border-gray-100 border-2",children:[e.jsxs("div",{className:"w-full justify-between flex items-center",children:[e.jsx("h3",{className:"text-md font-semibold  text-blue-700",children:"Notes"}),!C&&e.jsxs(i,{onClick:()=>{f(t==null?void 0:t.notes),j(!0)},className:"bg-blue-600 text-white hover:bg-blue-700",children:["Edit ",e.jsx("i",{className:"fas fa-pencil ml-2 "})]})]}),C?e.jsxs(e.Fragment,{children:[e.jsx(le,{rows:4,className:"w-full border rounded p-2",value:b,onChange:s=>f(s.target.value),placeholder:"Enter notes here..."}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx(i,{onClick:V,disabled:w,className:"bg-blue-600 text-white hover:bg-blue-700",children:w?"Saving...":"Save"}),e.jsx(i,{onClick:()=>{j(!1),f((t==null?void 0:t.notes)??"")},variant:"outline",className:"border-gray-400",children:"Cancel"})]})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"relative overflow-x-auto overflow-y-auto break-words h-[6rem] max-h-[6rem] leading-5 custom-scrollbar",children:[" ",e.jsx("p",{className:"text-gray-700 mb-2 ",children:(D=t==null?void 0:t.notes)!=null&&D.trim()?t==null?void 0:t.notes:"No notes present."})]})})]}),e.jsxs(p,{className:"p-2 h-full border-gray-100 border-2",children:[e.jsx(Q,{className:"block mb-2 font-semibold !text-blue-700",children:"Upload Images or PDFs:"}),e.jsx(X,{type:"file",multiple:!0,accept:"image/*,application/pdf",onChange:W,disabled:h,className:"border-b w-full"}),e.jsx(i,{onClick:_,isLoading:h,className:"mt-3 bg-blue-600 text-white hover:bg-blue-700",children:h?"Uploading...":`Upload ${d?d.length:""} file(s)`})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 h-[95%] sm:h-[65%]",children:[e.jsxs(p,{className:"p-2 lg:p-4 max-h-full overflow-y-auto custom-scrollbar border-1 border-[#8485887a]",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3 text-blue-700",children:"Images"}),((P=t==null?void 0:t.uploads)==null?void 0:P.filter(s=>s.type==="image").length)===0?e.jsx("p",{className:"text-gray-400 text-sm",children:"No images uploaded."}):e.jsx(re,{imageFiles:H,handleDeleteFile:F,height:80,minWidth:98,maxWidth:100})]}),e.jsxs(p,{className:"p-4 max-h-full overflow-y-auto border-1 border-[#8485887a] custom-scrollbar",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3 text-blue-700",children:"PDFs"}),((R=t.uploads)==null?void 0:R.filter(s=>s.type==="pdf").length)===0?e.jsx("p",{className:"text-gray-400 text-sm",children:"No PDFs uploaded."}):e.jsx("ul",{className:"space-y-2",children:t==null?void 0:t.uploads.filter(s=>s.type==="pdf").map(s=>e.jsxs("li",{className:"flex items-center justify-between shadow-md p-2 rounded h-full",children:[e.jsx("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 underline truncate max-w-[50%]",children:s.originalName}),e.jsxs("div",{className:"space-x-1",children:[e.jsx(i,{size:"sm",variant:"primary",onClick:()=>ie({src:s==null?void 0:s.url,alt:(s==null?void 0:s.originalName)||"file.pdf"}),children:e.jsx("i",{className:"fa-solid fa-download"})}),e.jsx(i,{size:"sm",isLoading:y,onClick:()=>F(s._id),disabled:y,variant:"danger",className:"bg-red-600 text-white rounded px-2 py-1 text-xs",children:e.jsx("i",{className:"fas fa-trash-can"})})]})]},s.url))})]})]}),N&&e.jsx("div",{onClick:()=>v(null),className:"fixed inset-0 z-50 bg-black/70 bg-opacity-60 flex items-center justify-center",children:e.jsxs("div",{onClick:s=>s.stopPropagation(),className:"relative bg-white rounded py-8 px-4 max-w-[90vw] max-h-[80vh] shadow-lg",children:[e.jsx("i",{className:"fas fa-times absolute top-2 right-3 text-xl text-gray-700 hover:text-red-500 cursor-pointer",onClick:()=>v(null)}),e.jsx("img",{src:N,alt:"Full View",className:"max-h-[70vh] w-auto object-contain rounded"})]})})]})}export{he as default};
