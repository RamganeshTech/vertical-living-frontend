import{r as g,R as U,q as fe,s as _,j as e,u as D,b as S,a as ue,P as q,k as F,L as T,Q as V,T as H,U as Q,V as X,W as J,X as Z}from"./index-BzUhBKjh.js";import{M as xe,b as me,C as E}from"./constants-D2-iPKn3.js";import{b as ee}from"./CTOApi-CCoDNU_5.js";import{b as se}from"./clientApi-DewqqPn4.js";import{b as te}from"./staffApi-BWwyVTqc.js";import{b as ae}from"./userApi-CiQwT05L.js";import{b as oe}from"./workerApi-BVbJhp7D.js";import{B as z}from"./Button-G0_5Lr1e.js";import{t as $}from"./toast-BSC5QTk1.js";import{u as ge}from"./currentActiveStageApi-BUir65Sk.js";import{c as he}from"./notificationApi-DByexR6f.js";import{u as pe}from"./useCurrentSupervisor-QblP4OqE.js";function je(c,s){g.useEffect(()=>{const n=t=>{t.ctrlKey&&t.key==="]"?(t.preventDefault(),s()):t.ctrlKey&&t.key==="["&&(t.preventDefault(),c())};window.addEventListener("keydown",n)},[s,c])}const W=U.memo(({size:c="small"})=>{const{data:s,isLoading:n}=he(),t=pe(),d=g.useCallback(()=>{console.log("calling ðŸ“Š Unread count updated:"),s!==void 0&&fe.invalidateQueries({queryKey:["notifications","unread-count"]})},[]);return g.useEffect(()=>{const o=t==null?void 0:t.id;if(o)return _.emit("join_notifications",{userId:o}),_.on("unread_count_update",d),()=>{_.off("unread_count_update",d)}},[t==null?void 0:t.id,d]),!n&&typeof s=="number"&&s>0?c==="large"?e.jsx("span",{className:"absolute -top-2 -right-4 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:s>99?"99+":s}):e.jsx("span",{className:"absolute -top-2 -right-4 bg-red-500 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center",children:s>9?"9+":s}):null});W.displayName="NotificationBadge";const R=({isExpanded:c=!1,isActive:s=!1})=>{const n=D(),{organizationId:t}=S(),d=()=>{n(`/${t}/notification`)};return c?e.jsxs("div",{onClick:d,className:`cursor-pointer flex justify-between items-center max-w-[95%] py-4 px-4 ${s?"bg-[#3a3b45] rounded-xl text-white":"rounded-xl hover:bg-[#3a3b45]"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("i",{className:`fa-solid fa-bell text-lg ${s?"text-[#4a86f7]":"text-[#9ca3af]"}`}),e.jsx(W,{size:"large"})]}),e.jsx("span",{className:"text-lg",children:"Notifications"})]}),e.jsx("span",{children:e.jsx("i",{className:"fa-solid fa-chevron-right"})})]}):e.jsx("div",{onClick:d,className:`cursor-pointer flex justify-center items-center py-4 px-4 ${s?"bg-[#3a3b45] rounded-xl text-white":"rounded-xl hover:bg-[#3a3b45]"}`,children:e.jsxs("div",{className:"relative",children:[e.jsx("i",{className:`fa-solid fa-bell ${s?"text-[#4a86f7]":"text-[#9ca3af]"}`}),e.jsx(W,{size:"small"})]})})},be=({labels:c,icons:s,path:n,setProjectName:t,projectName:d})=>{const[w,o]=g.useState(!1),{projectId:h}=S(),L=D(),y=ue(),p=y.pathname.split("/"),{organizationId:k}=S(),x=q(),{role:f}=F(a=>a.authStore),[r,j]=g.useState(""),{data:m,isLoading:A}=ge(h),{mutateAsync:B,isPending:v}=ee(),{mutateAsync:O,isPending:C}=se(),{mutateAsync:I,isPending:l}=te(),{mutateAsync:b,isPending:u}=ae(),{mutateAsync:ie,isPending:M}=oe();g.useEffect(()=>{t&&m&&m.projectName&&!A&&t((m==null?void 0:m.projectName)||"Project")},[m,A]);const ne=()=>{o(!1)},re=()=>{o(!0)},le=p[2]==="projectdetails";g.useEffect(()=>{const i=y.pathname.split("/")[4];j(w?()=>xe[i]:()=>me[i])},[y.pathname,w]),je(re,ne);const G=p[2]==="projectdetails",ce=p[1]==="login",de=()=>{G&&L(`/organizations/${k}/projects`),ce&&L("/organizations")},Y=f&&["owner","CTO","staff"].includes(f),K=async()=>{var a,i;try{f==="CTO"?await B():f==="client"?await O():f==="staff"?await I():f==="owner"?await b():f==="worker"&&await ie(),x(V()),x(H()),x(Q()),x(X()),x(J()),x(Z()),$({title:"Success",description:"logout successfull"}),(!v||!C||!l||!u||!M)&&L("/")}catch(N){$({title:"Error",description:((i=(a=N==null?void 0:N.response)==null?void 0:a.data)==null?void 0:i.message)||"Failed to logout",variant:"destructive"})}};return e.jsx(e.Fragment,{children:w?e.jsxs("aside",{onMouseLeave:()=>o(!1),className:"relative flex flex-col bg-[#2f303a] w-[17%] min-h-screen max-h-screen text-[#9ca3af] select-none transition-all duration-300",children:[e.jsxs("div",{className:"flex flex-col flex-grow overflow-y-auto overflow-x-hidden custom-scrollbar p-2 large-scrollbar",children:[e.jsxs("div",{onClick:de,className:`flex ${G?"cursor-pointer":""} justify-between items-center border-b-1 py-2`,children:[e.jsx("span",{className:"text-xl",children:le?d||"Project":E.COMPANY_NAME}),e.jsx("div",{className:"w-[30px] h-[30px]",children:e.jsx("img",{className:"w-full h-full",src:E.COMPANY_LOGO,alt:"LOGO"})})]}),e.jsxs("section",{className:"py-2 space-y-2",children:[" ",Object.entries(c).map(([a,i])=>{const N=r===i;return n[a]&&e.jsx(T,{to:n[a],className:"outline-none",children:e.jsxs("div",{onClick:()=>j(i),className:`cursor-pointer flex justify-between max-w-[95%] py-4 px-4 ${r===i?"bg-[#3a3b45] rounded-xl text-white":"rounded-xl hover:bg-[#3a3b45]"} `,ref:P=>{N&&P&&P.scrollIntoView({behavior:"smooth",block:"center"})},children:[e.jsx("span",{className:"text-lg",children:i}),e.jsx("span",{children:e.jsx("i",{className:"fa-solid fa-chevron-right"})})]})},i)})]})]}),e.jsxs("div",{className:"flex flex-col p-2 border-t border-[#3a3b45]",children:[p[1]!=="login"&&e.jsxs(z,{isLoading:v||C||l||u||M,onClick:K,className:"flex items-center gap-2 px-4 py-3 rounded-lg !bg-[#3a3b45] !text-[#9ca3af] hover:!bg-[#464751] hover:!text-white transition",children:[e.jsx("i",{className:"fa-solid fa-right-from-bracket"}),e.jsx("span",{children:"Logout"})]}),e.jsx("div",{className:"mt-2",children:Y&&e.jsx(R,{isExpanded:!1,isActive:!1})})]})]}):e.jsxs("aside",{onMouseEnter:()=>o(!0),className:"flex flex-col relative justify-between bg-[#2f303a] w-[6%]  max-h-full  text-[#9ca3af] transition-all duration-300 ",children:[e.jsx("div",{className:"max-h-[95%] overflow-y-auto overflow-x-hidden custom-scrollbar ",children:e.jsx("div",{className:"flex items-center flex-col justify-between w-full",children:Object.entries(s).map(([a,i])=>{const N=(r==null?void 0:r.toLowerCase())===a.toLowerCase();return n[a]?e.jsx(T,{to:n[a],className:`${n[a]?"":"cursor-not-allowed"}`,children:e.jsx("div",{onClick:()=>j(a),className:`cursor-pointer flex justify-between max-w-[95%] py-4 px-4 ${(r==null?void 0:r.toLowerCase())===a.toLowerCase()?"bg-[#3a3b45] rounded-xl text-white":"rounded-xl hover:bg-[#3a3b45]"} `,ref:P=>{N&&P&&P.scrollIntoView({behavior:"smooth",block:"center"})},children:e.jsx("i",{className:`${i} ${(r==null?void 0:r.toLowerCase())===a.toLowerCase()?"text-[#4a86f7]":"text-[#9ca3af]"} `})})},a):e.jsx("div",{className:"cursor-not-allowed flex justify-between max-w-[95%] py-4 px-4",children:e.jsx("i",{className:`${i}`})})})})}),e.jsxs("div",{className:"flex flex-col items-center p-2 border-t border-[#3a3b45]",children:[p[1]!=="login"&&e.jsx(z,{isLoading:v||C||l||u||M,title:"logout",onClick:K,className:"w-[40px] h-[40px] flex items-center justify-center !bg-[#3a3b45] !text-[#9ca3af] hover:!text-red-500 transition",children:e.jsx("i",{className:"fa-solid fa-right-from-bracket"})}),Y&&e.jsx(R,{isExpanded:!1,isActive:!1})]})]})})},$e=g.memo(be),Be=({isOpen:c,onClose:s,labels:n,path:t})=>{const d=D(),{organizationId:w}=S(),o=q(),{role:h}=F(l=>l.authStore),{mutateAsync:L,isPending:y}=ee(),{mutateAsync:p,isPending:k}=se(),{mutateAsync:x,isPending:f}=te(),{mutateAsync:r,isPending:j}=ae(),{mutateAsync:m,isPending:A}=oe(),B=async()=>{var l,b;try{h==="CTO"?await L():h==="client"?await p():h==="staff"?await x():h==="owner"?await r():h==="worker"&&await m(),o(V()),o(H()),o(Q()),o(X()),o(J()),o(Z()),$({title:"Success",description:"logout successfull"}),(!y||!k||!f||!j||!A)&&d("/")}catch(u){$({title:"Error",description:((b=(l=u==null?void 0:u.response)==null?void 0:l.data)==null?void 0:b.message)||"Failed to logout",variant:"destructive"})}};let v=Object.entries(n);const O=location.pathname.split("/"),C=O[2]==="projectdetails",I=()=>{C&&d(`/organizations/${w}/projects`)};return e.jsxs(e.Fragment,{children:[c&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40",onClick:s}),e.jsxs("aside",{className:`fixed top-0 left-0 z-50 h-screen bg-white w-[75%] flex flex-col transition-transform duration-300 ${c?"translate-x-0":"-translate-x-full"}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsxs("div",{onClick:I,className:`flex items-center gap-3 ${C?"cursor-pointer":""}`,children:[e.jsx("img",{src:E.COMPANY_LOGO,alt:"Logo",className:"w-10 h-10 rounded-full object-cover"}),e.jsx("span",{className:"text-lg font-semibold",children:E.COMPANY_NAME})]}),e.jsx("button",{onClick:s,className:"text-xl text-gray-700",children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsx("nav",{className:"flex flex-col flex-grow overflow-y-auto p-4",children:v.map(([l,b],u)=>e.jsxs(U.Fragment,{children:[t[l]?e.jsx(T,{to:t[l],onClick:s,className:"text-gray-800 hover:bg-gray-100 p-3 rounded block",children:b}):e.jsx("span",{className:"text-gray-400 p-3 rounded cursor-not-allowed block",children:b}),u<v.length-1&&e.jsx("hr",{className:"border-t border-gray-200 my-1"})]},l))}),e.jsx("div",{className:"border-t border-gray-200 p-4",children:O[1]!=="login"&&e.jsxs(z,{className:"w-full flex items-center justify-center gap-2",isLoading:y||k||f||j||A,onClick:B,children:[e.jsx("i",{className:"fas fa-sign-out-alt"})," Logout"]})})]})]})};export{Be as M,$e as S};
