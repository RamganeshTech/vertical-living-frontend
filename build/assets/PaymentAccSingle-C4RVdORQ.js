import{b as C,u as D,r as k,j as e}from"./index-g9v5L7eS.js";import{b as A,c as T}from"./paymentAccApi-Z-OAscOo.js";import{t as i}from"./toast-BSC5QTk1.js";import{B as h}from"./Button-DXzmpjtA.js";import{d as l}from"./dateFormator-BGKi5rfZ.js";import{C as L,a as E}from"./Card-BZ8fgwGK.js";import{I as $}from"./InfoToolTip-DwbMc9Qo.js";import"./useQuery-BlDIWKCM.js";import"./useMutation-CAsfcLt-.js";import"./useInfiniteQuery-Cey4CECX.js";import"./roleCheck-vn63l46q.js";const B=n=>{switch(n==null?void 0:n.toLowerCase()){case"paid":return{bg:"bg-green-100",text:"text-green-700",icon:"fa-check-circle",badge:"bg-green-100 text-green-700"};case"processing":return{bg:"bg-blue-100",text:"text-blue-700",icon:"fa-spinner fa-spin",badge:"bg-blue-100 text-blue-700"};case"failed":return{bg:"bg-red-100",text:"text-red-700",icon:"fa-times-circle",badge:"bg-red-100 text-red-700"};default:return{bg:"bg-orange-100",text:"text-orange-700",icon:"fa-clock",badge:"bg-orange-100 text-orange-700"}}},H=()=>{var d,o,x,m;const{id:n}=C(),b=D(),{data:t,isLoading:u,isError:f,refetch:j}=A(n),{mutateAsync:y,isPending:N}=T(),[v,w]=k.useState(new Set),P=async()=>{var s,r;try{await y({id:n}),i({title:"Success",description:"Bill sent to Accounts Department"})}catch(a){i({variant:"destructive",title:"Error",description:((r=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:r.message)||(a==null?void 0:a.message)||"operation failed"})}},S=(s,r)=>{w(a=>new Set(a).add(s)),i({title:"Dummy Payment",description:"Payment integration comming soon",variant:"default"})};if(u)return e.jsx("div",{className:"flex items-center justify-center h-[50vh]",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("i",{className:"fas fa-spinner fa-spin text-3xl text-blue-600"}),e.jsx("p",{className:"text-gray-500",children:"Loading payment details..."})]})});if(f||!t)return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[300px] bg-white rounded-xl p-6 border border-red-100",children:[e.jsx("i",{className:"fas fa-exclamation-triangle text-4xl text-red-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Could not load details"}),e.jsx(h,{onClick:()=>j(),variant:"secondary",children:"Retry"})]});const c=B(t.generalStatus);return e.jsxs("div",{className:"p-4 h-full overflow-y-auto custom-scrollbar space-y-6 bg-gray-50/50",children:[e.jsxs("div",{className:"flex justify-between items-center border-b border-gray-200 pb-4",children:[e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsx("div",{onClick:()=>b(-1),className:"bg-white hover:bg-gray-100 shadow-sm flex items-center justify-center w-9 h-9 border border-gray-200 text-gray-600 text-sm cursor-pointer rounded-lg transition-all",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-800 flex items-center gap-2",children:["Payment: ",e.jsx("span",{className:"text-blue-600",children:t.paymentNumber})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-0.5",children:["Created on ",l(t.createdAt)]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 ",children:[e.jsxs("div",{className:"flex items-center space-y-1",children:[e.jsx(h,{variant:"primary",isLoading:N,onClick:P,children:"Send To Accounts Dept"}),e.jsx($,{content:"Click the button to send the payment to accounts department",type:"info",position:"bottom"})]}),e.jsxs("div",{className:`px-4 py-1.5 rounded-full text-sm font-bold border ${c.bg} ${c.text} border-current/20 capitalize flex items-center gap-2`,children:[e.jsx("i",{className:`fas ${c.icon}`}),t.generalStatus]})]})]}),e.jsx(L,{className:"shadow-sm border border-gray-200 bg-white",children:e.jsxs(E,{className:"p-6 space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 p-4 bg-gray-50 rounded-xl border border-gray-100",children:[e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("h3",{className:"text-xs uppercase tracking-wider text-gray-500 font-semibold mb-1",children:"Payee Details"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-600",children:e.jsx("i",{className:"fas fa-user"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-gray-800 text-sm",children:t.paymentPersonName||"N/A"}),e.jsx("p",{className:"text-xs text-gray-500 capitalize",children:((d=t.paymentPersonModel)==null?void 0:d.replace("Model",""))||"Vendor"})]})]})]}),e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("h3",{className:"text-xs uppercase tracking-wider text-gray-500 font-semibold mb-1",children:"Important Dates"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Payment Date:"}),e.jsx("span",{className:"font-medium",children:l(t.paymentDate)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Due Date:"}),e.jsx("span",{className:"font-medium text-red-600",children:l(t.dueDate)})]})]})]}),e.jsx("div",{className:"md:col-span-2 flex flex-col items-end justify-center pl-8 border-l border-gray-200",children:e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Total Payable Amount"}),e.jsxs("h2",{className:"text-3xl font-bold text-gray-900",children:["₹",(o=t.grandTotal)==null?void 0:o.toLocaleString("en-IN")]}),t.taxAmount>0&&e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["(Includes ₹",t.taxAmount," Tax)"]})]})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"bg-blue-600 w-1 h-6 rounded-full"}),e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Payment Items"}),e.jsx("span",{className:"px-2 py-0.5 bg-gray-100 text-gray-600 rounded-full text-xs font-semibold",children:((x=t.items)==null?void 0:x.length)||0})]})}),e.jsxs("div",{className:"border border-gray-200 rounded-xl overflow-hidden shadow-sm",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 text-white",children:e.jsxs("div",{className:"grid grid-cols-12 gap-2 px-4 py-3 font-semibold text-xs uppercase tracking-wider",children:[e.jsx("div",{className:"col-span-1 text-center",children:"S.No"}),e.jsx("div",{className:"col-span-2",children:"Item Name"}),e.jsx("div",{className:"col-span-1",children:"Unit"}),e.jsx("div",{className:"col-span-1 text-center",children:"Qty"}),e.jsx("div",{className:"col-span-1 text-center ",children:"Rate"}),e.jsx("div",{className:"col-span-1 text-center",children:"Total"}),e.jsx("div",{className:"col-span-1",children:"Order ID"}),e.jsx("div",{className:"col-span-2 ",children:"Txn ID"}),e.jsx("div",{className:"col-span-1",children:"Due Date"}),e.jsx("div",{className:"col-span-1 text-center",children:"Pay"})]})}),e.jsx("div",{className:"bg-white divide-y divide-gray-100",children:!t.items||t.items.length===0?e.jsx("div",{className:"p-8 text-center text-gray-400",children:"No items found in this payment record."}):t.items.map((s,r)=>{var g,p;const a=v.has(s._id||r.toString()),I=s.status||"pending";return e.jsxs("div",{className:"grid grid-cols-12 gap-2 px-4 py-3 items-center text-sm hover:bg-blue-50/30 transition-colors",children:[e.jsx("div",{className:"col-span-1 text-center text-gray-500 font-medium",children:r+1}),e.jsx("div",{className:"col-span-2 font-medium text-gray-800 truncate",title:s.itemName,children:s.itemName}),e.jsx("div",{className:"col-span-1 text-gray-500 text-xs",children:s.unit||"-"}),e.jsx("div",{className:"col-span-1 text-center text-gray-700",children:s.quantity}),e.jsx("div",{className:"col-span-1 text-center text-gray-600 font-mono text-xs",children:(g=s.rate)==null?void 0:g.toLocaleString()}),e.jsxs("div",{className:"col-span-1 text-center font-bold text-blue-700 font-mono text-xs",children:["₹",(p=s.totalCost)==null?void 0:p.toLocaleString()]}),e.jsx("div",{className:"col-span-1",children:s.orderId?e.jsxs("span",{className:"bg-gray-100 text-gray-600 px-1.5 py-0.5 rounded text-[10px] font-mono truncate block",title:s.orderId,children:[s.orderId.slice(-6),".."]}):e.jsx("span",{className:"text-gray-300 text-xs",children:"-"})}),e.jsx("div",{className:"col-span-2",children:s.transactionId?e.jsx("span",{className:"bg-green-50 text-green-700 border border-green-100 px-2 py-0.5 rounded text-[10px] font-mono truncate block",title:s.transactionId,children:s.transactionId}):e.jsx("span",{className:"text-gray-300 text-xs italic",children:"Pending"})}),e.jsx("div",{className:"col-span-1 text-xs text-gray-600",children:l(t.dueDate)}),e.jsx("div",{className:"col-span-1 text-center",children:I==="paid"?e.jsxs("span",{className:"text-green-600 text-xs font-bold flex justify-center items-center gap-1",children:[e.jsx("i",{className:"fas fa-check-double"})," Paid"]}):e.jsx("button",{onClick:()=>S(s._id||r.toString(),s.totalCost),disabled:a,className:`
                                                                cursor-pointer
                                                                px-3 py-1.5 rounded-lg text-xs font-semibold transition-all shadow-sm flex items-center justify-center gap-1 w-full
                                                                ${a?"bg-gray-100 text-gray-400 cursor-wait":"bg-white border border-blue-600 text-blue-600 hover:bg-blue-600 hover:text-white"}
                                                            `,children:a?e.jsx("i",{className:"fas fa-spinner fa-spin"}):e.jsxs(e.Fragment,{children:["Pay ",e.jsx("i",{className:"fas fa-angle-right text-[10px]"})]})})})]},r)})}),e.jsx("div",{className:"bg-gray-50 border-t border-gray-200 px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsxs("span",{children:["Showing ",(m=t.items)==null?void 0:m.length," items"]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500"})," Paid"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-600"})," Unpaid"]})]})]})})]})]}),t.notes&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-100 rounded-lg p-4",children:[e.jsxs("h4",{className:"text-sm font-bold text-yellow-800 mb-1",children:[e.jsx("i",{className:"fas fa-sticky-note mr-2"}),"Notes"]}),e.jsx("p",{className:"text-sm text-yellow-800/80",children:t.notes})]})]})})]})};export{H as default};
