import{u as _,a as F,r as x,j as e,M as Q,B as m,t as p}from"./index-BAM0eJUz.js";import{u as U,a as $}from"./procurementApi-SUCPRyEO.js";import{I as R}from"./Input-1UBXZqEj.js";import"./useInfiniteQuery-BGz0VllC.js";const G=()=>{var b,u,y,N,j,v,w;const{shopquoteid:c,id:h}=_(),k=F(),{data:a,isLoading:S,refetch:d}=U(h),{mutateAsync:C,isPending:I}=$(),[g,f]=x.useState(!1),L=async t=>{try{await navigator.clipboard.writeText(t),f(!0),setTimeout(()=>f(!1),1500)}catch{p({title:"Error",description:"Failed to copy link",variant:"destructive"})}},A=()=>{var n;if(!s.generatedLink)return;const t=`Hey, please check this items link:

${s.generatedLink}`,l=(n=a==null?void 0:a.shopDetails)==null?void 0:n.phoneNumber;let i="";l?i=`https://wa.me/${l.replace(/\D/g,"")}?text=${encodeURIComponent(t)}`:i=`https://wa.me/?text=${encodeURIComponent(t)}`,window.open(i,"_blank")},P=async t=>{var l,i;try{t.stopPropagation(),await C({id:h,quoteId:c}),d==null||d(),p({title:"Success",description:"Shop quote selected successfully"})}catch(n){p({variant:"destructive",title:"Error",description:((i=(l=n==null?void 0:n.response)==null?void 0:l.data)==null?void 0:i.message)||(n==null?void 0:n.message)||"operation failed"})}},s=x.useMemo(()=>{var t;return(t=a==null?void 0:a.shopQuotes)==null?void 0:t.find(l=>l._id===c)},[a,c]),o=x.useMemo(()=>{var t;return(t=s==null?void 0:s.selectedUnits)==null?void 0:t.reduce((l,i)=>l+(i.totalCost||0),0)},[s]);if(S)return e.jsx(Q,{});if(!s)return null;const r=s.shopId;return e.jsxs("div",{className:"p-1 max-w-full max-h-full overflow-y-auto space-y-8",children:[e.jsx("header",{className:"flex gap-2 items-center",children:e.jsxs("section",{className:"flex flex-1 justify-between items-center",children:[e.jsxs("div",{className:"flex gap-2 justify-between items-center",children:[e.jsx("div",{onClick:()=>k(-1),className:"bg-blue-50 hover:bg-slate-300 flex items-center justify-between w-8 h-8 border border-[#a6aab8] text-sm cursor-pointer rounded-md px-2 ",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsxs("div",{className:"flex flex-col gap-0",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-blue-700",children:"Shop Rate Quotation"}),e.jsxs("p",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider",children:["Detailed price breakdown from ",((b=s==null?void 0:s.shopId)==null?void 0:b.shopName)||"Vendor"]})]})]}),e.jsx(m,{onClick:t=>P(t),isLoading:I,className:`flex items-center justify-center px-4 rounded-lg text-[10px] font-bold uppercase tracking-tight transition-all shadow-sm 
        ${((u=a==null?void 0:a.selectedShopId)==null?void 0:u._id)===((y=s==null?void 0:s.shopId)==null?void 0:y._id)?"bg-green-600 text-green-700 border border-green-200 cursor-default hover:bg-green-600":"bg-indigo-600 text-white hover:bg-indigo-700 active:scale-95"}`,children:((N=a==null?void 0:a.selectedShopId)==null?void 0:N._id)===((j=s==null?void 0:s.shopId)==null?void 0:j._id)?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-check-circle mr-2 text-sm"}),"Currently Selected Shop"]}):"Select This Shop"})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden mb-6",children:e.jsxs("div",{className:"p-4 flex flex-col relative group transition-all",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-50 flex items-center justify-center text-blue-600",children:e.jsx("i",{className:"fa-solid fa-store text-sm"})}),e.jsx("h4",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Shop Details"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mt-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-[10px] text-gray-400 uppercase font-semibold block",children:"Shop Name"}),e.jsx("p",{className:"font-bold text-gray-900 text-base",children:(r==null?void 0:r.shopDisplayName)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[10px] text-gray-400 uppercase font-semibold block",children:"Contact Person"}),e.jsx("p",{className:"text-sm text-gray-700 font-medium",children:(r==null?void 0:r.firstName)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[10px] text-gray-400 uppercase font-semibold block",children:"Phone Number"}),e.jsx("p",{className:"text-sm text-gray-700 font-mono",children:((v=r==null?void 0:r.phone)==null?void 0:v.mobile)||((w=r==null?void 0:r.phone)==null?void 0:w.work)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[10px] text-gray-400 uppercase font-semibold block",children:"Address"}),e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:(r==null?void 0:r.shopFullAddress)||"N/A"})]})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-indigo-700 mb-4",children:"Items List ðŸ“‹"}),e.jsx("div",{className:"overflow-x-auto rounded border border-gray-200",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-200 text-sm text-gray-700 font-medium",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-5 py-3 text-center border-r border-r-gray-300",children:"S.No"}),e.jsx("th",{className:"px-5 py-3 text-center border-r border-r-gray-300",children:"Item Name"}),e.jsx("th",{className:"px-5 py-3 text-center border-r border-r-gray-300",children:"Quantity"}),e.jsx("th",{className:"px-5 py-3 text-center border-r border-r-gray-300",children:"Unit"}),e.jsx("th",{className:"px-5 py-3 text-center border-r border-r-gray-300",children:"Rate"}),e.jsx("th",{className:"px-5 py-3 text-center",children:"Total"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-100 text-sm",children:s.selectedUnits.map((t,l)=>{var i;return e.jsx(e.Fragment,{children:e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-5 py-3 text-center border-r border-r-gray-300 text-gray-500",children:l+1}),e.jsx("td",{className:"px-5 py-3 text-center border-r border-r-gray-300 font-medium text-gray-900",children:t.subItemName}),e.jsx("td",{className:"px-5 py-3 text-center border-r border-r-gray-300 font-semibold text-gray-700",children:t.quantity}),e.jsx("td",{className:"px-5 py-3 text-center border-r border-r-gray-300 text-gray-600",children:t.unit}),e.jsxs("td",{className:"px-5 py-3 text-center border-r border-r-gray-300 text-gray-700",children:["â‚¹",t.rate]}),e.jsxs("td",{className:"px-5 py-3 text-center font-bold text-gray-900",children:["â‚¹",(i=t.totalCost)==null?void 0:i.toLocaleString()]})]},t._id)})})})]})}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm font-bold text-gray-500 uppercase",children:"Total Cost:"}),e.jsxs("span",{className:"text-2xl font-black text-indigo-700",children:["â‚¹",o==null?void 0:o.toLocaleString("en-IN",{minimumFractionDigits:2})]})]})})]}),s.generatedLink&&e.jsx("div",{children:e.jsxs("div",{className:"space-y-3 animate-in fade-in slide-in-from-top-1 duration-300",children:[e.jsxs("div",{className:"flex items-center gap-2 px-1",children:[e.jsx("i",{className:"fas fa-info-circle text-blue-500 text-xs"}),e.jsx("label",{className:"text-[11px] font-bold text-slate-500 uppercase tracking-wider",children:"To share the link manually, copy the link below and share via your preferred platform"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 items-center",children:[e.jsx(R,{readOnly:!0,value:s.generatedLink,className:"flex-1 text-sm cursor-default"}),e.jsxs(m,{onClick:()=>L(s.generatedLink),variant:"outline",className:"flex gap-2",children:[e.jsx("i",{className:`fas ${g?"fa-check-circle":"fa-copy"}`}),g?"Copied":"Copy"]}),e.jsxs(m,{onClick:A,className:"bg-green-500 hover:bg-green-600 text-white flex gap-2",children:[e.jsx("i",{className:"fab fa-whatsapp"}),"Share"]})]})]})})]})};export{G as default};
