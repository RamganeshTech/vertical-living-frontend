import{b as M,j as e,B as m,r as f,I as y,t as w}from"./index-Dre-3JFT.js";import{i as R,g as q,h as P}from"./materialArrivalApi-D4npgdJc.js";import{i as T}from"./constants-BAzBevij.js";import{Header as U,Footer as V}from"./PublicOrderMaterial-CK68zGtP.js";import{S as O}from"./Skeleton-BL_1k5Uu.js";import{T as Z}from"./TextArea-BQUZo-0N.js";import J from"./MaterialOverviewLoading-qag431ww.js";import"./useQuery-Bz5JFwsG.js";import"./roleCheck-CIuNrpTb.js";import"./orderingMaterialApi-miXLGp_d.js";function ae(){var v,h;const{projectId:g,token:o}=M(),{data:a,isLoading:u,isError:j,error:x,refetch:b}=R(g,o);if(u)return e.jsx(J,{});if(j||!a)return e.jsxs("div",{className:"max-w-xl mx-auto p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center mb-6",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2",children:"⚠️ Error Occurred"}),e.jsx("p",{className:"text-red-500 text-sm mb-4",children:((h=(v=x==null?void 0:x.response)==null?void 0:v.data)==null?void 0:h.message)||(x==null?void 0:x.message)||"Failed to load cost estimation data"}),e.jsx(m,{onClick:()=>b(),className:"bg-red-600 text-white px-4 py-2",children:"Retry"})]});const E=Object.entries(a.materialArrivalList||{});return e.jsxs("div",{className:"min-h-screen  bg-gray-50  space-y-6",children:[e.jsx(U,{}),e.jsxs("main",{className:"flex-1 w-full px-4 py-6 space-y-6 mx-auto sm:max-w-full md:max-w-[95%] lg:max-w-[85%] xl:max-w-[90%]",children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Arrived Materials"}),e.jsxs("section",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200",children:[e.jsx("h2",{className:"text-lg font-semibold text-blue-700 mb-2",children:"Shop Delivery Details"}),u?e.jsx(O,{}):j||!(a!=null&&a.shopDetails)?e.jsx("p",{className:"text-red-500",children:"Failed to load shop details"}):e.jsx("div",{className:"grid sm:grid-cols-2 gap-4 text-sm",children:Object.entries(a.shopDetails).map(([i,l])=>e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium capitalize",children:i.replace(/([A-Z])/g," $1")}),e.jsxs("span",{className:"text-gray-600",children:[" ",typeof l=="string"||typeof l=="number"?l:typeof l=="boolean"?l?"✔️":"❌":"-"]})]},i))})]}),e.jsxs("section",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200",children:[e.jsx("h2",{className:"text-lg font-semibold text-blue-700 mb-2",children:"Site Location Details"}),u?e.jsx(O,{}):j||!(a!=null&&a.deliveryLocationDetails)?e.jsx("p",{className:"text-red-500",children:"Failed to load site details"}):e.jsx("div",{className:"grid sm:grid-cols-2 gap-4 text-sm",children:Object.entries(a.deliveryLocationDetails).map(([i,l])=>e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium capitalize",children:i.replace(/([A-Z])/g," $1")}),e.jsxs("span",{className:"text-gray-600",children:[" ",typeof l=="string"||typeof l=="number"?l:typeof l=="boolean"?l?"✔️":"❌":"-"]})]},i))})]}),e.jsxs("section",{className:"max-w-full mx-auto space-y-4",children:[e.jsx("h2",{className:"text-lg font-bold text-blue-800 mb-4",children:"Material Rooms"}),E.map(([i,l])=>e.jsx(G,{projectId:g,token:o,roomKey:i,items:l,refetch:b},i))]})]}),e.jsx(V,{})]})}const G=({projectId:g,roomKey:o,items:a,refetch:u})=>{const j=q(),x=P(),[b,E]=f.useState(!1),[v,h]=f.useState(!1),[i,l]=f.useState({}),[D,F]=f.useState(null),[A,C]=f.useState(null),[N,S]=f.useState({}),[k,I]=f.useState(null),d=T[o],z=async()=>{try{if(!d||d.length===0)throw new Error("Invalid room type or no fields defined.");const t=d[0],s=i[t];if(!s||s.toString().trim()==="")throw new Error(`The field "${t}" is required.`);if(Object.values(i).every(c=>!c||c.toString().trim()===""))throw new Error("At least one field must be filled.");if(a==null?void 0:a.some(c=>{var B;return((B=c[t])==null?void 0:B.toString().trim().toLowerCase())===s.toString().trim().toLowerCase()}))throw new Error(`"${s}" already exists. Please use a unique value.`);const n=new FormData;n.append("itemData",JSON.stringify(i)),D&&n.append("upload",D),await j.mutateAsync({projectId:g,roomKey:o,formData:n}),w({title:"Added",description:"New item saved."}),h(!1),l({}),F(null),u()}catch(t){w({title:"Error",description:t.message,variant:"destructive"})}},L=async()=>{try{if(!d||d.length===0)throw new Error("Invalid room type or no fields defined.");const t=d[0],s=N[t];if(!s||s.toString().trim()==="")throw new Error(`The field "${t}" is required.`);if(Object.values(N).every(n=>!n||n.toString().trim()===""))throw new Error("At least one field must be filled.");const p=new FormData;p.append("itemData",JSON.stringify(N)),k&&p.append("upload",k),await j.mutateAsync({projectId:g,roomKey:o,formData:p}),w({title:"Updated",description:"Item saved."}),u(),C(null),S({}),I(null)}catch(t){w({title:"Error",description:t.message,variant:"destructive"})}},$=async t=>{try{await x.mutateAsync({projectId:g,roomKey:o,itemId:t}),w({title:"Deleted",description:"Item removed."}),u()}catch(s){w({title:"Error",description:s.message,variant:"destructive"})}};return e.jsxs("div",{className:"mb-4 bg-white rounded-lg overflow-hidden shadow-sm",children:[e.jsxs("button",{className:"w-full px-4 py-3 text-left flex items-center justify-between bg-blue-100 hover:bg-blue-200 transition-all",onClick:()=>E(!b),children:[e.jsx("span",{className:"capitalize font-semibold text-blue-800",children:o==null?void 0:o.replace(/([A-Z])/g," $1")}),e.jsx("i",{className:`fas fa-chevron-${b?"up":"down"}`})]}),e.jsx("div",{className:`transition-max-h duration-300 ease-out overflow-hidden ${b?"max-h-[500px] p-4":"max-h-0 p-0"}`,children:d&&e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("div",{className:"min-w-[1200px] space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-[repeat(auto-fit,minmax(120px,1fr))] bg-blue-50 text-xs sm:text-sm font-semibold text-blue-900 border-b border-blue-200 py-2 px-2 rounded-t mb-2",children:[d.map(t=>e.jsx("div",{className:"text-center capitalize truncate",children:t==="image"?"Upload":t==="verifiedByAccountant"?"Verified":t},t)),e.jsx("div",{className:"text-center truncate",children:"Actions"})]}),(a==null?void 0:a.length)===0&&!v?e.jsxs("div",{className:"py-10 text-center text-gray-500 bg-gray-50 rounded-md shadow-inner",children:[e.jsx("i",{className:"fas fa-box-open text-4xl text-gray-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-700",children:"No Items Found"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Start by adding your first item to this room."}),e.jsxs(m,{onClick:()=>h(!0),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 text-sm rounded",children:[e.jsx("i",{className:"fas fa-plus mr-2"})," Add One"]})]}):a==null?void 0:a.map((t,s)=>e.jsxs("div",{className:"grid grid-cols-[repeat(auto-fit,minmax(120px,1fr))] items-center gap-2 py-2 border-b border-gray-100 hover:bg-gray-50 min-h-[60px]",children:[d.map(r=>{var p;return r==="image"?A===s?e.jsx(y,{type:"file",accept:"image/*",onChange:n=>{var c;return I(((c=n.target.files)==null?void 0:c[0])||null)},className:"w-full text-sm"},r):(p=t.upload)!=null&&p.url?e.jsx("img",{src:t.upload.url,alt:"",className:"w-12 h-12 object-cover rounded mx-auto"}):e.jsx("div",{className:"text-center",children:"No image"}):r==="verifiedByAccountant"?A===s?e.jsx(y,{type:"checkbox",className:"text-center",checked:!!N.verifiedByAccountant,onChange:n=>S(c=>({...c,verifiedByAccountant:n.target.checked}))},r):t!=null&&t.verifiedByAccountant?e.jsx("span",{className:"text-center",children:e.jsx("i",{className:"fas fa-check text-green-600 text-lg"})}):e.jsx("span",{className:"text-center",children:e.jsx("i",{className:"fas fa-xmark text-red-500 text-lg"})}):r==="remarks"?A===s?e.jsx(Z,{value:N[r]||"",className:"text-center w-full text-sm",onChange:n=>S(c=>({...c,remarks:n.target.value}))},r):e.jsx("div",{className:"w-full text-center overflow-x-auto max-h-[70px] overflow-y-auto custom-scrollbar",children:t[r]||"N/A"}):A===s?e.jsx(y,{value:N[r]||"",onChange:n=>S(c=>({...c,[r]:n.target.value})),className:"w-full text-sm"},r):e.jsx("div",{className:"text-center truncate",children:t[r]??"-"})}),e.jsx("div",{className:"flex gap-2 justify-center",children:A===s?e.jsxs(e.Fragment,{children:[e.jsx(m,{size:"sm",onClick:L,children:"Save"}),e.jsx(m,{size:"sm",variant:"ghost",onClick:()=>C(null),children:"Cancel"})]}):e.jsxs(e.Fragment,{children:[e.jsx(m,{size:"sm",variant:"ghost",onClick:()=>{C(s),S(t)},children:e.jsx("i",{className:"fas fa-pen"})}),e.jsx(m,{size:"sm",variant:"ghost",onClick:()=>$(t._id),children:e.jsx("i",{className:"fas fa-trash text-red-500"})})]})})]},s)),!v&&a.length>0&&e.jsx("div",{className:"pt-3 text-center",children:e.jsx(m,{onClick:()=>h(!0),children:"➕ Add Item"})}),v&&e.jsxs("div",{className:"grid grid-cols-[repeat(auto-fit,minmax(120px,1fr))] items-center gap-2 bg-white p-2 rounded mb-4",children:[d.map(t=>t==="image"?e.jsx(y,{type:"file",accept:"image/*",onChange:s=>{var r;return F(((r=s.target.files)==null?void 0:r[0])||null)},className:"border-2 w-full text-sm"},t):t==="verifiedByAccountant"?e.jsx(y,{type:"checkbox",className:"text-center w-full text-sm",checked:!!i.verifiedByAccountant,onChange:s=>l(r=>({...r,verifiedByAccountant:s.target.checked}))},t):e.jsx(y,{placeholder:t,value:i[t]||"",onChange:s=>l(r=>({...r,[t]:s.target.value})),className:"w-full text-sm"},t)),e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsx(m,{size:"sm",className:"h-10",onClick:z,children:"Add"}),e.jsx(m,{size:"sm",variant:"secondary",onClick:()=>h(!1),children:"Cancel"})]})]})]})})})]})};export{ae as default};
