import{r as d,j as e,B as u,a as ae,u as le,t as m}from"./index-BAM0eJUz.js";import{L as w}from"./Label-C8i6KaZe.js";import{I as V}from"./Input-1UBXZqEj.js";import{d as ce,e as oe,f as de,g as ne}from"./shopMaterialDocumentApi-g7G1R7HN.js";import{S as ie}from"./SearchSelect-Dpm5quBu.js";const xe=({isSubmitting:n,formData:f,setModalOpen:g,setFormData:s,handleSubmit:h,errorMessage:p})=>{const b=d.useRef(null);return d.useEffect(()=>{const x=y=>{b.current&&!b.current.contains(y.target)&&g(!1)};return document.addEventListener("mousedown",x),()=>document.removeEventListener("mousedown",x)},[g]),e.jsx("div",{className:"fixed inset-0 z-[120] flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:e.jsxs("div",{ref:b,className:"bg-white rounded-2xl p-8 w-full max-w-md shadow-2xl animate-in zoom-in-95 duration-200",children:[e.jsx("header",{className:"flex justify-between items-center mb-6",children:e.jsxs("h2",{className:"text-xl font-bold flex items-center gap-2 text-gray-900",children:[e.jsx("i",{className:"fas fa-tags text-blue-600"}),"Update Category Name"]})}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("label",{className:"text-[12px] font-bold text-gray-600 uppercase mb-2 block",children:"Category Name"}),e.jsx(V,{autoFocus:!0,className:"w-full p-4 bg-slate-50 border-slate-100 rounded-xl outline-none focus:ring-2 focus:ring-blue-500 font-bold",value:f.categoryName,onChange:x=>s({categoryName:x.target.value}),placeholder:"e.g. Plywood, Plumbing...",onKeyDown:x=>{x.key==="Enter"&&f.categoryName.trim()&&h()}}),p&&e.jsxs("p",{className:"mt-2 text-[11px] text-red-500 font-bold flex items-center gap-1 animate-in fade-in slide-in-from-top-1",children:[e.jsx("i",{className:"fas fa-circle-exclamation"}),p]})]})}),e.jsxs("div",{className:"flex gap-3 mt-10",children:[e.jsx(u,{variant:"outline",className:"flex-1 rounded-xl h-12",onClick:()=>g(!1),disabled:n,children:"Cancel"}),e.jsx(u,{type:"button",isLoading:n,disabled:!f.categoryName.trim()||n,className:"flex-1 bg-blue-600 rounded-xl h-12 shadow-lg shadow-blue-100 text-white font-bold",onClick:h,children:"Update Category"})]})]})})},pe=({mode:n,categoryId:f,materialCategoryOptions:g,initialData:s,rateConfigCategoryName:h,onSubmit:p,isSubmitting:b})=>{var z,A,$,L,R;const x=ae(),{organizationId:y}=le(),[j,k]=d.useState((s==null?void 0:s.categoryName)||""),[i,C]=d.useState([]),[N,U]=d.useState("full"),[v,B]=d.useState(!1),{mutateAsync:T,isPending:F,variables:S}=ce(),{mutateAsync:G,isPending:E}=oe(),{mutateAsync:O,isPending:H}=de(),{mutateAsync:K,isPending:q,variables:J}=ne(),[Q,I]=d.useState(!1),[M,W]=d.useState({categoryName:(s==null?void 0:s.categoryName)||""}),[X,Y]=d.useState(null),[r,P]=d.useState(((z=s==null?void 0:s.file)==null?void 0:z[0])||null),Z=t=>{t.target.files&&C(Array.from(t.target.files))},D=()=>{p&&i.length>0&&(p(j,i),C([]))},ee=async()=>{var t,a,c,l;try{await O({id:s._id,organizationId:y,categoryName:M.categoryName}),m({title:"Success",description:"Category name updated"}),I(!1)}catch(o){const re=((a=(t=o==null?void 0:o.response)==null?void 0:t.data)==null?void 0:a.message)||"Update failed";Y(re),m({title:"Error",description:((l=(c=o==null?void 0:o.response)==null?void 0:c.data)==null?void 0:l.message)||"Update failed",variant:"destructive"})}},_=async t=>{var a,c;try{await T({id:s._id,organizationId:s.organizationId,categoryId:s.materialCategoryId,fileId:t}),m({title:"Success",description:"AI has extracted and saved items to Rate Config!"})}catch(l){m({title:"AI Error",description:((c=(a=l==null?void 0:l.response)==null?void 0:a.data)==null?void 0:c.message)||l.message||"Extraction Failed please try again after some time",variant:"destructive"})}},se=async t=>{var c,l;const a=Array.from(t.target.files||[]);if(a.length!==0)try{await G({categoryName:(s==null?void 0:s.categoryName)||h,materialCategoryId:f,organizationId:y,files:a}),m({title:"Success",description:"Catalogue updated successfully"}),t.target.value=""}catch(o){m({title:"Upload Failed",description:((l=(c=o==null?void 0:o.response)==null?void 0:c.data)==null?void 0:l.message)||"Check your connection",variant:"destructive"})}},te=async t=>{var a,c;try{await K({id:s._id,fileId:t}),(r==null?void 0:r._id)===t&&P(null),m({title:"Success",description:"Files deleted to category"})}catch(l){m({title:"Error",description:((c=(a=l==null?void 0:l.response)==null?void 0:a.data)==null?void 0:c.message)||"Upload Failed",variant:"destructive"})}};return e.jsxs("div",{className:" flex flex-col h-full mx-auto",children:[Q&&e.jsx(xe,{formData:M,setFormData:W,setModalOpen:I,handleSubmit:ee,isSubmitting:H,errorMessage:X}),e.jsxs("header",{className:"sticky top-0 z-20 bg-white border-b border-gray-200  pb-2 pt-2 mb-6 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{type:"button",onClick:()=>x(".."),className:"bg-blue-50 hover:bg-blue-100 flex items-center justify-center w-9 h-9 border border-blue-200 text-blue-600 cursor-pointer rounded-md transition-colors",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-receipt mr-3 text-blue-600"}),n==="create"?"New Shop Record":h||(s==null?void 0:s.categoryName)]})}),e.jsx("p",{className:"text-gray-500 text-sm mt-0.5",children:n==="create"?"Upload shop receipts and categorize them":""})]})]}),e.jsxs("section",{className:"flex gap-4 items-center",children:[n==="create"&&e.jsxs("div",{className:"flex flex-col pr-6 border-r border-gray-200 group",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx(w,{className:"block text-[10px] uppercase tracking-widest font-black text-blue-500",children:v?"New Category":"Category Name"}),e.jsxs("button",{type:"button",onClick:()=>{B(!v),k("")},title:v?"Switch to Selection":"Type New Category",className:"ml-4 text-[10px] flex items-center gap-1 text-gray-400 hover:text-blue-600 transition-colors cursor-pointer",children:[e.jsx("i",{className:"fas fa-repeat text-[10px]"}),e.jsx("span",{className:"font-bold uppercase tracking-tighter",children:"Switch"})]})]}),e.jsx("div",{className:"h-[32px] flex items-center",children:v?e.jsx(V,{value:j,onChange:t=>k(t.target.value),placeholder:"Type new category...",autoFocus:!0,className:"h-9 w-64 bg-white border-blue-200 focus:ring-2 focus:ring-blue-500 transition-all rounded-lg font-semibold text-[14px] shadow-sm"}):e.jsx(ie,{options:g||[],placeholder:"Select Material...",selectedValue:j||"",onSelect:t=>k(t),className:"h-9 w-64 bg-gray-50 border-gray-200 focus:bg-white focus:ring-2 focus:ring-blue-500 transition-all rounded-lg font-semibold text-[14px]"})})]}),n==="view"&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx(w,{className:"mb-1 block text-[10px] uppercase tracking-widest font-black text-blue-500",children:"Display Mode"}),e.jsxs("div",{className:"flex bg-gray-100 p-1 rounded-xl border border-gray-200 h-[32px] items-center",children:[e.jsxs("button",{onClick:()=>U("full"),className:`px-4 cursor-pointer h-full flex items-center text-[11px] font-bold rounded-lg transition-all ${N==="full"?"bg-white shadow-sm text-blue-600":"text-gray-500 hover:text-blue-400"}`,children:[e.jsx("i",{className:"fas fa-file-pdf mr-1.5 text-[10px]"}),"Full Details"]}),e.jsxs("button",{onClick:()=>U("extracted"),className:`px-4 cursor-pointer h-full flex items-center text-[11px] font-bold rounded-lg transition-all ${N==="extracted"?"bg-white shadow-sm text-blue-600":"text-gray-500 hover:text-blue-400"}`,children:[e.jsx("i",{className:"fas fa-bolt mr-1.5 text-[10px]"}),"Extracted"]})]})]})]})]}),e.jsx("main",{className:"flex-1 overflow-y-auto",children:n==="create"?e.jsx("div",{className:"mb-10 overflow-hidden rounded-2xl bg-white shadow-xl shadow-blue-100/40 border border-gray-100",children:e.jsxs("div",{className:"p-8",children:[e.jsx(w,{className:"mb-4 block text-lg font-bold text-gray-800",children:"Upload Document"}),e.jsxs("div",{className:`relative rounded-xl border-2 border-dashed transition-all duration-300 p-12 text-center 
                            ${i.length>0?"border-blue-400 bg-blue-50/20":"border-gray-200 hover:border-blue-500 hover:bg-gray-50"}`,children:[e.jsx("input",{type:"file",multiple:!0,accept:".pdf,image/*",className:"absolute inset-0 z-10 w-full h-full cursor-pointer opacity-0",onChange:Z}),e.jsx("div",{className:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-blue-50 text-blue-600",children:e.jsx("i",{className:"fa-solid fa-cloud-arrow-up text-2xl"})}),e.jsx("p",{className:"text-lg font-semibold text-gray-800",children:i.length>0?`${i.length} files selected`:"Drop your Shop PDFs or Images here"}),e.jsx("p",{className:"mt-1 text-sm text-gray-400 font-medium italic",children:i.length>0?i.map(t=>t.name).join(", "):"Supported: PDFs"})]}),e.jsxs("div",{className:"mt-8 flex justify-end gap-4",children:[i.length>0&&e.jsx(u,{variant:"ghost",onClick:()=>C([]),children:"Clear"}),e.jsxs(u,{variant:"primary",size:"lg",onClick:D,isLoading:b,disabled:!j||i.length===0,className:"min-w-[200px]",children:[e.jsx("i",{className:"fa-solid fa-upload mr-2"})," Upload to Records"]})]})]})}):e.jsxs("div",{className:"flex h-full gap-6",children:[N==="full"&&e.jsxs("div",{className:"w-80 flex flex-col gap-4 overflow-y-auto pr-2 border-r border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between px-1",children:[e.jsxs(w,{className:"text-[10px] uppercase tracking-widest font-black text-gray-400",children:["Documents (",((A=s==null?void 0:s.file)==null?void 0:A.length)||0,")"]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"file",multiple:!0,accept:".pdf,image/*",className:"hidden",id:"add-more-files",onChange:se}),e.jsxs("label",{htmlFor:"add-more-files",className:`cursor-pointer flex items-center justify-center gap-2 px-3 py-1.5 rounded-lg border border-blue-100 bg-blue-50 text-blue-600 transition-all hover:bg-blue-600 hover:text-white
                                                     ${E?"opacity-50 pointer-events-none":""}`,children:[E?e.jsx("i",{className:"fas fa-spinner fa-spin text-[10px]"}):e.jsx("i",{className:"fas fa-plus text-[10px]"}),e.jsx("span",{className:"text-[11px] font-bold uppercase tracking-tight",children:E?"Adding...":"Add file"})]})]})]}),($=s==null?void 0:s.file)==null?void 0:$.map(t=>{const a=(r==null?void 0:r._id)===t._id,c=t.isExtracted;return e.jsxs("div",{onClick:()=>P(t),className:`group cursor-pointer p-3 rounded-xl border transition-all duration-200 bg-white
                        ${a?"border-blue-500 shadow-sm ring-1 ring-blue-500/10":"border-gray-100 hover:border-blue-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"shrink-0 w-8 h-8 rounded-lg flex items-center justify-center bg-gray-50",children:e.jsx("i",{className:`${t.type==="pdf"?"fa-solid fa-file-pdf text-red-400":"fa-solid fa-image text-blue-400"} text-sm`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-[11px] font-bold text-gray-600 leading-snug line-clamp-2 break-words",children:t.originalName}),e.jsxs("div",{className:"flex items-center mt-0.5 gap-2",children:[e.jsx("span",{className:"text-[9px] font-bold text-gray-400 uppercase tracking-tight",children:t.type}),e.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${c?"bg-green-400":"bg-gray-200"}`})]})]})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs(u,{size:"sm",onClick:l=>{l.stopPropagation(),_(t._id)},isLoading:F&&(S==null?void 0:S.fileId)===t._id,className:`w-full  h-7 text-[10px] font-bold uppercase tracking-wider rounded-md shadow-none transition-colors
                            ${a?"bg-blue-600 text-white hover:bg-blue-700":"bg-blue-50 text-blue-600 hover:bg-blue-600 hover:text-white"}`,children:[e.jsx("i",{className:`fas ${c?"fa-sync-alt":"fa-robot"} mr-2`}),c?"Re-Extract":"Extract Details"]}),e.jsx(u,{onClick:()=>te(t._id),className:"hover:text-white text-white bg-red-600 hover:bg-red-600 p-1 transition-colors",isLoading:q&&J.fileId===t._id,children:e.jsx("i",{className:"fas fa-trash-alt text-xs"})})]})]},t._id)})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:N==="full"?e.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 shadow-xl overflow-hidden h-full flex flex-col",children:[r&&e.jsxs("div",{className:"bg-gray-50 p-4 border-b flex justify-between items-center",children:[e.jsx("span",{className:"font-bold text-gray-700 text-sm truncate max-w-md",children:(r==null?void 0:r.originalName)||""}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(u,{variant:"secondary",size:"sm",onClick:()=>window.open(r==null?void 0:r.url,"_blank"),children:[e.jsx("i",{className:"fa-solid fa-expand mr-2"})," Fullscreen"]}),!(r!=null&&r.isExtracted)&&e.jsxs(u,{variant:"primary",size:"sm",onClick:()=>_(r==null?void 0:r._id),isLoading:F,children:[e.jsx("i",{className:"fas fa-magic mr-2"})," Extract"]})]})]}),e.jsx("div",{className:"flex-1 bg-gray-100",children:((L=s==null?void 0:s.file)==null?void 0:L.length)>0?r?r.type==="pdf"?e.jsx("iframe",{src:`${r.url}#view=FitH`,className:"w-full h-full border-none",allow:"fullscreen",title:"PDF Viewer",style:{pointerEvents:"all"}}):e.jsx("div",{className:"w-full h-full flex items-center justify-center p-10",children:e.jsx("img",{src:r.url,alt:"Shop Doc",className:"max-w-full max-h-full object-contain shadow-2xl rounded-lg"})}):e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center text-gray-400 gap-3",children:[e.jsx("i",{className:"fas fa-arrow-left animate-bounce"}),e.jsx("p",{className:"font-bold text-sm uppercase tracking-tighter",children:"Please select a file from the sidebar"})]}):e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center text-slate-300 bg-slate-50",children:[e.jsx("i",{className:"fas fa-file-circle-exclamation text-6xl mb-4"}),e.jsx("p",{className:"font-black text-xs uppercase tracking-[0.2em]",children:"No files uploaded yet"}),e.jsx("p",{className:"text-[10px] mt-2",children:"Upload a PDF or Image to see it here"})]})})]}):e.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 shadow-xl overflow-hidden flex flex-col h-[80vh]",children:[e.jsx("div",{className:"p-6 border-b border-gray-100 bg-gray-50/50 flex justify-between items-center",children:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 flex items-center",children:[e.jsx("i",{className:"fas fa-microchip mr-2 text-blue-600"}),"AI Extracted Specifications"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Structured data generated by Gemini 2.0"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50/30 custom-scrollbar",children:((R=s==null?void 0:s.extractDetails)==null?void 0:R.length)>0?e.jsx("div",{className:"flex justify-center bg-gray-50/30 py-8 px-4",children:e.jsx("div",{className:"w-full max-w-4xl bg-white rounded-2xl border border-gray-200 shadow-sm overflow-hidden",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-slate-50 border-b border-gray-200",children:[e.jsx("th",{className:"px-8 py-4 text-left text-xs font-bold text-gray-800 uppercase tracking-widest w-20",children:"#"}),e.jsx("th",{className:"px-8 py-4 text-left text-xs font-bold text-gray-800 uppercase tracking-widest w-1/3",children:"Brand"}),e.jsx("th",{className:"px-8 py-4 text-left text-xs font-bold text-gray-800 uppercase tracking-widest",children:"Item"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:s.extractDetails.map((t,a)=>e.jsxs("tr",{className:"hover:bg-blue-50/10 transition-colors group",children:[e.jsx("td",{className:"px-8 py-4 text-sm text-gray-400 font-mono border-r border-gray-50",children:String(a+1).padStart(2,"0")}),e.jsx("td",{className:"px-8 py-4 border-r border-gray-50",children:e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-lg text-[11px] font-black bg-blue-50 text-blue-700 border border-blue-100 uppercase tracking-tighter",children:t.brand||"Generic"})}),e.jsx("td",{className:"px-8 py-4 text-sm font-semibold text-gray-700 group-hover:text-blue-900",children:t.itemName})]},a))})]})})}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-32",children:[e.jsx("div",{className:"w-20 h-20 bg-blue-50 rounded-full flex items-center justify-center mb-4 border border-blue-100 shadow-inner",children:e.jsx("i",{className:"fas fa-robot text-3xl text-blue-300"})}),e.jsx("h4",{className:"text-gray-900 font-bold text-lg",children:"No Data Extracted"}),e.jsx("p",{className:"text-gray-500 text-sm max-w-xs text-center mt-1",children:"To Exgtract the limited details from the pdf use the Extract button to automatically identify brands and items from this document."})]})})]})})]})})]})};export{pe as S};
