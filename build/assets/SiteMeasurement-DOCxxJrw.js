import{a as k,r as v,j as e,d as se,u as te}from"./index-CluF71pO.js";import{a as ae,b as le,c as re,u as ie,d as ne,e as de,f as oe,g as ce,h as me,i as ue,j as xe,k as ge,l as he,m as pe}from"./siteMeasurementApi-Cc1W2-Zd.js";import{t as c}from"./toast-BSC5QTk1.js";import{C as B}from"./Card-DAuv-BhQ.js";import{A as be,S as fe}from"./AssignStaff-XMsVnvoX.js";import{R as je}from"./StageFileUploader-Bnpb44OA.js";import{B as C}from"./Button-HSHMZ35l.js";import{I as Ne}from"./Input-DzM7f8mY.js";import{N as ye,f as ve}from"./constants-DELhKX7a.js";import{d as W}from"./downloadFile-zCVCGP_u.js";import{R as we}from"./ResetStageButton-Cg1In3bV.js";import Se from"./MaterialOverviewLoading-Dyvdc7EB.js";import{S as Ce}from"./ShareDocumentWhatsapp-p81hpp10.js";import"./useQuery-BSXZQ8G2.js";import"./useBaseQuery-CtUSRv5w.js";import"./useMutation-Deoeq1CZ.js";import"./roleCheck-C6Z-poLV.js";import"./getAllUsersApi-thQGgwfV.js";import"./ImageGalleryMain-Cc8rQCKI.js";import"./VideoGalleryMain-BCuAPzmr.js";import"./Skeleton-BFphkLNL.js";import"./documentationApi-7FURTjOv.js";import"./requirementFormApi-BZFcqrOJ.js";const Fe=({file:s,setPreviewImage:m,room:o})=>{const{projectId:h}=k(),[j,l]=v.useState(!1),[d,i]=v.useState((s==null?void 0:s.categoryName)||""),{mutateAsync:x,isPending:w}=ae(),{mutateAsync:F,isPending:p}=le(),g=async a=>{var t,b;try{await x({roomId:o._id,uploadId:a,projectId:h}),c({title:"Success",description:"Image deleted successfully"})}catch(N){c({title:"Error",description:((b=(t=N==null?void 0:N.response)==null?void 0:t.data)==null?void 0:b.message)||"Failed to delete",variant:"destructive"})}},y=async()=>{var a,t;if(!d||d===s.categoryName){l(!1);return}try{await F({uploadId:s._id,categoryName:d,roomId:o._id,projectId:h}),c({title:"Updated",description:"Image name updated successfully"})}catch(b){c({title:"Error",description:((t=(a=b==null?void 0:b.response)==null?void 0:a.data)==null?void 0:t.message)||"Failed to update name",variant:"destructive"})}finally{l(!1)}};return e.jsxs("div",{className:"group bg-white transition-all duration-300 hover:z-10",children:[e.jsxs("div",{className:"relative w-full overflow-hidden border-4 border-white  transition-all duration-300 cursor-pointer",onClick:()=>m(s==null?void 0:s.url),children:[e.jsx("div",{className:"aspect-square w-full",children:e.jsx("img",{src:s.url||ye,alt:s.originalName,className:"w-full h-full transition-transform duration-300 "})}),e.jsx("div",{className:"absolute inset-0 bg-opacity-0 group-hover:bg-opacity-40 transition-all duration-300 items-center justify-center hidden md:flex",children:e.jsx("div",{className:"flex space-x-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300 transform translate-y-4 group-hover:translate-y-0",children:["eye","trash","download"].map(a=>e.jsx(C,{variant:"secondary",size:"sm",onClick:t=>{t.stopPropagation(),a==="eye"?m(s==null?void 0:s.url):a==="trash"?g(s._id):W({src:s==null?void 0:s.url,alt:(s==null?void 0:s.originalName)||"image"})},disabled:a==="trash"&&w,className:`rounded-full bg-white hover:bg-gray-100 shadow-lg transition-all duration-200 ${a==="trash"?"hover:bg-red-50":""}`,children:e.jsx("i",{className:`w-3 h-3 fas fa-${a} ${a==="trash"?"text-red-500":a==="download"?"text-blue-500":"text-gray-600"}`})},a))})}),e.jsx("div",{className:"absolute top-2 right-[2px] flex flex-col space-y-1 sm:hidden",children:["eye","trash","download"].map(a=>e.jsx(C,{variant:"secondary",size:"sm",onClick:t=>{t.stopPropagation(),a==="eye"?m(s==null?void 0:s.url):a==="trash"?g(s._id):W({src:s==null?void 0:s.url,alt:(s==null?void 0:s.originalName)||"image"})},disabled:a==="trash"&&w,className:`w-6 h-6 p-0 rounded-full bg-white/90 backdrop-blur-sm border shadow-sm transition-all duration-200 ${a==="trash"?"border-red-200 hover:border-red-300 hover:bg-red-50":a==="download"?"border-blue-200 hover:border-blue-300 hover:bg-blue-50":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,children:e.jsx("i",{className:`w-3 h-3 fas fa-${a} ${a==="trash"?"text-red-500":a==="download"?"text-blue-500":"text-gray-600"}`})},a))})]}),e.jsx("div",{onClick:a=>a.stopPropagation(),className:"my-1 flex items-center justify-between px-1",children:j?e.jsxs("div",{className:"flex w-full items-center space-x-1",children:[e.jsx("input",{value:d,onChange:a=>i(a.target.value),className:"text-sm border px-1 py-0.5 rounded w-full",onKeyDown:a=>{a.key==="Enter"&&y()}}),e.jsx("button",{onClick:y,disabled:p,className:"text-blue-600 cursor-pointer hover:text-blue-800 text-xs",children:p?e.jsx("i",{className:"fa fa-spinner animate-spin"}):e.jsx("i",{className:"fas fa-check"})}),e.jsx("button",{onClick:()=>{l(!1),i(s.categoryName||"")},className:"text-red-500 cursor-pointer hover:text-red-700 text-xs",children:e.jsx("i",{className:"fas fa-times"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-sm text-gray-800 truncate max-w-[80%]",children:(s==null?void 0:s.categoryName)||"No category"}),e.jsx("button",{className:"text-gray-500 cursor-pointer hover:text-blue-600 text-xs",onClick:()=>l(!0),children:e.jsx("i",{className:"fas fa-pen"})})]})})]},s._id)},ke=({room:s,onEdit:m,onDelete:o,deleteRoomLoading:h})=>{const{projectId:j}=k(),[l,d]=v.useState(null),i=(s==null?void 0:s.uploads)||[],x=s.length&&s.breadth?(s.length*s.breadth).toFixed(2):null,{mutateAsync:w,isPending:F}=re(),p=async g=>{var y,a;try{const t=g.target.files;if(!t||t.length===0)return;const b=Array.from(t).filter(f=>f.type.startsWith("image/"));if(b.length===0){c({title:"Error",description:"Please select only image files",variant:"destructive"});return}b.length!==t.length&&c({title:"Warning",description:"Only image files were uploaded. PDFs were skipped.",variant:"destructive"});const N=new FormData;b.forEach(f=>N.append("file",f)),await w({roomId:s._id,files:N,projectId:j}),c({title:"Success",description:"Images uploaded successfully"}),g.target.value=""}catch(t){c({title:"Error",description:((a=(y=t==null?void 0:t.response)==null?void 0:y.data)==null?void 0:a.message)||"Failed to upload",variant:"destructive"})}};return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-2 sm:p-6 mb-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold text-blue-700",children:s.name}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>m(s),className:"text-blue-600 hover:text-blue-800",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx(C,{isLoading:h,onClick:o,variant:"ghost",className:"!text-red-600 hover:text-red-800 bg-white shadow-none hover:!bg-none",children:e.jsx("i",{className:"fas fa-trash-can"})})]})]}),e.jsxs("div",{className:"space-y-4 w-full",children:[e.jsxs("div",{className:"flex items-center justify-between w-full relative",children:[e.jsx(Ne,{type:"file",multiple:!0,accept:"image/*",placeholder:"Select images",onChange:p,disabled:F,className:F?"pr-10 opacity-70 cursor-not-allowed w-full":""}),F&&e.jsx("div",{className:"absolute inset-y-0 right-2 flex items-center",children:e.jsxs("svg",{className:"animate-spin h-5 w-5 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4l3.5-3.5L12 0v4a8 8 0 100 16v4l3.5-3.5L12 20v-4a8 8 0 01-8-8z"})]})})]}),e.jsxs("div",{className:"my-6",children:[e.jsx("h4",{className:"text-lg font-semibold mb-4 text-gray-800",children:"Room Images"}),i.length===0?e.jsx("div",{className:"text-gray-500 text-sm italic bg-gray-50 p-8 rounded-lg text-center border-2 border-dashed border-gray-200",children:"No images uploaded yet."}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 p-4 bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl",children:i.map(g=>e.jsx(Fe,{room:s,setPreviewImage:d,file:g}))})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Length"}),e.jsxs("p",{className:"font-semibold text-gray-800",children:[s.length||0," ft"]})]}),e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Breadth"}),e.jsxs("p",{className:"font-semibold text-gray-800",children:[s.breadth||0," ft"]})]}),e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Height"}),e.jsxs("p",{className:"font-semibold text-gray-800",children:[s.height||0," ft"]})]})]}),x&&e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:e.jsxs("p",{className:"text-blue-700 font-medium text-center",children:["Total Area: ",x," sq.ft"]})}),l&&e.jsx("div",{onClick:()=>d(null),className:"fixed inset-0 z-50 flex items-center justify-center bg-opacity-80 backdrop-blur-sm",children:e.jsxs("div",{onClick:g=>g.stopPropagation(),className:"relative bg-white rounded-xl shadow-2xl max-w-[90%] max-h-[90%] p-2 overflow-hidden",children:[e.jsx("button",{onClick:()=>d(null),className:"absolute top-4 right-4 z-10 w-8 h-8 bg-opacity-50 hover:bg-opacity-70 text-white rounded-full flex items-center justify-center transition-all duration-200",children:e.jsx("i",{className:"fas fa-times text-sm"})}),e.jsx("img",{src:l||"/placeholder.svg",alt:"Preview",className:"w-full max-h-[80vh] object-contain mx-auto rounded-lg"})]})})]})},Ae=({measurementData:s,handleDeleteSiteMeasurement:m,deleteRoomLoading:o,setShowSiteForm:h,setShowRoomForm:j,handleEditRoom:l,handleDeleteRoom:d})=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Site Measurements"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>h(!0),className:"px-2 sm:px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Edit"}),e.jsx("button",{onClick:()=>m(),className:"px-2 sm:px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"Delete"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total Plot Area"}),e.jsx("p",{className:"text-lg font-semibold text-blue-700",children:s.siteDetails.totalPlotAreaSqFt!==null?`${s.siteDetails.totalPlotAreaSqFt} sq.ft`:"Not mentioned"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Built-up Area"}),e.jsx("p",{className:"text-lg font-semibold text-blue-700",children:s.siteDetails.builtUpAreaSqFt!=null?`${s.siteDetails.builtUpAreaSqFt} sq.ft`:"Not mentioned"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Road Facing"}),e.jsx("p",{className:"text-lg font-semibold text-blue-700",children:s.siteDetails.roadFacing===!0?"YES":s.siteDetails.roadFacing===!1?"NO":"Not mentioned"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Number of Floors"}),e.jsx("p",{className:"text-lg font-semibold text-blue-700",children:s.siteDetails.numberOfFloors!=null?s.siteDetails.numberOfFloors:"Not mentioned"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Is having Slope"}),e.jsx("p",{className:"text-lg font-semibold text-blue-700",children:s.siteDetails.hasSlope===!0?"YES":s.siteDetails.hasSlope===!1?"NO":"Not mentioned"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Is Boundary Wall exists"}),e.jsx("p",{className:"text-lg font-semibold text-blue-700",children:s.siteDetails.boundaryWallExists===!0?"YES":s.siteDetails.boundaryWallExists===!1?"NO":"Not mentioned"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Additional Notes"}),e.jsx("p",{className:"text-lg font-semibold text-blue-700",children:s.siteDetails.additionalNotes?s.siteDetails.additionalNotes:"Not mentioned"})]})]})]}),s.siteDetails.totalPlotAreaSqFt!==null&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Rooms"}),e.jsx("button",{onClick:()=>j(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"+ Add Room"})]}),s.rooms.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})})}),e.jsx("p",{className:"text-gray-500",children:"No rooms added yet"})]}):e.jsx("div",{className:"mt-4 grid grid-cols-1 gap-6",children:s.rooms.map((i,x)=>e.jsx(ke,{room:i,onEdit:()=>l(i),onDelete:()=>d(i._id),deleteRoomLoading:o},x))})]})]}),Re=v.memo(Ae),Pe=({roomDetails:s,setRoomDetails:m,handleRoomSubmit:o,setShowRoomForm:h,updateRoomLoading:j,createRoomLoading:l,editingRoomId:d})=>e.jsx("div",{className:"fixed inset-0 bg-black/70 bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-md p-6",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-6",children:d?"Edit Room":"Add New Room"}),e.jsxs("select",{value:s.name||"",onChange:i=>m(x=>({...x,name:i.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent mb-4",children:[e.jsx("option",{value:"",children:"Select Room Type"}),ve.map(i=>e.jsx("option",{value:i,children:i}))]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"",children:"Length (ft)"}),e.jsx("input",{type:"number",placeholder:"Length (ft)",value:s.length||0,onChange:i=>m({...s,length:Number(i.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"",children:"Breadth (ft)"}),e.jsx("input",{type:"number",placeholder:"Breadth (ft)",value:s.breadth||0,onChange:i=>m({...s,breadth:Number(i.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"",children:"Height (ft)"}),e.jsx("input",{type:"number",placeholder:"Height (ft)",value:s.height||0,onChange:i=>m({...s,height:Number(i.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),s.length&&s.breadth&&e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg mb-4",children:e.jsxs("p",{className:"text-blue-700 font-medium",children:["Calculated Area: ",(Number(s.length)*Number(s.breadth)).toFixed(2)," sq.ft"]})}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{onClick:()=>h(!1),className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsx(C,{isLoading:d?j:l,onClick:o,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:d?"Edit Room":"Add Room"})]})]})}),Ee=({siteDetails:s,updatePending:m,setSiteDetails:o,handleSiteSubmit:h,setShowSiteForm:j})=>e.jsx("div",{className:"fixed inset-0 bg-black/70 bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-2xl p-6",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-6",children:"Site Measurements"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"",children:"Total Plot Area (sq.ft)"}),e.jsx("input",{type:"number",placeholder:"Total Plot Area (sq.ft)",value:s.totalPlotAreaSqFt||0,onChange:l=>o({...s,totalPlotAreaSqFt:Number(l.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"",children:"Built-up Area (sq.ft)"}),e.jsx("input",{type:"number",placeholder:"Built-up Area (sq.ft)",value:s.builtUpAreaSqFt||0,onChange:l=>o({...s,builtUpAreaSqFt:Number(l.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"",children:"Number of Floors"}),e.jsx("input",{type:"number",placeholder:"Number of Floors",value:s.numberOfFloors||0,onChange:l=>o({...s,numberOfFloors:Number(l.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 mb-4",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:s.hasSlope??!1,onChange:l=>o({...s,hasSlope:l.target.checked}),className:"mr-2"}),"Has Slope"]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:s.roadFacing??!1,onChange:l=>o({...s,roadFacing:l.target.checked}),className:"mr-2"}),"Road Facing"]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:s.boundaryWallExists??!1,onChange:l=>o({...s,boundaryWallExists:l.target.checked}),className:"mr-2"}),"Boundary Wall Exists"]})]}),e.jsx("textarea",{placeholder:"Additional Notes",value:s.additionalNotes||"",onChange:l=>o({...s,additionalNotes:l.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent mb-4",rows:4}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(C,{variant:"secondary",onClick:()=>j(!1),className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsx(C,{variant:"primary",onClick:h,isLoading:m,children:"Save Details"})]})]})}),Me=v.memo(Ee),Ie={totalPlotAreaSqFt:null,builtUpAreaSqFt:null,roadFacing:null,numberOfFloors:null,hasSlope:!1,boundaryWallExists:!1,additionalNotes:null},_={name:null,length:null,breadth:null,height:null,uploads:[]};function as(){var I,L,q,U,O;const{projectId:s,organizationId:m}=k(),{isMobile:o,openMobileSidebar:h}=se();if(!s)return;const j=te(),[l,d]=v.useState(!1),[i,x]=v.useState(!1),[w,F]=v.useState(Ie),[p,g]=v.useState(_),[y,a]=v.useState(null);let{data:t,isLoading:b,refetch:N,error:f}=ie({projectId:s});const z=ne(),A=de(),R=oe(),P=ce(),E=me(),T=ue(),M=xe(),{mutateAsync:$,isPending:H}=ge(),{mutateAsync:Y,isPending:G}=he(),{mutateAsync:K,isPending:V}=pe(),J=async()=>{var n,u;try{Object.values(t.siteDetails).some(S=>typeof S=="number")?await R.mutateAsync({projectId:s,payload:w}):await z.mutateAsync({projectId:s,siteDetails:w}),d(!1),c({description:"Site details updated successfully",title:"Success"})}catch(r){c({title:"Error",description:((u=(n=r==null?void 0:r.response)==null?void 0:n.data)==null?void 0:u.message)||r.message||"Failed to save site details",variant:"destructive"})}},Q=async()=>{var n,u;try{if(!p.name)throw new Error("please select the name");const r=p.length&&p.breadth?(Number(p.length)*Number(p.breadth)).toFixed(2):null,S={...p,area:r};y?await P.mutateAsync({projectId:s,roomId:y,room:S}):await A.mutateAsync({projectId:s,room:S}),x(!1),a(null),g(_),c({description:y?"Room updated":"Room added",title:"Success"})}catch(r){c({title:"Error",description:((u=(n=r==null?void 0:r.response)==null?void 0:n.data)==null?void 0:u.message)||(r==null?void 0:r.message)||"Operation failed",variant:"destructive"})}},X=async n=>{var u,r;try{await E.mutateAsync({projectId:s,roomId:n}),c({description:"Room deleted",title:"Success"})}catch(S){c({title:"Error",description:((r=(u=S==null?void 0:S.response)==null?void 0:u.data)==null?void 0:r.message)||"Delete failed",variant:"destructive"})}},Z=async()=>{var n,u;try{await T.mutateAsync({projectId:s}),c({description:"Site measurement deleted",title:"Success"})}catch(r){c({title:"Error",description:((u=(n=r==null?void 0:r.response)==null?void 0:n.data)==null?void 0:u.message)||"Delete failed",variant:"destructive"})}},D=async()=>{var n,u;try{await M.mutateAsync({projectId:s}),c({description:"Completion updated",title:"Success"}),j("../sampledesign")}catch(r){c({title:"Error",description:((u=(n=r==null?void 0:r.response)==null?void 0:n.data)==null?void 0:u.message)||"Update failed",variant:"destructive"})}},ee=n=>{g(n),a(n==null?void 0:n._id),x(!0)};return b?e.jsx(Se,{}):e.jsxs("div",{className:"container mx-auto px-2 py-2 max-w-full h-full w-full overflow-y-auto custom-scrollbar",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center mb-6 gap-4",children:[e.jsxs("div",{className:"w-full sm:w-auto",children:[e.jsxs("h2",{className:"text-2xl sm:text-3xl font-semibold text-blue-600 flex items-center",children:[o&&e.jsx("button",{onClick:h,className:"mr-3 p-2 rounded-md border border-gray-300 hover:bg-gray-100",title:"Open Menu",children:e.jsx("i",{className:"fa-solid fa-bars"})}),e.jsx("i",{className:"fa-solid fa-receipt mr-2"})," Site Measurement"]}),e.jsx("p",{className:"text-gray-600 hidden sm:block text-sm sm:text-base",children:"Plan your dream home"})]}),e.jsxs("div",{className:"flex flex-wrap sm:flex-nowrap items-center gap-2  !w-[100%] sm:!w-[50%] lg:!w-[60%] justify-start lg:justify-end",children:[e.jsxs(C,{isLoading:M.isPending,onClick:D,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2  w-full sm:w-auto",children:[e.jsx("i",{className:"fa-solid fa-circle-check mr-2"})," Mark Complete"]}),e.jsx(we,{projectId:s,stageNumber:2,stagePath:"sitemeasurement",className:"sm:!max-w-[20%] w-full"}),!f&&e.jsx(Ce,{projectId:s,stageNumber:"2",className:"w-full sm:w-fit",isStageCompleted:t==null?void 0:t.status}),e.jsx(be,{stageName:"SiteMeasurementModel",projectId:s,organizationId:m,currentAssignedStaff:(t==null?void 0:t.assignedTo)||null,className:"w-full sm:w-auto"})]})]}),f&&e.jsxs("div",{className:"max-w-xl mx-auto mt-4 p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2",children:"⚠️ Error Occurred"}),e.jsx("p",{className:"text-red-500 text-sm mb-4",children:((L=(I=f==null?void 0:f.response)==null?void 0:I.data)==null?void 0:L.message)||"Failed to load data"}),e.jsx(C,{onClick:()=>N(),className:"bg-red-600 text-white px-4 py-2",children:"Retry"})]}),!f&&e.jsxs(B,{className:"p-4 mb-4 shadow border-l-4 border-blue-600 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-3 text-blue-700 text-sm font-medium mb-2",children:[e.jsx("i",{className:"fa-solid fa-clock text-blue-500 text-lg"}),e.jsx("span",{children:"Stage Timings"})]}),e.jsx(fe,{completedAt:(q=t==null?void 0:t.timer)==null?void 0:q.compltedAt,stageName:"sitemeasurement",formId:t==null?void 0:t._id,projectId:s,deadLine:(U=t==null?void 0:t.timer)==null?void 0:U.deadLine,startedAt:(O=t==null?void 0:t.timer)==null?void 0:O.startedAt,refetchStageMutate:N,deadLineMutate:$,isPending:H})]}),!f&&e.jsx("div",{className:"mb-6",children:e.jsx(B,{className:"p-4 shadow border-l-4 border-blue-500 bg-white",children:e.jsx(je,{autoUpload:!0,formId:t==null?void 0:t._id,refetch:N,existingUploads:t==null?void 0:t.uploads,onUploadComplete:N,uploadFilesMutate:Y,uploadPending:G,projectId:s,onDeleteUpload:K,deleteFilePending:V})})}),!f&&e.jsxs(e.Fragment,{children:[!Object.values((t==null?void 0:t.siteDetails)||{}).some(n=>n!==null)&&!l?e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})})}),e.jsx("p",{className:"text-gray-600 mb-4",children:"No Site Details Added"}),e.jsx("button",{onClick:()=>d(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"Add Site Details"})]}):e.jsx(Re,{measurementData:t,handleDeleteSiteMeasurement:Z,setShowSiteForm:d,setShowRoomForm:x,handleEditRoom:ee,handleDeleteRoom:X,deleteRoomLoading:E.isPending}),l&&e.jsx(Me,{siteDetails:w,setSiteDetails:F,handleSiteSubmit:J,setShowSiteForm:d,updatePending:R.isPending}),i&&e.jsx(Pe,{handleRoomSubmit:Q,setShowRoomForm:x,roomDetails:p,setRoomDetails:g,updateRoomLoading:P.isPending,createRoomLoading:A.isPending,editingRoomId:y})]})]})}export{as as default};
