import{j as e,b as U,u as T,r as w}from"./index-C2KHEypQ.js";import{u as z,b as Q,c as V,d as Y}from"./MaterialInventoryCartApi-BfbDyHx4.js";import{u as H}from"./projectApi-BtQy_PTR.js";import{C as f,b as M,d as R,a as p,c as $}from"./Card-C6pBT2vm.js";import{B as m}from"./Button-Cz-akwNZ.js";import{B as G}from"./Badge-lrpkAPHe.js";import{t as g}from"./toast-BSC5QTk1.js";import J from"./MaterialOverviewLoading-CibqMDhh.js";import{t as v}from"./dateFormator-BGKi5rfZ.js";import{S as K}from"./SearchSelectNew-DXgMXAyq.js";import{L as W}from"./Label-DwpAHG3d.js";import{d as X}from"./downloadFile--yCVHHwF.js";import"./useQuery-BmC89CNR.js";import"./useMutation-DaAue-fW.js";import"./roleCheck-DBD7VNWv.js";import"./Skeleton-ZIGjVa8t.js";const pe=()=>e.jsxs(f,{className:"mt-6",children:[e.jsx(M,{children:e.jsxs(R,{className:"text-base sm:text-lg flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-circle-info text-blue-600"}),"Order Information"]})}),e.jsx(p,{children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-blue-50 rounded-lg",children:[e.jsx("i",{className:"fa-solid fa-truck text-blue-600 mt-1"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800",children:"Delivery"}),e.jsx("p",{className:"text-gray-600 text-xs mt-1",children:"Estimated 5-7 business days"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-green-50 rounded-lg",children:[e.jsx("i",{className:"fa-solid fa-shield-halved text-green-600 mt-1"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800",children:"Secure Checkout"}),e.jsx("p",{className:"text-gray-600 text-xs mt-1",children:"Your data is protected"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-purple-50 rounded-lg",children:[e.jsx("i",{className:"fa-solid fa-headset text-purple-600 mt-1"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800",children:"Support"}),e.jsx("p",{className:"text-gray-600 text-xs mt-1",children:"24/7 customer service available"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-orange-50 rounded-lg",children:[e.jsx("i",{className:"fa-solid fa-rotate-left text-orange-600 mt-1"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800",children:"Returns"}),e.jsx("p",{className:"text-gray-600 text-xs mt-1",children:"30-day return policy"})]})]})]})})]}),Z=({item:l,onUpdateQuantity:j,onRemoveItem:i,isUpdating:u,isRemoving:o})=>{const t=(l==null?void 0:l.specification)||{},b=t.imageUrl||t.image||null,n=t==null?void 0:t.itemCode;return e.jsxs(f,{className:"mb-4 shadow-xl border border-gray-100 hover:shadow-2xl transition-shadow",children:[e.jsx(M,{className:"flex flex-row items-center justify-between pb-2",children:e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[b&&e.jsx("img",{src:b,alt:"product",className:"w-16 h-16 sm:w-20 sm:h-20 object-cover rounded-lg border border-gray-400 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start gap-2 flex-wrap",children:[e.jsx(R,{className:"text-base sm:text-lg font-bold text-blue-900",children:v(t.subcategory||t.name||t.model||t.category||"Unnamed",30)}),(l==null?void 0:l.orderedBefore)&&e.jsxs(G,{className:"bg-blue-100 text-blue-700 text-xs whitespace-nowrap",children:[e.jsx("i",{className:"fa-solid fa-clock-rotate-left mr-1"}),"Reorder"]})]}),e.jsxs($,{className:"text-xs text-gray-500 mt-1",children:[t.category&&e.jsx("span",{className:"mr-2",children:e.jsx(G,{variant:"secondary",children:t.category})}),t.model&&e.jsxs("span",{className:"mr-2",children:["Model: ",e.jsx("span",{className:"font-semibold",children:v(t.model,14)})]}),t.itemCode&&e.jsxs("span",{className:"mr-2",children:["Code: ",e.jsx("span",{className:"font-semibold",children:t.itemCode})]})]})]})]})}),e.jsxs(p,{children:[e.jsx("div",{className:"flex flex-wrap gap-3 text-xs text-gray-700 mb-4",children:Object.entries(t).map(([s,x])=>["image","imageUrl","_id","organizationId","series","cct","mrp","itemCode","name","subcategory","category","model","hasVariants"].includes(s)||typeof x=="object"||x===void 0||x===null?null:e.jsxs("div",{className:"bg-gray-50 rounded px-2 py-1 border border-gray-100",children:[e.jsxs("span",{className:"font-semibold capitalize",children:[v(s,12),":"]})," ",v(String(x),18)]},s))}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 border-t border-gray-200 pt-4",children:[e.jsxs("div",{className:"space-y-1",children:[t.mrp&&e.jsxs("p",{className:"text-xs sm:text-sm text-gray-500",children:["Unit Price: ₹",t.mrp.toLocaleString("en-IN",{minimumFractionDigits:2})]}),e.jsxs("p",{className:"text-lg sm:text-xl font-bold text-blue-600",children:["Item Total: ₹",l.singleItemCost.toLocaleString("en-IN",{minimumFractionDigits:2})]})]}),e.jsxs("div",{className:"flex items-center gap-3 w-full sm:w-auto",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-gray-50 rounded-lg p-1 border border-gray-200",children:[e.jsx(m,{onClick:()=>j(n,Math.max(1,l.quantity-1)),className:"w-8 h-8 p-0 bg-red-600 hover:bg-red-700 text-white rounded-md shadow-sm",variant:"danger",disabled:u||l.quantity<=1,isLoading:!1,children:e.jsx("i",{className:"fa-solid fa-minus text-sm"})}),e.jsx("span",{className:"w-12 text-center font-bold text-gray-800 text-lg",children:l.quantity}),e.jsx(m,{onClick:()=>j(n,l.quantity+1),variant:"primary",className:"w-8 h-8 p-0 bg-blue-600 hover:bg-blue-700 rounded-md shadow-sm",disabled:u,isLoading:!1,children:e.jsx("i",{className:"fa-solid fa-plus text-sm"})})]}),e.jsx(m,{onClick:()=>i(n),variant:"danger",className:"w-10 h-10 p-0 bg-red-600 hover:bg-red-700 text-white rounded-lg",disabled:o,isLoading:o,children:e.jsx("i",{className:"fa-solid fa-trash text-sm"})})]})]})]})]})},je=()=>{var F,P,k,_,D;const{organizationId:l}=U(),j=T(),[i,u]=w.useState(""),{data:o}=H(l),t=o==null?void 0:o.map(a=>({_id:a._id,projectName:a.projectName})),b=(F=o||[])==null?void 0:F.map(a=>({value:a._id,label:a.projectName}));w.useEffect(()=>{t&&t.length>0&&!i&&u(t[0]._id)},[t,i]);const n=w.useMemo(()=>t==null?void 0:t.find(a=>{if(a._id===i)return console.log("projectname",a),a==null?void 0:a.projectName}),[i]),{data:s,isLoading:x,error:d,refetch:N}=z({organizationId:l,projectId:i}),{mutateAsync:q,isPending:C}=Q(),{mutateAsync:E,isPending:I}=V(),{mutateAsync:O,isPending:S}=Y(),A=async(a,c)=>{var r,h;if(!(!(s!=null&&s._id)||C))try{await q({cartId:s._id,itemCode:a,quantity:c}),g({title:"Success",description:"Cart updated successfully"}),N()}catch(y){g({title:"Error",description:((h=(r=y==null?void 0:y.response)==null?void 0:r.data)==null?void 0:h.message)||"Failed to update quantity",variant:"destructive"})}},B=async a=>{var c,r;if(!(!(s!=null&&s._id)||I))try{await E({cartId:s._id,itemCode:a}),g({title:"Success",description:"Item removed from cart"}),N()}catch(h){g({title:"Error",description:((r=(c=h==null?void 0:h.response)==null?void 0:c.data)==null?void 0:r.message)||"Failed to remove item",variant:"destructive"})}},L=async()=>{var a,c;try{const r=await O({projectId:i,id:(s==null?void 0:s._id)||""});X({src:r==null?void 0:r.url,alt:r==null?void 0:r.fileName}),N(),g({title:"Success",description:"Material Pdf Geenrated"})}catch(r){g({title:"Error",description:((c=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:c.message)||"Failed too Generate Pdf",variant:"destructive"})}};return x?e.jsx("div",{className:"max-h-full overflow-y-auto",children:e.jsx(J,{})}):d?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4 sm:p-6 lg:p-8",children:e.jsx("div",{className:"container mx-auto max-w-6xl",children:e.jsx(f,{className:"border-red-200",children:e.jsxs(p,{className:"p-8 text-center",children:[e.jsx("div",{className:"mb-4",children:e.jsx("i",{className:"fa-solid fa-circle-exclamation text-6xl text-red-500"})}),e.jsx("h2",{className:"text-xl font-semibold text-red-700 mb-2",children:"Error Loading Cart"}),e.jsx("p",{className:"text-gray-600 mb-4",children:d instanceof Error?((k=(P=d==null?void 0:d.response)==null?void 0:P.data)==null?void 0:k.message)||(d==null?void 0:d.message):"An unexpected error occurred"}),e.jsxs(m,{onClick:()=>N(),className:"bg-red-600 hover:bg-red-700 text-white",children:[e.jsx("i",{className:"fa-solid fa-rotate-right mr-2"}),"Retry"]})]})})})}):e.jsx("div",{className:`min-h-full max-h-full overflow-y-auto \r
        bg-gradient-to-br from-blue-50 to-indigo-100 p-2 `,children:e.jsxs("div",{className:"max-w-full",children:[e.jsx("header",{className:"mb-2 ",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("section",{className:"flex gap-3 items-center",children:[e.jsx("div",{onClick:()=>j(-1),className:"bg-white hover:bg-slate-200 flex items-center justify-center w-10 h-10 border border-gray-300 cursor-pointer rounded-lg shadow-sm mb-4 transition-colors",children:e.jsx("i",{className:"fas fa-arrow-left text-gray-700"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl sm:text-3xl lg:text-4xl font-bold text-blue-900 flex items-center gap-3",children:[e.jsx("i",{className:"fa-solid fa-cart-shopping"}),"Inventory Cart"]}),e.jsx("p",{className:"text-gray-600 text-sm sm:text-base mt-1",children:"Review and manage your selected materials"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 items-stretch sm:items-center",children:[e.jsxs("div",{className:"relative min-w-[250px]",children:[e.jsx(W,{children:"Select project for the displaying the cart items"}),e.jsx(K,{options:b,placeholder:"Select project",searchPlaceholder:"Search projects...",value:i||void 0,onValueChange:a=>u(a||""),searchBy:"name",displayFormat:"simple",className:"w-full"})]}),e.jsxs(m,{isLoading:S,onClick:L,className:"bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white shadow-lg hover:shadow-xl transition-all whitespace-nowrap",disabled:!((_=s==null?void 0:s.items)!=null&&_.length),children:[e.jsx("i",{className:"fa-solid fa-file-pdf mr-2"}),"Generate PDF"]})]})]})}),!s||((D=s.items)==null?void 0:D.length)===0?e.jsx(f,{children:e.jsxs(p,{className:" p-8 sm:p-12 text-center",children:[e.jsx("div",{className:"mb-6",children:e.jsx("i",{className:"fa-solid fa-cart-shopping text-6xl sm:text-8xl text-gray-300"})}),e.jsx("h2",{className:"text-xl sm:text-2xl font-semibold text-gray-700 mb-3",children:"Your Cart is Empty"}),e.jsx("p",{className:"text-gray-500 mb-2 text-sm sm:text-base",children:"Start adding materials to see them here."}),e.jsx("p",{className:"text-gray-500 mb-6 text-sm sm:text-base",children:i&&(n!=null&&n.projectName)?e.jsx("p",{children:`No Carts Available for the ${n==null?void 0:n.projectName}`}):null})]})}):e.jsxs(e.Fragment,{children:[e.jsx(f,{className:"mb-6",children:e.jsx(p,{className:"p-2",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:(s==null?void 0:s.items.length)||0}),e.jsx("p",{className:"text-2xl font-semibold ml-1 text-gray-600",children:"Cart Items"}),e.jsx("br",{})]}),e.jsxs("div",{className:"text-left sm:text-right",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Amount"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:["₹",s==null?void 0:s.totalCost.toLocaleString("en-IN",{minimumFractionDigits:2})]})]})]})})}),e.jsx("div",{className:"space-y-4 mb-6",children:s==null?void 0:s.items.map(a=>e.jsx(Z,{item:a,onUpdateQuantity:A,onRemoveItem:B,isUpdating:C,isRemoving:I},a.productId))}),e.jsx(f,{className:" bottom-4 sm:bottom-6 shadow-2xl",children:e.jsx(p,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm sm:text-base",children:[e.jsxs("span",{className:"text-gray-600",children:["Subtotal (",s==null?void 0:s.items.length," items)"]}),e.jsxs("span",{className:"font-semibold text-gray-800",children:["₹",s==null?void 0:s.totalCost.toLocaleString("en-IN",{minimumFractionDigits:2})]})]}),e.jsx("div",{className:"border-t-2 border-gray-300 pt-3",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-lg sm:text-xl font-bold text-gray-900",children:"Total Cost"}),e.jsxs("span",{className:"text-2xl sm:text-3xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent",children:["₹",s==null?void 0:s.totalCost.toLocaleString("en-IN",{minimumFractionDigits:2})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 pt-2",children:[e.jsxs(m,{variant:"secondary",onClick:()=>j(-1),className:" w-full order-2 sm:order-1",children:[e.jsx("i",{className:"fa-solid fa-arrow-left mr-2"}),"Continue Shopping"]}),e.jsxs(m,{isLoading:S,onClick:L,className:"bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white w-full shadow-lg hover:shadow-xl transition-all order-1 sm:order-2",disabled:!(s!=null&&s.items.length),children:[e.jsx("i",{className:"fa-solid fa-file-pdf mr-2"}),"Generate Order PDF"]})]}),(s==null?void 0:s.pdfLink)&&e.jsx("div",{className:"pt-3 border-t border-gray-200",children:e.jsxs("a",{href:s.pdfLink,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center gap-2 text-sm text-blue-600 hover:text-blue-700 transition-colors font-medium",children:[e.jsx("i",{className:"fa-solid fa-file-pdf"}),e.jsx("span",{children:"View Generated Order Summary (PDF)"}),e.jsx("i",{className:"fa-solid fa-arrow-up-right-from-square text-xs"})]})})]})})}),e.jsx("div",{className:"mt-6"})]})]})})};export{pe as OrderInformation,je as default};
