import{j as e,u as J,a as K,r as N}from"./index-IX_jUi_Z.js";import{u as M,c as X,d as Y,e as Z}from"./qualityCheckApi-CLyw8Y2o.js";import{I as x}from"./Input-DbCzT9sN.js";import{S as F,a as D,b as P,c as R,d as _}from"./Select-D0Y2VHql.js";import{t as h}from"./toast-BSC5QTk1.js";import{B as m}from"./Button-D7Kb4xIQ.js";import{S as d}from"./Skeleton-BKzIbh6x.js";import"./useQuery-BBgvqOK0.js";import"./useMutation-oVcqBODs.js";import"./roleCheck-yWEzJ9f0.js";const ee=()=>{const n=Array.from({length:11});return e.jsxs("div",{className:"w-full max-h-full overflow-hidden mx-auto mt-4 bg-white shadow rounded p-6",children:[e.jsx(d,{className:"h-6 w-40 mb-2"}),e.jsx(d,{className:"h-4 w-32 mb-6"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm border border-gray-200 rounded-lg",children:[e.jsx("thead",{children:e.jsx("tr",{className:"bg-gray-100 text-left",children:["Item","Quantity","Unit","Remarks","Actions"].map((o,u)=>e.jsx("th",{className:"p-3",children:e.jsx(d,{className:"h-4 w-20"})},u))})}),e.jsx("tbody",{children:n.map((o,u)=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-3",children:e.jsx(d,{className:"h-4 w-32"})}),e.jsx("td",{className:"p-3",children:e.jsx(d,{className:"h-4 w-12"})}),e.jsx("td",{className:"p-3",children:e.jsx(d,{className:"h-4 w-10"})}),e.jsx("td",{className:"p-3",children:e.jsx(d,{className:"h-4 w-16"})}),e.jsx("td",{className:"p-3",children:e.jsx(d,{className:"h-8 w-8 rounded-full"})})]},u))})]})})]})};function me(){var I,A;const{roomkey:n,projectId:o,organizationId:u}=J(),V=K(),[S,f]=N.useState(null),{data:v,isLoading:Q,error:b,isError:W,refetch:p}=M(o),{mutateAsync:L,isPending:z}=X(),{mutateAsync:B,isPending:U}=Y(),{mutateAsync:G,isPending:$}=Z(),[a,i]=N.useState({workName:"",status:"pending",remarks:"",file:void 0}),[w,g]=N.useState(!1),[k,y]=N.useState(null),C=(v==null?void 0:v[n])||[],q=async()=>{var s,l;try{if(!a.workName.trim())throw new Error("Work name is mandatory");const t=new FormData;t.append("workName",a.workName),t.append("status",a.status),a.remarks&&t.append("remarks",a.remarks),a.file&&t.append("file",a.file),await L({projectId:o,roomName:n,formData:t}),h({description:"Created successfully",title:"Success"}),j(),p()}catch(t){h({title:"Error",description:((l=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:l.message)||(t==null?void 0:t.message)||"Failed to create item",variant:"destructive"})}},O=async s=>{var l,t;try{if(!k)return;if(!a.workName.trim())throw new Error("Work name is mandatory");const r=new FormData;r.append("itemId",k),a.workName&&r.append("workName",a.workName),r.append("status",a.status),a.remarks&&r.append("remarks",a.remarks),a.file&&r.append("file",a.file),await B({projectId:o,roomName:n,formData:r,itemId:s},{onSuccess:()=>{j()}}),h({description:"Edited successfully",title:"Success"}),p()}catch(r){h({title:"Error",description:((t=(l=r==null?void 0:r.response)==null?void 0:l.data)==null?void 0:t.message)||(r==null?void 0:r.message)||"Failed to edit item",variant:"destructive"})}},T=async s=>{var l,t;try{await G({projectId:o,roomName:n,itemId:s}),h({description:"Deleted successfully",title:"Success"}),p()}catch(r){h({title:"Error",description:((t=(l=r==null?void 0:r.response)==null?void 0:l.data)==null?void 0:t.message)||r.message||"Failed to delete item",variant:"destructive"})}},j=()=>{i({workName:"",status:"pending",remarks:"",file:void 0}),g(!1),y(null)};return Q?e.jsx(ee,{}):(W&&((A=(I=b==null?void 0:b.response)==null?void 0:I.data)!=null&&A.message,m),e.jsxs("div",{className:"w-full h-full",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("h1",{className:"text-xl font-bold mb-4",children:["Room: ",n]}),e.jsx(m,{variant:"primary",className:"h-10",onClick:()=>V(`/${u}/projectdetails/${o}/qualitycheck`),children:"Go Back"})]}),C.length===0&&!w?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("div",{className:"min-w-[900px] grid grid-cols-5 gap-2 font-semibold bg-blue-100 text-blue-900 p-2 rounded",children:[e.jsx("div",{className:"text-center",children:"Work Name"}),e.jsx("div",{className:"text-center",children:"Status"}),e.jsx("div",{className:"text-center",children:"Remarks"}),e.jsx("div",{className:"text-center",children:"Upload"}),e.jsx("div",{className:"text-center",children:"Actions"})]})}),e.jsxs("div",{className:"flex flex-col items-center justify-center p-12 shadow rounded-lg bg-white",children:[e.jsx("i",{className:"fas fa-check-double text-3xl text-blue-400 mb-2"}),e.jsx("p",{className:"text-blue-600 mb-4 text-sm",children:"No items added yet for this room."}),e.jsxs(m,{onClick:()=>g(!0),variant:"primary",children:[e.jsx("i",{className:"fas fa-plus mr-2"})," Add Item"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsxs("div",{className:"min-w-[900px]",children:[e.jsxs("div",{className:"grid grid-cols-5 text-blue-900 gap-2 font-semibold bg-blue-100 p-2 rounded-t",children:[e.jsx("div",{className:"text-center",children:"Work Name"}),e.jsx("div",{className:"text-center",children:"Status"}),e.jsx("div",{className:"text-center",children:"Remarks"}),e.jsx("div",{className:"text-center",children:"Upload"}),e.jsx("div",{className:"text-center",children:"Actions"})]}),e.jsx("div",{className:"overflow-y-auto relative z-[10] max-h-[70vh] sm:max-h-[75vh] md:max-h-[80vh] lg:max-h-[45vh] xl:max-h-[77vh]",children:C.map((s,l)=>{var t,r;return k===s._id?e.jsxs("div",{className:"grid grid-cols-5 gap-2 px-4 py-3 border-b border-gray-200 items-center bg-white",children:[e.jsx(x,{value:a.workName,placeholder:"Work Name",onChange:c=>i({...a,workName:c.target.value})}),e.jsx("div",{className:"relative z-50",children:e.jsxs(F,{value:a.status,onValueChange:c=>i({...a,status:c}),children:[e.jsx(D,{selectedValue:a.status,children:e.jsx(P,{selectedValue:a.status,placeholder:"Select status"})}),e.jsx(R,{children:["pass","fail","pending"].map(c=>e.jsx(_,{value:c,children:c},c))})]})}),e.jsx(x,{value:a.remarks,placeholder:"Remarks",onChange:c=>i({...a,remarks:c.target.value})}),e.jsx("div",{className:"flex flex-col items-center gap-1",children:e.jsx(x,{type:"file",accept:"image/*",onChange:c=>{var E;const H=(E=c.target.files)==null?void 0:E[0];i({...a,file:H})}})}),e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsxs(m,{variant:"primary",isLoading:U,onClick:()=>O(s._id),className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded",children:[e.jsx("i",{className:"fas fa-save mr-1"})," Save"]}),e.jsxs(m,{variant:"secondary",onClick:j,className:"bg-gray-400 text-white px-3 py-1 rounded",children:[e.jsx("i",{className:"fas fa-times mr-1"})," Cancel"]})]})]},s._id+l):e.jsxs("div",{className:"grid grid-cols-5 gap-2 px-4 py-3 border-b border-gray-200 items-center bg-white",children:[e.jsx("div",{className:"text-center",children:s.workName||"N/A"}),e.jsx("div",{className:"text-center",children:s.status||"N/A"}),e.jsx("div",{className:"text-center",children:s.remarks||"N/A"}),e.jsx("div",{className:"text-center",children:((t=s.upload)==null?void 0:t.type)==="image"?e.jsx("img",{src:s.upload.url,alt:"Preview",className:"w-10 h-10 object-cover rounded border cursor-pointer mx-auto",onClick:()=>f(s.upload.url)}):((r=s.upload)==null?void 0:r.type)==="pdf"?e.jsx("a",{href:s.upload.url,target:"_blank",rel:"noreferrer",className:"text-blue-600 underline",children:"View PDF"}):"No Image"}),e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsxs("button",{onClick:()=>{y(s._id),g(!1),i({workName:s.workName||"",status:s.status||"pending",remarks:s.remarks||"",file:void 0})},className:"bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded",children:[e.jsx("i",{className:"fas fa-edit mr-1"})," Edit"]}),e.jsxs(m,{variant:"danger",isLoading:$,onClick:()=>T(s._id),className:"bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded",children:[e.jsx("i",{className:"fas fa-trash mr-1"})," Delete"]})]})]},s._id+l)})}),w&&e.jsxs("div",{className:"grid grid-cols-5 gap-2 px-4 py-3 bg-white border-b border-gray-200 items-center",children:[e.jsx(x,{placeholder:"Work Name",value:a.workName,onChange:s=>i({...a,workName:s.target.value})}),e.jsxs(F,{value:a.status,onValueChange:s=>i({...a,status:s}),children:[e.jsx(D,{children:e.jsx(P,{selectedValue:a.status,placeholder:"Select status"})}),e.jsx(R,{children:["pass","fail","pending"].map(s=>e.jsx(_,{value:s,children:s},s))})]}),e.jsx(x,{placeholder:"Remarks",value:a.remarks,onChange:s=>i({...a,remarks:s.target.value})}),e.jsx("div",{className:"flex flex-col items-center gap-1",children:e.jsx(x,{type:"file",accept:"image/*",onChange:s=>{var t;const l=(t=s.target.files)==null?void 0:t[0];i({...a,file:l})}})}),e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsxs("button",{onClick:q,className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded",children:[e.jsx("i",{className:"fas fa-save mr-1"})," Save"]}),e.jsxs("button",{onClick:j,className:"bg-gray-400 text-white px-3 py-1 rounded",children:[e.jsx("i",{className:"fas fa-times mr-1"})," Cancel"]})]})]})]})}),!w&&C.length>0&&e.jsx("div",{className:"mt-4",children:e.jsxs(m,{isLoading:z,variant:"primary",onClick:()=>{g(!0),y(null),i({workName:"",status:"pending",remarks:"",file:void 0})},children:[e.jsx("i",{className:"fas fa-plus mr-2"})," Add Item"]})})]}),S&&e.jsx("div",{onClick:()=>f(null),className:"fixed inset-0 z-50 bg-black/70 bg-opacity-60 flex items-center justify-center",children:e.jsxs("div",{onClick:s=>s.stopPropagation(),className:"relative bg-white rounded p-4 max-w-[90vw] max-h-[80vh] shadow-lg",children:[e.jsx("i",{className:"fas fa-times absolute top-2 right-3 text-xl text-gray-700 hover:text-red-500 cursor-pointer",onClick:()=>f(null)}),e.jsx("img",{src:S,alt:"Full View",className:"max-h-[70vh] w-auto object-contain rounded"})]})})]}))}export{me as default};
