import{b as M,h as R,M as O,a as P,j as e,O as B,L as F}from"./index-CZlH018n.js";import{t as p}from"./toast-BSC5QTk1.js";import{R as I}from"./ResetStageButton-D8pA5nR8.js";import{B as h}from"./Button-CuklGkXN.js";import{C as T}from"./Card-CuaQED1d.js";import{A as D,S as G}from"./AssignStaff-CDXeFyuX.js";import _ from"./MaterialOverviewLoading-BStlmrQG.js";import{u as z,a as E,b as K}from"./cleaningStageApi-VmaHYIdQ.js";import{S as H}from"./ShareDocumentWhatsapp-_J2Hqhrf.js";import"./roleCheck-CWG0FluA.js";import"./useMutation-CuPLhNle.js";import"./Input-gxwZm0L9.js";import"./getAllUsersApi-B85EYkoX.js";import"./useQuery-IUUplwQg.js";import"./useBaseQuery-B18wTrwv.js";import"./Skeleton-Bn0S57L0.js";import"./documentationApi-Bl2dNhqO.js";import"./requirementFormApi-Czhf1Nyl.js";const re=["Living Room","Bedroom","Kitchen","Dining Room","Balcony","Foyer Area","Terrace","Study Room","Car Parking","Garden","Storage Room","Entertainment Room","Home Gym"];function me(){var m,d,c,x,g,u;const{projectId:a,organizationId:f}=M(),b=R(),{isMobile:j,openMobileSidebar:N}=O(),w=P();if(!a)return null;const{data:s,isLoading:r,isError:v,refetch:o,error:i}=z(a),{mutateAsync:C,isPending:S}=E(),{mutateAsync:y,isPending:L}=K(),k=async()=>{var t,n;try{await y({projectId:a}),p({description:"Cleaning & Sanitation marked as complete.",title:"Success"}),w("../projectdelivery"),o()}catch(l){p({title:"Error",description:((n=(t=l==null?void 0:l.response)==null?void 0:t.data)==null?void 0:n.message)||l.message||"Failed to update completion status",variant:"destructive"})}},A=b.pathname.includes("/cleaningroom/");return r?e.jsx(_,{}):e.jsx("main",{className:"w-full h-full max-h-full overflow-y-auto custom-scrollbar",children:A?e.jsx(B,{}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4 mb-6",children:[e.jsxs("h2",{className:"text-lg sm:text-xl lg:text-3xl font-semibold text-blue-600 flex items-center gap-2",children:[j&&e.jsx("button",{onClick:N,className:"mr-3 p-2 rounded-md border border-gray-300 hover:bg-gray-100",title:"Open Menu",children:e.jsx("i",{className:"fa-solid fa-bars"})}),e.jsx("i",{className:"fas fa-broom"}),e.jsx("span",{className:"hidden sm:inline text-2xl",children:" Cleaning & Sanitation Overview"}),e.jsx("span",{className:"inline sm:hidden text-2xl",children:" Cleaning Stage"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full sm:w-auto",children:[e.jsxs(h,{isLoading:L,onClick:k,className:"bg-blue-600 hover:bg-blue-700 text-white sm:w-auto w-full",children:[e.jsx("i",{className:"fa-solid fa-circle-check mr-2"}),e.jsx("span",{className:"hidden sm:inline-block",children:"Mark as Completed"}),e.jsx("span",{className:"inline sm:hidden",children:"Mark as Completed"})]}),e.jsxs("div",{className:"flex items-center justify-between w-full sm:gap-2",children:[e.jsx(I,{projectId:a,stageNumber:13,stagePath:"cleaning",className:"!w-[48%] sm:!w-auto"}),!i&&e.jsx(H,{projectId:a,stageNumber:"13",className:"w-full sm:w-fit",isStageCompleted:s==null?void 0:s.status}),e.jsx(D,{stageName:"CleaningAndSanitationModel",projectId:a,organizationId:f,currentAssignedStaff:(s==null?void 0:s.assignedTo)||null,className:"!w-[48%] sm:!w-auto"})]})]})]}),v?e.jsxs("div",{className:"max-w-xl mx-auto p-6 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 text-xl font-semibold mb-2",children:"⚠️ Oops! An Error Occurred"}),e.jsx("p",{className:"text-red-500 text-sm mb-4",children:((d=(m=i==null?void 0:i.response)==null?void 0:m.data)==null?void 0:d.message)||(i==null?void 0:i.message)||"Failed to load, please try again"}),e.jsx(h,{isLoading:r,onClick:()=>o(),className:"px-4 py-2 bg-red-600 text-white text-sm font-medium rounded hover:bg-red-700 transition",children:"Retry"})]}):e.jsxs(e.Fragment,{children:[e.jsxs(T,{className:"p-4 mb-6 border-l-4 border-blue-600 bg-white shadow",children:[e.jsxs("div",{className:"flex items-center gap-3 text-blue-600 text-sm font-medium mb-2",children:[e.jsx("i",{className:"fa-solid fa-clock text-lg"}),e.jsx("span",{children:"Stage Timings"})]}),e.jsx(G,{stageName:"cleaning",completedAt:(c=s==null?void 0:s.timer)==null?void 0:c.completedAt,projectId:a,formId:s==null?void 0:s._id,deadLine:(x=s==null?void 0:s.timer)==null?void 0:x.deadLine,startedAt:(g=s==null?void 0:s.timer)==null?void 0:g.startedAt,refetchStageMutate:o,deadLineMutate:C,isPending:S})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-4",children:(u=s==null?void 0:s.rooms)==null?void 0:u.map(t=>{var n;return e.jsx(F,{to:`cleaningroom/${t._id}`,className:"border-l-4 border-blue-600 p-4 rounded-xl shadow hover:shadow-md transition cursor-pointer bg-white",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-base md:text-md font-semibold capitalize text-blue-800 mb-1",children:t.roomName}),e.jsxs("p",{className:"text-xs text-gray-500",children:[((n=t.uploads)==null?void 0:n.length)||0," uploads"]}),e.jsx("p",{className:"text-xs text-gray-500",children:t.completelyCleaned?"✅ Completely Cleaned":"❌ Not Cleaned"})]})},t._id)})})]})]})})}export{me as default,re as roomKeys};
