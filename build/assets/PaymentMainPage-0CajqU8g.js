import{u as F,f as G,e as I,a as B,b as D,j as e,O as q}from"./index-BZjlY-2Z.js";import{t as v}from"./toast-BSC5QTk1.js";import{B as C}from"./Button-BGBzZFjk.js";import{R as Q}from"./ResetStageButton-CaASdV3V.js";import{A as z,S as W}from"./AssignStaff-DHSDCnbr.js";import{C as f}from"./Card-CmzT6E3j.js";import{u as _,a as H,b as J}from"./paymentConfirmationApi-CoyKpOkP.js";import K from"./MaterialOverviewLoading-C38kMtqM.js";import{S as U}from"./ShareDocumentWhatsapp-hlwJvdoC.js";import{S as V}from"./StageGuide-BGPpzdDF.js";import"./roleCheck-DuKNZHKs.js";import"./useMutation-BRRIqsxx.js";import"./Input-BDSEJtPI.js";import"./getAllUsersApi-CczUwJt9.js";import"./useQuery-Coz1VCY2.js";import"./Skeleton-BnQtABYA.js";import"./documentationApi-DG_waLms.js";import"./requirementFormApi-BXUq7tiS.js";const X=[{title:"Consent Form",description:"Review and accept client consent agreements.",icon:"ðŸ“",path:"consent"},{title:"Schedule Approval",description:"Manage milestone approvals from client & MD.",icon:"ðŸ“…",path:"schedule"},{title:"Payment Transaction",description:"Track actual payment gateway transactions.",icon:"ðŸ’³",path:"transaction"},{title:"Client Quotes",description:"Get the Quotation that is approved by client",icon:"ðŸ“„",path:"quotes"}],ue=()=>{var b,j,N,w;const{projectId:a,organizationId:u}=F(),{isMobile:S,openMobileSidebar:P}=G(),l=I(),g=B(),{data:o,isLoading:A,isError:d,refetch:x,error:i}=_(a),{mutateAsync:k,isPending:L}=H(),{mutateAsync:M,isPending:E}=J(),{role:h,permission:n}=D(),r=h==="owner"||((b=n==null?void 0:n.paymentconfirmation)==null?void 0:b.create),m=h==="owner"||((j=n==null?void 0:n.paymentconfirmation)==null?void 0:j.edit);if(l.pathname.includes("/consent")||l.pathname.includes("/schedule")||l.pathname.includes("/transaction")||l.pathname.includes("/quotes"))return e.jsx(q,{});const O=async()=>{var s,y;try{await k({projectId:a}),v({title:"Success",description:"Completion status updated successfully"}),x(),g("../ordermaterial")}catch(c){v({title:"Error",description:((y=(s=c==null?void 0:c.response)==null?void 0:s.data)==null?void 0:y.message)||c.message||"Failed to update completion status",variant:"destructive"})}};if(A)return e.jsx(K,{});const{assignedTo:T,timer:t,totalAmount:p,_id:R}=o||{};return e.jsxs("div",{className:"container mx-auto max-w-full max-h-full overflow-y-auto",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4 mb-6",children:[e.jsxs("h2",{className:"text-2xl sm:text-3xl font-semibold text-blue-600 flex items-center",children:[S&&e.jsx("button",{onClick:P,className:"mr-3 p-2 rounded-md border-gray-300 hover:bg-gray-100",title:"Open Menu",children:e.jsx("i",{className:"fa-solid fa-bars"})}),e.jsx("i",{className:"fa-solid fa-sack-dollar mr-2"})," Payment Confirmation"]}),e.jsxs("div",{className:"!w-[100%] sm:!w-[80%] lg:w-[50%] flex flex-col sm:flex-row gap-3 justify-end",children:[e.jsx("div",{className:"flex flex-wrap sm:flex-nowrap gap-2 justify-end",children:(r||m)&&e.jsxs(C,{isLoading:L,onClick:O,className:"bg-green-600 hover:bg-green-700 text-white flex-1 sm:flex-initial min-w-max",children:[e.jsx("i",{className:"fa-solid fa-circle-check mr-2"}),"Mark Complete"]})}),e.jsxs("div",{className:"flex flex-wrap sm:flex-nowrap gap-2 justify-end",children:[(r||m)&&e.jsx(Q,{stageNumber:7,stagePath:"paymentconfirmation",projectId:a,className:"flex-1 sm:flex-initial min-w-max"}),!d&&(r||m)&&e.jsx(U,{projectId:a,stageNumber:"7",className:"w-full sm:w-fit",isStageCompleted:o==null?void 0:o.status}),(r||m)&&e.jsx(z,{stageName:"PaymentConfirmationModel",projectId:a,organizationId:u,currentAssignedStaff:T||null,className:"flex-1 sm:flex-initial min-w-max"}),e.jsx("div",{className:"w-full sm:w-auto flex justify-end sm:block",children:e.jsx(V,{organizationId:u,stageName:"paymentconfirmation"})})]})]})]}),d&&e.jsxs("div",{className:"max-w-xl mx-auto p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center mb-6",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2",children:"âš ï¸ Error Occurred"}),e.jsx("p",{className:"text-red-500 text-sm mb-4",children:((w=(N=i==null?void 0:i.response)==null?void 0:N.data)==null?void 0:w.message)||(i==null?void 0:i.message)||"Failed to load payment confirmation data"}),e.jsx(C,{onClick:()=>x(),className:"bg-red-600 text-white px-4 py-2",children:"Retry"})]}),!d&&e.jsxs(e.Fragment,{children:[e.jsxs(f,{className:"p-4 mb-6 w-full shadow border-l-4 border-blue-600 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-3 text-blue-700 text-sm font-medium mb-2",children:[e.jsx("i",{className:"fa-solid fa-clock text-blue-500 text-lg"}),e.jsx("span",{children:"Stage Timings"})]}),e.jsx(W,{completedAt:t==null?void 0:t.completedAt,stageName:"paymentconfirmation",formId:R,projectId:a,deadLine:t==null?void 0:t.deadLine,startedAt:t==null?void 0:t.startedAt,refetchStageMutate:x,deadLineMutate:M,isPending:E})]}),e.jsxs(f,{className:"p-4 mb-6 bg-blue-50 border-l-4 border-blue-600 shadow-md",children:[e.jsxs("div",{className:"text-lg font-semibold text-blue-800 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-wallet"}),"Total Payment Amount"]}),e.jsxs("p",{className:"text-3xl text-blue-700 mt-2 font-bold",children:["â‚¹ ",(p==null?void 0:p.toLocaleString("en-in"))||0]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6",children:X.map(s=>e.jsx("div",{onClick:()=>g(s.path),className:"cursor-pointer",children:e.jsxs(f,{className:"hover:shadow-xl border-l-6 border-blue-600 transition bg-blue-100 p-4 sm:p-6 !rounded-xl h-full flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-4xl",children:s.icon}),e.jsx("h3",{className:"text-xl mt-3 font-bold text-blue-800",children:s.title}),e.jsx("p",{className:"text-sm text-blue-700 mt-2",children:s.description})]}),e.jsx("div",{className:"mt-4 text-right",children:e.jsxs("span",{className:"inline-block bg-blue-600 text-white text-xs px-3 py-1 rounded",children:["Go to ",s.title]})})]})},s.path))})]})]})};export{ue as default};
