import{j as e,u as I,a as R,b as z,r as y,O as B}from"./index-C1DtYOG4.js";import{S as $}from"./index-B5OBDqPo.js";import{B as w}from"./Button-D6HVPia8.js";import{t as S}from"./toast-BSC5QTk1.js";import{B as O}from"./Breadcrumb-C3Nh5JEi.js";import{u as j}from"./useDebounce-CtwQqIu-.js";import{d as _}from"./dateFormator-BGKi5rfZ.js";import{u as H,a as V}from"./paymentAccApi-D0j521PB.js";import"./index-BzRRwkiY.js";import"./useQuery-DD9aZBjN.js";import"./useMutation-BgVKkKtF.js";import"./useInfiniteQuery-4I03x6LQ.js";import"./roleCheck-vyRiFK58.js";const U=({payment:r,index:c,handleView:o,handleDelete:d,deletePending:m})=>{var t;const x=l=>{switch(l==null?void 0:l.toLowerCase()){case"paid":return"bg-green-100 text-green-700 border-green-200";case"pending":return"bg-yellow-100 text-yellow-700 border-yellow-200";case"failed":return"bg-red-100 text-red-700 border-red-200";default:return"bg-gray-100 text-gray-700 border-gray-200"}};return e.jsxs("div",{className:"grid cursor-pointer grid-cols-12 gap-4 px-6 py-4 border-b border-gray-100 hover:bg-[#f9fcff] transition-colors items-center last:border-b-0",onClick:()=>o(r._id),children:[e.jsx("div",{className:"col-span-1 text-center text-gray-500 font-medium text-sm",children:c+1}),e.jsx("div",{className:"col-span-3",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("i",{className:`fas ${r.fromSection==="expense"?"fa-receipt":"fa-user"} text-blue-500 text-sm`}),e.jsx("span",{className:"font-semibold text-gray-900 truncate",title:r.paymentPersonName,children:r.paymentPersonName||"Unknown Payee"})]}),e.jsx("span",{className:"text-[10px] text-gray-400 uppercase tracking-wide ml-6 mt-0.5",children:r.fromSection||"Direct"})]})}),e.jsx("div",{className:"col-span-2",children:e.jsx("span",{className:"px-2.5 py-1 bg-blue-50 text-blue-600 border border-blue-100 rounded-md text-xs font-medium tracking-wide",children:r.paymentNumber||"N/A"})}),e.jsxs("div",{className:"col-span-2 text-gray-600 text-sm flex items-center",children:[e.jsx("i",{className:"far fa-calendar-alt text-gray-400 mr-2"}),_(r.paymentDate)]}),e.jsxs("div",{className:"col-span-2 text-right font-bold text-gray-800",children:["â‚¹",((t=r.grandTotal)==null?void 0:t.toLocaleString("en-IN"))||"0.00"]}),e.jsx("div",{className:"col-span-1 text-center",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-[10px] font-bold uppercase border ${x(r.generalStatus)}`,children:r.generalStatus||"Pending"})}),e.jsx("div",{className:"col-span-1 flex justify-center items-center gap-2",children:e.jsx("button",{onClick:l=>{l.stopPropagation(),d(r._id)},disabled:m,className:"group p-2 rounded-lg hover:bg-red-50 transition-all disabled:opacity-50 disabled:cursor-not-allowed",title:"Delete Record",children:m?e.jsx("i",{className:"fas fa-spinner fa-spin text-red-500 text-sm"}):e.jsx("i",{className:"far fa-trash-alt text-gray-400 group-hover:text-red-500 transition-colors text-sm"})})})]})},re=()=>{const r=I(),c=R(),{organizationId:o}=z(),d=y.useRef(null),m=[{label:"Account",path:`/organizations/${o}/projects/accounting`},{label:"Payments",path:`/organizations/${o}/projects/paymentmain`}],x=c.pathname.includes("/single")||c.pathname.includes("/create"),[t,l]=y.useState({search:"",minAmount:0,maxAmount:1e7,startDate:"",endDate:"",fromSection:""}),A=j(t.search,500),k=j(t.minAmount,800),P=j(t.maxAmount,800),{data:u,fetchNextPage:N,hasNextPage:g,isFetchingNextPage:f,isLoading:C,isError:D,error:b,refetch:L}=H({organizationId:o||"",personName:A||void 0,minAmount:k,maxAmount:P,startDate:t.startDate||void 0,endDate:t.endDate||void 0,fromSection:t.fromSection||void 0}),h=V();y.useEffect(()=>{const s=d.current;if(!s)return;const a=()=>{const{scrollTop:i,scrollHeight:n,clientHeight:T}=s;n-i-T<100&&g&&!f&&(console.log("ðŸ“œ Loading more payments..."),N())};return s.addEventListener("scroll",a),()=>s.removeEventListener("scroll",a)},[g,f,N]);const F=async s=>{var a,i;if(confirm("Are you sure you want to delete this payment record?"))try{await h.mutateAsync(s),S({title:"Success",description:"Payment record deleted successfully"})}catch(n){S({title:"Error",description:((i=(a=n==null?void 0:n.response)==null?void 0:a.data)==null?void 0:i.message)||(n==null?void 0:n.message)||"Failed to delete payment",variant:"destructive"})}},E=s=>{r(`single/${s}`)},M=()=>{l({search:"",minAmount:0,maxAmount:1e7,startDate:"",endDate:"",fromSection:""})},v=Object.values(t).filter(s=>s!==""&&s!==0&&s!==1e5).length,p=(u==null?void 0:u.pages.flatMap(s=>s.data))||[];return x?e.jsx(B,{}):e.jsxs("div",{className:"space-y-0 h-full",children:[e.jsxs("header",{className:"flex justify-between items-center pb-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-money-check-alt mr-3 text-blue-600"}),"Payments"]}),e.jsx(O,{paths:m})]}),e.jsxs(w,{onClick:()=>r("create"),children:[e.jsx("i",{className:"fas fa-plus mr-2"}),"Create Payment"]})]}),C?e.jsx("div",{className:"flex justify-center items-center py-12 h-[60vh]",children:e.jsx("i",{className:"fas fa-spinner fa-spin text-blue-600 text-4xl"})}):D?e.jsxs("div",{className:"max-w-xl mx-auto mt-4 p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2 text-xl",children:"âš ï¸ Error Occurred"}),e.jsx("p",{className:"text-red-500 mb-4 text-lg",children:(b==null?void 0:b.message)||"Failed to load payments"}),e.jsx(w,{onClick:()=>L(),className:"bg-red-600 text-white px-4 py-2",children:"Retry"})]}):e.jsxs("main",{className:"flex gap-4 h-[calc(100%-80px)]",children:[e.jsx("div",{className:"xl:w-80 lg:w-72 w-64 flex-shrink-0 h-full overflow-y-auto custom-scrollbar",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-5 border border-gray-100 h-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-filter mr-2 text-blue-600"}),"Filters"]}),v>0&&e.jsxs("button",{onClick:M,className:"text-sm text-blue-600 hover:text-blue-800 font-medium transition-colors",children:["Clear All (",v,")"]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx("i",{className:"fas fa-search mr-2 text-gray-400"}),"Search Payee"]}),e.jsx("input",{type:"text",placeholder:"Name, Company...",value:t.search,onChange:s=>l(a=>({...a,search:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-4",children:[e.jsx("i",{className:"fas fa-coins mr-2 text-gray-400"}),"Amount Range"]}),e.jsx("div",{className:"px-2 mb-3",children:e.jsx($,{range:!0,min:0,max:1e5,step:500,value:[Number(t.minAmount),Number(t.maxAmount)],onChange:s=>{const[a,i]=s;l(n=>({...n,minAmount:a,maxAmount:i}))},trackStyle:[{backgroundColor:"#3b82f6",height:6}],handleStyle:[{borderColor:"#3b82f6",backgroundColor:"#fff",boxShadow:"0 2px 6px rgba(59, 130, 246, 0.4)",width:18,height:18,marginTop:-6,opacity:1},{borderColor:"#3b82f6",backgroundColor:"#fff",boxShadow:"0 2px 6px rgba(59, 130, 246, 0.4)",width:18,height:18,marginTop:-6,opacity:1}],railStyle:{backgroundColor:"#e5e7eb",height:6}})}),e.jsxs("div",{className:"flex justify-between items-center gap-2 text-sm",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-xs text-gray-500 block mb-1",children:"Min"}),e.jsxs("div",{className:"bg-blue-50 px-2 py-1.5 rounded border border-blue-100 font-semibold text-blue-700 text-center text-xs",children:["â‚¹",Number(t.minAmount).toLocaleString("en-IN")]})]}),e.jsx("div",{className:"text-gray-300",children:"â€”"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-xs text-gray-500 block mb-1",children:"Max"}),e.jsxs("div",{className:"bg-blue-50 px-2 py-1.5 rounded border border-blue-100 font-semibold text-blue-700 text-center text-xs",children:["â‚¹",Number(t.maxAmount).toLocaleString("en-IN")]})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx("i",{className:"fas fa-calendar-alt mr-2 text-gray-400"}),"Payment Date From"]}),e.jsx("input",{type:"date",value:t.startDate,onChange:s=>l(a=>({...a,startDate:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx("i",{className:"fas fa-calendar-alt mr-2 text-gray-400"}),"Payment Date To"]}),e.jsx("input",{type:"date",value:t.endDate,onChange:s=>l(a=>({...a,endDate:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx("i",{className:"fas fa-tag mr-2 text-gray-400"}),"Source Type"]}),e.jsxs("select",{value:t.fromSection,onChange:s=>l(a=>({...a,fromSection:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none bg-white",children:[e.jsx("option",{value:"",children:"All Sources"}),e.jsx("option",{value:"bill",children:"Bills"}),e.jsx("option",{value:"expense",children:"Expenses"})]})]})]})]})}),p.length===0?e.jsxs("div",{className:"flex-1 bg-white rounded-xl shadow-sm border border-gray-200 flex flex-col items-center justify-center p-8",children:[e.jsx("div",{className:"bg-blue-50 p-4 rounded-full mb-4",children:e.jsx("i",{className:"fas fa-file-invoice-dollar text-4xl text-blue-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:"No Payments Found"}),e.jsx("p",{className:"text-gray-500 text-center max-w-md",children:t.search||t.startDate?"Try adjusting your filters to find payment records.":"No payment records available yet. Start by creating a new payment."})]}):e.jsxs("div",{ref:d,className:"flex-1 bg-white rounded-xl shadow-sm border border-gray-200 overflow-y-auto custom-scrollbar flex flex-col",children:[e.jsx("div",{className:"sticky top-0 z-10 bg-white border-b border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 px-6 py-4 bg-gray-50 font-semibold text-gray-700 text-sm uppercase tracking-wider",children:[e.jsx("div",{className:"col-span-1 text-center",children:"#"}),e.jsx("div",{className:"col-span-3",children:"Payee Name"}),e.jsx("div",{className:"col-span-2",children:"Payment No"}),e.jsx("div",{className:"col-span-2",children:"Date"}),e.jsx("div",{className:"col-span-2 text-right",children:"Amount"}),e.jsx("div",{className:"col-span-1 text-center",children:"Status"}),e.jsx("div",{className:"col-span-1 text-center",children:"Action"})]})}),e.jsx("div",{className:"divide-y divide-gray-100",children:p.map((s,a)=>e.jsx(U,{payment:s,index:a,handleView:E,handleDelete:F,deletePending:h.isPending&&h.variables===s._id},s._id))}),f&&e.jsx("div",{className:"flex justify-center py-6 bg-gray-50 border-t border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-2 text-blue-600",children:[e.jsx("i",{className:"fas fa-spinner fa-spin text-xl"}),e.jsx("span",{className:"text-sm font-medium",children:"Loading more payments..."})]})}),!g&&p.length>0&&e.jsx("div",{className:"flex justify-center py-6 bg-gray-50 border-t border-gray-100",children:e.jsxs("p",{className:"text-gray-400 text-sm font-medium flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle mr-2"}),"All records loaded"]})})]})]})]})};export{re as default};
