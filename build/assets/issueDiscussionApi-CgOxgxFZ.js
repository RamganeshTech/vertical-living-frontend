import{f as d,g as p,h as f,s as h,i as l,b as g}from"./index-BAM0eJUz.js";import{u as k}from"./useInfiniteQuery-BGz0VllC.js";const E=async({organizationId:n,projectId:e,selectStaff:r,selectStaffRole:o,issue:t,responseType:s,isMessageRequired:a,dropdownOptions:i,files:c,api:y})=>{const u=new FormData;n&&u.append("organizationId",n),e&&u.append("projectId",e),r&&u.append("selectStaff",r),o&&u.append("selectStaffRole",o),t&&u.append("issue",t),s&&u.append("responseType",s),a&&u.append("isMessageRequired",String(a)),i&&u.append("dropdownOptions",JSON.stringify(i)),c&&c.length>0&&c.forEach(m=>u.append("files",m));const{data:w}=await y.post("/issuediscussion/createissue",u,{headers:{"Content-Type":"multipart/form-data"}});if(!w.ok)throw new Error(w.message||"Failed to create issue");return w.data},I=async({organizationId:n,convoId:e,responseContent:r,optionalMessage:o,files:t,api:s})=>{const a=new FormData;r&&a.append("responseContent",r),o&&a.append("optionalMessage",o),t&&t.length>0&&t.forEach(c=>a.append("files",c));const{data:i}=await s.post(`/issuediscussion/providesolution/${n}/${e}`,a,{headers:{"Content-Type":"multipart/form-data"}});if(!i.ok)throw new Error(i.message||"Failed to provide solution");return i.data},v=async({organizationId:n,convoId:e,forwardToStaff:r,forwardToStaffRole:o,api:t})=>{const{data:s}=await t.put(`/issuediscussion/forward/${n}/${e}`,{forwardToStaff:r,forwardToStaffRole:o});if(!s.ok)throw new Error(s.error||"Failed to forward issue");return s.data},C=async({organizationId:n,page:e,limit:r,filters:o,api:t})=>{const s=new URLSearchParams({page:e.toString(),limit:r.toString()});o.search&&s.append("search",o.search.trim()),o.projectId&&s.append("projectId",o.projectId),o.myTickets&&s.append("myTickets","true"),o.notResponded&&s.append("notResponded","true"),o.sortBy&&s.append("sortBy",o.sortBy),o.sortOrder&&s.append("sortOrder",o.sortOrder);const{data:a}=await t.get(`/issuediscussion/getall/${n}?${s.toString()}`);if(!a.ok)throw new Error(a.message||"Failed to fetch discussions");return a.data},P=async({organizationId:n,convoId:e,api:r})=>{const{data:o}=await r.delete(`/issuediscussion/deletemessage/${n}/${e}`);if(!o.ok)throw new Error(o.message||"Failed to delete conversation");return o},F=async({api:n,organizationId:e})=>{const{data:r}=await n.get(`/issuediscussion/unread-count/${e}`);if(!r.ok)throw new Error(r.message);return r.count},A=async({api:n,organizationId:e})=>{const{data:r}=await n.patch(`/issuediscussion/mark-all-read/${e}`);if(!r.ok)throw new Error(r.message);return r},T=()=>{const n=["owner","staff","CTO","worker"],{role:e}=d(),r=l(e),o=p();return f({mutationFn:async({organizationId:t,projectId:s,selectStaff:a,selectStaffRole:i,issue:c,responseType:y,isMessageRequired:u,dropdownOptions:w,files:m})=>{if(!e||!n.includes(e))throw new Error("Not allowed to make this API call");if(!r)throw new Error("API instance not found for role");return await E({organizationId:t,projectId:s,selectStaff:a,selectStaffRole:i,issue:c,responseType:y,isMessageRequired:u,dropdownOptions:w,files:m,api:r})},onSuccess:(t,s)=>{o.invalidateQueries({queryKey:["discussions",s.projectId]}),o.invalidateQueries({queryKey:["user-raised-issues"]})},onError:t=>{console.error("Failed to create issue:",t)}})},S=()=>{const n=["owner","staff","CTO","worker"],{role:e}=d(),r=l(e),o=p();return f({mutationFn:async({convoId:t,responseContent:s,optionalMessage:a,files:i,organizationId:c})=>{if(!e||!n.includes(e))throw new Error("Not allowed to make this API call");if(!r)throw new Error("API instance not found for role");return await I({organizationId:c,convoId:t,responseContent:s,optionalMessage:a,files:i,api:r})},onSuccess:(t,s)=>{o.invalidateQueries({queryKey:["discussions",s.organizationId]}),o.invalidateQueries({queryKey:["user-assigned-issues"]})},onError:t=>{console.error("Failed to provide solution:",t)}})},O=()=>{const n=["owner","staff","CTO","worker"],{role:e}=d(),r=l(e),o=p();return f({mutationFn:async({organizationId:t,convoId:s,forwardToStaff:a,forwardToStaffRole:i})=>{if(!e||!n.includes(e))throw new Error("Not allowed to make this API call");if(!r)throw new Error("API instance not found for role");return await v({organizationId:t,convoId:s,forwardToStaff:a,forwardToStaffRole:i,api:r})},onSuccess:(t,s)=>{o.invalidateQueries({queryKey:["discussions",s.organizationId]}),o.invalidateQueries({queryKey:["user-assigned-issues"]})},onError:t=>{console.error("Failed to forward issue:",t)}})},Q=({organizationId:n,limit:e=20,filters:r})=>{const o=["owner","staff","CTO","worker"],{role:t}=d(),s=l(t);return k({queryKey:["discussions",n,r],queryFn:async({pageParam:a=1})=>{if(!t||!o.includes(t))throw new Error("Not allowed to make this API call");if(!s)throw new Error("API instance not found for role");return await C({organizationId:n,page:a,limit:e,filters:r,api:s})},getNextPageParam:a=>{const i=Math.ceil(a.totalConversations/a.limit);if(a.page<i)return a.page+1},getPreviousPageParam:a=>{if(a.page>1)return a.page-1},enabled:!!t&&o.includes(t)&&!!n,initialPageParam:1})},K=()=>{const n=["owner","staff","CTO","worker"],{role:e}=d(),r=l(e),o=p();return f({mutationFn:async({convoId:t,organizationId:s})=>{if(!e||!n.includes(e))throw new Error("Not allowed to make this API call");if(!r)throw new Error("API instance not found for role");return await P({organizationId:s,convoId:t,api:r})},onSuccess:(t,s)=>{o.invalidateQueries({queryKey:["discussions",s.organizationId]}),console.log("Conversation deleted successfully")},onError:t=>{console.error("Failed to delete conversation:",t)}})},$=({organizationId:n})=>{const{role:e}=d(),r=l(e),o=["owner","staff","CTO","worker"];return g({queryKey:["ticket","unread-count"],queryFn:async()=>{if(!e||!o.includes(e))throw new Error("Not allowed to make this API call");if(!r)throw new Error("API instance not found for role");return await F({api:r,organizationId:n})},enabled:!!e&&!!r&&o.includes(e)})},N=({organizationId:n})=>{const{role:e}=d(),r=["owner","staff","CTO","worker"],o=l(e);return f({mutationFn:async()=>{if(!e||!r.includes(e))throw new Error("Not allowed to make this API call");if(!o)throw new Error("API instance not found for role");return await A({api:o,organizationId:n})},onSuccess:()=>{h.invalidateQueries({queryKey:["ticket","unread-count"]})}})};export{S as a,K as b,O as c,N as d,Q as e,$ as f,T as u};
