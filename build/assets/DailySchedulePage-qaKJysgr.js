import{k as Z,r as h,j as e,a as fs,d as js}from"./index-Di9fivK2.js";import{c as vs,d as Ns,e as bs,f as ys,g as ws,h as ks,i as Ss,j as Cs,k as Is,l as Ts,m as As,n as Ps,o as Fs,p as Es}from"./workScheduleApi-DIwe66iW.js";import{B as P}from"./Button-CVj9LlQY.js";import{I as E}from"./Input-CT6Rp1Ze.js";import{T as Ee}from"./TextArea-CNqsm0SU.js";import{L as M}from"./Label-BBKatCOH.js";import{C as G,a as ee,b as se,c as ae}from"./Card-BLnLpKqb.js";import{S as Me,a as Re,b as De,c as Oe,d as ce}from"./Select-2mCnBtE3.js";import{t as v}from"./toast-BSC5QTk1.js";import{d as Ms}from"./downloadFile-Cbhp-aNT.js";import{I as ye}from"./ImageGalleryMain-BTw4CN_i.js";import"./roleCheck-CZ0YkMwP.js";import"./useQuery-D3U2IXUF.js";import"./useBaseQuery-DArxBqcU.js";import"./useMutation-Br_DKCOJ.js";import"./constants-BBhqUeDg.js";const Rs=()=>{var w;const x=Z(b=>b.authStore),O=Z(b=>b.userProfileStore),C=Z(b=>b.staffProfileStore),r=Z(b=>b.CTOProfileStore),R=Z(b=>b.workerProfileStore),p=Z(b=>b.clientProfileStore);if(!x.isauthenticated)return null;switch((w=x.role)==null?void 0:w.toLowerCase()){case"owner":return{id:(O==null?void 0:O.userId)||x._id,name:(O==null?void 0:O.userName)||""};case"staff":return{id:(C==null?void 0:C.staffId)||x._id,name:(C==null?void 0:C.staffName)||""};case"cto":return{id:(r==null?void 0:r.CTOId)||x._id,name:(r==null?void 0:r.CTOName)||""};case"worker":return{id:(R==null?void 0:R.workerId)||x._id,name:(R==null?void 0:R.workerName)||""};case"client":return{id:(p==null?void 0:p.clientId)||x._id,name:(p==null?void 0:p.clientName)||""};default:return null}},Ds=({projectId:x,isOpen:O,onClose:C,editData:r,onSave:R,onUpdate:p,scheduleId:w=null,refetch:b})=>{const J=h.useRef(null),B=h.useRef(null),N=Rs(),{data:m}=vs(x),[k,L]=h.useState({name:"",url:""}),[te,oe]=h.useState({name:"",url:""}),[I,de]=h.useState(null),[T,me]=h.useState(null),[re,W]=h.useState(50),[fe,Y]=h.useState(!1),ge=new Date().toISOString().split("T")[0],q=s=>{const t=xe=>String(xe).padStart(2,"0"),a=s.getFullYear(),l=t(s.getMonth()+1),i=t(s.getDate()),g=t(s.getHours()),z=t(s.getMinutes());return`${a}-${l}-${i}T${g}:${z}`},[c,A]=h.useState({projectAssignee:{projectName:"",siteAddress:"",designReferenceId:"",carpenterName:"",supervisorName:(N==null?void 0:N.name)||"",plannedStartDate:ge},dailyTasks:[{datePlanned:"",room:"",workDescription:"",startTime:"",endTime:"",materialsNeeded:[],manpower:0,status:"planned",uploadedImages:[]}],designPlanImages:[],siteImages:[],supervisorCheck:{reviewerName:(N==null?void 0:N.name)||"",reviewerId:(N==null?void 0:N.id)||"",reviewDateTime:q(new Date),status:"pending",remarks:"",gatekeeping:"block"}}),[V,ne]=h.useState(!1),[$,ue]=h.useState([]),[U,_]=h.useState([]),[he,K]=h.useState(!1),le=(s,t)=>{s.preventDefault(),Y(!1);const a=new DataTransfer;Array.from(s.dataTransfer.files).forEach(l=>a.items.add(l)),je(a.files,t)};h.useEffect(()=>{var s,t,a,l,i,g,z,xe,Ie,Te,Ae,Pe,Fe;if(!(!m&&!r)){if(A({projectAssignee:{projectName:((s=r==null?void 0:r.projectAssignee)==null?void 0:s.projectName)||(m==null?void 0:m.projectName)||"",siteAddress:((t=r==null?void 0:r.projectAssignee)==null?void 0:t.siteAddress)||(m==null?void 0:m.siteAddress)||"",designReferenceId:((a=r==null?void 0:r.projectAssignee)==null?void 0:a.designReferenceId)||(m==null?void 0:m.designReferenceId)||"",carpenterName:((l=r==null?void 0:r.projectAssignee)==null?void 0:l.carpenterName)||"",supervisorName:((i=r==null?void 0:r.projectAssignee)==null?void 0:i.supervisorName)||(N==null?void 0:N.name)||"",plannedStartDate:((g=r==null?void 0:r.projectAssignee)==null?void 0:g.plannedStartDate)||ge},dailyTasks:((z=r==null?void 0:r.dailyTasks)==null?void 0:z.map(ie=>({...ie,uploadedImages:ie.uploadedImages||[]})))||[{datePlanned:"",room:"",workDescription:"",startTime:"",endTime:"",materialsNeeded:[],manpower:0,status:"planned",uploadedImages:[]}],designPlanImages:(r==null?void 0:r.designPlanImages)||[],siteImages:(r==null?void 0:r.siteImages)||[],supervisorCheck:{reviewerName:((xe=r==null?void 0:r.supervisorCheck)==null?void 0:xe.reviewerName)||(N==null?void 0:N.name)||"",reviewerId:((Ie=r==null?void 0:r.supervisorCheck)==null?void 0:Ie.reviewerId)||(N==null?void 0:N.id)||"",reviewDateTime:((Te=r==null?void 0:r.supervisorCheck)==null?void 0:Te.reviewDateTime)||q(new Date),status:((Ae=r==null?void 0:r.supervisorCheck)==null?void 0:Ae.status)||"needs_changes",remarks:((Pe=r==null?void 0:r.supervisorCheck)==null?void 0:Pe.remarks)||"",gatekeeping:((Fe=r==null?void 0:r.supervisorCheck)==null?void 0:Fe.gatekeeping)||"block"}}),r!=null&&r.dailyTasks){const ie={};r.dailyTasks.forEach((be,xs)=>{be.materialsNeeded&&be.materialsNeeded.length>0&&(ie[xs]=be.materialsNeeded.join(", "))}),pe(ie)}r!=null&&r.workComparison?_(r.workComparison):_([])}},[m,r]);const[n,o]=h.useState([]),[d,u]=h.useState([]),f=Ns(),j=bs(),{mutateAsync:S,isPending:y}=ys(),F=(s,t)=>{A(a=>({...a,projectAssignee:{...a.projectAssignee,[s]:t}}))},X=s=>s?new Date(s).toISOString().split("T")[0]:"",D=(s,t,a)=>{A(l=>({...l,dailyTasks:l.dailyTasks.map((i,g)=>g===s?{...i,[t]:a}:i)}))},[Q,pe]=h.useState({}),_e=(s,t)=>{pe(a=>({...a,[s]:t})),A(a=>({...a,dailyTasks:a.dailyTasks.map((l,i)=>i===s?{...l,materialsNeeded:t.split(",").map(g=>g.trim()).filter(g=>g)}:l)}))},Le=()=>{A(s=>({...s,dailyTasks:[...s.dailyTasks,{datePlanned:"",room:"",workDescription:"",startTime:"",endTime:"",materialsNeeded:[],manpower:0,status:"planned",uploadedImages:[]}]}))},Ue=()=>{A(s=>({...s,dailyTasks:[{datePlanned:"",room:"",workDescription:"",startTime:"",endTime:"",materialsNeeded:[],manpower:0,status:"planned",uploadedImages:[]}]}))},We=s=>{A(t=>({...t,dailyTasks:t.dailyTasks.filter((a,l)=>l!==s)}))},H=(s,t)=>{A(a=>({...a,supervisorCheck:{...a.supervisorCheck,[s]:t}}))},$e=async()=>{var s,t;try{if(r){const a=new FormData;a.append("projectAssignee",JSON.stringify(c.projectAssignee)),a.append("dailyTasks",JSON.stringify(c.dailyTasks)),a.append("supervisorCheck",JSON.stringify(c.supervisorCheck)),T&&a.append("actualImage",T),I&&a.append("plannedImage",I),n.forEach(l=>a.append("designPlanImages",l)),d.forEach(l=>a.append("siteImages",l)),await j.mutateAsync({projectId:x,scheduleId:r._id,formData:a}),p==null||p(c),v({title:"Success",description:"updated successfully"})}else{const a=new FormData;a.append("projectAssignee",JSON.stringify(c.projectAssignee)),a.append("dailyTasks",JSON.stringify(c.dailyTasks)),a.append("supervisorCheck",JSON.stringify(c.supervisorCheck)),T&&a.append("actualImage",T),I&&a.append("plannedImage",I),n.forEach(l=>a.append("designPlanImages",l)),d.forEach(l=>a.append("siteImages",l)),console.log("first enteirng i"),await f.mutateAsync({projectId:x,formData:a}),b(),R==null||R(c),v({title:"Success",description:"Created successfully"})}C()}catch(a){console.error("Error saving work schedule:",a),v({title:"Error",description:((t=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:t.message)||"something went wrong",variant:"destructive"})}},ze=async()=>{var s,t;try{const a=new FormData;a.append("projectAssignee",JSON.stringify(c.projectAssignee)),a.append("dailyTasks",JSON.stringify(c.dailyTasks)),a.append("supervisorCheck",JSON.stringify(c.supervisorCheck)),T&&a.append("actualImage",T),I&&a.append("plannedImage",I),n.forEach(i=>a.append("designPlanImages",i)),d.forEach(i=>a.append("siteImages",i));let l;r?l=await S({projectId:x,scheduleId:w,formData:a}):l=await S({projectId:x,formData:a}),Ms({src:l.downloadUrl,alt:l.fileName}),v({description:"Pdf Generated successfully",title:"Success"})}catch(a){v({title:"Error",description:((t=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to generate Pdf",variant:"destructive"})}},je=(s,t)=>{if(!s)return;const a=Array.from(s);if(t==="design"){const l=a.map(i=>({file:i,url:URL.createObjectURL(i)}));A(i=>({...i,designPlanImages:[...i.designPlanImages,...l]})),o(i=>[...i,...a])}else if(t==="site"){const l=a.map(i=>({file:i,url:URL.createObjectURL(i)}));A(i=>({...i,siteImages:[...i.siteImages,...l]})),u(i=>[...i,...a])}},we=(s,t)=>{t==="design"?(A(a=>({...a,designPlanImages:a.designPlanImages.filter((l,i)=>i!==s)})),o(a=>a.filter((l,i)=>i!==s))):t==="site"&&(A(a=>({...a,siteImages:a.siteImages.filter((l,i)=>i!==s)})),u(a=>a.filter((l,i)=>i!==s)))},Je=()=>{const s=JSON.stringify(c,null,2),t=new Blob([s],{type:"application/json"}),a=URL.createObjectURL(t),l=document.createElement("a");l.href=a,l.download=`work-schedule-${Date.now()}.json`,l.click(),URL.revokeObjectURL(a)},Be=s=>{var l;const t=(l=s.target.files)==null?void 0:l[0];if(!t)return;const a=new FileReader;a.onload=i=>{var g;try{const z=JSON.parse((g=i.target)==null?void 0:g.result);A(z)}catch(z){console.error("Error importing JSON:",z)}},a.readAsText(t)},[Ve,ke]=h.useState(null),[Ke,He]=h.useState({}),{mutateAsync:Ye,isPending:Se}=ws(),{mutateAsync:qe,isPending:ve}=ks(),{mutateAsync:Xe}=Ss(),{mutateAsync:Qe}=Cs(),{mutateAsync:Ze,isPending:Ge}=Is(),{mutateAsync:es}=Ts(),ss=s=>{V&&ue(t=>t.includes(s)?t.filter(a=>a!==s):[...t,s])},as=async()=>{var s,t;try{if($.length===0)return;const a=$.map(i=>({...i})),l=await Ye({projectId:x,scheduleId:w,formData:a});_(i=>[...i,l]),v({description:"Pdf Generated successfully",title:"Success"})}catch(a){v({title:"Error",description:((t=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to generate Pdf",variant:"destructive"})}},ts=async(s,t)=>{var l,i;if(!s||s.length===0)return;const a=new FormData;Array.from(s).forEach(g=>{a.append("files",g)});try{const g=await Ze({projectId:x,scheduleId:w,comparisonId:t,formData:a});_(g)}catch(g){v({title:"Error",description:((i=(l=g==null?void 0:g.response)==null?void 0:l.data)==null?void 0:i.message)||"Failed to upload corrected images",variant:"destructive"})}},Ne=async(s,t)=>{var l,i;if(!s||s.length===0)return;const a=new FormData;Array.from(s).forEach(g=>{a.append("correctfiles",g)});try{const g=await qe({projectId:x,scheduleId:w,comparisonId:t,formData:a});_(g),b()}catch(g){v({title:"Error",description:((i=(l=g==null?void 0:g.response)==null?void 0:l.data)==null?void 0:i.message)||"Failed to upload images",variant:"destructive"})}},rs=async(s,t)=>{var a,l;try{const i=await es({projectId:x,scheduleId:w,comparisonId:s,imageId:t});_(i),v({title:"Success",description:"Corrected image deleted successfully"})}catch(i){v({title:"Error",description:((l=(a=i==null?void 0:i.response)==null?void 0:a.data)==null?void 0:l.message)||"Failed to delete corrected image",variant:"destructive"})}},ns=async(s,t)=>{var a,l;try{const i=await Qe({projectId:x,scheduleId:w,comparisonId:s,selectId:t});_(i),v({title:"Success",description:"image deleted successfully"})}catch(i){v({title:"Error",description:((l=(a=i==null?void 0:i.response)==null?void 0:a.data)==null?void 0:l.message)||"Failed to delete corrected image",variant:"destructive"})}},ls=async(s,t,a)=>{var l,i;try{const g=await Xe({projectId:x,scheduleId:w,comparisonId:s,selectedImageId:t,data:{comment:a}});_(g),ke(""),v({title:"Success",description:"Comment updated successfully"})}catch(g){v({title:"Error",description:((i=(l=g==null?void 0:g.response)==null?void 0:l.data)==null?void 0:i.message)||"Failed to update comment",variant:"destructive"})}},is=s=>{const t=s.target.files[0];t&&(L({name:t.name,url:URL.createObjectURL(t)}),de(t))},cs=s=>{const t=s.target.files[0];t&&(oe({name:t.name,url:URL.createObjectURL(t)}),me(t))},os=s=>{Y(!0),s.preventDefault()},ds=s=>{if(!fe)return;const t=s.currentTarget.getBoundingClientRect(),a=s.clientX-t.left,l=Math.max(0,Math.min(100,a/t.width*100));W(l)},Ce=()=>{Y(!1)},ms=()=>{W(50)},gs=()=>{L({name:"",url:""}),de(null)},us=()=>{oe({name:"",url:""}),me(null)},hs=s=>{const t=c.dailyTasks.find((a,l)=>s===l);return(t==null?void 0:t.status)||"planned"},ps=()=>{const s=c.supervisorCheck.status;return s==="approved"?"Approved":s==="needs_changes"?"Changes Required":"Pending"};return O?e.jsx("div",{onClick:C,className:"fixed inset-0 bg-black/70 bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{onClick:s=>s.stopPropagation(),className:"bg-white rounded-lg max-w-[90%] max-h-[90vh] overflow-y-auto w-full mx-4",children:[e.jsx("div",{className:"bg-blue-600 text-white p-4 rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Vertical Living — Carpenter Work Schedule & Visual Approval"}),e.jsx("p",{className:"text-sm opacity-90",children:"RAMS TECH CIRCLE OPC Pvt. Ltd. • No. 22, 13th Main Road, Anna Nagar West, Chennai - 600040 • WhatsApp: +91 93639 93814"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(P,{isLoading:j.isPending||f.isPending,variant:"secondary",size:"sm",onClick:$e,children:"Save"}),e.jsx(P,{variant:"secondary",size:"sm",onClick:Je,children:"Export JSON"}),e.jsx("input",{id:"json-import",type:"file",accept:".json",className:"hidden",onChange:Be}),e.jsx(P,{variant:"secondary",size:"sm",onClick:()=>{var s;return(s=document.getElementById("json-import"))==null?void 0:s.click()},children:"Import JSON"}),e.jsx(P,{variant:"secondary",isLoading:y,onClick:ze,size:"sm",children:"Print / PDF"}),e.jsx(P,{variant:"secondary",size:"sm",onClick:C,children:e.jsx("i",{className:"fas fa-times"})})]})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs(G,{children:[e.jsx(ee,{children:e.jsxs(se,{className:"flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-file-text"}),"Project & Assignee",e.jsx(P,{variant:"link",size:"sm",className:"ml-auto text-blue-600",children:"Single sheet for multiple days"})]})}),e.jsx(ae,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"projectName",children:"Project Name"}),e.jsx(E,{id:"projectName",placeholder:"e.g., Shankar Residence — Wardrobe & TV Unit",value:c.projectAssignee.projectName,onChange:s=>F("projectName",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"siteAddress",children:"Site Address"}),e.jsx(E,{id:"siteAddress",placeholder:"Full address",value:c.projectAssignee.siteAddress,onChange:s=>F("siteAddress",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"designReferenceId",children:"Design Reference ID"}),e.jsx(E,{id:"designReferenceId",placeholder:"e.g., VL-KTN-2025-001",value:c.projectAssignee.designReferenceId,onChange:s=>F("designReferenceId",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"carpenterName",children:"Carpenter Name"}),e.jsx(E,{id:"carpenterName",placeholder:"Assigned carpenter",value:c.projectAssignee.carpenterName,onChange:s=>F("carpenterName",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"supervisorName",children:"Supervisor Name"}),e.jsx(E,{id:"supervisorName",placeholder:"Site supervisor",value:c.projectAssignee.supervisorName,onChange:s=>F("supervisorName",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"plannedStartDate",children:"Planned Start Date"}),e.jsx(E,{id:"plannedStartDate",type:"date",value:c.projectAssignee.plannedStartDate,onChange:s=>F("plannedStartDate",s.target.value)})]})]})})]}),e.jsxs(G,{children:[e.jsx(ee,{children:e.jsxs(se,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-calendar-days"}),"Daily Work Schedule"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(P,{variant:"outline",size:"sm",onClick:Le,children:[e.jsx("i",{className:"fas fa-plus mr-1"}),"Add Task"]}),e.jsx(P,{variant:"outline",onClick:Ue,size:"sm",children:"Clear"})]})]})}),e.jsx(ae,{children:e.jsx("div",{className:"h-fit border overflow-y-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100",children:[e.jsx("th",{className:"border p-2 text-center",children:"DATE"}),e.jsx("th",{className:"border p-2 text-center",children:"ROOM / UNIT"}),e.jsx("th",{className:"border p-2 text-center",children:"WORK DESCRIPTION"}),e.jsx("th",{className:"border p-2 text-center",children:"START"}),e.jsx("th",{className:"border p-2 text-center",children:"END"}),e.jsx("th",{className:"border p-2 text-center",children:"MATERIALS NEEDED"}),e.jsx("th",{className:"border p-2 text-center",children:"MANPOWER"}),e.jsx("th",{className:"border p-2 text-center",children:"STATUS"}),e.jsx("th",{className:"border p-2 text-center",children:"ACTIONS"})]})}),e.jsx("tbody",{className:"",children:c.dailyTasks.map((s,t)=>e.jsxs("tr",{children:[e.jsx("td",{className:"border p-2",children:e.jsx(E,{type:"date",value:X(s.datePlanned),onChange:a=>D(t,"datePlanned",a.target.value)})}),e.jsx("td",{className:"border p-2",children:e.jsx(E,{placeholder:"Kitchen",value:s.room,onChange:a=>D(t,"room",a.target.value)})}),e.jsx("td",{className:"border p-2",children:e.jsx(Ee,{placeholder:"Base unit carcass fixing & levelling",value:s.workDescription,onChange:a=>D(t,"workDescription",a.target.value),rows:2})}),e.jsx("td",{className:"border p-2",children:e.jsx(E,{type:"time",value:s.startTime,onChange:a=>D(t,"startTime",a.target.value)})}),e.jsx("td",{className:"border p-2",children:e.jsx(E,{type:"time",value:s.endTime,onChange:a=>D(t,"endTime",a.target.value)})}),e.jsx("td",{className:"border p-2",children:e.jsx(E,{placeholder:"Plywood, laminate, screws",value:Q[t]??"",onChange:a=>_e(t,a.target.value)})}),e.jsx("td",{className:"border p-2",children:e.jsx(E,{type:"number",placeholder:"No of workers",value:s.manpower,onChange:a=>D(t,"manpower",Number.parseInt(a.target.value)||0)})}),e.jsx("td",{className:"border p-2",children:e.jsxs(Me,{value:s.status,onValueChange:a=>D(t,"status",a),children:[e.jsx(Re,{children:e.jsx(De,{selectedValue:hs(t)})}),e.jsxs(Oe,{children:[e.jsx(ce,{value:"planned",children:"Planned"}),e.jsx(ce,{value:"in-progress",children:"In Progress"}),e.jsx(ce,{value:"completed",children:"Completed"})]})]})}),e.jsx("td",{className:"border p-2",children:e.jsx("div",{className:"flex gap-1",children:e.jsx(P,{variant:"danger",size:"sm",onClick:()=>We(t),children:e.jsx("i",{className:"fas fa-trash"})})})})]},t))})]})})})]}),e.jsxs(G,{className:"",children:[e.jsx(ee,{children:e.jsxs(se,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Laminate/Design/Plan Images — for Explanation"}),e.jsx(P,{variant:"outline",size:"sm",className:"text-blue-600 bg-transparent",children:"Upload reference plans, markups, sketches"})]})}),e.jsxs(ae,{children:[e.jsx("div",{className:`border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors ${he?"border-blue-400 bg-blue-50":"border-gray-300"}`,onClick:()=>{var s;return(s=J.current)==null?void 0:s.click()},onDragOver:s=>{s.preventDefault(),K(!0)},onDragLeave:()=>K(!1),onDrop:s=>le(s,"design"),children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-lg font-medium",children:"Drag & drop plan/reference images here or"}),e.jsx(P,{variant:"outline",children:"Browse"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Accepted: JPG/PNG/WebP • Images auto-saved locally"})]})}),e.jsx("input",{ref:J,type:"file",multiple:!0,accept:"image/*",className:"hidden",onChange:s=>je(s.target.files,"design")}),c.designPlanImages.length>0&&e.jsx("div",{className:"mt-4",children:e.jsx("div",{className:"flex flex-wrap gap-4 mt-4",children:c.designPlanImages.map((s,t)=>e.jsxs("div",{className:"relative group w-32 h-32",children:[e.jsx("img",{src:s.url||"",alt:s.originalName||`Image ${t+1}`,className:"w-full h-full object-cover rounded-lg border shadow-sm"}),!s._id&&e.jsx("button",{type:"button",onClick:()=>we(t,"design"),className:"absolute top-1 right-1 bg-red-600 text-white rounded-full w-6 h-6 flex items-center justify-center opacity-0 group-hover:opacity-100 hover:bg-red-700 transition-opacity",children:"×"})]},t))})})]})]}),e.jsxs(G,{children:[e.jsx(ee,{children:e.jsxs(se,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Site / Actual Images — for Visual Confirmation"}),e.jsx(P,{variant:"outline",size:"sm",className:"text-blue-600 bg-transparent",children:"Upload daily progress photos"})]})}),e.jsxs(ae,{children:[e.jsx("div",{className:`border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors ${he?"border-blue-400 bg-blue-50":"border-gray-300"}`,onClick:()=>{var s;return(s=B.current)==null?void 0:s.click()},onDragOver:s=>{s.preventDefault(),K(!0)},onDragLeave:()=>K(!1),onDrop:s=>le(s,"site"),children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-lg font-medium",children:"Drag & drop site/progress images here or"}),e.jsx(P,{variant:"outline",children:"Browse"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Tip: Upload clear, well-lit photos with unit labels in frame"})]})}),e.jsx("input",{ref:B,type:"file",multiple:!0,accept:"image/*",className:"hidden",onChange:s=>je(s.target.files,"site")}),e.jsx("div",{children:r&&e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("input",{type:"checkbox",id:"correctionMode",checked:V,onChange:s=>{ne(s.target.checked),s.target.checked||ue([])}}),e.jsx("label",{htmlFor:"correctionMode",className:"text-sm font-medium",children:"Select images for correction"}),V&&e.jsx(P,{size:"sm",className:"bg-green-600 text-white",disabled:$.length===0||Se,onClick:as,children:Se?"Uploading...":"Upload Selected"})]})}),c.siteImages.length>0&&e.jsx("div",{className:"mt-4",children:e.jsx("div",{className:"flex flex-wrap gap-4 mt-4",children:c.siteImages.map((s,t)=>{const a=$.includes(s);return e.jsxs("div",{className:"relative group w-32 h-32",children:[e.jsx("img",{onClick:()=>ss(s),src:s.url||"",alt:s.originalName||`Image ${t+1}`,className:"w-full h-full object-cover rounded-lg border shadow-sm"}),a&&e.jsx("i",{className:"fa fa-check absolute top-1 right-1 text-green-600 bg-white rounded-full p-1 shadow-md"}),!V&&e.jsx("button",{type:"button",onClick:()=>we(t,"site"),className:"absolute top-1 right-1 bg-red-600 text-white rounded-full w-6 h-6 flex items-center justify-center opacity-0 group-hover:opacity-100 hover:bg-red-700 transition-opacity",children:"×"})]},t)})})})]})]}),r&&e.jsxs(G,{children:[e.jsx(ee,{children:e.jsx(se,{className:"",children:"Correction Section"})}),e.jsx(ae,{children:U&&U.length>0?e.jsxs(e.Fragment,{children:[U.map((s,t)=>e.jsx(h.Fragment,{children:e.jsx("div",{className:" border-b pb-6 last:border-b-0",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[e.jsxs("div",{className:"md:w-1/2 w-full",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"text-sm font-medium block mb-2",children:["Upload Select Images (Stage ",t+1,")"]}),e.jsx("input",{type:"file",multiple:!0,accept:"image/*",className:"border-2 border-dashed rounded-md p-2 w-full text-sm text-gray-600",onChange:a=>Ne(a.target.files,s._id)}),ve&&e.jsx("span",{className:"ml-2 text-gray-600 animate-spin",children:e.jsx("i",{className:"fas fa-spinner animate-spin"})})]}),e.jsxs("h3",{className:"text-md font-semibold mb-2",children:["Stage ",t+1,": Selected Images for Correction"]}),s.selectImage&&s.selectImage.length>0?e.jsx("div",{className:"flex flex-wrap gap-4",children:e.jsx(ye,{imageFiles:s==null?void 0:s.selectImage.map(a=>{const{_id:l,...i}=a.plannedImage||{};return{_id:a._id,...i,comment:a.comment,createdBy:a.createdBy,createModel:a.createModel,createdAt:a.createdAt}}),handleDeleteFile:a=>{ns(s._id,a)},height:120,minWidth:120,maxWidth:140,isComments:!0,editingId:Ve,tempComment:Ke,setEditingId:ke,setTempComment:He,onUpdateComment:(a,l)=>ls(s._id,a,l)})}):e.jsx("div",{className:"text-sm text-gray-500",children:"No selected images available for this comparison."})]}),e.jsx("div",{className:"md:w-1/2 w-full flex flex-col justify-between",children:e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"text-sm font-medium block mb-2",children:["Upload Refactored Images (Stage ",t+1,")"]}),e.jsx("input",{type:"file",multiple:!0,accept:"image/*",className:"border-2 border-dashed rounded-md p-2 w-full text-sm text-gray-600",onChange:a=>ts(a.target.files,s._id)}),Ge&&e.jsx("span",{className:"ml-2 text-gray-600 animate-spin",children:e.jsx("i",{className:"fas fa-spinner animate-spin"})})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-md font-semibold mb-2",children:["Stage ",t+1,": Refactored Outputs"]}),s.correctedImages&&s.correctedImages.length>0?e.jsx("div",{className:"flex flex-wrap gap-4",children:e.jsx(ye,{imageFiles:s==null?void 0:s.correctedImages,handleDeleteFile:a=>rs(s._id,a),refetch:b,height:120,minWidth:120,maxWidth:140})}):e.jsx("div",{className:"text-sm text-gray-500",children:"No refactored images uploaded yet."})]})]})})]})})},s._id||t)),e.jsxs("div",{className:"md:w-1/2 w-full flex flex-col justify-between",children:[e.jsx("div",{children:e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"text-sm font-medium block mb-2",children:["Upload Select Images (Stage ",(U==null?void 0:U.length)+1||1,")"]}),e.jsx("input",{type:"file",multiple:!0,accept:"image/*",className:"border-2 border-dashed rounded-md p-2 w-full text-sm text-gray-600",onChange:s=>Ne(s.target.files,null)}),ve&&e.jsx("span",{className:"ml-2 text-gray-600 animate-spin",children:e.jsx("i",{className:"fas fa-spinner animate-spin"})})]})}),e.jsx("div",{children:e.jsxs("h3",{className:"text-md font-semibold mb-2",children:["Stage  ",U.length+1||1,": Select Outputs"]})})]})]}):e.jsxs("div",{className:"md:w-1/2 w-full flex flex-col justify-between",children:[e.jsx("div",{children:e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-sm font-medium block mb-2",children:"Upload Select Images (Stage 1)"}),e.jsx("input",{type:"file",multiple:!0,accept:"image/*",className:"border-2 border-dashed rounded-md p-2 w-full text-sm text-gray-600",onChange:s=>Ne(s.target.files,null)}),ve&&e.jsx("span",{className:"ml-2 text-gray-600 animate-spin",children:e.jsx("i",{className:"fas fa-spinner animate-spin"})})]})}),e.jsx("div",{children:e.jsx("h3",{className:"text-md font-semibold mb-2",children:"Stage 1: Select Outputs"})})]})})]}),e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Planned vs Actual — Slider Comparison"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{var s;return(s=document.getElementById("planned-image"))==null?void 0:s.click()},className:"bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700",children:"Pick Planned"}),e.jsx("button",{onClick:()=>{var s;return(s=document.getElementById("actual-image"))==null?void 0:s.click()},className:"bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700",children:"Pick Actual"}),e.jsx("button",{onClick:ms,className:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600",children:"Reset"})]})]}),e.jsx("div",{className:"relative w-[100%] h-96 bg-gray-100 rounded-lg overflow-hidden border",children:k.url||te.url?e.jsxs("div",{className:"relative w-full h-full cursor-col-resize",onMouseMove:ds,onMouseUp:Ce,onMouseLeave:Ce,children:[k.url&&e.jsxs("div",{className:"absolute top-0 left-0 h-full overflow-visible",style:{width:`${re}%`},children:[e.jsx("img",{src:k.url,alt:"plannedimage",className:"absolute top-0 left-0 w-[100%] h-[100%] object-cover",style:{clipPath:"inset(0px 0% 0px 0px)"}}),e.jsx("div",{className:"absolute bottom-2 left-2 bg-black bg-opacity-70 text-white px-2 py-1 rounded text-sm",children:"Planned"}),e.jsx("button",{onClick:gs,className:"absolute top-2 left-2 bg-red-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs hover:bg-red-700",children:e.jsx("i",{className:"fas fa-times"})})]}),te.url&&e.jsxs("div",{className:"absolute top-0 right-0 h-full overflow-hidden",style:{width:`${100-re}%`},children:[e.jsx("img",{src:te.url||"/placeholder.svg",alt:"Actual",className:"h-full object-cover",style:{width:"100%",maxWidth:"none"}}),e.jsx("div",{className:"absolute bottom-2 right-2 bg-black bg-opacity-70 text-white px-2 py-1 rounded text-sm",children:"Actual"}),e.jsx("button",{onClick:us,className:"absolute top-2 right-2 bg-red-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs hover:bg-red-700",children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsx("div",{className:"absolute top-0 h-full w-1 bg-white shadow-lg cursor-col-resize z-10",style:{left:`${re}%`,transform:"translateX(-50%)"},children:e.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-8 h-8 bg-white rounded-full shadow-lg border-2 border-gray-300 cursor-col-resize flex items-center justify-center",onMouseDown:os,children:e.jsx("i",{className:"fas fa-arrows-alt-h text-gray-600 text-xs"})})})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"fas fa-images text-4xl mb-4"}),e.jsx("p",{className:"text-lg",children:"Upload planned and actual images to compare"}),e.jsx("p",{className:"text-sm",children:"Use the buttons above to select images"})]})})}),e.jsx("p",{className:"text-sm text-gray-600 mt-2 text-center",children:"Drag the circle to reveal differences"}),e.jsx("input",{id:"planned-image",type:"file",accept:"image/*",onChange:is,className:"hidden"}),e.jsx("input",{id:"actual-image",type:"file",accept:"image/*",onChange:cs,className:"hidden"})]}),e.jsxs(G,{children:[e.jsx(ee,{children:e.jsxs(se,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Supervisor Visual Check & Approval"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-orange-500 rounded-full"}),e.jsx("span",{className:"text-sm",children:ps()})]})]})}),e.jsxs(ae,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"reviewerName",children:"Reviewer Name"}),e.jsx(E,{id:"reviewerName",placeholder:"Staff doing the check",value:c.supervisorCheck.reviewerName,onChange:s=>H("reviewerName",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"reviewDateTime",children:"Review Date & Time"}),e.jsx(E,{id:"reviewDateTime",type:"datetime-local",value:c.supervisorCheck.reviewDateTime,onChange:s=>H("reviewDateTime",s.target.value)})]})]}),e.jsx("div",{className:"flex gap-4 mb-4",children:e.jsxs("div",{className:"flex gap-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",id:"pending",name:"status",value:"pending",checked:c.supervisorCheck.status==="pending",onChange:s=>H("status",s.target.value),className:"hidden peer"}),e.jsx(M,{htmlFor:"pending",className:`px-4 py-2 rounded-xl cursor-pointer border-2 transition-colors
        ${c.supervisorCheck.status==="pending"?"border-gray-500 bg-gray-100 text-gray-900 font-semibold":"border-gray-300 text-gray-600 hover:border-gray-400 hover:bg-gray-50"}`,children:"Pending"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",id:"approved",name:"status",value:"approved",checked:c.supervisorCheck.status==="approved",onChange:s=>H("status",s.target.value),className:"hidden peer"}),e.jsx(M,{htmlFor:"approved",className:`px-4 py-2 rounded-xl cursor-pointer border-2 transition-colors
        ${c.supervisorCheck.status==="approved"?"border-green-600 bg-green-100 text-green-800 font-semibold":"border-gray-300 text-green-700 hover:border-green-400 hover:bg-green-50"}`,children:"Approve"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",id:"needs_changes",name:"status",value:"needs_changes",checked:c.supervisorCheck.status==="needs_changes",onChange:s=>H("status",s.target.value),className:"hidden peer"}),e.jsx(M,{htmlFor:"needs_changes",className:`px-4 py-2 rounded-xl cursor-pointer border-2 transition-colors
        ${c.supervisorCheck.status==="needs_changes"?"border-orange-600 bg-orange-100 text-orange-800 font-semibold":"border-gray-300 text-orange-700 hover:border-orange-400 hover:bg-orange-50"}`,children:"Changes Required"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"remarks",children:"Remarks / Observations"}),e.jsx(Ee,{id:"remarks",placeholder:"Note deviations, rework needed, or greenlight to proceed",value:c.supervisorCheck.remarks,onChange:s=>H("remarks",s.target.value),rows:3})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"gatekeeping",children:"Gatekeeping (Workflow Interlock)"}),e.jsxs(Me,{value:c.supervisorCheck.gatekeeping,onValueChange:s=>H("gatekeeping",s),children:[e.jsx(Re,{selectedValue:c.supervisorCheck.gatekeeping,children:e.jsx(De,{selectedValue:c.supervisorCheck.gatekeeping==="block"?"BLOCK work to start with Supervisor Watch":"ALLOW work to start with Supervisor Watch"})}),e.jsxs(Oe,{children:[e.jsx(ce,{value:"block",children:"BLOCK work to start with Supervisor Watch"}),e.jsx(ce,{value:"allow_with_watch",children:"ALLOW work to start with Supervisor Watch"})]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Matches CRM philosophy used in Material Arrival stage — prevent next step until approval."})]})]})]})]})]})]})}):null},Zs=()=>{var le;const{projectId:x}=fs(),[O,C]=h.useState(!1),[r,R]=h.useState([]),[p,w]=h.useState(null),[b,J]=h.useState(null),[B,N]=h.useState(new Date),[m,k]=h.useState(null),[L,te]=h.useState([]),[oe,I]=h.useState(!1),de=js(),{data:T,isLoading:me,error:re,refetch:W}=As(x),{mutateAsync:fe}=Ps(),Y=Fs(),ge=Es();h.useEffect(()=>{(()=>{const o=B.getFullYear(),d=B.getMonth(),u=new Date(o,d,1),f=new Date(u);f.setDate(f.getDate()-u.getDay());const j=[],S=new Date(f);for(let y=0;y<42;y++)j.push({date:new Date(S),isCurrentMonth:S.getMonth()===d}),S.setDate(S.getDate()+1);R(j)})()},[B]);const q=h.useCallback(()=>{if(!p)return;const n=new Date(p);n.setDate(n.getDate()-1),ne(n)},[p]),c=h.useCallback(()=>{if(!p)return;const n=new Date(p);n.setDate(n.getDate()+1),ne(n)},[p]);h.useEffect(()=>{const n=o=>{p&&(o.key==="Escape"?(w(null),k(null),I(!1)):o.key==="ArrowRight"?c():o.key==="ArrowLeft"&&q())};return document.addEventListener("keydown",n),()=>{document.removeEventListener("keydown",n)}},[c,q]);const A=n=>`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}-${String(n.getDate()).padStart(2,"0")}`,V=n=>{const o=A(n);return T.flatMap(d=>(d.dailyTasks||[]).filter(f=>(typeof f.datePlanned=="string"?f.datePlanned.split("T")[0]:new Date(f.datePlanned).toISOString().split("T")[0])===o).map(f=>({...f,scheduleId:d._id})))},ne=n=>{const o=V(n);w(n),te(o),o.length===1?(k(o[0]),I(!1)):o.length>1&&(I(!0),k(null))},$=n=>{switch(n){case"completed":return"bg-green-200 text-green-800";case"in_progress":return"bg-yellow-200 text-yellow-800";case"planned":return"bg-blue-200 text-blue-800";default:return"bg-gray-200 text-gray-800"}},ue=n=>{const o=T.find(d=>d._id===n);o&&(J(o),C(!0))},U=async n=>{var o,d;try{await fe({scheduleId:n.scheduleId,taskId:n._id,projectId:x}),w(null),k(null),W(),v({title:"Success",description:"deleted successfully"})}catch(u){v({title:"Error",description:((d=(o=u==null?void 0:u.response)==null?void 0:o.data)==null?void 0:d.message)||"failed to delete",variant:"destructive"})}},_=async(n,o)=>{var d,u,f;if(p)try{const j=(d=T==null?void 0:T.find(S=>S.dailyTasks.some(y=>y._id===o._id)))==null?void 0:d._id;if(j){const S=await Y.mutateAsync({scheduleId:j,taskId:o._id,date:p.toISOString().split("T")[0],projectId:x,files:n});W(),k(y=>{var X;if(!y)return y;const F=(X=y.uploadedImages)==null?void 0:X.find(D=>new Date(D.date).toDateString()===p.toDateString());return F?(F.uploads.push(...S.uploads),{...y,uploadedImages:[...y.uploadedImages]}):{...y,uploadedImages:[...y.uploadedImages||[],S]}}),v({title:"Success",description:"image uploaded successfully"})}}catch(j){v({title:"Error",description:((f=(u=j==null?void 0:j.response)==null?void 0:u.data)==null?void 0:f.message)||"failed to upload",variant:"destructive"})}},he=async(n,o)=>{var d,u,f;try{const j=(d=T==null?void 0:T.find(S=>S.dailyTasks.some(y=>y._id===o._id)))==null?void 0:d._id;if(j){const S=await ge.mutateAsync({scheduleId:j,taskId:o._id,date:(p==null?void 0:p.toISOString().split("T")[0])||"",projectId:x,imageId:n});console.log("upladsImages",S),W();const y=(p==null?void 0:p.toISOString().split("T")[0])||"";k(F=>{var D;if(!F)return F;const X=(D=F.uploadedImages)==null?void 0:D.map(Q=>Q.date.split("T")[0]===y?{...Q,uploads:Q.uploads.filter(pe=>pe._id!==n)}:Q);return{...F,uploadedImages:X}}),v({title:"Success",description:"deleted successfully"})}}catch(j){v({title:"Error",description:((f=(u=j==null?void 0:j.response)==null?void 0:u.data)==null?void 0:f.message)||"failed to delete",variant:"destructive"})}},K=n=>{N(o=>{const d=new Date(o);return d.setMonth(o.getMonth()+n),d})};return me?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"fas fa-spinner fa-spin text-4xl text-blue-600 mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading schedule..."})]})}):re?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"fas fa-exclamation-triangle text-4xl text-red-600 mb-4"}),e.jsx("p",{className:"text-red-600",children:"Error loading schedule data"})]})}):e.jsx("div",{className:"max-h-full overflow-y-auto bg-gray-50",children:e.jsx("div",{className:" mx-auto px-4 py-8",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("button",{className:"bg-gray-100 rounded-lg px-2 py-1 cursor-pointer",onClick:()=>{de(-1)},children:[e.jsx("i",{className:"fas fa-arrow-left mr-1 "}),"back"]}),e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Work Schedule Calendar"}),e.jsxs("button",{onClick:()=>C(!0),className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-plus"}),"Add Events"]})]}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("button",{onClick:()=>K(-1),className:"p-2 hover:bg-gray-100 rounded",children:e.jsx("i",{className:"fas fa-chevron-left"})}),e.jsx("h2",{className:"text-xl font-semibold",children:B.toLocaleDateString("en-US",{month:"long",year:"numeric"})}),e.jsx("button",{onClick:()=>K(1),className:"p-2 hover:bg-gray-100 rounded",children:e.jsx("i",{className:"fas fa-chevron-right"})})]}),e.jsxs("div",{className:"grid grid-cols-7 gap-1 mb-4",children:[["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(n=>e.jsx("div",{className:"p-3 text-center font-semibold text-gray-600 bg-gray-100",children:n},n)),r.map((n,o)=>{const d=V(n.date);return e.jsxs("div",{className:`min-h-[120px] p-2 border border-gray-200 cursor-pointer hover:bg-gray-50 ${n.isCurrentMonth?"bg-white":"bg-gray-50"}`,onClick:()=>ne(n.date),children:[e.jsx("div",{className:"font-medium text-sm mb-1",children:n.date.getDate()}),d.length===0?e.jsx("div",{className:"text-xs text-gray-400 italic",children:"No tasks assigned"}):e.jsxs("div",{className:"space-y-1",children:[d.slice(0,2).map((u,f)=>e.jsx("div",{className:`text-xs p-1 rounded truncate ${$(u.status)}`,children:u.workDescription||u.room},f)),d.length>2&&e.jsxs("div",{className:"text-xs text-blue-600 font-medium",children:["+",d.length-2," more"]})]})]},o)})]}),p&&e.jsxs("div",{onClick:()=>{J(null),w(null),k(null),I(!1)},className:"fixed inset-0 bg-black/70 bg-opacity-50 flex items-center justify-around z-50",children:[e.jsx("button",{onClick:n=>{n.stopPropagation(),q()},className:"p-2 text-gray-600 bg-gray-50 hover:text-gray-900",children:e.jsx("i",{className:"fas fa-chevron-left"})}),e.jsxs("div",{onClick:n=>n.stopPropagation(),className:"bg-white rounded-lg p-6 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-xl font-bold",children:["Tasks for ",p.toLocaleDateString()]}),e.jsx("button",{onClick:()=>{J(null),w(null),k(null),I(!1)},className:"text-gray-500 hover:text-gray-700",children:e.jsx("i",{className:"fas fa-times text-xl"})})]}),L.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("i",{className:"fas fa-calendar-times text-4xl mb-4"}),e.jsx("p",{className:"text-lg",children:"No tasks assigned for this date"})]}):oe&&L.length>1?e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-lg font-semibold mb-4",children:"Select a task to view details:"}),L.map((n,o)=>e.jsx("div",{className:"border rounded-lg p-4 cursor-pointer hover:bg-gray-50 transition-colors",onClick:()=>{k(n),I(!1)},children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-lg",children:n.workDescription}),e.jsxs("p",{className:"text-gray-600",children:["Room: ",n.room]}),e.jsxs("p",{className:"text-gray-600",children:["Time: ",n.startTime," - ",n.endTime]})]}),e.jsx("span",{className:`px-3 py-1 rounded text-sm ${$(n.status)}`,children:n.status})]})},o))]}):m?e.jsxs("div",{className:"space-y-6",children:[L.length>1&&e.jsxs("button",{onClick:()=>{I(!0),k(null)},className:"text-blue-600 hover:text-blue-800 mb-4",children:[e.jsx("i",{className:"fas fa-arrow-left mr-2"}),"Back to task list"]}),e.jsxs("div",{className:"border rounded-lg p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("h4",{className:"text-xl font-bold",children:m.workDescription}),e.jsx("span",{className:`px-3 py-1 rounded text-sm ${$(m.status)}`,children:m.status})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6 text-gray-700 mb-6",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"Room/Unit:"})," ",m.room]}),e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"Time:"})," ",m.startTime," - ",m.endTime]})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"Materials:"})," ",((le=m.materialsNeeded)==null?void 0:le.join(", "))||"None"]}),e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"Manpower:"})," ",m.manpower]})]})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h5",{className:"text-lg font-semibold",children:"Task Images"}),e.jsxs("label",{className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded cursor-pointer transition-colors",children:[Y.isPending&&e.jsx("span",{className:"animate-spin fas fa-spinner mr-1"}),e.jsx("i",{className:"fas fa-upload mr-2"}),"Upload Images",e.jsx("input",{type:"file",multiple:!0,accept:"image/*",className:"hidden",onChange:n=>{n.target.files&&_(Array.from(n.target.files),m)}})]})]}),m!=null&&m.uploadedImages&&(m==null?void 0:m.uploadedImages.length)>0?e.jsx("div",{className:"",children:(()=>{const n=((m==null?void 0:m.uploadedImages)||[]).reduce((d,u)=>{if(!Array.isArray(u==null?void 0:u.uploads)||u.uploads.length===0)return d;let f="Unknown Date";if(u!=null&&u.date){const j=new Date(u.date);f=isNaN(j.getTime())?String(u.date):j.toISOString().split("T")[0]}return d[f]||(d[f]=[]),d[f].push(...u.uploads),d},{}),o=Object.keys(n);return o.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500 bg-gray-50 rounded-lg",children:[e.jsx("i",{className:"fas fa-images text-3xl mb-2"}),e.jsx("p",{children:"No images uploaded for this task"})]}):o.map(d=>e.jsx("div",{className:"mb-4",children:e.jsx(ye,{imageFiles:n[d],handleDeleteFile:u=>he(u,m),refetch:W,height:120,minWidth:120,maxWidth:140})},d))})()}):e.jsxs("div",{className:"text-center py-8 text-gray-500 bg-gray-50 rounded-lg",children:[e.jsx("i",{className:"fas fa-images text-3xl mb-2"}),e.jsx("p",{children:"No images uploaded for this task"})]})]}),e.jsxs("div",{className:"mt-6 flex gap-3 pt-4 border-t",children:[e.jsxs("button",{onClick:()=>U(m),className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded transition-colors",children:[e.jsx("i",{className:"fas fa-trash mr-2"}),"Delete Task"]}),e.jsx(P,{onClick:()=>ue(m.scheduleId),children:"Edit Task"})]})]})]}):L.length===1?(k(L[0]),null):null]}),e.jsx("button",{onClick:n=>{n.stopPropagation(),c()},className:"p-2 text-gray-600  bg-gray-50 hover:text-gray-900",children:e.jsx("i",{className:"fas fa-chevron-right"})})]}),O&&e.jsx(Ds,{projectId:x,isOpen:O,onClose:()=>{C(!1),J(null)},onSave:()=>{C(!1)},refetch:W,scheduleId:b?m.scheduleId:null,editData:b,onUpdate:()=>{w(null),k(null),I(!1)}})]})})})};export{Zs as default};
