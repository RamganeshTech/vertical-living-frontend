import{u as Y,r as h,j as e}from"./index-DmIvND9E.js";import{I as q}from"./Input-DkyuoIiE.js";import{B}from"./Button-CcLxO5cH.js";import{t as b}from"./toast-BSC5QTk1.js";import{C as I}from"./constants-4IFJeChr.js";import{g as G,h as R}from"./materialArrivalNewApi-CN7CkTPa.js";import"./useQuery-BHdcKCtG.js";import"./useMutation-CAeBxy3I.js";import"./roleCheck-DZRqXPrB.js";const se=()=>{var _;const{projectId:j,token:O}=Y(),{data:c,isLoading:S,isError:E,refetch:Q}=G(j,O),{mutateAsync:F,isPending:N}=R(),[x,y]=h.useState({}),[o,v]=h.useState({}),[w,g]=h.useState(null),[M,k]=h.useState([]),U=t=>{k(a=>a.includes(t)?a.filter(r=>r!==t):[...a,t])};c&&M.length===0&&((_=c.materialArrivalList)==null?void 0:_.length)>0&&k(c.materialArrivalList.map(t=>t.orderMaterialDeptNumber));const L=(t,a)=>{const r=a===""?0:parseFloat(a);y(i=>({...i,[t]:r}))},V=(t,a)=>{v(r=>({...r,[t]:a}))},z=async(t,a)=>{var d,m;const r=x[a],i=o[a],s=new FormData;if(r!==void 0&&s.append("arrivedQuantity",String(r)),i&&s.append("upload",i),r===void 0&&!i){b({title:"No Changes",description:"Please enter a quantity or select an image.",variant:"destructive"});return}try{await F({projectId:j,orderNumber:t,subItemId:a,formData:s}),b({title:"Success",description:"Updated successfully"}),y(l=>{const n={...l};return delete n[a],n}),v(l=>{const n={...l};return delete n[a],n}),Q()}catch(l){b({title:"Error",description:((m=(d=l==null?void 0:l.response)==null?void 0:d.data)==null?void 0:m.message)||l.message||"Failed to update",variant:"destructive"})}},C=(c==null?void 0:c.materialArrivalList)||[],A=C.flatMap(t=>t.subItems),p=A.length,P=A.filter(t=>t.arrivedQuantity>0||t.images&&t.images.length>0).length,u=p>0?Math.round(P/p*100):0;return S?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:e.jsx("i",{className:"fas fa-circle-notch fa-spin text-4xl text-blue-600"})}):E?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-red-50 text-red-600",children:e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"fa-solid fa-triangle-exclamation text-4xl mb-4"}),e.jsx("h2",{className:"text-xl font-bold",children:"Unable to load portal"})]})}):e.jsxs("div",{className:"min-h-screen bg-slate-50 font-sans pb-32",children:[e.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200 sticky top-0 z-40",children:e.jsxs("div",{className:"w-full px-4 sm:px-6 py-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:I.COMPANY_LOGO,alt:"Logo",className:"w-10 h-10 rounded-full border border-gray-200 object-cover shadow-sm"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-bold text-gray-900 leading-tight",children:I.COMPANY_NAME}),e.jsx("p",{className:"text-xs text-gray-500 font-medium uppercase tracking-wide",children:"Material Arrival Portal"})]})]}),e.jsxs("div",{className:"hidden sm:flex items-center gap-2 px-3 py-1 bg-green-50 text-green-700 rounded-full text-xs font-bold border border-green-200",children:[e.jsx("i",{className:"fa-solid fa-check-circle"}),u,"% Complete"]})]})}),e.jsxs("div",{className:"w-full px-2 sm:px-6 py-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200 shadow-sm",children:[e.jsx("div",{className:"text-gray-500 text-xs uppercase font-bold",children:"Total Items"}),e.jsx("div",{className:"text-2xl font-bold text-gray-800",children:p})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200 shadow-sm",children:[e.jsx("div",{className:"text-gray-500 text-xs uppercase font-bold",children:"Updated"}),e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:P})]}),e.jsxs("div",{className:"col-span-2 bg-slate-800 p-4 rounded-lg shadow-sm text-white flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-400 text-xs uppercase font-bold",children:"Overall Progress"}),e.jsxs("div",{className:"text-xl font-bold",children:[u,"% Done"]})]}),e.jsx("div",{className:"w-12 h-12 rounded-full border-4 border-slate-600 flex items-center justify-center text-xs font-bold",children:u})]})]}),e.jsx("div",{className:"space-y-4",children:C.map(t=>{const a=M.includes(t.orderMaterialDeptNumber),r=t.subItems.length,i=t.subItems.filter(s=>s.isVerified).length;return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("div",{onClick:()=>U(t.orderMaterialDeptNumber),className:"bg-white hover:bg-gray-50 cursor-pointer px-4 py-4 flex items-center justify-between transition-colors border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center text-lg shadow-sm ${a?"bg-blue-600 text-white":"bg-gray-100 text-gray-500"}`,children:e.jsx("i",{className:"fa-solid fa-box-open"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-gray-800 text-base",children:["Order #",t.orderMaterialDeptNumber]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-500 mt-0.5",children:[e.jsxs("span",{children:[r," Items"]}),e.jsxs("span",{className:i===r?"text-green-600 font-bold":"text-orange-500",children:[i,"/",r," Verified"]})]})]})]}),e.jsx("i",{className:`fa-solid fa-chevron-down text-gray-400 transition-transform duration-300 ${a?"rotate-180":""}`})]}),a&&e.jsx("div",{className:"border-t border-gray-200 bg-gray-50/50",children:e.jsx("div",{className:"overflow-x-auto w-full",children:e.jsxs("table",{className:"w-full min-w-[1000px] text-left border-collapse",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-500 font-bold text-xs uppercase border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 w-[250px]",children:"Material Details"}),e.jsx("th",{className:"px-4 py-3 w-[100px] text-center",children:"Ordered"}),e.jsx("th",{className:"px-4 py-3 w-[80px] text-center",children:"Unit"}),e.jsx("th",{className:"px-4 py-3 w-[150px]",children:"Arrived Qty"}),e.jsx("th",{className:"px-4 py-3 w-[250px]",children:"Photo Evidence"}),e.jsx("th",{className:"px-4 py-3 w-[120px] text-center",children:"Action"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100 bg-white",children:t.subItems.map(s=>{var l,n;const d=((l=s.images)==null?void 0:l.length)>0?s.images[s.images.length-1].url:null,m=x[s._id]!==void 0||o[s._id]!==void 0;return e.jsxs("tr",{className:"hover:bg-blue-50/20 transition-colors",children:[e.jsxs("td",{className:"px-6 py-4 align-middle",children:[e.jsx("div",{className:"font-bold text-gray-800 text-sm",children:s.subItemName}),s.refId&&e.jsx("div",{className:"text-xs text-gray-400 font-mono mt-1",children:s.refId}),s.isVerified&&e.jsx("span",{className:"inline-block mt-1 px-2 py-0.5 bg-green-100 text-green-700 text-[10px] font-bold rounded border border-green-200",children:"VERIFIED"})]}),e.jsx("td",{className:"px-4 py-4 text-center align-middle",children:e.jsx("span",{className:"bg-gray-100 text-gray-700 px-3 py-1 rounded-full text-sm font-bold",children:s.orderedQuantity})}),e.jsx("td",{className:"px-4 py-4 text-center align-middle",children:e.jsx("span",{className:"text-xs font-bold text-gray-500 uppercase bg-gray-50 border border-gray-200 px-2 py-1 rounded",children:s.unit})}),e.jsx("td",{className:"px-4 py-4 align-middle",children:e.jsxs("div",{className:"relative",children:[e.jsx(q,{type:"number",min:"0",placeholder:String(s.arrivedQuantity||0),value:x[s._id]??s.arrivedQuantity??"",onChange:f=>L(s._id,f.target.value),className:"w-full font-bold text-center border-gray-300 focus:border-blue-500 focus:ring-blue-500"}),s.arrivedQuantity>0&&x[s._id]===void 0&&e.jsx("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 text-green-500 text-xs",children:e.jsx("i",{className:"fa-solid fa-check"})})]})}),e.jsx("td",{className:"px-4 py-4 align-middle",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"relative w-20 h-20 bg-gray-100 rounded-lg border border-gray-200 flex-shrink-0 overflow-hidden cursor-pointer hover:ring-2 hover:ring-blue-400 group",onClick:()=>d&&g(d),children:d?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:d,alt:"Proof",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-all flex items-center justify-center",children:e.jsx("i",{className:"fa-solid fa-magnifying-glass text-white opacity-0 group-hover:opacity-100"})})]}):e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center text-gray-400",children:[e.jsx("i",{className:"fa-regular fa-image text-xl"}),e.jsx("span",{className:"text-[10px] mt-1",children:"No Img"})]})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("label",{className:"cursor-pointer inline-flex items-center gap-2 px-3 py-2 bg-white border border-gray-300 rounded-lg text-xs font-bold text-gray-600 hover:bg-gray-50 hover:text-blue-600 transition-colors w-full justify-center",children:[e.jsx("i",{className:"fa-solid fa-cloud-arrow-up"}),o[s._id]?"Change File":"Upload",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:f=>{var D;return V(s._id,((D=f.target.files)==null?void 0:D[0])||null)}})]}),o[s._id]&&e.jsxs("div",{className:"text-[10px] text-green-600 mt-1 truncate max-w-[120px]",children:[e.jsx("i",{className:"fa-solid fa-check mr-1"}),(n=o[s._id])==null?void 0:n.name]})]})]})}),e.jsx("td",{className:"px-4 py-4 text-center align-middle",children:e.jsx(B,{size:"sm",variant:"primary",disabled:N||!m,onClick:()=>z(t.orderMaterialDeptNumber,s._id),className:"w-full text-xs font-bold shadow-sm",children:N?e.jsx("i",{className:"fas fa-spinner fa-spin"}):"Update"})})]},s._id)})})]})})})]},t.orderMaterialDeptNumber)})})]}),w&&e.jsx("div",{className:"fixed inset-0 bg-black/90 z-[9999] flex items-center justify-center p-4 backdrop-blur-sm",onClick:()=>g(null),children:e.jsxs("div",{className:"relative w-full max-w-4xl max-h-[90vh]",children:[e.jsx("button",{onClick:()=>g(null),className:"absolute -top-12 right-0 text-white hover:text-red-400 transition-colors p-2",children:e.jsx("i",{className:"fa-solid fa-xmark text-3xl"})}),e.jsx("img",{src:w,alt:"Proof Full View",className:"w-full h-full max-h-[85vh] object-contain rounded-lg shadow-2xl bg-black",onClick:t=>t.stopPropagation()})]})})]})};export{se as default};
