import{b as ee,u as se,r as u,j as e}from"./index-C1DtYOG4.js";import{C as U,a as A}from"./Card-CK78z7_O.js";import{I as d}from"./Input-CHqrZBuN.js";import{B as c}from"./Button-D6HVPia8.js";import{u as te,a as ae,b as le,c as ie,d as ne,e as re,f as ce}from"./procurementApi-cgYQg4fe.js";import de from"./MaterialOverviewLoading-B_RCn-RH.js";import{t as r}from"./toast-BSC5QTk1.js";import{d as oe}from"./downloadFile-CUpkasnf.js";import"./useQuery-DD9aZBjN.js";import"./useMutation-BgVKkKtF.js";import"./roleCheck-vyRiFK58.js";import"./Skeleton-CR6oVN79.js";const we=()=>{var v,y,w,P,C,D,S,k,L,E,I;const{id:o}=ee(),G=se(),{data:s,isLoading:T}=te(o),{mutateAsync:$}=ae(),{mutateAsync:z}=le(),{mutateAsync:R,isPending:_}=ie(),{mutateAsync:q,isPending:g}=ne(),{mutateAsync:B,isPending:M}=re(),{mutateAsync:K,isPending:O}=ce(),[Q,j]=u.useState(!1),[N,V]=u.useState((s==null?void 0:s.totalCost)||0),[Y,p]=u.useState(!1),[i,h]=u.useState({}),[H,f]=u.useState(!1),[n,m]=u.useState({}),J=async()=>{var t,l;try{if(i!=null&&i.phoneNumber&&!/^\d{10}$/.test(i==null?void 0:i.phoneNumber.trim()))throw new Error("Phone number should contain exactly 10 digit numbers");await z({id:o,payload:i}),p(!1),r({title:"Success",description:"Delivery Details Updated"})}catch(a){r({variant:"destructive",title:"Error",description:((l=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:l.message)||(a==null?void 0:a.message)||"Update failed"})}},W=async()=>{var t,l;try{if(n.phoneNumber&&!/^\d{10}$/.test(n.phoneNumber.trim()))throw new Error("Phone number should contain exactly 10 digit numbers");await $({id:o,payload:n}),r({title:"Success",description:"Shop Details Updated"}),f(!1)}catch(a){r({variant:"destructive",title:"Error",description:((l=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:l.message)||(a==null?void 0:a.message)||"Update failed"})}},b=async()=>{var t,l;try{await R({id:o,payload:{totalCost:N}}),j(!1),r({title:"Success",description:"Cost Updated Successfully"})}catch(a){r({variant:"destructive",title:"Error",description:((l=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:l.message)||(a==null?void 0:a.message)||"Update failed"})}},X=async()=>{var t,l;try{await q({id:o}),r({title:"Success",description:"Pdf Generated successfully"})}catch(a){r({title:"Error",description:((l=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:l.message)||(a==null?void 0:a.message)||"Failed to generate link",variant:"destructive"})}},Z=async t=>{var l,a;try{await B({id:o,pdfId:t}),r({title:"Success",description:"PDF deleted"})}catch(x){r({variant:"destructive",title:"Error",description:((a=(l=x==null?void 0:x.response)==null?void 0:l.data)==null?void 0:a.message)||(x==null?void 0:x.message)||"failed to delete"})}},F=async()=>{var t,l;try{await K({id:o}),r({title:"Success",description:"Details sent to Logistics Department"})}catch(a){r({variant:"destructive",title:"Error",description:((l=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:l.message)||(a==null?void 0:a.message)||"operation failed"})}};return T?e.jsx(de,{}):e.jsxs("div",{className:"p-1 max-w-full max-h-full overflow-y-auto space-y-8",children:[e.jsx("header",{className:"flex gap-2 items-center",children:e.jsxs("section",{className:"flex flex-1 justify-between items-center",children:[e.jsxs("div",{className:"flex gap-2 justify-between items-center",children:[e.jsx("div",{onClick:()=>G(-1),className:"bg-blue-50 hover:bg-slate-300 flex items-center justify-between w-8 h-8 border border-[#a6aab8] text-sm cursor-pointer rounded-md px-2 ",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsxs("h1",{className:"text-2xl sm:text-3xl font-bold text-blue-700",children:[e.jsx("span",{className:"text-black text-2xl",children:"Ref Id:"})," ",s!=null&&s.refPdfId?s==null?void 0:s.refPdfId.replace(/-pdf$/,""):"N/A"]})]}),e.jsx("div",{className:"flex gap-2 items-center ",children:e.jsxs("div",{className:"flex flex-col items-start space-y-1",children:[e.jsx(c,{variant:"primary",isLoading:O,onClick:F,children:"Send To Logistics Dept"}),e.jsxs("span",{className:"text-xs text-blue-500 mx-auto",children:[e.jsx("strong",{children:"*"})," Click the button to send the ",e.jsx("br",{})," details to  logistics dept"]})]})})]})}),e.jsxs("div",{className:"border-l-4 border-blue-600 rounded-lg p-4 shadow-sm relative bg-white",children:[e.jsxs("h2",{className:"text-base sm:text-lg font-bold mb-3 text-blue-700 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-store"}),"Shop Details"]}),H?e.jsxs("div",{className:"space-y-3",children:[e.jsx(d,{placeholder:"Shop Name",value:(n==null?void 0:n.shopName)||"",onChange:t=>m({...n,shopName:t.target.value}),className:"w-full"}),e.jsx(d,{placeholder:"Contact Person",value:(n==null?void 0:n.contactPerson)||"",onChange:t=>m({...n,contactPerson:t.target.value}),className:"w-full"}),e.jsx(d,{placeholder:"Phone Number",value:(n==null?void 0:n.phoneNumber)||"",type:"tel",maxLength:10,onChange:t=>{const l=t.target.value;/^\d*$/.test(l)&&m({...n,phoneNumber:l})},className:"w-full"}),e.jsx(d,{placeholder:"upi Id",value:(n==null?void 0:n.upiId)||"",onChange:t=>m({...n,upiId:t.target.value}),className:"w-full"}),e.jsx(d,{placeholder:"Address",value:(n==null?void 0:n.address)||"",onChange:t=>m({...n,address:t.target.value}),className:"w-full"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mt-3  justify-end ",children:[e.jsxs(c,{onClick:W,className:"w-full sm:w-auto",children:[e.jsx("i",{className:"fa-solid fa-save mr-2"}),"Save"]}),e.jsxs(c,{variant:"outline",onClick:()=>f(!1),className:"w-full sm:w-auto",children:[e.jsx("i",{className:"fa-solid fa-times mr-2"}),"Cancel"]})]})]}):e.jsxs("div",{className:"space-y-2 text-sm sm:text-base",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Shop Name:"})," ",((v=s==null?void 0:s.shopDetails)==null?void 0:v.shopName)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Contact Person:"})," ",((y=s==null?void 0:s.shopDetails)==null?void 0:y.contactPerson)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Phone:"})," ",((w=s==null?void 0:s.shopDetails)==null?void 0:w.phoneNumber)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Upi Id:"})," ",((P=s==null?void 0:s.shopDetails)==null?void 0:P.upiId)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Address:"})," ",((C=s==null?void 0:s.shopDetails)==null?void 0:C.address)||"-"]}),e.jsxs("button",{onClick:()=>{m(s==null?void 0:s.shopDetails),f(!0)},className:"absolute top-3 right-4 text-blue-600 text-xs sm:text-sm underline hover:text-blue-800",children:[e.jsx("i",{className:"fa-solid fa-edit mr-1"}),"Edit"]})]})]}),e.jsxs("div",{className:"border-l-4 mt-4 border-blue-600 rounded-lg p-4 shadow-sm relative bg-white",children:[e.jsxs("h2",{className:"text-base sm:text-lg font-bold mb-3 text-blue-700 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-truck"}),"Delivery Location"]}),Y?e.jsxs("div",{className:"space-y-3",children:[e.jsx(d,{placeholder:"Site Name",value:(i==null?void 0:i.siteName)||"",onChange:t=>h({...i,siteName:t.target.value}),className:"w-full"}),e.jsx(d,{placeholder:"Site Supervisor",value:(i==null?void 0:i.siteSupervisor)||"",onChange:t=>h({...i,siteSupervisor:t.target.value}),className:"w-full"}),e.jsx(d,{placeholder:"Phone Number",type:"tel",maxLength:10,value:(i==null?void 0:i.phoneNumber)||"",onChange:t=>{const l=t.target.value;/^\d*$/.test(l)&&h({...i,phoneNumber:l})},className:"w-full"}),e.jsx(d,{placeholder:"Address",value:(i==null?void 0:i.address)||"",onChange:t=>h({...i,address:t.target.value}),className:"w-full"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mt-3 justify-end ",children:[e.jsxs(c,{onClick:J,className:"w-full sm:w-auto",children:[e.jsx("i",{className:"fa-solid fa-save mr-2"}),"Save"]}),e.jsxs(c,{variant:"outline",onClick:()=>p(!1),className:"w-full sm:w-auto",children:[e.jsx("i",{className:"fa-solid fa-times mr-2"}),"Cancel"]})]})]}):e.jsxs("div",{className:"space-y-2 text-sm sm:text-base",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Site Name:"})," ",((D=s==null?void 0:s.deliveryLocationDetails)==null?void 0:D.siteName)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Supervisor:"})," ",((S=s==null?void 0:s.deliveryLocationDetails)==null?void 0:S.siteSupervisor)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Phone:"})," ",((k=s==null?void 0:s.deliveryLocationDetails)==null?void 0:k.phoneNumber)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Address:"})," ",((L=s==null?void 0:s.deliveryLocationDetails)==null?void 0:L.address)||"-"]}),e.jsxs("button",{onClick:()=>{h(s==null?void 0:s.deliveryLocationDetails),p(!0)},className:"absolute top-3 right-4 text-blue-600 text-xs sm:text-sm underline hover:text-blue-800",children:[e.jsx("i",{className:"fa-solid fa-edit mr-1"}),"Edit"]})]})]}),e.jsx(U,{children:e.jsx(A,{className:"py-6 space-y-5",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center",children:[e.jsx("h3",{className:"text-lg font-bold text-indigo-700 mb-2 sm:mb-0",children:"Items List ðŸ“‹"}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2",children:[e.jsx("h3",{className:"text-lg font-bold text-blue-700",children:"Total Cost "}),e.jsx("div",{className:"flex items-center gap-3 text-sm",children:Q?e.jsxs(e.Fragment,{children:[e.jsx(d,{type:"number",className:"w-32",value:N,onChange:t=>V(Number(t.target.value)),onKeyDown:t=>{t.key==="Enter"&&b()}}),e.jsx(c,{size:"sm",isLoading:_,onClick:b,children:"Save"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-base font-semibold text-gray-800",children:["â‚¹ ",s.totalCost]}),e.jsxs(c,{size:"sm",variant:"secondary",onClick:()=>j(!0),children:[e.jsx("i",{className:"fas fa-pen mr-1"}),"Edit"]})]})})]})]}),e.jsx("div",{className:"overflow-x-auto rounded border border-gray-200",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-100",children:[e.jsx("thead",{className:"bg-gray-50 text-sm text-gray-700 font-medium",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-5 py-2 text-left",children:"Item Name"}),e.jsx("th",{className:"px-5 py-2 text-left",children:"Quantity"}),e.jsx("th",{className:"px-5 py-2 text-left",children:"Unit"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-100 text-sm",children:s.selectedUnits.map((t,l)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-5 py-2",children:t.subItemName}),e.jsx("td",{className:"px-5 py-2",children:t.quantity}),e.jsx("td",{className:"px-5 py-2",children:t.unit})]},l))})]})})]})})}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"Export Procurement Material"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Generate a PDF document of your Procurements"})]}),e.jsx(c,{onClick:X,disabled:g,className:"min-w-[140px] bg-blue-600 hover:bg-blue-700 text-white font-medium",size:"lg",children:g?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-file-pdf"}),"Generate PDF"]})})]}),s!=null&&s.procurementPdfs&&((E=s==null?void 0:s.procurementPdfs)==null?void 0:E.length)>0?(I=s==null?void 0:s.procurementPdfs)==null?void 0:I.map(t=>e.jsx(U,{className:"border-green-200 bg-green-50 ",children:e.jsx(A,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx("i",{className:"fas fa-check-circle text-green-600"})}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-green-900 mb-1",children:[e.jsx("span",{className:"text-sm text-black",children:"Pdf Reference Id: "}),t.refUniquePdf||"N/A"]}),e.jsx("p",{className:"text-sm text-green-700",children:"Your Procurement PDF is ready to view or download"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full sm:w-auto ",children:[e.jsxs(c,{variant:"outline",onClick:()=>window.open(t.url,"_blank"),className:"border-green-300 text-blue-700 hover:bg-blue-100 hover:border-blue-400",children:[e.jsx("i",{className:"fas mr-2 fa-external-link-alt"}),"View in New Tab"]}),e.jsx(c,{variant:"secondary",onClick:()=>oe({src:t.url,alt:"Procurement"}),className:"border-blue-300 text-blue-700 hover:bg-blue-100 hover:border-blue-400",children:"Download PDF"}),e.jsx(c,{variant:"danger",isLoading:M,onClick:()=>Z(t._id),className:"border-red-300 bg-red-600 text-white hover:bg-red-600 hover:border-red-400",children:"Delete PDF"})]})]})})},t._id)):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col items-center  justify-center min-h-[300px] w-full bg-white rounded-xl text-center p-6",children:[e.jsx("i",{className:"fa-solid fa-file-lines text-5xl text-blue-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-1",children:"No Pdf Found"}),e.jsx("p",{className:"text-sm text-gray-500",children:"No PDF Generated"})]})})]})})]})};export{we as default};
