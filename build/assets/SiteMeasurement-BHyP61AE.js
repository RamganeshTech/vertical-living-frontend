import{u as k,r as N,j as e,N as ee,B as S,d as B,t as o,I as se,af as te,o as ae}from"./index-HgTal7lb.js";import{a as le,b as re,c as ne,u as ie,d as de,e as oe,f as ce,g as me,h as ue,i as xe,j as ge,k as he,l as pe,m as be}from"./siteMeasurementApi-BuSYcQoC.js";import{C as W}from"./Card-oYkyngJG.js";import{A as fe,S as je}from"./AssignStaff-DpB3_tsB.js";import{R as Ne}from"./StageFileUploader-CSFucVt-.js";import{R as ye}from"./ResetStageButton-DQu_pb7e.js";import ve from"./MaterialOverviewLoading-BX2Vg6-v.js";import{S as we}from"./ShareDocumentWhatsapp-fpbkzAJi.js";import"./getAllUsersApi-Bgkugotr.js";import"./Skeleton-Cqfsq_v2.js";import"./documentationApi-Cb8lX8d6.js";const Se=({file:s,setPreviewImage:c,room:d})=>{const{projectId:b}=k(),[f,a]=N.useState(!1),[m,l]=N.useState((s==null?void 0:s.categoryName)||""),{mutateAsync:j,isPending:C}=le(),{mutateAsync:p,isPending:y}=re(),g=async t=>{var n,u;try{await j({roomId:d._id,uploadId:t,projectId:b}),o({title:"Success",description:"Image deleted successfully"})}catch(x){o({title:"Error",description:((u=(n=x==null?void 0:x.response)==null?void 0:n.data)==null?void 0:u.message)||"Failed to delete",variant:"destructive"})}},v=async()=>{var t,n;if(!m||m===s.categoryName){a(!1);return}try{await p({uploadId:s._id,categoryName:m,roomId:d._id,projectId:b}),o({title:"Updated",description:"Image name updated successfully"})}catch(u){o({title:"Error",description:((n=(t=u==null?void 0:u.response)==null?void 0:t.data)==null?void 0:n.message)||"Failed to update name",variant:"destructive"})}finally{a(!1)}};return e.jsxs("div",{className:"group bg-white transition-all duration-300 hover:z-10",children:[e.jsxs("div",{className:"relative w-full overflow-hidden border-4 border-white  transition-all duration-300 cursor-pointer",onClick:()=>c(s==null?void 0:s.url),children:[e.jsx("div",{className:"aspect-square w-full",children:e.jsx("img",{src:s.url||ee,alt:s.originalName,className:"w-full h-full transition-transform duration-300 "})}),e.jsx("div",{className:"absolute inset-0 bg-opacity-0 group-hover:bg-opacity-40 transition-all duration-300 items-center justify-center hidden md:flex",children:e.jsx("div",{className:"flex space-x-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300 transform translate-y-4 group-hover:translate-y-0",children:["eye","trash","download"].map(t=>e.jsx(S,{variant:"secondary",size:"sm",onClick:n=>{n.stopPropagation(),t==="eye"?c(s==null?void 0:s.url):t==="trash"?g(s._id):B({src:s==null?void 0:s.url,alt:(s==null?void 0:s.originalName)||"image"})},disabled:t==="trash"&&C,className:`rounded-full bg-white hover:bg-gray-100 shadow-lg transition-all duration-200 ${t==="trash"?"hover:bg-red-50":""}`,children:e.jsx("i",{className:`w-3 h-3 fas fa-${t} ${t==="trash"?"text-red-500":t==="download"?"text-blue-500":"text-gray-600"}`})},t))})}),e.jsx("div",{className:"absolute top-2 right-[2px] flex flex-col space-y-1 sm:hidden",children:["eye","trash","download"].map(t=>e.jsx(S,{variant:"secondary",size:"sm",onClick:n=>{n.stopPropagation(),t==="eye"?c(s==null?void 0:s.url):t==="trash"?g(s._id):B({src:s==null?void 0:s.url,alt:(s==null?void 0:s.originalName)||"image"})},disabled:t==="trash"&&C,className:`w-6 h-6 p-0 rounded-full bg-white/90 backdrop-blur-sm border shadow-sm transition-all duration-200 ${t==="trash"?"border-red-200 hover:border-red-300 hover:bg-red-50":t==="download"?"border-blue-200 hover:border-blue-300 hover:bg-blue-50":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,children:e.jsx("i",{className:`w-3 h-3 fas fa-${t} ${t==="trash"?"text-red-500":t==="download"?"text-blue-500":"text-gray-600"}`})},t))})]}),e.jsx("div",{onClick:t=>t.stopPropagation(),className:"my-1 flex items-center justify-between px-1",children:f?e.jsxs("div",{className:"flex w-full items-center space-x-1",children:[e.jsx("input",{value:m,onChange:t=>l(t.target.value),className:"text-sm border px-1 py-0.5 rounded w-full",onKeyDown:t=>{t.key==="Enter"&&v()}}),e.jsx("button",{onClick:v,disabled:y,className:"text-blue-600 cursor-pointer hover:text-blue-800 text-xs",children:y?e.jsx("i",{className:"fa fa-spinner animate-spin"}):e.jsx("i",{className:"fas fa-check"})}),e.jsx("button",{onClick:()=>{a(!1),l(s.categoryName||"")},className:"text-red-500 cursor-pointer hover:text-red-700 text-xs",children:e.jsx("i",{className:"fas fa-times"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-sm text-gray-800 truncate max-w-[80%]",children:(s==null?void 0:s.categoryName)||"No category"}),e.jsx("button",{className:"text-gray-500 cursor-pointer hover:text-blue-600 text-xs",onClick:()=>a(!0),children:e.jsx("i",{className:"fas fa-pen"})})]})})]},s._id)},Ce=({room:s,onEdit:c,onDelete:d,deleteRoomLoading:b})=>{const{projectId:f}=k(),[a,m]=N.useState(null),l=(s==null?void 0:s.uploads)||[],j=s.length&&s.breadth?(s.length*s.breadth).toFixed(2):null,{mutateAsync:C,isPending:p}=ne(),y=async g=>{var v,t;try{const n=g.target.files;if(!n||n.length===0)return;const u=Array.from(n).filter(F=>F.type.startsWith("image/"));if(u.length===0){o({title:"Error",description:"Please select only image files",variant:"destructive"});return}u.length!==n.length&&o({title:"Warning",description:"Only image files were uploaded. PDFs were skipped.",variant:"destructive"});const x=new FormData;u.forEach(F=>x.append("file",F)),await C({roomId:s._id,files:x,projectId:f}),o({title:"Success",description:"Images uploaded successfully"}),g.target.value=""}catch(n){o({title:"Error",description:((t=(v=n==null?void 0:n.response)==null?void 0:v.data)==null?void 0:t.message)||"Failed to upload",variant:"destructive"})}};return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-2 sm:p-6 mb-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold text-blue-700",children:s.name}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>c(s),className:"text-blue-600 hover:text-blue-800",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx(S,{isLoading:b,onClick:d,variant:"ghost",className:"!text-red-600 hover:text-red-800 bg-white shadow-none hover:!bg-none",children:e.jsx("i",{className:"fas fa-trash-can"})})]})]}),e.jsxs("div",{className:"space-y-4 w-full",children:[e.jsxs("div",{className:"flex items-center justify-between w-full relative",children:[e.jsx(se,{type:"file",multiple:!0,accept:"image/*",placeholder:"Select images",onChange:y,disabled:p,className:p?"pr-10 opacity-70 cursor-not-allowed w-full":""}),p&&e.jsx("div",{className:"absolute inset-y-0 right-2 flex items-center",children:e.jsxs("svg",{className:"animate-spin h-5 w-5 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4l3.5-3.5L12 0v4a8 8 0 100 16v4l3.5-3.5L12 20v-4a8 8 0 01-8-8z"})]})})]}),e.jsxs("div",{className:"my-6",children:[e.jsx("h4",{className:"text-lg font-semibold mb-4 text-gray-800",children:"Room Images"}),l.length===0?e.jsx("div",{className:"text-gray-500 text-sm italic bg-gray-50 p-8 rounded-lg text-center border-2 border-dashed border-gray-200",children:"No images uploaded yet."}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 p-4 bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl",children:l.map(g=>e.jsx(Se,{room:s,setPreviewImage:m,file:g}))})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Length"}),e.jsxs("p",{className:"font-semibold text-gray-800",children:[s.length||0," ft"]})]}),e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Breadth"}),e.jsxs("p",{className:"font-semibold text-gray-800",children:[s.breadth||0," ft"]})]}),e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Height"}),e.jsxs("p",{className:"font-semibold text-gray-800",children:[s.height||0," ft"]})]})]}),j&&e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:e.jsxs("p",{className:"text-blue-700 font-medium text-center",children:["Total Area: ",j," sq.ft"]})}),a&&e.jsx("div",{onClick:()=>m(null),className:"fixed inset-0 z-50 flex items-center justify-center bg-opacity-80 backdrop-blur-sm",children:e.jsxs("div",{onClick:g=>g.stopPropagation(),className:"relative bg-white rounded-xl shadow-2xl max-w-[90%] max-h-[90%] p-2 overflow-hidden",children:[e.jsx("button",{onClick:()=>m(null),className:"absolute top-4 right-4 z-10 w-8 h-8 bg-opacity-50 hover:bg-opacity-70 text-white rounded-full flex items-center justify-center transition-all duration-200",children:e.jsx("i",{className:"fas fa-times text-sm"})}),e.jsx("img",{src:a||"/placeholder.svg",alt:"Preview",className:"w-full max-h-[80vh] object-contain mx-auto rounded-lg"})]})})]})},Fe=({measurementData:s,handleDeleteSiteMeasurement:c,deleteRoomLoading:d,setShowSiteForm:b,setShowRoomForm:f,handleEditRoom:a,handleDeleteRoom:m})=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Site Measurements"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>b(!0),className:"px-2 sm:px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Edit"}),e.jsx("button",{onClick:()=>c(),className:"px-2 sm:px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"Delete"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total Plot Area"}),e.jsx("p",{className:"text-lg font-semibold text-blue-700",children:s.siteDetails.totalPlotAreaSqFt!==null?`${s.siteDetails.totalPlotAreaSqFt} sq.ft`:"Not mentioned"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Built-up Area"}),e.jsx("p",{className:"text-lg font-semibold text-blue-700",children:s.siteDetails.builtUpAreaSqFt!=null?`${s.siteDetails.builtUpAreaSqFt} sq.ft`:"Not mentioned"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Road Facing"}),e.jsx("p",{className:"text-lg font-semibold text-blue-700",children:s.siteDetails.roadFacing===!0?"YES":s.siteDetails.roadFacing===!1?"NO":"Not mentioned"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Number of Floors"}),e.jsx("p",{className:"text-lg font-semibold text-blue-700",children:s.siteDetails.numberOfFloors!=null?s.siteDetails.numberOfFloors:"Not mentioned"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Is having Slope"}),e.jsx("p",{className:"text-lg font-semibold text-blue-700",children:s.siteDetails.hasSlope===!0?"YES":s.siteDetails.hasSlope===!1?"NO":"Not mentioned"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Is Boundary Wall exists"}),e.jsx("p",{className:"text-lg font-semibold text-blue-700",children:s.siteDetails.boundaryWallExists===!0?"YES":s.siteDetails.boundaryWallExists===!1?"NO":"Not mentioned"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Additional Notes"}),e.jsx("p",{className:"text-lg font-semibold text-blue-700",children:s.siteDetails.additionalNotes?s.siteDetails.additionalNotes:"Not mentioned"})]})]})]}),s.siteDetails.totalPlotAreaSqFt!==null&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Rooms"}),e.jsx("button",{onClick:()=>f(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"+ Add Room"})]}),s.rooms.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})})}),e.jsx("p",{className:"text-gray-500",children:"No rooms added yet"})]}):e.jsx("div",{className:"mt-4 grid grid-cols-1 gap-6",children:s.rooms.map((l,j)=>e.jsx(Ce,{room:l,onEdit:()=>a(l),onDelete:()=>m(l._id),deleteRoomLoading:d},j))})]})]}),ke=N.memo(Fe),Ae=({roomDetails:s,setRoomDetails:c,handleRoomSubmit:d,setShowRoomForm:b,updateRoomLoading:f,createRoomLoading:a,editingRoomId:m})=>e.jsx("div",{className:"fixed inset-0 bg-black/70 bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-md p-6",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-6",children:m?"Edit Room":"Add New Room"}),e.jsxs("select",{value:s.name||"",onChange:l=>c(j=>({...j,name:l.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent mb-4",children:[e.jsx("option",{value:"",children:"Select Room Type"}),te.map(l=>e.jsx("option",{value:l,children:l}))]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"",children:"Length (ft)"}),e.jsx("input",{type:"number",placeholder:"Length (ft)",value:s.length||0,onChange:l=>c({...s,length:Number(l.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"",children:"Breadth (ft)"}),e.jsx("input",{type:"number",placeholder:"Breadth (ft)",value:s.breadth||0,onChange:l=>c({...s,breadth:Number(l.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"",children:"Height (ft)"}),e.jsx("input",{type:"number",placeholder:"Height (ft)",value:s.height||0,onChange:l=>c({...s,height:Number(l.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),s.length&&s.breadth&&e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg mb-4",children:e.jsxs("p",{className:"text-blue-700 font-medium",children:["Calculated Area: ",(Number(s.length)*Number(s.breadth)).toFixed(2)," sq.ft"]})}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{onClick:()=>b(!1),className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsx(S,{isLoading:m?f:a,onClick:d,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:m?"Edit Room":"Add Room"})]})]})}),Re=({siteDetails:s,updatePending:c,setSiteDetails:d,handleSiteSubmit:b,setShowSiteForm:f})=>e.jsx("div",{className:"fixed inset-0 bg-black/70 bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-2xl p-6",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-6",children:"Site Measurements"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"",children:"Total Plot Area (sq.ft)"}),e.jsx("input",{type:"number",placeholder:"Total Plot Area (sq.ft)",value:s.totalPlotAreaSqFt||0,onChange:a=>d({...s,totalPlotAreaSqFt:Number(a.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"",children:"Built-up Area (sq.ft)"}),e.jsx("input",{type:"number",placeholder:"Built-up Area (sq.ft)",value:s.builtUpAreaSqFt||0,onChange:a=>d({...s,builtUpAreaSqFt:Number(a.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"",children:"Number of Floors"}),e.jsx("input",{type:"number",placeholder:"Number of Floors",value:s.numberOfFloors||0,onChange:a=>d({...s,numberOfFloors:Number(a.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 mb-4",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:s.hasSlope??!1,onChange:a=>d({...s,hasSlope:a.target.checked}),className:"mr-2"}),"Has Slope"]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:s.roadFacing??!1,onChange:a=>d({...s,roadFacing:a.target.checked}),className:"mr-2"}),"Road Facing"]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:s.boundaryWallExists??!1,onChange:a=>d({...s,boundaryWallExists:a.target.checked}),className:"mr-2"}),"Boundary Wall Exists"]})]}),e.jsx("textarea",{placeholder:"Additional Notes",value:s.additionalNotes||"",onChange:a=>d({...s,additionalNotes:a.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent mb-4",rows:4}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(S,{variant:"secondary",onClick:()=>f(!1),className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsx(S,{variant:"primary",onClick:b,isLoading:c,children:"Save Details"})]})]})}),Pe=N.memo(Re),Ee={totalPlotAreaSqFt:null,builtUpAreaSqFt:null,roadFacing:null,numberOfFloors:null,hasSlope:!1,boundaryWallExists:!1,additionalNotes:null},_={name:null,length:null,breadth:null,height:null,uploads:[]};function $e(){var I,L,q,U,O;const{projectId:s,organizationId:c}=k(),{isMobile:d,openMobileSidebar:b}=ae();if(!s)return;const[f,a]=N.useState(!1),[m,l]=N.useState(!1),[j,C]=N.useState(Ee),[p,y]=N.useState(_),[g,v]=N.useState(null);let{data:t,isLoading:n,refetch:u,error:x}=ie({projectId:s});const F=de(),A=oe(),R=ce(),P=me(),E=ue(),z=xe(),M=ge(),{mutateAsync:T,isPending:$}=he(),{mutateAsync:H,isPending:Y}=pe(),{mutateAsync:G,isPending:K}=be(),V=async()=>{var i,h;try{Object.values(t.siteDetails).some(w=>typeof w=="number")?await R.mutateAsync({projectId:s,payload:j}):await F.mutateAsync({projectId:s,siteDetails:j}),a(!1),o({description:"Site details updated successfully",title:"Success"})}catch(r){o({title:"Error",description:((h=(i=r==null?void 0:r.response)==null?void 0:i.data)==null?void 0:h.message)||r.message||"Failed to save site details",variant:"destructive"})}},J=async()=>{var i,h;try{if(!p.name)throw new Error("please select the name");const r=p.length&&p.breadth?(Number(p.length)*Number(p.breadth)).toFixed(2):null,w={...p,area:r};g?await P.mutateAsync({projectId:s,roomId:g,room:w}):await A.mutateAsync({projectId:s,room:w}),l(!1),v(null),y(_),o({description:g?"Room updated":"Room added",title:"Success"})}catch(r){o({title:"Error",description:((h=(i=r==null?void 0:r.response)==null?void 0:i.data)==null?void 0:h.message)||(r==null?void 0:r.message)||"Operation failed",variant:"destructive"})}},Q=async i=>{var h,r;try{await E.mutateAsync({projectId:s,roomId:i}),o({description:"Room deleted",title:"Success"})}catch(w){o({title:"Error",description:((r=(h=w==null?void 0:w.response)==null?void 0:h.data)==null?void 0:r.message)||"Delete failed",variant:"destructive"})}},X=async()=>{var i,h;try{await z.mutateAsync({projectId:s}),o({description:"Site measurement deleted",title:"Success"})}catch(r){o({title:"Error",description:((h=(i=r==null?void 0:r.response)==null?void 0:i.data)==null?void 0:h.message)||"Delete failed",variant:"destructive"})}},Z=async()=>{var i,h;try{await M.mutateAsync({projectId:s}),o({description:"Completion updated",title:"Success"})}catch(r){o({title:"Error",description:((h=(i=r==null?void 0:r.response)==null?void 0:i.data)==null?void 0:h.message)||"Update failed",variant:"destructive"})}},D=i=>{y(i),v(i==null?void 0:i._id),l(!0)};return n?e.jsx(ve,{}):e.jsxs("div",{className:"container mx-auto px-2 py-2 max-w-full h-full w-full overflow-y-auto custom-scrollbar",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center mb-6 gap-4",children:[e.jsxs("div",{className:"w-full sm:w-auto",children:[e.jsxs("h2",{className:"text-2xl sm:text-3xl font-semibold text-blue-600 flex items-center",children:[d&&e.jsx("button",{onClick:b,className:"mr-3 p-2 rounded-md border border-gray-300 hover:bg-gray-100",title:"Open Menu",children:e.jsx("i",{className:"fa-solid fa-bars"})}),e.jsx("i",{className:"fa-solid fa-receipt mr-2"})," Site Measurement"]}),e.jsx("p",{className:"text-gray-600 hidden sm:block text-sm sm:text-base",children:"Plan your dream home"})]}),e.jsxs("div",{className:"flex flex-wrap sm:flex-nowrap items-center gap-2  !w-[100%] sm:!w-[50%] lg:!w-[60%] justify-start lg:justify-end",children:[e.jsxs(S,{isLoading:M.isPending,onClick:Z,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2  w-full sm:w-auto",children:[e.jsx("i",{className:"fa-solid fa-circle-check mr-2"})," Mark Complete"]}),e.jsx(ye,{projectId:s,stageNumber:2,stagePath:"sitemeasurement",className:"sm:!max-w-[20%] w-full"}),!x&&e.jsx(we,{projectId:s,stageNumber:"2",className:"w-full sm:w-fit",isStageCompleted:t==null?void 0:t.status}),e.jsx(fe,{stageName:"SiteMeasurementModel",projectId:s,organizationId:c,currentAssignedStaff:(t==null?void 0:t.assignedTo)||null,className:"w-full sm:w-auto"})]})]}),x&&e.jsxs("div",{className:"max-w-xl mx-auto mt-4 p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2",children:"⚠️ Error Occurred"}),e.jsx("p",{className:"text-red-500 text-sm mb-4",children:((L=(I=x==null?void 0:x.response)==null?void 0:I.data)==null?void 0:L.message)||"Failed to load data"}),e.jsx(S,{onClick:()=>u(),className:"bg-red-600 text-white px-4 py-2",children:"Retry"})]}),!x&&e.jsxs(W,{className:"p-4 mb-4 shadow border-l-4 border-blue-600 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-3 text-blue-700 text-sm font-medium mb-2",children:[e.jsx("i",{className:"fa-solid fa-clock text-blue-500 text-lg"}),e.jsx("span",{children:"Stage Timings"})]}),e.jsx(je,{completedAt:(q=t==null?void 0:t.timer)==null?void 0:q.compltedAt,stageName:"sitemeasurement",formId:t==null?void 0:t._id,projectId:s,deadLine:(U=t==null?void 0:t.timer)==null?void 0:U.deadLine,startedAt:(O=t==null?void 0:t.timer)==null?void 0:O.startedAt,refetchStageMutate:u,deadLineMutate:T,isPending:$})]}),!x&&e.jsx("div",{className:"mb-6",children:e.jsx(W,{className:"p-4 shadow border-l-4 border-blue-500 bg-white",children:e.jsx(Ne,{autoUpload:!0,formId:t==null?void 0:t._id,refetch:u,existingUploads:t==null?void 0:t.uploads,onUploadComplete:u,uploadFilesMutate:H,uploadPending:Y,projectId:s,onDeleteUpload:G,deleteFilePending:K})})}),!x&&e.jsxs(e.Fragment,{children:[!Object.values((t==null?void 0:t.siteDetails)||{}).some(i=>i!==null)&&!f?e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})})}),e.jsx("p",{className:"text-gray-600 mb-4",children:"No Site Details Added"}),e.jsx("button",{onClick:()=>a(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"Add Site Details"})]}):e.jsx(ke,{measurementData:t,handleDeleteSiteMeasurement:X,setShowSiteForm:a,setShowRoomForm:l,handleEditRoom:D,handleDeleteRoom:Q,deleteRoomLoading:E.isPending}),f&&e.jsx(Pe,{siteDetails:j,setSiteDetails:C,handleSiteSubmit:V,setShowSiteForm:a,updatePending:R.isPending}),m&&e.jsx(Ae,{handleRoomSubmit:J,setShowRoomForm:l,roomDetails:p,setRoomDetails:y,updateRoomLoading:P.isPending,createRoomLoading:A.isPending,editingRoomId:g})]})]})}export{$e as default};
