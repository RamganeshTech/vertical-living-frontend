import{u as $,a as I,k as O,j as e,M as q,B as i,t as l}from"./index-BAM0eJUz.js";import{u as G,c as B,d as E}from"./paymentConfirmationApi-RkAMprW0.js";import{d as U}from"./dateFormator-BGKi5rfZ.js";const W=()=>{var y,v,w,C;const{projectId:o,organizationId:k}=$(),F=I(),{data:h,isLoading:L,isError:S,refetch:m,error:n}=G(o),g=B(),p=E(),{role:b,permission:r}=O(),u=b==="owner"||((y=r==null?void 0:r.paymentconfirmation)==null?void 0:y.create),j=b==="owner"||((v=r==null?void 0:r.paymentconfirmation)==null?void 0:v.edit),M=a=>{navigator.clipboard.writeText(a),l({title:"Copied",description:"Link copied to clipboard."})},R=a=>{const t=`Please review and approve the payment consent:

${a}`,s=encodeURIComponent(t);window.open(`https://wa.me/?text=${s}`,"_blank")},A=async()=>{var a,t;try{await g.mutateAsync({projectId:o}),l({title:"Success",description:"Consent requirement updated."}),m()}catch(s){l({title:"Error",description:((t=(a=s==null?void 0:s.response)==null?void 0:a.data)==null?void 0:t.message)||s.message,variant:"destructive"})}},P=async()=>{var a,t;try{await p.mutateAsync({projectId:o}),l({title:"Success",description:"Consent link generated."}),m()}catch(s){l({title:"Error",description:((t=(a=s==null?void 0:s.response)==null?void 0:a.data)==null?void 0:t.message)||s.message,variant:"destructive"})}};if(L)return e.jsx(q,{});if(S||!h)return e.jsxs("div",{className:"max-w-xl mx-auto p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center mb-6",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2",children:"⚠️ Error Occurred"}),e.jsx("p",{className:"text-red-500 text-sm mb-4",children:((C=(w=n==null?void 0:n.response)==null?void 0:w.data)==null?void 0:C.message)||(n==null?void 0:n.message)||"Failed to load cost estimation data"}),e.jsx(i,{onClick:()=>m(),className:"bg-red-600 text-white px-4 py-2",children:"Retry"})]});const{isConsentRequired:x,paymentClientConsent:{content:T,agreedAt:d,isAgreed:f,agreementToken:N,link:c}}=h;return e.jsxs("div",{className:"space-y-6 w-full max-w-full max-h-full sm:overflow-y-auto mx-auto custom-scrollbar",children:[e.jsxs("div",{className:"flex justify-between items-center border-b pb-3",children:[e.jsxs("h2",{className:"text-lg sm:text-2xl  lg:text-3xl font-bold text-blue-700 flex items-center",children:[e.jsx("i",{className:"hidden sm:block fa-solid fa-handshake-angle mr-[3px] sm:mr-2"})," Client Consent"]}),e.jsxs("div",{className:"space-x-1",children:[(u||j)&&e.jsx(i,{isLoading:g.isPending,size:"sm",onClick:A,className:`text-sm text-white px-2 py-2 rounded ${x?"bg-red-600 hover:bg-red-700":"bg-green-600 hover:bg-green-700"}`,children:x?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"hidden sm:inline",children:"Make Consent Optional"}),e.jsx("span",{className:"inline sm:hidden",children:"Make Optional"})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"hidden sm:inline",children:"Require Client Consent"}),e.jsx("span",{className:"inline sm:hidden",children:"Make Mandatory"})]})}),e.jsx(i,{variant:"primary",onClick:()=>F(`/${k}/projectdetails/${o}/paymentconfirmation`),children:"Back"})]})]}),e.jsxs("div",{className:"rounded-lg shadow border border-blue-200 overflow-hidden",children:[e.jsx("div",{className:"bg-blue-50 px-5 py-3 flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2 font-semibold text-blue-700 text-lg",children:[e.jsx("i",{className:"fa-solid fa-circle-info"}),"Consent Status"]})}),e.jsx("div",{className:"p-4",children:d?e.jsxs("div",{className:"bg-green-50 p-4 rounded text-green-800 text-sm border border-green-200 shadow-sm",children:[e.jsx("span",{className:"mr-2",children:"Client Status:"}),e.jsx("strong",{className:"mr-2",children:f?e.jsxs(e.Fragment,{children:["Agreed ",e.jsx("i",{className:"fa-solid fa-circle-check text-green-600 mr-2"})]}):f===null?"Not Agreed Yet":e.jsxs(e.Fragment,{children:["Not Agreed ",e.jsx("i",{className:"fa-solid fa-circle-xmark text-red-600 mr-2"})]})}),e.jsx("br",{}),e.jsxs("span",{children:["Agreed on: ",e.jsx("strong",{children:U(d)})]})]}):N?e.jsxs("div",{className:"bg-yellow-50 p-4 rounded text-yellow-800 border border-yellow-200 text-sm",children:[e.jsx("i",{className:"fa-solid fa-hourglass-half mr-2"}),"Consent link was generated, waiting for client to approve."]}):e.jsxs("div",{className:"bg-red-50 p-4 rounded text-red-700 border border-red-200 text-sm",children:[e.jsx("i",{className:"fa-solid fa-times-circle mr-2"}),"Client has ",e.jsx("strong",{children:"Not yet agreed"}),".",e.jsx("br",{}),"No consent link generated."]})})]}),x&&!d&&e.jsxs("div",{className:"rounded-lg shadow border border-blue-200 overflow-hidden",children:[e.jsx("div",{className:"bg-blue-50 px-5 py-3 flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2 font-semibold text-blue-700 text-lg",children:[e.jsx("i",{className:"fa-solid fa-link"}),"Consent Link"]})}),e.jsx("div",{className:"p-4 space-y-3",children:!N&&!c?e.jsx(e.Fragment,{children:(u||j)&&e.jsxs(i,{isLoading:p.isPending,onClick:P,className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded",children:[e.jsx("i",{className:"fa-solid fa-wand-magic-sparkles mr-2"}),"Generate Consent Link"]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg bg-gray-100",children:[e.jsx("span",{className:"text-sm truncate",children:c}),e.jsxs("div",{className:"flex gap-2 ml-4",children:[e.jsxs(i,{variant:"outline",className:"bg-blue-600 text-white hover:bg-blue-700 px-3 py-1 text-sm",onClick:()=>M(c),children:[e.jsx("i",{className:"fa-regular fa-copy mr-1"}),"Copy"]}),e.jsxs(i,{variant:"outline",className:"bg-green-600 text-white hover:bg-green-700 px-3 py-1 text-sm",onClick:()=>R(c),children:[e.jsx("i",{className:"fa-brands fa-whatsapp mr-1"}),"Share"]})]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Share this link with the client to collect consent."})]})})]}),e.jsxs("div",{className:`rounded-lg shadow border border-gray-200 max-h-70 overflow-y-auto custom-scrollbar ${d?"!max-h-[480px]":""} `,children:[e.jsxs("div",{className:"bg-gray-100 px-5 py-3 text-gray-700 font-medium text-lg flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-file-contract"}),"Consent Form Content"]}),e.jsx("div",{className:"prose prose-sm sm:prose base p-5",style:{fontFamily:"Segoe UI, sans-serif"},dangerouslySetInnerHTML:{__html:T||"<p>No content available.</p>"}})]})]})};export{W as default};
