import{a as O,b as I,c as _,r as g,j as e,O as B}from"./index-By5P0A7l.js";import{I as k}from"./Input-DKpmFZl7.js";import{t as n}from"./toast-BSC5QTk1.js";import{B as o}from"./Button-DLUK8O0t.js";import{D as G,a as V,c as H,b as T}from"./Dialog-B8IdufMK.js";import{u as $,a as J,b as K}from"./labourRateconfigApi-puuFtIF2.js";import Q from"./MaterialOverviewLoading-9Ck4pGPe.js";import{S as U}from"./StageGuide-D14I8_Im.js";import{C as W,a as X}from"./Card-CFqBlVQz.js";import"./useQuery-Cc7pLKfK.js";import"./useMutation-7YLqc7VE.js";import"./roleCheck-YGaMnK_P.js";import"./Skeleton-FCBR4RgB.js";function me(){var N,w;const{organizationId:c}=O(),L=I(),F=location.pathname.includes("laboursingle"),{role:h,permission:l}=_(),R=h==="owner"||((N=l==null?void 0:l.materialquote)==null?void 0:N.list),D=h==="owner"||((w=l==null?void 0:l.materialquote)==null?void 0:w.create),f=[{key:"",type:"string",required:!1},{key:"Rs",type:"number",required:!1},{key:"",type:"",required:!1}],[u,p]=g.useState(""),[d,m]=g.useState(f),[S,x]=g.useState(!1),{data:i,isLoading:y,refetch:j}=$(c),{mutateAsync:q,isPending:b}=J(),{mutateAsync:E,isPending:z}=K(),A=()=>{m([...d,{key:"",type:"string",required:!1}])},C=(a,t,s)=>{const r=[...d];r[a][t]=s,m(r)},v=async()=>{var a,t;try{if(!c||!u||d.length===0)return n({title:"Error",description:"Category name and fields are required",variant:"destructive"});const s=d.filter(r=>r.key.trim()!=="");if(s.length===0)return n({title:"Error",description:"Please enter valid field keys",variant:"destructive"});await q({organizationId:c,name:u,fields:s}),p(""),m([{key:"",type:"string",required:!1}]),x(!1),j(),n({title:"Success",description:"Category Created Successfully"})}catch(s){n({title:"Error",description:((t=(a=s==null?void 0:s.response)==null?void 0:a.data)==null?void 0:t.message)||(s==null?void 0:s.message)||"failed to create category",variant:"destructive"})}},P=a=>{var t,s;try{E({categoryId:a,organizationId:c}),j(),n({title:"Success",description:"Category Deleted Successfully"})}catch(r){n({title:"Error",description:((s=(t=r==null?void 0:r.response)==null?void 0:t.data)==null?void 0:s.message)||(r==null?void 0:r.message)||"failed to delete category",variant:"destructive"})}},M=a=>{m(f),x(a)};return F?e.jsx(B,{}):e.jsxs("div",{className:"space-y-6 max-h-full overflow-y-auto ",children:[e.jsxs("header",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 ",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-cubes mr-3 text-blue-600"}),"Labour Rate Configuration"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your labour's charges here"})]}),e.jsxs("section",{className:"flex  gap-3 items-center",children:[D&&e.jsx("div",{children:e.jsx(o,{onClick:()=>x(!0),children:"Create New Category"})}),e.jsx("div",{className:"w-full sm:w-auto flex justify-end sm:block",children:e.jsx(U,{organizationId:c,stageName:"materialquote"})})]})]}),e.jsx(G,{open:S,onOpenChange:M,children:e.jsxs(V,{className:"px-5 py-6",children:[e.jsx(H,{className:"px-0 py-0",children:e.jsx(T,{children:"Create New Labour Category"})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(k,{placeholder:"Labour and Miscellaneous",value:u,onChange:a=>p(a.target.value)}),e.jsx("h4",{className:"text-base font-semibold",children:"Define Fields"}),e.jsx("div",{className:"space-y-2",children:d.map((a,t)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(k,{placeholder:"Field key (e.g: Category, Rs, notes)",value:a.key,onChange:s=>{a.key!=="Rs"&&C(t,"key",s.target.value)},className:"flex-1"}),e.jsxs("select",{value:a.type,onChange:s=>C(t,"type",s.target.value),className:"  px-2 py-2 rounded-xl border border-blue-200 focus:border-blue-200 active:border-blue-200",children:[e.jsx("option",{value:"string",children:"text"}),e.jsx("option",{value:"number",children:"number"})]})]},t))}),e.jsxs("div",{className:"flex justify-between pt-2",children:[e.jsx(o,{variant:"secondary",onClick:A,children:"+ Add Field"}),e.jsx(o,{isLoading:b,onClick:v,children:"Create Category"})]})]})]})}),!y&&(i==null?void 0:i.length)===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[300px] w-full bg-white rounded-xl   text-center p-6",children:[e.jsx("i",{className:"fas fa-box-open text-5xl text-blue-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-1",children:"No Labour Rate Configuration Found"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Looks like there are no Labour Rate Configuration yet for this organization.",e.jsx("br",{}),e.jsx(o,{onClick:v,isLoading:b,className:"mx-4 my-2",children:"Create New Category"})]})]}),y&&e.jsx(Q,{}),e.jsx("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:R&&(i==null?void 0:i.map(a=>e.jsx(W,{className:"w-full border-l-4 border-blue-600 shadow-md bg-white hover:shadow-lg transition-all",children:e.jsxs(X,{className:"p-4 space-y-2",children:[e.jsx("h3",{className:"text-base font-bold text-blue-700 mb-2",children:a.name}),e.jsxs("p",{className:"text-sm text-gray-600 capitalize",children:["Fields:"," ",e.jsx("strong",{children:a.fields.map(t=>t.key).join(", ")})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsxs(o,{size:"sm",variant:"secondary",onClick:()=>L(`laboursingle/${a._id}`),children:[e.jsx("i",{className:"fas fa-eye mr-1"}),"View"]}),e.jsxs(o,{size:"sm",isLoading:z,variant:"danger",className:"bg-red-600 text-white",onClick:()=>P(a._id),children:[e.jsx("i",{className:"fas fa-trash mr-1"}),"Delete"]})]})]})},a._id)))})]})}export{me as default};
