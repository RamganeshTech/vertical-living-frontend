import{u as U,r as p,j as e}from"./index-CDrefmTi.js";import{B as A}from"./Button-DSSReI3J.js";import{u as L}from"./vendorAccApi-CSf9YslD.js";import{S as _}from"./SearchSelectNew-CCvIu55n.js";import{L as V}from"./Label-CTVXvCEn.js";const z=[{label:"Cash",value:"cash"},{label:"Bank Transfer",value:"banktransfer"},{label:"Cheque",value:"cheque"},{label:"UPI",value:"upi"},{label:"Credit Card",value:"creditcard"},{label:"Others",value:"others"}],Y=({mode:b,initialData:o,onSubmit:T,isSubmitting:N,organizationId:O})=>{var S,M;const D=U(),[v,G]=p.useState(b),{data:h}=L(O),r={organizationId:O,vendorId:"",vendorName:"",paymentDate:new Date().toISOString().split("T")[0],paymentMode:"Cash",paidThrough:"",items:[{date:new Date().toISOString().split("T")[0],billAmount:0,amountDue:0,paymentMadeOn:null}],totalAmount:0,totalDueAmount:0,notes:""},[g,I]=p.useState(!1),[l,c]=p.useState(r),[w,P]=p.useState({totalAmount:0,totalDueAmount:0});p.useEffect(()=>{var t;c({...r,...o&&{vendorId:o.vendorId||r.vendorId,vendorName:o.vendorName||r.vendorName,paymentDate:o.paymentDate?new Date(o.paymentDate).toISOString().split("T")[0]:r.paymentDate,paymentMode:o.paymentMode||r.paymentMode,paidThrough:o.paidThrough||r.paidThrough,items:(t=o.items)!=null&&t.length?o.items.map(a=>({date:a.date?new Date(a.date).toISOString().split("T")[0]:r.items[0].date,billAmount:a.billAmount??r.items[0].billAmount,amountDue:a.amountDue??r.items[0].amountDue,paymentMadeOn:a.paymentMadeOn?new Date(a.paymentMadeOn).toISOString().split("T")[0]:r.items[0].paymentMadeOn})):r.items,totalAmount:o.totalAmount??r.totalAmount,totalDueAmount:o.totalDueAmount??r.totalDueAmount,notes:o.notes||r.notes}}),b==="view"&&I(!0)},[o,b]),p.useEffect(()=>{const t=l.items.reduce((s,n)=>s+(n.billAmount||0),0),a=l.items.reduce((s,n)=>s+(n.amountDue||0),0);P({totalAmount:t,totalDueAmount:a})},[l.items]);const k=(S=h||[])==null?void 0:S.map(t=>({value:t._id,label:t.vendorName,email:t.email})),y=t=>{const{name:a,value:s}=t.target;c(n=>({...n,[a]:s}))},F=()=>{c(t=>({...t,items:[...t.items,{date:new Date().toISOString().split("T")[0],billAmount:0,amountDue:0,paymentMadeOn:null}]}))},E=t=>{c(a=>({...a,items:a.items.filter((s,n)=>n!==t)}))},f=(t,a,s)=>{c(n=>{const m=[...n.items],i={...m[t]};if(a==="billAmount"||a==="amountDue"){let u=0;s===null||s===""?u=0:typeof s=="string"?u=parseFloat(s)||0:u=s,i[a]=u<0?0:u}else a==="date"?i.date=s||new Date().toISOString().split("T")[0]:a==="paymentMadeOn"&&(i.paymentMadeOn=s||null);if(m[t]=i,t===m.length-1){const u=m[m.length-1];Object.values(u).some(j=>typeof j=="number"?j!==0:j&&j.trim()!=="")&&m.push({date:new Date().toISOString().split("T")[0],billAmount:0,amountDue:0,paymentMadeOn:null})}return{...n,items:m}})},B=t=>{const a=[];return t.vendorName.trim()||a.push("Vendor name is required"),t.items.forEach((s,n)=>{!s.date||s.date.trim()===""?a.push(`Item ${n+1}: Date is required`):isNaN(new Date(s.date).getTime())&&a.push(`Item ${n+1}: Date is invalid`),s.billAmount<0&&a.push(`Item ${n+1}: Bill amount cannot be negative`),s.amountDue<0&&a.push(`Item ${n+1}: Amount due cannot be negative`),s.paymentMadeOn&&isNaN(new Date(s.paymentMadeOn).getTime())&&a.push(`Item ${n+1}: Payment made on must be a valid date`)}),a},$=t=>{const a=h==null?void 0:h.find(s=>s._id===t);c(s=>({...s,vendorId:t||"",vendorName:(a==null?void 0:a.vendorName)||""}))},q=async t=>{t.preventDefault();const a=l.items.filter(i=>i.billAmount>0||i.amountDue>0||i.paymentMadeOn&&i.paymentMadeOn.trim()!==""),s={...l,items:a},n=B(s);if(n.length>0){alert(n.join(`
`));return}const m={...s,organizationId:"",totalAmount:w.totalAmount};await T(m),c(r)},d=v==="view",x=v==="create",C=v==="edit";return e.jsxs("div",{className:"max-w-full mx-auto space-y-2",children:[e.jsx("header",{className:"flex justify-between items-center",children:e.jsxs("div",{className:"flex justify-between items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>D(-1),className:"bg-blue-100 hover:bg-slate-300 flex items-center justify-between w-8 h-8 border border-[#a6aab8] text-sm cursor-pointer rounded-md px-2 ",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-credit-card mr-3 text-blue-600"}),x?"Create Vendor Payment Order":C?"Update Vendor Payment  Order":"View Vendor Payment Order"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:x?"Fill in the details to create a new order":C?"Update the Vendor Payment details":"Vendor Payment details"})]})]})}),e.jsxs("form",{onSubmit:q,className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx("i",{className:"fas fa-file-alt mr-2 text-blue-600"}),"Vendor Payment Details"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(V,{children:"Vendor"}),e.jsx(_,{options:k,placeholder:"Select Vendor",searchPlaceholder:"Search Vendor...",value:(l==null?void 0:l.vendorId)||void 0,onValueChange:t=>$(t),searchBy:"name",displayFormat:"simple",className:"w-full"})]}),e.jsxs("div",{className:"",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"checkbox",className:"cursor-pointer",checked:g,id:"enableName",onChange:()=>I(t=>!t)}),e.jsx(V,{htmlFor:"enableName",className:"cursor-pointer",children:"Click the check box to enter the name manually, if not available from the drop down"})]}),e.jsx("input",{type:"text",name:"vendorName",value:g?l.vendorName:"",onChange:t=>{g&&y(t)},disabled:d||!g,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",placeholder:"Enter Vendor name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Date"}),e.jsx("input",{type:"date",name:"paymentDate",value:l.paymentDate,onChange:y,disabled:d,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Mode"}),e.jsxs("select",{name:"paymentMode",value:l.paymentMode,onChange:y,disabled:d,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:"Select Payment Mode"}),z.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-list mr-2 text-blue-600"}),"Items ",e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),!d&&e.jsxs(A,{type:"button",onClick:F,variant:"primary",children:[e.jsx("i",{className:"fas fa-plus mr-2"}),"Add Item"]})]}),((M=l==null?void 0:l.items)==null?void 0:M.length)===0&&b==="view"?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("i",{className:"fas fa-inbox text-4xl mb-2"}),e.jsx("p",{children:"No items added yet. Start typing to add items."})]}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("div",{className:"grid grid-cols-10 gap-3 mb-2 px-4 py-3 bg-gray-100 rounded-lg font-semibold text-gray-700 text-sm",children:[e.jsx("div",{className:"col-span-1 text-center",children:"#"}),e.jsxs("div",{className:"col-span-2 text-center",children:["Date",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"col-span-2 text-center",children:"Bill Amount"}),e.jsxs("div",{className:"col-span-2 text-center",children:["Amount Due ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"col-span-2 text-center",children:"Payment Made On"}),e.jsx("div",{className:"col-span-1 text-center",children:"Action"})]}),e.jsx("div",{className:"space-y-2",children:l.items.map((t,a)=>e.jsxs("div",{className:"grid grid-cols-10 gap-3 px-4 py-3 bg-white border border-gray-200 rounded-lg hover:border-blue-300 transition-colors items-center",children:[e.jsx("div",{className:"col-span-1 text-center text-gray-600 font-medium",children:a+1}),e.jsx("div",{className:"col-span-2",children:e.jsx("input",{type:"date",value:t.date,onChange:s=>f(a,"date",s.target.value),disabled:d,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed text-sm",placeholder:"Enter item name"})}),e.jsx("div",{className:"col-span-2",children:e.jsx("input",{type:"number",value:t.billAmount,onChange:s=>f(a,"billAmount",s.target.value),disabled:d,min:"0",step:"1",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed text-sm",placeholder:"0"})}),e.jsx("div",{className:"col-span-2",children:e.jsx("input",{type:"number",value:t.amountDue,onChange:s=>f(a,"amountDue",s.target.value),disabled:d,min:"0",step:"1",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed text-sm",placeholder:"0.00"})}),e.jsx("div",{className:"col-span-2",children:e.jsx("input",{type:"date",value:t.paymentMadeOn||"",onChange:s=>f(a,"paymentMadeOn",s.target.value),disabled:d,min:"0",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed text-sm",placeholder:"0.00"})}),e.jsx("div",{className:"col-span-1 text-center",children:!d&&e.jsx("button",{type:"button",onClick:()=>E(a),disabled:l.items.length===1,className:"text-red-600 cursor-pointer hover:text-red-800 disabled:text-gray-400 disabled:cursor-not-allowed p-2 rounded-full hover:bg-red-50 transition-colors",title:l.items.length===1?"Cannot delete last item":"Delete item",children:e.jsx("i",{className:"fas fa-trash"})})})]},a))}),e.jsxs("section",{className:"px-8 py-3 bg-blue-50 rounded-lg mt-4 font-semibold text-gray-800",children:[e.jsxs("div",{className:"text-right",children:["Total:",e.jsxs("span",{className:"ml-3 text-right text-blue-600 text-lg",children:["₹",w.totalAmount.toFixed(2)]})]}),e.jsxs("div",{className:"text-right",children:["Total Due Amount:",e.jsxs("span",{className:"ml-3 text-right text-blue-600 text-lg",children:["₹",w.totalDueAmount.toFixed(2)]})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx("i",{className:"fas fa-comment-alt mr-2 text-blue-600"}),"Additional Information"]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("textarea",{name:"notes",value:l.notes,onChange:y,disabled:d,rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed resize-none",placeholder:"Add any notes for the Vendor..."})]})})]}),!d&&e.jsxs("div",{className:"flex justify-end gap-4 pt-6",children:[e.jsxs(A,{type:"button",onClick:()=>D(-1),className:"bg-gray-500 text-white px-6 py-2",disabled:N,children:[e.jsx("i",{className:"fas fa-times mr-2"}),"Cancel"]}),e.jsx(A,{type:"submit",className:"bg-blue-600 text-white px-6 py-2",disabled:N,children:N?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin mr-2"}),x?"Creating...":"Updating..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:`fas ${x?"fa-plus":"fa-save"} mr-2`}),x?"Create Order":"Update Order"]})})]})]})]})};export{Y as V};
