import{r as I,b as $,a as K,i as re,c as W,u as Y,G as z,H,J as Q,K as V,M as J,j as e,L as G,B,N as q,P as X,Q as Z,S as ee,T as se,U as te,t as U,R as le}from"./index-B7U0voEN.js";import{M as ce,f as de,C as D}from"./constants-BAzBevij.js";import{u as ae}from"./stageSelectionApi-DeVCh-n6.js";function fe(d,f){I.useEffect(()=>{const N=t=>{t.ctrlKey&&t.key==="]"?(t.preventDefault(),f()):t.ctrlKey&&t.key==="["&&(t.preventDefault(),d())};window.addEventListener("keydown",N)},[f,d])}const ue=(d,f,N,t,u)=>{const E=t==null?void 0:t.some(s=>s.toLowerCase()==="projectdetails");let x={},l={},n={};if(E){let s=["DOCUMENTATION","WORKERS","INVITECLIENT","PREREQUIRETIES","REQUIREMENTFORM","SITEMEASUREMENT","SAMPLEDESIGN","TECHNICALCONSULTANT","SELECTSTAGE","PAYMENTCONFIRMATION","ORDERMATERIALS","MATERIALARRIVED","WORKSCHEDULE","INSTALLATION","QUALITYCHECK","CLEANINGSANITATION","PROJECTDELIVERY"];const j=s.indexOf("TECHNICALCONSULTANT")+1;d==="Manual Flow"?s.splice(j,0,"MATERIALSELECTION","COSTESTIMATION"):d==="Modular Units"&&s.splice(j,0,"MODULARUNIT"),d!=null&&(s=s.filter(o=>o!=="SELECTSTAGE"));for(const o of s)f[o]&&u[o]&&N[o]&&(x[o]=f[o],l[o]=u[o],n[o]=N[o])}else x=f,l=u,n=N;let p=1,g=!1;const m={};for(const s of Object.keys(x))s==="REQUIREMENTFORM"&&(g=!0),g?(m[s]=`${p} ${x[s]}`,p++):m[s]=x[s];return{filteredLabels:m,filteredIcons:l,filteredPaths:n}},xe=({labels:d,icons:f,path:N})=>{const[t,u]=I.useState(!1),{projectId:E}=$(),x=K(),l=re(),n=l.pathname.split("/"),{organizationId:p}=$(),g=W(),{role:m}=Y(r=>r.authStore),[s,h]=I.useState(""),{data:j,isLoading:o}=ae(E),{mutateAsync:O,isPending:C}=z(),{mutateAsync:y,isPending:w}=H(),{mutateAsync:P,isPending:S}=Q(),{mutateAsync:A,isPending:L}=V(),{mutateAsync:v,isPending:M}=J(),R=()=>{u(!1)},i=()=>{u(!0)};I.useEffect(()=>{const c=l.pathname.split("/")[4];h(t?()=>ce[c]:()=>de[c])},[l.pathname,t]),fe(i,R);const a=!o&&j;let{filteredLabels:b,filteredIcons:ne,filteredPaths:T}=ue(a,d,N,n,f);const _=n[2]==="projectdetails",oe=n[1]==="login",ie=()=>{_&&x(`/organizations/${p}/projects`),oe&&x("/organizations")},F=async()=>{var r,c;try{m==="CTO"?await O():m==="client"?await y():m==="staff"?await P():m==="owner"?await A():m==="worker"&&await v(),g(q()),g(X()),g(Z()),g(ee()),g(se()),g(te()),U({title:"Success",description:"logout successfull"}),(!C||!w||!S||!L||!M)&&x("/")}catch(k){U({title:"Error",description:((c=(r=k==null?void 0:k.response)==null?void 0:r.data)==null?void 0:c.message)||"Failed to logout",variant:"destructive"})}};return e.jsx(e.Fragment,{children:t?e.jsxs("aside",{onMouseLeave:()=>u(!1),className:"relative flex flex-col bg-[#2f303a] w-[17%] min-h-screen max-h-screen text-[#9ca3af] select-none transition-all duration-300",children:[e.jsxs("div",{className:"flex flex-col flex-grow overflow-y-auto overflow-x-hidden custom-scrollbar p-2",children:[e.jsxs("div",{onClick:ie,className:`flex ${_?"cursor-pointer":""} justify-between items-center border-b-1 py-2`,children:[e.jsx("span",{className:"text-xl",children:D.COMPANY_NAME}),e.jsx("div",{className:"w-[30px] h-[30px]",children:e.jsx("img",{className:"w-full h-full",src:D.COMPANY_LOGO,alt:"LOGO"})})]}),e.jsxs("section",{className:"py-2 space-y-2",children:[" ",Object.entries(b).map(([r,c])=>T[r]&&e.jsx(G,{to:T[r],className:"outline-none",children:e.jsxs("div",{onClick:()=>h(c),className:`cursor-pointer flex justify-between max-w-[95%] py-4 px-4 ${s===c?"bg-[#3a3b45] rounded-xl text-white":"rounded-xl hover:bg-[#3a3b45]"} `,children:[e.jsx("span",{className:"text-lg",children:c}),e.jsx("span",{children:e.jsx("i",{className:"fa-solid fa-chevron-right"})})]})},c))]})]}),e.jsxs("div",{className:"flex flex-col p-2 border-t border-[#3a3b45]",children:[n[1]!=="login"&&e.jsxs(B,{isLoading:C||w||S||L||M,onClick:F,className:"flex items-center gap-2 px-4 py-3 rounded-lg !bg-[#3a3b45] !text-[#9ca3af] hover:!bg-[#464751] hover:!text-white transition",children:[e.jsx("i",{className:"fa-solid fa-right-from-bracket"}),e.jsx("span",{children:"Logout"})]}),e.jsx("button",{title:"Ctrl+] to close",onClick:R,className:"mt-2 flex items-center justify-center outline-none border border-blue-600 text-blue-500 hover:bg-[#3a3b45] rounded-lg w-full py-2",children:e.jsx("i",{className:"fa-solid fa-chevron-left"})})]})]}):e.jsxs("aside",{onMouseEnter:()=>u(!0),className:"flex flex-col relative justify-between bg-[#2f303a] w-[6%]  max-h-full  text-[#9ca3af] transition-all duration-300 ",children:[e.jsx("div",{className:"max-h-[95%] overflow-y-auto overflow-x-hidden custom-scrollbar",children:e.jsx("div",{className:"flex items-center flex-col justify-between w-full",children:Object.entries(ne).map(([r,c])=>T[r]?e.jsx(G,{to:T[r],className:`${T[r]?"":"cursor-not-allowed"}`,children:e.jsx("div",{onClick:()=>h(r),className:`cursor-pointer flex justify-between max-w-[95%] py-4 px-4 ${(s==null?void 0:s.toLowerCase())===r.toLowerCase()?"bg-[#3a3b45] rounded-xl text-white":"rounded-xl hover:bg-[#3a3b45]"} `,children:e.jsx("i",{className:`${c} ${(s==null?void 0:s.toLowerCase())===r.toLowerCase()?"text-[#4a86f7]":"text-[#9ca3af]"} `})})}):e.jsx("div",{className:"cursor-not-allowed flex justify-between max-w-[95%] py-4 px-4",children:e.jsx("i",{className:`${c}`})}))})}),e.jsxs("div",{className:"flex flex-col items-center p-2 border-t border-[#3a3b45]",children:[n[1]!=="login"&&e.jsx(B,{isLoading:C||w||S||L||M,title:"logout",onClick:F,className:"w-[40px] h-[40px] flex items-center justify-center !bg-[#3a3b45] !text-[#9ca3af] hover:!text-red-500 transition",children:e.jsx("i",{className:"fa-solid fa-right-from-bracket"})}),e.jsx("button",{title:"Ctrl+[ to open",onClick:i,className:"mt-2 cursor-pointer outline-none border-[#9ca3af] h-[40px] w-[40px] flex items-center justify-center border rounded-lg",children:e.jsx("i",{className:"fa-solid fa-chevron-right text-[#4a86f7]"})})]})]})})},he=I.memo(xe),je=({isOpen:d,onClose:f,labels:N,path:t})=>{const u=K(),{organizationId:E,projectId:x}=$(),l=W(),{role:n}=Y(i=>i.authStore),{data:p,isLoading:g}=ae(x),{mutateAsync:m,isPending:s}=z(),{mutateAsync:h,isPending:j}=H(),{mutateAsync:o,isPending:O}=Q(),{mutateAsync:C,isPending:y}=V(),{mutateAsync:w,isPending:P}=J(),S=async()=>{var i,a;try{n==="CTO"?await m():n==="client"?await h():n==="staff"?await o():n==="owner"?await C():n==="worker"&&await w(),l(q()),l(X()),l(Z()),l(ee()),l(se()),l(te()),U({title:"Success",description:"logout successfull"}),(!s||!j||!O||!y||!P)&&u("/")}catch(b){U({title:"Error",description:((a=(i=b==null?void 0:b.response)==null?void 0:i.data)==null?void 0:a.message)||"Failed to logout",variant:"destructive"})}};let A=Object.entries(N);const L=location.pathname.split("/"),v=L[2]==="projectdetails";if(L.includes("projectdetails")&&!g){const i=p;A=A.filter(([a])=>{if(i){if(i==="Modular Units")return a!=="MATERIALSELECTION"&&a!=="COSTESTIMATION"&&a!=="SELECTSTAGE";if(i==="Manual Flow")return a!=="MODULARUNIT"&&a!=="SELECTSTAGE"}else return a!=="MODULARUNIT"&&a!=="MATERIALSELECTION"&&a!=="COSTESTIMATION";return!0})}const R=()=>{v&&u(`/organizations/${E}/projects`)};return e.jsxs(e.Fragment,{children:[d&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40",onClick:f}),e.jsxs("aside",{className:`fixed top-0 left-0 z-50 h-screen bg-white w-[75%] flex flex-col transition-transform duration-300 ${d?"translate-x-0":"-translate-x-full"}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsxs("div",{onClick:R,className:`flex items-center gap-3 ${v?"cursor-pointer":""}`,children:[e.jsx("img",{src:D.COMPANY_LOGO,alt:"Logo",className:"w-10 h-10 rounded-full object-cover"}),e.jsx("span",{className:"text-lg font-semibold",children:D.COMPANY_NAME})]}),e.jsx("button",{onClick:f,className:"text-xl text-gray-700",children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsx("nav",{className:"flex flex-col flex-grow overflow-y-auto p-4",children:A.map(([i,a],b)=>e.jsxs(le.Fragment,{children:[t[i]?e.jsx(G,{to:t[i],onClick:f,className:"text-gray-800 hover:bg-gray-100 p-3 rounded block",children:a}):e.jsx("span",{className:"text-gray-400 p-3 rounded cursor-not-allowed block",children:a}),b<A.length-1&&e.jsx("hr",{className:"border-t border-gray-200 my-1"})]},i))}),e.jsx("div",{className:"border-t border-gray-200 p-4",children:L[1]!=="login"&&e.jsxs(B,{className:"w-full flex items-center justify-center gap-2",isLoading:s||j||O||y||P,onClick:S,children:[e.jsx("i",{className:"fas fa-sign-out-alt"})," Logout"]})})]})]})};export{je as M,he as S};
