import{j as t,r as p}from"./index-e25x2Bps.js";import{N as L}from"./constants-CGGnKgPh.js";import{d as K}from"./downloadFile-gObiqnPz.js";import{r as q}from"./index-KfBiuFmZ.js";function J({images:s,onDelete:x,onDownload:N,isDeleting:v=!1,refetch:g,className:k="",minWidth:j=100,maxWidth:_=100,heightClass:y=0,isComments:c,editingId:P,tempComment:e,setEditingId:h,setTempComment:d,onUpdateComment:u}){const[a,f]=p.useState(null),[$,E]=p.useState(!1),[M,H]=p.useState(null),[z,S]=p.useState({}),W=(l,o,w)=>{const n=w/o,R=Math.max(150,Math.min(400,200*n));S(B=>({...B,[l]:R}))},A=l=>{f(l),E(!0)},b=()=>{E(!1),f(null)},I=()=>{a!==null&&f((a-1+s.length)%s.length)},D=()=>{a!==null&&f((a+1)%s.length)};p.useEffect(()=>{const l=o=>{o.key==="Escape"?b():o.key==="ArrowRight"?D():o.key==="ArrowLeft"&&I()};return $&&(document.addEventListener("keydown",l),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",l),document.body.style.overflow="unset"}},[$,D,I,b]);const F=async l=>{if(x)try{await x(l),g&&await g(),s.length<=1?b():a!==null&&a>=s.length-1&&f(Math.max(0,s.length-2))}catch(o){console.error("Error deleting image:",o)}},G=l=>{N({src:l==null?void 0:l.url,alt:(l==null?void 0:l.originalName)||"image"})},O=()=>{b()},r=a!==null&&a>=0&&a<s.length?s[a]:null;return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:`gap-1 flex flex-wrap ${k}`,children:s.map((l,o)=>{const w=z[l._id]||200;return t.jsx(t.Fragment,{children:t.jsxs("div",{className:`relative cursor-pointer bg-gray-100 overflow-hidden mb-1 break-inside-avoid ${c?"flex flex-col":""}`,style:{flex:`0 1 ${j}px`,minWidth:`${j}px`,maxWidth:`${_}px`,height:c?`${(y||w)+40}px`:`${y||w}px`},onClick:()=>A(o),children:[t.jsx("img",{src:(l==null?void 0:l.url)||L,alt:(l==null?void 0:l.originalName)||`Image ${o+1}`,className:`w-full cursor-pointer ${c?"":"h-full"} object-cover`,loading:"lazy",onLoad:n=>{const i=n.target;W(l._id,i.naturalWidth,i.naturalHeight)}}),c&&t.jsx("div",{className:"text-xs border-t border-gray-200 bg-gray-50 p-1 h-full border overflow-y-auto custom-scrollbar",onMouseEnter:()=>H(l._id),onMouseLeave:()=>H(null),onClick:n=>{n.stopPropagation(),h==null||h(l._id),d==null||d(i=>({...i,[l._id]:l.comment||""}))},children:P===l._id?t.jsx("input",{autoFocus:!0,value:(e==null?void 0:e[l._id])||"",onChange:n=>d==null?void 0:d(i=>({...i,[l._id]:n.target.value})),onBlur:()=>u==null?void 0:u(l._id,(e==null?void 0:e[l._id])||""),onKeyDown:n=>{n.key==="Enter"&&(n.preventDefault(),u==null||u(l._id,(e==null?void 0:e[l._id])||""))},className:"w-full border p-1 rounded text-xs"}):t.jsx("div",{className:"cursor-pointer p-1 hover:bg-gray-100 rounded",children:t.jsxs("div",{className:"flex items-start gap-1",children:[t.jsx("i",{className:"fas fa-comment text-gray-400 mt-0.5"}),t.jsx("p",{className:"whitespace-pre-wrap break-words text-gray-700 text-xs",children:l.comment||t.jsx("span",{className:"italic text-gray-400",children:"Add a comment"})}),M===l._id&&t.jsx("i",{className:"fas fa-pen ml-auto text-gray-400 text-xs mt-1"})]})})})]},l._id)})})}),$&&r&&q.createPortal(t.jsxs("div",{className:"fixed inset-0 z-[9999] bg-black/70 flex items-center justify-center",onClick:O,style:{margin:0,padding:0},children:[t.jsxs("div",{className:"absolute top-6 right-6 z-[10000] flex items-center gap-4",children:[t.jsx("button",{onClick:l=>{l.stopPropagation(),G(r)},className:"bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-all duration-200",title:"Download",children:t.jsx("i",{className:"fas fa-download text-lg"})}),x&&t.jsx("button",{onClick:l=>{l.stopPropagation(),F(r._id)},className:"bg-black/50 hover:bg-red-600/70 text-white rounded-full p-3 transition-all duration-200",title:"Delete",disabled:v,children:t.jsx("i",{className:`fas ${v?"fa-spinner fa-spin":"fa-trash-can"} text-lg`})}),t.jsx("button",{onClick:l=>{l.stopPropagation(),b()},className:"bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-all duration-200",title:"Close",children:t.jsx("i",{className:"fas fa-times text-xl"})})]}),t.jsx("button",{onClick:l=>{l.stopPropagation(),I()},className:"absolute left-6 top-1/2 transform -translate-y-1/2 z-[10000] bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-all duration-200",children:t.jsx("i",{className:"fas fa-chevron-left text-2xl"})}),t.jsx("button",{onClick:l=>{l.stopPropagation(),D()},className:"absolute right-6 top-1/2 transform -translate-y-1/2 z-[10000] bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-all duration-200",children:t.jsx("i",{className:"fas fa-chevron-right text-2xl"})}),t.jsxs("div",{className:"relative flex items-center justify-center",style:{width:"70vw",height:"70vh",maxWidth:"70vw",maxHeight:"70vh"},onClick:l=>l.stopPropagation(),children:[t.jsx("img",{src:(r==null?void 0:r.url)||L,alt:r.originalName||`Image ${a!==null?a+1:1}`,className:"max-w-full max-h-full object-contain"}),c&&t.jsx("div",{className:"absolute bottom-0 w-full bg-black/40 text-white text-xs p-1",children:(r==null?void 0:r.comment)||"No comments yet"})]}),t.jsxs("div",{className:"absolute bottom-6 left-1/2 transform -translate-x-1/2 text-white text-sm bg-black/50 px-4 py-2 rounded-full",children:[a!==null?a+1:1," of ",s.length]})]}),document.body)]})}function Z({imageFiles:s=[],height:x,refetch:N,handleDeleteFile:v,className:g="",minWidth:k,maxWidth:j,isComments:_=!1,editingId:y,tempComment:c,setEditingId:P,setTempComment:e,onUpdateComment:h}){return t.jsx(t.Fragment,{children:t.jsx(J,{images:s,onDelete:v,onDownload:K,refetch:N,isDeleting:!1,className:g,heightClass:x,minWidth:k,maxWidth:j,isComments:_,editingId:y,tempComment:c,setEditingId:P,setTempComment:e,onUpdateComment:h})})}export{Z as I};
