import{r as h,j as e,u as Ve,f as $e,a as He,b as Ke}from"./index-DmIvND9E.js";import{C as Ye,a as We}from"./Card-CDMWR08L.js";import{I as v}from"./Input-DkyuoIiE.js";import{B as p}from"./Button-CcLxO5cH.js";import{d as Je,e as Xe,f as Ze,g as es,h as ss,i as ts,j as as,k as rs,l as ls,m as is,n as ns,o as ds}from"./commonOrderHistoryMaterialApi-BadLo1EK.js";import{t as o}from"./toast-BSC5QTk1.js";import{N as os}from"./constants-4IFJeChr.js";import{L as X}from"./Label-BmxexTAj.js";import{d as cs}from"./downloadFile-aQHxe2Id.js";import ms from"./MaterialOverviewLoading-CWbdT0Pl.js";import"./roleCheck-DZRqXPrB.js";import"./useQuery-BHdcKCtG.js";import"./useMutation-CAeBxy3I.js";import"./Skeleton-Cm__h_hu.js";const Ne=({id:u,unitId:Q,initialData:f,onSuccess:R,onCancel:P,mode:U})=>{const[g,S]=h.useState({unitName:"",quantity:1,singleUnitCost:0}),{mutateAsync:V,isPending:q}=Je(),{mutateAsync:$,isPending:F}=Xe();h.useEffect(()=>{U==="edit"&&f&&S({unitName:f.unitName,singleUnitCost:f.singleUnitCost,quantity:f.quantity})},[U,f]);const H=async()=>{var b,d;try{g.unitName.trim()||o({title:"Error",description:"Please Enter the UnitName",variant:"destructive"}),U==="create"?(await V({id:u,payload:g}),S({unitName:"",singleUnitCost:0,quantity:0}),o({title:"Success",description:"Item Created Successfully"})):(((f==null?void 0:f.unitName)!==g.unitName||f.quantity!==g.quantity||f.singleUnitCost!==g.singleUnitCost)&&(await $({id:u,unitId:Q,payload:g}),o({title:"Success",description:"Item Updated Successfully"})),P()),R()}catch(N){o({variant:"destructive",title:"Error",description:((d=(b=N==null?void 0:N.response)==null?void 0:b.data)==null?void 0:d.message)||(N==null?void 0:N.message)||"Update failed"})}};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:e.jsxs("div",{className:"bg-white shadow-xl p-6 rounded-xl w-full max-w-md relative z-50",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:U==="create"?"Create Unit":"Edit Unit"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(X,{children:"UnitName *"}),e.jsx(v,{placeholder:"Unit Name",value:g.unitName,onChange:b=>S({...g,unitName:b.target.value}),autoFocus:!0}),e.jsx(X,{children:"Quantity (optional)"}),e.jsx(v,{type:"number",placeholder:"Quantity",value:g.quantity,onChange:b=>S({...g,quantity:Number(b.target.value)})}),e.jsx(X,{children:"Single Unit Cost (optional)"}),e.jsx(v,{type:"number",placeholder:"Single Unit Cost",value:g.singleUnitCost,onChange:b=>S({...g,singleUnitCost:Number(b.target.value)})}),e.jsxs("div",{className:"flex justify-end items-center gap-3 pt-4 border-t border-gray-200",children:[e.jsx(p,{variant:"primary",isLoading:U==="create"?q:F,onClick:H,children:U==="create"?"Create":"Update"}),e.jsx(p,{variant:"ghost",onClick:P,children:"Cancel"})]})]})]})})},je=["nos","pieces","litre","kg","mm","cm","meter","feet","inch","sqft","sqmm","packet","roll","sheet"],_s=()=>{var re,le,ie,ne,de,oe,ce,me,xe,ue,he,pe,ge,fe,be;const{id:u}=Ve(),{openMobileSidebar:Q,isMobile:f}=$e(),[R,P]=h.useState(!1),U=He(),[g,S]=h.useState(""),[V,q]=h.useState(!1),[$,F]=h.useState(null),[H,b]=h.useState(!1),[d,N]=h.useState({}),[ve,G]=h.useState(!1),[m,L]=h.useState({}),[z,ye]=h.useState(null),[c,y]=h.useState(null),[w,B]=h.useState({}),A=h.useRef(null),{data:a,isLoading:Z,error:K,refetch:E,isError:O}=Ze(u),{mutateAsync:we,isPending:Ce}=es(),{mutateAsync:Se,isPending:_e}=ss(),{mutateAsync:Ue,isPending:Ie}=ts(),{mutateAsync:ke,isPending:ee}=as(),{mutateAsync:Pe,isPending:Ee}=rs(),{mutateAsync:De}=ls(),{role:Y,permission:_}=Ke(),qe=Y==="owner"||((re=_==null?void 0:_.commonorder)==null?void 0:re.delete),se=Y==="owner"||((le=_==null?void 0:_.commonorder)==null?void 0:le.create),T=Y==="owner"||((ie=_==null?void 0:_.commonorder)==null?void 0:ie.edit),{mutateAsync:Le}=is(),{mutateAsync:Ae,isPending:te}=ns(),{mutateAsync:Oe}=ds(),Me=async s=>{var i,t;try{await we({id:u,unitId:s}),o({title:"Success",description:"Item deleted successfully"})}catch(n){o({title:"Error",description:((t=(i=n==null?void 0:n.response)==null?void 0:i.data)==null?void 0:t.message)||"Failed to delete item",variant:"destructive"})}},M=async(s,i,t,n)=>{var x,I,j;if(T)try{const C=J.find(l=>l._id===s),k=(x=C==null?void 0:C.subItems)==null?void 0:x.find(l=>l._id===i);if(!k)return;const r={id:u,unitId:s,subItemId:i,subItemName:t==="name"?n:k.subItemName,quantity:t==="quantity"?Number(n)?Number(n):1:k.quantity,unit:t==="unit"?n:k.unit};console.log("updateddata",r),await Oe(r),o({title:"Success",description:"Item updated successfully"})}catch(C){o({title:"Error",description:((j=(I=C==null?void 0:C.response)==null?void 0:I.data)==null?void 0:j.message)||"Failed to update item",variant:"destructive"})}},W=async(s,i)=>{var n,x,I;if(!se)return;const t=i;if(!t&&!(t!=null&&t.name.trim()))return o({title:"Error",description:"Material Name is mandatory",variant:"destructive"});if(!((n=t==null?void 0:t.unit)!=null&&n.trim()))return o({title:"Error",description:"Unit is mandatory",variant:"destructive"});console.log("row data",t);try{await Le({id:u,unitId:s,subItemName:t.name,quantity:t.quantity??1,unit:t.unit}),B(j=>({...j,[s]:{name:"",quantity:1,unit:""}})),o({title:"Success",description:"Item created successfully"})}catch(j){o({title:"Error",description:((I=(x=j==null?void 0:j.response)==null?void 0:x.data)==null?void 0:I.message)||"Failed to create item",variant:"destructive"})}},Re=async(s,i)=>{var t,n;try{await Ae({id:u,unitId:s,subItemId:i}),o({title:"Success",description:"Item deleted successfully"})}catch(x){o({title:"Error",description:((n=(t=x==null?void 0:x.response)==null?void 0:t.data)==null?void 0:n.message)||"Failed to delete item",variant:"destructive"})}},Fe=async()=>{var s,i;try{if(d!=null&&d.phoneNumber&&!/^\d{10}$/.test(d==null?void 0:d.phoneNumber.trim()))throw new Error("Phone number should contain exactly 10 digit numbers");await Se({id:u,updates:d}),b(!1),o({title:"Success",description:"Delivery Details Updated"}),E()}catch(t){o({variant:"destructive",title:"Error",description:((i=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:i.message)||(t==null?void 0:t.message)||"Update failed"})}},Ge=async()=>{var s,i;try{if(m.phoneNumber&&!/^\d{10}$/.test(m.phoneNumber.trim()))throw new Error("Phone number should contain exactly 10 digit numbers");await Ue({id:u,updates:m}),o({title:"Success",description:"Shop Details Updated"}),G(!1),E()}catch(t){o({variant:"destructive",title:"Error",description:((i=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:i.message)||(t==null?void 0:t.message)||"Update failed"})}},ze=async()=>{var s,i;try{await ke({id:u}),o({title:"Success",description:"Pdf Generated successfully"}),E()}catch(t){o({title:"Error",description:((i=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:i.message)||(t==null?void 0:t.message)||"Failed to generate link",variant:"destructive"})}},Be=async s=>{var i,t;try{await Pe({id:u,pdfId:s}),o({title:"Success",description:"PDF deleted"}),G(!1),E()}catch(n){o({variant:"destructive",title:"Error",description:((t=(i=n==null?void 0:n.response)==null?void 0:i.data)==null?void 0:t.message)||(n==null?void 0:n.message)||"failed to delete"})}},Te=async(s,i)=>{var t,n;try{await De({id:u,pdfId:s,status:i}),o({title:"Success",description:"Pdf status updated successfully"}),E()}catch(x){o({title:"Error",description:((n=(t=x==null?void 0:x.response)==null?void 0:t.data)==null?void 0:n.message)||(x==null?void 0:x.message)||"Failed to update status",variant:"destructive"})}},J=(a==null?void 0:a.selectedUnits)||[],Qe=(a==null?void 0:a.totalCost)||0,ae=J.length>0;return h.useEffect(()=>{c&&A.current&&(A.current.focus(),A.current.select())},[c]),Z?e.jsx(ms,{}):e.jsxs("div",{className:"max-w-full max-h-full overflow-y-auto mx-auto p-2 space-y-6",children:[e.jsxs("div",{className:"flex-shrink-0 flex flex-col sm:flex-row  items-start sm:items-center mb-4 gap-4",children:[e.jsxs("div",{onClick:()=>U(-1),className:" cursor-pointer px-2 py-2 rounded-2xl hover:bg-gray-100",children:[e.jsx("i",{className:"fas fa-arrow-left text-[14px] "}),e.jsx("p",{className:"sm:inline hidden ml-2",children:"Back to projects"})]}),e.jsxs("h2",{className:"text-2xl mx-auto sm:text-2xl lg:text-2xl xl:text-3xl font-semibold text-blue-600 flex items-center",children:[f&&e.jsx("button",{onClick:Q,className:"mr-3 p-2 rounded-md border-gray-300 hover:bg-gray-100",title:"Open Menu",children:e.jsx("i",{className:"fa-solid fa-bars"})}),e.jsx("i",{className:"fa-solid fa-cart-shopping mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Common Ordering Material "}),e.jsx("span",{className:"sm:hidden",children:"Common Material Ordering"})]})]}),O&&e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"max-w-xl p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2",children:"⚠️ Error Occurred"}),e.jsx("p",{className:"text-red-500 text-sm mb-4",children:((de=(ne=K==null?void 0:K.response)==null?void 0:ne.data)==null?void 0:de.message)||"Failed to load ordering material"}),e.jsx(p,{isLoading:Z,onClick:()=>E(),className:"bg-red-600 text-white hover:bg-red-700",children:"Retry"})]})}),!O&&R&&e.jsx(Ne,{mode:"create",id:u,onSuccess:()=>{P(!1)},onCancel:()=>P(!1)}),!O&&V&&e.jsx(Ne,{mode:"edit",id:u,unitId:g,initialData:$,onSuccess:()=>{S(""),q(!1)},onCancel:()=>{F(null),S(""),q(!1)}}),!O&&e.jsxs("section",{className:"bg-white rounded-3xl shadow-[0_10px_40px_-15px_rgba(0,0,0,0.1)] overflow-hidden",children:[e.jsxs("div",{className:"border-l-4 border-blue-600 rounded-lg p-4 shadow-sm relative bg-white",children:[e.jsxs("h2",{className:"text-base sm:text-lg font-bold mb-3 text-blue-700 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-store"}),"Shop Details"]}),ve?e.jsxs("div",{className:"space-y-3",children:[e.jsx(v,{placeholder:"Shop Name",value:(m==null?void 0:m.shopName)||"",onChange:s=>L({...m,shopName:s.target.value}),className:"w-full"}),e.jsx(v,{placeholder:"Contact Person",value:(m==null?void 0:m.contactPerson)||"",onChange:s=>L({...m,contactPerson:s.target.value}),className:"w-full"}),e.jsx(v,{placeholder:"Phone Number",value:(m==null?void 0:m.phoneNumber)||"",type:"tel",maxLength:10,onChange:s=>L({...m,phoneNumber:s.target.value}),className:"w-full"}),e.jsx(v,{placeholder:"Address",value:(m==null?void 0:m.address)||"",onChange:s=>L({...m,address:s.target.value}),className:"w-full"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mt-3",children:[e.jsxs(p,{onClick:Ge,isLoading:Ie,className:"w-full sm:w-auto",children:[e.jsx("i",{className:"fa-solid fa-save mr-2"}),"Save"]}),e.jsxs(p,{variant:"outline",onClick:()=>G(!1),className:"w-full sm:w-auto",children:[e.jsx("i",{className:"fa-solid fa-times mr-2"}),"Cancel"]})]})]}):e.jsxs("div",{className:"space-y-2 text-sm sm:text-base",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Shop Name:"})," ",((oe=a==null?void 0:a.shopDetails)==null?void 0:oe.shopName)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Contact Person:"})," ",((ce=a==null?void 0:a.shopDetails)==null?void 0:ce.contactPerson)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Phone:"})," ",((me=a==null?void 0:a.shopDetails)==null?void 0:me.phoneNumber)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Address:"})," ",((xe=a==null?void 0:a.shopDetails)==null?void 0:xe.address)||"-"]}),T&&e.jsxs("button",{onClick:()=>{L(a==null?void 0:a.shopDetails),G(!0)},className:"absolute top-3 right-4 text-blue-600 text-xs sm:text-sm underline hover:text-blue-800",children:[e.jsx("i",{className:"fa-solid fa-edit mr-1"}),"Edit"]})]})]}),e.jsxs("div",{className:"border-l-4 mt-4 border-blue-600 rounded-lg p-4 shadow-sm relative bg-white",children:[e.jsxs("h2",{className:"text-base sm:text-lg font-bold mb-3 text-blue-700 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-truck"}),"Delivery Location"]}),H?e.jsxs("div",{className:"space-y-3",children:[e.jsx(v,{placeholder:"Site Name",value:(d==null?void 0:d.siteName)||"",onChange:s=>N({...d,siteName:s.target.value}),className:"w-full"}),e.jsx(v,{placeholder:"Site Supervisor",value:(d==null?void 0:d.siteSupervisor)||"",onChange:s=>N({...d,siteSupervisor:s.target.value}),className:"w-full"}),e.jsx(v,{placeholder:"Phone Number",type:"tel",maxLength:10,value:(d==null?void 0:d.phoneNumber)||"",onChange:s=>N({...d,phoneNumber:s.target.value}),className:"w-full"}),e.jsx(v,{placeholder:"Address",value:(d==null?void 0:d.address)||"",onChange:s=>N({...d,address:s.target.value}),className:"w-full"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mt-3",children:[e.jsxs(p,{onClick:Fe,isLoading:_e,className:"w-full sm:w-auto",children:[e.jsx("i",{className:"fa-solid fa-save mr-2"}),"Save"]}),e.jsxs(p,{variant:"outline",onClick:()=>b(!1),className:"w-full sm:w-auto",children:[e.jsx("i",{className:"fa-solid fa-times mr-2"}),"Cancel"]})]})]}):e.jsxs("div",{className:"space-y-2 text-sm sm:text-base",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Site Name:"})," ",((ue=a==null?void 0:a.deliveryLocationDetails)==null?void 0:ue.siteName)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Supervisor:"})," ",((he=a==null?void 0:a.deliveryLocationDetails)==null?void 0:he.siteSupervisor)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Phone:"})," ",((pe=a==null?void 0:a.deliveryLocationDetails)==null?void 0:pe.phoneNumber)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Address:"})," ",((ge=a==null?void 0:a.deliveryLocationDetails)==null?void 0:ge.address)||"-"]}),T&&e.jsxs("button",{onClick:()=>{N(a==null?void 0:a.deliveryLocationDetails),b(!0)},className:"absolute top-3 right-4 text-blue-600 text-xs sm:text-sm underline hover:text-blue-800",children:[e.jsx("i",{className:"fa-solid fa-edit mr-1"}),"Edit"]})]})]}),e.jsxs("div",{className:"p-6 border-b mt-4 border-gray-100 relative",children:[e.jsx("div",{className:"absolute top-0 left-0 h-full w-1.5 bg-blue-600 "}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 pl-3",children:[e.jsx("div",{children:e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Your Orders"})}),e.jsxs("div",{className:"flex gap-3",children:[!R&&se&&e.jsx(p,{onClick:()=>P(!0),variant:"primary",children:"+ Create New Unit"}),ae&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-500 text-sm",children:"Total:"}),e.jsxs("span",{className:"text-xl font-bold text-blue-600",children:["₹",Qe.toFixed(2)]})]})]})]})]}),e.jsx("div",{className:"py-2 overflow-y-auto custom-scrollbar ",children:ae?e.jsx("div",{className:"grid gap-5",children:J.map((s,i)=>{var t,n,x,I,j,C,k;return e.jsxs("div",{className:"group relative p-5 bg-white rounded-xl border border-gray-100 hover:border-blue-100 transition-all shadow-[0_3px_10px_rgba(0,0,0,0.02)] hover:shadow-[0_6px_20px_rgba(0,0,0,0.04)]",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-5",children:[e.jsxs("div",{className:"relative w-full md:w-32 h-32 bg-gray-50 rounded-lg overflow-hidden",children:[e.jsx("img",{src:(s==null?void 0:s.image)||os,alt:s.customId||"Product image",className:"w-full h-full object-contain p-3"}),e.jsxs("div",{className:"absolute top-2 right-2 bg-blue-600 text-white text-xs font-bold px-2.5 py-1 rounded-full shadow-sm",children:["×",s.quantity]})]}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-1.5",children:s.unitName}),e.jsxs("div",{className:"flex gap-2 items-center",children:[T&&e.jsx(p,{size:"sm",variant:"ghost",onClick:()=>{S(s._id),F(s),q(!0)},children:"Edit"}),qe&&e.jsx(p,{size:"sm",variant:"danger",isLoading:Ce,onClick:()=>Me(s._id),className:"text-white bg-red-600",children:"delete"}),e.jsxs("span",{className:"flex cursor-pointer gap-1 items-center px-3 py-1.5 text-sm font-medium text-blue-600 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors",children:[" Total Sub Items : ",e.jsx("span",{className:"",children:((t=s==null?void 0:s.subItems)==null?void 0:t.length)||0})]}),e.jsxs("button",{onClick:()=>ye(z===s._id?null:s._id),className:"flex cursor-pointer items-center gap-2 px-3 py-1.5 text-sm font-medium text-blue-600 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors",children:[e.jsxs("span",{className:"hidden sm:inline",children:[z===s._id?"Hide":"Show"," Sub Items"]}),e.jsx("i",{className:`fa ${z===s._id?"fa-chevron-up":"fa-chevron-down"} transition-transform`})]})]})]}),e.jsx("div",{className:"flex items-center gap-2 mb-3",children:e.jsx("span",{className:"px-2.5 py-1 bg-gray-100 text-gray-700 text-xs font-medium rounded-full",children:s.category||"Generic"})}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Unit Price"}),e.jsxs("p",{className:"font-medium",children:["₹",s.singleUnitCost.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Quantity"}),e.jsx("p",{className:"font-medium",children:s.quantity})]}),(s==null?void 0:s.dimention)&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Dimentions"}),e.jsxs("p",{className:"font-medium",children:["Height: ",((n=s==null?void 0:s.dimention)==null?void 0:n.height)||0,"mm"]}),e.jsxs("p",{className:"font-medium",children:["depth: ",((x=s==null?void 0:s.dimention)==null?void 0:x.depth)||0,"mm"]}),e.jsxs("p",{className:"font-medium",children:["width: ",((I=s==null?void 0:s.dimention)==null?void 0:I.width)||0,"mm"]})]})]})]}),e.jsx("div",{className:"mt-4 pt-3 border-t border-gray-100",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Item Total"}),e.jsxs("p",{className:"text-lg font-bold text-blue-600",children:["₹",(s.singleUnitCost*s.quantity).toFixed(2)]})]})})]})]}),z===s._id&&e.jsxs("div",{className:"mt-6 pt-4 border-t border-gray-200 bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("i",{className:"fa-solid fa-list text-blue-600"}),e.jsx("h4",{className:"font-semibold text-gray-800",children:"Sub Items"}),e.jsx("span",{className:"text-sm text-gray-500",children:"(Click to edit, changes save by clicking Enter)"})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"grid grid-cols-17 gap-0 bg-gray-100 border-b border-gray-200",children:[e.jsx("div",{className:"col-span-3 px-4 py-3 text-sm font-medium text-gray-700 border-r border-gray-200",children:"Ref ID"}),e.jsx("div",{className:"col-span-8 px-4 py-3 text-sm font-medium text-gray-700 border-r border-gray-200",children:"Material Name"}),e.jsx("div",{className:"col-span-2 px-4 py-3 text-sm font-medium text-gray-700 border-r border-gray-200",children:"Quantity"}),e.jsx("div",{className:"col-span-3 px-4 py-3 text-sm font-medium text-gray-700 border-r border-gray-200",children:"Unit"}),e.jsx("div",{className:"col-span-1 px-4 py-3 text-sm font-medium text-gray-700",children:"Action"})]}),s.subItems&&s.subItems.length>0&&s.subItems.map(r=>e.jsxs("div",{className:"grid grid-cols-17 gap-0 border-b border-gray-100 hover:bg-gray-50",children:[e.jsx("div",{className:"col-span-3 border-r border-gray-200",children:e.jsx("div",{className:"w-full px-4 py-3 border-none outline-none focus:bg-blue-50",children:(r==null?void 0:r.refId)||"N/A"})}),e.jsx("div",{className:"col-span-8 border-r border-gray-200",children:(c==null?void 0:c.subItemId)===r._id&&(c==null?void 0:c.field)==="name"?e.jsx("input",{ref:A,type:"text",defaultValue:r.subItemName,className:"w-full px-4 py-3 border-none outline-none focus:bg-blue-50",onBlur:l=>{M(s._id,r._id,"name",l.target.value),y(null)},onKeyDown:l=>{if(l.key==="Enter"){const D=l.target.value;M(s._id,r._id,"name",D),y(null)}l.key==="Escape"&&y(null)}}):e.jsx("div",{className:"px-4 py-3 cursor-pointer hover:bg-blue-50 transition-colors",onClick:()=>y({subItemId:r._id,field:"name"}),children:r.subItemName})}),e.jsx("div",{className:"col-span-2 border-r border-gray-200",children:(c==null?void 0:c.subItemId)===r._id&&(c==null?void 0:c.field)==="quantity"?e.jsx("input",{ref:A,type:"number",defaultValue:r.quantity,min:"0",className:"w-full px-4 py-3 border-none outline-none focus:bg-blue-50",onBlur:l=>{M(s._id,r._id,"quantity",l.target.value),y(null)},onKeyDown:l=>{l.key==="Enter"&&(M(s._id,r._id,"quantity",l.currentTarget.value),y(null)),l.key==="Escape"&&y(null)}}):e.jsx("div",{className:"px-4 py-3 cursor-pointer hover:bg-blue-50 transition-colors",onClick:()=>y({subItemId:r._id,field:"quantity"}),children:r.quantity})}),e.jsx("div",{className:"col-span-3 border-r border-gray-200",children:(c==null?void 0:c.subItemId)===r._id&&(c==null?void 0:c.field)==="unit"?e.jsx("div",{className:"p-2 relative z-50",children:e.jsxs("select",{defaultValue:r.unit,onChange:l=>{M(s._id,r._id,"unit",l.target.value),y(null)},className:"w-full relative z-[50] px-3 py-2 border border-gray-200 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-sm",children:[e.jsx("option",{value:"",disabled:!0,children:"Selected unit"}),je.map(l=>e.jsx("option",{value:l,children:l},l))]})}):e.jsx("div",{className:"px-4 py-3 cursor-pointer hover:bg-blue-50 transition-colors",onClick:()=>y({subItemId:r._id,field:"unit"}),children:r.unit})}),e.jsx("div",{className:"col-span-1 flex items-center justify-center",children:e.jsx(p,{variant:"danger",onClick:()=>Re(s._id,r._id),disabled:te,isLoading:te,className:"p-2 bg-red-600 text-white  hover:bg-red-50 rounded transition-colors disabled:opacity-50",title:"Delete item",children:e.jsx("i",{className:"fa fa-trash text-sm"})})})]},r._id)),e.jsxs("div",{className:"grid grid-cols-17 gap-0 bg-green-50 border-b border-gray-100",children:[e.jsx("div",{className:"col-span-3 border-r border-gray-200",children:e.jsx("div",{className:"w-full px-4 py-3 border-none outline-none focus:bg-blue-50",children:"Ref Id"})}),e.jsx("div",{className:"col-span-8 border-r border-gray-200",children:e.jsx("input",{type:"text",placeholder:"Enter matterial name...",value:((j=w[s._id])==null?void 0:j.name)||"",onChange:r=>{console.log("e.target name",w),B(l=>({...l,[s._id]:{...l[s._id],name:r.target.value}}))},onBlur:()=>{var r,l,D;(l=(r=w[s._id])==null?void 0:r.name)!=null&&l.trim()&&((D=w[s._id])!=null&&D.unit)&&W(s._id,w)},onKeyDown:r=>{r.key==="Enter"&&W(s._id,w)},className:"w-full px-4 py-3 bg-transparent border-none outline-none placeholder-gray-400"})}),e.jsx("div",{className:"col-span-2 border-r border-gray-200",children:e.jsx("input",{type:"number",placeholder:"Qty",min:"0",value:((C=w[s._id])==null?void 0:C.quantity)||1,onChange:r=>{console.log("e.target.value",w),B(l=>({...l,[s._id]:{...l[s._id],quantity:Number(r.target.value)||1}}))},className:"w-full px-4 py-3 bg-transparent border-none outline-none placeholder-gray-400"})}),e.jsx("div",{className:"col-span-3 border-r border-gray-200",children:e.jsx("div",{className:"p-2",children:e.jsxs("select",{value:((k=w[s._id])==null?void 0:k.unit)||"",onChange:async r=>{const l={...w[s._id],unit:r.target.value};B(D=>({...D,[s._id]:l})),await W(s._id,l)},className:"w-full relative z-[50] px-3 py-2 border border-gray-200 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-sm",children:[e.jsx("option",{value:"",children:"Selected unit"}),je.map(r=>e.jsx("option",{value:r,children:r},r))]})})})]}),(!s.subItems||s.subItems.length===0)&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("i",{className:"fa-solid fa-inbox text-2xl mb-2"}),e.jsx("p",{className:"text-sm",children:"No sub-items yet. Start typing in the row above to add items."})]})]})]})]},s._id||i)})}):e.jsxs("div",{className:"py-16 text-center",children:[e.jsx("div",{className:"mx-auto w-24 h-24 bg-blue-50 rounded-full flex items-center justify-center mb-5",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-blue-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})})}),e.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-2",children:"No Order History"}),e.jsx("p",{className:"text-gray-500 max-w-md mx-auto mb-6",children:"Your completed orders will appear here"})]})})]}),!O&&e.jsx("section",{className:"mt-4",children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"Export Order Material"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Generate a PDF document of your order materials"})]}),e.jsx(p,{onClick:ze,disabled:ee,className:"min-w-[140px] bg-blue-600 hover:bg-blue-700 text-white font-medium",size:"lg",children:ee?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-file-pdf"}),"Generate PDF"]})})]}),a!=null&&a.pdfLink&&((fe=a==null?void 0:a.pdfLink)==null?void 0:fe.length)>0?(be=a==null?void 0:a.pdfLink)==null?void 0:be.map(s=>e.jsx(Ye,{className:"border-green-200 bg-green-50",children:e.jsx(We,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx("i",{className:"fas fa-check-circle text-green-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-green-900 mb-1",children:s.pdfName}),e.jsxs("span",{className:"text-sm",children:["Pdf Reference Id: ",s.refUniquePdf||"N/A"]}),e.jsx("p",{className:"text-sm text-green-700",children:"Your order material PDF is ready to view or download"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full sm:w-auto",children:[e.jsxs(p,{variant:"outline",onClick:()=>window.open(s.url,"_blank"),className:"border-green-300 text-blue-700 hover:bg-blue-100 hover:border-blue-400",children:[e.jsx("i",{className:"fas mr-2 fa-external-link-alt"}),"View in New Tab"]}),e.jsx(p,{variant:"secondary",onClick:()=>cs({src:s.url,alt:"order material"}),className:"border-blue-300 text-blue-700 hover:bg-blue-100 hover:border-blue-400",children:"Download PDF"}),e.jsxs("div",{className:"relative  min-w-[160px]",children:[e.jsx("label",{htmlFor:`pdf-status-${s._id}`,className:"hidden md:block mb-1 text-sm font-medium text-gray-600 absolute top-[-20px]",children:"Order Status"}),e.jsx("select",{id:`pdf-status-${s._id}`,value:s.status||"pending",onChange:async i=>{const t=i.target.value;await Te(s._id,t)},className:`\r
                                                                                    w-full h-[45px] px-3 py-2 text-md  bg-white border  rounded-xl shadow \r
                                                                                    focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 \r
                                                                                    disabled:opacity-50 appearance-none transition ease-in-out\r
                                                                                    border-blue-300 text-blue-800  hover:border-blue-400\r
                                                                                    `,children:["pending","delivered","shipped","ordered","cancelled"].map(i=>e.jsx("option",{value:i,children:i.charAt(0).toUpperCase()+i.slice(1)},i))}),e.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-3 flex items-center text-gray-500",children:e.jsx("i",{className:"fas fa-chevron-down text-xs"})})]}),e.jsx(p,{variant:"danger",isLoading:Ee,onClick:()=>Be(s._id),className:"border-red-300 bg-red-600 text-white hover:bg-red-600 hover:border-red-400",children:"Delete PDF"})]})]})})},s._id)):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col items-center  justify-center min-h-[300px] w-full bg-white rounded-xl text-center p-6",children:[e.jsx("i",{className:"fa-solid fa-file-lines text-5xl text-blue-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-1",children:"No Pdf Found"}),e.jsx("p",{className:"text-sm text-gray-500",children:"No PDF Generated"})]})})]})})})]})};export{_s as default};
