import{u as te,a as ae,b as le,r as u,j as e}from"./index-BYTWf4fI.js";import{c as re,d as ie,e as oe,f as ne,g as ce}from"./cleaningStageApi-8pt1qBov.js";import{t as n}from"./toast-BSC5QTk1.js";import{B as i}from"./Button-aRmNljle.js";import{C as g}from"./Card-ClDlfbss.js";import de from"./MaterialOverviewLoading-DkmRHaSw.js";import{T as me}from"./TextArea-EPgSj1kU.js";import{I as ue}from"./Input-ChgExZu6.js";import{L as pe}from"./Label-BupV_v2u.js";import{d as xe}from"./downloadFile-DFN4JXcx.js";import{I as ge}from"./ImageGalleryMain-BTDqHC1K.js";import"./useQuery-DFVFWtWl.js";import"./useMutation-sTZCeqmg.js";import"./roleCheck-DhBlwT6t.js";import"./Skeleton-Bc8D3KPj.js";import"./constants-4IFJeChr.js";import"./index-CofIYY6b.js";function Ue(){var R,U,L,A,z,M,T,$,B;const{projectId:c,roomId:d,organizationId:G}=te(),O=ae(),{data:t,isLoading:W,refetch:p,isError:_,error:h}=re(c,d),{role:f,permission:r}=le(),C=f==="owner"||((R=r==null?void 0:r.cleaning)==null?void 0:R.delete),b=f==="owner"||((U=r==null?void 0:r.cleaning)==null?void 0:U.create),j=f==="owner"||((L=r==null?void 0:r.cleaning)==null?void 0:L.edit),[k,F]=u.useState(null),{mutateAsync:V,isPending:N}=ie(),{mutateAsync:q,isPending:S}=oe(),{mutateAsync:H,isPending:J}=ne(),{mutateAsync:K,isPending:E}=ce(),[x,Q]=u.useState((t==null?void 0:t.completelyCleaned)||!1),[v,y]=u.useState((t==null?void 0:t.notes)||""),[I,w]=u.useState(!1),[m,D]=u.useState(null),X=s=>{var l;(l=s.target.files)!=null&&l.length&&D(s.target.files)},Y=async()=>{var s,l;try{if(!m)throw new Error("select the files before uploading");const a=new FormData;for(let o=0;o<m.length;o++)a.append("files",m[o]);await V({projectId:c,roomId:d,formData:a}),n({title:"Success",description:"Files uploaded successfully."}),D(null),p()}catch(a){n({title:"Error",description:((l=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:l.message)||a.message,variant:"destructive"})}},P=async s=>{var l,a;try{await q({projectId:c,roomId:d,fileId:s}),n({title:"Deleted",description:"File deleted successfully."}),p()}catch(o){n({title:"Error",description:((a=(l=o==null?void 0:o.response)==null?void 0:l.data)==null?void 0:a.message)||o.message,variant:"destructive"})}},Z=async()=>{var s,l;try{if(!v.trim())throw new Error("please enter some notes");await K({projectId:c,roomId:d,notes:v}),n({title:"Notes updated!",description:"Room notes saved."}),w(!1)}catch(a){n({title:"Error",description:((l=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:l.message)||(a==null?void 0:a.message)||"Failed to update",variant:"destructive"})}},ee=async()=>{var s,l;try{await H({projectId:c,roomId:d,completelyCleaned:!x}),n({title:"Updated",description:`Marked as ${x?"not cleaned":"completely cleaned"}.`}),Q(!x),p()}catch(a){n({title:"Error",description:((l=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:l.message)||a.message,variant:"destructive"})}};if(W)return e.jsx(de,{});_&&((z=(A=h==null?void 0:h.response)==null?void 0:A.data)!=null&&z.message,i);const se=(M=(t==null?void 0:t.uploads)||[])==null?void 0:M.filter(s=>s.type==="image");return e.jsxs("div",{className:"w-full h-full max-h-full overflow-y-auto custom-scrollbar-none sm:custom-scrollbar",children:[e.jsxs("div",{className:"mb-4 flex justify-between items-center w-full",children:[e.jsxs("h2",{className:"text-md sm:text-2xl font-semibold mb-4 text-blue-700 flex items-center",children:[e.jsx("i",{className:"fas fa-broom mr-2"})," ",t==null?void 0:t.roomName," - Details"]}),e.jsxs("div",{className:"flex gap-1 items-center",children:[(b||j)&&e.jsx(i,{isLoading:J,onClick:ee,className:"bg-blue-600 hover:bg-blue-700 text-white text-sm !p-2 lg:p-4 ",children:x?"Mark as Not Cleaned":"Mark as Cleaned"}),e.jsx(i,{variant:"primary",className:"",onClick:()=>O(`/${G}/projectdetails/${c}/cleaning`),children:"Go Back"})]})]}),e.jsxs("div",{className:"mb-2 grid grid-cols-1 md:grid-cols-2 gap-1 items-center place-content-center",children:[e.jsxs(g,{className:"p-2 border-gray-100 border-2",children:[e.jsxs("div",{className:"w-full justify-between flex items-center",children:[e.jsx("h3",{className:"text-md font-semibold  text-blue-700",children:"Notes"}),!I&&(b||j)&&e.jsxs(i,{onClick:()=>{y(t==null?void 0:t.notes),w(!0)},className:"bg-blue-600 text-white hover:bg-blue-700",children:["Edit ",e.jsx("i",{className:"fas fa-pencil ml-2 "})]})]}),I?e.jsxs(e.Fragment,{children:[e.jsx(me,{rows:4,className:"w-full border rounded p-2",value:v,onChange:s=>y(s.target.value),placeholder:"Enter notes here..."}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx(i,{onClick:Z,disabled:E,className:"bg-blue-600 text-white hover:bg-blue-700",children:E?"Saving...":"Save"}),e.jsx(i,{onClick:()=>{w(!1),y((t==null?void 0:t.notes)??"")},variant:"outline",className:"border-gray-400",children:"Cancel"})]})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"relative overflow-x-auto overflow-y-auto break-words h-[6rem] max-h-[6rem] leading-5 custom-scrollbar",children:[" ",e.jsx("p",{className:"text-gray-700 mb-2 ",children:(T=t==null?void 0:t.notes)!=null&&T.trim()?t==null?void 0:t.notes:"No notes present."})]})})]}),(b||j)&&e.jsxs(g,{className:"p-2 h-full border-gray-100 border-2",children:[e.jsx(pe,{className:"block mb-2 font-semibold !text-blue-700",children:"Upload Images or PDFs:"}),e.jsx(ue,{type:"file",multiple:!0,accept:"image/*,application/pdf",onChange:X,disabled:N,className:"border-b w-full"}),e.jsx(i,{onClick:Y,isLoading:N,className:"mt-3 bg-blue-600 text-white hover:bg-blue-700",children:N?"Uploading...":`Upload ${m?m.length:""} file(s)`})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 h-[95%] sm:h-[65%]",children:[e.jsxs(g,{className:"p-2 lg:p-4 max-h-full overflow-y-auto custom-scrollbar border-1 border-[#8485887a]",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3 text-blue-700",children:"Images"}),(($=t==null?void 0:t.uploads)==null?void 0:$.filter(s=>s.type==="image").length)===0?e.jsx("p",{className:"text-gray-400 text-sm",children:"No images uploaded."}):e.jsx(ge,{imageFiles:se,...C?{handleDeleteFile:P}:{},height:80,minWidth:98,maxWidth:100})]}),e.jsxs(g,{className:"p-4 max-h-full overflow-y-auto border-1 border-[#8485887a] custom-scrollbar",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3 text-blue-700",children:"PDFs"}),((B=t.uploads)==null?void 0:B.filter(s=>s.type==="pdf").length)===0?e.jsx("p",{className:"text-gray-400 text-sm",children:"No PDFs uploaded."}):e.jsx("ul",{className:"space-y-2",children:t==null?void 0:t.uploads.filter(s=>s.type==="pdf").map(s=>e.jsxs("li",{className:"flex items-center justify-between shadow-md p-2 rounded h-full",children:[e.jsx("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 underline truncate max-w-[50%]",children:s.originalName}),e.jsxs("div",{className:"space-x-1",children:[e.jsx(i,{size:"sm",variant:"primary",onClick:()=>xe({src:s==null?void 0:s.url,alt:(s==null?void 0:s.originalName)||"file.pdf"}),children:e.jsx("i",{className:"fa-solid fa-download"})}),C&&e.jsx(i,{size:"sm",isLoading:S,onClick:()=>P(s._id),disabled:S,variant:"danger",className:"bg-red-600 text-white rounded px-2 py-1 text-xs",children:e.jsx("i",{className:"fas fa-trash-can"})})]})]},s.url))})]})]}),k&&e.jsx("div",{onClick:()=>F(null),className:"fixed inset-0 z-50 bg-black/70 bg-opacity-60 flex items-center justify-center",children:e.jsxs("div",{onClick:s=>s.stopPropagation(),className:"relative bg-white rounded py-8 px-4 max-w-[90vw] max-h-[80vh] shadow-lg",children:[e.jsx("i",{className:"fas fa-times absolute top-2 right-3 text-xl text-gray-700 hover:text-red-500 cursor-pointer",onClick:()=>F(null)}),e.jsx("img",{src:k,alt:"Full View",className:"max-h-[70vh] w-auto object-contain rounded"})]})})]})}export{Ue as default};
