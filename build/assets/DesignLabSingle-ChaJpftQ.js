import{a as D,j as d}from"./index-By5P0A7l.js";import{a as L,b as N}from"./designLabApi-DK9OL9c3.js";import{D as w}from"./DesignLabForm-8hE0ETVt.js";import{t as f}from"./toast-BSC5QTk1.js";import"./useQuery-Cc7pLKfK.js";import"./useMutation-7YLqc7VE.js";import"./useInfiniteQuery-DQF0m-E9.js";import"./roleCheck-YGaMnK_P.js";import"./Button-DLUK8O0t.js";const z=()=>{const{id:l}=D(),{data:r,isLoading:g,isError:h}=L(l),{mutateAsync:x,isPending:b}=N(),F=async s=>{var c,m;try{const i=new FormData,o=[],p=[],u=s.components.map(e=>({...e,materials:e.materials.filter(t=>{var a;return((a=t.materialName)==null?void 0:a.trim())||t.rate!==""&&t.rate!==0||t.image||t.tempFile})})),E=s.sequenceOfOperations.filter(e=>{var t;return(t=e.description)==null?void 0:t.trim()}).map((e,t)=>({...e,stepNumber:t+1})),y=s.referenceImages.filter(e=>!e.url.startsWith("blob:"));s.newRefFiles.forEach(e=>{p.push(e),o.push({target:"reference"})}),u.forEach((e,t)=>{e.materials.forEach((a,I)=>{a.tempFile&&(p.push(a.tempFile),o.push({target:"material",componentIndex:t,materialIndex:I}),a.image=null,delete a.tempFile)})});const n={...s,referenceImages:y,components:u,sequenceOfOperations:E};delete n.newRefFiles,delete n._id,delete n.createdAt,delete n.updatedAt,i.append("data",JSON.stringify(n)),i.append("fileMapping",JSON.stringify(o)),p.forEach(e=>{i.append("files",e)}),await x({id:l,formData:i}),f({title:"Success",description:"Design updated successfully"})}catch(i){console.error("Update Error:",i),f({title:"Error",description:((m=(c=i==null?void 0:i.response)==null?void 0:c.data)==null?void 0:m.message)||"Failed to update design",variant:"destructive"})}};return g?d.jsx("div",{className:"p-10 text-center",children:"Loading Design..."}):h?d.jsx("div",{className:"p-10 text-center text-red-500",children:"Error loading design"}):d.jsx(w,{mode:"edit",organizationId:r==null?void 0:r.organizationId,initialData:r,onSubmit:F,isLoading:b})};export{z as default};
