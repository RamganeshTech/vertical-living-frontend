import{k as X,r as m,j as e,c as ms,b as us}from"./index-DcYk0AxP.js";import{c as hs,d as gs,e as ps,f as xs,g as fs,h as js,i as vs,j as Ns,k as bs,l as ys,m as ws,n as ks}from"./workScheduleApi-CXL3-CKb.js";import{B as y}from"./Button-BYLj5R3i.js";import{I as A}from"./Input-BKq6F5N4.js";import{T as Fe}from"./TextArea-O-cEJUsh.js";import{L as F}from"./Label-BhS8IB-_.js";import{C as q,a as Q,b as Z,c as ee}from"./Card-t18AqWaO.js";import{S as Me,a as Oe,b as Le,c as De,d as de}from"./Select-DP4uw-YS.js";import{t as w}from"./toast-BSC5QTk1.js";import{d as Cs}from"./downloadFile-BkM6wezt.js";import{N as Ss}from"./constants-B8VJ7ujN.js";import"./roleCheck-D-Yu12LV.js";import"./useQuery-BPoeBSke.js";import"./useBaseQuery-D96Ix8rH.js";import"./useMutation-BbhnaANP.js";const Is=()=>{var P;const p=X(C=>C.authStore),_=X(C=>C.userProfileStore),k=X(C=>C.staffProfileStore),r=X(C=>C.CTOProfileStore),R=X(C=>C.workerProfileStore),h=X(C=>C.clientProfileStore);if(!p.isauthenticated)return null;switch((P=p.role)==null?void 0:P.toLowerCase()){case"owner":return{id:(_==null?void 0:_.userId)||p._id,name:(_==null?void 0:_.userName)||""};case"staff":return{id:(k==null?void 0:k.staffId)||p._id,name:(k==null?void 0:k.staffName)||""};case"cto":return{id:(r==null?void 0:r.CTOId)||p._id,name:(r==null?void 0:r.CTOName)||""};case"worker":return{id:(R==null?void 0:R.workerId)||p._id,name:(R==null?void 0:R.workerName)||""};case"client":return{id:(h==null?void 0:h.clientId)||p._id,name:(h==null?void 0:h.clientName)||""};default:return null}},Ts=({projectId:p,isOpen:_,onClose:k,editData:r,onSave:R,onUpdate:h,scheduleId:P=null,refetch:C})=>{const W=m.useRef(null),$=m.useRef(null),j=Is(),{data:d}=hs(p),[S,O]=m.useState({name:"",url:""}),[se,me]=m.useState({name:"",url:""}),[E,ue]=m.useState(null),[I,he]=m.useState(null),[ae,z]=m.useState(50),[fe,te]=m.useState(!1),ge=new Date().toISOString().split("T")[0],V=s=>{const t=xe=>String(xe).padStart(2,"0"),a=s.getFullYear(),n=t(s.getMonth()+1),i=t(s.getDate()),v=t(s.getHours()),U=t(s.getMinutes());return`${a}-${n}-${i}T${v}:${U}`},[c,T]=m.useState({projectAssignee:{projectName:"",siteAddress:"",designReferenceId:"",carpenterName:"",supervisorName:(j==null?void 0:j.name)||"",plannedStartDate:ge},dailyTasks:[{datePlanned:"",room:"",workDescription:"",startTime:"",endTime:"",materialsNeeded:[],manpower:0,status:"planned",uploadedImages:[]}],designPlanImages:[],siteImages:[],supervisorCheck:{reviewerName:(j==null?void 0:j.name)||"",reviewerId:(j==null?void 0:j.id)||"",reviewDateTime:V(new Date),status:"needs_changes",remarks:"",gatekeeping:"block"}}),[J,re]=m.useState(!1),[L,pe]=m.useState([]),[le,D]=m.useState([]);m.useEffect(()=>{var s,t,a,n,i,v,U,xe,Ae,Pe,Ee,Re,_e;if(!(!d&&!r)){if(T({projectAssignee:{projectName:((s=r==null?void 0:r.projectAssignee)==null?void 0:s.projectName)||(d==null?void 0:d.projectName)||"",siteAddress:((t=r==null?void 0:r.projectAssignee)==null?void 0:t.siteAddress)||(d==null?void 0:d.siteAddress)||"",designReferenceId:((a=r==null?void 0:r.projectAssignee)==null?void 0:a.designReferenceId)||(d==null?void 0:d.designReferenceId)||"",carpenterName:((n=r==null?void 0:r.projectAssignee)==null?void 0:n.carpenterName)||"",supervisorName:((i=r==null?void 0:r.projectAssignee)==null?void 0:i.supervisorName)||(j==null?void 0:j.name)||"",plannedStartDate:((v=r==null?void 0:r.projectAssignee)==null?void 0:v.plannedStartDate)||ge},dailyTasks:((U=r==null?void 0:r.dailyTasks)==null?void 0:U.map(oe=>({...oe,uploadedImages:oe.uploadedImages||[]})))||[{datePlanned:"",room:"",workDescription:"",startTime:"",endTime:"",materialsNeeded:[],manpower:0,status:"planned",uploadedImages:[]}],designPlanImages:(r==null?void 0:r.designPlanImages)||[],siteImages:(r==null?void 0:r.siteImages)||[],supervisorCheck:{reviewerName:((xe=r==null?void 0:r.supervisorCheck)==null?void 0:xe.reviewerName)||(j==null?void 0:j.name)||"",reviewerId:((Ae=r==null?void 0:r.supervisorCheck)==null?void 0:Ae.reviewerId)||(j==null?void 0:j.id)||"",reviewDateTime:((Pe=r==null?void 0:r.supervisorCheck)==null?void 0:Pe.reviewDateTime)||V(new Date),status:((Ee=r==null?void 0:r.supervisorCheck)==null?void 0:Ee.status)||"needs_changes",remarks:((Re=r==null?void 0:r.supervisorCheck)==null?void 0:Re.remarks)||"",gatekeeping:((_e=r==null?void 0:r.supervisorCheck)==null?void 0:_e.gatekeeping)||"block"}}),r!=null&&r.dailyTasks){const oe={};r.dailyTasks.forEach((Ne,ds)=>{Ne.materialsNeeded&&Ne.materialsNeeded.length>0&&(oe[ds]=Ne.materialsNeeded.join(", "))}),M(oe)}r!=null&&r.workComparison?D(r.workComparison):D([])}},[d,r]);const[ne,ie]=m.useState([]),[G,ce]=m.useState([]),l=gs(),o=ps(),{mutateAsync:u,isPending:x}=xs(),g=(s,t)=>{T(a=>({...a,projectAssignee:{...a.projectAssignee,[s]:t}}))},N=s=>s?new Date(s).toISOString().split("T")[0]:"",f=(s,t,a)=>{T(n=>({...n,dailyTasks:n.dailyTasks.map((i,v)=>v===s?{...i,[t]:a}:i)}))},[b,M]=m.useState({}),K=(s,t)=>{M(a=>({...a,[s]:t})),T(a=>({...a,dailyTasks:a.dailyTasks.map((n,i)=>i===s?{...n,materialsNeeded:t.split(",").map(v=>v.trim()).filter(v=>v)}:n)}))},H=()=>{T(s=>({...s,dailyTasks:[...s.dailyTasks,{datePlanned:"",room:"",workDescription:"",startTime:"",endTime:"",materialsNeeded:[],manpower:0,status:"planned",uploadedImages:[]}]}))},Y=()=>{T(s=>({...s,dailyTasks:[{datePlanned:"",room:"",workDescription:"",startTime:"",endTime:"",materialsNeeded:[],manpower:0,status:"planned",uploadedImages:[]}]}))},je=s=>{T(t=>({...t,dailyTasks:t.dailyTasks.filter((a,n)=>n!==s)}))},B=(s,t)=>{T(a=>({...a,supervisorCheck:{...a.supervisorCheck,[s]:t}}))},Ue=async()=>{var s,t;try{if(r){const a=new FormData;a.append("projectAssignee",JSON.stringify(c.projectAssignee)),a.append("dailyTasks",JSON.stringify(c.dailyTasks)),a.append("supervisorCheck",JSON.stringify(c.supervisorCheck)),I&&a.append("actualImage",I),E&&a.append("plannedImage",E),ne.forEach(n=>a.append("designPlanImages",n)),G.forEach(n=>a.append("siteImages",n)),await o.mutateAsync({projectId:p,scheduleId:r._id,formData:a}),h==null||h(c),w({title:"Success",description:"updated successfully"})}else{const a=new FormData;a.append("projectAssignee",JSON.stringify(c.projectAssignee)),a.append("dailyTasks",JSON.stringify(c.dailyTasks)),a.append("supervisorCheck",JSON.stringify(c.supervisorCheck)),I&&a.append("actualImage",I),E&&a.append("plannedImage",E),ne.forEach(n=>a.append("designPlanImages",n)),G.forEach(n=>a.append("siteImages",n)),console.log("first enteirng i"),await l.mutateAsync({projectId:p,formData:a}),C(),R==null||R(c),w({title:"Success",description:"Created successfully"})}k()}catch(a){console.error("Error saving work schedule:",a),w({title:"Error",description:((t=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:t.message)||"something went wrong",variant:"destructive"})}},We=async()=>{var s,t;try{const a=new FormData;a.append("projectAssignee",JSON.stringify(c.projectAssignee)),a.append("dailyTasks",JSON.stringify(c.dailyTasks)),a.append("supervisorCheck",JSON.stringify(c.supervisorCheck)),I&&a.append("actualImage",I),E&&a.append("plannedImage",E),ne.forEach(i=>a.append("designPlanImages",i)),G.forEach(i=>a.append("siteImages",i));let n;r?n=await u({projectId:p,scheduleId:P,formData:a}):n=await u({projectId:p,formData:a}),Cs({src:n.downloadUrl,alt:n.fileName}),w({description:"Pdf Generated successfully",title:"Success"})}catch(a){w({title:"Error",description:((t=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to generate Pdf",variant:"destructive"})}},be=(s,t)=>{if(!s)return;const a=Array.from(s);if(t==="design"){const n=a.map(i=>({file:i,url:URL.createObjectURL(i)}));T(i=>({...i,designPlanImages:[...i.designPlanImages,...n]})),ie(i=>[...i,...a])}else if(t==="site"){const n=a.map(i=>({file:i,url:URL.createObjectURL(i)}));T(i=>({...i,siteImages:[...i.siteImages,...n]})),ce(i=>[...i,...a])}},ye=(s,t)=>{t==="design"?(T(a=>({...a,designPlanImages:a.designPlanImages.filter((n,i)=>i!==s)})),ie(a=>a.filter((n,i)=>i!==s))):t==="site"&&(T(a=>({...a,siteImages:a.siteImages.filter((n,i)=>i!==s)})),ce(a=>a.filter((n,i)=>i!==s)))},$e=()=>{const s=JSON.stringify(c,null,2),t=new Blob([s],{type:"application/json"}),a=URL.createObjectURL(t),n=document.createElement("a");n.href=a,n.download=`work-schedule-${Date.now()}.json`,n.click(),URL.revokeObjectURL(a)},ze=s=>{var n;const t=(n=s.target.files)==null?void 0:n[0];if(!t)return;const a=new FileReader;a.onload=i=>{var v;try{const U=JSON.parse((v=i.target)==null?void 0:v.result);T(U)}catch(U){console.error("Error importing JSON:",U)}},a.readAsText(t)},[Je,we]=m.useState(null),[Be,ke]=m.useState(null),[ve,Ce]=m.useState({}),{mutateAsync:Ve,isPending:Se}=fs(),{mutateAsync:Ge,isPending:Ke}=js(),{mutateAsync:He,isPending:Ye}=vs(),{mutateAsync:Xe}=Ns(),qe=s=>{J&&pe(t=>t.includes(s)?t.filter(a=>a!==s):[...t,s])},Qe=async()=>{var s,t;try{if(L.length===0)return;const a=L.map(i=>({...i})),n=await Ve({projectId:p,scheduleId:P,formData:a});D(i=>[...i,n]),w({description:"Pdf Generated successfully",title:"Success"})}catch(a){w({title:"Error",description:((t=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to generate Pdf",variant:"destructive"})}},Ze=async(s,t)=>{if(!s||s.length===0)return;const a=new FormData;Array.from(s).forEach(n=>{a.append("files",n)});try{const n=await Ge({projectId:p,scheduleId:P,comparisonId:t,formData:a});D(n)}catch{w({title:"Error",description:"Failed to upload corrected images",variant:"destructive"})}},es=async(s,t)=>{try{const a=await He({projectId:p,scheduleId:P,comparisonId:s,imageId:t});D(a),w({title:"Success",description:"Corrected image deleted successfully"})}catch(a){console.error("Failed to delete corrected image:",a),w({title:"Error",description:(a==null?void 0:a.message)||"Failed to delete corrected image",variant:"destructive"})}},ss=(s,t)=>{Ce(a=>({...a,[s]:t}))},Ie=async(s,t,a)=>{try{const n=await Xe({projectId:p,scheduleId:P,comparisonId:s,selectedImageId:t,data:{comment:a}});D(n),ke(""),w({title:"Success",description:"Comment updated successfully"})}catch(n){console.error("Failed to update comment:",n),w({title:"Error",description:(n==null?void 0:n.message)||"Failed to update comment",variant:"destructive"})}},as=s=>{const t=s.target.files[0];t&&(O({name:t.name,url:URL.createObjectURL(t)}),ue(t))},ts=s=>{const t=s.target.files[0];t&&(me({name:t.name,url:URL.createObjectURL(t)}),he(t))},rs=s=>{te(!0),s.preventDefault()},ls=s=>{if(!fe)return;const t=s.currentTarget.getBoundingClientRect(),a=s.clientX-t.left,n=Math.max(0,Math.min(100,a/t.width*100));z(n)},Te=()=>{te(!1)},ns=()=>{z(50)},is=()=>{O({name:"",url:""}),ue(null)},cs=()=>{me({name:"",url:""}),he(null)},os=s=>{const t=c.dailyTasks.find((a,n)=>s===n);return(t==null?void 0:t.status)||"planned"};return _?e.jsx("div",{onClick:k,className:"fixed inset-0 bg-black/70 bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{onClick:s=>s.stopPropagation(),className:"bg-white rounded-lg max-w-7xl max-h-[90vh] overflow-y-auto w-full mx-4",children:[e.jsx("div",{className:"bg-blue-600 text-white p-4 rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Vertical Living — Carpenter Work Schedule & Visual Approval"}),e.jsx("p",{className:"text-sm opacity-90",children:"RAMS TECH CIRCLE OPC Pvt. Ltd. • No. 22, 13th Main Road, Anna Nagar West, Chennai - 600040 • WhatsApp: +91 93639 93814"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(y,{variant:"secondary",size:"sm",onClick:Ue,children:"Save"}),e.jsx(y,{variant:"secondary",size:"sm",onClick:$e,children:"Export JSON"}),e.jsx("input",{id:"json-import",type:"file",accept:".json",className:"hidden",onChange:ze}),e.jsx(y,{variant:"secondary",size:"sm",onClick:()=>{var s;return(s=document.getElementById("json-import"))==null?void 0:s.click()},children:"Import JSON"}),e.jsx(y,{variant:"secondary",isLoading:x,onClick:We,size:"sm",children:"Print / PDF"}),e.jsx(y,{variant:"secondary",size:"sm",onClick:k,children:e.jsx("i",{className:"fas fa-times"})})]})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs(q,{children:[e.jsx(Q,{children:e.jsxs(Z,{className:"flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-file-text"}),"Project & Assignee",e.jsx(y,{variant:"link",size:"sm",className:"ml-auto text-blue-600",children:"Single sheet for multiple days"})]})}),e.jsx(ee,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(F,{htmlFor:"projectName",children:"Project Name"}),e.jsx(A,{id:"projectName",placeholder:"e.g., Shankar Residence — Wardrobe & TV Unit",value:c.projectAssignee.projectName,onChange:s=>g("projectName",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"siteAddress",children:"Site Address"}),e.jsx(A,{id:"siteAddress",placeholder:"Full address",value:c.projectAssignee.siteAddress,onChange:s=>g("siteAddress",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"designReferenceId",children:"Design Reference ID"}),e.jsx(A,{id:"designReferenceId",placeholder:"e.g., VL-KTN-2025-001",value:c.projectAssignee.designReferenceId,onChange:s=>g("designReferenceId",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"carpenterName",children:"Carpenter Name"}),e.jsx(A,{id:"carpenterName",placeholder:"Assigned carpenter",value:c.projectAssignee.carpenterName,onChange:s=>g("carpenterName",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"supervisorName",children:"Supervisor Name"}),e.jsx(A,{id:"supervisorName",placeholder:"Site supervisor",value:c.projectAssignee.supervisorName,onChange:s=>g("supervisorName",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"plannedStartDate",children:"Planned Start Date"}),e.jsx(A,{id:"plannedStartDate",type:"date",value:c.projectAssignee.plannedStartDate,onChange:s=>g("plannedStartDate",s.target.value)})]})]})})]}),e.jsxs(q,{children:[e.jsx(Q,{children:e.jsxs(Z,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-calendar-days"}),"Daily Work Schedule"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(y,{variant:"outline",size:"sm",onClick:H,children:[e.jsx("i",{className:"fas fa-plus mr-1"}),"Add Task"]}),e.jsx(y,{variant:"outline",onClick:Y,size:"sm",children:"Clear"})]})]})}),e.jsx(ee,{children:e.jsx("div",{className:"h-fit border overflow-y-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100",children:[e.jsx("th",{className:"border p-2 text-center",children:"DATE"}),e.jsx("th",{className:"border p-2 text-center",children:"ROOM / UNIT"}),e.jsx("th",{className:"border p-2 text-center",children:"WORK DESCRIPTION"}),e.jsx("th",{className:"border p-2 text-center",children:"START"}),e.jsx("th",{className:"border p-2 text-center",children:"END"}),e.jsx("th",{className:"border p-2 text-center",children:"MATERIALS NEEDED"}),e.jsx("th",{className:"border p-2 text-center",children:"MANPOWER"}),e.jsx("th",{className:"border p-2 text-center",children:"STATUS"}),e.jsx("th",{className:"border p-2 text-center",children:"ACTIONS"})]})}),e.jsx("tbody",{className:"",children:c.dailyTasks.map((s,t)=>e.jsxs("tr",{children:[e.jsx("td",{className:"border p-2",children:e.jsx(A,{type:"date",value:N(s.datePlanned),onChange:a=>f(t,"datePlanned",a.target.value)})}),e.jsx("td",{className:"border p-2",children:e.jsx(A,{placeholder:"Kitchen",value:s.room,onChange:a=>f(t,"room",a.target.value)})}),e.jsx("td",{className:"border p-2",children:e.jsx(Fe,{placeholder:"Base unit carcass fixing & levelling",value:s.workDescription,onChange:a=>f(t,"workDescription",a.target.value),rows:2})}),e.jsx("td",{className:"border p-2",children:e.jsx(A,{type:"time",value:s.startTime,onChange:a=>f(t,"startTime",a.target.value)})}),e.jsx("td",{className:"border p-2",children:e.jsx(A,{type:"time",value:s.endTime,onChange:a=>f(t,"endTime",a.target.value)})}),e.jsx("td",{className:"border p-2",children:e.jsx(A,{placeholder:"Plywood, laminate, screws",value:b[t]??"",onChange:a=>K(t,a.target.value)})}),e.jsx("td",{className:"border p-2",children:e.jsx(A,{type:"number",placeholder:"No of workers",value:s.manpower,onChange:a=>f(t,"manpower",Number.parseInt(a.target.value)||0)})}),e.jsx("td",{className:"border p-2",children:e.jsxs(Me,{value:s.status,onValueChange:a=>f(t,"status",a),children:[e.jsx(Oe,{children:e.jsx(Le,{selectedValue:os(t)})}),e.jsxs(De,{children:[e.jsx(de,{value:"planned",children:"Planned"}),e.jsx(de,{value:"in-progress",children:"In Progress"}),e.jsx(de,{value:"completed",children:"Completed"})]})]})}),e.jsx("td",{className:"border p-2",children:e.jsx("div",{className:"flex gap-1",children:e.jsx(y,{variant:"danger",size:"sm",onClick:()=>je(t),children:e.jsx("i",{className:"fas fa-trash"})})})})]},t))})]})})})]}),e.jsxs(q,{className:"",children:[e.jsx(Q,{children:e.jsxs(Z,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Laminate/Design/Plan Images — for Explanation"}),e.jsx(y,{variant:"outline",size:"sm",className:"text-blue-600 bg-transparent",children:"Upload reference plans, markups, sketches"})]})}),e.jsxs(ee,{children:[e.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center cursor-pointer hover:border-gray-400 transition-colors",onClick:()=>{var s;return(s=W.current)==null?void 0:s.click()},children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-lg font-medium",children:"Drag & drop plan/reference images here or"}),e.jsx(y,{variant:"outline",children:"Browse"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Accepted: JPG/PNG/WebP • Images auto-saved locally"})]})}),e.jsx("input",{ref:W,type:"file",multiple:!0,accept:"image/*",className:"hidden",onChange:s=>be(s.target.files,"design")}),c.designPlanImages.length>0&&e.jsx("div",{className:"mt-4",children:e.jsx("div",{className:"flex flex-wrap gap-4 mt-4",children:c.designPlanImages.map((s,t)=>e.jsxs("div",{className:"relative group w-32 h-32",children:[e.jsx("img",{src:s.url||"",alt:s.originalName||`Image ${t+1}`,className:"w-full h-full object-cover rounded-lg border shadow-sm"}),!s._id&&e.jsx("button",{type:"button",onClick:()=>ye(t,"design"),className:"absolute top-1 right-1 bg-red-600 text-white rounded-full w-6 h-6 flex items-center justify-center opacity-0 group-hover:opacity-100 hover:bg-red-700 transition-opacity",children:"×"})]},t))})})]})]}),e.jsxs(q,{children:[e.jsx(Q,{children:e.jsxs(Z,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Site / Actual Images — for Visual Confirmation"}),e.jsx(y,{variant:"outline",size:"sm",className:"text-blue-600 bg-transparent",children:"Upload daily progress photos"})]})}),e.jsxs(ee,{children:[e.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center cursor-pointer hover:border-gray-400 transition-colors",onClick:()=>{var s;return(s=$.current)==null?void 0:s.click()},children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-lg font-medium",children:"Drag & drop site/progress images here or"}),e.jsx(y,{variant:"outline",children:"Browse"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Tip: Upload clear, well-lit photos with unit labels in frame"})]})}),e.jsx("input",{ref:$,type:"file",multiple:!0,accept:"image/*",className:"hidden",onChange:s=>be(s.target.files,"site")}),e.jsx("div",{children:e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("input",{type:"checkbox",id:"correctionMode",checked:J,onChange:s=>{re(s.target.checked),s.target.checked||pe([])}}),e.jsx("label",{htmlFor:"correctionMode",className:"text-sm font-medium",children:"Select images for correction"}),J&&e.jsx(y,{size:"sm",className:"bg-green-600 text-white",disabled:L.length===0||Se,onClick:Qe,children:Se?"Uploading...":"Upload Selected"})]})}),c.siteImages.length>0&&e.jsx("div",{className:"mt-4",children:e.jsx("div",{className:"flex flex-wrap gap-4 mt-4",children:c.siteImages.map((s,t)=>{const a=L.includes(s);return e.jsxs("div",{className:"relative group w-32 h-32",children:[e.jsx("img",{onClick:()=>qe(s),src:s.url||"",alt:s.originalName||`Image ${t+1}`,className:"w-full h-full object-cover rounded-lg border shadow-sm"}),a&&e.jsx("i",{className:"fa fa-check absolute top-1 right-1 text-green-600 bg-white rounded-full p-1 shadow-md"}),!J&&e.jsx("button",{type:"button",onClick:()=>ye(t,"site"),className:"absolute top-1 right-1 bg-red-600 text-white rounded-full w-6 h-6 flex items-center justify-center opacity-0 group-hover:opacity-100 hover:bg-red-700 transition-opacity",children:"×"})]},t)})})})]})]}),e.jsxs(q,{children:[e.jsx(Q,{children:e.jsx(Z,{className:"",children:"Correction Section"})}),e.jsx(ee,{children:le&&le.length>0?e.jsx(e.Fragment,{children:le.map((s,t)=>e.jsx("div",{className:" border-b pb-6 last:border-b-0",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[e.jsxs("div",{className:"md:w-1/2 w-full",children:[e.jsxs("h3",{className:"text-md font-semibold mb-2",children:["Stage ",t+1,": Selected Images for Correction"]}),s.selectImage&&s.selectImage.length>0?e.jsx("div",{className:"flex flex-wrap gap-4",children:s.selectImage.map((a,n)=>{var i;return e.jsxs("div",{className:"w-32 sm:w-36 flex-shrink-0",children:[e.jsx("div",{className:"w-full h-32 sm:h-36 border rounded-lg overflow-hidden shadow-sm mb-2",children:e.jsx("img",{src:((i=a==null?void 0:a.plannedImage)==null?void 0:i.url)||"",alt:`Selected ${n+1}`,className:"w-full h-full object-cover rounded-lg"})}),e.jsx("div",{className:"text-sm border border-gray-200 rounded px-2 py-1 bg-gray-50 max-h-40 overflow-y-auto custom-scrollbar",onMouseEnter:()=>we(a._id),onMouseLeave:()=>we(null),children:Be===a._id?e.jsx(A,{autoFocus:!0,value:ve[a._id]||"",onChange:v=>ss(a._id,v.target.value),onBlur:()=>Ie(s._id,a._id,ve[a._id]||""),onKeyDown:v=>{v.key==="Enter"&&(v.preventDefault(),Ie(s._id,a._id,ve[a._id]||""))},className:"text-sm w-full border p-1 rounded resize-none"}):e.jsx("div",{onClick:()=>{ke(a._id),Ce(v=>({...v,[a._id]:a.comment}))},className:"cursor-pointer break-words hover:bg-gray-100 p-1 rounded",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("i",{className:"fas fa-comment text-gray-500 mt-1"}),e.jsx("p",{className:"whitespace-pre-wrap break-words text-gray-800 text-sm",children:a.comment||e.jsx("span",{className:"italic text-gray-500",children:"Add a comment"})}),Je===a._id&&e.jsx("i",{className:"fas fa-pen ml-auto text-gray-400 text-xs mt-1"})]})})})]},a._id||n)})}):e.jsx("div",{className:"text-sm text-gray-500",children:"No selected images available for this comparison."})]}),e.jsx("div",{className:"md:w-1/2 w-full flex flex-col justify-between",children:e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"text-sm font-medium block mb-2",children:["Upload Refactored Images (Stage ",t+1,")"]}),e.jsx("input",{type:"file",multiple:!0,accept:"image/*",className:"border-2 border-dashed rounded-md p-2 w-full text-sm text-gray-600",onChange:a=>Ze(a.target.files,s._id)}),Ke&&e.jsx("span",{className:"ml-2 text-gray-600 animate-spin",children:e.jsx("i",{className:"fas fa-spinner animate-spin"})})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-md font-semibold mb-2",children:["Stage ",t+1,": Refactored Outputs"]}),s.correctedImages&&s.correctedImages.length>0?e.jsx("div",{className:"flex flex-wrap gap-4",children:s.correctedImages.map((a,n)=>e.jsxs("div",{className:"relative group w-32 h-32 sm:w-36 sm:h-36 border rounded-lg shadow-sm overflow-hidden",children:[e.jsx("img",{src:a.url,alt:`Refactored ${n+1}`,className:"w-full h-full object-cover rounded-lg"}),e.jsx(y,{variant:"danger",size:"sm",isLoading:Ye,className:"absolute bg-red-600 text-white top-1 right-0 opacity-0 group-hover:opacity-100 transition-opacity duration-300 p-1 rounded-full",onClick:()=>es(s._id,a._id),children:e.jsx("i",{className:"w-4 h-4 fas fa-trash"})})]},a._id))}):e.jsx("div",{className:"text-sm text-gray-500",children:"No refactored images uploaded yet."})]})]})})]})},s._id||t))}):e.jsx("div",{className:"w-full px-6 py-8 flex justify-center",children:e.jsx("div",{className:"bg-gray-100 border border-gray-200 rounded-lg p-6 max-w-full w-full text-sm text-gray-800 shadow-sm mx-auto flex justify-center",children:e.jsxs("div",{className:"",children:[e.jsxs("div",{className:"flex items-start gap-2 mb-3",children:[e.jsx("i",{className:"fas fa-info-circle mt-1 text-gray-500"}),e.jsx("p",{className:"font-semibold",children:"No corrections have been assigned."})]}),e.jsx("p",{className:"mb-2",children:"To upload images for correction:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 pl-4 text-sm",children:[e.jsxs("li",{children:["Select checkbox in the ",e.jsx("strong",{children:"Site/Actual Images"})]}),e.jsx("li",{children:"Click on the images that you need to upload for correction"}),e.jsxs("li",{children:["Click the ",e.jsx("strong",{children:'"Upload Selected"'})," button to upload"]})]})]})})})})]}),e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Planned vs Actual — Slider Comparison"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{var s;return(s=document.getElementById("planned-image"))==null?void 0:s.click()},className:"bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700",children:"Pick Planned"}),e.jsx("button",{onClick:()=>{var s;return(s=document.getElementById("actual-image"))==null?void 0:s.click()},className:"bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700",children:"Pick Actual"}),e.jsx("button",{onClick:ns,className:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600",children:"Reset"})]})]}),e.jsx("div",{className:"relative w-[100%] h-96 bg-gray-100 rounded-lg overflow-hidden border",children:S.url||se.url?e.jsxs("div",{className:"relative w-full h-full cursor-col-resize",onMouseMove:ls,onMouseUp:Te,onMouseLeave:Te,children:[S.url&&e.jsxs("div",{className:"absolute top-0 left-0 h-full overflow-visible",style:{width:`${ae}%`},children:[e.jsx("img",{src:S.url,alt:"plannedimage",className:"absolute top-0 left-0 w-[100%] h-[100%] object-cover",style:{clipPath:"inset(0px 0% 0px 0px)"}}),e.jsx("div",{className:"absolute bottom-2 left-2 bg-black bg-opacity-70 text-white px-2 py-1 rounded text-sm",children:"Planned"}),e.jsx("button",{onClick:is,className:"absolute top-2 left-2 bg-red-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs hover:bg-red-700",children:e.jsx("i",{className:"fas fa-times"})})]}),se.url&&e.jsxs("div",{className:"absolute top-0 right-0 h-full overflow-hidden",style:{width:`${100-ae}%`},children:[e.jsx("img",{src:se.url||"/placeholder.svg",alt:"Actual",className:"h-full object-cover",style:{width:"100%",maxWidth:"none"}}),e.jsx("div",{className:"absolute bottom-2 right-2 bg-black bg-opacity-70 text-white px-2 py-1 rounded text-sm",children:"Actual"}),e.jsx("button",{onClick:cs,className:"absolute top-2 right-2 bg-red-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs hover:bg-red-700",children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsx("div",{className:"absolute top-0 h-full w-1 bg-white shadow-lg cursor-col-resize z-10",style:{left:`${ae}%`,transform:"translateX(-50%)"},children:e.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-8 h-8 bg-white rounded-full shadow-lg border-2 border-gray-300 cursor-col-resize flex items-center justify-center",onMouseDown:rs,children:e.jsx("i",{className:"fas fa-arrows-alt-h text-gray-600 text-xs"})})})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"fas fa-images text-4xl mb-4"}),e.jsx("p",{className:"text-lg",children:"Upload planned and actual images to compare"}),e.jsx("p",{className:"text-sm",children:"Use the buttons above to select images"})]})})}),e.jsx("p",{className:"text-sm text-gray-600 mt-2 text-center",children:"Drag the circle to reveal differences"}),e.jsx("input",{id:"planned-image",type:"file",accept:"image/*",onChange:as,className:"hidden"}),e.jsx("input",{id:"actual-image",type:"file",accept:"image/*",onChange:ts,className:"hidden"})]}),e.jsxs(q,{children:[e.jsx(Q,{children:e.jsxs(Z,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Supervisor Visual Check & Approval"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-orange-500 rounded-full"}),e.jsx("span",{className:"text-sm",children:"Pending Review"})]})]})}),e.jsxs(ee,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx(F,{htmlFor:"reviewerName",children:"Reviewer Name"}),e.jsx(A,{id:"reviewerName",placeholder:"Staff doing the check",value:c.supervisorCheck.reviewerName,onChange:s=>B("reviewerName",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"reviewDateTime",children:"Review Date & Time"}),e.jsx(A,{id:"reviewDateTime",type:"datetime-local",value:c.supervisorCheck.reviewDateTime,onChange:s=>B("reviewDateTime",s.target.value)})]})]}),e.jsxs("div",{className:"flex gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",id:"pending",name:"status",value:"",checked:c.supervisorCheck.status==="",onChange:s=>B("status",s.target.value)}),e.jsx(F,{htmlFor:"pending",children:"Pending"})]}),e.jsx(y,{variant:c.supervisorCheck.status==="approved"?"primary":"outline",className:"bg-green-500 hover:bg-green-600 text-white",onClick:()=>B("status","approved"),children:"Approve"}),e.jsx(y,{variant:c.supervisorCheck.status==="needs_changes"?"primary":"outline",className:"bg-orange-500 hover:bg-orange-600 text-white",onClick:()=>B("status","needs_changes"),children:"Changes Required"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(F,{htmlFor:"remarks",children:"Remarks / Observations"}),e.jsx(Fe,{id:"remarks",placeholder:"Note deviations, rework needed, or greenlight to proceed",value:c.supervisorCheck.remarks,onChange:s=>B("remarks",s.target.value),rows:3})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"gatekeeping",children:"Gatekeeping (Workflow Interlock)"}),e.jsxs(Me,{value:c.supervisorCheck.gatekeeping,onValueChange:s=>B("gatekeeping",s),children:[e.jsx(Oe,{selectedValue:c.supervisorCheck.gatekeeping,children:e.jsx(Le,{selectedValue:c.supervisorCheck.gatekeeping==="block"?"BLOCK work to start with Supervisor Watch":"ALLOW work to start with Supervisor Watch"})}),e.jsxs(De,{children:[e.jsx(de,{value:"block",children:"BLOCK work to start with Supervisor Watch"}),e.jsx(de,{value:"allow_with_watch",children:"ALLOW work to start with Supervisor Watch"})]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Matches CRM philosophy used in Material Arrival stage — prevent next step until approval."})]})]})]})]})]})]})}):null},Bs=()=>{var G,ce;const{projectId:p}=ms(),[_,k]=m.useState(!1),[r,R]=m.useState([]),[h,P]=m.useState(null),[C,W]=m.useState(null),[$,j]=m.useState(new Date),[d,S]=m.useState(null),[O,se]=m.useState([]),[me,E]=m.useState(!1),ue=us(),{data:I,isLoading:he,error:ae,refetch:z}=bs(p),{mutateAsync:fe}=ys(),te=ws(),ge=ks();m.useEffect(()=>{(()=>{const o=$.getFullYear(),u=$.getMonth(),x=new Date(o,u,1),g=new Date(x);g.setDate(g.getDate()-x.getDay());const N=[],f=new Date(g);for(let b=0;b<42;b++)N.push({date:new Date(f),isCurrentMonth:f.getMonth()===u}),f.setDate(f.getDate()+1);R(N)})()},[$]);const V=m.useCallback(()=>{if(!h)return;const l=new Date(h);l.setDate(l.getDate()-1),re(l)},[h]),c=m.useCallback(()=>{if(!h)return;const l=new Date(h);l.setDate(l.getDate()+1),re(l)},[h]);m.useEffect(()=>{const l=o=>{h&&(o.key==="Escape"?(P(null),S(null),E(!1)):o.key==="ArrowRight"?c():o.key==="ArrowLeft"&&V())};return document.addEventListener("keydown",l),()=>{document.removeEventListener("keydown",l)}},[c,V]);const T=l=>`${l.getFullYear()}-${String(l.getMonth()+1).padStart(2,"0")}-${String(l.getDate()).padStart(2,"0")}`,J=l=>{const o=T(l);return I.flatMap(u=>(u.dailyTasks||[]).filter(g=>(typeof g.datePlanned=="string"?g.datePlanned.split("T")[0]:new Date(g.datePlanned).toISOString().split("T")[0])===o).map(g=>({...g,scheduleId:u._id})))},re=l=>{const o=J(l);P(l),se(o),o.length===1?(S(o[0]),E(!1)):o.length>1&&(E(!0),S(null))},L=l=>{switch(l){case"completed":return"bg-green-200 text-green-800";case"in_progress":return"bg-yellow-200 text-yellow-800";case"planned":return"bg-blue-200 text-blue-800";default:return"bg-gray-200 text-gray-800"}},pe=l=>{const o=I.find(u=>u._id===l);o&&(W(o),k(!0))},le=async l=>{var o,u;try{await fe({scheduleId:l.scheduleId,taskId:l._id,projectId:p}),P(null),S(null),z(),w({title:"Success",description:"deleted successfully"})}catch(x){w({title:"Error",description:((u=(o=x==null?void 0:x.response)==null?void 0:o.data)==null?void 0:u.message)||"failed to delete",variant:"destructive"})}},D=async(l,o)=>{var u,x,g;if(h)try{const N=(u=I==null?void 0:I.find(f=>f.dailyTasks.some(b=>b._id===o._id)))==null?void 0:u._id;if(N){const f=await te.mutateAsync({scheduleId:N,taskId:o._id,date:h.toISOString().split("T")[0],projectId:p,files:l});z(),S(b=>{var K;if(!b)return b;const M=(K=b.uploadedImages)==null?void 0:K.find(H=>new Date(H.date).toDateString()===h.toDateString());return M?(M.uploads.push(...f.uploads),{...b,uploadedImages:[...b.uploadedImages]}):{...b,uploadedImages:[...b.uploadedImages||[],f]}}),w({title:"Success",description:"image uploaded successfully"})}}catch(N){w({title:"Error",description:((g=(x=N==null?void 0:N.response)==null?void 0:x.data)==null?void 0:g.message)||"failed to upload",variant:"destructive"})}},ne=async(l,o)=>{var u,x,g;try{const N=(u=I==null?void 0:I.find(f=>f.dailyTasks.some(b=>b._id===o._id)))==null?void 0:u._id;if(N){console.log("work maing the scuekndlahflsjkkkkkkkkk");const f=await ge.mutateAsync({scheduleId:N,taskId:o._id,date:(h==null?void 0:h.toISOString().split("T")[0])||"",projectId:p,imageId:l});console.log("upladsImages",f),z();const b=(h==null?void 0:h.toISOString().split("T")[0])||"";S(M=>{var H;if(!M)return M;const K=(H=M.uploadedImages)==null?void 0:H.map(Y=>Y.date.split("T")[0]===b?{...Y,uploads:Y.uploads.filter(je=>je._id!==l)}:Y);return{...M,uploadedImages:K}}),w({title:"Success",description:"deleted successfully"})}}catch(N){w({title:"Error",description:((g=(x=N==null?void 0:N.response)==null?void 0:x.data)==null?void 0:g.message)||"failed to delete",variant:"destructive"})}},ie=l=>{j(o=>{const u=new Date(o);return u.setMonth(o.getMonth()+l),u})};return he?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"fas fa-spinner fa-spin text-4xl text-blue-600 mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading schedule..."})]})}):ae?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"fas fa-exclamation-triangle text-4xl text-red-600 mb-4"}),e.jsx("p",{className:"text-red-600",children:"Error loading schedule data"})]})}):e.jsx("div",{className:"max-h-full overflow-y-auto bg-gray-50",children:e.jsx("div",{className:" mx-auto px-4 py-8",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("button",{className:"bg-gray-100 rounded-lg px-2 py-1 cursor-pointer",onClick:()=>{ue(-1)},children:[e.jsx("i",{className:"fas fa-arrow-left mr-1 "}),"back"]}),e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Work Schedule Calendar"}),e.jsxs("button",{onClick:()=>k(!0),className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-plus"}),"Add Events"]})]}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("button",{onClick:()=>ie(-1),className:"p-2 hover:bg-gray-100 rounded",children:e.jsx("i",{className:"fas fa-chevron-left"})}),e.jsx("h2",{className:"text-xl font-semibold",children:$.toLocaleDateString("en-US",{month:"long",year:"numeric"})}),e.jsx("button",{onClick:()=>ie(1),className:"p-2 hover:bg-gray-100 rounded",children:e.jsx("i",{className:"fas fa-chevron-right"})})]}),e.jsxs("div",{className:"grid grid-cols-7 gap-1 mb-4",children:[["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(l=>e.jsx("div",{className:"p-3 text-center font-semibold text-gray-600 bg-gray-100",children:l},l)),r.map((l,o)=>{const u=J(l.date);return e.jsxs("div",{className:`min-h-[120px] p-2 border border-gray-200 cursor-pointer hover:bg-gray-50 ${l.isCurrentMonth?"bg-white":"bg-gray-50"}`,onClick:()=>re(l.date),children:[e.jsx("div",{className:"font-medium text-sm mb-1",children:l.date.getDate()}),u.length===0?e.jsx("div",{className:"text-xs text-gray-400 italic",children:"No tasks assigned"}):e.jsxs("div",{className:"space-y-1",children:[u.slice(0,2).map((x,g)=>e.jsx("div",{className:`text-xs p-1 rounded truncate ${L(x.status)}`,children:x.workDescription||x.room},g)),u.length>2&&e.jsxs("div",{className:"text-xs text-blue-600 font-medium",children:["+",u.length-2," more"]})]})]},o)})]}),h&&e.jsxs("div",{onClick:()=>{W(null),P(null),S(null),E(!1)},className:"fixed inset-0 bg-black/70 bg-opacity-50 flex items-center justify-around z-50",children:[e.jsx("button",{onClick:l=>{l.stopPropagation(),V()},className:"p-2 text-gray-600 bg-gray-50 hover:text-gray-900",children:e.jsx("i",{className:"fas fa-chevron-left"})}),e.jsxs("div",{onClick:l=>l.stopPropagation(),className:"bg-white rounded-lg p-6 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-xl font-bold",children:["Tasks for ",h.toLocaleDateString()]}),e.jsx("button",{onClick:()=>{W(null),P(null),S(null),E(!1)},className:"text-gray-500 hover:text-gray-700",children:e.jsx("i",{className:"fas fa-times text-xl"})})]}),O.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("i",{className:"fas fa-calendar-times text-4xl mb-4"}),e.jsx("p",{className:"text-lg",children:"No tasks assigned for this date"})]}):me&&O.length>1?e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-lg font-semibold mb-4",children:"Select a task to view details:"}),O.map((l,o)=>e.jsx("div",{className:"border rounded-lg p-4 cursor-pointer hover:bg-gray-50 transition-colors",onClick:()=>{S(l),E(!1)},children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-lg",children:l.workDescription}),e.jsxs("p",{className:"text-gray-600",children:["Room: ",l.room]}),e.jsxs("p",{className:"text-gray-600",children:["Time: ",l.startTime," - ",l.endTime]})]}),e.jsx("span",{className:`px-3 py-1 rounded text-sm ${L(l.status)}`,children:l.status})]})},o))]}):d?e.jsxs("div",{className:"space-y-6",children:[O.length>1&&e.jsxs("button",{onClick:()=>{E(!0),S(null)},className:"text-blue-600 hover:text-blue-800 mb-4",children:[e.jsx("i",{className:"fas fa-arrow-left mr-2"}),"Back to task list"]}),e.jsxs("div",{className:"border rounded-lg p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("h4",{className:"text-xl font-bold",children:d.workDescription}),e.jsx("span",{className:`px-3 py-1 rounded text-sm ${L(d.status)}`,children:d.status})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6 text-gray-700 mb-6",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"Room/Unit:"})," ",d.room]}),e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"Time:"})," ",d.startTime," - ",d.endTime]})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"Materials:"})," ",((G=d.materialsNeeded)==null?void 0:G.join(", "))||"None"]}),e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"Manpower:"})," ",d.manpower]})]})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h5",{className:"text-lg font-semibold",children:"Task Images"}),e.jsxs("label",{className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded cursor-pointer transition-colors",children:[te.isPending&&e.jsx("span",{className:"animate-spin fas fa-spinner mr-1"}),e.jsx("i",{className:"fas fa-upload mr-2"}),"Upload Images",e.jsx("input",{type:"file",multiple:!0,accept:"image/*",className:"hidden",onChange:l=>{l.target.files&&D(Array.from(l.target.files),d)}})]})]}),d.uploadedImages&&d.uploadedImages.length>0?e.jsx("div",{className:"grid grid-cols-3 gap-4",children:(ce=d==null?void 0:d.uploadedImages)==null?void 0:ce.map((l,o)=>l.uploads.map((u,x)=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:u.url||Ss,alt:`Task image ${x+1}`,className:"w-full h-32 object-cover rounded-lg border shadow-sm"}),e.jsx("button",{onClick:()=>ne(u._id,d),className:"absolute top-2 right-2 bg-red-600 text-white rounded-full w-8 h-8 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-700",children:e.jsx("i",{className:"fas fa-times"})})]},`${o}-${x}`)))}):e.jsxs("div",{className:"text-center py-8 text-gray-500 bg-gray-50 rounded-lg",children:[e.jsx("i",{className:"fas fa-images text-3xl mb-2"}),e.jsx("p",{children:"No images uploaded for this task"})]})]}),e.jsxs("div",{className:"mt-6 flex gap-3 pt-4 border-t",children:[e.jsxs("button",{onClick:()=>le(d),className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded transition-colors",children:[e.jsx("i",{className:"fas fa-trash mr-2"}),"Delete Task"]}),e.jsx(y,{onClick:()=>pe(d.scheduleId),children:"Edit Task"})]})]})]}):O.length===1?(S(O[0]),null):null]}),e.jsx("button",{onClick:l=>{l.stopPropagation(),c()},className:"p-2 text-gray-600  bg-gray-50 hover:text-gray-900",children:e.jsx("i",{className:"fas fa-chevron-right"})})]}),_&&e.jsx(Ts,{projectId:p,isOpen:_,onClose:()=>{k(!1),W(null)},onSave:l=>{console.log("Saving:",l),k(!1)},refetch:z,scheduleId:C?d.scheduleId:null,editData:C,onUpdate:l=>{console.log("Updating:",l),k(!1)}})]})})})};export{Bs as default};
