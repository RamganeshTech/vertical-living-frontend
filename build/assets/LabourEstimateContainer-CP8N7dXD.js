import{j as e,h as u,I as c,B as i,c as z,f as D,r as g,M as G,t as f}from"./index-DXj62qt7.js";import{g as H,h as J,i as K,j as Q}from"./costEstimationApi-DkIwVude.js";const U=({handleAdd:x,newData:r,setNewData:m,addPending:v,setShowForm:j})=>e.jsxs("div",{className:"space-y-3 bg-white px-6 py-3 sm:w-[40%] w-[80%] rounded-2xl",children:[e.jsx("h2",{className:"font-medium text-gray-700 text-center",children:"Add Labour"}),e.jsxs("div",{children:[e.jsx(u,{children:"Work Type"}),e.jsx(c,{required:!0,placeholder:"Work Type",value:r.workType,onChange:s=>m({...r,workType:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(u,{children:"No.Of People"}),e.jsx(c,{placeholder:"No of people",value:r.noOfPeople,onChange:s=>m({...r,noOfPeople:+s.target.value})})]}),e.jsxs("div",{children:[e.jsx(u,{children:"No of Days"}),e.jsx(c,{placeholder:"Days",type:"number",value:r.daysPlanned,onChange:s=>m({...r,daysPlanned:+s.target.value})})]}),e.jsxs("div",{children:[e.jsx(u,{children:"Per Day Salary"}),e.jsx(c,{placeholder:"Per Day Salary",type:"number",value:r.perdaySalary,onChange:s=>m({...r,perdaySalary:+s.target.value})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(u,{children:"Weekly Cost:"}),e.jsxs("p",{className:"font-medium text-center  text-gray-700 leading-10 ",children:["₹",r.perdaySalary*r.noOfPeople*7||0]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(u,{children:"Total Cost:"}),":",e.jsxs("div",{className:"font-medium text-center  text-gray-700 leading-10",children:["₹",r.daysPlanned*r.perdaySalary*r.noOfPeople||0]})]}),e.jsxs("div",{className:"flex  items-center justify-center gap-2",children:[e.jsx(i,{onClick:x,isLoading:v,children:"Add"}),e.jsx(i,{variant:"outline",onClick:()=>j(!1),children:"Cancel"})]})]}),Y=()=>{var E,T;const{projectId:x,organizationId:r}=z(),m=D(),[v,j]=g.useState(null),[s,p]=g.useState({workType:"",noOfPeople:0,daysPlanned:0,perdaySalary:0}),[n,y]=g.useState({workType:"",noOfPeople:0,daysPlanned:0,perdaySalary:0}),[O,w]=g.useState(!1),[A,P]=g.useState(!1),{data:d,isLoading:b,isError:L,error:h,refetch:N}=H(x),{mutateAsync:F,isPending:I}=J(),{mutateAsync:W,isPending:_}=K(),{mutateAsync:$,isPending:S}=Q(),k=g.useMemo(()=>d==null?void 0:d.reduce((a,t)=>a+(t==null?void 0:t.totalCost),0),[d]);if(b)return e.jsx(G,{});if(L)return e.jsxs("div",{className:"max-w-xl mx-auto mt-12 p-6 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 text-xl font-semibold mb-2",children:"⚠️ Oops! An Error Occurred"}),e.jsx("p",{className:"text-red-500 text-sm mb-4",children:((T=(E=h==null?void 0:h.response)==null?void 0:E.data)==null?void 0:T.message)||(h==null?void 0:h.message)||"Failed to load , please try again"}),e.jsx(i,{isLoading:b,onClick:()=>N(),className:"inline-flex items-center px-4 py-2 bg-red-600 text-white text-sm font-medium rounded hover:bg-red-700 transition",children:"Retry"})]});const R=a=>{j(a._id),p({workType:a.workType,noOfPeople:a.noOfPeople,daysPlanned:a.daysPlanned,perdaySalary:a.perdaySalary})},q=()=>{j(null),p({workType:"",noOfPeople:0,daysPlanned:0,perdaySalary:0})},B=async a=>{var t,l;try{await F({projectId:x,labourId:a}),f({description:"Deleted successfully",title:"Success"}),N()}catch(o){f({title:"Error",description:((l=(t=o==null?void 0:o.response)==null?void 0:t.data)==null?void 0:l.message)||o.message||"Failed to update completion status",variant:"destructive"})}},M=async a=>{var t,l;try{if(!s.workType)throw new Error("workType is mandatory");await W({projectId:x,labourId:a,updates:s}),f({description:"edited successfully",title:"Success"}),q(),N()}catch(o){f({title:"Error",description:((l=(t=o==null?void 0:o.response)==null?void 0:t.data)==null?void 0:l.message)||o.message||"Failed to update completion status",variant:"destructive"})}},C=async()=>{var a,t;try{if(!n.workType)throw new Error("Please Enter the workType");await $({projectId:x,labourData:n}),y({workType:"",noOfPeople:0,daysPlanned:0,perdaySalary:0}),w(!1),P(!1),f({title:"Success",description:"Labour estimation added"}),N()}catch(l){f({title:"Error",description:((t=(a=l==null?void 0:l.response)==null?void 0:a.data)==null?void 0:t.message)||(l==null?void 0:l.message),variant:"destructive"})}};return e.jsxs("main",{className:"h-full w-full",children:[e.jsxs("div",{className:"w-full flex justify-between ",children:[e.jsx("h2",{className:"text-xl font-bold text-blue-600 mb-5",children:"Labour Estimation"}),e.jsx(i,{variant:"primary",className:"h-10",onClick:()=>m(`/${r}/projectdetails/${x}/costestimation`),children:"Go Back"})]}),!(d!=null&&d.length)&&e.jsxs("div",{className:"w-full bg-white border border-gray-200 rounded-lg p-10 h-[60%] shadow-sm flex flex-col items-center justify-center text-center",children:[e.jsx("i",{className:"fa-solid fa-person-digging text-7xl text-gray-400 mb-6"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"No Labour Estimations"}),e.jsx("p",{className:"text-sm text-gray-500 mb-6",children:"Create your first labour estimation to start managing your workforce"}),e.jsxs(i,{onClick:()=>P(!0),className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 text-lg font-medium rounded",children:[e.jsx("i",{className:"fa-solid fa-plus mr-2"})," Create Labour Estimation"]})]}),e.jsx("section",{children:A&&e.jsx("div",{className:"fixed bg-black/70 flex justify-center items-center h-full w-full z-50 top-0 left-0",children:e.jsx(U,{handleAdd:C,newData:n,setNewData:y,addPending:S,setShowForm:P})})}),(d==null?void 0:d.length)>0&&e.jsxs("div",{className:"bg-white rounded  overflow-hidden",children:[e.jsx("section",{children:e.jsx("div",{className:"mb-4 p-4 bg-blue-50 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-blue-900",children:"Total Labour Cost:"}),e.jsxs("span",{className:"text-lg font-bold  text-blue-900",children:["₹",(k==null?void 0:k.toLocaleString())||e.jsx("span",{children:"0"})]})]})})}),e.jsx("div",{className:"w-full overflow-x-auto h-[95%]  custom-scrollbar",children:e.jsx("div",{className:"min-w-[1000px]",children:e.jsxs("section",{className:"shadow-lg !rounded-lg",children:[e.jsxs("div",{className:"grid grid-cols-7 bg-blue-50 px-6 py-3 font-semibold text-gray-700 text-sm",children:[e.jsx("div",{className:"text-left px-3 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Work Type"}),e.jsx("div",{className:"text-center px-3 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"No.Of People"}),e.jsx("div",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Days Planned"}),e.jsx("div",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Per Day Salary"}),e.jsx("div",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Weekly Salary"}),e.jsx("div",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Cost"}),e.jsx("div",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]}),e.jsxs("div",{className:"divide-y divide-gray-100 shadow-md  rounded-lg max-h-[65vh] overflow-y-auto bg-white",children:[d==null?void 0:d.map(a=>e.jsx("div",{className:`grid grid-cols-7 rounded-lg items-center gap-2 px-6 py-4 text-sm ${v===a._id?"":"hover:bg-[#f7fbff]"}`,children:v===a._id?e.jsxs(e.Fragment,{children:[e.jsx(c,{required:!0,value:s.workType,onChange:t=>p({...s,workType:t.target.value})}),e.jsx(c,{type:"number",value:s.noOfPeople,onChange:t=>p({...s,noOfPeople:+t.target.value})}),e.jsx(c,{type:"number",value:s.daysPlanned,onChange:t=>p({...s,daysPlanned:+t.target.value})}),e.jsx(c,{type:"number",value:s.perdaySalary,onChange:t=>p({...s,perdaySalary:+t.target.value})}),e.jsxs("div",{className:"text-gray-700",children:["₹",s.perdaySalary*7||0]}),e.jsxs("div",{className:"text-gray-700",children:["₹",s.daysPlanned*s.perdaySalary||0]}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(i,{onClick:()=>M(a._id),isLoading:_,children:e.jsx("i",{className:"fas fa-check"})}),e.jsx(i,{variant:"ghost",onClick:()=>j(null),children:"✖"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-medium text-left   text-gray-700",children:a.workType||"N/A"}),e.jsx("div",{className:"font-medium text-center text-gray-700",children:(a==null?void 0:a.noOfPeople)||"N/A"}),e.jsx("div",{className:"font-medium text-center text-gray-700",children:a.daysPlanned||"N/A"}),e.jsx("div",{className:"font-medium text-center text-gray-700",children:`₹${a.perdaySalary}`||"N/A"}),e.jsx("div",{className:"font-medium text-center text-gray-700",children:`₹${a.weeklySalary}`||"N/A"}),e.jsxs("div",{className:"text-gray-800 font-medium text-center",children:["₹",a.totalCost||0]}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsxs(i,{onClick:()=>R(a),children:[" ",e.jsx("i",{className:"fas fa-pen"})]}),e.jsxs(i,{variant:"danger",className:"bg-red-500 text-white",isLoading:I,onClick:()=>B(a._id),children:[" ",e.jsx("i",{className:"fas fa-trash-can"})," "]})]})]})},a._id)),O&&e.jsxs("div",{className:"grid grid-cols-7 gap-2  px-6 py-4 text-sm  !bg-none",children:[e.jsx(c,{required:!0,placeholder:"Work Type",value:n.workType,onChange:a=>y({...n,workType:a.target.value})}),e.jsx(c,{placeholder:"No of people",value:n.noOfPeople,onChange:a=>y({...n,noOfPeople:+a.target.value})}),e.jsx(c,{placeholder:"Days",type:"number",value:n.daysPlanned,onChange:a=>y({...n,daysPlanned:+a.target.value})}),e.jsx(c,{placeholder:"Per Day Salary",type:"number",value:n.perdaySalary,onChange:a=>y({...n,perdaySalary:+a.target.value})}),e.jsxs("p",{className:"font-medium text-center  text-gray-700 leading-10 ",children:["₹",n.perdaySalary*n.noOfPeople*7||0]}),e.jsxs("div",{className:"font-medium text-center  text-gray-700 leading-10",children:["₹",n.daysPlanned*n.perdaySalary*n.noOfPeople||0]}),e.jsxs("div",{className:"flex  items-center justify-center gap-2",children:[e.jsx(i,{onClick:C,isLoading:S,children:"Add"}),e.jsx(i,{variant:"outline",onClick:()=>w(!1),children:"Cancel"})]})]})]}),e.jsx("div",{className:"mt-2",children:e.jsx(i,{variant:"primary",onClick:()=>w(!0),children:"+ Add Labour Estimation"})})]})})})]})]})};export{Y as default};
