import{d as $,c as I,r as i,e as A,j as e,B as h,L as F,A as B,t as c}from"./index-CBsAK0nv.js";import{c as P,d as T}from"./subContractNewApi-B78GGeA2.js";import{S as V}from"./SubContractForm-CPz3ZZTJ.js";import{S as z,a as R,b as U,c as G,d as M}from"./Select-trVCFi4L.js";const J=()=>{var x;const p=$(),{organizationId:b,subContractId:d}=I(),{data:t,isLoading:j,isError:v,refetch:u}=P({subContractId:d}),[C,m]=i.useState(!1),[o,S]=i.useState(""),[r,y]=i.useState((t==null?void 0:t.status)||"pending"),{role:w,permission:n}=A(),N=w==="owner"||((x=n==null?void 0:n.subcontract)==null?void 0:x.list);i.useEffect(()=>{if(t){const s=`https://houseofram.in/subcontract/share/${t._id}?token=${t.token}`;S(s),t!=null&&t.status&&y(t.status)}},[t]);const k=()=>{navigator.clipboard.writeText(o),m(!0),c({title:"Copied!",description:"Link copied to clipboard"}),setTimeout(()=>m(!1),2e3)},{mutateAsync:L}=T(),l={pending:{triggerClass:"bg-yellow-50 border-yellow-300 text-yellow-700",valueClass:"text-yellow-700 font-medium",itemClass:"text-yellow-700 hover:bg-yellow-50 hover:text-yellow-800 font-medium",dotColor:"bg-yellow-500",label:"Pending"},accepted:{triggerClass:"!bg-green-50 border-green-300 text-green-700",valueClass:"text-green-700 font-medium",itemClass:"text-green-700 hover:bg-green-50 hover:text-green-800 font-medium",dotColor:"bg-green-500",label:"Accepted"},rejected:{triggerClass:"!bg-red-50 border-red-300 text-red-700",valueClass:"text-red-700 font-medium",itemClass:"text-red-700 hover:bg-red-50 hover:text-red-800 font-medium",dotColor:"bg-red-500",label:"Rejected"}},E=async s=>{var g,f;try{await L({subContractId:d,status:s}),u(),c({title:"Success",description:"status successfully"})}catch(a){c({title:"Error",description:((f=(g=a==null?void 0:a.response)==null?void 0:g.data)==null?void 0:f.message)||(a==null?void 0:a.message)||"Failed to upload files",variant:"destructive"})}};if(j)return e.jsx("div",{children:"Loading subcontract details..."});if(v||!t)return e.jsx("div",{children:"Error loading data. Please try again."});if(N)return e.jsxs("div",{className:"space-y-6 max-h-full overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between gap-2 items-center",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(h,{variant:"outline",size:"icon",onClick:()=>p(-1),children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Sub Contract Details"})]}),e.jsxs(z,{value:r,onValueChange:s=>{E(s)},children:[e.jsx(R,{className:`w-full ${l[r].triggerClass}`,children:e.jsx(U,{placeholder:"Select Status",selectedValue:r.toString(),className:l[r].valueClass})}),e.jsx(G,{children:["pending","accepted","rejected"].map(s=>e.jsx(M,{value:s,className:l[s].itemClass,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${l[s].dotColor}`}),l[s].label]})},s))})]})]}),e.jsxs("div",{className:"max-w-full mx-auto space-y-8",children:[e.jsx(V,{organizationId:b,mode:"view",initialData:t,refetch:u}),o&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(F,{children:"Form Link"}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-2",children:[e.jsx(B,{value:o,readOnly:!0,className:"bg-blue-50 text-blue-800 flex-1"}),e.jsx(h,{onClick:k,className:"w-full sm:w-auto",children:e.jsx("i",{className:`fas ${C?"fa-check":"fa-copy"}`})})]})]})]})]})};export{J as default};
