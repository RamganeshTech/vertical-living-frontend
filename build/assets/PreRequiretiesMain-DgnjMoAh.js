import{c as v,q as P,a as C,d as R,u as $,j as e,r as w}from"./index-PP9bwaFb.js";import{u as W}from"./useQuery-Crlnn1zB.js";import{u as E}from"./useMutation-CnbKwdgs.js";import{g as k}from"./roleCheck-BSRkLz35.js";import{t as g}from"./toast-BSC5QTk1.js";import{B as q}from"./Button-De5O-mHo.js";import"./useBaseQuery--We87FtY.js";const A=async({api:a,id:i,section:t,notes:s})=>{const{data:o}=await a.patch(`/prerequireties/update/${i}/notes/${t}`,{notes:s});if(o.ok)return o;throw new Error(o.message||"Failed to update notes")},S=async({api:a,id:i,section:t,isRequired:s})=>{const{data:o}=await a.patch(`/prerequireties/update/${i}/boolean/${t}`,{isRequired:s});if(o.ok)return o;throw new Error(o.message||"Failed to update boolean")},_=async({api:a,projectId:i})=>{const{data:t}=await a.get(`/prerequireties/getalldetails/${i}`);if(t.ok)return t;throw new Error(t.message||"Failed to get all PreRequireties")},F=()=>{const{role:a}=v(),i=k(a),t=["owner","staff","CTO"];return E({mutationFn:async({id:s,section:o,notes:l})=>{if(!a)throw new Error("Not Authorized");if(!t.includes(a))throw new Error("Not allowed");if(!i)throw new Error("API not found");return await A({api:i,id:s,section:o,notes:l})},onSuccess:()=>{P.invalidateQueries({queryKey:["preRequireties"]})}})},B=()=>{const{role:a}=v(),i=k(a),t=["owner","staff","CTO"];return E({mutationFn:async({id:s,section:o,isRequired:l})=>{if(!a)throw new Error("Not Authorized");if(!t.includes(a))throw new Error("Not allowed");if(!i)throw new Error("API not found");return await S({api:i,id:s,section:o,isRequired:l})},onSuccess:()=>{P.invalidateQueries({queryKey:["preRequireties"]})}})},M=a=>{const{role:i}=v(),t=k(i),s=["owner","staff","CTO"];return W({queryKey:["preRequireties",a],queryFn:async()=>{if(!i)throw new Error("Not Authorized");if(!s.includes(i))throw new Error("Not allowed");if(!t)throw new Error("API not found");return await _({api:t,projectId:a})},retry:!1,refetchOnMount:!1})},O=({title:a,section:i,isRequired:t,notes:s,formId:o,onUpdate:l})=>{const[d,b]=w.useState(!1),[u,y]=w.useState(s),[x,m]=w.useState(!1),c=B(),N=F(),p=async r=>{try{await c.mutateAsync({id:o,section:i,isRequired:r}),g({title:"Success",description:`${a} requirement updated successfully`}),l()}catch(f){g({title:"Error",description:f instanceof Error?f.message:"Failed to update requirement",variant:"destructive"})}},h=async()=>{if(u!==s){m(!0);try{await N.mutateAsync({id:o,section:i,notes:u}),g({title:"Success",description:`${a} notes updated successfully`}),l()}catch(r){g({title:"Error",description:r instanceof Error?r.message:"Failed to update notes",variant:"destructive"}),y(s)}finally{m(!1)}}},j=()=>{h()},n=r=>{r.key==="Enter"&&r.ctrlKey&&h()};return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg shadow-sm mb-4",children:[e.jsx("div",{className:"p-4 cursor-pointer hover:bg-gray-50 transition-colors border-b border-gray-100",onClick:()=>b(!d),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("i",{className:`fas ${d?"fa-chevron-down":"fa-chevron-right"} text-gray-400`}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:a}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Status:"}),t?e.jsxs("span",{className:"flex items-center text-green-600 text-sm",children:[e.jsx("i",{className:"fas fa-check-circle mr-1"}),"Required"]}):e.jsxs("span",{className:"flex items-center text-gray-500 text-sm",children:[e.jsx("i",{className:"fas fa-exclamation-circle mr-1"}),"Not Required"]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t,onChange:r=>{r.stopPropagation(),p(r.target.checked)},disabled:c.isPending,className:"sr-only"}),e.jsx("div",{className:`w-11 h-6 rounded-full transition-colors ${t?"bg-blue-600":"bg-gray-200"} ${c.isPending?"opacity-50":""}`,children:e.jsx("div",{className:`w-5 h-5 bg-white rounded-full shadow transform transition-transform ${t?"translate-x-5":"translate-x-0"} mt-0.5 ml-0.5`})})]}),c.isPending&&e.jsx("i",{className:"fas fa-spinner fa-spin text-gray-400"})]})]})}),d&&e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t,onChange:r=>p(r.target.checked),disabled:c.isPending,className:"sr-only"}),e.jsx("div",{className:`w-11 h-6 rounded-full transition-colors ${t?"bg-blue-600":"bg-gray-200"} ${c.isPending?"opacity-50":""}`,children:e.jsx("div",{className:`w-5 h-5 bg-white rounded-full shadow transform transition-transform ${t?"translate-x-5":"translate-x-0"} mt-0.5 ml-0.5`})})]}),e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"This work is required for the project"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Notes & Additional Details"}),e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{placeholder:`Add notes about ${a.toLowerCase()}...`,value:u,onChange:r=>y(r.target.value),onBlur:j,onKeyDown:n,className:"w-full min-h-[100px] p-3 border border-gray-300 rounded-md resize-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none",disabled:x}),x&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("i",{className:"fas fa-spinner fa-spin text-gray-400"})})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Press Ctrl+Enter to save or click outside the text area"})]})]})})]})},T=()=>{var m,c,N,p,h,j;const{projectId:a}=C(),{isMobile:i,openMobileSidebar:t}=R(),{data:s,isLoading:o,error:l,refetch:d}=M(a),b=$(),u=[{key:"modularWork",title:"Modular Work",description:"Prefabricated components and modular construction",_id:(m=s==null?void 0:s.data)==null?void 0:m._id},{key:"electricalWork",title:"Electrical Work",description:"Wiring, fixtures, and electrical installations",_id:(c=s==null?void 0:s.data)==null?void 0:c._id},{key:"plumbingWork",title:"Plumbing Work",dzescription:"Water supply, drainage, and plumbing fixtures",_id:(N=s==null?void 0:s.data)==null?void 0:N._id},{key:"civilWork",title:"Civil Work",description:"Structural work, foundations, and civil engineering",_id:(p=s==null?void 0:s.data)==null?void 0:p._id},{key:"decorationWork",title:"Decoration Work",description:"Interior design, painting, and finishing touches",_id:(h=s==null?void 0:s.data)==null?void 0:h._id},{key:"carpentryWork",title:"Carpentry Work",description:"Woodwork including doors, windows, furniture, partitions, and fittings",_id:(j=s==null?void 0:s.data)==null?void 0:j._id}],y=()=>{d()};if(o)return e.jsx("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("i",{className:"fas fa-spinner fa-spin text-4xl text-blue-600"}),e.jsx("p",{className:"text-gray-600",children:"Loading project prerequisites..."})]})});if(l)return e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-exclamation-circle text-red-600 mr-2"}),e.jsx("p",{className:"text-red-800",children:l instanceof Error?l.message:"Failed to load prerequisites"})]})}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx("button",{onClick:()=>d(),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors",children:"Try Again"})})]});if(!(s!=null&&s.data))return e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-exclamation-circle text-yellow-600 mr-2"}),e.jsx("p",{className:"text-yellow-800",children:"No prerequisites data found for this project. Please ensure the project exists and try again."})]})}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx("button",{onClick:()=>d(),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors",children:"Refresh"})})]});const x=s.data;return e.jsx(e.Fragment,{children:e.jsx("div",{className:"max-h-full overflow-y-auto mx-auto px-4 py-4 custom-scrollbar",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center hidden sm:block space-y-2",children:[e.jsx("h1",{className:"text-3xl font-bold text-blue-700",children:"Project Prerequisites"}),e.jsx("p",{className:"text-gray-600 max-w-2xl mx-auto",children:"Configure the required work types for your project. These prerequisites must be completed before proceeding to the 14-step process."})]}),e.jsx("header",{className:"block sm:hidden space-y-2",children:e.jsxs("h1",{className:"text-2xl font-bold text-gray-900",children:[i&&e.jsx("button",{onClick:t,className:"mr-3 p-2 rounded-md border border-gray-300 hover:bg-gray-100",title:"Open Menu",children:e.jsx("i",{className:"fa-solid fa-bars"})}),"Project Prerequisites"]})}),e.jsx("div",{className:"space-y-4",children:u.map(n=>{const r=x[n.key];return e.jsx(O,{title:n.title,section:n.key,isRequired:(r==null?void 0:r.isRequired)||!1,notes:(r==null?void 0:r.notes)||"",formId:n._id,onUpdate:y},n.key)})}),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Prerequisites Summary"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-6 gap-4",children:u.map(n=>{const r=x[n.key],f=(r==null?void 0:r.isRequired)||!1;return e.jsxs("div",{className:"flex items-center space-x-2",children:[f?e.jsx("i",{className:"fas fa-check-circle text-green-600"}):e.jsx("i",{className:"fas fa-exclamation-circle text-gray-400"}),e.jsx("span",{className:`text-sm ${f?"text-green-600 font-medium":"text-gray-500"}`,children:n.title})]},n.key)})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[e.jsx(q,{variant:"ghost",onClick:()=>d(),className:"px-6 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors",children:"Refresh Data"}),e.jsx(q,{onClick:()=>{b("../requirementform"),g({title:"Success",description:"Prerequisites configured successfully. You can now proceed to the 14-step process."})},className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Continue to Next Steps"})]})]})})})};export{T as default};
