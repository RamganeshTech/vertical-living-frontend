import{r as N,j as e,I as S,B as v,i as R,t as b,c as U,f as E}from"./index-C8ZngCsk.js";import{u as L,a as _,b as z}from"./materialSelectionApi-Ckh3aTIg.js";import{I as A}from"./ImageGalleryMain-CMJYgzS9.js";import"./constants-DELhKX7a.js";const B=({projectId:n,roomId:d,initialFiles:x,refetch:a})=>{const[p,h]=N.useState([]),[u,f]=N.useState(x.filter(s=>s.type==="pdf")),[g,c]=N.useState(x.filter(s=>s.type==="image")),[r,y]=N.useState(null),{mutateAsync:F,isPending:k}=L(),{mutateAsync:I,isPending:P}=_(),C=s=>{s.target.files&&h(Array.from(s.target.files))},D=async()=>{var j,o;if(p.length===0)return;const s=new FormData;p.forEach(t=>s.append("files",t));try{const t=await F({projectId:n,roomId:d,formData:s}),l=t.filter(i=>i.type==="pdf"),m=t.filter(i=>i.type==="image");f(i=>[...i,...l]),c(i=>[...i,...m]),h([]),b({title:"Success",description:"file uploaded successfully"}),a()}catch(t){b({title:"error",description:((o=(j=t==null?void 0:t.response)==null?void 0:j.data)==null?void 0:o.message)||"failed to upload file",variant:"destructive"})}},w=async(s,j)=>{var o,t;try{await I({projectId:n,roomId:d,fileId:s}),j==="pdf"?f(l=>l.filter(m=>m._id!==s)):c(l=>l.filter(m=>m._id!==s)),b({title:"Success",description:"deleted successfully"}),a()}catch(l){b({title:"error",description:((t=(o=l==null?void 0:l.response)==null?void 0:o.data)==null?void 0:t.message)||"failed to upload file",variant:"destructive"})}};return e.jsxs("div",{className:"space-y-6 ",children:[e.jsx("h3",{className:"text-xl font-semibold text-blue-700",children:"Uploads"}),e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsx(S,{type:"file",multiple:!0,onChange:C,accept:"image/*,application/pdf"}),e.jsx(v,{onClick:D,isLoading:k,className:"bg-blue-600 text-white",children:"Upload"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 pt-4",children:[e.jsxs("div",{className:"p-2",children:[e.jsx("h4",{className:"font-semibold text-red-700 mb-2",children:"📄 PDF Files"}),e.jsxs("ul",{className:"space-y-2 max-h-[280px] h-[280px] rounded-lg shadow-lg p-2 overflow-y-auto custom-scrollbar-none",children:[u.length===0&&e.jsx("div",{className:"min-h-[180px] rounded-lg  flex items-center justify-center",children:e.jsx("p",{className:"text-sm text-gray-500",children:"No PDFs uploaded."})}),u.map(s=>e.jsxs("li",{className:"flex justify-between items-center bg-red-50 p-2 rounded-xl",children:[e.jsx("span",{className:"text-sm",children:s.originalName}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(v,{size:"sm",variant:"primary",onClick:()=>R({src:s==null?void 0:s.url,alt:(s==null?void 0:s.originalName)||"file.pdf"}),children:e.jsx("i",{className:"fa-solid fa-download"})}),e.jsx(v,{onClick:()=>w(s._id,"pdf"),size:"sm",isLoading:P,variant:"primary",children:e.jsx("i",{className:"fa-solid fa-trash"})})]})]},s._id))]})]}),e.jsxs("div",{className:"p-2",children:[e.jsx("h4",{className:"font-semibold text-green-700 mb-2",children:"🖼️ Image Files"}),e.jsx("section",{className:"space-y-2 max-h-[280px] h-[280px] shadow-lg rounded-lg p-2 overflow-y-auto custom-scrollbar",children:e.jsx(A,{imageFiles:g,handleDeleteFile:w,height:80,minWidth:98,maxWidth:100})})]})]}),r&&e.jsx("div",{onClick:()=>y(null),className:"fixed inset-0 bg-black/70 z-50 p-8 bg-opacity-60 flex items-center justify-center",children:e.jsxs("div",{onClick:s=>s.stopPropagation(),className:"relative bg-white rounded py-8 px-4 max-w-[90vw] max-h-[80vh] shadow-lg",children:[e.jsx("i",{className:"fas fa-times absolute top-2 right-3 text-xl text-gray-700 hover:text-red-500 cursor-pointer",onClick:()=>y(null)}),e.jsx("img",{src:r,alt:"Full View",className:"max-h-[70vh] w-auto object-contain rounded"})]})})]})},q=()=>{const{projectId:n,roomId:d}=U(),x=E(),{data:a,isLoading:p,isError:h,refetch:u}=z({projectId:n,roomId:d}),f=()=>{x(-1)};if(p)return e.jsx("div",{className:"max-h-screen overflow-y-auto flex justify-center items-center min-h-screen bg-slate-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-600 font-medium",children:"Loading room details..."})]})});if(h)return e.jsx("div",{className:"max-h-screen overflow-y-auto flex flex-col items-center justify-center min-h-screen bg-slate-50",children:e.jsxs("div",{className:"text-center bg-white rounded-xl shadow-lg p-8 max-w-md",children:[e.jsx("i",{className:"fa-solid fa-exclamation-triangle text-red-500 text-4xl mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-slate-800 mb-2",children:"Failed to Load"}),e.jsx("p",{className:"text-slate-600 mb-4",children:"Unable to retrieve room details"}),e.jsxs("button",{onClick:()=>window.location.reload(),className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-colors",children:[e.jsx("i",{className:"fa-solid fa-refresh mr-2"}),"Retry"]})]})});const g=a!=null&&a.roomFields?Object.values(a.roomFields):[];return console.log("room",a),e.jsxs("div",{className:"max-h-screen overflow-y-auto bg-slate-50",children:[e.jsx("header",{className:"bg-white border-b border-slate-200 sticky top-0 z-10",children:e.jsx("div",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-500",children:[e.jsx("i",{className:"fa-solid fa-door-open"}),e.jsx("span",{className:"font-semibold text-blue-600 text-xl sm:text-2xl",children:(a==null?void 0:a.name)||"Room Details"})]}),e.jsxs("button",{onClick:f,className:"flex bg-slate-200 rounded-2xl px-2 py-1 cursor-pointer items-center gap-2 text-slate-700 hover:text-slate-600 transition-colors",children:[e.jsx("i",{className:"fa-solid fa-arrow-left"}),e.jsx("span",{className:"font-medium",children:"Return to Overview"})]})]})})}),e.jsxs("main",{className:"p-4",children:[e.jsxs("section",{className:"bg-white rounded-lg shadow-sm border border-slate-200 mb-6",children:[e.jsx("div",{className:"border-b border-slate-200 px-4 py-3",children:e.jsxs("h2",{className:"text-lg font-semibold text-slate-800 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-list-check text-blue-600"}),"Room Items & Specifications"]})}),g.length>0?e.jsxs("div",{className:"divide-y divide-slate-200",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-4 px-4 py-3 bg-slate-50 text-sm font-medium text-slate-600",children:[e.jsx("div",{className:"col-span-1",children:"#"}),e.jsx("div",{className:"col-span-1",children:e.jsx("i",{className:"fa-solid fa-box"})}),e.jsx("div",{className:"col-span-7 sm:col-span-8",children:"Item Name"}),e.jsx("div",{className:"col-span-3 sm:col-span-2 text-center",children:"Quantity"})]}),g.map((c,r)=>e.jsxs("div",{className:"grid grid-cols-12 gap-4 px-4 py-4 hover:bg-slate-50 transition-colors",children:[e.jsx("div",{className:"col-span-1 flex items-center",children:e.jsx("span",{className:"bg-slate-100 text-slate-600 text-xs font-medium px-2 py-1 rounded-full",children:r+1})}),e.jsx("div",{className:"col-span-1 flex items-center",children:e.jsx("div",{className:"bg-blue-100 p-2 rounded-lg",children:e.jsx("i",{className:"fa-solid fa-cube text-blue-600 text-sm"})})}),e.jsx("div",{className:"col-span-7 sm:col-span-8 flex items-center",children:e.jsx("span",{className:"font-medium text-slate-800",children:c.itemName})}),e.jsx("div",{className:"col-span-3 sm:col-span-2 flex items-center justify-center",children:e.jsx("span",{className:"bg-green-100 text-green-700 font-semibold px-3 py-1 rounded-full text-sm",children:c.quantity})})]},c._id||r))]}):e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"bg-slate-100 w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-3",children:e.jsx("i",{className:"fa-solid fa-inbox text-slate-400"})}),e.jsx("h3",{className:"font-semibold text-slate-700 mb-1",children:"No Items Found"}),e.jsx("p",{className:"text-slate-500 text-sm",children:"This room doesn't have any items configured yet."})]})]}),e.jsxs("section",{className:"bg-white rounded-lg shadow-sm border border-slate-200",children:[e.jsx("div",{className:"border-b border-slate-200 px-4 py-3",children:e.jsxs("h2",{className:"text-lg font-semibold text-slate-800 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-paperclip text-purple-600"}),"Attachments & Documents"]})}),e.jsx("div",{className:"p-4",children:e.jsx(B,{projectId:n,roomId:d,initialFiles:(a==null?void 0:a.uploads)||[],refetch:u})})]})]})]})};export{q as default};
