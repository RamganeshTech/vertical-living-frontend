import{a as W,j as e,B as u,r as w,I as y,t as T,u as S,b as M,O as E,M as A}from"./index-CUvv9ev0.js";import{u as F,a as z,b as $}from"./workLibraryApi-CUbsrsqp.js";import{C as O,b as _,d as P,a as B}from"./Card-CHHq377-.js";import{L as v}from"./Label-CX2gOFKV.js";import{D as G,a as H,c as R,b as V,d as q}from"./Dialog-DIiYxMna.js";import{T as J}from"./TextArea-BnQDaGer.js";import{S as K}from"./StageGuide-n_FMHWm4.js";const Q=({work:r,role:f,onDelete:j,deletePending:c,navigate:d})=>{var p,x,g,o;const{permission:m}=W(),b=f==="owner"||((p=m==null?void 0:m.stafftask)==null?void 0:p.delete);return e.jsxs(O,{className:"p-0 border-l-4 border-blue-600",children:[e.jsx(_,{children:e.jsx(P,{children:(r==null?void 0:r.workName)||"No title"})}),e.jsxs(B,{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm",children:[e.jsx("i",{className:"fa-solid fa-file-lines mr-2 text-blue-600"}),"Description: ",r!=null&&r.description?((x=r==null?void 0:r.description)==null?void 0:x.length)>100?`${(g=r==null?void 0:r.description)==null?void 0:g.slice(0,100)}...`:r==null?void 0:r.description:"N/A"]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("i",{className:"fa-solid fa-list-check mr-2 text-purple-600"})," ","Total Tasks: ",((o=r.tasks)==null?void 0:o.length)||0]}),e.jsxs("div",{className:"flex gap-2 mt-3 justify-end",children:[e.jsxs(u,{size:"sm",onClick:()=>d(`single/${r._id}`),children:[e.jsx("i",{className:"fa-solid fa-eye mr-1"}),"View"]}),f!=="staff"&&b&&e.jsxs(u,{size:"sm",onClick:()=>j(r._id),isLoading:c,className:"bg-red-600 hover:bg-red-700 text-white",children:[e.jsx("i",{className:"fa-solid fa-trash mr-1"}),"Delete"]})]})]})]},r._id)},U=({dialogOpen:r,setDialogOpen:f,organizationId:j})=>{const[c,d]=w.useState({workName:"",description:"",tags:[],tasks:[{title:"",description:"",estimatedTimeInMinutes:0,subtasks:[{title:""}]}]}),m=F(),b=(a,s=!1)=>{const t=[...a],l=n=>((n==null?void 0:n.title)||"").trim()==="";if(t.length===0)return t;for(;t.length>1&&l(t[t.length-1])&&l(t[t.length-2]);)t.pop();return(s||!l(t[t.length-1])&&!s)&&t.push({title:"",estimatedTimeInMinutes:0,subtasks:[]}),!t.some(n=>!l(n))&&t.length>1?[t[0]]:t},p=a=>{const s=Array.isArray(a)?[...a]:[],t=i=>((i==null?void 0:i.title)??"").trim()==="";if(s.length===0)return s;for(;s.length>1&&t(s[s.length-1])&&t(s[s.length-2]);)s.pop();return t(s[s.length-1])||s.push({title:""}),!s.some(i=>!t(i))&&s.length>1?[s[0]]:s},x=(a,s,t)=>{const l=[...c.tasks],i={...l[a]};i[s]=t,l[a]=i;const n=b(l);d(h=>({...h,tasks:n}))},g=()=>{const a={title:"",estimatedTimeInMinutes:0,subtasks:[]},s=[...c.tasks,a];d(t=>({...t,tasks:b(s,!0)}))},o=a=>{d(s=>{const t=s.tasks.filter((l,i)=>i!==a);return{...s,tasks:t}})},N=(a,s,t,l)=>{const i=[...c.tasks],n={...i[a]},h=Array.isArray(n.subtasks)?[...n.subtasks]:[];h[s]||(h[s]={title:""}),h[s][t]=l,n.subtasks=p(h),i[a]=n,d(L=>({...L,tasks:i}))},C=a=>{const s=[...c.tasks],t={...s[a]},l=Array.isArray(t.subtasks)?[...t.subtasks]:[];l.push({title:""}),t.subtasks=p(l),s[a]=t,d(i=>({...i,tasks:s}))},D=(a,s)=>{d(t=>{const l=[...t.tasks],i={...l[a]};return Array.isArray(i.subtasks)&&(i.subtasks=i.subtasks.filter((n,h)=>h!==s)),l[a]=i,{...t,tasks:l}})},k=async()=>{var a,s;try{const t=c.tasks.filter(i=>i.title.trim()!=="").map(i=>({title:i.title.trim(),estimatedTimeInMinutes:Number(i.estimatedTimeInMinutes)||0,subtasks:(i.subtasks||[]).filter(n=>n.title.trim()!=="").map(n=>({title:n.title.trim()}))})),l={workName:c.workName.trim(),description:c.description||"",tags:c.tags||[],organizationId:j,tasks:t};await m.mutateAsync({formData:l}),f(!1),d({workName:"",description:"",tags:[],tasks:[]}),T({description:"Work Flow created successfully",title:"Success"})}catch(t){T({title:"Error",description:((s=(a=t==null?void 0:t.response)==null?void 0:a.data)==null?void 0:s.message)||"Failed to create the work flow",variant:"destructive"})}};return e.jsxs("div",{className:"flex items-center justify-between mb-5",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Work Libraries"}),e.jsx(G,{open:r,onOpenChange:f,children:e.jsxs(H,{className:"w-[95vw] max-w-3xl p-0",children:[e.jsx(R,{className:"px-6 pt-6 pb-2",children:e.jsx(V,{className:"text-lg font-semibold",children:"Add New Work Library"})}),e.jsxs("div",{className:"px-6 pb-6 space-y-5 max-h-[70vh] overflow-auto",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(v,{className:"mb-1 block",children:"Work Name"}),e.jsx(y,{name:"workName",value:c.workName,onChange:a=>d({...c,workName:a.target.value}),placeholder:"Enter the Work Name","aria-label":"Work Name"})]}),e.jsxs("div",{children:[e.jsx(v,{className:"mb-1 block",children:"Description"}),e.jsx(J,{name:"description",value:(c==null?void 0:c.description)||"",onChange:a=>d({...c,description:a.target.value}),placeholder:"Brief description","aria-label":"Description"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-md font-semibold",children:"Tasks"}),e.jsxs(u,{size:"sm",onClick:g,className:"flex items-center gap-1",children:[e.jsx("i",{className:"fa-solid fa-plus","aria-hidden":"true"}),e.jsx("span",{className:"sr-only",children:"Add Task"}),e.jsx("span",{"aria-hidden":"true",children:"Add Task"})]})]}),e.jsx("div",{className:"space-y-4",children:c.tasks.map((a,s)=>{var t;return e.jsxs("div",{className:"p-4 bg-gray-100 rounded-lg space-y-3 relative",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(v,{className:"mb-1 block",children:"Task Title"}),e.jsx(y,{value:a.title,onChange:l=>x(s,"title",l.target.value),placeholder:"e.g. Plywood ,installation","aria-label":`Task ${s+1} Title`})]}),e.jsxs("div",{children:[e.jsx(v,{className:"mb-1 block",children:"Estimated (min)"}),e.jsx(y,{type:"number",value:a.estimatedTimeInMinutes,onChange:l=>x(s,"estimatedTimeInMinutes",l.target.value),placeholder:"0",inputMode:"numeric","aria-label":`Task ${s+1} Estimated Time in Minutes`})]}),e.jsx("div",{className:"flex items-end justify-end",children:e.jsxs(u,{size:"sm",className:"bg-red-600 text-white hover:bg-red-700 flex items-center gap-1",onClick:()=>o(s),children:[e.jsx("i",{className:"fa-solid fa-trash","aria-hidden":"true"}),e.jsx("span",{className:"sr-only",children:"Delete Task"}),e.jsx("span",{"aria-hidden":"true",children:"Delete"})]})})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx("h4",{className:"text-sm font-semibold",children:"Subtasks"}),a.subtasks.length===0&&e.jsxs(u,{size:"sm",onClick:()=>C(s),className:"flex items-center gap-1",children:[e.jsx("i",{className:"fa-solid fa-circle-plus","aria-hidden":"true"}),e.jsx("span",{className:"sr-only",children:"Add Subtask"}),e.jsx("span",{"aria-hidden":"true",children:"Add Subtask"})]})]}),e.jsx("div",{className:"space-y-3",children:(t=a==null?void 0:a.subtasks)==null?void 0:t.map((l,i)=>e.jsxs("div",{className:"flex  gap-3 bg-white p-3 rounded relative",children:[e.jsx("div",{className:"w-full",children:e.jsx(y,{value:l.title,onChange:n=>N(s,i,"title",n.target.value),placeholder:"Subtask title","aria-label":`Task ${s+1} Subtask ${i+1} Title`})}),e.jsx(u,{variant:"danger",type:"button",className:" text-white bg-red-600",onClick:()=>D(s,i),"aria-label":`Delete subtask ${i+1} from task ${s+1}`,title:"Delete Subtask",children:e.jsx("i",{className:"fa-solid fa-trash","aria-hidden":"true"})})]},i))})]},s)})})]}),e.jsx(q,{className:"px-6 pb-6",children:e.jsxs(u,{onClick:k,className:"flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-floppy-disk","aria-hidden":"true"}),e.jsx("span",{children:"Create Work"})]})})]})})]})},X=w.memo(U),ie=()=>{var k,a,s,t;const{organizationId:r}=S(),f=M(),[j,c]=w.useState(!1),{role:d,permission:m}=W(),b=d==="owner"||((k=m==null?void 0:m.stafftask)==null?void 0:k.list),p=d==="owner"||((a=m==null?void 0:m.stafftask)==null?void 0:a.create),{data:x=[],isLoading:g,error:o}=z(r),N=$(),C=async l=>{var i,n;try{await N.mutateAsync({workId:l,organizationId:r}),T({description:"Work Flow deleted successfully",title:"Success"})}catch(h){T({title:"Error",description:((n=(i=h==null?void 0:h.response)==null?void 0:i.data)==null?void 0:n.message)||"Failed to delete the work flow",variant:"destructive"})}};return location.pathname.includes("single")?e.jsx(E,{}):g?e.jsx(A,{}):e.jsxs("div",{className:"p-2 max-h-full overflow-y-auto",children:[e.jsxs("header",{className:"flex justify-between items-center w-full pb-2 border-b border-gray-300",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-code-fork mr-3 text-blue-600"}),"Work Library SOP"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your work flows"})]}),e.jsxs("section",{className:"flex gap-2 items-center",children:[p&&e.jsxs(u,{onClick:()=>c(!0),className:"bg-blue-600 flex items-center ",children:[e.jsx("i",{className:"fas fa-plus mr-1 text-white"}),"Add Work"]}),e.jsx("div",{className:"w-full sm:w-auto flex justify-end sm:block",children:e.jsx(K,{organizationId:r,stageName:"stafftask"})})]})]}),o&&e.jsxs("div",{className:"flex flex-col items-center  justify-center min-h-[300px] w-full bg-white rounded-xl text-center p-6",children:[e.jsx("i",{className:"fas fa-note text-5xl text-blue-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-1",children:"No WorkFlows Found"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Looks like there are no work flow created yet.",e.jsx("br",{}),"you can click ",e.jsx("strong",{children:" add work "})," to get started ðŸš€"]}),e.jsx("p",{className:"text-sm text-gray-500",children:((t=(s=o==null?void 0:o.response)==null?void 0:s.data)==null?void 0:t.message)||(o==null?void 0:o.message)||"something went wrong"})]}),j&&e.jsx(X,{organizationId:r,dialogOpen:j,setDialogOpen:c}),b&&e.jsxs(e.Fragment,{children:["   ",g?e.jsx("p",{children:e.jsx(A,{})}):!o&&(x==null?void 0:x.length)===0?e.jsxs("div",{className:"flex flex-col items-center  justify-center min-h-[300px] w-full bg-white rounded-xl text-center p-6",children:[e.jsx("i",{className:"fas fa-note text-5xl text-blue-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-1",children:"No WorkFlows Found"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Looks like there are no work flow created yet.",e.jsx("br",{}),"you can click ",e.jsx("strong",{children:" add work "})," to get started ðŸš€"]})]}):e.jsx("div",{className:"mt-4 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4  gap-4",children:x.map(l=>e.jsx(Q,{navigate:f,role:d,work:l,onDelete:C,deletePending:N.isPending},l._id))})]})]})};export{ie as default};
