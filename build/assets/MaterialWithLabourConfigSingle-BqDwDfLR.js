import{u as ne,a as ie,k as oe,r as g,j as e,M as le,B as c,t as p}from"./index-BAM0eJUz.js";import{I as L}from"./Input-1UBXZqEj.js";import{u as ce,a as de,b as me,c as ue,d as xe}from"./rateConfigLabourwithMaterialApi-BALcMkIx.js";function be({categoryId:d}){var M,F,z,A,I,P;const{organizationId:y}=ne(),q=ie();console.log("categoryId",d);const{data:$}=ce(y),{data:h,isLoading:B,refetch:N}=de(y,d),{mutateAsync:K,isPending:T}=me(),{mutateAsync:V,isPending:D}=ue(),{mutateAsync:G,isPending:U}=xe(),{role:w,permission:o}=oe(),S=w==="owner"||((M=o==null?void 0:o.materialwithlabourratequote)==null?void 0:M.create),H=w==="owner"||((F=o==null?void 0:o.materialwithlabourratequote)==null?void 0:F.delete),k=w==="owner"||((z=o==null?void 0:o.materialwithlabourratequote)==null?void 0:z.edit),[m,b]=g.useState([{data:{}}]),[J,C]=g.useState(!1),[R,f]=g.useState({}),[j,Q]=g.useState(""),i=(A=$||[])==null?void 0:A.find(t=>t._id===d),E=g.useMemo(()=>{if(!h)return[];if(!j.trim())return h;const t=i.fields[0].key;return h.filter(r=>{var a;return(((a=r.data[t])==null?void 0:a.toString().toLowerCase())||"").includes(j.toLowerCase())})},[h,j,i]);if(B)return e.jsx(le,{});if(!i)return e.jsx("p",{children:"Category not found"});const X=t=>{f({...t.data}),C(t._id)},Y=()=>{C(!1),f({})},Z=async t=>{var r,s;try{await G({itemId:t,body:R,categoryId:d}),p({title:"Success",description:"field update successfully"}),C(!1),f({}),N(),N()}catch(a){p({title:"Error",description:((s=(r=a==null?void 0:a.response)==null?void 0:r.data)==null?void 0:s.message)??"Operation failed"})}},ee=(t,r,s)=>{var O,W;const a=[...m];a[t].data[r]=s;const n=(W=(O=i.fields)==null?void 0:O[0])==null?void 0:W.key,l=t===a.length-1,u=r===n,x=(s==null?void 0:s.toString().trim())!=="",re=a.length>0&&Object.values(a[a.length-1].data).every(v=>v===void 0||v==="");if(l&&u&&x&&!re&&a.push({data:{}}),!x&&u&&m.length>1){const v=a[a.length-1];Object.values(v.data).every(_=>_===void 0||_==="")&&a.pop()}b(a)},te=()=>b([...m,{data:{}}]),ae=t=>{const r=[...m];r.splice(t,1),b(r)},se=async()=>{var t,r,s,a;try{const n=(r=(t=i.fields)==null?void 0:t[0])==null?void 0:r.key,l=m.map(u=>u.data).filter(u=>{const x=u[n];return x!=null&&x.toString().trim()!==""});if(l.length===0)return p({title:"Error",description:"Nothing to save",variant:"destructive"});await K({categoryId:d,items:l,organizationId:y}),p({title:"Success",description:"field created successfully"}),b([{data:{}}]),N()}catch(n){p({title:"Error",description:((a=(s=n==null?void 0:n.response)==null?void 0:s.data)==null?void 0:a.message)??"Operation failed"})}};return e.jsxs("div",{className:"space-y-4  ",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-end sm:items-center sticky top-0 bg-white z-10",children:[!d&&e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("button",{onClick:()=>q(-1),className:"bg-slate-50 hover:bg-slate-300 flex items-center justify-between w-8 h-8 border border-[#a6aab8] text-sm cursor-pointer rounded-md px-2 ",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:i.name}),e.jsx("span",{className:"block  text-gray-500",children:"* Enter the rupees per head (Every field will be added for single labour cost)"})]})]}),e.jsxs("div",{className:"flex gap-2 mt-3 sm:mt-0  absolute top-[-73px] right-[43px]  ",children:[e.jsxs("div",{className:"relative w-full sm:w-64",children:[e.jsx(L,{placeholder:`Search ${(P=(I=i.fields)==null?void 0:I[0])==null?void 0:P.key}...`,value:j,onChange:t=>Q(t.target.value),className:"pl-9 h-10 border-blue-100"}),e.jsx("i",{className:"fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm"})]}),(k||S)&&e.jsx(c,{onClick:te,variant:"primary",className:"",children:"+ Add Row"}),(k||S)&&e.jsxs(c,{onClick:se,isLoading:T,className:"bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx("i",{className:"fas fa-file mr-2"})," Save Items"]})]})]}),e.jsx("div",{className:"overflow-x-auto ",children:e.jsxs("table",{className:"min-w-full bg-white text-sm",children:[e.jsx("thead",{className:"bg-blue-50 text-sm font-semibold text-gray-600 px-6 py-1 sm:py-3",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-6 py-1 sm:py-3  text-xs font-medium text-gray-500 uppercase tracking-wider",children:"S.NO"}),i.fields.map(t=>e.jsx("th",{className:"text-center px-6 py-1 sm:py-3  text-xs font-medium text-gray-500 uppercase tracking-wider",children:t.key},t.key)),e.jsx("th",{className:"text-center px-6 py-1 sm:py-3  text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsxs("tbody",{children:[E==null?void 0:E.map((t,r)=>{var a;const s=J===t._id;return e.jsxs("tr",{className:`group border-b border-gray-100 transition-all duration-200 ${s?"bg-blue-50/30":"hover:bg-gray-50"}`,children:[e.jsx("td",{className:"border border-gray-100 font-medium text-center p-4 text-sm text-gray-700",children:r+1}),(a=i==null?void 0:i.fields)==null?void 0:a.map(n=>e.jsx("td",{className:"border border-gray-100 p-2 text-center",children:s?e.jsx(L,{type:n.type==="number"?"number":"text",value:R[n.key]||"",className:"w-full h-10 text-sm",onChange:l=>f({...R,[n.key]:n.type==="number"?Math.max(0,Number(l.target.value)):l.target.value})}):e.jsx("span",{className:"text-sm text-gray-700 font-medium",children:(t==null?void 0:t.data[n==null?void 0:n.key])??"â€”"})},n==null?void 0:n.key)),e.jsx("td",{className:"text-center p-4 border border-gray-100",children:e.jsx("div",{className:"flex justify-center gap-2",children:s?e.jsxs(e.Fragment,{children:[e.jsx(c,{size:"sm",variant:"primary",className:"text-white h-8",onClick:()=>Z(t._id),isLoading:U,children:e.jsx("i",{className:"fas fa-check"})}),e.jsx(c,{size:"sm",variant:"secondary",className:"  h-8",onClick:Y,children:e.jsx("i",{className:"fas fa-xmark"})})]}):e.jsxs(e.Fragment,{children:[k&&e.jsx(c,{size:"sm",variant:"ghost",className:"text-blue-600  h-8 w-8 p-0",onClick:()=>X(t),children:e.jsx("i",{className:"fas fa-pen-to-square"})}),H&&e.jsx(c,{size:"sm",variant:"danger",isLoading:D,className:"bg-red-600 text-white h-8 w-8 p-0",onClick:()=>V({itemId:t==null?void 0:t._id,organizationId:y}),children:e.jsx("i",{className:"fas fa-trash"})})]})})})]},`existing-${t==null?void 0:t._id}`)}),m.map((t,r)=>e.jsxs("tr",{className:`group relative border-none !border-b-1 px-4 py-2  cursor-pointer transition-all duration-200\r
                                    hover:bg-gray-50 hover:border-gray-300`,children:[e.jsx("td",{className:`border border-gray-100 px-4 font-medium text-center  \r
                                        text-sm text-gray-700 group-hover:text-gray-900 \r
                                        transition-colors duration-200`,children:h.length+r+1}),i.fields.map(s=>e.jsx("td",{className:"border border-gray-100 px-4 font-medium text-center  text-sm text-gray-700 group-hover:text-gray-900 transition-colors duration-200",children:e.jsx(L,{type:s.type==="number"?"number":"text",placeholder:s.key,className:"w-full rounded-md ",value:t.data[s.key]||"",onChange:a=>ee(r,s.key,s.type==="number"?Number(a.target.value):a.target.value)})},s.key)),e.jsx("td",{className:"text-center p-4 border border-gray-100",children:e.jsxs(c,{size:"sm",variant:"ghost",className:"group text-white bg-red-600 hover:bg-red-600",onClick:()=>ae(r),children:[e.jsx("i",{className:"fas fa-xmark mr-2"})," Remove"]})})]},`new-${r}`))]})]})})]})}export{be as default};
