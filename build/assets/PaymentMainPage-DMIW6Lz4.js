import{b as L,d as M,f as A,a as O,j as e,O as T}from"./index-e8sHY52i.js";import{t as f}from"./toast-BSC5QTk1.js";import{B as u}from"./Button-45UYJ-Fj.js";import{R}from"./ResetStageButton-CRxBbJsE.js";import{A as F,S as I}from"./AssignStaff-DLV2QBAB.js";import{c}from"./Card-DGP_bFuc.js";import{u as B,a as D,b as G}from"./paymentConfirmationApi-BIgc-CGk.js";import z from"./MaterialOverviewLoading-Dup0y_YN.js";import{S as E}from"./ShareDocumentWhatsapp-wLKTdZ9m.js";import"./roleCheck-DbhaipVR.js";import"./useMutation-BqjQ-Xv_.js";import"./Input-BH7aLFkl.js";import"./getAllUsersApi-CSaJikjA.js";import"./useQuery-CqjHwNP0.js";import"./Skeleton-C9CSd2lw.js";import"./documentationApi-C447Be6X.js";const W=[{title:"Consent Form",description:"Review and accept client consent agreements.",icon:"📝",path:"consent"},{title:"Schedule Approval",description:"Manage milestone approvals from client & MD.",icon:"📅",path:"schedule"},{title:"Payment Transaction",description:"Track actual payment gateway transactions.",icon:"💳",path:"transaction"}],ie=()=>{var d,x;const{projectId:i,organizationId:g}=L(),{isMobile:h,openMobileSidebar:b}=M(),o=A(),j=O(),{data:n,isLoading:N,isError:t,refetch:r}=B(i),{mutateAsync:w,isPending:y}=D(),{mutateAsync:v,isPending:C}=G();if(o.pathname.includes("/consent")||o.pathname.includes("/schedule")||o.pathname.includes("/transaction"))return e.jsx(T,{});const S=async()=>{var a,p;try{await w({projectId:i}),f({title:"Success",description:"Completion status updated successfully"}),r()}catch(l){f({title:"Error",description:((p=(a=l==null?void 0:l.response)==null?void 0:a.data)==null?void 0:p.message)||l.message||"Failed to update completion status",variant:"destructive"})}};if(N)return e.jsx(z,{});const{assignedTo:P,timer:s,totalAmount:m,_id:k}=n||{};return e.jsxs("div",{className:"container mx-auto p-2 max-w-full max-h-full overflow-y-auto",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4 mb-6",children:[e.jsxs("h2",{className:"text-2xl sm:text-3xl font-semibold text-blue-600 flex items-center",children:[h&&e.jsx("button",{onClick:b,className:"mr-3 p-2 rounded-md border-gray-300 hover:bg-gray-100",title:"Open Menu",children:e.jsx("i",{className:"fa-solid fa-bars"})}),e.jsx("i",{className:"fa-solid fa-sack-dollar mr-2"})," Payment Confirmation"]}),e.jsxs("div",{className:"!w-[100%] sm:!w-[80%] lg:w-[50%] flex flex-col sm:flex-row gap-3 justify-end",children:[e.jsx("div",{className:"flex flex-wrap sm:flex-nowrap gap-2 justify-end",children:e.jsxs(u,{isLoading:y,onClick:S,className:"bg-green-600 hover:bg-green-700 text-white flex-1 sm:flex-initial min-w-max",children:[e.jsx("i",{className:"fa-solid fa-circle-check mr-2"}),"Mark Complete"]})}),e.jsxs("div",{className:"flex flex-wrap sm:flex-nowrap gap-2 justify-end",children:[e.jsx(R,{stageNumber:7,stagePath:"paymentconfirmation",projectId:i,className:"flex-1 sm:flex-initial min-w-max"}),!t&&e.jsx(E,{projectId:i,stageNumber:"7",className:"w-full sm:w-fit",isStageCompleted:n==null?void 0:n.status}),e.jsx(F,{stageName:"PaymentConfirmationModel",projectId:i,organizationId:g,currentAssignedStaff:P||null,className:"flex-1 sm:flex-initial min-w-max"})]})]})]}),t&&e.jsxs("div",{className:"max-w-xl mx-auto p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center mb-6",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2",children:"⚠️ Error Occurred"}),e.jsx("p",{className:"text-red-500 text-sm mb-4",children:((x=(d=t==null?void 0:t.response)==null?void 0:d.data)==null?void 0:x.message)||(t==null?void 0:t.message)||"Failed to load payment confirmation data"}),e.jsx(u,{onClick:()=>r(),className:"bg-red-600 text-white px-4 py-2",children:"Retry"})]}),!t&&e.jsxs(e.Fragment,{children:[e.jsxs(c,{className:"p-4 mb-6 w-full shadow border-l-4 border-blue-600 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-3 text-blue-700 text-sm font-medium mb-2",children:[e.jsx("i",{className:"fa-solid fa-clock text-blue-500 text-lg"}),e.jsx("span",{children:"Stage Timings"})]}),e.jsx(I,{completedAt:s==null?void 0:s.completedAt,stageName:"paymentconfirmation",formId:k,projectId:i,deadLine:s==null?void 0:s.deadLine,startedAt:s==null?void 0:s.startedAt,refetchStageMutate:r,deadLineMutate:v,isPending:C})]}),e.jsxs(c,{className:"p-4 mb-6 bg-blue-50 border-l-4 border-blue-600 shadow-md",children:[e.jsxs("div",{className:"text-lg font-semibold text-blue-800 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-wallet"}),"Total Payment Amount"]}),e.jsxs("p",{className:"text-3xl text-blue-700 mt-2 font-bold",children:["₹ ",(m==null?void 0:m.toLocaleString())||0]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6",children:W.map(a=>e.jsx("div",{onClick:()=>j(a.path),className:"cursor-pointer",children:e.jsxs(c,{className:"hover:shadow-xl border-l-6 border-blue-600 transition bg-blue-100 p-4 sm:p-6 !rounded-xl h-full flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-4xl",children:a.icon}),e.jsx("h3",{className:"text-xl mt-3 font-bold text-blue-800",children:a.title}),e.jsx("p",{className:"text-sm text-blue-700 mt-2",children:a.description})]}),e.jsx("div",{className:"mt-4 text-right",children:e.jsxs("span",{className:"inline-block bg-blue-600 text-white text-xs px-3 py-1 rounded",children:["Go to ",a.title]})})]})},a.path))})]})]})};export{ie as default};
