import{c as J,r as u,d as K,j as e,B as v}from"./index-DyM6T-eT.js";import{u as W}from"./vendorAccApi-BYqYKQFF.js";import{S as X}from"./SearchSelectNew-BTs46di7.js";import{L as q}from"./Label-B3hr6461.js";const ae=({mode:f,initialData:n,onSubmit:E,isSubmitting:y,organizationId:T})=>{var F,O,k,V;const w=J(),[N,Y]=u.useState(f),{data:h}=W(T),C={vendorId:"",vendorName:"",deliveryAddress:"",purchaseDate:new Date().toISOString().split("T")[0],deliveryDate:new Date(Date.now()+10*24*60*60*1e3).toISOString().split("T")[0],items:[{itemName:"",rate:0,quantity:1,totalCost:0}],notes:"",termsAndConditions:""},{role:I,permission:i}=K(),P=I==="owner"||((F=i==null?void 0:i.purchaseorder)==null?void 0:F.create),R=I==="owner"||((O=i==null?void 0:i.purchaseorder)==null?void 0:O.edit),[p,S]=u.useState(!1),[r,c]=u.useState(C),[A,U]=u.useState({totalAmount:0});u.useEffect(()=>{n&&(c({vendorId:n.vendorId||"",vendorName:n.vendorName||"",deliveryAddress:n.deliveryAddress||"",purchaseDate:n.purchaseDate?new Date(n.purchaseDate).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],deliveryDate:n.deliveryDate?new Date(n.deliveryDate).toISOString().split("T")[0]:new Date(Date.now()+10*24*60*60*1e3).toISOString().split("T")[0],items:n.items||[{itemName:"",rate:0,quantity:1,totalCost:0}],notes:n.notes||"",termsAndConditions:n.termsAndConditions||""}),f==="view"&&S(!0))},[n]),u.useEffect(()=>{const s=r.items.reduce((t,a)=>t+(a.totalCost||0),0);U({totalAmount:s})},[r.items]);const _=(k=h||[])==null?void 0:k.map(s=>({value:s._id,label:s.vendorName,email:s.email})),b=s=>{const{name:t,value:a}=s.target;c(l=>({...l,[t]:a}))},B=()=>{c(s=>({...s,items:[...s.items,{itemName:"",quantity:1,rate:0,totalCost:0}]}))},L=s=>{c(t=>({...t,items:t.items.filter((a,l)=>l!==s)}))},j=(s,t,a)=>{c(l=>{const m=[...l.items],o={...m[s]};if(t==="itemName"){const g=o.itemName;o.itemName=a;const G=s===l.items.length-1,Q=g.trim()==="",H=a.trim()!=="";G&&Q&&H&&m.push({itemName:"",quantity:1,rate:0,totalCost:0})}else if(t==="quantity"||t==="rate"){const g=typeof a=="string"?parseFloat(a)||0:a;o[t]=g<0?0:g,o.totalCost=o.quantity*o.rate}return m[s]=o,{...l,items:m}})},$=s=>{const t=[];return s.vendorName.trim()||t.push("Vendor name is required"),s.items.forEach((a,l)=>{a.itemName.trim()||t.push(`Item ${l+1}: Item name is required`),a.rate<=0&&t.push(`Item ${l+1}: Rate must be greater than 0`)}),t},z=s=>{const t=h==null?void 0:h.find(a=>a._id===s);c(a=>({...a,vendorId:s||"",vendorName:(t==null?void 0:t.vendorName)||""}))},M=async s=>{s.preventDefault();const t=r.items.filter(o=>o.itemName.trim()!==""),a={...r,items:t},l=$(a);if(l.length>0){alert(l.join(`
`));return}const m={...a,organizationId:"",totalAmount:A.totalAmount};await E(m),c(C)},d=N==="view",x=N==="create",D=N==="edit";return e.jsxs("div",{className:"max-w-full mx-auto space-y-2",children:[e.jsx("header",{className:"flex justify-between items-center",children:e.jsxs("div",{className:"flex justify-between items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>w(-1),className:"bg-blue-100 hover:bg-slate-300 flex items-center justify-between w-8 h-8 border border-[#a6aab8] text-sm cursor-pointer rounded-md px-2 ",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-wallet mr-3 text-blue-600"}),x?"Create Order":D?"Update Order":"View Order"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:x?"Fill in the details to create a new Purchase":D?"Update the Purchase details":"Purchase details"})]})]})}),e.jsxs("form",{onSubmit:M,className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx("i",{className:"fas fa-file-alt mr-2 text-blue-600"}),"purchase Details"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(q,{children:"Vendor"}),e.jsx(X,{options:_,placeholder:"Select Vendor",searchPlaceholder:"Search Vendor...",value:(r==null?void 0:r.vendorId)||void 0,onValueChange:s=>z(s),searchBy:"name",displayFormat:"simple",className:"w-full"})]}),e.jsxs("div",{className:"",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"checkbox",className:"cursor-pointer",checked:p,id:"enableName",onChange:()=>S(s=>!s)}),e.jsx(q,{htmlFor:"enableName",className:"cursor-pointer",children:"Click the check box to enter the name manually, if not available from the drop down"})]}),e.jsx("input",{type:"text",name:"vendorName",value:p?r.vendorName:"",onChange:s=>{p&&b(s)},disabled:d||!p,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",placeholder:"Enter Vendor name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Purchase Date"}),e.jsx("input",{type:"date",name:"purchaseDate",value:r.purchaseDate,onChange:b,disabled:d,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"DeliveryDate Date"}),e.jsx("input",{type:"date",name:"deliveryDate",value:r.deliveryDate,onChange:b,disabled:d,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-list mr-2 text-blue-600"}),"Items ",e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),!d&&e.jsxs(v,{type:"button",onClick:B,variant:"primary",children:[e.jsx("i",{className:"fas fa-plus mr-2"}),"Add Item"]})]}),((V=r==null?void 0:r.items)==null?void 0:V.length)===0&&f==="view"?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("i",{className:"fas fa-inbox text-4xl mb-2"}),e.jsx("p",{children:"No items added yet."})]}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-3 mb-2 px-4 py-3 bg-gray-100 rounded-lg font-semibold text-gray-700 text-sm",children:[e.jsx("div",{className:"col-span-1 text-center",children:"#"}),e.jsxs("div",{className:"col-span-4 text-center",children:["Item Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"col-span-2 text-center",children:"Quantity"}),e.jsxs("div",{className:"col-span-2 text-center",children:["Rate ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"col-span-2 text-center",children:"Total"}),e.jsx("div",{className:"col-span-1 text-center",children:"Action"})]}),e.jsx("div",{className:"space-y-2",children:r.items.map((s,t)=>e.jsxs("div",{className:"grid grid-cols-12 gap-3 px-4 py-3 bg-white border border-gray-200 rounded-lg hover:border-blue-300 transition-colors items-center",children:[e.jsx("div",{className:"col-span-1 text-center text-gray-600 font-medium",children:t+1}),e.jsx("div",{className:"col-span-4",children:e.jsx("input",{type:"text",value:s.itemName,onChange:a=>j(t,"itemName",a.target.value),disabled:d,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed text-sm",placeholder:"Enter item name"})}),e.jsx("div",{className:"col-span-2",children:e.jsx("input",{type:"number",value:s.quantity,onChange:a=>j(t,"quantity",a.target.value),disabled:d,min:"0",step:"1",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed text-sm",placeholder:"0"})}),e.jsx("div",{className:"col-span-2",children:e.jsx("input",{type:"number",value:s.rate,onChange:a=>j(t,"rate",a.target.value),disabled:d,min:"0",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed text-sm",placeholder:"0.00"})}),e.jsxs("div",{className:"col-span-2 text-center font-semibold text-gray-900",children:["₹",s.totalCost.toFixed(2)]}),e.jsx("div",{className:"col-span-1 text-center",children:!d&&e.jsx("button",{type:"button",onClick:()=>L(t),disabled:r.items.length===1,className:"text-red-600 cursor-pointer hover:text-red-800 disabled:text-gray-400 disabled:cursor-not-allowed p-2 rounded-full hover:bg-red-50 transition-colors",title:r.items.length===1?"Cannot delete last item":"Delete item",children:e.jsx("i",{className:"fas fa-trash"})})})]},t))}),e.jsxs("div",{className:"grid grid-cols-12 gap-3 px-4 py-3 bg-blue-50 rounded-lg mt-4 font-semibold text-gray-800",children:[e.jsx("div",{className:"col-span-9 text-right",children:"Subtotal:"}),e.jsxs("div",{className:"col-span-2 text-right text-blue-600 text-lg",children:["₹",A.totalAmount.toFixed(2)]}),e.jsx("div",{className:"col-span-1"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx("i",{className:"fas fa-comment-alt mr-2 text-blue-600"}),"Additional Information"]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("textarea",{name:"notes",value:r.notes,onChange:b,disabled:d,rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed resize-none",placeholder:"Add any notes for the Vendor..."})]})})]}),!d&&(P||R)&&e.jsxs("div",{className:"flex justify-end gap-4 pt-6",children:[e.jsxs(v,{type:"button",onClick:()=>w(-1),className:"bg-gray-500 text-white px-6 py-2",disabled:y,children:[e.jsx("i",{className:"fas fa-times mr-2"}),"Cancel"]}),e.jsx(v,{type:"submit",className:"bg-blue-600 text-white px-6 py-2",disabled:y,children:y?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin mr-2"}),x?"Creating...":"Updating..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:`fas ${x?"fa-plus":"fa-save"} mr-2`}),x?"Create Order":"Update Order"]})})]})]})]})};export{ae as P};
