import{a as U,r as i,j as e}from"./index-CqEiDvr_.js";import{A as D}from"./constants-DnylCaPP.js";import{a as _,b as T,c as V}from"./adminWallPaintingApi-BOoY2rGx.js";import{d as q}from"./downloadFile-BF_lyJpu.js";import{t as d}from"./toast-BSC5QTk1.js";import{B as b}from"./Button-DzcQpMPj.js";import G from"./MaterialOverviewLoading-DjqpQRJC.js";import"./useQuery-DyvuN1xf.js";import"./useMutation-DDHgQq3T.js";import"./roleCheck-BJ07f95N.js";import"./Skeleton-DMaf5_kG.js";function te(){var w,y,k,S;const{projectId:c,stepId:g,stepNumber:m}=U(),[u,C]=i.useState(""),[l,I]=i.useState(null),[L,x]=i.useState(!1),[h,f]=i.useState(null),{mutateAsync:A,isPending:j,variables:o}=_(),{mutateAsync:P,isPending:z}=T(),{data:n,isLoading:E}=V(c,g),p=D.find(s=>s.stepNumber===Number(m)),M=()=>{x(!1)},W=()=>{x(!1)},B=(s,t)=>{f({url:s,alt:t})},v=()=>{f(null)},F=async()=>{var s,t;try{if((!l||(l==null?void 0:l.length)===0)&&!u){alert("Please select files or write something in notes");return}const r=new FormData;if(l&&l.length)for(let a=0;a<l.length;a++)r.append("files",l[a]);r.append("adminNote",u),await P({projectId:c,stepNumber:m,formData:r}),d({description:"images uploaded successfully",title:"Success"})}catch(r){d({title:"Error",description:((t=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to upload image",variant:"destructive"})}},N=async({status:s})=>{var t,r;try{await A({projectId:c,stepId:g,payload:{status:s}}),d({description:"status updated successfully",title:"Success"})}catch(a){d({title:"Error",description:((r=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:r.message)||"Failed to update status",variant:"destructive"})}};if(E)return e.jsx(G,{});if(!p)return e.jsx("div",{className:"min-h-full flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"âŒ"}),e.jsx("h2",{className:"text-2xl font-bold text-blue-800 mb-2",children:"Step Not Found"}),e.jsx("p",{className:"text-blue-600",children:"The requested step could not be found."})]})});const R=({src:s,alt:t})=>e.jsxs("div",{className:"relative group cursor-pointer",onClick:()=>B(s,t),children:[L&&e.jsx("div",{className:"pointer-events-none absolute inset-0 bg-gray-200 animate-pulse rounded-lg flex items-center justify-center z-10",children:e.jsx("div",{className:"w-8 h-8 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"})}),e.jsx("img",{src:s,alt:t,loading:"lazy",className:"w-full h-32 sm:h-40 md:h-48 object-cover rounded-lg border-2 border-blue-200 shadow-sm hover:shadow-lg transition-all duration-300 hover:border-blue-400 cursor-pointer",onLoadStart:()=>x(!0),onLoad:M,onError:W}),e.jsx("button",{onClick:r=>{r.stopPropagation(),q({src:s,alt:t})},className:"absolute cursor-pointer bottom-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300 bg-blue-600 text-white p-2 rounded-full shadow hover:bg-blue-700",title:"Download",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v2a2 2 0 002 2h12a2 2 0 002-2v-2M8 12l4 4m0 0l4-4m-4 4V4"})})})]});return e.jsxs("div",{className:"min-h-[80%] bg-gray-50 rounded-xl",children:[h&&e.jsxs("div",{className:"fixed inset-0 bg-black/70  flex items-center justify-center z-50 p-4",children:[e.jsxs("div",{className:"relative max-w-4xl max-h-full",children:[e.jsx("button",{onClick:v,className:"absolute -top-10 right-0 text-white hover:text-blue-300 transition-colors z-10",children:e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("img",{src:h.url,alt:h.alt,className:"max-w-full max-h-full object-contain rounded-lg"})]}),e.jsx("div",{className:"absolute inset-0 -z-10",onClick:v})]}),e.jsx("div",{className:"w-full h-full ",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden",children:[e.jsx("div",{className:"bg-white px-2 py-3 sm:px-6 sm:py-4",children:e.jsxs("h1",{className:"text-2xl sm:text-3xl font-semibold text-blue-600 mb-2",children:[" ",`${m})`," "," ",p.label]})}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6 !w-[96%] mx-auto",children:[e.jsxs("h2",{className:"text-xl font-semibold text-blue-800 mb-4 flex items-center",children:[e.jsx("span",{className:"mr-2",children:"âš¡"}),"Review Actions"]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs(b,{isLoading:j&&((w=o==null?void 0:o.payload)==null?void 0:w.status)==="approved",onClick:()=>N({status:"approved"}),className:"flex-1 px-6 py-3 bg-green-600 hover:bg-green-700 text-white font-medium rounded-lg transition-colors duration-200 shadow-sm hover:shadow-md flex items-center justify-center",children:[e.jsx("span",{className:"mr-2",children:"âœ…"}),"Approve Step"]}),e.jsxs(b,{isLoading:j&&((y=o==null?void 0:o.payload)==null?void 0:y.status)==="rejected",onClick:()=>N({status:"rejected"}),className:"flex-1 px-6 py-3 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg transition-colors duration-200 shadow-sm hover:shadow-md flex items-center justify-center",children:[e.jsx("span",{className:"mr-2",children:"âŒ"}),"Reject Step"]})]})]}),e.jsx("div",{className:"sm:max-h-[calc(100vh-150px)] max-h-[calc(100vh-85px)]  overflow-y-auto custom-scrollbar",children:e.jsxs("div",{className:"p-2 sm:px-6 sm:py-3 space-y-8",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-blue-800 mb-4 flex items-center",children:[e.jsx("span",{className:"mr-2",children:"ðŸ“‹"}),"Step Requirements"]}),e.jsx("ul",{className:"space-y-2",children:p.rules.map((s,t)=>e.jsxs("li",{className:"flex items-start text-blue-700",children:[e.jsx("span",{className:"text-blue-500 mr-3 mt-0.5",children:"âœ…"}),e.jsx("span",{children:s})]},t))})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-blue-800 mb-4 flex items-center",children:[e.jsx("span",{className:"mr-2",children:"ðŸ‘·"}),"Worker latest Uploads"]}),(S=(k=n==null?void 0:n.step)==null?void 0:k.workerInitialUploads)!=null&&S.length?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-4",children:n.step.workerInitialUploads.map((s,t)=>e.jsx("div",{className:"bg-white border border-blue-200 rounded-lg p-3 shadow-sm",children:s.type==="image"?e.jsx(R,{src:s==null?void 0:s.url,alt:(s==null?void 0:s.originalName)||`Upload ${t+1}`}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-32 sm:h-40 md:h-48 bg-blue-50 rounded-lg border-2 border-dashed border-blue-300",children:[e.jsx("div",{className:"text-blue-600 mb-2",children:e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),e.jsx("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline text-sm text-center px-2 font-medium",children:s.originalName})]})},t))}):e.jsxs("div",{className:"text-center py-8 text-blue-500",children:[e.jsx("div",{className:"text-4xl mb-2",children:"ðŸ“"}),e.jsx("p",{className:"font-medium",children:"No initial uploads found."})]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-blue-800 mb-4 flex items-center",children:[e.jsx("span",{className:"mr-2",children:"ðŸ“"}),"Add Correction"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-blue-700 mb-2",children:"Add Correction Note"}),e.jsx("textarea",{rows:4,value:u,onChange:s=>C(s.target.value),placeholder:"Provide detailed feedback and correction instructions...",className:"w-full p-3 border border-blue-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-blue-700 mb-2",children:"Correction Images:"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx("input",{type:"file",multiple:!0,onChange:s=>I(s.target.files),className:"flex-1 text-sm text-blue-600 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-medium file:bg-blue-100 file:text-blue-700 hover:file:bg-blue-200 file:cursor-pointer border border-blue-200 rounded-lg"}),e.jsx(b,{onClick:F,isLoading:z,className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors duration-200 shadow-sm hover:shadow-md",children:"Submit Correction"})]})]})]})]})]})})]})})]})}export{te as default};
