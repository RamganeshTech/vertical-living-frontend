import{j as e,B as S,u as K,a as W,q as H,b as J,av as de,e as F,C as me,f as xe,H as ue,aj as pe,t as Q,c as Y,r as T,z as X,aw as ge,M as he,d as fe,at as ye,an as Ne,O as je}from"./index-CBsAK0nv.js";import{S as be,a as we,b as ve,c as Ce,d as Me}from"./Select-trVCFi4L.js";import{S as Se}from"./StageGuide-DK1G5Ici.js";const z={plywood:1,laminate:1},Te=()=>({itemName:"",plywoodNos:{quantity:0,thickness:0},laminateNos:{quantity:0,thickness:0},carpenters:0,days:0,profitOnMaterial:0,profitOnLabour:0,rowTotal:0,remarks:""}),V=()=>({itemName:"",description:"",quantity:0,cost:0,rowTotal:0}),R=(t,x)=>{if(t.length===0)return[];const c=t.length,h=t[0],y=h.carpenters*h.days*x*(1+(h.profitOnLabour||0)/100)/c;return t.map(C=>{var s,o;const v=((s=C.plywoodNos)==null?void 0:s.quantity)||0,l=((o=C.laminateNos)==null?void 0:o.quantity)||0,a=(v*z.plywood+l*z.laminate)*(1+(C.profitOnMaterial||0)/100);return{...C,rowTotal:Math.round(a+y)}})},ke=({data:t,labourCost:x,updateFurniture:c,removeFurniture:h})=>{const g=l=>{const a=l.coreMaterials.reduce((n,d)=>n+d.rowTotal,0),s=l.fittingsAndAccessories.reduce((n,d)=>n+d.rowTotal,0),o=l.glues.reduce((n,d)=>n+d.rowTotal,0),r=l.nonBrandMaterials.reduce((n,d)=>n+d.rowTotal,0);return{core:a,fittings:s,glues:o,nbms:r,furnitureTotal:a+s+o+r}},f=(l,a,s)=>{var j;const o=[...t.coreMaterials];a==="imageUrl"?(o[l].imageUrl=s,o[l].previewUrl=URL.createObjectURL(s)):a==="plywoodNos"||a==="laminateNos"?o[l][a]={...o[l][a]||{},...s}:o[l][a]=s;const r=R(o,x),n=((j=r==null?void 0:r[0])==null?void 0:j.profitOnMaterial)||0,d=(u,i=!1)=>u.map(b=>{const k=n,A=i?b.cost||0:(b.quantity||0)*(b.cost||0),I=A*(k/100),U=Math.round(A+I);return{...b,profitOnMaterial:k,rowTotal:U}}),M={...t,coreMaterials:r,fittingsAndAccessories:d(t.fittingsAndAccessories),glues:d(t.glues,!0),nonBrandMaterials:d(t.nonBrandMaterials)};M.totals=g(M),c==null||c(M)},y=(l,a,s,o)=>{const r=[...t[l]];if(r[a][s]=o,l!=="glues"){const j=(r[a].quantity||0)*(r[a].cost||0),u=j*((r[a].profitOnMaterial||0)/100);r[a].rowTotal=Math.round(j+u)}else{const j=r[a].cost||0,u=j*((r[a].profitOnMaterial||0)/100);r[a].rowTotal=Math.round(j+u)}const n=a===r.length-1,d=r[a].itemName||r[a].description||r[a].quantity||r[a].cost;n&&d&&r.push(V());const M={...t,[l]:r};M.totals=g(M),c&&c(M)},C=()=>e.jsxs("div",{className:"mt-4",children:[e.jsxs("h3",{className:"font-semibold text-md mb-2",children:["Core Materials - Total: ₹",t==null?void 0:t.totals.core.toLocaleString("en-IN")]}),e.jsx("div",{className:"overflow-x-auto  rounded-md",children:e.jsxs("table",{className:"min-w-full text-sm bg-white shadow-sm",children:[e.jsxs("thead",{className:"bg-blue-50 text-sm font-semibold text-gray-600",children:[e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Image"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Item Name"}),e.jsx("th",{className:"text-center px-6 py-1 text-xs font-medium text-gray-500 uppercase tracking-wider",colSpan:2,children:"Plywood"}),e.jsx("th",{className:"text-center px-6 py-1 text-xs font-medium text-gray-500 uppercase tracking-wider",colSpan:2,children:"Laminate"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"No. of Carpenters / Day"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"No. of Days"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Profit % Material"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Profit % Labour"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Remarks"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Total"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",rowSpan:2,children:"Actions"})]}),e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-6 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Qty"}),e.jsx("th",{className:"text-center px-6 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Thk"}),e.jsx("th",{className:"text-center px-6 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Qty"}),e.jsx("th",{className:"text-center px-6 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Thk"})]})]}),e.jsx("tbody",{children:t.coreMaterials.map((l,a)=>e.jsxs("tr",{className:"group relative border-none !border-b-1 px-4 py-2 transition-all duration-150 hover:bg-gray-50",children:[a===0&&e.jsxs("td",{rowSpan:t.coreMaterials.length,children:[e.jsx("input",{type:"file",className:"w-full px-2 py-3 text-center outline-none",onChange:s=>{var o;return f(0,"imageUrl",(o=s.target.files)==null?void 0:o[0])}}),l.previewUrl&&e.jsx("img",{src:l.previewUrl,className:"h-10 mt-2 mx-auto"})]}),e.jsx("td",{className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{value:l.itemName,placeholder:"TV Unit | Wardrobe",onChange:s=>f(a,"itemName",s.target.value),className:"w-full px-2 py-1 text-center outline-none"})}),["plywoodNos","laminateNos"].map(s=>["quantity","thickness"].map(o=>e.jsx("td",{className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",value:l[s][o],onChange:r=>{Number(r.target.value)>=0&&f(a,s,{...l[s],[o]:Number(r.target.value)})},className:"w-full px-2 py-1 text-center outline-none"})},`${s}-${o}`))),a===0&&e.jsxs(e.Fragment,{children:[e.jsx("td",{rowSpan:t.coreMaterials.length,className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",value:l.carpenters,onChange:s=>f(a,"carpenters",Number(s.target.value)),className:"w-full px-2 py-1 text-center outline-none"})}),e.jsx("td",{rowSpan:t.coreMaterials.length,className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",value:l.days,onChange:s=>f(a,"days",Number(s.target.value)),className:"w-full px-2 py-1 text-center outline-none"})})]}),e.jsx("td",{className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",value:l.profitOnMaterial,onChange:s=>f(a,"profitOnMaterial",Number(s.target.value)),className:"w-full px-2 py-1 text-center outline-none"})}),a===0&&e.jsx(e.Fragment,{children:e.jsx("td",{rowSpan:t.coreMaterials.length,className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",value:l.profitOnLabour,onChange:s=>f(a,"profitOnLabour",Number(s.target.value)),className:"w-full px-2 py-1 text-center outline-none"})})}),e.jsx("td",{className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{value:l.remarks,placeholder:"remarks",onChange:s=>f(a,"remarks",s.target.value),className:"w-full px-2 py-1 text-center outline-none"})}),e.jsxs("td",{className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:["₹",l.rowTotal.toLocaleString("en-IN")]}),e.jsx("td",{className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx(S,{variant:"danger",onClick:()=>{const s=[...t.coreMaterials];s.splice(a,1);const o=R(s,x),r={...t,coreMaterials:o};r.totals=g(r),c==null||c(r)},className:"px-1 text-xs bg-red-600 text-white",children:"Remove"})})]},a))})]})}),e.jsx("div",{className:"mt-2 text-right",children:e.jsx(S,{onClick:()=>{const l=[...t.coreMaterials,Te()],a=R(l,x),s={...t,coreMaterials:a};s.totals=g(s),c==null||c(s)},children:"+ Add Core Material"})})]}),v=(l,a)=>{var s;return e.jsxs("div",{className:"mt-6",children:[e.jsxs("h3",{className:"font-semibold text-md mb-2",children:[l," - Total: ₹",(s=t==null?void 0:t.totals[a==="fittingsAndAccessories"?"fittings":a])==null?void 0:s.toLocaleString("en-IN")]}),e.jsx("div",{className:"overflow-x-auto  rounded-md",children:e.jsxs("table",{className:"min-w-full text-sm bg-white shadow-sm",children:[e.jsx("thead",{className:"bg-blue-50 text-sm font-semibold text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Item Name"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Description"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Quantity"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cost"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Profit %"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{children:t[a].map((o,r)=>e.jsxs("tr",{className:"group relative border-none !border-b-1 px-4 !py-2 transition-all duration-150 hover:bg-gray-50",children:[e.jsx("td",{className:"p-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{value:o.itemName||"",placeholder:"Item Name",onChange:n=>y(a,r,"itemName",n.target.value),className:"w-full px-2 py-1 text-center outline-none"})}),e.jsx("td",{className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{value:o.description,placeholder:"description",onChange:n=>y(a,r,"description",n.target.value),className:"w-full px-2 py-1 text-center outline-none"})}),e.jsx("td",{className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",value:o.quantity,onChange:n=>{Number(n.target.value)>=0&&y(a,r,"quantity",Number(n.target.value))},className:"w-full px-2 py-1 text-center outline-none"})}),e.jsx("td",{className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",value:o.cost,onChange:n=>y(a,r,"cost",Number(n.target.value)),className:"w-full px-2 py-1 text-center outline-none"})}),e.jsx("td",{className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx("input",{type:"number",value:o.profitOnMaterial??0,onChange:n=>y(a,r,"profitOnMaterial",Number(n.target.value)),className:"w-16 text-center border border-gray-300 rounded px-2 py-1 text-sm"})}),e.jsxs("td",{className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:["₹",o.rowTotal.toLocaleString("en-IN")]}),e.jsx("td",{className:"px-2 border border-gray-100 text-center text-sm text-gray-700 font-medium transition-colors duration-200 group-hover:text-gray-900",children:e.jsx(S,{variant:"danger",onClick:()=>{const n=[...t[a]];n.splice(r,1);const d={...t,[a]:n};d.totals=g(d),c&&c(d)},className:"px-1 text-xs bg-red-600 text-white",children:"Remove"})})]},r))})]})}),e.jsx("div",{className:"mt-2 text-right",children:e.jsxs(S,{onClick:()=>{const o=[...t[a],V()],r={...t,[a]:o};r.totals=g(r),c&&c(r)},children:["+ Add ",l," Item"]})})]})};return e.jsxs("div",{className:"shadow-md p-4 my-4 border rounded-lg bg-white",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-700",children:["Product: ",t.furnitureName]}),h&&e.jsx(S,{variant:"danger",size:"sm",onClick:h,className:"bg-red-600 text-white",children:"Remove Product"})]}),C(),v("Fittings","fittingsAndAccessories"),v("Glues","glues"),v("Non-Branded Materials","nonBrandMaterials"),e.jsxs("div",{className:"mt-6 text-right text-xl text-green-700 font-bold",children:["Product Total: ₹",t.totals.furnitureTotal.toLocaleString("en-IN")]})]})},Ae=async({api:t,organizationId:x,projectId:c,formData:h})=>{const{data:g}=await t.post(`/quote/quotegenerate/createquote/${x}/${c}`,h,{headers:{"Content-Type":"multipart/form-data"}});if(!g.ok)throw new Error(g.message||"Failed to create quote.");return g.data},Ie=async({api:t,organizationId:x,id:c,projectId:h,formData:g})=>{const f=await t.put(`/quote/quotegenerate/editquote/${x}/${h}/${c}`,g);if(!f.data.ok)throw new Error(f.data.message||"Failed to create quote.");return f.data.data},Qe=()=>{const t=["owner","staff","CTO"],{role:x}=K(),c=J(x);return W({mutationFn:async({organizationId:h,projectId:g,formData:f})=>{if(!x||!t.includes(x))throw new Error("Not allowed to create quotes");if(!c)throw new Error("API instance for role not found");return await Ae({api:c,organizationId:h,projectId:g,formData:f})},onSuccess:(h,{organizationId:g})=>{H.invalidateQueries({queryKey:["quote-material-items",g]})}})},Oe=()=>{const t=["owner","staff","CTO"],{role:x}=K(),c=J(x);return W({mutationFn:async({organizationId:h,projectId:g,formData:f,id:y})=>{if(!x||!t.includes(x))throw new Error("Not allowed to create quotes");if(!c)throw new Error("API instance for role not found");return await Ie({api:c,organizationId:h,projectId:g,formData:f,id:y})},onSuccess:(h,{organizationId:g})=>{H.invalidateQueries({queryKey:["quote-material-items",g]})}})},Pe=({quote:t,organizationId:x,setFurnitures:c,setIsEditingId:h,setQuoteType:g,setEditQuoteNo:f,setFiltersMain:y})=>{var r,n,d;const{mutateAsync:C,isPending:v}=de(),{role:l,permission:a}=F(),s=l==="owner"||((r=a==null?void 0:a.materialquote)==null?void 0:r.delete),o=async M=>{var j,u;try{await C({id:M,organizationId:x}),Q({title:"Success",description:"Items deleted successfully"})}catch(i){Q({title:"Error",description:((u=(j=i==null?void 0:i.response)==null?void 0:j.data)==null?void 0:u.message)??"Operation failed"})}};return e.jsx(me,{className:"w-full border-l-4 border-blue-600 shadow-md bg-white hover:shadow-lg transition-all",children:e.jsxs(xe,{className:"p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"my-1",children:[e.jsxs("h3",{className:"text-base font-bold text-blue-700 leading-[8px] ",children:["Project: ",e.jsx("span",{className:"text-black",children:((n=t==null?void 0:t.projectId)==null?void 0:n.projectName)||"Project"})]}),e.jsxs("span",{className:"text-[12px] font-semibold text-gray-500",children:["Quote No: ",e.jsx("span",{className:"text-black",children:t.quoteNo||"N/A"})]})]}),e.jsxs("p",{className:"text-xs text-gray-500 ",children:["Created on: ",ue(t.createdAt)," -  ",pe(t.createdAt)]})]}),e.jsx("i",{className:"fas fa-file-alt text-gray-400 text-xl"})]}),e.jsxs("p",{className:"text-sm text-gray-500 italic",children:[e.jsx("strong",{children:"Furnitures: "})," ",((d=t.furnitures)==null?void 0:d.length)||0]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsxs(S,{size:"sm",variant:"secondary",onClick:()=>{const{furnitures:M}=t,j=M.map(u=>({furnitureName:u.furnitureName,coreMaterials:u.coreMaterials.map(i=>({itemName:(i==null?void 0:i.itemName)||"",plywoodNos:(i==null?void 0:i.plywoodNos)||{quantity:0,thickness:0},laminateNos:i.laminateNos||{quantity:0,thickness:0},carpenters:i.carpenters||0,days:i.days||0,profitOnMaterial:i.profitOnMaterial||0,profitOnLabour:i.profitOnLabour||0,rowTotal:i.rowTotal||0,remarks:i.remarks||"",imageUrl:i.imageUrl||"",previewUrl:i.imageUrl||""})),fittingsAndAccessories:u.fittingsAndAccessories||[],glues:u.glues||[],nonBrandMaterials:u.nonBrandMaterials||[],totals:{core:u.coreMaterialsTotal||0,fittings:u.fittingsAndAccessoriesTotal||0,glues:u.gluesTotal||0,nbms:u.nonBrandMaterialsTotal||0,furnitureTotal:u.furnitureTotal||0}}));console.log("parsedFurniture",j),f(t==null?void 0:t.quoteNo),c(j),h(t._id),g(()=>{var u;return((u=t==null?void 0:t.furnitures)==null?void 0:u.length)>1?"residential":"single"}),y({projectId:t.projectId._id,projectName:t.projectId.projectName})},children:[e.jsx("i",{className:"fas fa-eye mr-1"})," Edit"]}),s&&e.jsxs(S,{size:"sm",isLoading:v,variant:"danger",className:"bg-red-600 text-white",onClick:()=>o(t._id),children:[e.jsx("i",{className:"fas fa-trash mr-1"})," Delete"]})]})]})})},Le=({setFurnitures:t,setEditQuoteNo:x,setIsEditingId:c,setFiltersMain:h,setQuoteType:g})=>{var u;const{organizationId:f}=Y(),[y,C]=T.useState({projectId:"",projectName:"",createdAt:""}),{role:v,permission:l}=F(),a=v==="owner"||((u=l==null?void 0:l.materialquote)==null?void 0:u.list),{data:s}=X(f),o=s==null?void 0:s.map(i=>({_id:i._id,projectName:i.projectName})),{data:r,isLoading:n}=ge(f,{createdAt:y.createdAt,projectId:y.projectId,quoteNo:""}),d=r==null?void 0:r.filter(i=>i.furnitures.length),M=()=>{C({projectId:"",projectName:"",createdAt:""})},j=Object.values(y).filter(Boolean).length;return e.jsx("div",{children:e.jsxs("main",{className:"flex gap-2 !max-h-[80vh]",children:[e.jsx("div",{className:"xl:w-80 flex-shrink-0",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-filter mr-2 text-blue-600"}),"Filters"]}),j>0&&e.jsxs("button",{onClick:M,className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:["Clear All (",j,")"]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Created Date"}),e.jsx("input",{type:"date",onChange:i=>C(b=>({...b,createdAt:i.target.value})),value:y.createdAt,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Project"}),e.jsx("select",{value:(y==null?void 0:y.projectId)||"",onChange:i=>{const b=o==null?void 0:o.find(k=>k._id===i.target.value);b&&C(k=>({...k,projectId:b._id,projectName:b.projectName}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:o==null?void 0:o.map(i=>e.jsx("option",{value:i._id,children:i.projectName},i._id))})]})]})]})}),a&&e.jsx("section",{className:"w-full max-h-full  gap-2  overflow-y-auto  min-h-full",children:n?e.jsx(he,{}):d!=null&&d.length?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:d==null?void 0:d.map(i=>e.jsx(e.Fragment,{children:e.jsx(Pe,{setEditQuoteNo:x,setFurnitures:t,setIsEditingId:c,setQuoteType:g,setFiltersMain:h,quote:i,organizationId:f},i._id)}))}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center text-gray-700",children:[e.jsx("i",{className:"fas fa-file-circle-exclamation text-gray-300 text-7xl mb-4"}),e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"No Quotes Found"}),e.jsxs("p",{className:"text-base text-gray-500 leading-relaxed max-w-md",children:["You haven't generated any quote variants yet.",e.jsx("br",{}),"Please create a quote by clicking the + Product section to view brand-wise breakdowns here."]})]})})]})})},L=t=>t.filter(x=>{var c,h;return!!((c=x.itemName)!=null&&c.trim())||!!((h=x.description)!=null&&h.trim())}),qe=()=>{var D,$;const t=fe(),{organizationId:x}=Y(),{data:c}=X(x),[h,g]=T.useState({categoryId:"",categoryName:""});let{data:f=0}=ye({organizationId:x,categoryId:h.categoryId}),{data:y=[]}=Ne(x);T.useEffect(()=>{if(y&&(y==null?void 0:y.length)>0&&!h.categoryId){const m=y[0];g({categoryId:m._id,categoryName:m.name})}},[y]);const{role:C,permission:v}=F(),l=C==="owner"||((D=v==null?void 0:v.materialquote)==null?void 0:D.create),a=C==="owner"||(($=v==null?void 0:v.materialquote)==null?void 0:$.edit),s=T.useMemo(()=>(c==null?void 0:c.map(m=>({_id:m._id,projectName:m.projectName})))||[],[c]),[o,r]=T.useState({projectId:"",projectName:""}),[n,d]=T.useState([]),[M,j]=T.useState(!1),[u,i]=T.useState(""),[b,k]=T.useState(null),[A,I]=T.useState(null),[U,G]=T.useState(null),{mutateAsync:Z,isPending:ee}=Qe(),{mutateAsync:te,isPending:ae}=Oe(),re=m=>{I(m)},se=()=>A==="single"?"Single Quote":A==="residential"?"Residential Quote":"";T.useEffect(()=>{A==="single"&&!b?(d([]),B("Common Category")):A==="residential"&&!b&&(d([]),j(!0))},[A]);const B=m=>{d(w=>[...w,{furnitureName:m,coreMaterials:[oe()],fittingsAndAccessories:[_()],glues:[_()],nonBrandMaterials:[_()],totals:{core:0,fittings:0,glues:0,nbms:0,furnitureTotal:0}}])},ne=m=>{d(w=>w.filter((N,p)=>p!==m))},oe=()=>({itemName:"",plywoodNos:{quantity:0,thickness:0},laminateNos:{quantity:0,thickness:0},carpenters:0,days:0,profitOnMaterial:0,profitOnLabour:0,rowTotal:0,remarks:""}),_=()=>({itemName:"",description:"",quantity:0,cost:0,rowTotal:0}),q=n==null?void 0:n.reduce((m,w)=>m+w.totals.furnitureTotal,0),le=async()=>{var m,w;try{if(!o.projectId){Q({title:"Error",description:"Please select a project",variant:"destructive"});return}const N=new FormData;N.append("furnitures",JSON.stringify(n.map(p=>({furnitureName:p.furnitureName,coreMaterials:p.coreMaterials.map(O=>{if(Object.values(O).some(P=>!!P)){const{imageUrl:P,previewUrl:E,...ce}=O;return ce}}),fittingsAndAccessories:L(p.fittingsAndAccessories),glues:L(p.glues),nonBrandMaterials:L(p.nonBrandMaterials),coreMaterialsTotal:p.totals.core,fittingsAndAccessoriesTotal:p.totals.fittings,gluesTotal:p.totals.glues,nonBrandMaterialsTotal:p.totals.nbms,furnitureTotal:p.totals.furnitureTotal})))),n.forEach((p,O)=>{p.coreMaterials.forEach((P,E)=>{P.imageUrl&&N.append(`images[${O}][${E}]`,P.imageUrl)})}),N.append("grandTotal",q.toString()),N.append("notes","Generated"),await Z({organizationId:x,projectId:o.projectId,formData:N}),Q({title:"Success",description:"Created Successfully, Visit in Quote Generator Section"}),d([]),I(null)}catch(N){Q({title:"Error",description:((w=(m=N==null?void 0:N.response)==null?void 0:m.data)==null?void 0:w.message)||(N==null?void 0:N.message)||"failed to generate the items",variant:"destructive"})}},ie=async()=>{var m,w;try{if(!o.projectId){Q({title:"Error",description:"Please select a project",variant:"destructive"});return}const N={furnitures:n.map(p=>({furnitureName:p.furnitureName,coreMaterials:p.coreMaterials.map(O=>{const{previewUrl:P,...E}=O;return{...E,imageUrl:O.imageUrl||null}}),fittingsAndAccessories:L(p.fittingsAndAccessories),glues:L(p.glues),nonBrandMaterials:L(p.nonBrandMaterials),coreMaterialsTotal:p.totals.core,fittingsAndAccessoriesTotal:p.totals.fittings,gluesTotal:p.totals.glues,nonBrandMaterialsTotal:p.totals.nbms,furnitureTotal:p.totals.furnitureTotal})),grandTotal:q,notes:"Updated via frontend",quoteNo:U};b&&(await te({organizationId:x,projectId:o.projectId,formData:N,id:b}),Q({title:"Updated!",description:"Quote edited successfully."}),d([]),I(null),k(null))}catch(N){Q({title:"Error",description:((w=(m=N==null?void 0:N.response)==null?void 0:m.data)==null?void 0:w.message)||(N==null?void 0:N.message)||"Failed to Update the Quote",variant:"destructive"})}};return location.pathname.includes("internalquotenew")?e.jsx(je,{}):e.jsxs("div",{className:`h-full mx-auto max-h-full ${b?"overflow-y-auto":""} `,children:[e.jsxs("header",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 py-1 border-b-1 border-[#818283]",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-file mr-3 text-blue-600"}),"Internal Quote Entry"]}),(n==null?void 0:n.length)>0&&e.jsxs("p",{className:"ml-[30px] mt-[5px] block text-[15px] text-gray-800",children:["Single Labour cost:  ",e.jsxs("span",{className:"text-black font-semibold",children:["₹",f]})]})]}),e.jsxs("div",{className:"flex gap-6 items-center ",children:[e.jsx("div",{children:e.jsxs(S,{className:"flex items-center",onClick:()=>{t("internalquotenew")},children:[e.jsx("i",{className:"fas fa-new mr-1",children:" "})," New Version"]})}),l&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Select QuoteType"}),e.jsxs(be,{onValueChange:m=>re(m),children:[e.jsx(we,{className:"w-full",children:e.jsx(ve,{placeholder:"Select Quote",selectedValue:A||""})}),e.jsx(Ce,{children:["single","residential"].map(m=>e.jsx(Me,{value:m.toString(),children:m},m))})]})]}),l&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Select Project *"}),e.jsxs("select",{value:o.projectId,onChange:m=>{const w=s.find(N=>N._id===m.target.value);w&&r({projectId:w._id,projectName:w.projectName})},className:" px-2 py-2 rounded-xl border border-blue-200 focus:border-blue-200 active:border-blue-200",children:[e.jsx("option",{value:"",children:"Select a project"}),s.map(m=>e.jsx("option",{value:m._id,children:m.projectName},m._id))]})]}),n.length>0&&e.jsxs("div",{className:"text-right flex gap-2 items-center",children:[e.jsx("div",{className:"text-xs text-gray-600 uppercase tracking-widest",children:"Grand Total"}),e.jsxs("div",{className:"text-xl font-semibold text-green-600",children:["₹",q.toLocaleString("en-IN")]})]}),l&&e.jsxs(S,{className:"flex items-center",onClick:()=>{j(!0)},children:[e.jsx("i",{className:"fas fa-add mr-1",children:" "})," Create"]}),e.jsx("div",{className:"w-full sm:w-auto flex justify-end sm:block",children:e.jsx(Se,{organizationId:x,stageName:"materialquote"})})]})]}),M&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 bg-opacity-40 backdrop-blur-sm transition",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg p-6 w-full max-w-md relative animate-scaleIn",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-800",children:"Add New Product"}),e.jsx("input",{className:"w-full border border-gray-300 rounded px-3 py-2 mb-4 outline-none focus:ring-2 focus:ring-blue-400",placeholder:"Enter Product Name",value:u,autoFocus:!0,onChange:m=>i(m.target.value),onKeyDown:m=>{if(m.key==="Enter"){if(!u.trim())return;B(u),i(""),j(!1)}}}),e.jsxs("div",{className:"flex justify-end gap-3 mt-4",children:[e.jsx(S,{variant:"secondary",onClick:()=>j(!1),children:"Cancel"}),e.jsx(S,{onClick:()=>{u.trim()&&(B(u),i(""),j(!1))},children:"Create"})]})]})}),n.length>0&&e.jsxs("section",{className:"shadow overflow-y-auto max-h-[86%]",children:[!b&&e.jsx("h1",{className:"text-2xl text-gray-500",children:se()}),n.map((m,w)=>e.jsx(ke,{index:w,labourCost:f,data:m,updateFurniture:N=>{const p=[...n];p[w]=N,d(p)},removeFurniture:()=>ne(w)},w))]}),n.length!==0&&e.jsxs("div",{className:"mt-1 text-right flex gap-2 justify-end",children:[(l||a)&&e.jsx(S,{variant:"primary",isLoading:ee||ae,onClick:b?ie:le,className:"px-6 py-2 bg-blue-600 text-white rounded",children:"Save Quote"}),!b&&(l||a)&&e.jsx(S,{variant:"secondary",onClick:()=>{d([]),I(null)},className:"",children:"Cancel"}),b&&e.jsx(S,{variant:"secondary",onClick:()=>{k(null),d([]),I(null),G(null)},className:"",children:"Cancel"})]}),!b&&(n==null?void 0:n.length)===0&&e.jsx("section",{className:"my-4",children:e.jsx(Le,{setEditQuoteNo:G,setIsEditingId:k,setFurnitures:d,setQuoteType:I,setFiltersMain:r})})]})};export{qe as default,L as filterValidSimpleRows};
