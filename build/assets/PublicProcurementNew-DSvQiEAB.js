import{l as k,m as C,n as P,r as c,j as e,C as f,t as I}from"./index-hYGmCEO1.js";const T=()=>{const[o]=k(),g=o.get("token")||"",u=o.get("orderId")||"",h=o.get("quoteId")||"",{data:l,isLoading:b,isError:y}=C(g||"",u,h),{mutate:j}=P(),[m,d]=c.useState([]),[n,N]=c.useState(!1),p=c.useRef({});c.useEffect(()=>{if(l){const s=l.selectedUnits||[];d(s),N(l.isConfirmedRate||!1)}},[l]);const v=(s,r)=>{if(n)return;const a=parseFloat(r),t=isNaN(a)?0:a;d(i=>i.map(x=>x._id===s?{...x,rate:t,totalCost:(x.quantity||0)*t,isSaving:!0}:x)),p.current[s]&&clearTimeout(p.current[s]),p.current[s]=setTimeout(()=>{w(s,t)},800)},w=(s,r)=>{j({token:g,orderId:u,quoteId:h,itemId:s,rate:r},{onSuccess:()=>{d(a=>a.map(t=>t._id===s?{...t,isSaving:!1}:t))},onError:a=>{console.error("Auto-save failed:",a),I({variant:"destructive",title:"Auto-save failed",description:"Check your connection and try again."}),d(t=>t.map(i=>i._id===s?{...i,isSaving:!1}:i))}})},S=c.useMemo(()=>m.reduce((s,r)=>s+(r.totalCost||0),0),[m]);return b?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsx("i",{className:"fas fa-spinner fa-spin text-4xl text-blue-600"})}):y||!l?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"fas fa-exclamation-circle text-5xl text-red-500 mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Invalid or Expired Link"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Please contact the procurement department."})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-gray-50 to-slate-100 font-sans pb-24",children:[e.jsx("div",{className:"bg-white shadow-lg border-b border-gray-200 sticky top-0 z-40",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"flex items-center justify-between py-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("img",{src:f.COMPANY_LOGO,alt:"Company Logo",className:"w-12 h-12 sm:w-16 sm:h-16 rounded-full object-cover border-2 border-gray-200 shadow-sm"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h1",{className:"text-lg sm:text-2xl lg:text-3xl font-bold text-gray-900 truncate",children:f.COMPANY_NAME}),e.jsx("p",{className:"text-sm sm:text-base text-gray-600 truncate",children:"Vendor Rate Submission"})]})]})})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[n&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-6 flex items-start gap-3",children:[e.jsx("i",{className:"fas fa-check-circle text-green-600 text-xl mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-green-800",children:"Rates Submitted Successfully"}),e.jsx("p",{className:"text-sm text-green-700",children:"Thank you. This order is now locked and under review."})]})]}),!n&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("i",{className:"fas fa-calculator text-blue-600 text-lg mt-1"}),e.jsxs("p",{className:"text-sm text-blue-800 leading-relaxed",children:["Please enter the ",e.jsx("strong",{children:"Rate"})," for each item below. Changes are saved automatically."]})]})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto w-full",children:e.jsxs("table",{className:"min-w-[800px] w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-4 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider w-[50px]",children:"#"}),e.jsx("th",{scope:"col",className:"px-4 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider w-[250px]",children:"Item Details"}),e.jsx("th",{scope:"col",className:"px-4 py-4 text-center text-xs font-semibold text-gray-500 uppercase tracking-wider w-[100px]",children:"Qty"}),e.jsx("th",{scope:"col",className:"px-4 py-4 text-center text-xs font-semibold text-gray-500 uppercase tracking-wider w-[100px]",children:"Unit"}),e.jsxs("th",{scope:"col",className:"px-4 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider w-[180px]",children:["Rate ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("th",{scope:"col",className:"px-4 py-4 text-right text-xs font-semibold text-gray-500 uppercase tracking-wider w-[150px]",children:"Total Cost"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:m.map((s,r)=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-400",children:r+1}),e.jsxs("td",{className:"px-4 py-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.subItemName}),s.isSaving&&e.jsxs("span",{className:"text-[10px] text-blue-500 italic flex items-center gap-1 mt-1",children:[e.jsx("i",{className:"fas fa-spinner fa-spin"})," Saving..."]})]}),e.jsx("td",{className:"px-4 py-4 text-center",children:e.jsx("span",{className:"text-sm font-semibold text-gray-700",children:s.quantity})}),e.jsx("td",{className:"px-4 py-4 text-center",children:e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-gray-100 text-gray-600",children:s.unit})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"relative rounded-md shadow-sm",children:[e.jsx("div",{className:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"â‚¹"})}),e.jsx("input",{type:"number",min:"0",step:"0.01",disabled:n,value:s.rate===void 0||s.rate===0?"":s.rate,onChange:a=>v(s._id,a.target.value),className:`block w-full rounded-md border-0 py-2 pl-7 pr-3 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6 transition-all
                                                        ${n?"bg-gray-100 cursor-not-allowed":"bg-white"}`,placeholder:"0.00"})]})}),e.jsx("td",{className:"px-4 py-4 text-right whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-bold text-gray-700",children:(s.totalCost||0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})})})]},s._id))})]})}),e.jsx("div",{className:"bg-gray-50 px-6 py-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex justify-end items-center gap-4",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500 uppercase",children:"Grand Total:"}),e.jsx("span",{className:"text-2xl font-bold text-blue-700",children:S.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})})]})})]})]})]})};export{T as default};
