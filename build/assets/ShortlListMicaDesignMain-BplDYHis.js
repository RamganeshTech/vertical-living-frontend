import{u as g,a as S,b as j,q as b,g as u,d as A,r as m,j as e,C as M,f as G,h as O,B as y,i as T,M as k,t as d}from"./index-D5hl8ps7.js";import{I as q}from"./ImageGalleryMain-DtiIThZh.js";import{S as L}from"./SmartTagInput-Coxt0S8M.js";import{fetchSuggestions as W}from"./ShortListMain-D8QVrdgq.js";import"./constants-FaVgBbKC.js";import"./downloadFile-B0gVqarZ.js";import"./index-CBIpmTnj.js";const $=async({organizationId:i,formData:s,api:t})=>{const{data:n}=await t.post(`/shortlist/micadesign/${i}/uploaddesign`,s);if(!n.ok)throw new Error(n.message);return n},B=async({organizationId:i,api:s})=>{const{data:t}=await s.get(`/shortlist/micadesign/getdesigns/${i}`);if(!t.ok)throw new Error(t.message);return t.data},J=async({organizationId:i,imageId:s,api:t})=>{const{data:n}=await t.delete(`/shortlist/micadesign/deletedesign/${i}/${s}`);if(!n.ok)throw new Error(n.message);return n},z=()=>{const i=["owner","staff","CTO"],{role:s}=g(),t=u(s);return j({mutationFn:async({organizationId:n,formData:o})=>{if(!s||!i.includes(s))throw new Error("Not authorized");if(!t)throw new Error("API instance missing");return await $({organizationId:n,formData:o,api:t})},onSuccess:(n,{organizationId:o})=>{b.invalidateQueries({queryKey:["micareferencedesign",o]})}})},K=({organizationId:i})=>{const s=["owner","staff","CTO","client"],{role:t}=g(),n=u(t);return S({queryKey:["micareferencedesign",i],queryFn:async()=>{if(!t||!s.includes(t))throw new Error("Not authorized");if(!n)throw new Error("API instance missing");return await B({organizationId:i,api:n})},enabled:!!i,retry:!1,refetchOnWindowFocus:!1})},Q=()=>{const i=["owner","staff","CTO"],{role:s}=g(),t=u(s);return j({mutationFn:async({organizationId:n,imageId:o})=>{if(!s||!i.includes(s))throw new Error("Not authorized");if(!t)throw new Error("API instance missing");return await J({organizationId:n,imageId:o,api:t})},onSuccess:(n,{organizationId:o})=>{b.invalidateQueries({queryKey:["micareferencedesign",o]})}})},U=["image/jpeg","image/jpg","image/png","image/webp"];function se(){const{organizationId:i}=A(),{data:s,refetch:t,isFetching:n}=K({organizationId:i}),{mutateAsync:o,isPending:v}=z(),{mutateAsync:N}=Q(),f=m.useRef(null),[p,h]=m.useState(!1),[x,D]=m.useState([]),E=r=>{const c=Array.from(r.target.files||[]).filter(a=>U.includes(a.type));if(c.length===0){d({title:"Error",description:"Please select valid image files (JPG, JPEG, PNG, WEBP)",variant:"destructive"});return}w(c)},w=async r=>{var l,c;try{const a=new FormData;r.forEach(F=>{a.append("files",F)}),a.append("tags",JSON.stringify(x)),await o({organizationId:i,formData:a}),d({title:"Success",description:"Image(s) uploaded successfully."})}catch(a){d({title:"Error",description:((c=(l=a==null?void 0:a.response)==null?void 0:l.data)==null?void 0:c.message)||(a==null?void 0:a.message)||"Failed to upload images",variant:"destructive"})}},I=async r=>{var l,c;try{await N({organizationId:i,imageId:r}),d({title:"Success",description:"Image deleted"})}catch(a){d({title:"Error",description:((c=(l=a==null?void 0:a.response)==null?void 0:l.data)==null?void 0:c.message)||(a==null?void 0:a.message)||"Failed to upload images",variant:"destructive"})}},P=r=>{r.preventDefault(),r.stopPropagation(),h(!1)},R=r=>{r.preventDefault(),r.stopPropagation()},C=async r=>{r.preventDefault(),r.stopPropagation(),h(!1);const l=Array.from(r.dataTransfer.files);await w(l)};return e.jsxs("div",{className:"w-full max-h-full mx-auto p-2 overflow-y-auto",children:[e.jsx("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6",children:e.jsxs("h1",{className:"text-2xl font-semibold text-gray-800",children:[e.jsx("i",{className:"fa-solid fa-object-group text-2xl text-blue-600 mr-2"}),"Mica Reference Designs"]})}),e.jsxs("div",{className:"mb-5",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Enter Categories"}),e.jsx(L,{tags:x,setState:D,suggestionFetcher:W})]}),e.jsxs(M,{className:"",children:[e.jsx(G,{children:e.jsxs(O,{className:"flex items-center justify-between",children:[p?"Drop files here...":"Drag and drop image files here or ",e.jsx(y,{variant:"outline",size:"sm",className:"text-blue-600 bg-transparent",children:v?e.jsxs(e.Fragment,{children:["Loading ",e.jsx("i",{className:"fas fa-spinner ml-2 animate-spin"})]}):"Upload reference images, and can be used to compare in the projects"})]})}),e.jsxs(T,{children:[e.jsx("div",{className:`border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors ${p?"border-blue-400 bg-blue-50":"border-gray-300"}`,onClick:()=>{var r;return(r=f.current)==null?void 0:r.click()},onDragLeave:P,onDragOver:R,onDrop:C,children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-lg font-medium",children:"Drag & drop plan/reference images here or"}),e.jsx(y,{variant:"outline",children:"Browse"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Accepted: JPG/PNG/WebP â€¢ Images auto-saved locally"})]})}),e.jsx("input",{ref:f,type:"file",multiple:!0,accept:"image/*",className:"hidden",onChange:E})]})]}),e.jsxs("div",{className:"mt-5",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-700 mb-3",children:"Images"}),n?e.jsx("div",{className:"text-center text-gray-600",children:e.jsx(k,{})}):s!=null&&s.referenceImages.length?e.jsx(q,{imageFiles:(s==null?void 0:s.referenceImages)||[],refetch:t,handleDeleteFile:I,height:190,minWidth:156,maxWidth:200}):e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[300px] w-full bg-white rounded-xl   text-center p-6",children:[e.jsx("i",{className:"fas fa-image text-5xl text-blue-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-1",children:"No Images Found"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Please upload images"})]})]})]})}export{se as default};
