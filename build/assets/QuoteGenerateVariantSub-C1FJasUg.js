import{r as c,j as e,ae as We,u as He,a as ze,k as Ke,R as $e,B as Je,M as Xe,t as Oe}from"./index-BAM0eJUz.js";import{d as Ye,u as Fe,e as Ze}from"./quoteVariantApi-SI_JgpSl.js";import{S as he}from"./SearchSelectNew-IGAHiELy.js";import{C as Pe}from"./Card-CdxfjEr-.js";import{c as et,u as tt}from"./labourRateconfigApi-Dm8CpgW0.js";const be=(L,$,i)=>{const x=String(L).toLowerCase().replace("mm","").trim(),B=$.find(v=>String(v.thickness).toLowerCase().replace("mm","").trim()===x);return(B==null?void 0:B.rs)!==void 0?B.rs:i==="laminate"?at:0},rt=c.forwardRef((L,$)=>{var ie,Le,ae;const{data:i,index:x,brandOptions:B,innerOptions:v,outerOptions:q,innerLaminateRatesByBrand:ge,outerLaminateRatesByBrand:fe,brandRatesByName:ye,labourCost:ke,selectedBrand:w,selectedInnerBrand:C,selectedOuterBrand:f,onFurnitureChange:ue,globalProfitPercent:Ne,onProfitOverride:E}=L,[A,J]=c.useState(w),[D,X]=c.useState(C),[_,Y]=c.useState(f),[je,se]=c.useState(null),[ve,ne]=c.useState(null),[we,oe]=c.useState(null),[b,xe]=c.useState((i==null?void 0:i.coreMaterials)||[]),[M,me]=c.useState((i==null?void 0:i.fittingsAndAccessories)||[]),[I,Z]=c.useState((i==null?void 0:i.glues)||[]),[ee,le]=c.useState((i==null?void 0:i.nonBrandMaterials)||[]),Be=c.useRef(w),V=c.useRef(C),Ie=c.useRef(f);c.useEffect(()=>{Be.current!==w&&(J(w),Be.current=w)},[w]),c.useEffect(()=>{V.current!==C&&(X(C),V.current=C)},[C]),c.useEffect(()=>{Ie.current!==f&&(Y(f),Ie.current=f)},[f]);const U=c.useRef(!1);c.useEffect(()=>{if(!B.length)return;const a=i.plywoodBrandId,l=B.find(u=>u.label===w||u.value===w);if(!U.current&&a){const u=B.find(m=>m.value===a);J((u==null?void 0:u.label)||null),se(a)}else U.current&&w&&(J((l==null?void 0:l.label)||w),se((l==null?void 0:l.value)||null))},[w,B,i.plywoodBrandId]),c.useEffect(()=>{if(!v.length)return;const a=i.innerLaminateBrandId,l=v.find(u=>u.label===C||u.value===C);if(!U.current&&a){const u=v.find(m=>m.value===a);X((u==null?void 0:u.label)||null),ne(a)}else U.current&&C&&(X((l==null?void 0:l.label)||C),ne((l==null?void 0:l.value)||null))},[C,v,i.innerLaminateBrandId]),c.useEffect(()=>{if(!q.length)return;const a=i.outerLaminateBrandId,l=q.find(u=>u.label===f||u.value===f);if(!U.current&&a){const u=q.find(m=>m.value===a);Y((u==null?void 0:u.label)||null),oe(a)}else U.current&&f&&(Y((l==null?void 0:l.label)||f),oe((l==null?void 0:l.value)||null))},[f,q,i.outerLaminateBrandId]),c.useEffect(()=>{if(B.length>0&&v.length>0&&q.length>0){const a=setTimeout(()=>{U.current=!0},300);return()=>clearTimeout(a)}},[B.length,v.length,q.length]);const ce=(a,l)=>{if(!a){l==="plywood"?(J(null),se(null)):l==="inner"?(X(null),ne(null)):(Y(null),oe(null));return}const m=(l==="plywood"?B:l==="inner"?v:q).find(P=>P.value===a);l==="plywood"?(J((m==null?void 0:m.label)||a),se((m==null?void 0:m.value)||null)):l==="inner"?(X((m==null?void 0:m.label)||a),ne((m==null?void 0:m.value)||null)):(Y((m==null?void 0:m.label)||a),oe((m==null?void 0:m.value)||null))};c.useEffect(()=>{xe((i==null?void 0:i.coreMaterials)||[]),me((i==null?void 0:i.fittingsAndAccessories)||[]),Z((i==null?void 0:i.glues)||[]),le((i==null?void 0:i.nonBrandMaterials)||[])},[i]);const te=(a,l)=>{var j,K,F,Me,N;const u=A?ye[A]||[]:[],m=D?ge[D]||[]:[],P=_?fe[_]||[]:[],y=be(a.plywoodNos.thickness,u,"plywood"),S=be(((j=a.innerLaminate)==null?void 0:j.thickness)||0,m,"laminate"),Q=be(((K=a.outerLaminate)==null?void 0:K.thickness)||0,P,"laminate"),z=32,k=(((F=a.plywoodNos)==null?void 0:F.quantity)||0)*y*z,Ce=(((Me=a.innerLaminate)==null?void 0:Me.quantity)||0)*S*z,Te=(((N=a.outerLaminate)==null?void 0:N.quantity)||0)*Q*z,Se=k+Ce+Te,r=Se*((a.profitOnMaterial||0)/100),t=l.length,o=l[0],n=((o==null?void 0:o.carpenters)||0)*((o==null?void 0:o.days)||0)*ke*(1+((o==null?void 0:o.profitOnLabour)||0)/100),h=t>0?n/t:0,g=t>0?(i.fabricationCost||0)/t:0,d=1+((i.furnitureProfit??Ne)||0)/100;return(Se+r+h+g)*d},W=b.reduce((a,l)=>a+te(l,b),0),Re=1+((i.furnitureProfit??Ne)||0)/100,R=(a,l=!1)=>{const u=l?a.cost||0:(a.quantity||0)*(a.cost||0),m=u*((a.profitOnMaterial||0)/100);return(u+m)*Re},O=M.reduce((a,l)=>a+R(l),0),H=I.reduce((a,l)=>a+R(l,!0),0),G=ee.reduce((a,l)=>a+R(l),0),T=W+O+H+G;c.useImperativeHandle($,()=>({getUpdatedFurniture:()=>{const a=b.map(S=>({...S,rowTotal:Math.round(te(S,b))})),l=Math.round(W),u=Math.round(O),m=Math.round(H),P=Math.round(G),y=Math.round(T);return{...i,plywoodBrand:A,innerLaminateBrand:D,outerLaminateBrand:_,dimention:i==null?void 0:i.dimention,plywoodBrandId:je,innerLaminateBrandId:ve,outerLaminateBrandId:we,furnitureProfit:i.furnitureProfit,coreMaterials:a,coreMaterialsTotal:l,fittingsAndAccessoriesTotal:u,gluesTotal:m,nonBrandMaterialsTotal:P,furnitureTotal:y,totals:{core:W,fittings:O,glues:H,nbms:G,furnitureTotal:T}}}})),c.useEffect(()=>{ue()},[A,D,_]);const re=(a,l,u)=>{const m=u==="Fittings",P=u==="NBMs";return e.jsxs("div",{className:"mt-6",children:[e.jsxs("h3",{className:"font-semibold text-md mb-2 text-gray-800",children:[a," - Total: ₹",Math.round(u==="Fittings"?O:u==="Glues"?H:G).toLocaleString("en-IN")]}),e.jsxs("table",{className:"min-w-full text-sm bg-white shadow-sm border border-gray-200",children:[e.jsx("thead",{className:"bg-blue-50 text-sm font-semibold text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 border-r",children:"Item Name"}),e.jsx("th",{className:"px-6 py-3 border-r",children:"Description"}),(m||P)&&e.jsx("th",{className:"px-6 py-3 border-r",children:"Brand"}),e.jsx("th",{className:"px-6 py-3 border-r",children:"Quantity"}),e.jsx("th",{className:"px-6 py-3 border-r",children:"Cost"}),e.jsx("th",{className:"px-6 py-3 border-r",children:"Profit %"}),e.jsx("th",{className:"px-6 py-3",children:"Total"})]})}),e.jsx("tbody",{children:l.map((y,S)=>e.jsxs("tr",{className:"border-t hover:bg-gray-50",children:[e.jsx("td",{className:"p-2 border-r text-center",children:y.itemName||"—"}),e.jsx("td",{className:"p-2 border-r text-center",children:y.description||"—"}),(m||P)&&e.jsx("td",{className:"p-2 border-r text-center",children:(y==null?void 0:y.brandName)||"—"}),e.jsx("td",{className:"p-2 border-r text-center",children:y.quantity}),e.jsxs("td",{className:"p-2 border-r text-center",children:["₹",y.cost]}),e.jsx("td",{className:"p-2 border-r text-center",children:e.jsx("input",{type:"number",value:y.profitOnMaterial||0,onChange:Q=>{const z=parseFloat(Q.target.value)||0;if(u==="Fittings"){const k=[...M];k[S].profitOnMaterial=z,me(k)}else if(u==="Glues"){const k=[...I];k[S].profitOnMaterial=z,Z(k)}else{const k=[...ee];k[S].profitOnMaterial=z,le(k)}ue()},className:"w-16 text-center border border-blue-200 rounded py-1 font-semibold"})}),e.jsxs("td",{className:"p-2 text-center font-bold text-green-700",children:["₹",Math.round(R(y,u==="Glues")).toLocaleString("en-IN")]})]},S))})]})]})};return e.jsxs("div",{className:"shadow-lg p-6 my-6 border rounded-xl bg-white",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("h2",{className:"text-2xl font-bold text-blue-700",children:["Product ",x+1,": ",i.furnitureName]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-wider",children:"Dimensions:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center bg-blue-50 border border-blue-100 rounded-md px-2 py-0.5",children:[e.jsx("span",{className:"text-[10px] font-bold text-blue-500 mr-1.5",children:"H"}),e.jsxs("span",{className:"text-xs font-bold text-blue-700",children:[((ie=i.dimention)==null?void 0:ie.height)||0," ",e.jsx("small",{className:"text-[9px] opacity-70",children:"mm"})]})]}),e.jsxs("div",{className:"flex items-center bg-green-50 border border-green-100 rounded-md px-2 py-0.5",children:[e.jsx("span",{className:"text-[10px] font-bold text-green-500 mr-1.5",children:"W"}),e.jsxs("span",{className:"text-xs font-bold text-green-700",children:[((Le=i.dimention)==null?void 0:Le.width)||0," ",e.jsx("small",{className:"text-[9px] opacity-70",children:"mm"})]})]}),e.jsxs("div",{className:"flex items-center bg-purple-50 border border-purple-100 rounded-md px-2 py-0.5",children:[e.jsx("span",{className:"text-[10px] font-bold text-purple-500 mr-1.5",children:"D"}),e.jsxs("span",{className:"text-xs font-bold text-purple-700",children:[((ae=i.dimention)==null?void 0:ae.depth)||0," ",e.jsx("small",{className:"text-[9px] opacity-70",children:"mm"})]})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("section",{className:"flex flex-col items-end",children:[e.jsx("label",{className:"text-[10px] font-bold text-blue-500 uppercase tracking-tighter",children:"Product Profit Override (%)"}),e.jsxs("div",{className:"flex items-center bg-blue-50 px-3 py-1 rounded-lg border border-blue-100 shadow-sm",children:[e.jsx("input",{type:"number",className:"w-14 text-right font-black bg-transparent outline-none text-blue-800",value:i.furnitureProfit??"",placeholder:Ne.toString(),onChange:a=>{const l=a.target.value===""?0:parseFloat(a.target.value);E(l)}}),e.jsx("span",{className:"ml-1 text-blue-600 font-black text-sm",children:"%"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-[10px] font-bold text-green-500 uppercase",children:"Grand Product Total"}),e.jsxs("p",{className:"text-2xl font-black text-green-600",children:["₹",Math.round(T).toLocaleString("en-IN")]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-6 mb-6 p-4 bg-gray-50 rounded-xl border border-gray-100 shadow-inner",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-extrabold text-gray-400 uppercase mb-1 block",children:"Plywood Brand"}),e.jsx(he,{options:B,onValueChange:a=>ce(a,"plywood"),value:je||""})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-extrabold text-blue-400 uppercase mb-1 block",children:"Inner Laminate Brand"}),e.jsx(he,{options:v,onValueChange:a=>ce(a,"inner"),value:ve||""})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-extrabold text-orange-400 uppercase mb-1 block",children:"Outer Laminate Brand"}),e.jsx(he,{options:q,onValueChange:a=>ce(a,"outer"),value:we||""})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"border border-gray-200 bg-white rounded-lg shadow-sm p-3",children:[e.jsxs("h3",{className:"text-[11px] font-bold text-gray-500 uppercase mb-2 flex justify-between",children:["Plywood Rates: ",e.jsx("span",{className:"text-blue-600",children:A||"None"})]}),e.jsx("div",{className:"max-h-[150px] overflow-y-auto border-t border-gray-100 pt-2",children:e.jsx("table",{className:"min-w-full text-[11px]",children:e.jsx("tbody",{children:(A?ye[A]:[]).map((a,l)=>e.jsxs("tr",{className:"border-b border-gray-50 last:border-0 hover:bg-gray-50",children:[e.jsxs("td",{className:"py-1 text-gray-600 font-medium",children:[a.thickness," mm"]}),e.jsxs("td",{className:"py-1 text-right font-bold text-green-700",children:["₹",a.rs.toFixed(2)]})]},l))})})})]}),e.jsxs("div",{className:"border border-blue-100 bg-white rounded-lg shadow-sm p-3",children:[e.jsxs("h3",{className:"text-[11px] font-bold text-blue-500 uppercase mb-2 flex justify-between",children:["Inner Rates: ",e.jsx("span",{className:"text-blue-700",children:D||"None"})]}),e.jsx("div",{className:"max-h-[150px] overflow-y-auto border-t border-blue-50 pt-2",children:e.jsx("table",{className:"min-w-full text-[11px]",children:e.jsx("tbody",{children:(D?ge[D]:[]).map((a,l)=>e.jsxs("tr",{className:"border-b border-gray-50 last:border-0 hover:bg-blue-50/30",children:[e.jsxs("td",{className:"py-1 text-gray-600 font-medium",children:[a.thickness," mm"]}),e.jsxs("td",{className:"py-1 text-right font-bold text-blue-700",children:["₹",a.rs.toFixed(2)]})]},l))})})})]}),e.jsxs("div",{className:"border border-orange-100 bg-white rounded-lg shadow-sm p-3",children:[e.jsxs("h3",{className:"text-[11px] font-bold text-orange-500 uppercase mb-2 flex justify-between",children:["Outer Rates: ",e.jsx("span",{className:"text-orange-700",children:_||"None"})]}),e.jsx("div",{className:"max-h-[150px] overflow-y-auto border-t border-orange-50 pt-2",children:e.jsx("table",{className:"min-w-full text-[11px]",children:e.jsx("tbody",{children:(_?fe[_]:[]).map((a,l)=>e.jsxs("tr",{className:"border-b border-gray-50 last:border-0 hover:bg-orange-50/30",children:[e.jsxs("td",{className:"py-1 text-gray-600 font-medium",children:[a.thickness," mm"]}),e.jsxs("td",{className:"py-1 text-right font-bold text-orange-700",children:["₹",a.rs.toFixed(2)]})]},l))})})})]})]}),e.jsx("div",{className:"overflow-x-auto rounded-lg border border-gray-200 shadow-sm",children:e.jsxs("table",{className:"min-w-full text-sm text-center",children:[e.jsxs("thead",{className:"bg-blue-50 text-gray-600 font-bold",children:[e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 border-r border-gray-200",rowSpan:2,children:"Image"}),e.jsx("th",{className:"px-4 py-3 border-r border-gray-200",rowSpan:2,children:"Item Name"}),e.jsx("th",{className:"px-4 py-1 border-r border-gray-200",colSpan:2,children:"Plywood"}),e.jsx("th",{className:"px-4 py-1 border-r border-gray-200",colSpan:4,children:"Laminate"}),e.jsx("th",{className:"px-4 py-3 border-r border-gray-200",rowSpan:2,children:"Carpenters/Day"}),e.jsx("th",{className:"px-4 py-3 border-r border-gray-200",rowSpan:2,children:"Days"}),e.jsx("th",{className:"px-4 py-3 border-r border-gray-200",rowSpan:2,children:"Profit % Material"}),e.jsx("th",{className:"px-4 py-3 border-r border-gray-200",rowSpan:2,children:"Profit % Labour"}),e.jsx("th",{className:"px-4 py-3 border-r border-gray-200",rowSpan:2,children:"Remarks"}),e.jsx("th",{className:"px-4 py-3",rowSpan:2,children:"Row Total"})]}),e.jsxs("tr",{className:"border-t border-gray-200 bg-blue-50/50",children:[e.jsx("th",{className:"px-2 py-2 text-[10px] uppercase border-r border-gray-200",children:"Thk"}),e.jsx("th",{className:"px-2 py-2 text-[10px] uppercase border-r border-gray-200",children:"Qty"}),e.jsx("th",{className:"px-2 py-2 text-[10px] uppercase border-r border-gray-200",children:"Outer Thk"}),e.jsx("th",{className:"px-2 py-2 text-[10px] uppercase border-r border-gray-200",children:"Outer Qty"}),e.jsx("th",{className:"px-2 py-2 text-[10px] uppercase border-r border-gray-200",children:"Inner Thk"}),e.jsx("th",{className:"px-2 py-2 text-[10px] uppercase border-r border-gray-200",children:"Inner Qty"})]})]}),e.jsx("tbody",{children:b.map((a,l)=>{var u,m,P,y;return e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50/50 transition-colors",children:[l===0&&e.jsx("td",{rowSpan:b.length,className:"p-2 border-r border-gray-100 bg-white",children:e.jsx("img",{src:a.imageUrl||We,className:"h-12 mx-auto rounded shadow-sm"})}),e.jsx("td",{className:"p-2 border-r border-gray-100 font-medium",children:a.itemName||"—"}),e.jsx("td",{className:"p-2 border-r border-gray-100 bg-gray-50 text-gray-500 font-mono",children:a.plywoodNos.thickness}),e.jsx("td",{className:"p-2 border-r border-gray-100 bg-gray-50 text-gray-500 font-mono",children:a.plywoodNos.quantity}),e.jsx("td",{className:"p-2 border-r border-gray-100 bg-gray-50 text-gray-500 font-mono",children:((u=a.outerLaminate)==null?void 0:u.thickness)||0}),e.jsx("td",{className:"p-2 border-r border-gray-100 bg-gray-50 text-gray-500 font-mono",children:((m=a.outerLaminate)==null?void 0:m.quantity)||0}),e.jsx("td",{className:"p-2 border-r border-gray-100 bg-gray-50 text-gray-500 font-mono",children:((P=a.innerLaminate)==null?void 0:P.thickness)||0}),e.jsx("td",{className:"p-2 border-r border-gray-100 bg-gray-50 text-gray-500 font-mono",children:((y=a.innerLaminate)==null?void 0:y.quantity)||0}),l===0&&e.jsxs(e.Fragment,{children:[e.jsx("td",{rowSpan:b.length,className:"p-2 border-r border-gray-100 bg-gray-50 text-gray-500 font-mono",children:a.carpenters}),e.jsx("td",{rowSpan:b.length,className:"p-2 border-r border-gray-100 bg-gray-50 text-gray-500 font-mono",children:a.days})]}),e.jsx("td",{className:"p-2 border-r border-gray-100",children:e.jsx("input",{type:"number",value:a.profitOnMaterial,onChange:S=>{const Q=[...b];Q[l].profitOnMaterial=parseFloat(S.target.value)||0,xe(Q),ue()},className:"w-16 border border-blue-100 rounded text-center py-1 font-semibold focus:ring-1 focus:ring-blue-400 outline-none"})}),l===0&&e.jsx("td",{rowSpan:b.length,className:"p-2 border-r border-gray-100",children:e.jsx("input",{type:"number",value:a.profitOnLabour,onChange:S=>{const Q=[...b];Q[0].profitOnLabour=parseFloat(S.target.value)||0,xe(Q),ue()},className:"w-16 border border-blue-100 rounded text-center py-1 font-semibold focus:ring-1 focus:ring-blue-400 outline-none"})}),e.jsx("td",{className:"p-2 border-r border-gray-100 text-gray-400 text-[11px] italic",children:a.remarks||"—"}),e.jsxs("td",{className:"p-2 font-bold text-green-600",children:["₹",Math.round(te(a,b)).toLocaleString("en-IN")]})]},l)})})]})}),re("Fittings & Accessories",M,"Fittings"),re("Glues",I,"Glues"),re("Non-Branded Materials",ee,"NBMs")]})}),at=0,it=()=>{var Ce,Te,Se;const{organizationId:L,quoteId:$}=He(),i=ze(),{data:x,isLoading:B}=Ye(L,$);let{data:v,isLoading:q}=Fe(L,"plywood"),{data:ge}=Fe(L,"inner laminate"),{data:fe}=Fe(L,"outer laminate");const[ye,ke]=c.useState({categoryId:"",categoryName:""});let{data:w=0}=et({organizationId:L,categoryId:ye.categoryId}),{data:C=[]}=tt(L);const f=(C||[]).map(r=>({value:r._id,label:r.name})),{mutateAsync:ue,isPending:Ne}=Ze(),E=c.useRef([]),[A,J]=c.useState(null),[D,X]=c.useState(null),[_,Y]=c.useState(null),[je,se]=c.useState(null),[ve,ne]=c.useState(null),[we,oe]=c.useState(null),[b,xe]=c.useState(0),[M,me]=c.useState(0),[I,Z]=c.useState([]),[ee,le]=c.useState(0);c.useEffect(()=>{x&&(xe(x.globalTransportation||0),me(x.globalProfitPercent||0),le(x.commonProfitOverride||0),x.commonMaterials&&Z(x.commonMaterials))},[x]);const{role:Be,permission:V}=Ke(),Ie=Be==="owner"||((Ce=V==null?void 0:V.quotevariant)==null?void 0:Ce.create),U=Be==="owner"||((Te=V==null?void 0:V.quotevariant)==null?void 0:Te.edit),ce=r=>{if(!r)return{};const t={};return r.forEach(o=>{var p,d;const s=(o==null?void 0:o.data)||{},n=(p=s.Brand??s.brand)==null?void 0:p.trim(),h=(d=String(s["thickness (mm)"]||s.thickness||s.Thickness))==null?void 0:d.trim(),g=parseFloat(s.Rs||s.rs||s.rS);n&&h&&g&&(t[n]||(t[n]=[]),t[n].push({thickness:h,rs:g,id:o._id}))}),t},te=c.useMemo(()=>ce(v),[v]),W=c.useMemo(()=>ce(ge),[ge]),pe=c.useMemo(()=>ce(fe),[fe]),Re=c.useMemo(()=>Object.keys(te).map(r=>{var t;return{label:r,value:((t=te[r][0])==null?void 0:t.id)||r}}),[te]),R=c.useMemo(()=>Object.keys(W).map(r=>{var t;return{label:r,value:((t=W[r][0])==null?void 0:t.id)||r}}),[W]),O=c.useMemo(()=>Object.keys(pe).map(r=>{var t;return{label:r,value:((t=pe[r][0])==null?void 0:t.id)||r}}),[pe]),H=c.useMemo(()=>{if(!v)return{};const r={};return v.forEach(t=>{const o=(t==null?void 0:t.data)||{},s=o.Brand??o.brand,n=o["thickness (mm)"]||o.thickness||o.Thickness;let h=o.Rs||o.rs;if(s&&n&&h){const g=String(s).trim(),p=String(n).trim(),d=parseFloat(h);r[g]||(r[g]=[]),r[g].push({thickness:p,rs:d,id:t._id})}}),r},[v]),G=c.useMemo(()=>Object.keys(H).map(r=>{var t;return{label:r,value:((t=H[r][0])==null?void 0:t.id)||r}}),[H]),[T,re]=c.useState([]),[ie,Le]=c.useState(0),[ae,a]=c.useState(0),l=(r,t)=>{re(o=>{const s=[...o],n=s[r];return s[r]={...n,furnitureProfit:t,coreMaterials:n.coreMaterials.map(h=>({...h,profitOnMaterial:0,profitOnLabour:0})),fittingsAndAccessories:n.fittingsAndAccessories.map(h=>({...h,profitOnMaterial:0})),nonBrandMaterials:n.nonBrandMaterials.map(h=>({...h,profitOnMaterial:0}))},s}),setTimeout(()=>u(),0)},u=()=>{const t=E.current.map(n=>n.current).filter(n=>n!==null).map(n=>n.getUpdatedFurniture()).reduce((n,h)=>n+h.totals.furnitureTotal,0),o=I.reduce((n,h)=>n+(h.rowTotal||0),0),s=Math.round(t+o);Le(s),a(y())},{profitDifference:m,profitPercentage:P}=c.useMemo(()=>{const r=ie-ae,t=ae>0?r/ae*100:0;return{profitDifference:Math.round(r),profitPercentage:t}},[ie,ae]),y=()=>{const r=E.current.map(s=>s.current).filter(s=>s!==null).map(s=>s.getUpdatedFurniture()),t=32;let o=0;return r.forEach(s=>{const n=s.plywoodBrand?H[s.plywoodBrand]||[]:[],h=s.innerLaminateBrand?W[s.innerLaminateBrand]||[]:[],g=s.outerLaminateBrand?pe[s.outerLaminateBrand]||[]:[],p=s.coreMaterials,d=p[0],j=((d==null?void 0:d.carpenters)||0)*((d==null?void 0:d.days)||0)*w,K=p.length>0?j/p.length:0,F=p.length>0?(s.fabricationCost||0)/p.length:0;p.forEach(N=>{var Ee,Ae,Ge,Qe;const de=be(N.plywoodNos.thickness,n,"plywood"),qe=be(((Ee=N.innerLaminate)==null?void 0:Ee.thickness)||0,h,"laminate"),De=be(((Ae=N.outerLaminate)==null?void 0:Ae.thickness)||0,g,"laminate"),_e=N.plywoodNos.quantity*(de*t),Ve=(((Ge=N.innerLaminate)==null?void 0:Ge.quantity)||0)*(qe*t),Ue=(((Qe=N.outerLaminate)==null?void 0:Qe.quantity)||0)*(De*t);o+=_e+Ve+Ue+K+F});const Me=N=>(N.quantity||0)*(N.cost||0);o+=s.fittingsAndAccessories.reduce((N,de)=>N+Me(de),0),o+=s.glues.reduce((N,de)=>N+(de.cost||0),0),o+=s.nonBrandMaterials.reduce((N,de)=>N+Me(de),0)}),o+=I.reduce((s,n)=>s+(n.quantity||0)*(n.cost||0),0),Math.round(o)},S=(r,t)=>{const s=T.reduce((p,d)=>p+d.coreMaterials.length+d.fittingsAndAccessories.length+d.glues.length+d.nonBrandMaterials.length,0)+I.length,n=s>0?b/s:0,g=1+(ee??M)/100;Z(p=>{const d=[...p],j=d[r],K=(j.quantity||0)*(j.cost||0),F=t>0?1+t/100:g;return d[r]={...j,profitOnMaterial:t,rowTotal:Math.round(K*F+n)},d}),setTimeout(()=>u(),0)},Q=()=>e.jsx("div",{className:"overflow-x-auto rounded-xl border border-gray-200 shadow-sm",children:e.jsxs("table",{className:"min-w-full text-sm bg-white",children:[e.jsx("thead",{className:"bg-blue-50 text-blue-800 font-bold uppercase text-[11px]",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Item Name"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Description"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Brand"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Quantity"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Cost"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Profit %"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Total"})]})}),e.jsx("tbody",{children:I.map((r,t)=>{var o,s;return e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-blue-50/20 transition-colors",children:[e.jsx("td",{className:"p-3 border-r border-gray-100 text-center font-medium text-gray-700",children:r.itemName||"—"}),e.jsx("td",{className:"p-3 border-r border-gray-100 text-center text-gray-500",children:r.description||"—"}),e.jsx("td",{className:"p-3 border-r border-gray-100 text-center text-gray-500",children:r.brandName||"—"}),e.jsx("td",{className:"p-3 border-r border-gray-100 text-center  text-gray-500",children:r.quantity}),e.jsxs("td",{className:"p-3 border-r border-gray-100 text-center  text-gray-500",children:["₹",(o=r.cost)==null?void 0:o.toLocaleString("en-IN")]}),e.jsx("td",{className:"p-3 border-r border-gray-100 text-center ",children:e.jsx("input",{type:"number",value:r.profitOnMaterial||0,onKeyDown:n=>{(n.key==="-"||n.key==="e")&&n.preventDefault()},onChange:n=>{const h=Math.max(0,parseFloat(n.target.value)||0);S(t,h)},className:"w-16 text-center border border-blue-200 rounded py-1 font-semibold  outline-none focus:ring-1 focus:ring-blue-400"})}),e.jsxs("td",{className:"p-3 text-center font-black text-green-700 bg-green-50/20",children:["₹",(s=r.rowTotal)==null?void 0:s.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})]})]},t)})})]})});c.useEffect(()=>{if(console.log("is it getting called here "),!T.length)return;const t=T.reduce((p,d)=>p+d.coreMaterials.length+d.fittingsAndAccessories.length+d.glues.length+d.nonBrandMaterials.length,0)+I.length,o=t>0?b/t:0,s=T.map(p=>{if(p.coreMaterials.length===0)return p;const d=M??p.furnitureProfit??0;return{...p,furnitureProfit:d}}),h=1+(ee??M)/100,g=I.map(p=>{const d=(p.quantity||0)*(p.cost||0),j=(p.profitOnMaterial||0)>0?d*(1+(p.profitOnMaterial||0)/100):d*h;return{...p,rowTotal:j+o}});re(s),Z(g),setTimeout(()=>u(),0)},[b,M,w,I.length,ee]);const z=async()=>{var r,t,o;try{if(!L||!$||!x||!A){Oe({title:"Missing info",description:"Please ensure brand and all details are selected",variant:"destructive"});return}const s=E.current.map(d=>d.current).filter(d=>d!==null).map(d=>d.getUpdatedFurniture()),n=s.reduce((d,j)=>d+j.totals.furnitureTotal,0),h=I.map(d=>({...d,rowTotal:Math.round(d.rowTotal||0)})),g=h.reduce((d,j)=>d+j.rowTotal,0),p=Math.round(n+g)||0;await ue({quoteId:$,organizationId:L,data:{quoteId:$,organizationId:L,projectId:(r=x==null?void 0:x.projectId)==null?void 0:r._id,brandName:A,innerLaminateBrand:D,outerLaminateBrand:_,plywoodBrandId:je,innerLaminateId:ve,outerLaminateId:we,mainQuoteName:x.mainQuoteName,quoteType:x.quoteType,commonMaterials:h,globalTransportation:b,globalProfitPercent:M,furnitures:s,grandTotal:p,notes:"Generated with brand variant"}}),Oe({title:"success",description:"Successfully created, check it in the Quote for clients section"})}catch(s){Oe({title:"Error",description:((o=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:o.message)??"Operation failed",variant:"destructive"})}},k=c.useRef(!0);return c.useEffect(()=>{if(!(!x||!G.length||!R.length||!O.length)&&k.current){const r=G.find(n=>n.value===x.plywoodBrandId)||null,t=R.find(n=>n.value===x.innerLaminateId)||null,o=O.find(n=>n.value===x.outerLaminateId)||null;J((r==null?void 0:r.label)||null),se((r==null?void 0:r.value)||null),X((t==null?void 0:t.label)||null),ne((t==null?void 0:t.value)||null),Y((o==null?void 0:o.label)||null),oe((o==null?void 0:o.value)||null);const s=x.furnitures.map(n=>{var d,j,K;const h=n.plywoodBrandId||x.plywoodBrandId||null,g=n.innerLaminateBrandId||x.innerLaminateId||null,p=n.outerLaminateBrandId||x.outerLaminateId||null;return{...n,totals:{core:n.coreMaterialsTotal||0,fittings:n.fittingsAndAccessoriesTotal||0,glues:n.gluesTotal||0,nbms:n.nonBrandMaterialsTotal||0,furnitureTotal:n.furnitureTotal||0},plywoodBrandId:h,innerLaminateBrandId:g,outerLaminateBrandId:p,plywoodBrand:((d=G.find(F=>F.value===h))==null?void 0:d.label)||null,innerLaminateBrand:((j=R.find(F=>F.value===g))==null?void 0:j.label)||null,outerLaminateBrand:((K=O.find(F=>F.value===p))==null?void 0:K.label)||null}});re(s),xe(x.globalTransportation||0),me(x.globalProfitPercent||0),le(x.commonProfitOverride||0),k.current=!1}},[x,G,R,O]),E.current.length!==T.length&&(E.current=T.map((r,t)=>E.current[t]??$e.createRef())),c.useEffect(()=>{E.current=T.map((r,t)=>E.current[t]??c.createRef())},[T]),c.useEffect(()=>{var r,t;ye.categoryId===""&&(f==null?void 0:f.length)>0&&ke({categoryId:(r=f[0])==null?void 0:r.value,categoryName:(t=f[0])==null?void 0:t.label})},[f]),e.jsxs("div",{className:"p-2 max-h-full overflow-y-auto",children:[e.jsxs("header",{className:"bg-white border-b border-gray-200 pb-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("button",{onClick:()=>i(-1),className:"flex items-center justify-center w-8 h-8 bg-gray-50 hover:bg-gray-100 border border-gray-300 rounded-md transition-colors flex-shrink-0",children:e.jsx("i",{className:"fas fa-arrow-left text-gray-600 text-sm"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900 truncate",children:((Se=x==null?void 0:x.projectId)==null?void 0:Se.projectName)||"Project"}),e.jsx("p",{className:"text-md text-gray-500",children:x!=null&&x.quoteNo?`Quote: #${x==null?void 0:x.quoteNo}`:""})]})]}),(Ie||U)&&e.jsx(Je,{onClick:z,isLoading:Ne,className:"flex-shrink-0",children:"Generate Quote for Client"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 bg-gray-50 p-3 rounded-xl border border-gray-200",children:[e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"text-[10px] font-bold text-gray-500 uppercase",children:"Plywood Brand"}),e.jsx(he,{options:G,placeholder:"Select Plywood",value:je||"",onValueChange:r=>{const t=G.find(o=>o.value===r);J((t==null?void 0:t.label)||r),se((t==null?void 0:t.value)||null)}})]}),e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"text-[10px] font-bold text-blue-600 uppercase",children:"Inner Laminate"}),e.jsx(he,{options:R,placeholder:"Select Inner Brand",value:ve||"",onValueChange:r=>{const t=R.find(o=>o.value===r);X((t==null?void 0:t.label)||r),ne((t==null?void 0:t.value)||null)}})]}),e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"text-[10px] font-bold text-orange-600 uppercase",children:"Outer Laminate"}),e.jsx(he,{options:O,placeholder:"Select Outer Brand",value:we||"",onValueChange:r=>{const t=O.find(o=>o.value===r);Y((t==null?void 0:t.label)||r),oe((t==null?void 0:t.value)||null)}})]})]}),e.jsxs("div",{className:" grid grid-cols-4 gap-2",children:[e.jsx(Pe,{className:"px-2 py-4 border-l-4 border-blue-600",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-md text-gray-600",children:["Project Cost "," "," ",e.jsx("span",{className:"font-bold",children:"(without profit)"})]}),e.jsxs("p",{className:"text-md font-bold text-blue-600",children:["₹",ae.toLocaleString("en-IN")]})]})}),e.jsx(Pe,{className:"px-2 py-4 border-l-4 border-green-600",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-md text-gray-600",children:["Client Quote Amount "," "," ",e.jsx("span",{className:"font-bold",children:"(with profit)"})]}),e.jsxs("p",{className:"text-md font-bold text-green-600",children:["₹",ie.toLocaleString("en-IN")]})]})}),e.jsx(Pe,{className:"px-2 py-4 border-l-4 border-violet-600",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-md text-gray-600",children:"Profit Amount"}),e.jsxs("p",{className:"text-md font-bold text-violet-600",children:["₹",m.toLocaleString("en-IN")," ",e.jsxs("span",{className:"text-black !text-[12px] ml-[5px] font-semibold",children:["(",P.toFixed(2),"%)"]})]})]})}),e.jsx(Pe,{className:"px-2 py-4 border-l-4 border-orange-600",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-md text-gray-600",children:"Single Labour Cost"}),e.jsxs("p",{className:"text-md font-bold text-orange-600",children:["₹",w]})]})})]})]}),B||q?e.jsx(Xe,{}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-6",children:[T.map((r,t)=>e.jsx(rt,{index:t,data:r,labourCost:w,ref:E.current[t],brandRatesByName:te,innerLaminateRatesByBrand:W,outerLaminateRatesByBrand:pe,selectedBrand:A,selectedInnerBrand:D,selectedOuterBrand:_,brandOptions:Re,innerOptions:R,outerOptions:O,globalTransportation:b,globalProfitPercent:M,onFurnitureChange:u,onProfitOverride:o=>l(t,o)},t)),I.length>0&&e.jsxs("div",{className:"mt-10 bg-white border-2 border-dashed border-blue-200 rounded-2xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-blue-100 p-2 rounded-lg",children:e.jsx("i",{className:"fas fa-tools text-blue-600 text-xl"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Common Site Materials"}),e.jsx("p",{className:"text-xs text-gray-500 italic",children:"Quantities are fixed. Only Profit % can be adjusted for variants."})]})]}),e.jsxs("div",{className:"text-right flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-blue-50 px-3 py-1 rounded-lg border border-blue-100 shadow-sm",children:[e.jsx("label",{className:"text-[10px] font-bold text-blue-500 uppercase tracking-tighter",children:"Common Profit Overlay"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"number",className:"w-12 text-right font-black bg-transparent outline-none text-blue-800",value:ee??M,placeholder:"0",onChange:r=>{const t=r.target.value===""?0:parseFloat(r.target.value);le(t),Z(o=>o.map(s=>({...s,profitOnMaterial:0})))}}),e.jsx("span",{className:"text-blue-600 font-black ml-1 text-sm",children:"%"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-bold text-blue-500 uppercase",children:"Section Total"}),e.jsxs("p",{className:"text-2xl font-black text-blue-700",children:["₹",I.reduce((r,t)=>r+(t.rowTotal||0),0).toLocaleString("en-IN")]})]})]})]}),Q()]}),e.jsx("div",{className:"flex items-center justify-between gap-4 bg-white border border-blue-100 p-4 rounded-xl shadow-sm mt-8",children:e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-[10px] font-extrabold text-blue-500 uppercase tracking-tighter",children:"Global Transport Cost"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-gray-400 mr-1 text-sm font-bold",children:"₹"}),e.jsx("span",{className:"font-bold text-gray-800",children:b.toLocaleString("en-IN")})]})]}),e.jsx("div",{className:"h-10 w-px bg-gray-100"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-[10px] font-extrabold text-green-500 uppercase tracking-tighter",children:"Global Profit Margin (%)"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"number",className:"w-16 text-right font-black focus:outline-none text-green-700 bg-green-50 rounded px-2 py-1 border border-green-100",value:M,onChange:r=>{const t=parseFloat(r.target.value)||0;me(t),le(t),re(o=>o.map(s=>({...s,furnitureProfit:t,coreMaterials:s.coreMaterials.map(n=>({...n,profitOnMaterial:0,profitOnLabour:0})),fittingsAndAccessories:s.fittingsAndAccessories.map(n=>({...n,profitOnMaterial:0})),glues:s.glues.map(n=>({...n,profitOnMaterial:0})),nonBrandMaterials:s.nonBrandMaterials.map(n=>({...n,profitOnMaterial:0}))}))),Z(o=>o.map(s=>({...s,profitOnMaterial:0})))}}),e.jsx("span",{className:"text-green-500 ml-1 font-bold text-sm",children:"%"})]}),e.jsx("p",{className:"text-[9px] text-gray-400 italic",children:"Overrides all product margins"})]})]})}),e.jsx("section",{className:"mt-10 text-right",children:e.jsxs("div",{className:"inline-block bg-green-50 border border-green-200 rounded-md px-6 py-4",children:[e.jsx("p",{className:"text-md font-medium text-gray-700 mb-1",children:"Total Estimate"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700",children:["₹",ie.toLocaleString("en-IN")]})]})})]})})]})};export{at as DEFAULT_LAMINATE_RATE_PER_SQFT,it as default};
