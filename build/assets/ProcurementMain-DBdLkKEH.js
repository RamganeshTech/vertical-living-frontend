import{u as j,a as I,r as p,j as e}from"./index-Di9fivK2.js";import{u as b}from"./useQuery-D3U2IXUF.js";import{g as N}from"./roleCheck-CZ0YkMwP.js";import"./useBaseQuery-DArxBqcU.js";const F=async({organizationId:t,api:r})=>{const{data:a}=await r.get(`/procurement/${t}`);if(!a.ok)throw new Error(a.message||"Failed to fetch logs");return a.data.activeLog},L=async({organizationId:t,projectId:r,stageId:a,api:i})=>{const c=new URLSearchParams;r&&c.append("projectId",r),a&&c.append("stageId",a);const{data:d}=await i.get(`/procurement/${t}/filter?${c.toString()}`);if(!d.ok)throw new Error(d.message||"Failed to fetch filtered logs");return d.data},A=t=>{const{role:r}=j(),a=N(r);return b({queryKey:["procurementAllLogs",t],queryFn:async()=>{if(!a)throw new Error("API instance missing");return await F({organizationId:t,api:a})},enabled:!!t,retry:!1,refetchOnWindowFocus:!1})},k=({organizationId:t,projectId:r,stageId:a})=>{const{role:i}=j(),c=N(i);return b({queryKey:["procurementLogsFiltered",t,r,a],queryFn:async()=>{if(!c)throw new Error("API instance missing");return await L({organizationId:t,projectId:r,stageId:a,api:c})},enabled:!!t,retry:!1,refetchOnWindowFocus:!1})};function R(){var y;const{organizationId:t}=I(),[r,a]=p.useState({projectId:"",stageId:"",actionType:"",userType:"",searchTerm:""}),[i,c]=p.useState(!1),d=r.projectId||r.stageId,v=A(t),w=k({organizationId:t,projectId:r.projectId||void 0,stageId:r.stageId||void 0}),n=d?w:v,m=n.data||[],o=p.useMemo(()=>m.filter(s=>{const l=!r.actionType||s.actionType===r.actionType,u=!r.userType||s.userType===r.userType,C=!r.searchTerm||s.description.toLowerCase().includes(r.searchTerm.toLowerCase())||s.actionType.toLowerCase().includes(r.searchTerm.toLowerCase());return l&&u&&C}),[m,r]),x=(s,l)=>{a(u=>({...u,[s]:l}))},T=()=>{a({projectId:"",stageId:"",actionType:"",userType:"",searchTerm:""})},h=s=>{switch(s.toLowerCase()){case"create":return"fas fa-plus-circle text-green-500";case"update":return"fas fa-edit text-blue-500";case"delete":return"fas fa-trash text-red-500";case"upload":return"fas fa-upload text-purple-500";case"assign":return"fas fa-user-plus text-orange-500";default:return"fas fa-info-circle text-gray-500"}},f=s=>{switch(s){case"UserModel":return"fas fa-user";case"StaffModel":return"fas fa-user-tie";case"WorkerModel":return"fas fa-hard-hat";case"ClientModel":return"fas fa-handshake";case"CTOModel":return"fas fa-crown";default:return"fas fa-user"}},g=s=>new Date(s).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return n.isLoading?e.jsx("div",{className:"w-full min-h-screen bg-gray-50 p-4 lg:p-8",children:e.jsxs("div",{className:"w-full bg-white rounded-lg shadow-sm",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"h-6 bg-gray-200 rounded w-48 animate-pulse"})]})}),e.jsx("div",{className:"p-6 space-y-4",children:[...Array(5)].map((s,l)=>e.jsxs("div",{className:"flex space-x-4 animate-pulse",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]})]},l))})]})}):n.isError?e.jsx("div",{className:"w-full min-h-screen bg-gray-50 p-4 lg:p-8",children:e.jsxs("div",{className:"w-full bg-white rounded-lg shadow-sm p-8 text-center",children:[e.jsx("div",{className:"mb-4",children:e.jsx("i",{className:"fas fa-exclamation-triangle text-red-500 text-4xl"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Failed to Load Logs"}),e.jsx("p",{className:"text-gray-600 mb-4",children:((y=n.error)==null?void 0:y.message)||"An error occurred while fetching the logs."}),e.jsxs("button",{onClick:()=>n.refetch(),className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx("i",{className:"fas fa-redo mr-2"}),"Try Again"]})]})}):e.jsx("div",{className:"w-full min-h-screen bg-gray-50 p-4 lg:p-8",children:e.jsxs("div",{className:"w-full bg-white rounded-lg shadow-sm",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-4 lg:space-y-0",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("i",{className:"fas fa-clipboard-list text-blue-600 text-2xl"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Procurement Logs"}),e.jsx("p",{className:"text-gray-600",children:"Track all procurement activities and changes"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:[o.length," ",o.length===1?"entry":"entries"]}),e.jsxs("button",{onClick:()=>c(!i),className:`inline-flex items-center px-4 py-2 rounded-lg border transition-colors ${i?"bg-blue-50 border-blue-200 text-blue-700":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:[e.jsx("i",{className:"fas fa-filter mr-2"}),"Filters"]}),e.jsxs("button",{onClick:()=>n.refetch(),className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx("i",{className:"fas fa-sync-alt mr-2"}),"Refresh"]})]})]})}),i&&e.jsxs("div",{className:"p-6 bg-gray-50 border-b border-gray-200",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx("i",{className:"fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search logs...",value:r.searchTerm,onChange:s=>x("searchTerm",s.target.value),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Project ID"}),e.jsx("input",{type:"text",placeholder:"Filter by project...",value:r.projectId,onChange:s=>x("projectId",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Stage ID"}),e.jsx("input",{type:"text",placeholder:"Filter by stage...",value:r.stageId,onChange:s=>x("stageId",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Action Type"}),e.jsxs("select",{value:r.actionType,onChange:s=>x("actionType",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"All Actions"}),e.jsx("option",{value:"create",children:"Create"}),e.jsx("option",{value:"update",children:"Update"}),e.jsx("option",{value:"delete",children:"Delete"}),e.jsx("option",{value:"upload",children:"Upload"}),e.jsx("option",{value:"assign",children:"Assign"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"User Type"}),e.jsxs("select",{value:r.userType,onChange:s=>x("userType",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"All Users"}),e.jsx("option",{value:"UserModel",children:"User"}),e.jsx("option",{value:"StaffModel",children:"Staff"}),e.jsx("option",{value:"WorkerModel",children:"Worker"}),e.jsx("option",{value:"ClientModel",children:"Client"}),e.jsx("option",{value:"CTOModel",children:"CTO"})]})]})]}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsxs("button",{onClick:T,className:"inline-flex items-center px-3 py-1 text-sm text-gray-600 hover:text-gray-800 transition-colors",children:[e.jsx("i",{className:"fas fa-times mr-1"}),"Clear Filters"]})})]}),e.jsx("div",{className:"p-6",children:o.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("i",{className:"fas fa-inbox text-gray-400 text-4xl mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No logs found"}),e.jsx("p",{className:"text-gray-600",children:m.length===0?"No procurement logs have been recorded yet.":"No logs match your current filters. Try adjusting your search criteria."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden lg:block overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Action"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"User"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Description"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Project"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Stage"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Date"})]})}),e.jsx("tbody",{children:o.map(s=>{var l;return e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"py-4 px-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("i",{className:h(s.actionType)}),e.jsx("span",{className:"font-medium capitalize",children:s.actionType})]})}),e.jsx("td",{className:"py-4 px-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("i",{className:`${f(s==null?void 0:s.userType)} text-gray-600`}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:(l=s==null?void 0:s.userType)==null?void 0:l.replace("Model","")}),s.userRole&&e.jsx("div",{className:"text-sm text-gray-500",children:s==null?void 0:s.userRole})]})]})}),e.jsx("td",{className:"py-4 px-4",children:e.jsx("div",{className:"max-w-xs",children:e.jsx("p",{className:"text-gray-900 truncate",title:s.description,children:s.description||"No description"})})}),e.jsx("td",{className:"py-4 px-4",children:s.projectId?e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[e.jsx("i",{className:"fas fa-project-diagram mr-1"}),s.projectId.slice(-6)]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"py-4 px-4",children:s.stageId?e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[e.jsx("i",{className:"fas fa-layer-group mr-1"}),s.stageId.slice(-6)]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"py-4 px-4 text-sm text-gray-600",children:g(s.createdAt)})]},s._id)})})]})}),e.jsx("div",{className:"lg:hidden space-y-4",children:o.map(s=>{var l;return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("i",{className:h(s.actionType)}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 capitalize",children:s.actionType}),e.jsx("p",{className:"text-sm text-gray-600",children:g(s.createdAt)})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("i",{className:`${f(s.userType)} text-gray-600`}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:(l=s==null?void 0:s.userType)==null?void 0:l.replace("Model","")})]})]}),e.jsx("p",{className:"text-gray-900 mb-3",children:s.description||"No description"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.projectId&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[e.jsx("i",{className:"fas fa-project-diagram mr-1"}),"Project: ",s.projectId.slice(-6)]}),s.stageId&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[e.jsx("i",{className:"fas fa-layer-group mr-1"}),"Stage: ",s.stageId.slice(-6)]}),s.userRole&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:[e.jsx("i",{className:"fas fa-user-tag mr-1"}),s.userRole]})]})]},s._id)})})]})})]})})}export{R as default};
