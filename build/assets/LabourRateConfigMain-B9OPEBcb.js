import{d as M,r as F,j as e,M as P,B as g,I,t as v,G as B,H as G,J as H,K}from"./index-D5hl8ps7.js";import{u as O,a as _,b as $,c as J,d as T}from"./labourRateconfigApi-DlvsdSgq.js";function V(){var l,r;const{organizationId:d}=M(),{data:N}=O(d),{data:u,isLoading:h,refetch:f}=_(d),{mutateAsync:S,isPending:C}=$(),{mutateAsync:i,isPending:w}=J(),[x,p]=F.useState([{data:{}}]);if(h)return e.jsx(P,{});const o=(l=N||[])==null?void 0:l.find(t=>t.organizationId===d);if(!o)return e.jsx("p",{children:"Category not found"});const E=(t,n,a)=>{var A,z;const s=[...x];s[t].data[n]=a;const m=(z=(A=o.fields)==null?void 0:A[0])==null?void 0:z.key,L=t===s.length-1,y=n===m,b=(a==null?void 0:a.toString().trim())!=="",q=s.length>0&&Object.values(s[s.length-1].data).every(R=>R===void 0||R==="");if(L&&y&&b&&!q&&s.push({data:{}}),!b&&y&&x.length>1){const R=s[s.length-1];Object.values(R.data).every(D=>D===void 0||D==="")&&s.pop()}p(s)},k=()=>p([...x,{data:{}}]),j=t=>{const n=[...x];n.splice(t,1),p(n)},c=async()=>{var t,n,a,s;try{const m=(n=(t=o.fields)==null?void 0:t[0])==null?void 0:n.key,L=x.map(y=>y.data).filter(y=>{const b=y[m];return b!=null&&b.toString().trim()!==""});if(L.length===0)return v({title:"Error",description:"Nothing to save",variant:"destructive"});await S({items:L,organizationId:d}),v({title:"Success",description:"field created successfully"}),p([{data:{}}]),f()}catch(m){v({title:"Error",description:((s=(a=m==null?void 0:m.response)==null?void 0:a.data)==null?void 0:s.message)??"Operation failed"})}};return e.jsxs("div",{className:"space-y-4  ",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center sticky top-0 bg-white z-10",children:[e.jsx("div",{className:"flex gap-2 items-center",children:e.jsx("div",{children:((r=o.name)==null?void 0:r.toLowerCase())==="Labour and Miscellaneous".toLowerCase()&&e.jsx("span",{className:"block absolute -top-[22px] text-[12px] text-gray-500",children:"* Enter the rupees per head (Every field will be added for single labour cost)"})})}),e.jsxs("div",{className:"flex gap-2 mt-3 sm:mt-0 absolute -top-[83px] right-[5px] ",children:[e.jsx(g,{onClick:k,variant:"primary",className:"",children:"+ Add Row"}),e.jsxs(g,{onClick:c,isLoading:C,className:"bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx("i",{className:"fas fa-file mr-2"})," Save Items"]})]})]}),e.jsx("div",{className:"overflow-x-auto ",children:e.jsxs("table",{className:"min-w-full bg-white text-sm",children:[e.jsx("thead",{className:"bg-blue-50 text-sm font-semibold text-gray-600 px-6 py-1 sm:py-3",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-6 py-1 sm:py-3  text-xs font-medium text-gray-500 uppercase tracking-wider",children:"S.NO"}),o.fields.map(t=>e.jsx("th",{className:"text-center px-6 py-1 sm:py-3  text-xs font-medium text-gray-500 uppercase tracking-wider",children:t.key},t.key)),e.jsx("th",{className:"text-center px-6 py-1 sm:py-3  text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsxs("tbody",{children:[u==null?void 0:u.map((t,n)=>{var a;return e.jsxs("tr",{className:`group relative border-none !border-b-1 px-4 py-2  cursor-pointer transition-all duration-200
     hover:bg-gray-50 hover:border-gray-300
  `,children:[e.jsx("td",{className:"border border-gray-100 font-medium text-center  text-sm text-gray-700 group-hover:text-gray-900 transition-colors duration-200",children:n+1||"—"}),(a=o==null?void 0:o.fields)==null?void 0:a.map(s=>e.jsx("td",{className:"border border-gray-100 font-medium text-center  text-sm text-gray-700 group-hover:text-gray-900 transition-colors duration-200",children:(t==null?void 0:t.data[s==null?void 0:s.key])??"—"},s==null?void 0:s.key)),e.jsx("td",{className:"text-center p-4 border border-gray-100",children:e.jsxs(g,{size:"sm",variant:"danger",isLoading:w,className:"group text-white bg-red-600",onClick:()=>i({itemId:t==null?void 0:t._id,organizationId:d}),children:[e.jsx("i",{className:"fas fa-trash mr-2"}),e.jsx("span",{className:"",children:"Delete"})]})})]},`existing-${t==null?void 0:t._id}`)}),x.map((t,n)=>e.jsxs("tr",{className:`group relative border-none !border-b-1 px-4 py-2  cursor-pointer transition-all duration-200\r
                                hover:bg-gray-50 hover:border-gray-300`,children:[e.jsx("td",{className:`border border-gray-100 px-4 font-medium text-center  \r
                                    text-sm text-gray-700 group-hover:text-gray-900 \r
                                    transition-colors duration-200`,children:u.length+n+1}),o.fields.map(a=>e.jsx("td",{className:"border border-gray-100 px-4 font-medium text-center  text-sm text-gray-700 group-hover:text-gray-900 transition-colors duration-200",children:e.jsx(I,{type:a.type==="number"?"number":"text",placeholder:a.key,className:"w-full rounded-md ",value:t.data[a.key]||"",onChange:s=>E(n,a.key,a.type==="number"?Number(s.target.value):s.target.value)})},a.key)),e.jsx("td",{className:"text-center p-4 border border-gray-100",children:e.jsxs(g,{size:"sm",variant:"ghost",className:"group text-white bg-red-600 hover:bg-red-600",onClick:()=>j(n),children:[e.jsx("i",{className:"fas fa-xmark mr-2"})," Remove"]})})]},`new-${n}`))]})]})})]})}function X(){const{organizationId:d}=M(),[N,u]=F.useState("Labour and Miscellaneous"),[h,f]=F.useState([{key:"Category",type:"string",required:!1},{key:"Rs",type:"number",required:!1},{key:"notes",type:"string",required:!1}]),[S,C]=F.useState(!1),{data:i,isLoading:w,refetch:x}=O(d),{mutateAsync:p,isPending:o}=T(),E=()=>{f([...h,{key:"",type:"string",required:!1}])},k=(c,l,r)=>{const t=[...h];t[c][l]=r,f(t)},j=async()=>{var c,l;try{await p({organizationId:d,name:N,fields:h}),u(""),f([{key:"",type:"string",required:!1}]),C(!1),x(),v({title:"Success",description:"Category Created Successfully"})}catch(r){v({title:"Error",description:((l=(c=r==null?void 0:r.response)==null?void 0:c.data)==null?void 0:l.message)||(r==null?void 0:r.message)||"failed to create category",variant:"destructive"})}};return e.jsxs("div",{className:"space-y-6 max-h-full overflow-y-auto ",children:[e.jsxs("header",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 ",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-cubes mr-3 text-blue-600"}),"Labour Rate Configuration"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your labour's charges here"})]}),(i==null?void 0:i.length)===0&&e.jsx("div",{children:e.jsx(g,{onClick:j,isLoading:o,children:"Create New Category"})})]}),e.jsx(B,{open:S,onOpenChange:C,children:e.jsxs(G,{className:"px-5 py-6",children:[e.jsx(H,{className:"px-0 py-0",children:e.jsx(K,{children:"Create New Labour Category"})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(I,{placeholder:"Labour and Miscellaneous",value:N}),e.jsx("h4",{className:"text-base font-semibold",children:"Define Fields"}),e.jsx("div",{className:"space-y-2",children:h.map((c,l)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(I,{placeholder:"Field key (e.g: Category, Rs, notes)",value:c.key,onChange:r=>k(l,"key",r.target.value),className:"flex-1"}),e.jsxs("select",{value:c.type,onChange:r=>k(l,"type",r.target.value),className:"  px-2 py-2 rounded-xl border border-blue-200 focus:border-blue-200 active:border-blue-200",children:[e.jsx("option",{value:"string",children:"text"}),e.jsx("option",{value:"number",children:"number"})]})]},l))}),e.jsxs("div",{className:"flex justify-between pt-2",children:[e.jsx(g,{variant:"secondary",onClick:E,children:"+ Add Field"}),e.jsx(g,{isLoading:o,onClick:j,children:"Create Category"})]})]})]})}),!w&&(i==null?void 0:i.length)===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[300px] w-full bg-white rounded-xl   text-center p-6",children:[e.jsx("i",{className:"fas fa-box-open text-5xl text-blue-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-1",children:"No Labour Rate Configuration Found"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Looks like there are no Labour Rate Configuration yet for this organization.",e.jsx("br",{}),e.jsx(g,{onClick:j,isLoading:o,className:"mx-4 my-2",children:"Create New Category"})]})]}),w&&e.jsx(P,{}),(i==null?void 0:i.length)>0&&e.jsx(V,{})]})}export{X as default};
