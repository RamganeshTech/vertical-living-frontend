import{b as $,a as B,r as b,c as U,j as e}from"./index-By5P0A7l.js";import{B as x}from"./Button-DLUK8O0t.js";import{L as t}from"./Label-TAdUzpu-.js";import{I as z}from"./ImageGalleryMain-D80ZvsH6.js";import{T as G}from"./TextArea-Bw4XrQML.js";import{S as _}from"./SearchSelectNew-B6SBCGTt.js";import{u as L}from"./toolOtpApi-Cj-5bnMm.js";const q=["carpentry","tiling","electrical","plumbing","falseCeiling","painting","finishing","measurement","handTools","powerTools","safety","cleaning","other"],H=["new","good","repair"],D=({mode:C,initialData:s,isSubmitting:i,onSubmit:k,onQuickUpload:p})=>{var v,w;const f=$(),{organizationId:S}=B(),[m,j]=b.useState(C),{role:R,permission:g}=U(),T=R==="owner"||((v=g==null?void 0:g.tools)==null?void 0:v.edit),I={toolName:"",toolCategory:"Drill",brand:"",modelNumber:"",toolRoomId:null,conditionStatus:"",purchaseDate:new Date().toISOString().split("T")[0],purchaseValue:0,remarks:"",images:[]},{data:E=[]}=L(S),[l,c]=b.useState(I);b.useEffect(()=>{s&&c({toolName:s.toolName||"",toolCategory:s.toolCategory||"Drill",brand:s.brand||"",modelNumber:s.modelNumber||"",toolRoomId:(s==null?void 0:s.toolRoomId._id)||null,conditionStatus:s.conditionStatus||"",purchaseDate:s.purchaseDate?new Date(s.purchaseDate).toISOString().split("T")[0]:"",purchaseValue:s.purchaseValue||0,remarks:s.remarks||"",images:[]})},[s,m]);const d=r=>{const{name:o,value:u}=r.target;c(h=>({...h,[o]:u}))},F=r=>{r.target.files&&c(o=>({...o,images:[...o.images,...Array.from(r.target.files||[])]}))},M=r=>{c(o=>({...o,images:o.images.filter((u,h)=>h!==r)}))},O=async r=>{r.preventDefault();const{images:o,...u}=l;await k(u,o),m==="edit"&&j("view")},V=E.map(r=>({value:r._id,label:`${r.toolRoomName}`})),A=r=>{c(o=>({...o,toolRoomId:r}))},P=async()=>{l.images.length>0&&p&&(await p(l.images),c(r=>({...r,images:[]})))},a=m==="view",n=m==="create",N=m==="edit",y=()=>j(r=>r==="view"?"edit":"view");return e.jsxs("div",{className:"max-w-full mx-auto space-y-4",children:[e.jsxs("header",{className:"sticky top-0 z-20 bg-white border-b border-gray-200 pb-2 mb-3 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:()=>f(-1),className:"bg-blue-50 hover:bg-blue-100 flex items-center justify-center w-9 h-9 border border-blue-200 text-blue-600 cursor-pointer rounded-lg",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:n?"Register Tool":N?"Update Tool":"Tool Details"}),e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wider font-semibold",children:(s==null?void 0:s.toolCode)||"New Asset"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[a&&T&&e.jsxs(x,{type:"button",onClick:y,variant:"outline",className:"border-blue-600 text-blue-600",children:[e.jsx("i",{className:"fas fa-edit mr-2"}),"Edit Details"]}),(n||N)&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(x,{type:"button",onClick:O,disabled:i,className:"bg-blue-600 text-white",children:[i?e.jsx("i",{className:"fas fa-spinner fa-spin mr-2"}):e.jsx("i",{className:"fas fa-save mr-2"}),n?"Save Tool":"Save Changes"]}),e.jsx(x,{variant:"outline",type:"button",onClick:()=>n?f(-1):y(),className:"bg-white",children:"Cancel"})]})]})]}),e.jsxs("form",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("h3",{className:"text-sm font-black text-blue-600 uppercase tracking-widest mb-4 flex items-center",children:[e.jsx("i",{className:"fas fa-info-circle mr-2"})," Identity & Brand"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{children:"Tool Name"}),e.jsx("input",{name:"toolName",value:l.toolName,onChange:d,disabled:a,className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none mt-1",placeholder:"e.g., Bosch Hammer Drill"})]}),e.jsxs("div",{children:[e.jsx(t,{children:"Category"}),e.jsx("select",{name:"toolCategory",value:l.toolCategory,onChange:d,disabled:a,className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 bg-white mt-1",children:q.map(r=>e.jsx("option",{value:r,children:r[0].toUpperCase()+r.slice(1)},r))})]}),e.jsxs("div",{children:[e.jsx(t,{children:"Brand"}),e.jsx("input",{name:"brand",value:l.brand,onChange:d,disabled:a,className:"w-full px-3 py-2 border rounded-lg mt-1"})]}),e.jsxs("div",{children:[e.jsx(t,{children:"Model Number"}),e.jsx("input",{name:"modelNumber",value:l.modelNumber,onChange:d,disabled:a,className:"w-full px-3 py-2 border rounded-lg mt-1",placeholder:"Required for issue"})]}),e.jsxs("div",{children:[e.jsx(t,{children:"Conditional Status"}),e.jsx("select",{name:"conditionStatus",value:l.conditionStatus,onChange:d,disabled:a,className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 bg-white mt-1",children:H.map(r=>e.jsx("option",{value:r,children:r},r))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Search Room"}),e.jsx(_,{options:V,placeholder:"Enter Tool Room Name...",value:l.toolRoomId||"",onValueChange:A,displayFormat:"detailed",className:"w-full"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("h3",{className:"text-sm font-black text-blue-600 uppercase tracking-widest mb-4 flex items-center",children:[e.jsx("i",{className:"fas fa-file-invoice-dollar mr-2"})," Procurement"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{children:"Purchase Date"}),e.jsx("input",{type:"date",name:"purchaseDate",value:l.purchaseDate,onChange:d,disabled:a,className:"w-full px-3 py-2 border rounded-lg mt-1"})]}),e.jsxs("div",{children:[e.jsx(t,{children:"Purchase Value (â‚¹)"}),e.jsx("input",{type:"number",name:"purchaseValue",value:l.purchaseValue,onChange:d,disabled:a,className:"w-full px-3 py-2 border rounded-lg mt-1"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsx(t,{children:"Remarks & Maintenance Notes"}),e.jsx(G,{name:"remarks",value:l.remarks,onChange:d,disabled:a,className:"w-full mt-2",placeholder:"Describe current condition or missing accessories...",rows:4})]})]}),e.jsxs("div",{className:"space-y-6",children:[a&&((w=s==null?void 0:s.toolImages)==null?void 0:w.length)>0&&e.jsxs("section",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("h3",{className:"text-sm font-black text-gray-900 uppercase tracking-widest mb-4 border-b pb-2 flex items-center",children:[e.jsx("i",{className:"fas fa-images mr-2 text-blue-500"})," Gallery"]}),e.jsx(z,{imageFiles:s.toolImages.map(r=>({...r,url:r.url})),height:120,minWidth:120})]}),e.jsxs("section",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsx("h3",{className:"text-sm font-black text-gray-900 uppercase tracking-widest mb-4 pb-2 border-b flex justify-between items-center",children:e.jsxs("span",{children:[e.jsx("i",{className:"fas fa-camera mr-2 text-blue-500"})," ",n?"Upload Photos":"Add New Photos"]})}),e.jsxs("div",{className:`relative w-full h-32 border-2 border-dashed rounded-xl transition-colors flex flex-col items-center justify-center ${a?"bg-blue-50 border-blue-200":"bg-gray-50 border-gray-300 hover:border-blue-500"}`,children:[e.jsx("input",{type:"file",multiple:!0,accept:"image/*,.pdf",onChange:F,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer z-20"}),e.jsx("i",{className:"fas fa-cloud-upload-alt text-3xl text-gray-400 mb-2"}),e.jsx("p",{className:"text-[10px] font-bold text-gray-500 uppercase tracking-tight text-center px-4",children:"Drag or Click to upload tool images"})]}),l.images.length>0&&e.jsxs("div",{className:"mt-4 space-y-2",children:[l.images.map((r,o)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 border border-gray-200 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 truncate",children:[e.jsx("i",{className:"fas fa-file-image text-blue-500"}),e.jsx("span",{className:"text-[11px] font-medium text-gray-700 truncate",children:r.name})]}),e.jsx("button",{type:"button",onClick:()=>M(o),className:"text-red-500 hover:bg-red-50 p-1 rounded-md transition-colors",children:e.jsx("i",{className:"fas fa-times"})})]},o)),a&&e.jsx("div",{className:"flex justify-end pt-2",children:e.jsx(x,{type:"button",onClick:P,disabled:i,className:"h-8 text-xs bg-blue-600",children:i?"Uploading...":"Quick Upload Now"})})]})]}),!n&&e.jsxs("div",{className:`p-6 rounded-xl border flex items-center justify-between shadow-sm ${(s==null?void 0:s.availabilityStatus)==="available"?"bg-green-50 border-green-100":"bg-orange-50 border-orange-100"}`,children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-black uppercase text-gray-500 tracking-tighter",children:"Current Status"}),e.jsx("p",{className:`text-xl font-bold capitalize ${(s==null?void 0:s.availabilityStatus)==="available"?"text-green-700":"text-orange-700"}`,children:s==null?void 0:s.availabilityStatus})]}),e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center text-xl ${(s==null?void 0:s.availabilityStatus)==="available"?"bg-green-100 text-green-600":"bg-orange-100 text-orange-600"}`,children:e.jsx("i",{className:`fas ${(s==null?void 0:s.availabilityStatus)==="available"?"fa-check-circle":"fa-hand-holding"}`})})]})]})]})]})};export{D as T};
