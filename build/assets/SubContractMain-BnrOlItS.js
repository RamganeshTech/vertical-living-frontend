import{c as R,j as e,b as Y,d as $,r as T,a as q,O as J}from"./index-By5P0A7l.js";import{u as Q,a as X}from"./subContractNewApi-C6bRkCh9.js";import{t as E}from"./toast-BSC5QTk1.js";import{B as L}from"./Button-DLUK8O0t.js";import{C as Z,b as K,a as ee}from"./Card-CFqBlVQz.js";import{B as se}from"./Badge-BHW6q2S6.js";import{S as te}from"./index-2HVimfc8.js";import{I as P}from"./Input-DKpmFZl7.js";import{u as m}from"./useDebounce-DqqsQWok.js";import{S as ae}from"./StageGuide-D14I8_Im.js";import"./useQuery-Cc7pLKfK.js";import"./useMutation-7YLqc7VE.js";import"./useInfiniteQuery-DQF0m-E9.js";import"./roleCheck-YGaMnK_P.js";import"./index-BQTHaHB-.js";const re=({data:r,index:g,isDeleting:j,onDelete:p,onView:N})=>{var C,u,d;const{role:i,permission:x}=R(),v=i==="owner"||((C=x==null?void 0:x.subcontract)==null?void 0:C.delete),s=c=>{switch(c){case"pending":return"bg-yellow-100 text-yellow-800";case"accepted":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},l=c=>new Date(c).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"}),y=c=>{c.stopPropagation(),p()};return e.jsxs(Z,{onClick:N,className:"border-l-4 border-blue-600 relative group cursor-pointer p-4 transition-all duration-300 ease-in-out hover:shadow-xl hover:-translate-y-1",children:[e.jsx(K,{className:"pb-3",children:e.jsx("div",{className:"flex justify-between items-start",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:["#",g+1]}),e.jsx(se,{className:s(r.status),children:r.status.toUpperCase()})]}),e.jsxs("h3",{className:"font-semibold text-lg text-gray-900 mb-1",children:[e.jsx("i",{className:"fas fa-briefcase mr-2 text-blue-500"}),r.workName]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("i",{className:"fas fa-user-hard-hat mr-1"}),r.workerName]})]})})}),e.jsxs(ee,{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"text-gray-500",children:[e.jsx("i",{className:"fas fa-calendar-plus mr-1"}),"Start:"]}),e.jsx("p",{className:"font-medium",children:l(r.dateOfCommencement)})]}),e.jsxs("div",{children:[e.jsxs("span",{className:"text-gray-500",children:[e.jsx("i",{className:"fas fa-calendar-check mr-1"}),"End:"]}),e.jsx("p",{className:"font-medium",children:l(r.dateOfCompletion)})]})]}),e.jsx("div",{className:"border-t pt-3",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-500",children:[e.jsx("i",{className:"fas fa-hammer mr-1"}),"Labour Cost:"]}),e.jsxs("span",{className:"font-medium",children:["â‚¹ ",r.labourCost.toLocaleString("en-IN")]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-500",children:[e.jsx("i",{className:"fas fa-tools mr-1"}),"Material Cost:"]}),e.jsxs("span",{className:"font-medium",children:["â‚¹ ",r.materialCost.toLocaleString("en-IN")]})]}),e.jsxs("div",{className:"flex justify-between text-sm border-t pt-2",children:[e.jsxs("span",{className:"text-gray-700 font-semibold",children:[e.jsx("i",{className:"fas fa-rupee-sign mr-1"}),"Total Cost:"]}),e.jsxs("span",{className:"font-bold text-blue-600",children:["â‚¹ ",r.totalCost.toLocaleString("en-IN")]})]})]})}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 border-t pt-2",children:[e.jsxs("span",{children:[e.jsx("i",{className:"fas fa-image mr-1"}),"Before: ",((u=r.filesBeforeWork)==null?void 0:u.length)||0," files"]}),e.jsxs("span",{children:[e.jsx("i",{className:"fas fa-images mr-1"}),"After: ",((d=r.filesAfterWork)==null?void 0:d.length)||0," files"]})]})]}),e.jsx("div",{children:e.jsx("div",{className:"flex gap-2 w-full",children:v&&e.jsx(L,{variant:"danger",className:`absolute top-2 right-2 h-8 w-8 rounded-full\r
                           flex items-center justify-center\r
                           opacity-0 group-hover:opacity-100 transition-opacity\r
                           hover:!opacity-100 bg-red-600 text-white hover:text-white`,isLoading:j,size:"sm",onClick:y,children:e.jsx("i",{className:"fas fa-trash"})})})})]})},Ce=()=>{var B,A;const r=Y(),g=$(),j=T.useRef(null),{organizationId:p}=q(),{role:N,permission:i}=R(),x=N==="owner"||((B=i==null?void 0:i.subcontract)==null?void 0:B.list),v=N==="owner"||((A=i==null?void 0:i.subcontract)==null?void 0:A.create),[s,l]=T.useState({search:"",status:"",projectId:"",workerName:"",dateOfCommencementFrom:"",dateOfCommencementTo:"",dateOfCompletionFrom:"",dateOfCompletionTo:"",labourCostMin:"0",labourCostMax:"100000",materialCostMin:"0",materialCostMax:"100000",totalCostMin:"0",totalCostMax:"100000",sortBy:"createdAt",sortOrder:"desc"}),y=m(s.search,500),C=[{title:"Labour Cost",minKey:"labourCostMin",maxKey:"labourCostMax"},{title:"Material Cost",minKey:"materialCostMin",maxKey:"materialCostMax"},{title:"Total Cost",minKey:"totalCostMin",maxKey:"totalCostMax"}],u={labourCostMin:m(s.labourCostMin,500),labourCostMax:m(s.labourCostMax,500),materialCostMin:m(s.materialCostMin,500),materialCostMax:m(s.materialCostMax,500),totalCostMin:m(s.totalCostMin,500),totalCostMax:m(s.totalCostMax,500)},{data:d,isLoading:c,isError:V,error:w,fetchNextPage:I,hasNextPage:M,isFetchingNextPage:k,refetch:D}=Q({organizationId:p||"",status:s.status,projectId:s.projectId,search:y||void 0,labourCostMin:s.labourCostMin,labourCostMax:s.labourCostMax,materialCostMin:s.materialCostMin,materialCostMax:s.materialCostMax,totalCostMin:s.totalCostMin,totalCostMax:s.totalCostMax,dateOfCommencementFrom:s.dateOfCommencementFrom,dateOfCommencementTo:s.dateOfCommencementTo,dateOfCompletionFrom:s.dateOfCompletionFrom,dateOfCompletionTo:s.dateOfCompletionTo,limit:10}),S=X(),O=Object.entries(s).filter(([t,a])=>t==="sortBy"||t==="sortOrder"?!1:a!=="").length,z=()=>{l({search:"",status:"",projectId:"",workerName:"",dateOfCommencementFrom:"",dateOfCommencementTo:"",dateOfCompletionFrom:"",dateOfCompletionTo:"",labourCostMin:"0",labourCostMax:"100000",materialCostMin:"0",materialCostMax:"100000",totalCostMin:"0",totalCostMax:"100000",sortBy:"createdAt",sortOrder:"desc"})};T.useEffect(()=>{const t=j.current;if(!t)return;const a=()=>{const{scrollTop:n,scrollHeight:o,clientHeight:f}=t;n+f>=o-50&&M&&!k&&I()};return t.addEventListener("scroll",a),()=>t.removeEventListener("scroll",a)},[I,M,k]);const W=async t=>{var a,n;try{await S.mutateAsync({subContractId:t}),D(),E({title:"Success",description:"Sub Contract deleted successfully"})}catch(o){E({title:"Error",description:((n=(a=o==null?void 0:o.response)==null?void 0:a.data)==null?void 0:n.message)||(o==null?void 0:o.message)||"Failed to delete sub contract",variant:"destructive"})}},F=(d==null?void 0:d.pages.flatMap(t=>t.subContracts))||[];return g.pathname.includes("/create")||g.pathname.includes("/single")?e.jsx(J,{}):e.jsxs("div",{className:"space-y-0 h-full",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("div",{children:e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-hard-hat mr-3 text-blue-600"}),"Sub Contracts"]})}),e.jsxs("div",{className:"flex gap-3 items-center",children:[v&&e.jsxs(L,{onClick:()=>r("create"),children:[e.jsx("i",{className:"fas fa-plus mr-2"}),"Create Sub Contract"]}),e.jsx("div",{className:"w-full sm:w-auto flex justify-end sm:block",children:e.jsx(ae,{organizationId:p,stageName:"subcontract"})})]})]}),c?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("i",{className:"fas fa-spinner fa-spin text-blue-600 text-4xl"})}):V?e.jsxs("div",{className:"max-w-xl sm:min-w-[80%] mx-auto mt-4 p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2 text-xl sm:text-3xl",children:"âš ï¸ Error Occurred"}),e.jsx("p",{className:"text-red-500 mb-4 text-lg sm:text-xl",children:(w==null?void 0:w.message)||"Failed to load sub contracts"}),e.jsx(L,{onClick:()=>D(),className:"bg-red-600 text-white px-4 py-2",children:"Retry"})]}):e.jsxs("main",{className:"flex gap-2 !max-h-[90%]",children:[e.jsx("div",{className:"xl:w-80 flex-shrink-0 !max-h-[100%] overflow-y-auto",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-filter mr-2 text-blue-600"}),"Filters"]}),O>0&&e.jsxs("button",{onClick:z,className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:["Clear All (",O,")"]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx("i",{className:"fas fa-search mr-2"}),"Search"]}),e.jsx("input",{type:"text",autoFocus:!0,placeholder:"Work name, worker name...",value:s.search,onChange:t=>l(a=>({...a,search:t.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx("i",{className:"fas fa-flag mr-2"}),"Status"]}),e.jsxs("select",{value:s.status,onChange:t=>l(a=>({...a,status:t.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"accepted",children:"Accepted"}),e.jsx("option",{value:"rejected",children:"Rejected"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx("i",{className:"fas fa-user mr-2"}),"Worker Name"]}),e.jsx("input",{type:"text",placeholder:"Filter by worker name...",value:s.workerName,onChange:t=>l(a=>({...a,workerName:t.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx("i",{className:"fas fa-calendar-check mr-2"}),"Commencement From"]}),e.jsx("input",{type:"date",value:s.dateOfCommencementFrom,onChange:t=>l(a=>({...a,dateOfCommencementFrom:t.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx("i",{className:"fas fa-calendar-check mr-2"}),"Commencement To"]}),e.jsx("input",{type:"date",value:s.dateOfCommencementTo,onChange:t=>l(a=>({...a,dateOfCommencementTo:t.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),C.map(({title:t,minKey:a,maxKey:n})=>{const o=Number(s[a]),f=Number(s[n]),_=u[a],H=u[n];return e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t," Range",(o!==Number(_)||f!==Number(H))&&e.jsx("span",{className:"ml-2 text-xs text-amber-600",children:e.jsx("i",{className:"fas fa-circle animate-pulse"})})]}),e.jsx("div",{className:"px-2 mb-3",children:e.jsx(te,{range:!0,min:0,max:1e5,step:500,value:[o,f],onChange:h=>{const[b,G]=h;l(U=>({...U,[a]:String(b),[n]:String(G)}))},trackStyle:[{backgroundColor:"#3b82f6",height:6}],railStyle:{backgroundColor:"#e5e7eb",height:6},handleStyle:[{borderColor:"#3b82f6",backgroundColor:"#fff",boxShadow:"0 2px 6px rgba(59, 130, 246, 0.4)",width:18,height:18,marginTop:-6},{borderColor:"#3b82f6",backgroundColor:"#fff",boxShadow:"0 2px 6px rgba(59, 130, 246, 0.4)",width:18,height:18,marginTop:-6}]})}),e.jsxs("div",{className:"flex justify-between items-center gap-2 text-sm",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-xs text-gray-500 block mb-1",children:"Min"}),e.jsxs("div",{className:"bg-blue-50 px-3 py-2 rounded-lg font-semibold text-blue-700 text-center",children:["â‚¹",Number(o).toLocaleString("en-IN")]})]}),e.jsx("div",{className:"text-gray-400 mt-5",children:"â€”"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-xs text-gray-500 block mb-1",children:"Max"}),e.jsxs("div",{className:"bg-blue-50 px-3 py-2 rounded-lg font-semibold text-blue-700 text-center",children:["â‚¹",Number(f).toLocaleString("en-IN")]})]})]}),e.jsxs("div",{className:"flex flex-col gap-3 items-center mt-2",children:[e.jsx(P,{type:"number",value:s[a],onChange:h=>l(b=>({...b,[a]:h.target.value}))}),e.jsx(P,{type:"number",value:s[n],onChange:h=>l(b=>({...b,[n]:h.target.value}))})]})]},a)})]})]})}),x&&e.jsx(e.Fragment,{children:F.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[300px] w-full bg-white rounded-xl text-center p-6",children:[e.jsx("i",{className:"fas fa-hard-hat text-5xl text-blue-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-1",children:"No Sub Contracts Found"}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.search||O>0?"Try adjusting your filters to find sub contracts.":"Looks like there are no sub contracts yet.",e.jsx("br",{}),"Click on ",e.jsx("strong",{children:'"Create Sub Contract"'})," to get started ðŸš€"]})]}):e.jsxs("div",{ref:j,className:"flex-1 !max-h-[100%] overflow-y-auto",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:F.map((t,a)=>e.jsx(re,{data:t,index:a,onView:()=>r(`single/${t._id}`),onDelete:()=>W(t._id),isDeleting:S.isPending&&S.variables.subContractId===t._id},t._id))}),k&&e.jsx("div",{className:"flex justify-center py-8",children:e.jsxs("div",{className:"flex items-center gap-2 text-blue-600",children:[e.jsx("i",{className:"fas fa-spinner fa-spin text-2xl"}),e.jsx("span",{className:"text-sm font-medium",children:"Loading more..."})]})}),!M&&F.length>0&&e.jsx("div",{className:"flex justify-center py-6",children:e.jsxs("p",{className:"text-gray-400 text-sm font-medium",children:[e.jsx("i",{className:"fas fa-check-circle mr-2"}),"You've reached the end of the list"]})})]})})]})]})};export{Ce as default};
