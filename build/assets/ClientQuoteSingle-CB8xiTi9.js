import{u as F,a as G,b as O,r as n,R as V,j as e,B as T,M as $,t as c}from"./index-MXS_gbde.js";import{C as z}from"./ClientFurnitures-C1t6bDOY.js";import{b as D,c as U}from"./clientQuoteApi-JpDy-a6P.js";import{L as H}from"./Label-BYfdMzSb.js";import{S as J,a as K,b as W,c as X,d as Y}from"./Select-COWxTY-d.js";import{u as Z}from"./quoteVariantApi-DV1NXuB1.js";import{d as q}from"./downloadFile-BskFWteI.js";const ie=0,ce=()=>{var y,w,v,S;const{organizationId:p,quoteId:x}=F(),C=G(),{role:g,permission:o}=O(),f=g==="owner"||((y=o==null?void 0:o.clientquote)==null?void 0:y.create),j=g==="owner"||((w=o==null?void 0:o.clientquote)==null?void 0:w.edit),{data:a,isLoading:k}=D(p,x),{mutateAsync:P,isPending:b}=U(),{mutateAsync:I,isPending:L}=Z(),i=n.useRef([]),[N,h]=n.useState(null),[l,A]=n.useState(!0),[d,B]=n.useState("type 1"),[u,E]=n.useState([]),[m,M]=n.useState((a==null?void 0:a.grandTotal)||0);n.useEffect(()=>{M(a==null?void 0:a.grandTotal)},[a]);const Q=async()=>{var t,s;try{if(!p||!x||!a){c({title:"Missing info",description:"Please ensure quote and all details are not missing",variant:"destructive"});return}if(!confirm("Are you sure want to send this quotation to payment?"))return;await P({organizationId:p,id:x}),c({title:"success",description:"Quote Selected and stored in the payment stage"})}catch(r){c({title:"Error",description:((s=(t=r==null?void 0:r.response)==null?void 0:t.data)==null?void 0:s.message)??"Operation failed"})}},R=async()=>{var t,s;try{if(!a.projectId._id||!x||!d){c({title:"Missing info",description:"Please ensure brand and all details are selected",variant:"destructive"});return}const r=await I({quoteId:x,type:d,projectId:a.projectId._id});await q({src:r.url,alt:r.fileName}),c({title:"success",description:"pdf generated successfully"})}catch(r){c({title:"Error",description:((s=(t=r==null?void 0:r.response)==null?void 0:t.data)==null?void 0:s.message)||"Operation failed",variant:"destructive"})}},_=async()=>{var t,s;try{A(r=>!r)}catch(r){c({title:"Error",description:((s=(t=r==null?void 0:r.response)==null?void 0:t.data)==null?void 0:s.message)??"Operation failed"})}};return n.useEffect(()=>{if(!(a!=null&&a.furnitures))return;const t=a.furnitures.map(s=>({furnitureName:s.furnitureName,coreMaterials:s.coreMaterials||[],fittingsAndAccessories:s.fittingsAndAccessories||[],glues:s.glues||[],nonBrandMaterials:s.nonBrandMaterials||[],totals:{core:s.coreMaterialsTotal||0,fittings:s.fittingsAndAccessoriesTotal||0,glues:s.gluesTotal||0,nbms:s.nonBrandMaterialsTotal||0,furnitureTotal:s.furnitureTotal||0},plywoodBrand:s.plywoodBrand||"",innerLaminateBrand:s.innerLaminateBrand||"",outerLaminateBrand:s.outerLaminateBrand||"",fabricationCost:s.fabricationCost||0}));E(t)},[a]),i.current.length!==u.length&&(i.current=u.map((t,s)=>i.current[s]??V.createRef())),n.useEffect(()=>{console.log("furnitureRefs Array",i),i.current=u.map((t,s)=>i.current[s]??n.createRef())},[u]),e.jsxs("div",{className:"p-2 max-h-full overflow-y-auto",children:[e.jsx("header",{className:"bg-white border-b border-gray-200 pb-4 space-y-3",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("button",{onClick:()=>C(-1),className:"flex cursor-pointer items-center justify-center w-8 h-8 bg-gray-50 hover:bg-gray-100 border border-gray-300 rounded-md transition-colors flex-shrink-0",children:e.jsx("i",{className:"fas fa-arrow-left text-gray-600 text-sm"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900 truncate",children:((v=a==null?void 0:a.projectId)==null?void 0:v.projectName)||"Project"}),e.jsx("p",{className:"text-md text-gray-500",children:a!=null&&a.quoteNo?`Quote: #${a==null?void 0:a.quoteNo}`:""})]})]}),e.jsxs("div",{className:"flex gap-2 justify-between  items-center",children:[e.jsxs("div",{className:"px-4 text-center",children:[e.jsx("p",{className:"text-md text-gray-600",children:"Total Cost"}),e.jsxs("p",{className:"text-md font-bold text-green-600",children:["₹",m==null?void 0:m.toLocaleString("en-in")]})]}),(f||j)&&e.jsx(T,{onClick:Q,disabled:b,className:"flex-shrink-0 px-4 ",children:b?"Sending...":"Send to Payment"}),(f||j)&&e.jsx(T,{onClick:R,isLoading:L,className:"flex-shrink-0 px-4 ",children:"Generate Pdf"}),e.jsxs("div",{className:"flex gap-2 w-fit px-4 justify-center",children:[e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l,onChange:_,className:"sr-only",id:"blurinput"}),e.jsx("div",{className:`w-11 h-6 rounded-full cursor-pointer transition-colors ${l?"bg-gray-200":"bg-blue-600"}`,children:e.jsx("div",{className:`w-5 h-5 bg-white rounded-full shadow transform transition-transform ${l?"translate-x-0":"translate-x-5"} mt-0.5 ml-0.5`})})]}),e.jsx(H,{htmlFor:"blurinput",className:" cursor-pointer flex flex-4/2",children:"Show Stats"})]}),e.jsx("div",{className:"w-full",children:e.jsxs(J,{onValueChange:t=>{B(t)},children:[e.jsx(K,{className:"w-full",children:e.jsx(W,{placeholder:"Select Template Type",selectedValue:d})}),e.jsx(X,{children:["type 1","type 2","type 3"].map(t=>e.jsx(Y,{value:t.toString(),children:t},t))})]})})]})]})}),k?e.jsx($,{}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-6",children:[u.map((t,s)=>e.jsx(z,{index:s,data:t,ref:i.current[s],templateType:d,isBlurred:l,onImageClick:h},s)),d!=="type 2"&&((S=a==null?void 0:a.commonMaterials)==null?void 0:S.length)>0&&e.jsxs("div",{className:"mt-10 bg-white border border-gray-200 rounded-lg p-4 shadow-md",children:[e.jsxs("h3",{className:"font-semibold text-md mb-2 text-gray-800 flex items-center gap-2",children:["Common Site Materials",e.jsxs("span",{className:"text-sm  ml-1",children:["(Total: ₹",a.commonMaterials.reduce((t,s)=>t+(s.rowTotal||0),0).toLocaleString("en-IN"),")"]})]}),e.jsx("div",{className:"overflow-x-auto rounded-md border border-gray-100",children:d!=="type 3"&&e.jsxs("table",{className:"min-w-full text-sm bg-white shadow-sm",children:[e.jsx("thead",{className:"bg-blue-50 text-sm font-semibold text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Item Name"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Description"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Quantity"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Cost"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{children:a.commonMaterials.map((t,s)=>{var r;return e.jsxs("tr",{className:"border-b hover:bg-gray-50/50 transition-colors",children:[e.jsx("td",{className:"text-center border p-2",children:e.jsx("span",{className:l?"blur-sm select-none":"",children:(t==null?void 0:t.itemName)||"—"})}),e.jsx("td",{className:"text-center border p-2",children:e.jsx("span",{className:l?"blur-sm select-none":"",children:(t==null?void 0:t.description)||"—"})}),e.jsx("td",{className:"text-center border p-2",children:e.jsx("span",{className:l?"blur-sm select-none":"",children:(t==null?void 0:t.quantity)||0})}),e.jsx("td",{className:"text-center border p-2",children:e.jsxs("span",{className:l?"blur-sm select-none":"",children:["₹",((r=t==null?void 0:t.cost)==null?void 0:r.toLocaleString("en-IN"))||0]})}),e.jsx("td",{className:"text-center border p-2 text-green-700 font-bold",children:e.jsxs("span",{className:l?"blur-sm select-none":"",children:["₹",(t.rowTotal||0).toLocaleString("en-IN")]})}),e.jsx("td",{className:"text-center border p-2 text-gray-400",children:"—"})]},s)})})]})})]}),e.jsx("div",{className:"mt-10 text-right",children:e.jsxs("div",{className:"inline-block bg-green-50 border border-green-200 rounded-md px-6 py-4",children:[e.jsx("p",{className:"text-md font-medium text-gray-700 mb-1",children:"Total Estimate"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700",children:["₹",m==null?void 0:m.toLocaleString("en-in")]})]})})]})}),N&&e.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/80 p-4 animate-in fade-in duration-200",onClick:()=>h(null),children:e.jsxs("div",{className:"relative max-w-4xl max-h-[90vh]",children:[e.jsx("button",{className:"absolute -top-10 right-0 text-white text-3xl hover:text-gray-300 transition-colors",onClick:()=>h(null),children:e.jsx("i",{className:"fas fa-times"})}),e.jsx("img",{src:N,className:"rounded-lg shadow-2xl max-w-full max-h-[85vh] object-contain border-4 border-white/10",alt:"Enlarged view",onClick:t=>t.stopPropagation()})]})})]})};export{ie as DEFAULT_LAMINATE_RATE_PER_SQFT,ce as default};
