import{u as ne,a as ce,k as ie,r as x,j as e,M as le,B as o,t as h}from"./index-BAM0eJUz.js";import{I as E}from"./Input-1UBXZqEj.js";import{u as oe,e as de,f as me,g as ue,h as xe}from"./labourRateconfigApi-Dm8CpgW0.js";function be(){var S,F,z,A,P,_;const{organizationId:g,id:p}=ne(),$=ce(),{data:B}=oe(g),{data:y,isLoading:K,refetch:L}=de(g,p),{mutateAsync:U,isPending:V}=me(),{mutateAsync:D,isPending:G}=ue(),{mutateAsync:T,isPending:H}=xe(),{role:v,permission:l}=ie(),I=v==="owner"||((S=l==null?void 0:l.labourratequote)==null?void 0:S.create),J=v==="owner"||((F=l==null?void 0:l.labourratequote)==null?void 0:F.delete),w=v==="owner"||((z=l==null?void 0:l.labourratequote)==null?void 0:z.edit),[d,b]=x.useState([{data:{}}]),[Q,k]=x.useState(null),[C,f]=x.useState({}),[j,W]=x.useState(""),c=(A=B||[])==null?void 0:A.find(t=>t._id===p),R=x.useMemo(()=>{var r,a;if(!y)return[];if(!j.trim())return y;const t=(a=(r=c==null?void 0:c.fields)==null?void 0:r[0])==null?void 0:a.key;return y.filter(s=>{var i;return(((i=s.data[t])==null?void 0:i.toString().toLowerCase())||"").includes(j.toLowerCase())})},[y,j,c]);if(K)return e.jsx(le,{});if(!c)return e.jsx("p",{children:"Category not found"});const X=t=>{k(t._id),f({...t.data})},Y=()=>{k(null),f({})},Z=async t=>{var r,a;try{await T({itemId:t,body:C,categoryId:p}),h({title:"Success",description:"Labour rate updated successfully"}),k(null),f({}),L()}catch(s){h({title:"Error",description:((a=(r=s==null?void 0:s.response)==null?void 0:r.data)==null?void 0:a.message)??"Update failed"})}},ee=(t,r,a)=>{var M,O;const s=[...d];s[t].data[r]=a;const n=(O=(M=c.fields)==null?void 0:M[0])==null?void 0:O.key,i=t===s.length-1,m=r===n,u=(a==null?void 0:a.toString().trim())!=="",re=s.length>0&&Object.values(s[s.length-1].data).every(N=>N===void 0||N==="");if(i&&m&&u&&!re&&s.push({data:{}}),!u&&m&&d.length>1){const N=s[s.length-1];Object.values(N.data).every(q=>q===void 0||q==="")&&s.pop()}b(s)},te=()=>b([...d,{data:{}}]),se=t=>{const r=[...d];r.splice(t,1),b(r)},ae=async()=>{var t,r,a,s;try{const n=(r=(t=c.fields)==null?void 0:t[0])==null?void 0:r.key,i=d.map(m=>m.data).filter(m=>{const u=m[n];return u!=null&&u.toString().trim()!==""});if(i.length===0)return h({title:"Error",description:"Nothing to save",variant:"destructive"});await U({categoryId:p,items:i,organizationId:g}),h({title:"Success",description:"field created successfully"}),b([{data:{}}]),L()}catch(n){h({title:"Error",description:((s=(a=n==null?void 0:n.response)==null?void 0:a.data)==null?void 0:s.message)??"Operation failed"})}};return e.jsxs("div",{className:"space-y-4  ",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center sticky top-0 bg-white z-10",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("div",{onClick:()=>$(-1),className:"bg-slate-50 hover:bg-slate-300 flex items-center justify-between w-8 h-8 border border-[#a6aab8] text-sm cursor-pointer rounded-md px-2 ",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:c.name}),e.jsx("span",{className:"block  text-gray-500",children:"* Enter the rupees per head (Every field will be added for single labour cost)"})]})]}),e.jsx("div",{className:"flex gap-2 mt-3 sm:mt-0  ",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"relative w-full sm:w-64",children:[e.jsx(E,{placeholder:`Search ${(_=(P=c.fields)==null?void 0:P[0])==null?void 0:_.key}...`,value:j,onChange:t=>W(t.target.value),className:"pl-9 h-10 border-blue-100 focus:border-blue-400"}),e.jsx("i",{className:"fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm"})]}),(w||I)&&e.jsx(o,{onClick:te,variant:"primary",className:"",children:"+ Add Row"}),(w||I)&&e.jsxs(o,{onClick:ae,isLoading:V,className:"bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx("i",{className:"fas fa-file mr-2"})," Save Items"]})]})})]}),e.jsx("div",{className:"overflow-x-auto ",children:e.jsxs("table",{className:"min-w-full bg-white text-sm",children:[e.jsx("thead",{className:"bg-blue-50 text-sm font-semibold text-gray-600 px-6 py-1 sm:py-3",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-6 py-1 sm:py-3  text-xs font-medium text-gray-500 uppercase tracking-wider",children:"S.NO"}),c.fields.map(t=>e.jsx("th",{className:"text-center px-6 py-1 sm:py-3  text-xs font-medium text-gray-500 uppercase tracking-wider",children:t.key},t.key)),e.jsx("th",{className:"text-center px-6 py-1 sm:py-3  text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsxs("tbody",{children:[R==null?void 0:R.map((t,r)=>{var s;const a=Q===t._id;return e.jsxs("tr",{className:`group border-b border-gray-100 transition-all duration-200 ${a?"bg-blue-50/50":"hover:bg-gray-50"}`,children:[e.jsx("td",{className:"p-4 font-medium text-center text-sm text-gray-700",children:r+1}),(s=c==null?void 0:c.fields)==null?void 0:s.map(n=>e.jsx("td",{className:"p-2 border border-gray-100 text-center",children:a?e.jsx(E,{type:n.type==="number"?"number":"text",value:C[n.key]||"",className:"w-full h-8 text-xs",onChange:i=>f({...C,[n.key]:n.type==="number"?Math.max(0,Number(i.target.value)):i.target.value})}):e.jsx("span",{className:"text-sm text-gray-700",children:(t==null?void 0:t.data[n==null?void 0:n.key])??"—"})},n==null?void 0:n.key)),e.jsx("td",{className:"text-center p-4 border border-gray-100",children:e.jsx("div",{className:"flex justify-center gap-2",children:a?e.jsxs(e.Fragment,{children:[e.jsx(o,{size:"sm",variant:"primary",className:"text-white h-8",onClick:()=>Z(t._id),isLoading:H,children:e.jsx("i",{className:"fas fa-check"})}),e.jsx(o,{size:"sm",variant:"secondary",className:"  h-8",onClick:Y,children:e.jsx("i",{className:"fas fa-xmark"})})]}):e.jsxs(e.Fragment,{children:[w&&e.jsx(o,{size:"sm",variant:"ghost",className:"text-blue-600 hover:bg-blue-50 h-8 p-1",onClick:()=>X(t),children:e.jsx("i",{className:"fas fa-pen-to-square"})}),J&&e.jsx(o,{size:"sm",variant:"danger",isLoading:G,className:"bg-red-600 text-white h-8 p-1",onClick:()=>D({itemId:t==null?void 0:t._id,organizationId:g}),children:e.jsx("i",{className:"fas fa-trash"})})]})})})]},`existing-${t==null?void 0:t._id}`)}),d.map((t,r)=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-all duration-200",children:[e.jsx("td",{className:"p-4 text-center text-gray-400",children:"—"}),c.fields.map(a=>e.jsx("td",{className:"p-2 border border-gray-100",children:e.jsx(E,{type:a.type==="number"?"number":"text",placeholder:a.key,className:"w-full h-10 text-sm",value:t.data[a.key]||"",onChange:s=>ee(r,a.key,a.type==="number"?Math.max(0,Number(s.target.value)):s.target.value)})},a.key)),e.jsx("td",{className:"text-center p-4 border border-gray-100",children:e.jsxs(o,{size:"sm",variant:"danger",className:" text-white bg-red-600 hover:bg-red-600",onClick:()=>se(r),children:[e.jsx("i",{className:"fas fa-xmark mr-2"})," Remove"]})})]},`new-${r}`))]})]})})]})}export{be as default};
