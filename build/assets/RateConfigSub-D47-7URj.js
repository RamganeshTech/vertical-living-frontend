import{u as z,a as B,r as O,j as e,B as u,t as y}from"./index-sOEqqOOm.js";import{I as _}from"./Input-BLVPl92q.js";import{u as D,c as G,d as K,e as $}from"./rateConfigApi-Cf4XL2YI.js";function M(){const{organizationId:b,id:l}=z(),N=B(),{data:m}=D(b),{data:h,isLoading:w,refetch:k}=G(l),{mutateAsync:R,isPending:C}=K(),{mutateAsync:I,isPending:E}=$(),[i,x]=O.useState([{data:{}}]);if(w||!m)return e.jsx("p",{children:"Loading category..."});const n=m==null?void 0:m.find(t=>t._id===l);if(!n)return e.jsx("p",{children:"Category not found"});const L=(t,r,s)=>{var f,j;const a=[...i];a[t].data[r]=s;const o=(j=(f=n.fields)==null?void 0:f[0])==null?void 0:j.key,p=t===a.length-1,c=r===o,d=(s==null?void 0:s.toString().trim())!=="",P=a.length>0&&Object.values(a[a.length-1].data).every(g=>g===void 0||g==="");if(p&&c&&d&&!P&&a.push({data:{}}),!d&&c&&i.length>1){const g=a[a.length-1];Object.values(g.data).every(v=>v===void 0||v==="")&&a.pop()}x(a)},S=()=>x([...i,{data:{}}]),A=t=>{const r=[...i];r.splice(t,1),x(r)},F=async()=>{var t,r,s,a;try{const o=(r=(t=n.fields)==null?void 0:t[0])==null?void 0:r.key,p=i.map(c=>c.data).filter(c=>{const d=c[o];return d!=null&&d.toString().trim()!==""});if(p.length===0)return y({title:"Error",description:"Nothing to save",variant:"destructive"});await R({categoryId:l,items:p,organizationId:b}),y({title:"Success",description:"Items created successfully"}),x([{data:{}}]),k()}catch(o){y({title:"Error",description:((a=(s=o==null?void 0:o.response)==null?void 0:s.data)==null?void 0:a.message)??"Operation failed"})}};return e.jsxs("div",{className:"space-y-4 max-h-full overflow-y-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center sticky top-0 bg-white z-10 py-4 border-b",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("div",{onClick:()=>N(-1),className:"bg-slate-50 hover:bg-slate-300 flex items-center justify-between w-8 h-8 border border-[#a6aab8] text-sm cursor-pointer rounded-md px-2 ",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:n.name})]}),e.jsxs("div",{className:"flex gap-2 mt-3 sm:mt-0",children:[e.jsx(u,{onClick:S,variant:"primary",className:"",children:"+ Add Row"}),e.jsxs(u,{onClick:F,isLoading:C,className:"bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx("i",{className:"fas fa-file mr-2"})," Save Items"]})]})]}),e.jsx("div",{className:"overflow-x-auto ",children:e.jsxs("table",{className:"min-w-full bg-white text-sm",children:[e.jsx("thead",{className:"bg-blue-50 text-sm font-semibold text-gray-600 px-6 py-1 sm:py-3",children:e.jsxs("tr",{children:[n.fields.map(t=>e.jsx("th",{className:"text-center px-6 py-1 sm:py-3  text-xs font-medium text-gray-500 uppercase tracking-wider",children:t.key},t.key)),e.jsx("th",{className:"text-center px-6 py-1 sm:py-3  text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsxs("tbody",{children:[h==null?void 0:h.map(t=>{var r;return e.jsxs("tr",{className:`group relative border-none !border-b-1 px-4 py-2  cursor-pointer transition-all duration-200
     hover:bg-gray-50 hover:border-gray-300
  `,children:[(r=n==null?void 0:n.fields)==null?void 0:r.map(s=>e.jsx("td",{className:"border border-gray-100 font-medium text-center  text-sm text-gray-700 group-hover:text-gray-900 transition-colors duration-200",children:(t==null?void 0:t.data[s==null?void 0:s.key])??"â€”"},s==null?void 0:s.key)),e.jsx("td",{className:"text-center p-4 border border-gray-100",children:e.jsxs(u,{size:"sm",variant:"danger",isLoading:E,className:"group text-white bg-red-600",onClick:()=>I({itemId:t==null?void 0:t._id,categoryId:l}),children:[e.jsx("i",{className:"fas fa-trash mr-2"}),e.jsx("span",{className:"",children:"Delete"})]})})]},`existing-${t==null?void 0:t._id}`)}),i.map((t,r)=>e.jsxs("tr",{className:`group relative border-none !border-b-1 px-4 py-2  cursor-pointer transition-all duration-200\r
     hover:bg-gray-50 hover:border-gray-300`,children:[n.fields.map(s=>e.jsx("td",{className:"border border-gray-100 px-4 font-medium text-center  text-sm text-gray-700 group-hover:text-gray-900 transition-colors duration-200",children:e.jsx(_,{type:s.type==="number"?"number":"text",placeholder:s.key,className:"w-full rounded-md ",value:t.data[s.key]||"",onChange:a=>L(r,s.key,s.type==="number"?Number(a.target.value):a.target.value)})},s.key)),e.jsx("td",{className:"text-center p-4 border border-gray-100",children:e.jsxs(u,{size:"sm",variant:"ghost",className:"group text-white bg-red-600 hover:bg-red-600",onClick:()=>A(r),children:[e.jsx("i",{className:"fas fa-xmark mr-2"})," Remove"]})})]},`new-${r}`))]})]})})]})}export{M as default};
