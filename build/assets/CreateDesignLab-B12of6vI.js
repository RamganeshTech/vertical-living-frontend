import{a as I,j as b}from"./index-By5P0A7l.js";import{u as y}from"./designLabApi-DK9OL9c3.js";import{D as E}from"./DesignLabForm-8hE0ETVt.js";import{t as p}from"./toast-BSC5QTk1.js";import"./useQuery-Cc7pLKfK.js";import"./useMutation-7YLqc7VE.js";import"./useInfiniteQuery-DQF0m-E9.js";import"./roleCheck-YGaMnK_P.js";import"./Button-DLUK8O0t.js";const C=()=>{const{organizationId:r}=I(),{mutateAsync:u,isPending:f}=y(),g=async a=>{var c,d,m;try{const t=new FormData;if(!a.productName||!((c=a==null?void 0:a.productName)!=null&&c.trim())){p({title:"Error",description:"Enter the product name",variant:"destructive"});return}const o=[],l=a.components.map(e=>{const i=e.materials.filter(n=>{var s;return((s=n.materialName)==null?void 0:s.trim())||n.rate!==""&&n.rate!==0||n.image});return{...e,materials:i}}),v=a.sequenceOfOperations.filter(e=>e.description&&e.description.trim()!=="").map((e,i)=>({...e,stepNumber:i+1})),h={...a,organizationId:r,sequenceOfOperations:v,referenceImages:[],components:l.map(e=>({...e,materials:e.materials.map(i=>({...i,vendorId:i.vendorId===""?void 0:i.vendorId}))}))};a.newRefFiles.forEach(e=>{t.append("files",e),o.push({target:"reference"})}),l.forEach((e,i)=>{e.materials.forEach((n,s)=>{n.tempFile&&(t.append("files",n.tempFile),o.push({target:"material",componentIndex:i,materialIndex:s}))})}),t.append("data",JSON.stringify(h)),t.append("fileMapping",JSON.stringify(o)),t.append("organizationId",r),await u({organizationId:r,formData:t}),p({title:"Success",description:"Design created successfully"})}catch(t){console.error(t),p({title:"Error",description:((m=(d=t==null?void 0:t.response)==null?void 0:d.data)==null?void 0:m.message)||"Failed to update design",variant:"destructive"})}};return b.jsx(E,{mode:"create",organizationId:r,onSubmit:g,isLoading:f})};export{C as default};
