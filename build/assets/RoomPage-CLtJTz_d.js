import{r as I,b as K,j as e,u as T,a as Y}from"./index-BYTWf4fI.js";import{a as $,b as U,c as H,d as J,e as X}from"./requirementFormApi-ByKCnAIy.js";import{B as C}from"./Button-aRmNljle.js";import{t as x}from"./toast-BSC5QTk1.js";import{I as F}from"./Input-ChgExZu6.js";import{d as Z}from"./downloadFile-DFN4JXcx.js";import{I as ee}from"./ImageGalleryMain-BTDqHC1K.js";import{V as te}from"./VideoGalleryMain-CKQ33QsR.js";import"./useQuery-DFVFWtWl.js";import"./useMutation-sTZCeqmg.js";import"./roleCheck-DhBlwT6t.js";import"./constants-4IFJeChr.js";import"./index-CofIYY6b.js";const se=({projectId:p,sectionName:j,refetch:f,existingUploads:c})=>{var w,q,z;const[D,E]=I.useState(null),{mutateAsync:S,isPending:k}=$(),{mutateAsync:r,isPending:P}=U(),{role:_,permission:u}=K(),R=_==="owner"||((w=u==null?void 0:u.clientrequirement)==null?void 0:w.delete),M=_==="owner"||((q=u==null?void 0:u.clientrequirement)==null?void 0:q.create),N=_==="owner"||((z=u==null?void 0:u.clientrequirement)==null?void 0:z.edit),V=async i=>{var d,b;try{const o=i.target.files;if(!o||o.length===0)return;const A=new FormData;for(const B of Array.from(o))A.append("file",B);await S({projectId:p,sectionName:j,files:A}),f(),x({title:"Success",description:"file uploaded successfully"})}catch(o){x({title:"Error",description:((b=(d=o==null?void 0:o.response)==null?void 0:d.data)==null?void 0:b.message)||"Failed to upload",variant:"destructive"})}},y=async i=>{var d,b;try{await r({projectId:p,sectionName:j,fileId:i}),f(),x({title:"Success",description:"file deleted successfully"})}catch(o){x({title:"Error",description:((b=(d=o==null?void 0:o.response)==null?void 0:d.data)==null?void 0:b.message)||"Failed to delete",variant:"destructive"})}},h=c.filter(i=>i.type==="image"),m=c==null?void 0:c.filter(i=>i.type==="pdf"),g=c==null?void 0:c.filter(i=>i.type==="video"),W=["eye","download",...R?["trash"]:[]];return e.jsxs("div",{className:"space-y-4 w-full",children:[e.jsxs("div",{className:"flex relative items-center justify-between w-full",children:[(M||N)&&e.jsx(F,{type:"file",multiple:!0,placeholder:"select files",onChange:V,disabled:k,className:k?"pr-10 opacity-70 cursor-not-allowed w-full":""}),k&&e.jsx("div",{className:"absolute inset-y-0 right-2 flex items-center",children:e.jsx("div",{className:"animate-spin h-5 w-5 border-t-transparent rounded-full border-2 border-gray-500"})})]}),e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-800",children:"PDFs"}),m.length===0&&e.jsx("div",{className:"text-gray-500 text-sm italic bg-gray-50 p-8 rounded-lg text-center border-2 border-dashed border-gray-200",children:"No Pdfs uploaded yet."}),m==null?void 0:m.map(i=>e.jsx("div",{className:"mt-6",children:e.jsxs("div",{className:"relative space-y-4 group flex justify-between items-center px-4 py-3 border rounded-lg shadow-sm bg-white",children:[e.jsxs("div",{className:"flex items-center space-x-3 w-[190px] sm:w-3/2 lg:w-full",children:[e.jsx("div",{className:"w-10 h-10 bg-red-100 flex items-center justify-center rounded-lg text-red-600",children:e.jsx("i",{className:"fas fa-file-pdf text-xl"})}),e.jsx("span",{className:"text-sm font-medium !truncate max-w-[100%] whitespace-wrap",children:i.originalName})]}),e.jsx("div",{className:"flex ",children:W.map(d=>e.jsx(C,{variant:"ghost",size:"sm",onClick:()=>d==="eye"?window.open(i.url,"_blank"):d==="trash"?y(i._id):Z({src:i==null?void 0:i.url,alt:(i==null?void 0:i.originalName)||"file.pdf"}),disabled:d==="trash"&&P,className:"hover:bg-gray-100 shadow-sm",children:e.jsx("i",{className:` fas fa-${d} ${d==="trash"?"text-red-500":d==="download"?"text-blue-500":"text-gray-600"}`})},d))})]})},i.url)),e.jsxs("div",{className:"mt-6 w-full ",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-800",children:" Images "}),(h==null?void 0:h.length)===0?e.jsx("div",{className:"text-gray-500 text-sm italic bg-gray-50 p-8 rounded-lg text-center border-2 border-dashed border-gray-200",children:"No Images uploaded yet."}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"",children:e.jsx(ee,{imageFiles:h,refetch:f,height:190,minWidth:156,maxWidth:100,...R?{handleDeleteFile:y}:{}})})})]}),e.jsxs("div",{className:"mt-6 w-full ",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-800",children:" Videos "}),(g==null?void 0:g.length)===0?e.jsx("div",{className:"text-gray-500 text-sm italic bg-gray-50 p-8 rounded-lg text-center border-2 border-dashed border-gray-200",children:"No Videos uploaded yet."}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"",children:e.jsx(te,{videoFiles:g,refetch:f,isDeleting:P,height:190,minWidth:156,maxWidth:100,...R?{handleDeleteFile:y}:{}})})})]}),D&&e.jsx("div",{onClick:()=>E(null),className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:e.jsx("div",{onClick:i=>i.stopPropagation(),className:"relative bg-black/70 rounded-lg shadow-lg max-w-[80%] max-h-[80%] p-2",children:e.jsx("img",{src:D,alt:"preview image",className:"w-[80vw] max-h-[70vh] object-cpntain mx-auto"})})})]})},pe=()=>{var o,A,B,G,O;const{projectId:p,roomId:j}=T(),{role:f,permission:c}=K(),D=f==="owner"||((o=c==null?void 0:c.clientrequirement)==null?void 0:o.delete),E=f==="owner"||((A=c==null?void 0:c.clientrequirement)==null?void 0:A.create),S=f==="owner"||((B=c==null?void 0:c.clientrequirement)==null?void 0:B.edit),k=Y(),{data:r,isLoading:P,refetch:_}=H({roomId:j,projectId:p}),{mutateAsync:u}=J(),{mutateAsync:R,isPending:M}=X(),[N,V]=I.useState({}),[y,h]=I.useState(!1),[m,g]=I.useState([{itemName:"",quantity:1,unit:"unit"}]),W=["unit","sqft","cm","mm","length","nos"];I.useEffect(()=>{var t;if((t=r==null?void 0:r.items)!=null&&t.length){const a={};r.items.forEach(s=>{a[s._id]={id:s._id,itemName:s.itemName||"",quantity:s.quantity||0,unit:s.unit||"unit"}}),V(a)}},[r]);const w=(t,a,s)=>{g(l=>{const n=l.map((v,L)=>L===t?{...v,[a]:a==="quantity"?Number(s):s,unit:a==="unit"?String(s):(v==null?void 0:v.unit)||"unit"}:v),Q=n[n.length-1];return Q.itemName.trim()!==""&&!n.some(v=>v.itemName==="")&&n.push({itemName:"",quantity:1,unit:"unit"}),n.length>1&&Q.itemName.trim()===""&&n[n.length-2].itemName.trim()===""&&n.pop(),console.log("updated",n),n})},q=(t,a,s)=>{V(l=>({...l,[t]:{...l[t],[a]:a==="quantity"?Number(s):s}}))},z=t=>{g(a=>a.filter((s,l)=>l!==t))};I.useEffect(()=>{m.length===0&&h(!1)},[m]);const i=async()=>{var a,s;console.log("newItems",m);const t=m.filter(l=>l.itemName.trim()!==""&&l.quantity>0&&l.unit!=="");if(console.log(t),t.length===0)return x({title:"Error",description:"every row should be filled with Item name, quanitty, and unit",variant:"destructive"});try{for(const l of t)await u({projectId:p,roomId:j,itemId:null,payload:{itemName:l.itemName,quantity:l.quantity,unit:l.unit}});x({title:"Success",description:"All items saved successfully"}),g([{itemName:"",quantity:1,unit:"unit"}]),h(!1)}catch(l){x({title:"Error",description:((s=(a=l==null?void 0:l.response)==null?void 0:a.data)==null?void 0:s.message)||"Failed to save items",variant:"destructive"})}},d=async t=>{var a,s;if(!t.itemName.trim()||t.quantity<=0||!t.unit)return x({title:"Error",description:"Please fill all fields correctly",variant:"destructive"});try{await u({projectId:p,roomId:j,itemId:t.id,payload:{itemName:t.itemName,quantity:t.quantity,unit:t.unit}}),x({title:"Success",description:"Item updated successfully"})}catch(l){x({title:"Error",description:((s=(a=l==null?void 0:l.response)==null?void 0:a.data)==null?void 0:s.message)||"Failed to update item",variant:"destructive"})}},b=async t=>{var a,s;try{await R({projectId:p,roomId:j,itemId:t}),x({title:"Success",description:"Item Deleted successfully"})}catch(l){x({title:"Error",description:((s=(a=l==null?void 0:l.response)==null?void 0:a.data)==null?void 0:s.message)||(l==null?void 0:l.message)||"Failed to update room data",variant:"destructive"})}};return P?e.jsx("div",{className:"min-h-full  bg-slate-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-600",children:"Loading room details..."})]})}):e.jsxs("div",{className:"max-h-full overflow-y-auto bg-slate-50",children:[e.jsx("div",{className:"bg-white border-b border-slate-200 sticky top-0 z-10",children:e.jsx("div",{className:"w-full px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between py-4",children:[e.jsx("div",{className:"flex items-center space-x-4",children:e.jsxs("button",{onClick:()=>k(-1),className:"flex cursor-pointer items-center space-x-2 text-slate-600 hover:text-blue-600 transition-colors duration-200 group",children:[e.jsx("div",{className:"bg-slate-100 group-hover:bg-blue-50 rounded-lg p-2 transition-colors duration-200",children:e.jsx("i",{className:"fas fa-arrow-left text-sm"})}),e.jsx("span",{className:"font-medium",children:"Back to Rooms"})]})}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-blue-50 rounded-lg p-2",children:e.jsx("i",{className:"fas fa-door-open text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-slate-800",children:(r==null?void 0:r.roomName)||"Room"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Manage items and requirements"})]})]})]})})}),e.jsxs("div",{className:"w-full px-4 sm:px-6 lg:px-8 py-8 space-y-8",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-200 p-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between mb-6 gap-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-blue-50 rounded-lg p-2",children:e.jsx("i",{className:"fas fa-list-ul text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-800",children:"Room Items"}),e.jsxs("p",{className:"text-sm text-slate-500",children:["Manage quantities and specifications ",e.jsx("span",{children:"(Click to Edit, Press Enter to save)"})]})]})]})}),e.jsx("div",{className:"space-y-4",children:((G=r==null?void 0:r.items)==null?void 0:G.length)===0&&!y?e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"bg-slate-100 rounded-full p-8 w-24 h-24 mx-auto mb-6 flex items-center justify-center",children:e.jsx("i",{className:"fas fa-inbox text-3xl text-slate-400"})}),e.jsx("h3",{className:"text-xl font-medium text-slate-600 mb-3",children:"No Items Yet"}),e.jsx("p",{className:"text-slate-500 mb-6 max-w-md mx-auto",children:"Start by adding your first item to this room. You can specify quantities and manage specifications."}),(E||S)&&e.jsxs(C,{onClick:()=>h(!0),className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-xl flex items-center space-x-2 mx-auto",children:[e.jsx("i",{className:"fas fa-plus text-sm"}),e.jsx("span",{children:"Add First Item"})]})]}):e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("div",{className:"min-w-[600px] grid grid-cols-4 gap-3 px-3 py-2 bg-gray-100 text-sm font-semibold rounded-t-lg",children:[e.jsx("p",{className:"text-center",children:"Item Name"}),e.jsx("p",{className:"text-center",children:"Quantity"}),e.jsx("p",{className:"text-center",children:"Unit"}),e.jsx("p",{className:"text-center",children:"Action"})]}),e.jsx("div",{className:"space-y-2",children:(O=r==null?void 0:r.items)==null?void 0:O.map(t=>{var a,s,l;return e.jsxs("div",{className:"min-w-[600px] grid grid-cols-4 gap-3 items-center px-3 py-2 border-b bg-white ",children:[e.jsx(F,{placeholder:"Item name",value:((a=N[t._id])==null?void 0:a.itemName)??t.itemName??"",onChange:n=>q(t._id,"itemName",n.target.value),onKeyDown:n=>{n.key==="Enter"&&d(N[t._id]??t)},className:"!border-none focus:ring-0 text-center"}),e.jsx(F,{type:"number",placeholder:"Qty",value:((s=N[t._id])==null?void 0:s.quantity)??t.quantity??0,onChange:n=>q(t._id,"quantity",n.target.value),onKeyDown:n=>{n.key==="Enter"&&d(N[t._id]??t)},className:"!border-none focus:ring-0  text-center"}),e.jsxs("select",{value:((l=N[t._id])==null?void 0:l.unit)??t.unit??"",onChange:n=>{q(t._id,"unit",n.target.value),d(N[t._id]??t)},className:"border px-2 py-1 rounded",children:[e.jsx("option",{value:"",children:"Unit"}),W.map(n=>e.jsx("option",{value:n,children:n},n))]}),D&&e.jsx("div",{className:"flex justify-center",children:e.jsx(C,{onClick:()=>b(t._id),disabled:M,className:"bg-red-600 hover:bg-red-700 text-white px-3 py-1",children:M?"Deleting...":"Delete"})})]},t._id)})}),y?e.jsxs("div",{className:"space-y-2 mt-4",children:[m==null?void 0:m.map((t,a)=>e.jsxs("div",{className:"min-w-[600px] grid grid-cols-4 gap-3 items-center  border-b bg-white ",children:[e.jsx(F,{placeholder:"Item name",value:t.itemName,onChange:s=>w(a,"itemName",s.target.value),className:"!border-none focus:ring-0  text-center",autoFocus:a===0}),e.jsx(F,{type:"number",placeholder:"Qty",value:t.quantity,onChange:s=>w(a,"quantity",s.target.value),className:"!border-none focus:ring-0  text-center"}),e.jsx("select",{value:t.unit,onChange:s=>w(a,"unit",s.target.value),className:"border px-2 py-1 rounded",children:W.map(s=>e.jsx("option",{value:s,children:s},s))}),e.jsx("div",{className:"flex justify-center",children:e.jsx(C,{onClick:()=>z(a),className:"bg-red-500 hover:bg-red-600 text-white px-3 py-1 mx-auto",children:"Remove"})})]},a)),e.jsx("div",{className:"flex justify-end mt-3",children:(E||S)&&e.jsx(C,{onClick:i,disabled:m.every(t=>Object.entries(t).every(([a,s])=>!(a==="itemName"&&!s))),className:"bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg",children:"Save All Items"})})]}):e.jsx("div",{className:"w-full  flex justify-end",children:(E||S)&&e.jsx(C,{onClick:()=>{h(!0),g([{itemName:"",quantity:1,unit:"unit"}])},className:"mt-4 bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg  ",children:"+ Add Item"})})]})})})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-200 p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[e.jsx("div",{className:"bg-green-50 rounded-lg p-2",children:e.jsx("i",{className:"fas fa-cloud-upload-alt text-green-600 text-lg"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-800",children:"File Uploads"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Upload requirements and documents"})]})]}),e.jsx(se,{projectId:p,sectionName:(r==null?void 0:r.roomName)||"",existingUploads:(r==null?void 0:r.uploads)||[],refetch:_})]})]})]})};export{pe as default};
