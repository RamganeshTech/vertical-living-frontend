import{j as e,e as H,r as g,F as Z,N as T,h as O,i as ee,k as te,q as se,l as K,u as ae,a as le,G as ne,t as R,M as B,B as U}from"./index-Wihfhca_.js";function re({images:a,onDelete:i,onDownload:r,isDeleting:o=!1,refetch:f,className:N="",minWidth:E=100,maxWidth:p=100,heightClass:C=0,showSelectButton:b,onToggleSelect:v,isSelected:n,onImageClick:y,portalId:I,controlledType:P,activePopupType:S,setActivePopupType:D,selectedSiteImage:h,showSiteSelectButton:k,onSiteImageConfirm:L,onPopupOpenChange:j}){const[u,_]=g.useState(null),[$,G]=g.useState(!1),[A,z]=g.useState({}),s=(t,m,F)=>{const M=F/m,V=Math.max(150,Math.min(400,200*M));z(X=>({...X,[t]:V}))},c=t=>{_(t),G(!0),j==null||j(!0)},l=()=>{G(!1),_(null),j==null||j(!1)},d=()=>{u!==null&&_((u-1+a.length)%a.length)},w=()=>{u!==null&&_((u+1)%a.length)};g.useEffect(()=>{if(!$||P!==S)return;const t=m=>{m.key==="Escape"?l():m.key==="ArrowRight"?w():m.key==="ArrowLeft"&&d()};return $&&(document.addEventListener("keydown",t),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",t),document.body.style.overflow="unset"}},[$,w,d,l]);const Y=async t=>{if(i)try{await i(t),f&&await f(),a.length<=1?l():u!==null&&u>=a.length-1&&_(Math.max(0,a.length-2))}catch(m){console.error("Error deleting image:",m)}},Q=t=>{r({src:t==null?void 0:t.url,alt:(t==null?void 0:t.originalName)||"image"})},J=()=>{l()},x=u!==null&&u>=0&&u<a.length?a[u]:null;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`gap-1 flex flex-wrap ${N}`,children:a.map((t,m)=>{const F=A[t._id]||200;return e.jsx(e.Fragment,{children:e.jsx("div",{className:"relative cursor-pointer bg-gray-100  mb-1 break-inside-avoid ",style:{flex:`0 1 ${E}px`,minWidth:`${E}px`,maxWidth:`${p}px`,height:`${C||F}px`},onClick:()=>{c(m),y==null||y(t),D("reference")},children:e.jsx("img",{src:(t==null?void 0:t.url)||T,alt:(t==null?void 0:t.originalName)||`Image ${m+1}`,className:"w-full cursor-pointer h-full object-cover",loading:"lazy",onLoad:M=>{const W=M.target;s(t._id,W.naturalWidth,W.naturalHeight)}})},t._id)})})}),$&&x&&Z.createPortal(e.jsxs("div",{className:"absolute inset-0 bg-black/90 text-white p-4 z-50 flex items-center justify-center",onClick:J,style:{margin:0,padding:0,zIndex:1e3},children:[e.jsxs("div",{className:"absolute top-6 right-6 z-[10000] flex items-center gap-4",children:[e.jsx("button",{onClick:t=>{t.stopPropagation(),Q(x)},className:"bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-all duration-200",title:"Download",children:e.jsx("i",{className:"fas fa-download text-lg"})}),i&&e.jsx("button",{onClick:t=>{t.stopPropagation(),Y(x._id)},className:"bg-black/50 hover:bg-red-600/70 text-white rounded-full p-3 transition-all duration-200",title:"Delete",disabled:o,children:e.jsx("i",{className:`fas ${o?"fa-spinner fa-spin":"fa-trash-can"} text-lg`})}),b&&v&&x&&e.jsx("button",{onClick:t=>{t.stopPropagation();const m=(n==null?void 0:n(x))??!1;v(x,!m)},className:`bg-${n!=null&&n(x)?"red":"green"}-600 hover:bg-${n!=null&&n(x)?"red":"green"}-700 text-white rounded-full p-3 transition-all duration-200`,title:n!=null&&n(x)?"Unselect this image":"Select this image",children:e.jsx("i",{className:`fas ${n!=null&&n(x)?"fa-xmark":"fa-check"} text-lg`})}),k&&e.jsx("button",{onClick:t=>L==null?void 0:L(t,x),className:`${(h==null?void 0:h._id)===x._id?"bg-red-600 hover:bg-red-700":"bg-blue-600 hover:bg-blue-700"} text-white rounded-full p-3 transition-all duration-200`,title:(h==null?void 0:h._id)===x._id?"Unselect this site image":"Select this site image",children:e.jsx("i",{className:`fas ${(h==null?void 0:h._id)===x._id?"fa-xmark":"fa-check"} text-lg`})}),e.jsx("button",{onClick:t=>{t.stopPropagation(),l()},className:"bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-all duration-200",title:"Close",children:e.jsx("i",{className:"fas fa-times text-xl"})})]}),e.jsx("button",{onClick:t=>{t.stopPropagation(),d()},className:"absolute left-6 top-1/2 transform -translate-y-1/2 z-[10000] bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-all duration-200",children:e.jsx("i",{className:"fas fa-chevron-left text-2xl"})}),e.jsx("button",{onClick:t=>{t.stopPropagation(),w()},className:"absolute right-6 top-1/2 transform -translate-y-1/2 z-[10000] bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-all duration-200",children:e.jsx("i",{className:"fas fa-chevron-right text-2xl"})}),e.jsx("div",{className:"relative flex items-center justify-center",style:{width:"70vw",height:"70vh",maxWidth:"70vw",maxHeight:"70vh"},onClick:t=>{t.stopPropagation(),D(P)},children:e.jsx("img",{src:(x==null?void 0:x.url)||T,alt:x.originalName||`Image ${u!==null?u+1:1}`,className:"max-w-full max-h-full object-contain"})}),e.jsxs("div",{className:"absolute bottom-6 left-1/2 transform -translate-x-1/2 text-white text-sm bg-black/50 px-4 py-2 rounded-full",children:[u!==null?u+1:1," of ",a.length]})]}),document.getElementById(I))]})}function q({imageFiles:a=[],height:i,refetch:r,handleDeleteFile:o,className:f="",minWidth:N,maxWidth:E,isSelected:p,onToggleSelect:C,showSelectButton:b,onImageClick:v,portalId:n,setActivePopupType:y,activePopupType:I,controlledType:P,showSiteSelectButton:S,onSiteImageConfirm:D,selecteSiteImage:h,onPopupOpenChange:k}){return e.jsx(e.Fragment,{children:e.jsx(re,{images:a,onDelete:o,onDownload:H,refetch:r,isDeleting:!1,className:f,heightClass:i,minWidth:N,maxWidth:E,showSelectButton:b,onToggleSelect:C,isSelected:p,onImageClick:v,portalId:n,setActivePopupType:y,activePopupType:I,controlledType:P,selectedSiteImage:h,showSiteSelectButton:S,onSiteImageConfirm:D,onPopupOpenChange:k})})}const ie=async({projectId:a,selections:i,api:r})=>{const{data:o}=await r.post(`/shortlisteddesign/upload/${a}`,{selections:i});if(!o.ok)throw new Error(o.message);return o.data},oe=async({projectId:a,api:i})=>{const{data:r}=await i.get(`/shortlisteddesign/getsiteimages/${a}`);if(!r.ok)throw new Error(r.message);return r.data},ce=()=>{const a=["owner","staff","CTO"],{role:i}=O(),r=K(i);return te({mutationFn:async({projectId:o,selections:f})=>{if(!i||!a.includes(i))throw new Error("Not authorized");if(!r)throw new Error("API instance missing");return await ie({projectId:o,selections:f,api:r})},onSuccess:(o,{projectId:f})=>{se.invalidateQueries({queryKey:["shortlistedDesigns",f]})}})},de=a=>{const i=["owner","staff","CTO"],{role:r}=O(),o=K(r);return ee({queryKey:["siteImages",a],queryFn:async()=>{if(!r||!i.includes(r))throw new Error("Not authorized");if(!o)throw new Error("API instance missing");return await oe({projectId:a,api:o})},enabled:!!a&&!!r})};function he(){var z;const{projectId:a,organizationId:i}=ae(),[r,o]=g.useState(null),f=le(),{data:N=[],isLoading:E}=de(a),{data:p,isLoading:C}=ne({organizationId:i}),[b,v]=g.useState(null),[n,y]=g.useState([]),[I,P]=g.useState(!1),[S,D]=g.useState(!1),[h,k]=g.useState([]),{mutateAsync:L,isPending:j}=ce();g.useEffect(()=>{const s=I||S;return document.body.style.overflow=s?"hidden":"unset",()=>{document.body.style.overflow="unset"}},[I,S]);const u=(s,c)=>{s.stopPropagation(),v(l=>(l==null?void 0:l._id)===c._id?(R({title:"Success",description:"Unselected, You can now select another one."}),null):(R({title:"Success",description:"Site Image selected"}),c))},_=(s,c)=>{if(!b){R({title:"Error",description:"Please select a Site Image first",variant:"destructive"});return}y(l=>{const d=l.some(w=>w._id===s._id);return c&&!d?[...l,s]:c?l:l.filter(w=>w._id!==s._id)})},$=(s,c)=>{k(l=>l.map(d=>d.siteImage._id===s?{...d,referenceImages:d.referenceImages.filter(w=>w._id!==c)}:d).filter(d=>d.referenceImages.length>0))},G=s=>{k(c=>c.filter(l=>l.siteImage._id!==s))},A=async()=>{if(h.length===0){R({title:"Error",description:"No selections to generate",variant:"destructive"});return}try{const s=await L({projectId:a,selections:h});H({src:s.url,alt:s.fileName}),R({title:"Sucess",description:"Designs Generated Successfully!"})}catch(s){R({title:"Error",description:s==null?void 0:s.message,variant:"destructive"})}};return e.jsxs("div",{className:"max-w-full overflow-y-auto max-h-full px-4 mx-auto py-2",children:[e.jsxs("div",{className:"flex gap-2 items-center justify-between",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{onClick:()=>f(-1),className:"flex bg-gray-200 h-fit rounded-full items-center gap-2 backdrop-blur-sm px-4 py-2 cursor-pointer",children:[e.jsx("i",{className:"fas fa-arrow-left text-sm"}),e.jsx("span",{className:"text-sm hidden sm:inline-block font-medium",children:"Back"})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl md:text-3xl font-bold text-gray-900 mb-1",children:"Shortlisting Reference Designs"}),e.jsx("p",{className:"text-gray-600 hidden sm:inline-block text-sm md:text-md",children:"Select and organize your favorite design references for easy access"})]})]}),(b||n.length>0)&&e.jsx("button",{className:"mt-6 bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg cursor-pointer",onClick:()=>{if(!b||n.length===0){R({title:"Error",description:"Select site image & at least 1 reference",variant:"destructive"});return}k(s=>[...s.filter(l=>l.siteImage._id!==b._id),{siteImage:b,referenceImages:n}]),v(null),y([])},children:"Confirm Selection"})]}),e.jsx("hr",{className:"my-3 bg-gray-500"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold text-lg mb-2",children:"Reference Designs"}),e.jsx("div",{className:"my-3 w-full h-[1px] bg-gray-200"}),C?e.jsx("div",{children:e.jsx(B,{})}):e.jsx("div",{className:"relative  h-[80vh]",id:"reference-popup-container",children:((z=p==null?void 0:p.referenceImages)==null?void 0:z.length)>0?e.jsx(q,{imageFiles:(p==null?void 0:p.referenceImages)||[],portalId:"reference-popup-container",height:190,refetch:()=>Promise.resolve(),minWidth:140,maxWidth:190,handleDeleteFile:void 0,showSelectButton:!0,setActivePopupType:o,activePopupType:r,controlledType:"reference",onToggleSelect:(s,c)=>_(s,c),isSelected:s=>n.some(c=>c._id===s._id),onPopupOpenChange:D,className:"overflow-y-auto max-h-[550px] "}):e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[300px] w-full bg-white   text-center p-6",children:[e.jsx("i",{className:"fas fa-box-open text-5xl text-blue-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-1",children:"No Reference Images Available"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Upload the Images in the ",e.jsx("span",{className:"cursor-pointer font-semibold text-blue-600",onClick:()=>f(`/organizations/${i}/projects/shortlistdesign`),children:"Reference Design"})," section",e.jsx("br",{}),"Select multiple Reference images",e.jsx("br",{}),"after selecting ",e.jsx("strong",{children:'"Confirm Selection"'})," to add images 🚀"]})]})})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold text-lg mb-2",children:"Site Images"}),e.jsx("div",{className:"my-3 w-full h-[1px] bg-gray-200"}),E?e.jsx("div",{children:e.jsx(B,{})}):e.jsx("div",{className:"relative  h-[80vh]",id:"site-popup-container",children:(N==null?void 0:N.length)>0?e.jsx(q,{portalId:"site-popup-container",imageFiles:N,height:190,refetch:()=>Promise.resolve(),minWidth:140,maxWidth:190,setActivePopupType:o,activePopupType:r,controlledType:"site",showSiteSelectButton:!0,onSiteImageConfirm:u,selecteSiteImage:b,onImageClick:s=>{v(s),o("site")},onPopupOpenChange:P,className:"overflow-y-auto max-h-[550px] "}):e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[300px] w-full bg-white   text-center p-6",children:[e.jsx("i",{className:"fas fa-box-open text-5xl text-blue-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-1",children:"No Site Images Available"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Upload the Images in the Site Measurement Stage",e.jsx("br",{}),"Select multiple Reference images for single Site Image ",e.jsx("br",{}),"after selection ",e.jsx("strong",{children:'"Confirm Selection"'})," to add images 🚀"]})]})})]})]}),h.length>0?e.jsxs("div",{className:"mt-10 space-y-8",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("h3",{className:"font-bold text-xl mb-4",children:"Selected Designs"}),e.jsx(U,{isLoading:j,onClick:A,className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded shadow disabled:opacity-50",children:j?"Generating...":"Generate Design"})]}),h.map(({siteImage:s,referenceImages:c},l)=>e.jsxs("div",{className:"p-4 py-6 border border-gray-300 rounded-lg bg-white shadow-md",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"",children:[e.jsxs("h2",{className:"text-base font-semibold text-gray-700 min-w-[110px]",children:["Site Image ",l+1]}),e.jsx("br",{}),e.jsx("img",{src:s==null?void 0:s.url,alt:s.originalName||`Site ${l+1}`,className:"h-28 w-auto object-contain border rounded-md"})]}),e.jsxs(U,{variant:"danger",onClick:()=>G(s._id),className:"text-white bg-red-600 text-sm whitespace-nowrap",children:[e.jsx("i",{className:"fas fa-trash !mr-2 "}),"Remove Site + References"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 flex-col",children:[e.jsx("h2",{className:"text-base font-semibold text-gray-700 min-w-[110px]",children:"Referece Images"}),e.jsx("div",{className:"flex flex-wrap gap-4 ",children:c.map(d=>e.jsxs("div",{className:"relative  w-[120px] h-[120px] ",children:[e.jsx("img",{src:d.url,alt:d.originalName,className:"w-full h-full object-cover rounded  shadow-sm"}),e.jsx("button",{onClick:()=>$(s._id,d._id),className:"absolute top-1 right-1 bg-red-600 text-white p-1 px-2 text-xs rounded-full",children:"✕"}),e.jsx("p",{className:"text-xs mt-1 text-center max-w-[120px] truncate",children:d.originalName})]},d._id))})]})]},s._id))]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-xl font-semibold text-black-800 mb-1",children:"Youre Selections will appear below"}),e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[300px] w-full bg-white rounded-xl shadow-xl border border-gray-100  text-center p-6",children:[e.jsx("i",{className:"fas fa-box-open text-5xl text-blue-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-1",children:"No Selections Created"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Your Selection will appear here.",e.jsx("br",{}),"Select multiple Reference images for single Site Image ",e.jsx("br",{}),"after selection ",e.jsx("strong",{children:'"Confirm Selection"'})," to add images 🚀"]})]})]})]})}export{he as default};
