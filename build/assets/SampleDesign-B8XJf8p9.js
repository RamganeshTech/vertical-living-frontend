import{q as S,r as F,j as e,b as B,d as G}from"./index-DkfQDeIt.js";import{B as p}from"./Button-C-chqFKc.js";import{u as b,g as y}from"./roleCheck-DNL7PxQZ.js";import{u as Y}from"./useQuery-mUmMtORz.js";import{u as j}from"./useMutation-BWlLDX_I.js";import{t as h}from"./toast-BSC5QTk1.js";import{A as _,S as V}from"./AssignStaff-DXCssW_O.js";import{c as W}from"./Card-Dx_Z9f0D.js";import{d as O}from"./downloadFile-CKDbPSiN.js";import{R as H}from"./ResetStageButton-DPKiOhg7.js";import J from"./MaterialOverviewLoading-CgXl-m5l.js";import"./Input-lr8I7tVA.js";import"./getAllUsersApi-CuWWGdu9.js";import"./Skeleton-CVtEMTN7.js";const X=async({projectId:a,roomName:s,api:t})=>{const{data:l}=await t.post(`/sampledesign/${a}/rooms`,{roomName:s});if(!l.ok)throw new Error(l.message);return l.data},Z=async({projectId:a,roomName:s,files:t,api:l})=>{const n=new FormData;t.forEach(g=>n.append("files",g));const{data:r}=await l.post(`/sampledesign/${a}/rooms/${s}/upload`,n,{headers:{"Content-Type":"multipart/form-data"}});return r.data},ee=async({projectId:a,api:s})=>{const{data:t}=await s.get(`/sampledesign/${a}/rooms`);if(!t.ok)throw new Error(t.message);return t.data},se=async({projectId:a,roomName:s,fileIndex:t,api:l})=>{const{data:n}=await l.delete(`/sampledesign/${a}/rooms/${s}/delete/${t}`);if(!n.ok)throw new Error(n.message);return n.data},te=async({projectId:a,api:s,roomId:t})=>{const{data:l}=await s.delete(`/sampledesign/${a}/${t}/deleteroom`);if(!l.ok)throw new Error(l.message);return l.data},ae=async({projectId:a,api:s})=>{const{data:t}=await s.put(`/sampledesign/completionstatus/${a}`);if(!t.ok)throw new Error(t.message);return t.data},oe=async({formId:a,projectId:s,deadLine:t,api:l})=>{const{data:n}=await l.put(`/sampledesign/deadline/${s}/${a}`,{deadLine:t});if(!n.ok)throw new Error(n.message);return n.data},le=()=>{const a=["owner","staff","CTO","client"],{role:s}=b(),t=y(s);return j({mutationFn:async({projectId:l,roomName:n})=>{if(!s||!a.includes(s))throw new Error("not allowed to make this api call");if(!t)throw new Error("API instance not found for role");return await X({projectId:l,roomName:n,api:t})},onSuccess:()=>{S.invalidateQueries({queryKey:["sampledesign","rooms"]})}})},ne=()=>{const a=["owner","staff","CTO","client"],{role:s}=b(),t=y(s);return j({mutationFn:async({projectId:l,roomName:n,files:r})=>{if(!s||!a.includes(s))throw new Error("not allowed to make this api call");if(!t)throw new Error("API instance not found for role");return await Z({projectId:l,roomName:n,files:r,api:t})},onSuccess:()=>{S.invalidateQueries({queryKey:["sampledesign","roomfiles"]})}})},ie=a=>{const s=["owner","staff","CTO","client"],{role:t}=b(),l=y(t);return Y({queryKey:["sampledesign","roomfiles",a],queryFn:async()=>{if(!t||!s.includes(t))throw new Error("not allowed to make this api call");if(!l)throw new Error("API instance not found for role");return await ee({projectId:a,api:l})},retry:!1,refetchOnWindowFocus:!1,staleTime:1e3*60*5})},re=()=>{const a=["owner","staff","CTO","client"],{role:s}=b(),t=y(s);return j({mutationFn:async({projectId:l,roomName:n,fileIndex:r})=>{if(!s||!a.includes(s))throw new Error("not allowed to make this api call");if(!t)throw new Error("API instance not found for role");return await se({projectId:l,roomName:n,fileIndex:r,api:t})},onSuccess:()=>{S.invalidateQueries({queryKey:["sampledesign","roomfiles"]})}})},de=()=>{const a=["owner","staff","CTO","client"],{role:s}=b(),t=y(s);return j({mutationFn:async({projectId:l,roomId:n})=>{if(!s||!a.includes(s))throw new Error("not allowed to make this api call");if(!t)throw new Error("API instance not found for role");return await te({projectId:l,roomId:n,api:t})},onSuccess:()=>{S.invalidateQueries({queryKey:["sampledesign","roomfiles"]})}})},ce=()=>{const a=["owner","staff","CTO","client"],{role:s}=b(),t=y(s);return j({mutationFn:async({projectId:l})=>{if(!s||!a.includes(s))throw new Error("not allowed to make this api call");if(!t)throw new Error("API instance not found for role");return await ae({projectId:l,api:t})},onSuccess:()=>{S.invalidateQueries({queryKey:["siteMeasurement"]})}})},me=()=>{const a=["owner","staff","CTO"],{role:s}=b(),t=y(s);return j({mutationFn:async({formId:l,projectId:n,deadLine:r})=>{if(!s)throw new Error("not authorized");if(!a.includes(s))throw new Error("you  dont have the access to make this api");if(!t)throw new Error("api is null");return await oe({formId:l,projectId:n,deadLine:r,api:t})}})},ue=({isOpen:a,onClose:s,onSubmit:t,addPending:l})=>{const[n,r]=F.useState(""),g=async w=>{w.preventDefault(),await t(n),r(""),s()};return a?e.jsx("div",{onClick:s,className:"fixed inset-0 bg-black/70 bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{onClick:w=>w.stopPropagation(),className:"bg-white rounded-lg p-6 w-[80%] sm:w-[60%] lg:w-full max-w-md",children:[e.jsx("h2",{className:"text-2xl font-bold text-blue-700 mb-4",children:"Add New Room"}),e.jsxs("form",{onSubmit:g,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 mb-2",children:"Room Name"}),e.jsx("input",{type:"text",value:n,onChange:w=>r(w.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{type:"button",onClick:s,className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"Cancel"}),e.jsx(p,{isLoading:l,type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Add Room"})]})]})]})}):null},xe=({files:a,onUpload:s,onDelete:t,uploadPending:l,deletePending:n})=>{const r=F.useRef(null),[g,w]=F.useState([]),k=a.filter(o=>o.type==="pdf"),N=a.filter(o=>o.type==="image"),[R,v]=F.useState(null),i=o=>{var d;(d=o.target.files)!=null&&d.length&&w(Array.from(o.target.files))},C=async()=>{g.length!==0&&await s(g)};return e.jsxs("div",{className:"bg-white h-auto rounded-lg p-2 sm:p-6",children:[e.jsx("div",{className:"flex items-center gap-4 mb-6",children:e.jsxs("div",{className:"w-full space-x-2",children:[e.jsx("input",{id:"fileInput",ref:r,type:"file",accept:".pdf,image/*",multiple:!0,className:"mb-1 sm:mb-0 w-[55%] sm:w-[80%] h-full py-2 border-1 px-2 rounded-lg",onChange:i}),e.jsxs(p,{variant:"primary",onClick:()=>{var o;return(o=r.current)==null?void 0:o.click()},className:"",children:[e.jsx("span",{className:"hidden sm:block",children:" Select Files"}),e.jsx("span",{className:"block sm:hidden",children:" Select"})]}),e.jsx(p,{isLoading:l,onClick:C,className:"px-2 sm:px-4 py-2 rounded-lg",variant:"primary",children:"upload"})]})}),e.jsxs("div",{className:"grid h-auto grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 text-blue-700",children:[e.jsx("i",{className:"fas fa-file-pdf text-lg"}),e.jsx("h3",{className:"font-medium",children:"PDF Files"})]}),e.jsx("div",{className:"max-h-[300px] overflow-y-auto custom-scrollbar max-w-[100%] overflow-x-hidden",children:k.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No PDF files uploaded"}):e.jsx("div",{className:"space-y-2 max-w-[100%]",children:k.map((o,d)=>e.jsxs("div",{className:"flex items-center max-w-full justify-between py-2 px-3 bg-green-50 rounded-lg hover:bg-green-100 transition-colors",children:[e.jsx("span",{className:"text-gray-700 truncate whitespace-wrap max-w-[100%] flex-1 ",children:o.originalName||"Unnamed PDF"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{onClick:()=>O({src:o==null?void 0:o.url,alt:(o==null?void 0:o.originalName)||"file.pdf"}),size:"sm",className:"text-sm",children:e.jsx("i",{className:"fa-solid fa-download"})}),e.jsx(p,{size:"sm",isLoading:n,onClick:()=>t(d),title:"Delete",children:e.jsx("i",{className:"fas fa-trash"})})]})]},d))})})]}),e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 text-blue-700",children:[e.jsx("i",{className:"fas fa-images text-lg"}),e.jsx("h3",{className:"font-medium",children:"Image Files"})]}),e.jsx("div",{className:"max-h-[300px] overflow-y-auto custom-scrollbar max-w-[100%] overflow-x-hidden",children:N.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No image files uploaded"}):e.jsx("div",{className:"space-y-2 max-w-[100%] ",children:N.map((o,d)=>e.jsxs("div",{className:"flex items-center max-w-full justify-between py-2 px-3 bg-green-50 rounded-lg hover:bg-green-100 transition-colors",children:[e.jsx("span",{className:"text-gray-700 truncate whitespace-wrap max-w-[80%] ",children:o.originalName||"Unnamed Image"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{size:"sm",variant:"primary",onClick:()=>v(o==null?void 0:o.url),children:e.jsx("i",{className:"fas fa-eye"})}),e.jsx(p,{onClick:()=>O({src:o==null?void 0:o.url,alt:(o==null?void 0:o.originalName)||"file.pdf"}),size:"sm",className:"text-sm",children:e.jsx("i",{className:"fa-solid fa-download"})}),e.jsx(p,{size:"sm",isLoading:n,onClick:()=>t(d),title:"Delete",children:e.jsx("i",{className:"fas fa-trash"})})]})]},d))})})]})]}),R&&e.jsx("div",{onClick:()=>v(null),className:"fixed inset-0 bg-black/70 z-50 p-8 bg-opacity-60 flex items-center justify-center",children:e.jsxs("div",{onClick:o=>o.stopPropagation(),className:"relative bg-white rounded py-8 px-4 max-w-[90vw] max-h-[80vh] shadow-lg",children:[e.jsx("i",{className:"fas fa-times absolute top-2 right-3 text-xl text-gray-700 hover:text-red-500 cursor-pointer",onClick:()=>v(null)}),e.jsx("img",{src:R,alt:"Full View",className:"max-h-[70vh] w-auto object-contain rounded"})]})})]})},Ce=()=>{var E,P,I,L,M;const{projectId:a,organizationId:s}=B(),{isMobile:t,openMobileSidebar:l}=G();if(!a)return null;const[n,r]=F.useState(!1),g=le(),{mutateAsync:w,isPending:k}=ne(),N=re(),{mutateAsync:R,isPending:v}=de(),{data:i,isLoading:C,refetch:o,error:d}=ie(a),{mutateAsync:T,isPending:A}=ce(),{mutateAsync:D,isPending:$}=me(),q=async()=>{var c,m;try{A||await T({projectId:a}),h({description:"Completion status updated successfully",title:"Success"})}catch(u){h({title:"Error",description:((m=(c=u==null?void 0:u.response)==null?void 0:c.data)==null?void 0:m.message)||"Failed to update completion status",variant:"destructive"})}},z=async c=>{var m,u;try{await g.mutateAsync({projectId:a,roomName:c}),h({description:"Room Created successfully",title:"Success"})}catch(x){h({title:"Error",description:((u=(m=x==null?void 0:x.response)==null?void 0:m.data)==null?void 0:u.message)||"Failed to create room status",variant:"destructive"})}},U=async c=>{var m,u;try{A||await R({projectId:a,roomId:c}),h({description:"Room section Deleted successfully",title:"Success"})}catch(x){h({title:"Error",description:((u=(m=x==null?void 0:x.response)==null?void 0:m.data)==null?void 0:u.message)||"Failed to delete the room",variant:"destructive"})}},K=async(c,m)=>{var u,x;try{await w({projectId:a,roomName:c,files:m}),h({description:"File uploaded successfully",title:"Success"}),o()}catch(f){h({title:"Error",description:((x=(u=f==null?void 0:f.response)==null?void 0:u.data)==null?void 0:x.message)||(f==null?void 0:f.message)||" Failed to upload the files",variant:"destructive"})}},Q=async(c,m)=>{var u,x;try{await N.mutateAsync({projectId:a,roomName:c,fileIndex:m}),h({description:"File deleted successfully",title:"Success"}),o()}catch(f){h({title:"Error",description:((x=(u=f==null?void 0:f.response)==null?void 0:u.data)==null?void 0:x.message)||"Failed to delete the files",variant:"destructive"})}};return C?e.jsx(J,{}):e.jsxs("div",{className:"container mx-auto  max-w-full min-h-full",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4 mb-6",children:[e.jsxs("h2",{className:"text-2xl sm:text-2xl lg:text-2xl xl:text-3xl font-semibold text-blue-600 flex items-center",children:[t&&e.jsx("button",{onClick:l,className:"mr-3 p-2 rounded-md  border-gray-300 hover:bg-gray-100",title:"Open Menu",children:e.jsx("i",{className:"fa-solid fa-bars"})}),e.jsx("i",{className:"fa-solid fa-object-group mr-2"}),"Sample Design Files"]}),e.jsxs("div",{className:"!w-[100%] sm:!w-[100%] lg:!w-[50%] xl:!w-[65%] flex flex-col sm:flex-row gap-3 justify-end",children:[e.jsxs("div",{className:"flex flex-wrap md:flex-nowrap gap-2 justify-end",children:[e.jsxs(p,{onClick:()=>r(!0),className:"bg-blue-600 hover:bg-blue-700 text-white flex-1 sm:flex-initial min-w-max",disabled:!!d,children:[e.jsx("i",{className:"fas fa-plus mr-2"}),e.jsx("span",{className:"",children:"Add room"})]}),e.jsxs(p,{isLoading:A,onClick:q,className:"bg-green-600 hover:bg-green-700 text-white flex-1 sm:flex-initial min-w-max",disabled:!!d,children:[e.jsx("i",{className:"fa-solid fa-circle-check mr-2"}),"Mark Complete"]})]}),e.jsxs("div",{className:"flex flex-wrap md:flex-nowrap gap-2 justify-end",children:[e.jsx(H,{projectId:a,stageNumber:3,stagePath:"sampledesign",className:"flex-1 sm:flex-initial min-w-max",disabled:!!d}),e.jsx(_,{stageName:"SampleDesignModel",projectId:a,organizationId:s,currentAssignedStaff:(i==null?void 0:i.assignedTo)||null,className:"flex-1 sm:flex-initial min-w-max"})]})]})]}),d&&e.jsxs("div",{className:"max-w-xl mx-auto p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center mb-6",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2",children:"⚠️ Error Occurred"}),e.jsx("p",{className:"text-red-500 text-sm mb-4",children:((P=(E=d==null?void 0:d.response)==null?void 0:E.data)==null?void 0:P.message)||"Failed to load data"}),e.jsx(p,{onClick:()=>o(),className:"bg-red-600 text-white px-4 py-2",children:"Retry"})]}),!d&&e.jsxs(e.Fragment,{children:[e.jsxs(W,{className:"p-4 mb-6 w-full shadow border-l-4 border-blue-600 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-3 text-blue-700 text-sm font-medium mb-2",children:[e.jsx("i",{className:"fa-solid fa-clock text-blue-500 text-lg"}),e.jsx("span",{children:"Stage Timings"})]}),e.jsx(V,{stageName:"sampledesign",completedAt:(I=i==null?void 0:i.timer)==null?void 0:I.compltedAt,formId:i==null?void 0:i._id,projectId:a,deadLine:(L=i==null?void 0:i.timer)==null?void 0:L.deadLine,startedAt:(M=i==null?void 0:i.timer)==null?void 0:M.startedAt,refetchStageMutate:o,deadLineMutate:D,isPending:$})]}),!(i!=null&&i.rooms)||i.rooms.length===0?e.jsxs("div",{className:"text-center py-10 sm:py-16 bg-white rounded-lg shadow-sm",children:[e.jsx("i",{className:"fas fa-home text-blue-200 text-5xl sm:text-6xl mb-4"}),e.jsx("h2",{className:"text-xl sm:text-2xl font-semibold text-gray-700 mb-2",children:"No Rooms Added Yet"}),e.jsx("p",{className:"text-gray-500 mb-6 max-w-md mx-auto",children:"Start by adding a room to upload design files"}),e.jsxs("button",{onClick:()=>r(!0),className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 min-w-[200px]",children:[e.jsx("i",{className:"fas fa-plus mr-2"}),"Add Your First Room"]})]}):e.jsx("div",{className:"grid grid-cols-1 sm:max-h-[60vh] md:max-h-[47vh] lg:max-h-[55vh] xl:max-h-[65vh] overflow-y-auto custom-scrollbar gap-6",children:i.rooms.map(c=>e.jsxs("div",{className:"bg-white border-l-4 border-blue-600 rounded-xl shadow-sm p-1 sm:p-6 flex flex-col",children:[e.jsxs("div",{className:"flex sm:flex-row items-center justify-between gap-3 mb-4",children:[e.jsxs("h2",{className:"text-xl font-semibold text-blue-700 truncate",children:[e.jsx("i",{className:"fas fa-door-open mr-2"}),c.roomName]}),e.jsxs(p,{isLoading:v,onClick:()=>U(c._id),variant:"danger",className:"bg-red-600 text-white  sm:w-auto mt-2 sm:mt-0",children:[e.jsx("i",{className:"fa-solid fa-trash mr-2"}),"Delete"]})]}),e.jsx("div",{className:"flex-grow",children:e.jsx(xe,{files:c.files,onUpload:m=>K(c.roomName,m),onDelete:m=>Q(c.roomName,m),uploadPending:k,deletePending:N.isPending})})]},c.roomName))})]}),e.jsx(ue,{isOpen:n,onClose:()=>r(!1),onSubmit:z,addPending:g.isPending})]})};export{Ce as default};
