import{u as te,a as ae,b as le,r as u,j as e,M as ie,B as r,I as re,t as o}from"./index-hYGmCEO1.js";import{c as ne,d as oe,e as ce,f as de,g as me}from"./cleaningStageApi-BAEykt9Z.js";import{C as p}from"./Card-ChYAICVg.js";import{T as ue}from"./TextArea-BRgMMCHU.js";import{L as xe}from"./Label-hkBviWcw.js";import{d as ge}from"./downloadFile-CC_wTDgr.js";import{I as pe}from"./ImageGalleryMain-BLxp6EDz.js";import"./index-DLc3TZXK.js";function Ce(){var R,U,L,A,M,z,T,$,B;const{projectId:c,roomId:d,organizationId:G}=te(),O=ae(),{data:t,isLoading:W,refetch:x,isError:_,error:h}=ne(c,d),{role:b,permission:i}=le(),C=b==="owner"||((R=i==null?void 0:i.cleaning)==null?void 0:R.delete),f=b==="owner"||((U=i==null?void 0:i.cleaning)==null?void 0:U.create),j=b==="owner"||((L=i==null?void 0:i.cleaning)==null?void 0:L.edit),[k,F]=u.useState(null),{mutateAsync:V,isPending:N}=oe(),{mutateAsync:q,isPending:S}=ce(),{mutateAsync:H,isPending:J}=de(),{mutateAsync:K,isPending:E}=me(),[g,Q]=u.useState((t==null?void 0:t.completelyCleaned)||!1),[v,y]=u.useState((t==null?void 0:t.notes)||""),[I,w]=u.useState(!1),[m,D]=u.useState(null),X=s=>{var l;(l=s.target.files)!=null&&l.length&&D(s.target.files)},Y=async()=>{var s,l;try{if(!m)throw new Error("select the files before uploading");const a=new FormData;for(let n=0;n<m.length;n++)a.append("files",m[n]);await V({projectId:c,roomId:d,formData:a}),o({title:"Success",description:"Files uploaded successfully."}),D(null),x()}catch(a){o({title:"Error",description:((l=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:l.message)||a.message,variant:"destructive"})}},P=async s=>{var l,a;try{await q({projectId:c,roomId:d,fileId:s}),o({title:"Deleted",description:"File deleted successfully."}),x()}catch(n){o({title:"Error",description:((a=(l=n==null?void 0:n.response)==null?void 0:l.data)==null?void 0:a.message)||n.message,variant:"destructive"})}},Z=async()=>{var s,l;try{if(!v.trim())throw new Error("please enter some notes");await K({projectId:c,roomId:d,notes:v}),o({title:"Notes updated!",description:"Room notes saved."}),w(!1)}catch(a){o({title:"Error",description:((l=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:l.message)||(a==null?void 0:a.message)||"Failed to update",variant:"destructive"})}},ee=async()=>{var s,l;try{await H({projectId:c,roomId:d,completelyCleaned:!g}),o({title:"Updated",description:`Marked as ${g?"not cleaned":"completely cleaned"}.`}),Q(!g),x()}catch(a){o({title:"Error",description:((l=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:l.message)||a.message,variant:"destructive"})}};if(W)return e.jsx(ie,{});_&&((M=(A=h==null?void 0:h.response)==null?void 0:A.data)!=null&&M.message,r);const se=(z=(t==null?void 0:t.uploads)||[])==null?void 0:z.filter(s=>s.type==="image");return e.jsxs("div",{className:"w-full h-full max-h-full overflow-y-auto custom-scrollbar-none sm:custom-scrollbar",children:[e.jsxs("div",{className:"mb-4 flex justify-between items-center w-full",children:[e.jsxs("h2",{className:"text-md sm:text-2xl font-semibold mb-4 text-blue-700 flex items-center",children:[e.jsx("i",{className:"fas fa-broom mr-2"})," ",t==null?void 0:t.roomName," - Details"]}),e.jsxs("div",{className:"flex gap-1 items-center",children:[(f||j)&&e.jsx(r,{isLoading:J,onClick:ee,className:"bg-blue-600 hover:bg-blue-700 text-white text-sm !p-2 lg:p-4 ",children:g?"Mark as Not Cleaned":"Mark as Cleaned"}),e.jsx(r,{variant:"primary",className:"",onClick:()=>O(`/${G}/projectdetails/${c}/cleaning`),children:"Go Back"})]})]}),e.jsxs("div",{className:"mb-2 grid grid-cols-1 md:grid-cols-2 gap-1 items-center place-content-center",children:[e.jsxs(p,{className:"p-2 border-gray-100 border-2",children:[e.jsxs("div",{className:"w-full justify-between flex items-center",children:[e.jsx("h3",{className:"text-md font-semibold  text-blue-700",children:"Notes"}),!I&&(f||j)&&e.jsxs(r,{onClick:()=>{y(t==null?void 0:t.notes),w(!0)},className:"bg-blue-600 text-white hover:bg-blue-700",children:["Edit ",e.jsx("i",{className:"fas fa-pencil ml-2 "})]})]}),I?e.jsxs(e.Fragment,{children:[e.jsx(ue,{rows:4,className:"w-full border rounded p-2",value:v,onChange:s=>y(s.target.value),placeholder:"Enter notes here..."}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx(r,{onClick:Z,disabled:E,className:"bg-blue-600 text-white hover:bg-blue-700",children:E?"Saving...":"Save"}),e.jsx(r,{onClick:()=>{w(!1),y((t==null?void 0:t.notes)??"")},variant:"outline",className:"border-gray-400",children:"Cancel"})]})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"relative overflow-x-auto overflow-y-auto break-words h-[6rem] max-h-[6rem] leading-5 custom-scrollbar",children:[" ",e.jsx("p",{className:"text-gray-700 mb-2 ",children:(T=t==null?void 0:t.notes)!=null&&T.trim()?t==null?void 0:t.notes:"No notes present."})]})})]}),(f||j)&&e.jsxs(p,{className:"p-2 h-full border-gray-100 border-2",children:[e.jsx(xe,{className:"block mb-2 font-semibold !text-blue-700",children:"Upload Images or PDFs:"}),e.jsx(re,{type:"file",multiple:!0,accept:"image/*,application/pdf",onChange:X,disabled:N,className:"border-b w-full"}),e.jsx(r,{onClick:Y,isLoading:N,className:"mt-3 bg-blue-600 text-white hover:bg-blue-700",children:N?"Uploading...":`Upload ${m?m.length:""} file(s)`})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 h-[95%] sm:h-[65%]",children:[e.jsxs(p,{className:"p-2 lg:p-4 max-h-full overflow-y-auto custom-scrollbar border-1 border-[#8485887a]",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3 text-blue-700",children:"Images"}),(($=t==null?void 0:t.uploads)==null?void 0:$.filter(s=>s.type==="image").length)===0?e.jsx("p",{className:"text-gray-400 text-sm",children:"No images uploaded."}):e.jsx(pe,{imageFiles:se,...C?{handleDeleteFile:P}:{},height:80,minWidth:98,maxWidth:100})]}),e.jsxs(p,{className:"p-4 max-h-full overflow-y-auto border-1 border-[#8485887a] custom-scrollbar",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3 text-blue-700",children:"PDFs"}),((B=t.uploads)==null?void 0:B.filter(s=>s.type==="pdf").length)===0?e.jsx("p",{className:"text-gray-400 text-sm",children:"No PDFs uploaded."}):e.jsx("ul",{className:"space-y-2",children:t==null?void 0:t.uploads.filter(s=>s.type==="pdf").map(s=>e.jsxs("li",{className:"flex items-center justify-between shadow-md p-2 rounded h-full",children:[e.jsx("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 underline truncate max-w-[50%]",children:s.originalName}),e.jsxs("div",{className:"space-x-1",children:[e.jsx(r,{size:"sm",variant:"primary",onClick:()=>ge({src:s==null?void 0:s.url,alt:(s==null?void 0:s.originalName)||"file.pdf"}),children:e.jsx("i",{className:"fa-solid fa-download"})}),C&&e.jsx(r,{size:"sm",isLoading:S,onClick:()=>P(s._id),disabled:S,variant:"danger",className:"bg-red-600 text-white rounded px-2 py-1 text-xs",children:e.jsx("i",{className:"fas fa-trash-can"})})]})]},s.url))})]})]}),k&&e.jsx("div",{onClick:()=>F(null),className:"fixed inset-0 z-50 bg-black/70 bg-opacity-60 flex items-center justify-center",children:e.jsxs("div",{onClick:s=>s.stopPropagation(),className:"relative bg-white rounded py-8 px-4 max-w-[90vw] max-h-[80vh] shadow-lg",children:[e.jsx("i",{className:"fas fa-times absolute top-2 right-3 text-xl text-gray-700 hover:text-red-500 cursor-pointer",onClick:()=>F(null)}),e.jsx("img",{src:k,alt:"Full View",className:"max-h-[70vh] w-auto object-contain rounded"})]})})]})}export{Ce as default};
