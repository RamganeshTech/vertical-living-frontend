import{u as K,f as G,a as V,r as d,b as $,j as e,O as q}from"./index-DmIvND9E.js";import{u as J,a as Q,b as W,c as X}from"./commonOrderHistoryMaterialApi-BadLo1EK.js";import{B as r}from"./Button-CcLxO5cH.js";import{I as k}from"./Input-DkyuoIiE.js";import{C as Y,b as Z,d as ee,a as ae,c as te}from"./Card-CDMWR08L.js";import{t as se}from"./toast-BSC5QTk1.js";import{L as re}from"./Label-BmxexTAj.js";import"./roleCheck-DZRqXPrB.js";import"./useQuery-BHdcKCtG.js";import"./useMutation-CAeBxy3I.js";const je=()=>{var v,w,b,P;const{organizationId:p}=K(),{openMobileSidebar:E,isMobile:S}=G(),D=V(),[m,x]=d.useState(""),[C,i]=d.useState(!1),[o,u]=d.useState(null),[h,l]=d.useState(""),{role:c,permission:s}=$(),L=c==="owner"||((v=s==null?void 0:s.commonorder)==null?void 0:v.delete),z=c==="owner"||((w=s==null?void 0:s.commonorder)==null?void 0:w.list),I=c==="owner"||((b=s==null?void 0:s.commonorder)==null?void 0:b.create),f=c==="owner"||((P=s==null?void 0:s.commonorder)==null?void 0:P.edit),{data:n,isLoading:_,error:A,refetch:j}=J(p),{mutateAsync:F,isPending:M}=Q(),{mutateAsync:O,isPending:R}=W(),{mutateAsync:T,isPending:U}=X(),N=location.pathname.split("/");if(N[N.length-1]!=="commonorder")return e.jsx(q,{context:{openMobileSidebar:E,isMobile:S}});const y=async()=>{m.trim()||se({title:"Error",description:"Project Name is mandatory",variant:"destructive"});try{await F({organizationId:p,payload:{projectName:m}}),x(""),i(!1),await j()}catch(a){console.error(a)}},B=async a=>{if(window.confirm("Are you sure?"))try{await O({id:a}),await j()}catch(t){console.error(t)}},H=async()=>{if(!(!h.trim()||!o))try{await T({id:o,payload:{projectName:h}}),u(null),l(""),await j()}catch(a){console.error(a)}};return e.jsxs("div",{className:"max-w-full mx-auto p-2 space-y-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("h1",{className:"text-2xl font-bold text-blue-600",children:[e.jsx("i",{className:"fas fa-layer-group mr-2"}),"Common Projects"]}),!C&&I&&e.jsxs(r,{variant:"primary",onClick:()=>i(!0),children:[e.jsx("i",{className:"fas fa-plus mr-2"}),"Create New Project"]})]}),C&&e.jsx("div",{onClick:()=>i(!1),className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:e.jsxs("div",{onClick:a=>a.stopPropagation(),className:"flex rounded-2xl bg-white flex-col p-6 gap-3 max-w-lg items-start",children:[e.jsx(re,{className:"text-2xl",children:"Create Project"}),e.jsx(k,{placeholder:"Enter project name",value:m,onChange:a=>x(a.target.value),autoFocus:!0,onKeyDown:a=>{a.key==="Enter"&&y()}}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(r,{variant:"primary",onClick:y,isLoading:M,children:[e.jsx("i",{className:"fas fa-save mr-2"}),"Save"]}),e.jsx(r,{variant:"ghost",onClick:()=>{i(!1),x("")},children:"Cancel"})]})]})}),_&&e.jsx("p",{children:"Loading projects..."}),A&&e.jsx("p",{className:"text-red-500",children:"Something went wrong while loading projects."}),(n==null?void 0:n.length)===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center text-gray-500",children:[e.jsx("i",{className:"fas fa-folder-open text-5xl text-blue-300 mb-4"}),e.jsx("h2",{className:"text-xl font-semibold",children:"No Projects Found"}),e.jsx("p",{children:"Create a project to start managing materials more efficiently."})]}),z&&e.jsx("div",{className:"grid gap-6 grid-cols-1 sm:grid-cols-2 md:grid-cols-3",children:n==null?void 0:n.map(a=>{var g;return e.jsx("div",{className:"transition-transform hover:scale-[1.02] cursor-pointer",children:e.jsxs(Y,{className:"shadow-md hover:shadow-lg border-l-4 border-blue-600",children:[e.jsx(Z,{children:o===a._id?e.jsx(k,{value:h,onChange:t=>{l(t.target.value)},autoFocus:!0,onKeyDown:t=>{t.key},placeholder:"Edit project name"}):e.jsxs(ee,{className:"line-clamp-1",children:[e.jsx("i",{className:"fas fa-project-diagram mr-2 text-blue-500"}),a.projectName||"Untitled"]})}),e.jsxs(ae,{className:"space-y-4",children:[e.jsxs(te,{children:[e.jsx("i",{className:"fas fa-tasks mr-1 text-gray-400"}),"Order Units:"," ",e.jsx("span",{className:"font-medium text-blue-600",children:(g=a==null?void 0:a.selectedUnits)==null?void 0:g.length})]}),e.jsx("div",{className:"flex gap-3 flex-wrap",children:o===a._id?e.jsxs(e.Fragment,{children:[f&&e.jsxs(r,{size:"sm",variant:"primary",onClick:t=>{t.stopPropagation(),H()},isLoading:U,children:[e.jsx("i",{className:"fas fa-check mr-1"}),"Save"]}),f&&e.jsx(r,{size:"sm",variant:"ghost",onClick:t=>{t.stopPropagation(),u(null),l("")},children:"Cancel"})]}):e.jsxs(e.Fragment,{children:[f&&e.jsxs(r,{size:"sm",variant:"outline",onClick:t=>{t.stopPropagation(),u(a._id),l(a.projectName||"")},children:[e.jsx("i",{className:"fas fa-edit mr-1 text-blue-500"}),"Edit"]}),L&&e.jsxs(r,{size:"sm",variant:"danger",onClick:t=>{t.stopPropagation(),B(a._id)},isLoading:R,className:"hover:text-white",children:[e.jsx("i",{className:"fas fa-trash-alt mr-1"}),"Delete"]}),e.jsxs(r,{size:"sm",variant:"secondary",onClick:t=>{t.stopPropagation(),D(`${a._id}`)},children:[e.jsx("i",{className:"fas fa-eye mr-1 text-blue-600"}),"View"]})]})})]})]})},a._id)})})]})};export{je as default};
