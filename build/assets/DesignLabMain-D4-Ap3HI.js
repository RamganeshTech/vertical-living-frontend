import{u as E,c as T,d as B,r as b,j as e,O}from"./index-Duiduteo.js";import{d as P}from"./dateFormator-BGKi5rfZ.js";import{u as R}from"./useDebounce-Dd85tq7c.js";import{g as _,h as I}from"./designLabApi-BFjg_u4P.js";import{B as j}from"./Button-DF5tm_KZ.js";import{t as w}from"./toast-BSC5QTk1.js";import"./useQuery-C2l_NFV4.js";import"./useMutation-BNs_TkNH.js";import"./useInfiniteQuery-BEsLEhdS.js";import"./roleCheck-CeVvsM7Q.js";const M=["Bedroom","Living Room","Kitchen","Bathroom","Foyer","Commercial"],z=["Beginner","Intermediate","Advanced","Factory Pro"],V=["draft","published","archived"],Y=({design:r,index:c,handleView:x,handleDelete:m,deletePending:n})=>e.jsxs("div",{className:"grid cursor-pointer grid-cols-12 gap-4 px-6 py-4 border-b border-gray-100 hover:bg-[#f9fcff] transition-colors items-center last:border-b-0",onClick:()=>x(r._id),children:[e.jsx("div",{className:"col-span-1 text-center text-gray-600 font-medium",children:c+1}),e.jsx("div",{className:"col-span-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium text-gray-900 truncate text-base",children:r.productName}),e.jsxs("span",{className:"text-xs text-gray-500 flex items-center gap-1 mt-1",children:[e.jsx("i",{className:"fas fa-user text-[10px] text-blue-500"})," ",r.designerName]})]})}),e.jsx("div",{className:"col-span-2",children:e.jsx("span",{className:"px-3 py-1 bg-indigo-50 text-indigo-700 rounded-md text-xs font-mono font-bold border border-indigo-100",children:r.designCode})}),e.jsxs("div",{className:"col-span-2 text-sm",children:[e.jsx("div",{className:"text-gray-800 font-medium",children:r.spaceType}),e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:r.difficultyLevel})]}),e.jsxs("div",{className:"col-span-2 text-gray-600 text-sm flex items-center",children:[e.jsx("i",{className:"fas fa-calendar-alt text-gray-400 mr-2"}),P(r.designDate)]}),e.jsx("div",{className:"col-span-1 flex justify-center gap-2",children:e.jsx(j,{variant:"ghost",size:"sm",onClick:a=>{a.stopPropagation(),m(r._id)},disabled:n,className:"text-red-500 hover:bg-red-50 h-8 w-8 p-0",title:"Delete Design",children:n?e.jsx("i",{className:"fas fa-spinner fa-spin"}):e.jsx("i",{className:"fas fa-trash"})})})]}),Z=()=>{const r=E(),c=T(),{organizationId:x}=B(),m=c.pathname.includes("/single")||c.pathname.includes("/create"),n=b.useRef(null),[a,i]=b.useState({search:"",spaceType:"",difficultyLevel:"",status:"",sortBy:"createdAt",sortOrder:"desc"}),D=R(a.search,700),{data:u,isLoading:L,isError:k,error:f,fetchNextPage:y,hasNextPage:g,isFetchingNextPage:h,refetch:C}=_({organizationId:x,filters:{...a,search:D}}),p=I();b.useEffect(()=>{const s=n.current;if(!s)return;const t=()=>{const{scrollTop:d,scrollHeight:l,clientHeight:F}=s;l-d-F<100&&g&&!h&&y()};return s.addEventListener("scroll",t),()=>s.removeEventListener("scroll",t)},[g,h,y]);const S=async s=>{var t,d;if(window.confirm("Are you sure you want to delete this design? This cannot be undone."))try{await p.mutateAsync(s),w({title:"Success",description:"Design deleted successfully"})}catch(l){w({title:"Error",description:((d=(t=l==null?void 0:l.response)==null?void 0:t.data)==null?void 0:d.message)||(l==null?void 0:l.message)||"Failed to delete design",variant:"destructive"})}},A=s=>{r(`single/${s}`)},v=()=>{i({search:"",spaceType:"",difficultyLevel:"",status:"",sortBy:"createdAt",sortOrder:"desc"})},o=Object.values(a).filter(s=>s!==""&&s!=="createdAt"&&s!=="desc").length,N=(u==null?void 0:u.pages.flatMap(s=>s.designLabs))||[];return m?e.jsx(O,{}):e.jsxs("div",{className:"space-y-0 h-full flex flex-col",children:[e.jsxs("header",{className:"flex justify-between items-center shrink-0 mb-4 px-1",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-layer-group mr-3 text-blue-600"}),"Design Lab"]}),e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Manage your design specifications"})]}),e.jsx("div",{className:"flex gap-3",children:e.jsxs(j,{onClick:()=>r("create"),className:"flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-plus"}),"Create Design"]})})]}),e.jsxs("main",{className:"flex gap-4 flex-1 overflow-hidden",children:[e.jsx("div",{className:"w-72 flex-shrink-0 h-full overflow-y-auto custom-scrollbar pb-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-5 border border-gray-200 h-full flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 shrink-0",children:[e.jsxs("h3",{className:"text-base font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-filter mr-2 text-blue-600"}),"Filters"]}),o>0&&e.jsxs("button",{onClick:v,className:"text-xs text-blue-600 hover:text-blue-800 font-semibold hover:underline",children:["Clear All (",o,")"]})]}),e.jsxs("div",{className:"space-y-5 overflow-y-auto flex-1 pr-1 custom-scrollbar",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-700 mb-1.5 uppercase tracking-wide",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx("i",{className:"fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-xs"}),e.jsx("input",{type:"text",placeholder:"Design name, code...",value:a.search,onChange:s=>i(t=>({...t,search:s.target.value})),className:"w-full pl-9 pr-3 py-2 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-700 mb-1.5 uppercase tracking-wide",children:"Space Type"}),e.jsxs("select",{value:a.spaceType,onChange:s=>i(t=>({...t,spaceType:s.target.value})),className:"w-full px-3 py-2 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none",children:[e.jsx("option",{value:"",children:"All Spaces"}),M.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-700 mb-1.5 uppercase tracking-wide",children:"Difficulty"}),e.jsxs("select",{value:a.difficultyLevel,onChange:s=>i(t=>({...t,difficultyLevel:s.target.value})),className:"w-full px-3 py-2 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none",children:[e.jsx("option",{value:"",children:"All Levels"}),z.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-700 mb-1.5 uppercase tracking-wide",children:"Status"}),e.jsxs("select",{value:a.status,onChange:s=>i(t=>({...t,status:s.target.value})),className:"w-full px-3 py-2 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none",children:[e.jsx("option",{value:"",children:"All Statuses"}),V.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-700 mb-1.5 uppercase tracking-wide",children:"Sort By"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("select",{value:a.sortBy,onChange:s=>i(t=>({...t,sortBy:s.target.value})),className:"col-span-2 w-full px-3 py-2 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none",children:[e.jsx("option",{value:"createdAt",children:"Created Date"}),e.jsx("option",{value:"designDate",children:"Design Date"}),e.jsx("option",{value:"productName",children:"Name"})]}),e.jsxs("select",{value:a.sortOrder,onChange:s=>i(t=>({...t,sortOrder:s.target.value})),className:"col-span-2 w-full px-3 py-2 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none",children:[e.jsx("option",{value:"desc",children:"Newest First"}),e.jsx("option",{value:"asc",children:"Oldest First"})]})]})]})]})]})}),e.jsx("div",{className:"flex-1 h-full overflow-hidden flex flex-col",children:L?e.jsx("div",{className:"flex-1 flex justify-center items-center bg-white rounded-xl border border-gray-200",children:e.jsxs("div",{className:"flex flex-col items-center gap-3 text-blue-600",children:[e.jsx("i",{className:"fas fa-spinner fa-spin text-4xl"}),e.jsx("p",{className:"text-sm font-medium",children:"Loading Designs..."})]})}):k?e.jsx("div",{className:"flex-1 flex justify-center items-start pt-10 bg-white rounded-xl border border-gray-200",children:e.jsxs("div",{className:"max-w-md w-full p-6 bg-red-50 border border-red-200 rounded-xl shadow-sm text-center",children:[e.jsxs("div",{className:"text-red-600 font-bold mb-2 text-xl flex items-center justify-center gap-2",children:[e.jsx("i",{className:"fas fa-exclamation-triangle"})," Error Occurred"]}),e.jsx("p",{className:"text-red-500 mb-6",children:(f==null?void 0:f.message)||"Failed to load designs. Please try again."}),e.jsx(j,{onClick:()=>C(),variant:"danger",children:"Retry"})]})}):N.length===0?e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center bg-white rounded-xl border border-gray-200 p-10 text-center shadow-sm",children:[e.jsx("div",{className:"bg-blue-50 p-6 rounded-full mb-6",children:e.jsx("i",{className:"fas fa-drafting-compass text-5xl text-blue-300"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"No Designs Found"}),e.jsx("p",{className:"text-gray-500 max-w-md mb-8",children:a.search||o>0?"We couldn’t find any designs matching your filters. Try adjusting or clearing them.":"Your design library is empty. Start by creating your first design specification."}),a.search||o>0?e.jsx("button",{onClick:v,className:"text-blue-600 font-medium hover:underline",children:"Clear all filters"}):null]}):e.jsxs("div",{ref:n,className:"flex-1 bg-white rounded-xl shadow-sm border border-gray-200 overflow-y-auto custom-scrollbar flex flex-col",children:[e.jsx("div",{className:"sticky top-0 z-10 bg-white border-b border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 px-6 py-3 bg-gray-50/80 backdrop-blur-sm font-semibold text-gray-700 text-xs uppercase tracking-wider",children:[e.jsx("div",{className:"col-span-1 text-center",children:"S.No"}),e.jsx("div",{className:"col-span-4",children:"Product / Designer"}),e.jsx("div",{className:"col-span-2",children:"Design Code"}),e.jsx("div",{className:"col-span-2",children:"Type / Level"}),e.jsx("div",{className:"col-span-2",children:"Date"}),e.jsx("div",{className:"col-span-1 text-center",children:"Actions"})]})}),e.jsx("div",{className:"flex-1",children:N.map((s,t)=>e.jsx(Y,{design:s,index:t,handleView:A,handleDelete:S,deletePending:p.isPending&&p.variables===s._id},s._id))}),e.jsx("div",{className:"py-6 text-center border-t border-gray-100 bg-gray-50/50 mt-auto shrink-0",children:h?e.jsxs("div",{className:"flex items-center justify-center gap-2 text-blue-600",children:[e.jsx("i",{className:"fas fa-spinner fa-spin"}),e.jsx("span",{className:"text-sm font-medium",children:"Loading more designs..."})]}):g?null:e.jsx("p",{className:"text-xs text-gray-400 font-medium uppercase tracking-wide",children:"— End of List —"})})]})})]})]})};export{Z as default};
