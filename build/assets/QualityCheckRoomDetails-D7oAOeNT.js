import{j as e,a as K,c as M,r as f}from"./index-CqEiDvr_.js";import{c as X,d as Y,e as Z,f as ee}from"./qualityCheckApi-KgDhAJWL.js";import{I as m}from"./Input-Bm6t9LQ8.js";import{S as F,a as D,b as P,c as _,d as V}from"./Select-bw0SngOl.js";import{t as x}from"./toast-BSC5QTk1.js";import{B as o}from"./Button-DzcQpMPj.js";import{S as d}from"./Skeleton-DMaf5_kG.js";import"./useQuery-DyvuN1xf.js";import"./useMutation-DDHgQq3T.js";import"./roleCheck-BJ07f95N.js";const se=()=>{const u=Array.from({length:11});return e.jsxs("div",{className:"w-full max-h-full overflow-hidden mx-auto mt-4 bg-white shadow rounded p-6",children:[e.jsx(d,{className:"h-6 w-40 mb-2"}),e.jsx(d,{className:"h-4 w-32 mb-6"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm border border-gray-200 rounded-lg",children:[e.jsx("thead",{children:e.jsx("tr",{className:"bg-gray-100 text-left",children:["Item","Quantity","Unit","Remarks","Actions"].map((n,h)=>e.jsx("th",{className:"p-3",children:e.jsx(d,{className:"h-4 w-20"})},h))})}),e.jsx("tbody",{children:u.map((n,h)=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-3",children:e.jsx(d,{className:"h-4 w-32"})}),e.jsx("td",{className:"p-3",children:e.jsx(d,{className:"h-4 w-12"})}),e.jsx("td",{className:"p-3",children:e.jsx(d,{className:"h-4 w-10"})}),e.jsx("td",{className:"p-3",children:e.jsx(d,{className:"h-4 w-16"})}),e.jsx("td",{className:"p-3",children:e.jsx(d,{className:"h-8 w-8 rounded-full"})})]},h))})]})})]})};function xe(){var A,E;const{roomName:u,projectId:n,organizationId:h}=K(),p=decodeURIComponent(u),Q=M(),[S,v]=f.useState(null),{data:b,isLoading:W,error:w,isError:L,refetch:g}=X(n,p),{mutateAsync:z,isPending:U}=Y(),{mutateAsync:B,isPending:G}=Z(),{mutateAsync:$,isPending:q}=ee(),[a,i]=f.useState({workName:"",status:"pending",remarks:"",file:void 0}),[k,j]=f.useState(!1),[y,C]=f.useState(null),I=(b==null?void 0:b.tasks)||[],O=async()=>{var s,l;try{if(!a.workName.trim())throw new Error("Work name is mandatory");const t=new FormData;t.append("workName",a.workName),t.append("status",a.status),a.remarks&&t.append("remarks",a.remarks),a.file&&t.append("file",a.file),await z({projectId:n,roomName:p,formData:t}),x({description:"Created successfully",title:"Success"}),N(),g()}catch(t){x({title:"Error",description:((l=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:l.message)||(t==null?void 0:t.message)||"Failed to create item",variant:"destructive"})}},T=async s=>{var l,t;try{if(!y)return;if(!a.workName.trim())throw new Error("Work name is mandatory");const r=new FormData;r.append("itemId",y),a.workName&&r.append("workName",a.workName),r.append("status",a.status),a.remarks&&r.append("remarks",a.remarks),a.file&&r.append("file",a.file),await B({projectId:n,roomName:p,formData:r,itemId:s},{onSuccess:()=>{N()}}),x({description:"Edited successfully",title:"Success"}),g()}catch(r){x({title:"Error",description:((t=(l=r==null?void 0:r.response)==null?void 0:l.data)==null?void 0:t.message)||(r==null?void 0:r.message)||"Failed to edit item",variant:"destructive"})}},H=async s=>{var l,t;try{await $({projectId:n,roomName:p,itemId:s}),x({description:"Deleted successfully",title:"Success"}),g()}catch(r){x({title:"Error",description:((t=(l=r==null?void 0:r.response)==null?void 0:l.data)==null?void 0:t.message)||r.message||"Failed to delete item",variant:"destructive"})}},N=()=>{i({workName:"",status:"pending",remarks:"",file:void 0}),j(!1),C(null)};return W?e.jsx(se,{}):(L&&((E=(A=w==null?void 0:w.response)==null?void 0:A.data)!=null&&E.message,o),e.jsxs("div",{className:"w-full h-full",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("h1",{className:"text-xl font-bold mb-4",children:["Room: ",u]}),e.jsx(o,{variant:"primary",className:"h-10",onClick:()=>Q(`/${h}/projectdetails/${n}/qualitycheck`),children:"Go Back"})]}),I.length===0&&!k?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("div",{className:"min-w-[900px] grid grid-cols-5 gap-2 font-semibold bg-blue-100 text-blue-900 p-2 rounded",children:[e.jsx("div",{className:"text-center",children:"Work Name"}),e.jsx("div",{className:"text-center",children:"Status"}),e.jsx("div",{className:"text-center",children:"Remarks"}),e.jsx("div",{className:"text-center",children:"Upload"}),e.jsx("div",{className:"text-center",children:"Actions"})]})}),e.jsxs("div",{className:"flex flex-col items-center justify-center p-12 shadow rounded-lg bg-white",children:[e.jsx("i",{className:"fas fa-check-double text-3xl text-blue-400 mb-2"}),e.jsx("p",{className:"text-blue-600 mb-4 text-sm",children:"No items added yet for this room."}),e.jsxs(o,{onClick:()=>j(!0),variant:"primary",children:[e.jsx("i",{className:"fas fa-plus mr-2"})," Add Item"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsxs("div",{className:"min-w-[900px]",children:[e.jsxs("div",{className:"grid grid-cols-5 text-blue-900 gap-2 font-semibold bg-blue-100 p-2 rounded-t",children:[e.jsx("div",{className:"text-center",children:"Work Name"}),e.jsx("div",{className:"text-center",children:"Status"}),e.jsx("div",{className:"text-center",children:"Remarks"}),e.jsx("div",{className:"text-center",children:"Upload"}),e.jsx("div",{className:"text-center",children:"Actions"})]}),e.jsx("div",{className:"overflow-y-auto relative z-[10] max-h-[70vh] sm:max-h-[75vh] md:max-h-[80vh] lg:max-h-[45vh] xl:max-h-[77vh]",children:I.map((s,l)=>{var t,r;return y===s._id?e.jsxs("div",{className:"grid grid-cols-5 gap-2 px-4 py-3 border-b border-gray-200 items-center bg-white",children:[e.jsx(m,{value:a.workName,placeholder:"Work Name",onChange:c=>i({...a,workName:c.target.value})}),e.jsx("div",{className:"relative z-50",children:e.jsxs(F,{value:a.status,onValueChange:c=>i({...a,status:c}),children:[e.jsx(D,{selectedValue:a.status,children:e.jsx(P,{selectedValue:a.status,placeholder:"Select status"})}),e.jsx(_,{children:["pass","fail","pending"].map(c=>e.jsx(V,{value:c,children:c},c))})]})}),e.jsx(m,{value:a.remarks,placeholder:"Remarks",onChange:c=>i({...a,remarks:c.target.value})}),e.jsx("div",{className:"flex flex-col items-center gap-1",children:e.jsx(m,{type:"file",accept:"image/*",onChange:c=>{var R;const J=(R=c.target.files)==null?void 0:R[0];i({...a,file:J})}})}),e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsxs(o,{variant:"primary",isLoading:G,onClick:()=>T(s._id),className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded",children:[e.jsx("i",{className:"fas fa-save mr-1"})," Save"]}),e.jsxs(o,{variant:"secondary",onClick:N,className:"bg-gray-400 text-white px-3 py-1 rounded",children:[e.jsx("i",{className:"fas fa-times mr-1"})," Cancel"]})]})]},s._id+l):e.jsxs("div",{className:"grid grid-cols-5 gap-2 px-4 py-3 border-b border-gray-200 items-center bg-white",children:[e.jsx("div",{className:"text-center",children:s.workName||"N/A"}),e.jsx("div",{className:"text-center",children:s.status||"N/A"}),e.jsx("div",{className:"text-center",children:s.remarks||"N/A"}),e.jsx("div",{className:"text-center",children:((t=s.upload)==null?void 0:t.type)==="image"?e.jsx("img",{src:s.upload.url,alt:"Preview",className:"w-10 h-10 object-cover rounded border cursor-pointer mx-auto",onClick:()=>v(s.upload.url)}):((r=s.upload)==null?void 0:r.type)==="pdf"?e.jsx("a",{href:s.upload.url,target:"_blank",rel:"noreferrer",className:"text-blue-600 underline",children:"View PDF"}):"No Image"}),e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsxs("button",{onClick:()=>{C(s._id),j(!1),i({workName:s.workName||"",status:s.status||"pending",remarks:s.remarks||"",file:void 0})},className:"bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded",children:[e.jsx("i",{className:"fas fa-edit mr-1"})," Edit"]}),e.jsxs(o,{variant:"danger",isLoading:q,onClick:()=>H(s._id),className:"bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded",children:[e.jsx("i",{className:"fas fa-trash mr-1"})," Delete"]})]})]},s._id+l)})}),k&&e.jsxs("div",{className:"grid grid-cols-5 gap-2 px-4 py-3 bg-white border-b border-gray-200 items-center",children:[e.jsx(m,{placeholder:"Work Name",value:a.workName,onChange:s=>i({...a,workName:s.target.value})}),e.jsxs(F,{value:a.status,onValueChange:s=>i({...a,status:s}),children:[e.jsx(D,{children:e.jsx(P,{selectedValue:a.status,placeholder:"Select status"})}),e.jsx(_,{children:["pass","fail","pending"].map(s=>e.jsx(V,{value:s,children:s},s))})]}),e.jsx(m,{placeholder:"Remarks",value:a.remarks,onChange:s=>i({...a,remarks:s.target.value})}),e.jsx("div",{className:"flex flex-col items-center gap-1",children:e.jsx(m,{type:"file",accept:"image/*",onChange:s=>{var t;const l=(t=s.target.files)==null?void 0:t[0];i({...a,file:l})}})}),e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsxs("button",{onClick:O,className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded",children:[e.jsx("i",{className:"fas fa-save mr-1"})," Save"]}),e.jsxs("button",{onClick:N,className:"bg-gray-400 text-white px-3 py-1 rounded",children:[e.jsx("i",{className:"fas fa-times mr-1"})," Cancel"]})]})]})]})}),!k&&I.length>0&&e.jsx("div",{className:"mt-4",children:e.jsxs(o,{isLoading:U,variant:"primary",onClick:()=>{j(!0),C(null),i({workName:"",status:"pending",remarks:"",file:void 0})},children:[e.jsx("i",{className:"fas fa-plus mr-2"})," Add Item"]})})]}),S&&e.jsx("div",{onClick:()=>v(null),className:"fixed inset-0 z-50 bg-black/70 bg-opacity-60 flex items-center justify-center",children:e.jsxs("div",{onClick:s=>s.stopPropagation(),className:"relative bg-white rounded p-4 max-w-[90vw] max-h-[80vh] shadow-lg",children:[e.jsx("i",{className:"fas fa-times absolute top-2 right-3 text-xl text-gray-700 hover:text-red-500 cursor-pointer",onClick:()=>v(null)}),e.jsx("img",{src:S,alt:"Full View",className:"max-h-[70vh] w-auto object-contain rounded"})]})})]}))}export{xe as default};
