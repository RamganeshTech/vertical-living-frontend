import{u as xe,a as fe,r as f,j as e}from"./index-e25x2Bps.js";import{C as ee,d as se,a as pe,b as he,c as ge}from"./Card-aggf0goj.js";import{I as ue}from"./Input-Rsb-PiAm.js";import{L as b}from"./Label-DWVJTy_f.js";import{B as M}from"./Badge-BaL8rOUG.js";import{B as n}from"./Button-KF95J_5e.js";import{t as m}from"./toast-BSC5QTk1.js";import{d as be,b as ve}from"./materialInventoryApi-EKQ8Djsd.js";import je from"./MaterialOverviewLoading-DKNIRPAu.js";import{S as ye}from"./SearchSelectNew-H9koZAAS.js";import{u as Ne}from"./projectApi-BbvOkph3.js";import{u as Ce,a as we,b as ke,c as Se}from"./MaterialInventoryCartApi-ClWCpvxB.js";import"./roleCheck-Do9EccPs.js";import"./useQuery-CvvWn2i9.js";import"./useMutation-D72r7dXD.js";import"./useInfiniteQuery-KHE7Ttgg.js";import"./Skeleton-xyLoHk1A.js";const Ge=()=>{var G,H,O,W,J,K,X;const{organizationId:N,id:v}=xe(),te=fe(),[h,C]=f.useState(!1),[i,g]=f.useState({}),[P,ae]=f.useState(null),[r,w]=f.useState(null),[x,L]=f.useState(""),{data:t,isLoading:ie,error:j,isError:re}=be(v),{data:o,refetch:k}=Ce({organizationId:N,projectId:x}),u=ve(),A=we(),S=ke(),I=Se();f.useEffect(()=>{var s,a;t!=null&&t.specification&&(g(t==null?void 0:t.specification),(s=t==null?void 0:t.specification)!=null&&s.variants&&((a=t==null?void 0:t.specification)==null?void 0:a.variants.length)>0&&w(t.specification.variants[0]))},[t]);const{data:y}=Ne(N),p=y==null?void 0:y.map(s=>({_id:s._id,projectName:s.projectName})),le=(G=y||[])==null?void 0:G.map(s=>({value:s._id,label:s.projectName}));f.useEffect(()=>{p&&p.length>0&&!x&&L(p[0]._id)},[p,x]),f.useEffect(()=>{var s,a;t!=null&&t.specification&&(g(t==null?void 0:t.specification),(s=t==null?void 0:t.specification)!=null&&s.variants&&((a=t==null?void 0:t.specification)==null?void 0:a.variants.length)>0&&w(t.specification.variants[0]))},[t]);const T=()=>{C(!0),t!=null&&t.specification&&g({...t.specification})},$=()=>{C(!1),t!=null&&t.specification&&g({...t.specification})},oe=s=>{g(a=>({...a,[s.target.name]:s.target.value}))},_=async()=>{var s,a;if(!(!v||!i))try{await u.mutateAsync({id:v,specification:i}),m({title:"✓ Updated",description:"Material inventory updated successfully",variant:"default"}),C(!1)}catch(l){m({title:"Error",description:((a=(s=l==null?void 0:l.response)==null?void 0:s.data)==null?void 0:a.message)||(l==null?void 0:l.message)||"something has went wrong",variant:"destructive"})}},B=s=>{w(s)},ce=()=>r?{image:r.image,mrp:r.mrp,itemCode:r.itemCode,color:r.color}:{image:i==null?void 0:i.image,mrp:i==null?void 0:i.mrp,itemCode:i==null?void 0:i.itemCode,color:null},F=()=>r?r.itemCode:(i==null?void 0:i.itemCode)||"",z=s=>!(o!=null&&o.items)||!s?null:o.items.find(a=>{var l;return((l=a==null?void 0:a.specification)==null?void 0:l.itemCode)===s}),ne=()=>{const s=F(),a=z(s);return a?a==null?void 0:a.quantity:0},de=()=>{const s={...i,variants:void 0};return r?{...s,itemCode:r.itemCode,mrp:r.mrp,color:r.color,image:r.image}:s},me=async()=>{var a,l;if(!x){m({title:"Error",description:"Please select a project first",variant:"destructive"});return}const s=de();try{await A.mutateAsync({organizationId:N,projectId:x,productId:v,quantity:1,specification:s}),m({title:"Success",description:`${i.description||"Item"} ${r?`(${r.color})`:""} added to cart`}),k()}catch(c){m({title:"Error",description:((l=(a=c==null?void 0:c.response)==null?void 0:a.data)==null?void 0:l.message)||"Failed to add item to cart",variant:"destructive"})}},Q=async s=>{var Y,Z;if(!(o!=null&&o._id))return;const a=F(),l=z(a);if(!l)return;const c=l.quantity+s;if(c<=0){R();return}try{await S.mutateAsync({cartId:o._id,itemCode:a,quantity:c}),m({title:"Success",description:"Cart updated successfully"}),k()}catch(E){m({title:"Error",description:((Z=(Y=E==null?void 0:E.response)==null?void 0:Y.data)==null?void 0:Z.message)||"Failed to update cart",variant:"destructive"})}},R=async()=>{var a,l;if(!(o!=null&&o._id))return;const s=F();try{await I.mutateAsync({cartId:o._id,itemCode:s}),m({title:"Success",description:"Item removed from cart",variant:"default"}),await k()}catch(c){m({title:"Error",description:((l=(a=c==null?void 0:c.response)==null?void 0:a.data)==null?void 0:l.message)||"Failed to remove item from cart",variant:"destructive"})}},d=ce(),V=(i==null?void 0:i.variants)&&((H=i==null?void 0:i.variants)==null?void 0:H.length)>0,U=ne(),q=U>0;if(ie)return e.jsx(je,{});if(re||P||j)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-violet-50 via-blue-50 to-white p-6 flex items-center justify-center",children:e.jsx("div",{className:"bg-red-50 border-2 border-red-200 text-red-700 rounded-2xl p-6 shadow-lg max-w-xl w-full",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx("i",{className:"fas fa-exclamation-triangle text-red-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Error Loading Data"}),e.jsx("p",{className:"text-sm text-red-600",children:P||(j==null?void 0:j.message)||"Failed to load data"})]})]}),e.jsx("button",{onClick:()=>ae(null),className:"text-red-400 hover:text-red-700 transition-colors",children:e.jsx("i",{className:"fas fa-times text-xl"})})]})})});if(!t)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-violet-50 via-blue-50 to-white flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-gray-400 py-12",children:[e.jsx("i",{className:"fas fa-box-open text-6xl mb-4"}),e.jsx("p",{className:"text-xl",children:"No data found"})]})});const D=(()=>{const s=[{key:"brand",label:"Brand",icon:"fa-trademark",type:"text"},{key:"category",label:"Category",icon:"fa-tag",type:"text"},{key:"description",label:"Description",icon:"fa-align-left",type:"text"}];return(i==null?void 0:i.category)==="light"?[...s,{key:"mrp",label:"MRP",icon:"fa-indian-rupee-sign",type:"number"},{key:"subcategory",label:"Sub Category",icon:"fa-tags",type:"text"},{key:"model",label:"Model",icon:"fa-cube",type:"text"},{key:"watt",label:"Watt",icon:"fa-bolt",type:"number"},{key:"itemCode",label:"Item Code",icon:"fa-barcode",type:"text"},{key:"cct",label:"CCT",icon:"fa-lightbulb",type:"text"},{key:"series",label:"Series",icon:"fa-layer-group",type:"text"}]:[...s,{key:"HSN",label:"HSN",icon:"fa-hashtag",type:"text"},{key:"styleType",label:"Style Type",icon:"fa-palette",type:"text"},{key:"type",label:"Type",icon:"fa-shapes",type:"text"},{key:"materialType",label:"Material Type",icon:"fa-cubes",type:"text"}]})();return e.jsx("div",{className:"max-h-full min-h-full overflow-y-auto bg-gradient-to-br from-violet-50 via-blue-50 to-white p-4",children:e.jsxs("div",{className:"max-w-full mx-auto",children:[e.jsxs("header",{className:"mb-4 flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("div",{onClick:()=>te(-1),className:"bg-white hover:bg-slate-300 flex items-center justify-between w-8 h-8 border border-[#a6aab8] text-sm cursor-pointer rounded-md px-2",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold bg-gradient-to-r from-violet-600 to-blue-600 bg-clip-text text-transparent",children:((O=t==null?void 0:t.specification)==null?void 0:O.subcategory)||((W=t==null?void 0:t.specification)==null?void 0:W.type)||"Material Details"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"View and manage material inventory information"})]})]}),e.jsx("div",{className:"flex gap-3",children:h?e.jsxs(e.Fragment,{children:[e.jsxs(n,{onClick:$,variant:"outline",className:"border-2 border-gray-300 hover:bg-gray-50",children:[e.jsx("i",{className:"fas fa-times mr-2"}),"Cancel"]}),e.jsx(n,{onClick:_,disabled:u.isPending,className:"bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white shadow-lg",children:u.isPending?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin mr-2"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-save mr-2"}),"Save Changes"]})})]}):e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-full sm:w-64",children:e.jsx(ye,{options:le,placeholder:"Select project",searchPlaceholder:"Search projects...",value:x||void 0,onValueChange:s=>L(s||""),searchBy:"name",displayFormat:"simple",className:"w-full"})}),e.jsxs(n,{onClick:T,className:"bg-gradient-to-r from-violet-600 to-blue-600 hover:from-violet-700 hover:to-blue-700 text-white shadow-lg",children:[e.jsx("i",{className:"fas fa-edit mr-2"}),"Edit Details"]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsx(ee,{className:"overflow-hidden border-2 border-violet-100 shadow-xl hover:shadow-2xl transition-shadow duration-300",children:e.jsxs(se,{className:"p-0",children:[d.image?e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:d.image,alt:d.itemCode||"Material",className:"w-full h-auto object-cover rounded-t-xl",onError:s=>{s.target.src="https://via.placeholder.com/400x400?text=No+Image"}}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/50 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 rounded-t-xl"})]}):e.jsx("div",{className:"bg-gradient-to-br from-violet-100 to-blue-100 h-80 flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-violet-300",children:[e.jsx("i",{className:"fas fa-image text-6xl mb-3"}),e.jsx("p",{className:"text-sm",children:"No Image Available"})]})}),V&&e.jsxs("div",{className:"p-4 bg-white border-b",children:[e.jsx(b,{className:"text-sm text-gray-600 mb-2 block",children:"Select Color Variant"}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:(J=i.variants)==null?void 0:J.map((s,a)=>e.jsx("button",{onClick:()=>B(s),className:`px-3 py-2 rounded-lg border-2 transition-all ${(r==null?void 0:r.color)===s.color?"border-violet-500 bg-violet-50 text-violet-700":"border-gray-300 hover:border-violet-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full border border-gray-300",style:{backgroundColor:s.color.toLowerCase()==="white"?"#ffffff":s.color.toLowerCase()==="gold"?"#FFD700":s.color.toLowerCase()==="grey"?"#808080":s.color}}),e.jsx("span",{className:"capitalize text-sm",children:s.color})]})},a))})]}),e.jsx("div",{className:"p-6 bg-gradient-to-br from-violet-50 to-blue-50",children:e.jsxs("div",{className:"space-y-4",children:[d.mrp&&e.jsx("div",{children:e.jsxs("p",{className:"text-2xl font-bold text-gray-900 mb-3",children:["₹",d.mrp,e.jsx("span",{className:"text-xs font-normal text-gray-500 ml-2",children:"MRP"})]})}),e.jsxs("div",{className:"space-y-2 text-sm",children:[(i==null?void 0:i.category)&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(b,{className:"text-gray-500",children:"Category"}),e.jsx(M,{variant:"default",children:i.category})]}),d.itemCode&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(b,{className:"text-gray-500",children:"Code"}),e.jsx(M,{variant:"success",className:"font-mono",children:d.itemCode})]}),d.color&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(b,{className:"text-gray-500",children:"Color"}),e.jsx(M,{variant:"outline",className:"capitalize",children:d.color})]})]}),e.jsxs("div",{className:"pt-4 border-t border-violet-200",children:[q?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between bg-white rounded-lg p-2",children:[e.jsx(n,{size:"sm",variant:"outline",onClick:()=>Q(-1),disabled:S.isPending||I.isPending,className:"h-8 w-8 p-0",children:e.jsx("i",{className:"fas fa-minus"})}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Quantity"}),e.jsx("span",{className:"font-bold text-lg",children:U})]}),e.jsx(n,{size:"sm",variant:"outline",onClick:()=>Q(1),disabled:S.isPending,className:"h-8 w-8 p-0",children:e.jsx("i",{className:"fas fa-plus"})})]}),e.jsxs(n,{variant:"danger",size:"sm",className:"w-full bg-red-600 text-white",onClick:R,isLoading:I.isPending,children:[e.jsx("i",{className:"fas fa-trash mr-2"}),"Remove from Cart"]})]}):e.jsxs(n,{className:"w-full bg-gradient-to-r from-violet-600 to-blue-600 hover:from-violet-700 hover:to-blue-700 text-white",onClick:me,disabled:!x,isLoading:A.isPending,children:[e.jsx("i",{className:"fas fa-shopping-cart mr-2"}),"Add to Cart"]}),q&&e.jsx("div",{className:"mt-3 p-2 bg-green-50 rounded-lg",children:e.jsxs("p",{className:"text-xs text-green-700 text-center",children:[e.jsx("i",{className:"fas fa-check-circle mr-1"}),"Item in cart for ",(K=p==null?void 0:p.find(s=>s._id===x))==null?void 0:K.projectName]})})]})]})})]})})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(ee,{className:"border-2 border-violet-100 shadow-xl",children:[e.jsxs(pe,{className:"bg-gradient-to-r from-violet-50 to-blue-50 border-b-2 border-violet-100",children:[e.jsxs(he,{className:"text-2xl text-violet-700 flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-info-circle"}),"Specifications"]}),e.jsx(ge,{children:h?"Edit material specifications below":"Detailed material information"})]}),e.jsxs(se,{className:"p-6",children:[h?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:D.map(s=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs(b,{htmlFor:s.key,className:"flex items-center gap-2 text-violet-700",children:[e.jsx("i",{className:`fas ${s.icon} text-sm`}),s.label]}),e.jsx(ue,{id:s.key,name:s.key,type:s.type,value:i[s.key]||"",onChange:oe,placeholder:`Enter ${s.label.toLowerCase()}`,className:"transition-all duration-200 hover:border-violet-300"})]},s.key))}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:D.map(s=>{if(s.key==="Variant")return null;const a=i[s==null?void 0:s.key];return a?e.jsx("div",{className:"bg-gradient-to-br from-white to-violet-50 p-4 rounded-xl border border-violet-100 hover:shadow-md transition-all duration-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-violet-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx("i",{className:`fas ${s.icon} text-violet-600`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wider mb-1",children:s.label}),e.jsx("p",{className:"text-gray-900 font-semibold truncate",children:s.key==="mrp"?`₹${a}`:s.key==="watt"?`${a}W`:a})]})]})},s.key):null})}),!h&&V&&e.jsxs("div",{className:"mt-8 pt-6 border-t-2 border-violet-100",children:[e.jsxs("h3",{className:"text-lg font-semibold text-violet-700 mb-4 flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-palette"}),"Available Variants"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:(X=i.variants)==null?void 0:X.map((s,a)=>e.jsxs("div",{className:`p-4 rounded-xl border-2 cursor-pointer transition-all ${(r==null?void 0:r.color)===s.color?"border-violet-500 bg-violet-50":"border-gray-200 hover:border-violet-300"}`,onClick:()=>B(s),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full border-2 border-gray-300",style:{backgroundColor:s.color.toLowerCase()==="white"?"#ffffff":s.color.toLowerCase()==="gold"?"#FFD700":s.color.toLowerCase()==="grey"?"#808080":s.color}}),e.jsx("span",{className:"font-semibold capitalize",children:s.color})]}),(r==null?void 0:r.color)===s.color&&e.jsx("i",{className:"fas fa-check-circle text-violet-600"})]}),e.jsx("p",{className:"text-sm text-gray-600 font-mono",children:s.itemCode}),e.jsxs("p",{className:"text-lg font-bold text-gray-900 mt-1",children:["₹",s.mrp]})]},a))})]}),!h&&Object.keys(i).filter(s=>s!=="image"&&s!=="variants").length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-20 h-20 bg-violet-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("i",{className:"fas fa-inbox text-3xl text-violet-400"})}),e.jsx("p",{className:"text-gray-500",children:"No specifications available"}),e.jsxs(n,{onClick:T,className:"mt-4 bg-violet-600 hover:bg-violet-700 text-white",children:[e.jsx("i",{className:"fas fa-plus mr-2"}),"Add Specifications"]})]})]})]})})]}),h&&e.jsx("div",{className:"mt-8 lg:hidden",children:e.jsx("div",{className:"bg-white border-2 border-violet-100 rounded-xl p-4 shadow-xl",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(n,{onClick:$,variant:"outline",className:"flex-1 border-2 border-gray-300 hover:bg-gray-50",children:[e.jsx("i",{className:"fas fa-times mr-2"}),"Cancel"]}),e.jsx(n,{onClick:_,disabled:u.isPending,className:"flex-1 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white shadow-lg",children:u.isPending?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin mr-2"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-save mr-2"}),"Save"]})})]})})})]})})};export{Ge as default};
