import{r as p,j as e,u as U,a as A,O as L}from"./index-BYTWf4fI.js";import{u as O,a as P,b as E}from"./orgApi-VeoGq5KB.js";import{B as u}from"./Button-aRmNljle.js";import{B as F}from"./Badge-Dg2X0lKe.js";import{u as R}from"./projectApi-DD4NsQCs.js";import{t as N}from"./toast-BSC5QTk1.js";import{L as h}from"./Label-BupV_v2u.js";import{D as T,a as B,b as M}from"./Dialog-Cr3pCY4f.js";import{I as j}from"./Input-ChgExZu6.js";import"./useQuery-DFVFWtWl.js";import"./useMutation-sTZCeqmg.js";import"./roleCheck-DhBlwT6t.js";const _=({isOpen:d,onClose:f,organizationId:o})=>{const[x,y]=p.useState("staff"),[r,n]=p.useState({name:"",email:"",phoneNo:"",password:""}),{mutateAsync:a,isPending:i}=O(),{data:v}=R(o),g=async l=>{l.preventDefault();const w={name:r.name,email:r.email,phoneNo:r.phoneNo,password:r.password,organizationId:[o]};try{await a({organizationId:o,roleToCreate:x,payload:w}),N({title:"Success",description:`${x.toUpperCase()} created successfully`})}catch(c){N({title:"Error",description:c.response.data.message||(c==null?void 0:c.message)||"Failed to create",variant:"destructive"})}};return e.jsx(T,{open:d,onOpenChange:f,children:e.jsxs(B,{className:"max-w-xl p-0 overflow-hidden rounded-2xl bg-white shadow-2xl border border-gray-100",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 px-6 py-4",children:[e.jsxs(M,{className:"text-white text-xl font-bold flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-user-plus bg-white/20 p-2 rounded-lg"}),"Create New User"]}),e.jsx("p",{className:"text-blue-100 text-xs mt-1",children:"Add a new member to your organization"})]}),e.jsx("div",{className:"p-6",children:e.jsxs("form",{onSubmit:g,className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx(h,{className:"mb-2 block text-xs uppercase tracking-wide text-gray-500",children:"Assign Role"}),e.jsxs("div",{className:"relative",children:[e.jsx("i",{className:"fas fa-briefcase absolute left-3 top-3 text-gray-400 z-10"}),e.jsxs("select",{className:"w-full pl-10 pr-4 py-2.5 border border-blue-200 rounded-xl bg-blue-50/30 focus:ring-2 focus:ring-blue-200 focus:border-blue-500 outline-none transition-all cursor-pointer font-medium text-gray-700",value:x,onChange:l=>y(l.target.value),children:[e.jsx("option",{value:"staff",children:"staff"}),e.jsx("option",{value:"worker",children:"worker"}),e.jsx("option",{value:"client",children:"client"}),e.jsx("option",{value:"CTO",children:"CTO"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{className:"mb-1.5 block",children:"Full Name"}),e.jsx(j,{required:!0,placeholder:"e.g. John Doe",value:r.name,onChange:l=>n({...r,name:l.target.value})})]}),e.jsxs("div",{children:[e.jsx(h,{className:"mb-1.5 block",children:"Email Address"}),e.jsx(j,{required:!0,type:"email",placeholder:"john@example.com",value:r.email,onChange:l=>n({...r,email:l.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{className:"mb-1.5 block",children:"Phone Number"}),e.jsx(j,{maxLength:10,type:"text",placeholder:"+91 98765 43210",value:r.phoneNo,onChange:l=>n({...r,phoneNo:l.target.value})})]}),e.jsxs("div",{children:[e.jsx(h,{className:"mb-1.5 block",children:"Set Password"}),e.jsx(j,{required:!0,type:"password",placeholder:"••••••••",value:r.password,onChange:l=>n({...r,password:l.target.value})})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx(u,{type:"button",variant:"secondary",onClick:f,className:"  text-gray-700 border border-gray-300 shadow-sm",children:"Cancel"}),e.jsxs(u,{type:"submit",isLoading:i,className:"bg-blue-600 hover:bg-blue-700 text-white shadow-md shadow-blue-200",children:[e.jsx("i",{className:"fas fa-check mr-2"})," Create User"]})]})]})})]})})},Z=()=>{const{organizationId:d}=U(),f=A(),{data:o=[],isLoading:x,isError:y,refetch:r}=P(d),{mutateAsync:n}=E(),[a,i]=p.useState({search:"",role:"",email:"",phone:""}),[v,g]=p.useState(!1),l=p.useMemo(()=>o.filter(s=>{var C,k,D;const t=a.search?(C=s.name)==null?void 0:C.toLowerCase().includes(a.search.toLowerCase()):!0,b=a.role?s.role===a.role:!0,m=a.email?(k=s.email)==null?void 0:k.toLowerCase().includes(a.email.toLowerCase()):!0,S=a.phone?(D=s.phoneNo)==null?void 0:D.includes(a.phone):!0;return t&&b&&m&&S}),[o,a]),w=async s=>{var t,b;try{await n({userId:s,organizationId:d}),N({title:"Success",description:"deleted successfully"})}catch(m){N({title:"Error",description:((b=(t=m==null?void 0:m.response)==null?void 0:t.data)==null?void 0:b.message)||"failed to delete",variant:"destructive"})}},c=()=>i({search:"",role:"",email:"",phone:""});return location.pathname.includes("/roles")?e.jsx(L,{}):e.jsxs("div",{className:"h-full flex flex-col bg-gray-50/50 overflow-hidden",children:[e.jsxs("header",{className:"flex justify-between items-center bg-white border-b border-gray-200 px-6 py-4 flex-shrink-0",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-users-cog mr-3 text-blue-600"}),"User Management"]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Manage Staff, Workers, Clients and their permissions."})]}),e.jsx("div",{className:"gap-2 flex items-center",children:e.jsxs(u,{onClick:()=>g(!0),className:"bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx("i",{className:"fas fa-user-plus mr-2"})," Create User"]})})]}),x?e.jsxs("div",{className:"flex flex-1 items-center justify-center text-gray-500",children:[e.jsx("i",{className:"fas fa-spinner fa-spin mr-2 text-2xl"})," Loading Users..."]}):y?e.jsxs("div",{className:"p-6 text-center text-red-500",children:["Failed to load users. ",e.jsx("button",{onClick:()=>r(),className:"underline",children:"Retry"})]}):e.jsxs("main",{className:"flex flex-col xl:flex-row flex-1 overflow-hidden",children:[e.jsxs("div",{className:"xl:w-80 w-full xl:border-r border-gray-200 bg-white overflow-y-auto p-4 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-md font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-filter mr-2 text-blue-600"})," Filters"]}),e.jsx("button",{onClick:c,className:"text-xs text-blue-600 hover:underline font-medium",children:"Clear All"})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"Name / General"}),e.jsxs("div",{className:"relative",children:[e.jsx("i",{className:"fas fa-search absolute left-3 top-2.5 text-gray-400 text-xs"}),e.jsx("input",{type:"text",placeholder:"Search by Name...",value:a.search,onChange:s=>i(t=>({...t,search:s.target.value})),className:"w-full pl-8 pr-3 py-2 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500 outline-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"Role"}),e.jsxs("select",{value:a.role,onChange:s=>i(t=>({...t,role:s.target.value})),className:"w-full px-2 py-2 border border-gray-300 rounded text-sm outline-none bg-white",children:[e.jsx("option",{value:"",children:"All Roles"}),e.jsx("option",{value:"staff",children:"Staff"}),e.jsx("option",{value:"worker",children:"Worker"}),e.jsx("option",{value:"client",children:"Client"}),e.jsx("option",{value:"CTO",children:"CTO"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"Email"}),e.jsx("input",{type:"text",placeholder:"Filter by Email",value:a.email,onChange:s=>i(t=>({...t,email:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded text-sm outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"Phone No"}),e.jsx("input",{type:"text",placeholder:"Filter by Phone",value:a.phone,onChange:s=>i(t=>({...t,phone:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded text-sm outline-none"})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-6",children:e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Name / Role"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Contact"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Joined"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:l.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-6 py-10 text-center text-gray-500",children:"No users found matching your filters."})}):l.map(s=>{var t;return e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 font-bold",children:(t=s.name)==null?void 0:t.charAt(0).toUpperCase()}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.name}),e.jsx(F,{className:`text-[10px] px-2 py-0.5 rounded-full uppercase
                                                                ${s.role==="CTO"?"bg-purple-100 text-purple-800":s.role==="staff"?"bg-blue-100 text-blue-800":s.role==="worker"?"bg-orange-100 text-orange-800":"bg-green-100 text-green-800"}`,children:s.role})]})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsxs("div",{className:"text-sm text-gray-900",children:[e.jsx("i",{className:"far fa-envelope text-gray-400 mr-2"}),s.email]}),s.phoneNo&&e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:[e.jsx("i",{className:"fas fa-phone text-gray-400 mr-2"}),s.phoneNo]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(s.createdAt).toLocaleDateString()}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-center text-sm font-medium",children:[e.jsxs(u,{onClick:()=>f(`roles/${s._id}`),variant:"ghost",className:"text-blue-600 hover:text-blue-900 mr-3",children:[e.jsx("i",{className:"fas fa-lock mr-1"})," Perms"]}),e.jsx(u,{onClick:()=>w(s._id),variant:"ghost",className:"text-red-600 hover:text-red-900",children:e.jsx("i",{className:"fas fa-trash"})})]})]},s._id)})})]})})})]}),v&&e.jsx("div",{children:e.jsx(_,{isOpen:v,onClose:()=>g(!1),organizationId:d})})]})};export{Z as default};
