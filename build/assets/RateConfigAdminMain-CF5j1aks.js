import{u as O,a as _,e as B,b as G,r as h,j as e,O as H}from"./index-BZjlY-2Z.js";import{I as b}from"./Input-BDSEJtPI.js";import{t as n}from"./toast-BSC5QTk1.js";import{B as d}from"./Button-BGBzZFjk.js";import{u as T,a as V,b as $}from"./rateConfigApi-BKhxJjj3.js";import{C as J,a as K}from"./Card-CmzT6E3j.js";import{D as Q,a as U,c as W,b as X}from"./Dialog-DHg4IVRV.js";import{S as Y}from"./StageGuide-BGPpzdDF.js";import"./useQuery-Coz1VCY2.js";import"./useMutation-BRRIqsxx.js";import"./roleCheck-DuKNZHKs.js";function de(){var C,v,N;const{organizationId:c}=O(),w=_(),k=B(),{role:m,permission:l}=G(),D=m==="owner"||((C=l==null?void 0:l.materialquote)==null?void 0:C.list),F=m==="owner"||((v=l==null?void 0:l.materialquote)==null?void 0:v.create),S=m==="owner"||((N=l==null?void 0:l.materialquote)==null?void 0:N.delete),q=k.pathname.includes("single"),[g,f]=h.useState(""),[o,u]=h.useState([{key:"",type:"string",required:!1}]),[A,x]=h.useState(!1),{data:r,isLoading:p,refetch:y}=T(c),{mutateAsync:E,isPending:L}=V(),{mutateAsync:P,isPending:z}=$(),M=()=>{u([...o,{key:"",type:"string",required:!1}])},j=(s,t,a)=>{const i=[...o];i[s][t]=a,u(i)},R=async()=>{var s,t;try{if(!c||!g||o.length===0)return n({title:"Error",description:"Category name and fields are required",variant:"destructive"});const a=o.filter(i=>i.key.trim()!=="");if(a.length===0)return n({title:"Error",description:"Please enter valid field keys",variant:"destructive"});await E({organizationId:c,name:g,fields:a}),f(""),u([{key:"",type:"string",required:!1}]),x(!1),y(),n({title:"Success",description:"Category Created Successfully"})}catch(a){n({title:"Error",description:((t=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:t.message)||(a==null?void 0:a.message)||"failed to create category",variant:"destructive"})}},I=s=>{var t,a;try{P({categoryId:s,organizationId:c}),y(),n({title:"Success",description:"Category Deleted Successfully"})}catch(i){n({title:"Error",description:((a=(t=i==null?void 0:i.response)==null?void 0:t.data)==null?void 0:a.message)||(i==null?void 0:i.message)||"failed to delete category",variant:"destructive"})}};return q?e.jsx(H,{}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("header",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-cubes mr-3 text-blue-600"}),"Rate Configuration Materials"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your organization's material categories and configurable fields"})]}),e.jsxs("section",{className:"flex  gap-3 items-center",children:[F&&e.jsx("div",{children:e.jsx(d,{onClick:()=>x(!0),children:"Create New Category"})}),e.jsx("div",{className:"w-full sm:w-auto flex justify-end sm:block",children:e.jsx(Y,{organizationId:c,stageName:"materialquote"})})]})]}),e.jsx(Q,{open:A,onOpenChange:x,children:e.jsxs(U,{className:"px-5 py-6",children:[e.jsx(W,{className:"px-0 py-0",children:e.jsx(X,{children:"Create New Material Category"})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(b,{placeholder:"Category name (e.g. Plywood)",value:g,onChange:s=>f(s.target.value)}),e.jsx("h4",{className:"text-base font-semibold",children:"Define Fields"}),e.jsx("div",{className:"space-y-2",children:o.map((s,t)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(b,{placeholder:"Field key (e.g: brand, sqft/rate, notes)",value:s.key,onChange:a=>j(t,"key",a.target.value),className:"flex-1"}),e.jsxs("select",{value:s.type,onChange:a=>j(t,"type",a.target.value),className:"  px-2 py-2 rounded-xl border border-blue-200 focus:border-blue-200 active:border-blue-200",children:[e.jsx("option",{value:"string",children:"text"}),e.jsx("option",{value:"number",children:"number"})]})]},t))}),e.jsxs("div",{className:"flex justify-between pt-2",children:[e.jsx(d,{variant:"secondary",onClick:M,children:"+ Add Field"}),e.jsx(d,{isLoading:L,onClick:R,children:"Create Category"})]})]})]})}),D&&e.jsxs("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[p&&e.jsx("p",{children:"Loading categories..."}),!p&&(r==null?void 0:r.length)===0&&e.jsx("p",{className:"text-gray-500",children:"No categories found"}),r==null?void 0:r.map(s=>e.jsx(J,{className:"w-full border-l-4 border-blue-600 shadow-md bg-white hover:shadow-lg transition-all",children:e.jsxs(K,{className:"p-4 space-y-2",children:[e.jsx("h3",{className:"text-base font-bold text-blue-700 mb-2",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-600 capitalize",children:["Fields:"," ",e.jsx("strong",{children:s.fields.map(t=>t.key).join(", ")})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsxs(d,{size:"sm",variant:"secondary",onClick:()=>w(`single/${s._id}`),children:[e.jsx("i",{className:"fas fa-eye mr-1"}),"View"]}),S&&e.jsxs(d,{size:"sm",isLoading:z,variant:"danger",className:"bg-red-600 text-white",onClick:()=>I(s._id),children:[e.jsx("i",{className:"fas fa-trash mr-1"}),"Delete"]})]})]})},s._id))]})]})}export{de as default};
