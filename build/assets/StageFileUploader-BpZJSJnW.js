import{r as W,b as B,j as e}from"./index-Dkf7SbMA.js";import{B as N}from"./Button-ClgICMLF.js";import{I as C}from"./Input-BRDEoxOp.js";import{t as r}from"./toast-BSC5QTk1.js";import{d as D}from"./downloadFile-C340hrAB.js";import{r as P}from"./index-CwzFm0RL.js";import{I as R}from"./ImageGalleryMain-DWzO9-7s.js";import{V as T}from"./VideoGalleryMain-eg9UTPFx.js";const Q=({enableUpload:z,formId:n,autoUpload:o,projectId:d,refetch:m,existingUploads:x=[],onUploadComplete:i,uploadFilesMutate:b,uploadPending:w,onDeleteUpload:h,deleteFilePending:F})=>{var V;const[k,u]=W.useState([]),[S,I]=W.useState(null),{role:E,permission:g}=B(),p=E==="owner"||((V=g==null?void 0:g.clientrequirement)==null?void 0:V.delete),L=s=>{if(s.target.files){u(Array.from(s.target.files));const a=Array.from(s.target.files||[]);o&&a.length>0&&(async()=>{var t,l;try{await b({formId:n,files:a,projectId:d}),r({title:"Success",description:"Files uploaded successfully."}),u([]),i==null||i()}catch(v){r({title:"Upload Failed",description:((l=(t=v==null?void 0:v.response)==null?void 0:t.data)==null?void 0:l.message)||"Try again later.",variant:"destructive"})}})()}},A=async()=>{var s,a;if(!(!n||k.length===0))try{await b({formId:n,files:k,projectId:d}),r({title:"Success",description:"Files uploaded successfully."}),u([]),i==null||i()}catch(t){r({title:"Upload Failed",description:((a=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:a.message)||"Try again later.",variant:"destructive"})}},f=async s=>{var a,t;try{await(h==null?void 0:h({fileId:s,projectId:d})),r({title:"Success",description:"Files Deleted successfully."}),m()}catch(l){r({title:"Upload Failed",description:((t=(a=l==null?void 0:l.response)==null?void 0:a.data)==null?void 0:t.message)||"Try again later.",variant:"destructive"})}},c=x.filter(s=>s.type==="pdf"),j=x.filter(s=>s.type==="image"),y=x.filter(s=>s.type==="video");return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-blue-700",children:"Common Uploads"}),e.jsx("div",{className:"flex gap-4 items-center relative",children:z&&e.jsxs(e.Fragment,{children:[e.jsx(C,{type:"file",multiple:!0,onChange:L,accept:"image/jpeg,image/png,application/pdf,video/*"}),!o&&e.jsx(N,{onClick:A,isLoading:w,className:"bg-blue-600 text-white",children:"Upload"}),o&&w&&e.jsx("div",{className:"absolute inset-y-0 right-2 flex items-center",children:e.jsxs("svg",{className:"animate-spin h-5 w-5 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4l3.5-3.5L12 0v4a8 8 0 100 16v4l3.5-3.5L12 20v-4a8 8 0 01-8-8z"})]})})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 pt-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-blue-800 mb-2",children:"ðŸ“„ PDF Files"}),e.jsxs("ul",{className:"space-y-2 max-h-[180px]  rounded-lg  border-2 border-[#5e5f612a] max-w-[100%] overflow-x-hidden custom-scrollbar overflow-y-auto ",children:[c.length===0&&e.jsx("div",{className:"min-h-[145px]   flex items-center justify-center",children:e.jsx("p",{className:"text-sm text-gray-500",children:"No PDFs uploaded."})}),c==null?void 0:c.map((s,a)=>e.jsxs("li",{className:"flex justify-between items-center  bg-blue-50 p-2 rounded-xl",children:[e.jsx("span",{className:"truncate whitespace-wrap max-w-[100%]",children:s.originalName}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(N,{onClick:()=>D({src:s==null?void 0:s.url,alt:(s==null?void 0:s.originalName)||"file.pdf"}),size:"sm",className:"text-sm",children:e.jsx("i",{className:"fa-solid fa-download"})}),p&&e.jsx(N,{size:"sm",isLoading:F,onClick:()=>f(s==null?void 0:s._id),className:"text-green-600 text-sm",children:e.jsx("i",{className:"fa-solid fa-trash-can"})})]})]},a))]})]}),e.jsxs("div",{className:"overflow-y-auto",children:[e.jsx("h4",{className:"font-semibold text-blue-800 mb-2",children:"ðŸ–¼ï¸ Image Files"}),e.jsxs("ul",{className:"space-y-2  max-h-[180px] rounded-lg border-2 border-[#5e5f612a] max-w-[100%] overflow-x-hidden custom-scrollbar overflow-y-auto custom-scrollbar",children:[j.length===0&&e.jsx("div",{className:"min-h-[145px]  flex items-center justify-center",children:e.jsx("p",{className:"text-sm text-gray-500",children:"No Images uploaded."})}),j.length>0&&e.jsx(R,{imageFiles:j,refetch:m,height:80,minWidth:98,maxWidth:100,...p?{handleDeleteFile:f}:{}})]})]}),e.jsxs("div",{className:"overflow-y-auto",children:[e.jsx("h4",{className:"font-semibold text-blue-800 mb-2",children:"ðŸŽ¥ Video Files"}),e.jsxs("ul",{className:"space-y-2 max-h-[180px] rounded-lg border-2 border-[#5e5f612a] max-w-[100%] overflow-x-hidden custom-scrollbar overflow-y-auto",children:[y.length===0&&e.jsx("div",{className:"min-h-[145px] flex items-center justify-center",children:e.jsx("p",{className:"text-sm text-gray-500",children:"No Videos uploaded."})}),y.length>0&&e.jsx(T,{videoFiles:y,refetch:m,isDeleting:F,height:80,minWidth:98,maxWidth:100,...p?{handleDeleteFile:f}:{}})]})]})]}),S&&P.createPortal(e.jsx("div",{onClick:()=>I(null),className:"fixed inset-0  bg-black/70 z-50 p-8 bg-opacity-60 flex items-center justify-center",children:e.jsxs("div",{onClick:s=>s.stopPropagation(),className:"relative bg-white rounded py-8 px-4 max-w-[90vw] max-h-[80vh] shadow-lg",children:[e.jsx("i",{className:"fas fa-times absolute top-2 right-3 text-xl text-gray-700 hover:text-red-500 cursor-pointer",onClick:()=>I(null)}),e.jsx("img",{src:S,alt:"Full View",className:"max-h-[70vh] w-auto object-contain rounded"})]})}),document.body)]})};export{Q as R};
