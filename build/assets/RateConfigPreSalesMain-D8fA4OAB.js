import{u as te,a as se,d as ae,k as ie,r as u,e as le,l as ne,m as re,j as e,O as ce,B as p,t as c}from"./index-BAM0eJUz.js";import{I as R}from"./Input-1UBXZqEj.js";import{C as oe,a as de}from"./Card-CdxfjEr-.js";import{D as ue,a as me,b as xe,c as pe}from"./Dialog-BXW_mCpu.js";import{S as he}from"./StageGuide-e28gQ0h1.js";import{u as fe}from"./preSalesRateConfigApi-Vik7-ELc.js";function we(){var F,E,P;const{organizationId:m}=te(),z=se(),L=ae(),{role:y,permission:r}=ie(),$=y==="owner"||((F=r==null?void 0:r.presalesmaterialrateconfig)==null?void 0:F.list),M=y==="owner"||((E=r==null?void 0:r.presalesmaterialrateconfig)==null?void 0:E.create),O=y==="owner"||((P=r==null?void 0:r.presalesmaterialrateconfig)==null?void 0:P.delete),[h,C]=u.useState(null),N=u.useRef(null);u.useEffect(()=>{function t(s){N.current&&!N.current.contains(s.target)&&C(null)}return document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[h]);const T=(t,s)=>{const a=[...n],i=a[t].visibleIn||[];i.includes(s)?a[t].visibleIn=i.filter(v=>v!==s):a[t].visibleIn=[...i,s],o(a)},V=t=>{const s=[...n],a=s[t].visibleIn||[];a.includes("materials")&&a.includes("presales")?s[t].visibleIn=[]:s[t].visibleIn=["materials","presales"],o(s)},_=L.pathname.includes("single"),[f,g]=u.useState(""),[n,o]=u.useState([{key:"",type:"string",required:!1,visibleIn:[]}]),[U,b]=u.useState(!1),[j,G]=u.useState(!1),[d,w]=u.useState(null),{data:x,isLoading:k,refetch:I}=le(m),{mutateAsync:B,isPending:H}=ne(),{mutateAsync:K,isPending:S}=re(),{mutateAsync:W,isPending:J}=fe(),Q=()=>{o([...n,{key:"",type:"string",required:!1,visibleIn:[]}])},X=t=>{if(n.length>1){const s=n.filter((a,i)=>i!==t);o(s)}else c({title:"Note",description:"At least one field is required"})},D=(t,s,a)=>{const i=[...n];i[t][s]=a,o(i)},Y=async()=>{var t,s;try{if(d){if(!m||n.length===0)return c({title:"Error",description:"Category name and fields are required",variant:"destructive"})}else if(!m||!f||n.length===0)return c({title:"Error",description:"Category name and fields are required",variant:"destructive"});const a=n.filter(i=>i.key.trim()!=="");if(a.length===0)return c({title:"Error",description:"Please enter valid field keys",variant:"destructive"});d?(await W({organizationId:m,categoryId:d,name:f,fields:a,isProductSpecific:j}),c({title:"Success",description:"Category Updated Successfully"})):(await B({organizationId:m,name:f,fields:a,isProductSpecific:j}),c({title:"Success",description:"Category Created Successfully"})),w(null),g(""),o([{key:"",type:"string",required:!1,visibleIn:[]}]),b(!1),I()}catch(a){c({title:"Error",description:((s=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:s.message)||(a==null?void 0:a.message)||"failed to create category",variant:"destructive"})}},Z=t=>{var s,a;try{if(!window.confirm("Are you sure you want to delete this category? This action cannot be undone."))return;K({categoryId:t,organizationId:m}),I(),c({title:"Success",description:"Category Deleted Successfully"})}catch(i){c({title:"Error",description:((a=(s=i==null?void 0:i.response)==null?void 0:s.data)==null?void 0:a.message)||(i==null?void 0:i.message)||"failed to delete category",variant:"destructive"})}};return _?e.jsx(ce,{}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("header",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsx("div",{children:e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-cubes mr-3 text-blue-600"}),"Rate Configuration Pre Sales"]})}),e.jsxs("section",{className:"flex  gap-3 items-center",children:[M&&e.jsx("div",{children:e.jsx(p,{onClick:()=>b(!0),children:"Create New Category"})}),e.jsx("div",{className:"w-full sm:w-auto flex justify-end sm:block",children:e.jsx(he,{organizationId:m,stageName:"materialquote"})})]})]}),e.jsx(ue,{open:U,onOpenChange:t=>{b(t),t||(w(null),g(""),o([{key:"",type:"string",required:!1,visibleIn:[]}]))},children:e.jsxs(me,{className:"px-5 py-6",children:[e.jsx(xe,{className:"px-0 py-0",children:e.jsx(pe,{children:d?"Edit Category Fields":"Create New Material Category"})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(R,{placeholder:"Category name (e.g. Plywood)",value:f,disabled:!!d,onChange:t=>g(t.target.value),className:d?"cursor-not-allowed":"",title:`${d?"not allowed to edit title":""}`}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex gap-2 items-center justify-between",children:[e.jsx("h4",{className:"text-base font-semibold",children:"Define Fields"}),e.jsxs("div",{className:"flex gap-2 items-center justify-between",children:[e.jsx("input",{id:"productspecific",checked:j,onChange:t=>G(t.target.checked),type:"checkbox"}),e.jsx("label",{className:"cursor-pointer",htmlFor:"productspecific",children:"Product Specific"})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 mt-1",children:[e.jsxs("span",{className:"text-[11px] font-medium text-amber-600 bg-amber-50 px-2 py-1 rounded-md border border-amber-100 inline-block",children:[e.jsx("i",{className:"fas fa-exclamation-triangle mr-1.5"}),"Ensure keys are named accurately. Renaming a field key after data has been entered will delete the data."]}),j&&e.jsx("div",{className:"text-[11px] font-medium text-blue-600 bg-blue-50 px-2 py-2 rounded-md border border-blue-100 animate-in slide-in-from-top-1 duration-200",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("i",{className:"fas fa-info-circle mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold uppercase text-[9px] mb-0.5",children:"Dimension Naming Guide:"}),e.jsx("p",{children:"Use an 'x' between Height and Width for automatic calculation in quote engines."}),e.jsxs("p",{className:"mt-1 font-bold opacity-80",children:["Valid Formats: ",e.jsx("span",{className:"underline",children:"7 x 6"})," or ",e.jsx("span",{className:"underline",children:"7ft h x 6ft w"}),", or ",e.jsx("span",{className:"underline",children:"7h x 6w"})]})]})]})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2 items-center px-1 mt-4 mb-1",children:[e.jsx("label",{className:"flex-1 text-[10px] font-black text-slate-400 uppercase tracking-widest",children:"Field Key"}),e.jsx("label",{className:"w-[85px] text-[10px] font-black text-slate-400 uppercase tracking-widest",children:"Type"}),e.jsxs("label",{className:"w-[120px] text-[10px] font-black text-slate-400 uppercase tracking-widest text-left",children:["Visible In",e.jsx("br",{}),"(Select Modules)"]}),e.jsx("div",{className:"w-8"})," "]}),n.map((t,s)=>{var i,v;const a=t.key==="manufacturCostPerSqft";return e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(R,{placeholder:"Field key (e.g: brand, sqft/rate, notes)",value:a?"Mfg Cost / Sqft":t.key,onChange:l=>D(s,"key",l.target.value),className:`flex-1 ${a?"cursor-not-allowed ":""}`,disabled:a,title:a?"This field cannot be edited":""}),e.jsxs("select",{value:t.type,disabled:a,onChange:l=>D(s,"type",l.target.value),title:a?"This field cannot be edited":"",className:`px-2 py-2 rounded-xl border border-blue-200 focus:border-blue-200 active:border-blue-200
                ${a?"cursor-not-allowed ":""}`,children:[e.jsx("option",{value:"string",children:"text"}),e.jsx("option",{value:"number",children:"number"}),e.jsx("option",{value:"file",children:"Image"})]}),e.jsxs("div",{className:"relative",ref:h===s?N:null,children:[e.jsxs("div",{onClick:()=>C(h===s?null:s),className:"h-10 px-3 min-w-[120px] bg-white border border-slate-200 rounded-xl flex items-center justify-between cursor-pointer hover:border-blue-400 transition-all",children:[e.jsx("span",{className:"text-[11px] font-bold text-slate-600 truncate",children:((i=t==null?void 0:t.visibleIn)==null?void 0:i.length)===0?"None":`${((v=t==null?void 0:t.visibleIn)==null?void 0:v.length)||0} Selected`}),e.jsx("i",{className:`fas fa-chevron-down text-[8px] text-slate-400 transition-transform ${h===s?"rotate-180":""}`})]}),h===s&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"absolute right-0 mt-1 w-40 bg-white border border-slate-200 rounded-xl shadow-xl z-100 p-2 animate-in zoom-in-95 duration-100",children:[e.jsxs("button",{type:"button",onClick:l=>{l.preventDefault(),V(s)},className:"w-full text-left flex items-center gap-2 p-2 hover:bg-indigo-50 rounded-lg cursor-pointer group transition-colors border-b border-slate-100 mb-1 pb-2",children:[e.jsx("span",{className:`w-4 h-4 rounded border flex flex-shrink-0 items-center justify-center transition-all ${(t.visibleIn||[]).includes("materials")&&(t.visibleIn||[]).includes("presales")?"bg-indigo-600 border-indigo-600":"bg-white border-slate-300"}`,children:(t.visibleIn||[]).includes("materials")&&(t.visibleIn||[]).includes("presales")&&e.jsx("i",{className:"fas fa-check-double text-[8px] text-white"})}),e.jsx("span",{className:"text-[11px] flex-1 font-black uppercase tracking-tighter text-indigo-600",children:"All Modules"})]}),["materials","presales"].map(l=>{var q,A;return e.jsxs("button",{type:"button",className:" w-full text-left  flex items-center gap-2 p-2 hover:bg-slate-50 rounded-lg cursor-pointer group",onClick:ee=>{ee.preventDefault(),T(s,l)},children:[e.jsx("div",{className:`w-4 h-4 rounded border flex items-center justify-center transition-all ${(q=t.visibleIn)!=null&&q.includes(l)?"bg-blue-600 border-blue-600":"bg-white border-slate-300"}`,children:((A=t.visibleIn)==null?void 0:A.includes(l))&&e.jsx("i",{className:"fas fa-check text-[8px] text-white"})}),e.jsx("span",{className:"text-[11px] font-bold capitalize text-slate-600 group-hover:text-blue-600",children:l})]},l)})]})})]}),e.jsx(p,{type:"button",size:"sm",variant:"danger",onClick:()=>X(s),className:"bg-red-600 hover:bg-red-600 text-white",title:"Remove Field",children:e.jsx("i",{className:"fas fa-trash-alt text-sm"})})]},s)})]}),e.jsxs("div",{className:"flex justify-between pt-2",children:[e.jsx(p,{variant:"secondary",onClick:Q,children:"+ Add Field"}),e.jsx(p,{isLoading:H||J,onClick:Y,children:d?"Update Category":"Create Category"})]})]})]})}),$&&e.jsxs("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 max-h-[88vh] overflow-y-auto",children:[k&&e.jsx("p",{children:"Loading categories..."}),!k&&(x==null?void 0:x.length)===0&&e.jsx("p",{className:"text-gray-500",children:"No categories found"}),x==null?void 0:x.map(t=>e.jsx(oe,{className:"w-full border-l-4 border-blue-600 shadow-md bg-white hover:shadow-lg transition-all",children:e.jsxs(de,{className:"p-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-start gap-4",children:[e.jsx("h3",{className:"text-base font-bold text-blue-700 mb-2 truncate",children:t.name}),O&&e.jsx("button",{disabled:S,className:"flex items-center justify-center w-8 h-8 rounded-full text-red-600 bg-red-50 hover:bg-red-500 hover:text-white transition-all duration-200 cursor-pointer disabled:opacity-50",onClick:()=>Z(t._id),title:"Delete Category",children:S?e.jsx("i",{className:"fas fa-circle-notch fa-spin text-sm"}):e.jsx("i",{className:"fas fa-trash-alt text-sm"})})]}),e.jsxs("p",{className:"text-sm text-gray-600 capitalize",children:["Fields:"," ",e.jsx("strong",{children:t.fields.filter(s=>!s.visibleIn||s.visibleIn.length===0||s.visibleIn.includes("presales")).map(s=>s.key).join(", ")||e.jsx("span",{className:"italic text-gray-400",children:"No fields enabled"})})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2 border-t border-gray-50",children:[e.jsxs(p,{size:"sm",variant:"primary",onClick:()=>{w(t._id),g(t.name),o(t.fields),b(!0)},children:[e.jsx("i",{className:"fas fa-edit mr-1"})," Edit"]}),e.jsxs(p,{size:"sm",variant:"secondary",onClick:()=>z(`single/${t._id}`),children:[e.jsx("i",{className:"fas fa-eye mr-1"})," View"]})]})]})},t._id))]})]})}export{we as default};
