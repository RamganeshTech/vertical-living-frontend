import{u as L,r as B,a as E,e as D,b as G,j as e,O as M}from"./index-DmIvND9E.js";import{u as R}from"./staffTaskApi-qFGnT8Eq.js";import{S as f,a as g,b as p,c as b,d as j}from"./Select-D-YeVjLn.js";import{u as $}from"./projectApi-agTrVN5S.js";import{u as q}from"./getAllUsersApi-D4jLDXYp.js";import{S as z}from"./SearchSelectNew-Bv-muP_X.js";import{B as O}from"./Button-CcLxO5cH.js";import{S as U}from"./StaffTaskCard-evc8dQ4f.js";import H from"./MaterialOverviewLoading-CWbdT0Pl.js";import"./roleCheck-DZRqXPrB.js";import"./useQuery-BHdcKCtG.js";import"./useMutation-CAeBxy3I.js";import"./Card-CDMWR08L.js";import"./dateFormator-BGKi5rfZ.js";import"./toast-BSC5QTk1.js";import"./Skeleton-Cm__h_hu.js";const J=["queued","in_progress","paused","done"],K=["low","medium","high"],Q=["site","procurement","design","accounts"],ue=()=>{var w,k,C,S,A;const{organizationId:d}=L(),[l,a]=B.useState({}),_=E(),y=D(),{role:N,permission:i}=G(),T=N==="owner"||((w=i==null?void 0:i.stafftask)==null?void 0:w.create),V=N==="owner"||((k=i==null?void 0:i.stafftask)==null?void 0:k.list),{data:o,isLoading:m,isError:x,error:u,refetch:F}=R(d,l),{data:h}=$(d),{data:n}=q(d,"staff"),I=((C=n||[])==null?void 0:C.map(s=>({value:s._id,label:s.staffName,email:s.email})))||[],c=h==null?void 0:h.map(s=>({_id:s._id,projectName:s.projectName})),P=()=>a({}),v=Object.values(l).filter(Boolean).length;return y.pathname.includes("single")||y.pathname.includes("addtask")?e.jsx(M,{}):e.jsxs("div",{className:"p-2 h-full overflow-y-auto ",children:[e.jsxs("header",{className:"flex justify-between items-center w-full",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-dolly mr-3 text-blue-600"}),"Tasks"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage & Assign Tasks to your team members"})]}),T&&e.jsx(O,{onClick:()=>{_("addtask")},className:"bg-blue-600  cursor-pointer ",children:"Add Task"})]}),e.jsxs("section",{className:"py-2 flex w-full gap-6 flex-col lg:flex-row items-start lg:h-[90%]",children:[e.jsx("div",{className:"md:w-full lg:w-1/4 xl:w-1/4 w-full  h-full overflow-y-auto custom-scrollbar",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-filter mr-2 text-blue-600"}),"Filters"]}),v>0&&e.jsxs("button",{onClick:P,className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:["Clear All (",v,")"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"w-full flex gap-2 justify-center items-center flex-row lg:flex-col xl:flex-row",children:[e.jsx("button",{onClick:()=>a(s=>({...s,dependecies:!s.dependecies})),className:` w-full cursor-pointer  px-4 py-2 rounded-xl text-sm font-medium
        transition-all duration-200 ease-in-out
        flex items-center justify-center border
        ${l!=null&&l.dependecies?"bg-blue-100 border-blue-600 text-blue-800 shadow-sm":"bg-gray-100 border-gray-300 text-gray-700 hover:bg-gray-200"}`,children:"Dependencies"}),e.jsx("button",{onClick:()=>a(s=>({...s,overdue:!s.overdue})),className:`w-full  cursor-pointer px-4 py-2 rounded-xl text-sm font-medium
        transition-all duration-200 ease-in-out
        flex items-center justify-center border
        ${l!=null&&l.overdue?"bg-yellow-100 border-yellow-600 text-yellow-800 shadow-sm":"bg-gray-100 border-gray-300 text-gray-700 hover:bg-gray-200"}`,children:"Overdue"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs(f,{value:l.status,onValueChange:s=>a(t=>({...t,status:s})),children:[e.jsx(g,{className:"bg-white w-full",children:e.jsx(p,{placeholder:"Select status",selectedValue:l.status})}),e.jsx(b,{children:J.map(s=>e.jsx(j,{value:s,children:s},s))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Priority"}),e.jsxs(f,{value:l.priority,onValueChange:s=>a(t=>({...t,priority:s})),children:[e.jsx(g,{className:"bg-white w-full",children:e.jsx(p,{placeholder:"Select priority",selectedValue:l.priority})}),e.jsx(b,{children:K.map(s=>e.jsx(j,{value:s,children:s},s))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date"}),e.jsx("input",{type:"date",onChange:s=>a(t=>({...t,createdAt:s.target.value})),value:l.createdAt,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Department"}),e.jsxs(f,{value:l.department,onValueChange:s=>a(t=>({...t,department:s})),children:[e.jsx(g,{className:"bg-white w-full",children:e.jsx(p,{placeholder:"Select department",selectedValue:l.department})}),e.jsx(b,{children:Q.map(s=>e.jsx(j,{value:s,children:s},s))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Assignee"}),e.jsx(z,{options:I,placeholder:"Select assignee",searchPlaceholder:"Search by name...",value:l.assigneeId||"",onValueChange:s=>{const t=n==null?void 0:n.find(r=>r._id===s);a(r=>({...r,assigneeId:s||null,assigneeName:(t==null?void 0:t.staffName)||""}))},searchBy:"name",displayFormat:"detailed",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Project"}),e.jsxs("select",{value:l.projectId||"",onChange:s=>{const t=c.find(r=>r._id===s.target.value);a(r=>({...r,projectId:t==null?void 0:t._id,projectName:t==null?void 0:t.projectName}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All Projects"}),c==null?void 0:c.map(s=>e.jsx("option",{value:s._id,children:s.projectName},s._id))]})]})]})]})}),V&&e.jsxs("div",{className:"flex-1 w-full overflow-y-auto  h-[100%]",children:[m&&e.jsx(H,{}),x&&e.jsxs("div",{className:"max-w-xl sm:min-w-[80%]  mx-auto mt-4 p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2 text-xl sm:text-3xl",children:"âš ï¸ Error Occurred"}),e.jsx("p",{className:"text-red-500  mb-4 text-lg sm:text-xl",children:((A=(S=u==null?void 0:u.response)==null?void 0:S.data)==null?void 0:A.message)||"Failed to load data"}),e.jsx(O,{onClick:()=>F(),className:"bg-red-600 text-white px-4 py-2",children:"Retry"})]}),!m&&!x&&(o==null?void 0:o.length)===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[300px] w-full bg-white rounded-xl   text-center p-6",children:[e.jsx("i",{className:"fas fa-box-open text-5xl text-blue-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-1",children:"No Tasks Found"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Looks like there are no tasks assigned yet ",e.jsx("br",{}),"Click on ",e.jsx("strong",{children:'"Add task"'})," to get started ðŸš€"]})]}),!m&&!x&&e.jsx("div",{className:"grid sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-3 gap-4",children:o==null?void 0:o.map(s=>e.jsx(U,{task:s},s._id))})]})]})]})};export{ue as StaffTasksListMain,ue as default};
