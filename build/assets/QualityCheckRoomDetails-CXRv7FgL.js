import{b as H,a as J,r as g,j as e,B as n,I as d,t as o}from"./index-Dre-3JFT.js";import{u as K,c as M,d as X,e as Y}from"./qualityCheckApi-DmoO4z7b.js";import{S as E,a as A,b as F,c as D,d as P}from"./Select-DsZzng6O.js";import{R as Z}from"./RoomDetailLoading-CE4dlACF.js";import"./useQuery-Bz5JFwsG.js";import"./roleCheck-CIuNrpTb.js";import"./Skeleton-BL_1k5Uu.js";function ce(){var C,S;const{roomkey:m,projectId:x,organizationId:R}=H(),V=J(),[y,f]=g.useState(null),{data:j,isLoading:_,error:v,isError:W,refetch:u}=K(x),{mutateAsync:L,isPending:Q}=M(),{mutateAsync:z,isPending:B}=X(),{mutateAsync:G,isPending:U}=Y(),[a,i]=g.useState({workName:"",status:"pending",remarks:"",file:void 0}),[N,h]=g.useState(!1),[k,b]=g.useState(null),w=(j==null?void 0:j[m])||[],$=async()=>{var s,l;try{if(!a.workName.trim())throw new Error("Work name is mandatory");const t=new FormData;t.append("workName",a.workName),t.append("status",a.status),a.remarks&&t.append("remarks",a.remarks),a.file&&t.append("file",a.file),await L({projectId:x,roomName:m,formData:t}),o({description:"Created successfully",title:"Success"}),p(),u()}catch(t){o({title:"Error",description:((l=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:l.message)||(t==null?void 0:t.message)||"Failed to create item",variant:"destructive"})}},q=async s=>{var l,t;try{if(!k)return;if(!a.workName.trim())throw new Error("Work name is mandatory");const r=new FormData;r.append("itemId",k),a.workName&&r.append("workName",a.workName),r.append("status",a.status),a.remarks&&r.append("remarks",a.remarks),a.file&&r.append("file",a.file),await z({projectId:x,roomName:m,formData:r,itemId:s},{onSuccess:()=>{p()}}),o({description:"Edited successfully",title:"Success"}),u()}catch(r){o({title:"Error",description:((t=(l=r==null?void 0:r.response)==null?void 0:l.data)==null?void 0:t.message)||(r==null?void 0:r.message)||"Failed to edit item",variant:"destructive"})}},O=async s=>{var l,t;try{console.log("deleting is not workin"),await G({projectId:x,roomName:m,itemId:s}),o({description:"Deleted successfully",title:"Success"}),u()}catch(r){o({title:"Error",description:((t=(l=r==null?void 0:r.response)==null?void 0:l.data)==null?void 0:t.message)||r.message||"Failed to delete item",variant:"destructive"})}},p=()=>{i({workName:"",status:"pending",remarks:"",file:void 0}),h(!1),b(null)};return _?e.jsx(Z,{}):(W&&((S=(C=v==null?void 0:v.response)==null?void 0:C.data)!=null&&S.message,n),e.jsxs("div",{className:"w-full h-full",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("h1",{className:"text-xl font-bold mb-4",children:["Room: ",m]}),e.jsx(n,{variant:"primary",className:"h-10",onClick:()=>V(`/${R}/projectdetails/${x}/qualitycheck`),children:"Go Back"})]}),w.length===0&&!N?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("div",{className:"min-w-[900px] grid grid-cols-5 gap-2 font-semibold bg-blue-100 text-blue-900 p-2 rounded",children:[e.jsx("div",{className:"text-center",children:"Work Name"}),e.jsx("div",{className:"text-center",children:"Status"}),e.jsx("div",{className:"text-center",children:"Remarks"}),e.jsx("div",{className:"text-center",children:"Upload"}),e.jsx("div",{className:"text-center",children:"Actions"})]})}),e.jsxs("div",{className:"flex flex-col items-center justify-center p-12 shadow rounded-lg bg-white",children:[e.jsx("i",{className:"fas fa-check-double text-3xl text-blue-400 mb-2"}),e.jsx("p",{className:"text-blue-600 mb-4 text-sm",children:"No items added yet for this room."}),e.jsxs(n,{onClick:()=>h(!0),variant:"primary",children:[e.jsx("i",{className:"fas fa-plus mr-2"})," Add Item"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsxs("div",{className:"min-w-[900px]",children:[e.jsxs("div",{className:"grid grid-cols-5 text-blue-900 gap-2 font-semibold bg-blue-100 p-2 rounded-t",children:[e.jsx("div",{className:"text-center",children:"Work Name"}),e.jsx("div",{className:"text-center",children:"Status"}),e.jsx("div",{className:"text-center",children:"Remarks"}),e.jsx("div",{className:"text-center",children:"Upload"}),e.jsx("div",{className:"text-center",children:"Actions"})]}),e.jsx("div",{className:"overflow-y-auto relative z-[10] max-h-[70vh] sm:max-h-[75vh] md:max-h-[80vh] lg:max-h-[45vh] xl:max-h-[77vh]",children:w.map((s,l)=>{var t,r;return k===s._id?e.jsxs("div",{className:"grid grid-cols-5 gap-2 px-4 py-3 border-b border-gray-200 items-center bg-white",children:[e.jsx(d,{value:a.workName,placeholder:"Work Name",onChange:c=>i({...a,workName:c.target.value})}),e.jsx("div",{className:"relative z-50",children:e.jsxs(E,{value:a.status,onValueChange:c=>i({...a,status:c}),children:[e.jsx(A,{children:e.jsx(F,{selectedValue:a.status,placeholder:"Select status"})}),e.jsx(D,{children:["pass","fail","pending"].map(c=>e.jsx(P,{value:c,children:c},c))})]})}),e.jsx(d,{value:a.remarks,placeholder:"Remarks",onChange:c=>i({...a,remarks:c.target.value})}),e.jsx("div",{className:"flex flex-col items-center gap-1",children:e.jsx(d,{type:"file",accept:"image/*",onChange:c=>{var I;const T=(I=c.target.files)==null?void 0:I[0];i({...a,file:T})}})}),e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsxs(n,{variant:"primary",isLoading:B,onClick:()=>q(s._id),className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded",children:[e.jsx("i",{className:"fas fa-save mr-1"})," Save"]}),e.jsxs(n,{variant:"secondary",onClick:p,className:"bg-gray-400 text-white px-3 py-1 rounded",children:[e.jsx("i",{className:"fas fa-times mr-1"})," Cancel"]})]})]},s._id+l):e.jsxs("div",{className:"grid grid-cols-5 gap-2 px-4 py-3 border-b border-gray-200 items-center bg-white",children:[e.jsx("div",{className:"text-center",children:s.workName||"N/A"}),e.jsx("div",{className:"text-center",children:s.status||"N/A"}),e.jsx("div",{className:"text-center",children:s.remarks||"N/A"}),e.jsx("div",{className:"text-center",children:((t=s.upload)==null?void 0:t.type)==="image"?e.jsx("img",{src:s.upload.url,alt:"Preview",className:"w-10 h-10 object-cover rounded border cursor-pointer mx-auto",onClick:()=>f(s.upload.url)}):((r=s.upload)==null?void 0:r.type)==="pdf"?e.jsx("a",{href:s.upload.url,target:"_blank",rel:"noreferrer",className:"text-blue-600 underline",children:"View PDF"}):"No Image"}),e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsxs("button",{onClick:()=>{b(s._id),h(!1),i({workName:s.workName||"",status:s.status||"pending",remarks:s.remarks||"",file:void 0})},className:"bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded",children:[e.jsx("i",{className:"fas fa-edit mr-1"})," Edit"]}),e.jsxs(n,{variant:"danger",isLoading:U,onClick:()=>O(s._id),className:"bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded",children:[e.jsx("i",{className:"fas fa-trash mr-1"})," Delete"]})]})]},s._id+l)})}),N&&e.jsxs("div",{className:"grid grid-cols-5 gap-2 px-4 py-3 bg-white border-b border-gray-200 items-center",children:[e.jsx(d,{placeholder:"Work Name",value:a.workName,onChange:s=>i({...a,workName:s.target.value})}),e.jsxs(E,{value:a.status,onValueChange:s=>i({...a,status:s}),children:[e.jsx(A,{children:e.jsx(F,{selectedValue:a.status,placeholder:"Select status"})}),e.jsx(D,{children:["pass","fail","pending"].map(s=>e.jsx(P,{value:s,children:s},s))})]}),e.jsx(d,{placeholder:"Remarks",value:a.remarks,onChange:s=>i({...a,remarks:s.target.value})}),e.jsx("div",{className:"flex flex-col items-center gap-1",children:e.jsx(d,{type:"file",accept:"image/*",onChange:s=>{var t;const l=(t=s.target.files)==null?void 0:t[0];i({...a,file:l})}})}),e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsxs("button",{onClick:$,className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded",children:[e.jsx("i",{className:"fas fa-save mr-1"})," Save"]}),e.jsxs("button",{onClick:p,className:"bg-gray-400 text-white px-3 py-1 rounded",children:[e.jsx("i",{className:"fas fa-times mr-1"})," Cancel"]})]})]})]})}),!N&&w.length>0&&e.jsx("div",{className:"mt-4",children:e.jsxs(n,{isLoading:Q,variant:"primary",onClick:()=>{h(!0),b(null),i({workName:"",status:"pending",remarks:"",file:void 0})},children:[e.jsx("i",{className:"fas fa-plus mr-2"})," Add Item"]})})]}),y&&e.jsx("div",{onClick:()=>f(null),className:"fixed inset-0 z-50 bg-black/70 bg-opacity-60 flex items-center justify-center",children:e.jsxs("div",{onClick:s=>s.stopPropagation(),className:"relative bg-white rounded p-4 max-w-[90vw] max-h-[80vh] shadow-lg",children:[e.jsx("i",{className:"fas fa-times absolute top-2 right-3 text-xl text-gray-700 hover:text-red-500 cursor-pointer",onClick:()=>f(null)}),e.jsx("img",{src:y,alt:"Full View",className:"max-h-[70vh] w-auto object-contain rounded"})]})})]}))}export{ce as default};
