import{r as b,j as e,B as v,e as V,I as W,t as o,u as z,a as B}from"./index-Wihfhca_.js";import{u as G,a as O,b as Q,c as K,d as L}from"./requirementFormApi-BbjJACpW.js";import{I}from"./Input-IfonaLGO.js";import{V as T}from"./VideoGalleryMain-BNV6H6Hm.js";const U=({projectId:p,sectionName:f,refetch:N,existingUploads:i})=>{const[q,R]=b.useState(null),{mutateAsync:E,isPending:y}=G(),{mutateAsync:C,isPending:x}=O(),S=async n=>{var c,g;try{const d=n.target.files;if(!d||d.length===0)return;const k=new FormData;for(const w of Array.from(d))k.append("file",w);await E({projectId:p,sectionName:f,files:k}),N(),o({title:"Success",description:"file uploaded successfully"})}catch(d){o({title:"Error",description:((g=(c=d==null?void 0:d.response)==null?void 0:c.data)==null?void 0:g.message)||"Failed to upload",variant:"destructive"})}},j=async n=>{var c,g;try{await C({projectId:p,sectionName:f,fileId:n}),N(),o({title:"Success",description:"file deleted successfully"})}catch(d){o({title:"Error",description:((g=(c=d==null?void 0:d.response)==null?void 0:c.data)==null?void 0:g.message)||"Failed to delete",variant:"destructive"})}},u=i.filter(n=>n.type==="image"),m=i==null?void 0:i.filter(n=>n.type==="pdf"),h=i==null?void 0:i.filter(n=>n.type==="video");return e.jsxs("div",{className:"space-y-4 w-full",children:[e.jsxs("div",{className:"flex relative items-center justify-between w-full",children:[e.jsx(I,{type:"file",multiple:!0,placeholder:"select files",onChange:S,disabled:y,className:y?"pr-10 opacity-70 cursor-not-allowed w-full":""}),y&&e.jsx("div",{className:"absolute inset-y-0 right-2 flex items-center",children:e.jsx("div",{className:"animate-spin h-5 w-5 border-t-transparent rounded-full border-2 border-gray-500"})})]}),e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-800",children:"PDFs"}),m.length===0&&e.jsx("div",{className:"text-gray-500 text-sm italic bg-gray-50 p-8 rounded-lg text-center border-2 border-dashed border-gray-200",children:"No Pdfs uploaded yet."}),m==null?void 0:m.map(n=>e.jsx("div",{className:"mt-6",children:e.jsxs("div",{className:"relative space-y-4 group flex justify-between items-center px-4 py-3 border rounded-lg shadow-sm bg-white",children:[e.jsxs("div",{className:"flex items-center space-x-3 w-[190px] sm:w-3/2 lg:w-full",children:[e.jsx("div",{className:"w-10 h-10 bg-red-100 flex items-center justify-center rounded-lg text-red-600",children:e.jsx("i",{className:"fas fa-file-pdf text-xl"})}),e.jsx("span",{className:"text-sm font-medium !truncate max-w-[100%] whitespace-wrap",children:n.originalName})]}),e.jsx("div",{className:"flex ",children:["eye","trash","download"].map(c=>e.jsx(v,{variant:"ghost",size:"sm",onClick:()=>c==="eye"?window.open(n.url,"_blank"):c==="trash"?j(n._id):V({src:n==null?void 0:n.url,alt:(n==null?void 0:n.originalName)||"file.pdf"}),disabled:c==="trash"&&x,className:"hover:bg-gray-100 shadow-sm",children:e.jsx("i",{className:` fas fa-${c} ${c==="trash"?"text-red-500":c==="download"?"text-blue-500":"text-gray-600"}`})},c))})]})},n.url)),e.jsxs("div",{className:"mt-6 w-full ",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-800",children:" Images "}),(u==null?void 0:u.length)===0?e.jsx("div",{className:"text-gray-500 text-sm italic bg-gray-50 p-8 rounded-lg text-center border-2 border-dashed border-gray-200",children:"No Images uploaded yet."}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"",children:e.jsx(W,{imageFiles:u,refetch:N,handleDeleteFile:j,height:190,minWidth:156,maxWidth:100})})})]}),e.jsxs("div",{className:"mt-6 w-full ",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-800",children:" Videos "}),(h==null?void 0:h.length)===0?e.jsx("div",{className:"text-gray-500 text-sm italic bg-gray-50 p-8 rounded-lg text-center border-2 border-dashed border-gray-200",children:"No Videos uploaded yet."}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"",children:e.jsx(T,{videoFiles:h,refetch:N,handleDeleteFile:j,isDeleting:x,height:190,minWidth:156,maxWidth:100})})})]}),q&&e.jsx("div",{onClick:()=>R(null),className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:e.jsx("div",{onClick:n=>n.stopPropagation(),className:"relative bg-black/70 rounded-lg shadow-lg max-w-[80%] max-h-[80%] p-2",children:e.jsx("img",{src:q,alt:"preview image",className:"w-[80vw] max-h-[70vh] object-cpntain mx-auto"})})})]})},X=()=>{var F,P;const{projectId:p,roomId:f}=z(),N=B(),{data:i,isLoading:q,refetch:R}=Q({roomId:f,projectId:p}),{mutateAsync:E}=K(),{mutateAsync:y,isPending:C}=L(),[x,S]=b.useState({}),[j,u]=b.useState(!1),[m,h]=b.useState([{itemName:"",quantity:1,unit:""}]),n=["sqft","cm","mm","length","nos"];b.useEffect(()=>{var s;if((s=i==null?void 0:i.items)!=null&&s.length){const l={};i.items.forEach(t=>{l[t._id]={id:t._id,itemName:t.itemName||"",quantity:t.quantity||0,unit:t.unit||"mm"}}),S(l)}},[i]);const c=(s,l,t)=>{h(a=>{const r=a.map((_,M)=>M===s?{..._,[l]:l==="quantity"?Number(t):t}:_),A=r[r.length-1];return A.itemName.trim()!==""&&!r.some(_=>_.itemName==="")&&r.push({itemName:"",quantity:1,unit:""}),r.length>1&&A.itemName.trim()===""&&r[r.length-2].itemName.trim()===""&&r.pop(),r})},g=(s,l,t)=>{S(a=>({...a,[s]:{...a[s],[l]:l==="quantity"?Number(t):t}}))},d=s=>{h(l=>l.filter((t,a)=>a!==s))};b.useEffect(()=>{m.length===0&&u(!1)},[m]);const k=async()=>{var l,t;const s=m.filter(a=>a.itemName.trim()!==""&&a.quantity>0&&a.unit!=="");if(console.log(s),s.length===0)return o({title:"Error",description:"every row should be filled with Item name, quanitty, and unit",variant:"destructive"});try{await Promise.all(s.map(a=>E({projectId:p,roomId:f,itemId:null,payload:{itemName:a.itemName,quantity:a.quantity,unit:a.unit}}))),o({title:"Success",description:"All items saved successfully"}),h([{itemName:"",quantity:1,unit:""}]),u(!1)}catch(a){o({title:"Error",description:((t=(l=a==null?void 0:a.response)==null?void 0:l.data)==null?void 0:t.message)||"Failed to save items",variant:"destructive"})}},w=async s=>{var l,t;if(console.log("ediData",s),!s.itemName.trim()||s.quantity<=0||!s.unit)return o({title:"Error",description:"Please fill all fields correctly",variant:"destructive"});try{await E({projectId:p,roomId:f,itemId:s.id,payload:{itemName:s.itemName,quantity:s.quantity,unit:s.unit}}),o({title:"Success",description:"Item updated successfully"})}catch(a){o({title:"Error",description:((t=(l=a==null?void 0:a.response)==null?void 0:l.data)==null?void 0:t.message)||"Failed to update item",variant:"destructive"})}},D=async s=>{var l,t;try{await y({projectId:p,roomId:f,itemId:s}),o({title:"Success",description:"Item Deleted successfully"})}catch(a){o({title:"Error",description:((t=(l=a==null?void 0:a.response)==null?void 0:l.data)==null?void 0:t.message)||(a==null?void 0:a.message)||"Failed to update room data",variant:"destructive"})}};return q?e.jsx("div",{className:"min-h-full  bg-slate-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-600",children:"Loading room details..."})]})}):e.jsxs("div",{className:"max-h-full overflow-y-auto bg-slate-50",children:[e.jsx("div",{className:"bg-white border-b border-slate-200 sticky top-0 z-10",children:e.jsx("div",{className:"w-full px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between py-4",children:[e.jsx("div",{className:"flex items-center space-x-4",children:e.jsxs("button",{onClick:()=>N(-1),className:"flex cursor-pointer items-center space-x-2 text-slate-600 hover:text-blue-600 transition-colors duration-200 group",children:[e.jsx("div",{className:"bg-slate-100 group-hover:bg-blue-50 rounded-lg p-2 transition-colors duration-200",children:e.jsx("i",{className:"fas fa-arrow-left text-sm"})}),e.jsx("span",{className:"font-medium",children:"Back to Rooms"})]})}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-blue-50 rounded-lg p-2",children:e.jsx("i",{className:"fas fa-door-open text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-slate-800",children:(i==null?void 0:i.roomName)||"Room"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Manage items and requirements"})]})]})]})})}),e.jsxs("div",{className:"w-full px-4 sm:px-6 lg:px-8 py-8 space-y-8",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-200 p-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between mb-6 gap-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-blue-50 rounded-lg p-2",children:e.jsx("i",{className:"fas fa-list-ul text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-800",children:"Room Items"}),e.jsxs("p",{className:"text-sm text-slate-500",children:["Manage quantities and specifications ",e.jsx("span",{children:"(Click to Edit, Press Enter to save)"})]})]})]})}),e.jsx("div",{className:"space-y-4",children:((F=i==null?void 0:i.items)==null?void 0:F.length)===0&&!j?e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"bg-slate-100 rounded-full p-8 w-24 h-24 mx-auto mb-6 flex items-center justify-center",children:e.jsx("i",{className:"fas fa-inbox text-3xl text-slate-400"})}),e.jsx("h3",{className:"text-xl font-medium text-slate-600 mb-3",children:"No Items Yet"}),e.jsx("p",{className:"text-slate-500 mb-6 max-w-md mx-auto",children:"Start by adding your first item to this room. You can specify quantities and manage specifications."}),e.jsxs(v,{onClick:()=>u(!0),className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-xl flex items-center space-x-2 mx-auto",children:[e.jsx("i",{className:"fas fa-plus text-sm"}),e.jsx("span",{children:"Add First Item"})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"min-w-[600px] grid grid-cols-4 gap-3 px-3 py-2 bg-gray-100 text-sm font-semibold rounded-t-lg",children:[e.jsx("p",{className:"text-center",children:"Item Name"}),e.jsx("p",{className:"text-center",children:"Quantity"}),e.jsx("p",{className:"text-center",children:"Unit"}),e.jsx("p",{className:"text-center",children:"Action"})]}),e.jsx("div",{className:"space-y-2",children:(P=i==null?void 0:i.items)==null?void 0:P.map(s=>{var l,t,a;return e.jsxs("div",{className:"min-w-[600px] grid grid-cols-4 gap-3 items-center px-3 py-2 border-b bg-white ",children:[e.jsx(I,{placeholder:"Item name",value:((l=x[s._id])==null?void 0:l.itemName)??s.itemName??"",onChange:r=>g(s._id,"itemName",r.target.value),onKeyDown:r=>{r.key==="Enter"&&w(x[s._id]??s)},className:"!border-none focus:ring-0 text-center"}),e.jsx(I,{type:"number",placeholder:"Qty",value:((t=x[s._id])==null?void 0:t.quantity)??s.quantity??0,onChange:r=>g(s._id,"quantity",r.target.value),onKeyDown:r=>{r.key==="Enter"&&w(x[s._id]??s)},className:"!border-none focus:ring-0  text-center"}),e.jsxs("select",{value:((a=x[s._id])==null?void 0:a.unit)??s.unit??"",onChange:r=>{g(s._id,"unit",r.target.value),w(x[s._id]??s)},className:"border px-2 py-1 rounded",children:[e.jsx("option",{value:"",children:"Unit"}),n.map(r=>e.jsx("option",{value:r,children:r},r))]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(v,{onClick:()=>D(s._id),disabled:C,className:"bg-red-600 hover:bg-red-700 text-white px-3 py-1",children:C?"Deleting...":"Delete"})})]},s._id)})}),j?e.jsxs("div",{className:"space-y-2 mt-4",children:[m==null?void 0:m.map((s,l)=>e.jsxs("div",{className:"min-w-[600px] grid grid-cols-4 gap-3 items-center  border-b bg-white ",children:[e.jsx(I,{placeholder:"Item name",value:s.itemName,onChange:t=>c(l,"itemName",t.target.value),className:"!border-none focus:ring-0  text-center",autoFocus:l===0}),e.jsx(I,{type:"number",placeholder:"Qty",value:s.quantity,onChange:t=>c(l,"quantity",t.target.value),className:"!border-none focus:ring-0  text-center"}),e.jsxs("select",{value:s.unit,onChange:t=>c(l,"unit",t.target.value),className:"border px-2 py-1 rounded",children:[e.jsx("option",{value:"",children:"Unit"}),n.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(v,{onClick:()=>d(l),className:"bg-red-500 hover:bg-red-600 text-white px-3 py-1 mx-auto",children:"Remove"})})]},l)),e.jsx("div",{className:"flex justify-end mt-3",children:e.jsx(v,{onClick:k,disabled:m.every(s=>Object.entries(s).every(([l,t])=>!(l==="itemName"&&!t))),className:"bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg",children:"Save All Items"})})]}):e.jsx("div",{className:"w-full  flex justify-end",children:e.jsx(v,{onClick:()=>{u(!0),h([{itemName:"",quantity:1,unit:""}])},className:"mt-4 bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg  ",children:"+ Add Item"})})]})})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-200 p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[e.jsx("div",{className:"bg-green-50 rounded-lg p-2",children:e.jsx("i",{className:"fas fa-cloud-upload-alt text-green-600 text-lg"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-800",children:"File Uploads"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Upload requirements and documents"})]})]}),e.jsx(U,{projectId:p,sectionName:(i==null?void 0:i.roomName)||"",existingUploads:(i==null?void 0:i.uploads)||[],refetch:R})]})]})]})};export{X as default};
