import{u as pe,a as ge,k as be,e as fe,n as ye,o as je,p as ve,q as Ne,r as d,j as e,M as we,O as ke,B as h,t as w}from"./index-BAM0eJUz.js";import{I as k}from"./Input-1UBXZqEj.js";import{S as H,a as J,b as Q,c as W,d as X}from"./Select-C6lfB9t-.js";const Ce=["all","plywood","HDMR/MDF","aluminium","bwr"];function Fe(){var K,U,$;const{organizationId:D,id:v}=pe(),E=ge(),{role:L,permission:m}=be(),O=L==="owner"||((K=m==null?void 0:m.materialrateconfig)==null?void 0:K.create),Y=L==="owner"||((U=m==null?void 0:m.materialrateconfig)==null?void 0:U.delete),F=L==="owner"||(($=m==null?void 0:m.materialrateconfig)==null?void 0:$.edit),{data:C}=fe(D),{data:P,isLoading:Z,refetch:V}=ye(v),{mutateAsync:ee,isPending:se}=je(),{mutateAsync:te,isPending:ae}=ve(),{mutateAsync:re,isPending:ne}=Ne(),[b,S]=d.useState([{data:{}}]),[le,M]=d.useState(null),[g,I]=d.useState({}),[R,ce]=d.useState(""),[N,q]=d.useState(""),[f,ie]=d.useState("All"),[B,A]=d.useState(null),c=C==null?void 0:C.find(s=>s._id===v),y=d.useMemo(()=>{var r;return c!=null&&c.fields?[...(r=c==null?void 0:c.fields)==null?void 0:r.filter(a=>{const t=a.visibleIn;return!t||!Array.isArray(t)||t.length===0?!0:t.includes("materials")})].sort((a,t)=>{var j,o;const n=(j=a.key)==null?void 0:j.toLowerCase(),l=(o=t.key)==null?void 0:o.toLowerCase(),i=n.includes("image")||n.includes("img")||n.includes("Images")||n.includes("images"),x=l.includes("image")||l.includes("img")||l.includes("Images")||l.includes("images");return i&&!x?-1:!i&&x?1:0}):[]},[c]),T=d.useMemo(()=>(c==null?void 0:c.isProductSpecific)||!1,[c]),z=d.useMemo(()=>{if(!P)return[];let s=[...P];if(T&&f!=="all"&&(s=s.filter(a=>{var t;return((t=a.materialType)==null?void 0:t.toLowerCase())===f.toLowerCase()})),!R.trim())return s;const r=N;return s.filter(a=>{var n;return(((n=a.data[r])==null?void 0:n.toString().toLowerCase())||"").includes(R.toLowerCase())})},[P,R,N,f,T]);if(d.useEffect(()=>{var s,r;(r=(s=c==null?void 0:c.fields)==null?void 0:s[0])!=null&&r.key&&q(c.fields[0].key)},[c]),Z||!C)return e.jsx(we,{});if(!c)return e.jsx("p",{children:"Category not found"});const oe=s=>{M(s._id),I(s==null?void 0:s.data)},de=()=>{M(null),I({})},xe=async s=>{var r,a;try{const t=new FormData,n=c.fields.find(l=>l.type==="file");Object.keys(g).forEach(l=>{const i=g[l];n&&l===n.key&&i instanceof File?t.append("file",i):t.append(l,i)}),await re({itemId:s,body:t,categoryId:v}),w({title:"Success",description:"Item updated successfully"}),M(null),V()}catch(t){w({title:"Error",description:((a=(r=t==null?void 0:t.response)==null?void 0:r.data)==null?void 0:a.message)??"Update failed",variant:"destructive"})}},_=(s,r,a)=>{var o,p;const t=[...b];t[s].data[r]=a;const n=(p=(o=c.fields)==null?void 0:o[0])==null?void 0:p.key,l=s===t.length-1,i=r===n,x=(a==null?void 0:a.toString().trim())!=="",j=t.length>0&&Object.values(t[t.length-1].data).every(u=>u===void 0||u==="");if(l&&i&&x&&!j&&t.push({data:{}}),!x&&i&&b.length>1){const u=t[t.length-1];Object.values(u.data).every(G=>G===void 0||G==="")&&t.pop()}S(t)},me=()=>S([...b,{data:{}}]),ue=s=>{const r=[...b];r.splice(s,1),S(r)},he=async()=>{var s,r,a,t;try{const n=(r=(s=c.fields)==null?void 0:s[0])==null?void 0:r.key,l=c.fields.find(o=>o.type==="file"),i=b.map(o=>o.data).filter(o=>{const p=o[n];return p!=null&&p.toString().trim()!==""});if(i.length===0)return w({title:"Error",description:"Nothing to save",variant:"destructive"});const x=new FormData,j=i.map((o,p)=>{const u={...o};return l&&u[l.key]instanceof File&&(x.append(`file-${p}`,u[l.key]),delete u[l.key]),u});x.append("items",JSON.stringify(j)),x.append("materialType",f),await ee({categoryId:v,items:x,organizationId:D}),w({title:"Success",description:"Items created successfully"}),S([{data:{}}]),V()}catch(n){w({title:"Error",description:((t=(a=n==null?void 0:n.response)==null?void 0:a.data)==null?void 0:t.message)||(n==null?void 0:n.message)||"Operation failed",variant:"destructive"})}};return location.pathname.includes("catalogue")||location.pathname.includes("description")?e.jsx(ke,{}):e.jsxs("div",{className:"space-y-4 max-h-full overflow-y-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center sticky top-0 bg-white z-10 py-4 border-b",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("div",{onClick:()=>E(-1),className:"bg-slate-50 hover:bg-slate-300 flex items-center justify-between w-8 h-8 border border-[#a6aab8] text-sm cursor-pointer rounded-md px-2 ",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:c.name}),T&&e.jsx("div",{className:"w-full sm:w-56",children:e.jsxs(H,{value:f,onValueChange:ie,children:[e.jsx(J,{className:"h-10 border-amber-100 bg-white rounded-xl focus:ring-amber-400 px-0 overflow-hidden shadow-sm",children:e.jsxs("div",{className:"flex items-center h-full w-full",children:[e.jsx("div",{className:"bg-amber-50 h-full px-3 flex items-center border-r border-amber-100 shrink-0",children:e.jsx("span",{className:"text-[9px] font-black text-amber-600 uppercase tracking-tighter",children:"Material Type"})}),e.jsx("div",{className:"px-3 truncate text-[13px] font-bold text-slate-700",children:e.jsx(Q,{placeholder:"Select Type",selectedValue:f})})]})}),e.jsx(W,{className:"rounded-xl border-amber-100 p-1 shadow-2xl",children:Ce.map(s=>{const r=s.length<=5?s.toUpperCase():s.charAt(0).toUpperCase()+s.slice(1).toLowerCase();return e.jsx(X,{value:s,className:"text-[12px] font-semibold py-2.5 px-3 cursor-pointer rounded-lg hover:bg-amber-50 focus:bg-amber-50 transition-all border-b border-slate-50 last:border-0",children:r},s)})})]})})]}),e.jsxs("div",{className:"flex gap-2 mt-3 sm:mt-0",children:[e.jsx("div",{className:"w-full sm:w-56",children:e.jsxs(H,{value:N,onValueChange:s=>q(s),children:[e.jsx(J,{className:"h-10 border-blue-100 bg-white rounded-xl focus:ring-blue-400 px-0 overflow-hidden",children:e.jsxs("div",{className:"flex items-center h-full w-full",children:[e.jsx("div",{className:"bg-blue-50 h-full px-3 flex items-center border-r border-blue-100 shrink-0",children:e.jsx("span",{className:"text-[9px] font-black text-blue-500 uppercase tracking-tighter",children:"Search By"})}),e.jsx("div",{className:"px-3 truncate text-[13px] font-bold text-slate-700",children:e.jsx(Q,{placeholder:"Field",selectedValue:N})})]})}),e.jsx(W,{className:"rounded-xl border-blue-100 p-1 shadow-2xl",children:y.map(s=>e.jsx(X,{value:s.key,className:"text-[12px] font-semibold py-2.5 px-3 cursor-pointer rounded-lg hover:bg-blue-50 focus:bg-blue-50 transition-all border-b border-slate-50 last:border-0",children:s.key==="manufacturCostPerSqft"?"MFG Cost / Sqft":s.key},s.key))})]})}),e.jsxs("div",{className:"relative w-full sm:w-64",children:[e.jsx(k,{placeholder:`Search ${N}...`,value:R,onChange:s=>ce(s.target.value),className:"pl-9 h-10 border-blue-100 focus:border-blue-400 rounded-xl text-[11px]"}),e.jsx("i",{className:"fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm"})]}),(F||O)&&e.jsx(h,{onClick:me,variant:"primary",className:"",children:"+ Add Row"}),(F||O)&&e.jsxs(h,{onClick:he,isLoading:se,className:"bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx("i",{className:"fas fa-file mr-2"})," Save Items"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(h,{onClick:()=>E("description"),className:"bg-indigo-600 hover:bg-indigo-700 text-white h-10 rounded-xl text-[11px] font-bold shadow-sm px-4 shrink-0",children:[e.jsx("i",{className:"fas fa-file-alt mr-2"})," Scope"]}),e.jsxs(h,{onClick:()=>E("catalogue"),className:"bg-blue-600 hover:bg-blue-700 text-white h-10 rounded-xl text-[11px] font-bold shadow-sm px-4 shrink-0",children:[e.jsx("i",{className:"fas fa-book-open mr-2"})," Catalogue"]})]})]})]}),e.jsx("div",{className:"overflow-x-auto min-h-[450px]",children:e.jsxs("table",{className:"min-w-full bg-white text-sm",children:[e.jsx("thead",{className:"bg-blue-50 text-sm font-semibold text-gray-600 px-6 py-1 sm:py-3",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-6 py-1 sm:py-3  text-xs font-medium text-gray-500 uppercase tracking-wider",children:"S.NO"}),y.map(s=>{const r=(s==null?void 0:s.key)==="manufacturCostPerSqft";return e.jsx("th",{className:"text-center px-2 py-3 text-xs font-medium text-gray-500 tracking-wider min-w-[80px] max-w-[100px]",children:r?"Mfg Cost / Sqft":s.key},s.key)}),e.jsx("th",{className:"text-center px-6 py-1 sm:py-3  text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsxs("tbody",{children:[z==null?void 0:z.map((s,r)=>{const a=le===s._id;return e.jsxs("tr",{className:`group border-b border-gray-100 transition-all duration-200 ${a?"bg-blue-50/50":"hover:bg-gray-50"}`,children:[e.jsx("td",{className:"p-4 font-medium text-center text-sm text-gray-700",children:r+1}),y==null?void 0:y.map(t=>e.jsx("td",{className:"p-2 border border-gray-100 text-center",children:a?t.type==="file"?e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx(k,{type:"file",accept:"image/*",className:"w-full h-9 text-[10px] px-1",onChange:n=>{var i;const l=(i=n.target.files)==null?void 0:i[0];l&&I({...g,[t.key]:l})}}),typeof g[t.key]=="string"&&e.jsxs("span",{className:"text-[9px] text-blue-600 truncate max-w-[100px]",children:["Current: ",g[t.key].split("/").pop()]})]}):e.jsx(k,{type:t.type==="number"?"number":"text",value:g[t.key]||"",onChange:n=>I({...g,[t.key]:t.type==="number"?Math.max(0,Number(n.target.value)):n.target.value}),className:"w-full h-10 text-sm"}):t.type==="file"?s!=null&&s.data[t.key]?e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:s==null?void 0:s.data[t==null?void 0:t.key],alt:t==null?void 0:t.key,onClick:()=>A(s==null?void 0:s.data[t==null?void 0:t.key]),className:"w-20 h-20 rounded-md object-cover border-2 border-blue-100 cursor-pointer hover:scale-110 transition-transform shadow-sm",title:"Click to preview"})}):e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"w-20 h-20 rounded-md bg-slate-50 flex items-center justify-center border border-dashed border-slate-200",children:e.jsx("i",{className:"fas fa-image text-slate-300 text-[10px]"})})}):e.jsx("span",{className:"text-sm text-gray-700",children:(s==null?void 0:s.data[t==null?void 0:t.key])||"—"})},t==null?void 0:t.key)),e.jsx("td",{className:"text-center p-4 border border-gray-100",children:e.jsx("div",{className:"flex justify-center gap-2",children:a?e.jsxs(e.Fragment,{children:[e.jsx(h,{size:"sm",variant:"primary",className:"text-white h-8",onClick:()=>xe(s._id),isLoading:ne,children:e.jsx("i",{className:"fas fa-check"})}),e.jsx(h,{size:"sm",variant:"secondary",className:"  h-8",onClick:de,children:e.jsx("i",{className:"fas fa-x"})})]}):e.jsxs(e.Fragment,{children:[F&&e.jsx(h,{size:"sm",variant:"ghost",className:"text-blue-600 hover:bg-blue-50 h-8",onClick:()=>oe(s),children:e.jsx("i",{className:"fas fa-pen-to-square"})}),Y&&e.jsx(h,{size:"sm",variant:"danger",isLoading:ae,className:"bg-red-600 text-white h-8",onClick:()=>te({itemId:s==null?void 0:s._id,categoryId:v}),children:e.jsx("i",{className:"fas fa-trash"})})]})})})]},`existing-${s==null?void 0:s._id}`)}),b.map((s,r)=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-all duration-200",children:[e.jsx("td",{className:"p-4 text-center text-gray-400",children:"—"}),y.map(a=>e.jsx("td",{className:"p-2 border border-gray-100",children:a.type==="file"?e.jsx(k,{type:"file",accept:"image/*",className:"w-full h-8 text-[10px] px-1",onChange:t=>{var l;const n=(l=t.target.files)==null?void 0:l[0];n&&_(r,a.key,n)}}):e.jsx(k,{type:a.type==="number"?"number":"text",placeholder:a.key,className:"w-full h-8 text-xs",value:s.data[a.key]||"",onChange:t=>_(r,a.key,a.type==="number"?Math.max(0,Number(t.target.value)):t.target.value)})},a.key)),e.jsx("td",{className:"text-center p-4",children:e.jsxs(h,{size:"sm",variant:"ghost",className:"group text-white bg-red-600 hover:bg-red-600",onClick:()=>ue(r),children:[e.jsx("i",{className:"fas fa-xmark mr-2"})," Remove"]})})]},`new-${r}`))]})]})}),B&&e.jsxs("section",{className:"fixed inset-0 z-[999] flex items-center justify-center p-0 animate-in fade-in duration-200",children:[e.jsx("div",{className:"absolute inset-0 bg-black/90 cursor-zoom-out",onClick:()=>A(null)}),e.jsxs("div",{className:"relative z-[1000] flex flex-col items-center",children:[e.jsx("button",{onClick:()=>A(null),className:"absolute -top-10 right-0 text-white/70 hover:text-white transition-colors p-2",children:e.jsx("i",{className:"fas fa-times text-2xl"})}),e.jsx("img",{src:B,alt:"Preview",className:"max-w-screen max-h-screen object-contain pointer-events-auto",onClick:s=>s.stopPropagation()})]})]})]})}export{Fe as default,Ce as materialTypeOptions};
