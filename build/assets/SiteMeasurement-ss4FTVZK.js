import{f as w,b as he,h as v,s as S,i as y,u as z,r as A,k as K,j as e,ae as te,B as $,t as x,aH as ge,af as xe,a as pe,M as fe}from"./index-BAM0eJUz.js";import{C as Z}from"./Card-CdxfjEr-.js";import{A as be,S as we}from"./AssignStaff-Bt6qrEbL.js";import{R as ye}from"./StageFileUploader-C8lCFpfp.js";import{I as je}from"./Input-1UBXZqEj.js";import{d as D}from"./downloadFile-BbGV_BaX.js";import{R as Ne}from"./ResetStageButton-DaUxSSZv.js";import{S as ve}from"./StageGuide-e28gQ0h1.js";import"./getAllUsersApi-O0JEgRtZ.js";import"./index-C8BdbktQ.js";import"./ImageGalleryMain-B3g6b13d.js";import"./ShortListMain-CkHPlJB3.js";import"./VideoGalleryMain-frK0Wxau.js";const Se=async({projectId:t,siteDetails:s,api:a})=>{const{data:r}=await a.post(`/sitemeasurement/createmeasurement/${t}`,{siteDetails:s});if(!r.ok)throw new Error(r.message);return r.data},Ce=async({projectId:t,room:s,api:a})=>{const{data:r}=await a.post(`/sitemeasurement/createroom/${t}`,{room:s});if(!r.ok)throw new Error(r.message);return r.data},Fe=async({projectId:t,api:s})=>{const{data:a}=await s.get(`/sitemeasurement/getmeasurement/${t}`);if(!a.ok)throw new Error(a.message);return a.data},ke=async({projectId:t,api:s,payload:a})=>{const{data:r}=await s.put(`/sitemeasurement/updatecommonmeasurement/${t}`,a);if(!r.ok)throw new Error(r.message);return r.data},Ee=async({projectId:t,api:s,roomId:a,room:r})=>{const{data:n}=await s.put(`/sitemeasurement/updateroommeasurement/${t}/${a}`,{room:r});if(!n.ok)throw new Error(n.message);return n.data},Ae=async({projectId:t,api:s})=>{const{data:a}=await s.put(`/sitemeasurement/completionstatus/${t}`);if(!a.ok)throw new Error(a.message);return a.data},Re=async({projectId:t,roomId:s,api:a})=>{const{data:r}=await a.patch(`/sitemeasurement/deleteroom/${t}/${s}`);if(!r.ok)throw new Error(r.message);return r.data},Me=async({projectId:t,api:s})=>{const{data:a}=await s.put(`/sitemeasurement/deletesitemeasurement/${t}`);if(!a.ok)throw new Error(a.message);return a.data},Pe=async({formId:t,projectId:s,deadLine:a,api:r})=>{const{data:n}=await r.put(`/sitemeasurement/deadline/${s}/${t}`,{deadLine:a});if(!n.ok)throw new Error(n.message);return n.data},Ie=async({formId:t,files:s,api:a,projectId:r})=>{const n=new FormData;return s.forEach(u=>n.append("file",u)),(await a.post(`/sitemeasurement/upload/multiple/${r}/${t}`,n,{headers:{"Content-Type":"multipart/form-data"}})).data},qe=async(t,s,a)=>{const{data:r}=await a.patch(`/sitemeasurement/${t}/deleteuploadedfile/${s}`);if(!r.ok)throw new Error(r.message);return r.data},$e=()=>{const{role:t}=w(),s=y(t),a=["owner","staff","CTO","client"];return v({mutationFn:async({projectId:r,fileId:n})=>{if(!t||!a.includes(t))throw new Error("not allowed to make this api call");if(!s)throw new Error("API instance not found for role");return await qe(r,n,s)},onSuccess:(r,{projectId:n})=>{S.invalidateQueries({queryKey:["siteMeasurement",n]})}})},Oe=({projectId:t})=>{const s=["owner","staff","CTO","client"],{role:a}=w(),r=y(a);return he({queryKey:["siteMeasurement",t],queryFn:async()=>{if(!a||!s.includes(a))throw new Error("not allowed to make this api call");if(!r)throw new Error("API instance not found for role");return await Fe({projectId:t,api:r})},retry:!1})},Le=()=>{const t=["owner","staff","CTO","client"],{role:s}=w(),a=y(s);return v({mutationFn:async({projectId:r,siteDetails:n})=>{if(!s||!t.includes(s))throw new Error("not allowed to make this api call");if(!a)throw new Error("API instance not found for role");return await Se({projectId:r,api:a,siteDetails:n})},onSuccess:(r,{projectId:n})=>{S.invalidateQueries({queryKey:["siteMeasurement",n]})}})},Te=()=>{const t=["owner","staff","CTO","client"],{role:s}=w(),a=y(s);return v({mutationFn:async({projectId:r,room:n})=>{if(!s||!t.includes(s))throw new Error("not allowed to make this api call");if(!a)throw new Error("API instance not found for role");return await Ce({projectId:r,api:a,room:n})},onSuccess:(r,{projectId:n})=>{S.invalidateQueries({queryKey:["siteMeasurement",n]})}})},_e=()=>{const t=["owner","staff","CTO","client"],{role:s}=w(),a=y(s);return v({mutationFn:async({projectId:r,payload:n})=>{if(!s||!t.includes(s))throw new Error("not allowed to make this api call");if(!a)throw new Error("API instance not found for role");return await ke({projectId:r,api:a,payload:n})},onSuccess:(r,{projectId:n})=>{S.invalidateQueries({queryKey:["siteMeasurement",n]})}})},Ue=()=>{const t=["owner","staff","CTO","client"],{role:s}=w(),a=y(s);return v({mutationFn:async({projectId:r,roomId:n,room:o})=>{if(!s||!t.includes(s))throw new Error("not allowed to make this api call");if(!a)throw new Error("API instance not found for role");return await Ee({projectId:r,api:a,roomId:n,room:o})},onSuccess:(r,{projectId:n})=>{S.invalidateQueries({queryKey:["siteMeasurement",n]})}})},Be=()=>{const t=["owner","staff","CTO","client"],{role:s}=w(),a=y(s);return v({mutationFn:async({projectId:r})=>{if(!s||!t.includes(s))throw new Error("not allowed to make this api call");if(!a)throw new Error("API instance not found for role");return await Ae({projectId:r,api:a})},onSuccess:(r,{projectId:n})=>{S.invalidateQueries({queryKey:["siteMeasurement",n]})}})},Ke=()=>{const t=["owner","staff","CTO","client"],{role:s}=w(),a=y(s);return v({mutationFn:async({projectId:r,roomId:n})=>{if(!s||!t.includes(s))throw new Error("not allowed to make this api call");if(!a)throw new Error("API instance not found for role");return await Re({projectId:r,api:a,roomId:n})},onSuccess:(r,{projectId:n})=>{S.invalidateQueries({queryKey:["siteMeasurement",n]})}})},ze=()=>{const t=["owner","staff","CTO","client"],{role:s}=w(),a=y(s);return v({mutationFn:async({projectId:r})=>{if(!s||!t.includes(s))throw new Error("not allowed to make this api call");if(!a)throw new Error("API instance not found for role");return await Me({projectId:r,api:a})},onSuccess:(r,{projectId:n})=>{S.invalidateQueries({queryKey:["siteMeasurement",n]})}})},Qe=()=>{const t=["owner","staff","CTO"],{role:s}=w(),a=y(s);return v({mutationFn:async({formId:r,projectId:n,deadLine:o})=>{if(!s)throw new Error("not authorized");if(!t.includes(s))throw new Error("you  dont have the access to make this api");if(!a)throw new Error("api is null");return await Pe({formId:r,deadLine:o,projectId:n,api:a})},onSuccess:(r,{projectId:n})=>{S.invalidateQueries({queryKey:["siteMeasurement",n]})}})},We=()=>{const t=["owner","staff","CTO","client"],{role:s}=w(),a=y(s);return v({mutationFn:async({formId:r,files:n,projectId:o})=>{if(!s)throw new Error("not authorized");if(!t.includes(s))throw new Error("you  dont have the access to make this api");if(!a)throw new Error("api is null");return await Ie({formId:r,files:n,projectId:o,api:a})},onSuccess:(r,{projectId:n})=>{S.invalidateQueries({queryKey:["siteMeasurement",n]})}})},He=async({roomId:t,files:s,api:a,projectId:r})=>(await a.post(`/sitemeasurement/uploadroom/${r}/${t}`,s,{headers:{"Content-Type":"multipart/form-data"}})).data,Ge=async({roomId:t,uploadId:s,api:a,projectId:r})=>(await a.delete(`/sitemeasurement/deleteroom/${r}/${t}/${s}`)).data,Ye=async({projectId:t,roomId:s,uploadId:a,categoryName:r,api:n})=>{const{data:o}=await n.patch(`/sitemeasurement/updateimgname/${t}/${s}/${a}`,{categoryName:r});if(!o.ok)throw new Error(o.message);return o.data},Ve=()=>{const t=["owner","staff","CTO","client"],{role:s}=w(),a=y(s);return v({mutationFn:async({roomId:r,files:n,projectId:o})=>{if(!s)throw new Error("not authorized");if(!t.includes(s))throw new Error("you  dont have the access to make this api");if(!a)throw new Error("api is null");return await He({roomId:r,files:n,projectId:o,api:a})},onSuccess:(r,{projectId:n})=>{S.invalidateQueries({queryKey:["siteMeasurement",n]})}})},Je=()=>{const t=["owner","staff","CTO","client"],{role:s}=w(),a=y(s);return v({mutationFn:async({roomId:r,uploadId:n,projectId:o})=>{if(!s)throw new Error("not authorized");if(!t.includes(s))throw new Error("you  dont have the access to make this api");if(!a)throw new Error("api is null");return await Ge({roomId:r,uploadId:n,projectId:o,api:a})},onSuccess:(r,{projectId:n})=>{S.invalidateQueries({queryKey:["siteMeasurement",n]})}})},Xe=()=>{const t=["owner","staff","CTO"],{role:s}=w(),a=y(s);return v({mutationFn:async({projectId:r,roomId:n,uploadId:o,categoryName:u})=>{if(!s||!t.includes(s))throw new Error("Not allowed to make this API call");if(!a)throw new Error("API instance not found for role");return await Ye({projectId:r,roomId:n,uploadId:o,categoryName:u,api:a})},onSuccess:(r,{projectId:n})=>{S.invalidateQueries({queryKey:["siteMeasurement",n]})}})},Ze=({file:t,setPreviewImage:s,room:a})=>{var C,P,I;const{projectId:r}=z(),[n,o]=A.useState(!1),[u,m]=A.useState((t==null?void 0:t.categoryName)||""),{mutateAsync:d,isPending:k}=Je(),{mutateAsync:O,isPending:p}=Xe(),{role:j,permission:h}=K(),R=j==="owner"||((C=h==null?void 0:h.sitemeasurement)==null?void 0:C.delete),i=j==="owner"||((P=h==null?void 0:h.sitemeasurement)==null?void 0:P.create),L=j==="owner"||((I=h==null?void 0:h.sitemeasurement)==null?void 0:I.edit),E=async l=>{var f,F;try{await d({roomId:a._id,uploadId:l,projectId:r}),x({title:"Success",description:"Image deleted successfully"})}catch(M){x({title:"Error",description:((F=(f=M==null?void 0:M.response)==null?void 0:f.data)==null?void 0:F.message)||"Failed to delete",variant:"destructive"})}},N=async()=>{var l,f;if(!u||u===t.categoryName){o(!1);return}try{await O({uploadId:t._id,categoryName:u,roomId:a._id,projectId:r}),x({title:"Updated",description:"Image name updated successfully"})}catch(F){x({title:"Error",description:((f=(l=F==null?void 0:F.response)==null?void 0:l.data)==null?void 0:f.message)||"Failed to update name",variant:"destructive"})}finally{o(!1)}},T=["eye","download",...R?["trash"]:[]];return e.jsxs("div",{className:"group bg-white transition-all duration-300 hover:z-10",children:[e.jsxs("div",{className:"relative w-full overflow-hidden border-4 border-white  transition-all duration-300 cursor-pointer",onClick:()=>s(t==null?void 0:t.url),children:[e.jsx("div",{className:"aspect-square w-full",children:e.jsx("img",{src:t.url||te,alt:t.originalName,className:"w-full h-full transition-transform duration-300 "})}),e.jsx("div",{className:"absolute inset-0 bg-opacity-0 group-hover:bg-opacity-40 transition-all duration-300 items-center justify-center hidden md:flex",children:e.jsx("div",{className:"flex space-x-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300 transform translate-y-4 group-hover:translate-y-0",children:T.map(l=>e.jsx($,{variant:"secondary",size:"sm",onClick:f=>{f.stopPropagation(),l==="eye"?s(t==null?void 0:t.url):l==="trash"?E(t._id):D({src:t==null?void 0:t.url,alt:(t==null?void 0:t.originalName)||"image"})},disabled:l==="trash"&&k,className:`rounded-full bg-white hover:bg-gray-100 shadow-lg transition-all duration-200 ${l==="trash"?"hover:bg-red-50":""}`,children:e.jsx("i",{className:`w-3 h-3 fas fa-${l} ${l==="trash"?"text-red-500":l==="download"?"text-blue-500":"text-gray-600"}`})},l))})}),e.jsx("div",{className:"absolute top-2 right-[2px] flex flex-col space-y-1 sm:hidden",children:T.map(l=>e.jsx($,{variant:"secondary",size:"sm",onClick:f=>{f.stopPropagation(),l==="eye"?s(t==null?void 0:t.url):l==="trash"?E(t._id):D({src:t==null?void 0:t.url,alt:(t==null?void 0:t.originalName)||"image"})},disabled:l==="trash"&&k,className:`w-6 h-6 p-0 rounded-full bg-white/90 backdrop-blur-sm border shadow-sm transition-all duration-200 ${l==="trash"?"border-red-200 hover:border-red-300 hover:bg-red-50":l==="download"?"border-blue-200 hover:border-blue-300 hover:bg-blue-50":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,children:e.jsx("i",{className:`w-3 h-3 fas fa-${l} ${l==="trash"?"text-red-500":l==="download"?"text-blue-500":"text-gray-600"}`})},l))})]}),e.jsx("div",{onClick:l=>l.stopPropagation(),className:"my-1 flex items-center justify-between px-1",children:n?e.jsxs("div",{className:"flex w-full items-center space-x-1",children:[e.jsx("input",{value:u,onChange:l=>m(l.target.value),className:"text-sm border px-1 py-0.5 rounded w-full",onKeyDown:l=>{l.key==="Enter"&&N()}}),e.jsx("button",{onClick:N,disabled:p,className:"text-blue-600 cursor-pointer hover:text-blue-800 text-xs",children:p?e.jsx("i",{className:"fa fa-spinner animate-spin"}):e.jsx("i",{className:"fas fa-check"})}),e.jsx("button",{onClick:()=>{o(!1),m(t.categoryName||"")},className:"text-red-500 cursor-pointer hover:text-red-700 text-xs",children:e.jsx("i",{className:"fas fa-times"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-sm text-gray-800 truncate max-w-[80%]",children:(t==null?void 0:t.categoryName)||"No category"}),(L||i)&&e.jsx("button",{className:"text-gray-500 cursor-pointer hover:text-blue-600 text-xs",onClick:()=>o(!0),children:e.jsx("i",{className:"fas fa-pen"})})]})})]},t._id)},De=({room:t,onEdit:s,onDelete:a,deleteRoomLoading:r})=>{var E,N,T;const{projectId:n}=z(),[o,u]=A.useState(null),{role:m,permission:d}=K(),k=m==="owner"||((E=d==null?void 0:d.sitemeasurement)==null?void 0:E.delete),O=m==="owner"||((N=d==null?void 0:d.sitemeasurement)==null?void 0:N.create),p=m==="owner"||((T=d==null?void 0:d.sitemeasurement)==null?void 0:T.edit),j=(t==null?void 0:t.uploads)||[],h=t.length&&t.breadth?(t.length*t.breadth).toFixed(2):null,{mutateAsync:R,isPending:i}=Ve(),L=async C=>{var P,I;try{const l=C.target.files;if(!l||l.length===0)return;const f=Array.from(l).filter(M=>M.type.startsWith("image/"));if(f.length===0){x({title:"Error",description:"Please select only image files",variant:"destructive"});return}f.length!==l.length&&x({title:"Warning",description:"Only image files were uploaded. PDFs were skipped.",variant:"destructive"});const F=new FormData;f.forEach(M=>F.append("file",M)),await R({roomId:t._id,files:F,projectId:n}),x({title:"Success",description:"Images uploaded successfully"}),C.target.value=""}catch(l){x({title:"Error",description:((I=(P=l==null?void 0:l.response)==null?void 0:P.data)==null?void 0:I.message)||"Failed to upload",variant:"destructive"})}};return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-2 sm:p-6 mb-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold text-blue-700",children:t.name}),e.jsxs("div",{className:"flex gap-2",children:[p&&e.jsx("button",{onClick:()=>s(t),className:"text-blue-600 hover:text-blue-800",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),k&&e.jsx($,{isLoading:r,onClick:a,variant:"ghost",className:"!text-red-600 hover:text-red-800 bg-white shadow-none hover:!bg-none",children:e.jsx("i",{className:"fas fa-trash-can"})})]})]}),e.jsxs("div",{className:"space-y-4 w-full",children:[(O||p)&&e.jsxs("div",{className:"flex items-center justify-between w-full relative",children:[e.jsx(je,{type:"file",multiple:!0,accept:"image/*",placeholder:"Select images",onChange:L,disabled:i,className:i?"pr-10 opacity-70 cursor-not-allowed w-full":""}),i&&e.jsx("div",{className:"absolute inset-y-0 right-2 flex items-center",children:e.jsxs("svg",{className:"animate-spin h-5 w-5 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4l3.5-3.5L12 0v4a8 8 0 100 16v4l3.5-3.5L12 20v-4a8 8 0 01-8-8z"})]})})]}),e.jsxs("div",{className:"my-6",children:[e.jsx("h4",{className:"text-lg font-semibold mb-4 text-gray-800",children:"Room Images"}),j.length===0?e.jsx("div",{className:"text-gray-500 text-sm italic bg-gray-50 p-8 rounded-lg text-center border-2 border-dashed border-gray-200",children:"No images uploaded yet."}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 p-4 bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl",children:j.map(C=>e.jsx(Ze,{room:t,setPreviewImage:u,file:C}))})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Length"}),e.jsxs("p",{className:"font-semibold text-gray-800",children:[t.length||0," ft"]})]}),e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Breadth"}),e.jsxs("p",{className:"font-semibold text-gray-800",children:[t.breadth||0," ft"]})]}),e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Height"}),e.jsxs("p",{className:"font-semibold text-gray-800",children:[t.height||0," ft"]})]})]}),h&&e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:e.jsxs("p",{className:"text-blue-700 font-medium text-center",children:["Total Area: ",h," sq.ft"]})}),o&&e.jsx("div",{onClick:()=>u(null),className:"fixed inset-0 z-50 flex items-center justify-center bg-opacity-80 backdrop-blur-sm",children:e.jsxs("div",{onClick:C=>C.stopPropagation(),className:"relative bg-white rounded-xl shadow-2xl max-w-[90%] max-h-[90%] p-2 overflow-hidden",children:[e.jsx("button",{onClick:()=>u(null),className:"absolute top-4 right-4 z-10 w-8 h-8 bg-opacity-50 hover:bg-opacity-70 text-white rounded-full flex items-center justify-center transition-all duration-200",children:e.jsx("i",{className:"fas fa-times text-sm"})}),e.jsx("img",{src:o||te,alt:"Preview",className:"w-full max-h-[80vh] object-contain mx-auto rounded-lg"})]})})]})},et=({measurementData:t,handleDeleteSiteMeasurement:s,deleteRoomLoading:a,setShowSiteForm:r,setShowRoomForm:n,handleEditRoom:o,handleDeleteRoom:u})=>{var j,h,R;const{role:m,permission:d}=K(),k=m==="owner"||((j=d==null?void 0:d.sitemeasurement)==null?void 0:j.delete),O=m==="owner"||((h=d==null?void 0:d.sitemeasurement)==null?void 0:h.create),p=m==="owner"||((R=d==null?void 0:d.sitemeasurement)==null?void 0:R.edit);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Site Measurements"}),e.jsxs("div",{className:"flex gap-2",children:[p&&e.jsx("button",{onClick:()=>r(!0),className:"px-2 sm:px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Edit"}),k&&e.jsx("button",{onClick:()=>s(),className:"px-2 sm:px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"Delete"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total Plot Area"}),e.jsx("p",{className:"text-lg font-semibold text-blue-700",children:t.siteDetails.totalPlotAreaSqFt!==null?`${t.siteDetails.totalPlotAreaSqFt} sq.ft`:"Not mentioned"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Built-up Area"}),e.jsx("p",{className:"text-lg font-semibold text-blue-700",children:t.siteDetails.builtUpAreaSqFt!=null?`${t.siteDetails.builtUpAreaSqFt} sq.ft`:"Not mentioned"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Road Facing"}),e.jsx("p",{className:"text-lg font-semibold text-blue-700",children:t.siteDetails.roadFacing===!0?"YES":t.siteDetails.roadFacing===!1?"NO":"Not mentioned"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Number of Floors"}),e.jsx("p",{className:"text-lg font-semibold text-blue-700",children:t.siteDetails.numberOfFloors!=null?t.siteDetails.numberOfFloors:"Not mentioned"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Is having Slope"}),e.jsx("p",{className:"text-lg font-semibold text-blue-700",children:t.siteDetails.hasSlope===!0?"YES":t.siteDetails.hasSlope===!1?"NO":"Not mentioned"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Is Boundary Wall exists"}),e.jsx("p",{className:"text-lg font-semibold text-blue-700",children:t.siteDetails.boundaryWallExists===!0?"YES":t.siteDetails.boundaryWallExists===!1?"NO":"Not mentioned"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Additional Notes"}),e.jsx("p",{className:"text-lg font-semibold text-blue-700",children:t.siteDetails.additionalNotes?t.siteDetails.additionalNotes:"Not mentioned"})]})]})]}),t.siteDetails.totalPlotAreaSqFt!==null&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Rooms"}),(O||p)&&e.jsx("button",{onClick:()=>n(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"+ Add Room"})]}),t.rooms.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})})}),e.jsx("p",{className:"text-gray-500",children:"No rooms added yet"})]}):e.jsx("div",{className:"mt-4 grid grid-cols-1 gap-6",children:t.rooms.map((i,L)=>e.jsx(De,{room:i,onEdit:()=>o(i),onDelete:()=>u(i._id),deleteRoomLoading:a},L))})]})]})},tt=A.memo(et),st=({roomDetails:t,setRoomDetails:s,handleRoomSubmit:a,setShowRoomForm:r,updateRoomLoading:n,createRoomLoading:o,editingRoomId:u})=>e.jsx("div",{className:"fixed inset-0 bg-black/70 bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-md p-6",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-6",children:u?"Edit Room":"Add New Room"}),e.jsxs("select",{value:t.name||"",onChange:m=>s(d=>({...d,name:m.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent mb-4",children:[e.jsx("option",{value:"",children:"Select Room Type"}),ge.map(m=>e.jsx("option",{value:m,children:m}))]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"",children:"Length (ft)"}),e.jsx("input",{type:"number",placeholder:"Length (ft)",value:t.length||0,onChange:m=>s({...t,length:Number(m.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"",children:"Breadth (ft)"}),e.jsx("input",{type:"number",placeholder:"Breadth (ft)",value:t.breadth||0,onChange:m=>s({...t,breadth:Number(m.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"",children:"Height (ft)"}),e.jsx("input",{type:"number",placeholder:"Height (ft)",value:t.height||0,onChange:m=>s({...t,height:Number(m.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),t.length&&t.breadth&&e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg mb-4",children:e.jsxs("p",{className:"text-blue-700 font-medium",children:["Calculated Area: ",(Number(t.length)*Number(t.breadth)).toFixed(2)," sq.ft"]})}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{onClick:()=>r(!1),className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsx($,{isLoading:u?n:o,onClick:a,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:u?"Edit Room":"Add Room"})]})]})}),at=({siteDetails:t,updatePending:s,setSiteDetails:a,handleSiteSubmit:r,setShowSiteForm:n})=>e.jsx("div",{className:"fixed inset-0 bg-black/70 bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-2xl p-6",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-6",children:"Site Measurements"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"",children:"Total Plot Area (sq.ft)"}),e.jsx("input",{type:"number",placeholder:"Total Plot Area (sq.ft)",value:t.totalPlotAreaSqFt||0,onChange:o=>a({...t,totalPlotAreaSqFt:Number(o.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"",children:"Built-up Area (sq.ft)"}),e.jsx("input",{type:"number",placeholder:"Built-up Area (sq.ft)",value:t.builtUpAreaSqFt||0,onChange:o=>a({...t,builtUpAreaSqFt:Number(o.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"",children:"Number of Floors"}),e.jsx("input",{type:"number",placeholder:"Number of Floors",value:t.numberOfFloors||0,onChange:o=>a({...t,numberOfFloors:Number(o.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 mb-4",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:t.hasSlope??!1,onChange:o=>a({...t,hasSlope:o.target.checked}),className:"mr-2"}),"Has Slope"]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:t.roadFacing??!1,onChange:o=>a({...t,roadFacing:o.target.checked}),className:"mr-2"}),"Road Facing"]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:t.boundaryWallExists??!1,onChange:o=>a({...t,boundaryWallExists:o.target.checked}),className:"mr-2"}),"Boundary Wall Exists"]})]}),e.jsx("textarea",{placeholder:"Additional Notes",value:t.additionalNotes||"",onChange:o=>a({...t,additionalNotes:o.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent mb-4",rows:4}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx($,{variant:"secondary",onClick:()=>n(!1),className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsx($,{variant:"primary",onClick:r,isLoading:s,children:"Save Details"})]})]})}),rt=A.memo(at),nt={totalPlotAreaSqFt:null,builtUpAreaSqFt:null,roadFacing:null,numberOfFloors:null,hasSlope:!1,boundaryWallExists:!1,additionalNotes:null},ee={name:null,length:null,breadth:null,height:null,uploads:[]};function wt(){var W,H,G,Y,V,J,X;const{projectId:t,organizationId:s}=z(),{isMobile:a,openMobileSidebar:r}=xe();if(!t)return;const n=pe(),[o,u]=A.useState(!1),[m,d]=A.useState(!1),[k,O]=A.useState(nt),[p,j]=A.useState(ee),[h,R]=A.useState(null);let{data:i,isLoading:L,refetch:E,error:N}=Oe({projectId:t});const T=Le(),C=Te(),P=_e(),I=Ue(),l=Ke(),f=ze(),F=Be(),{mutateAsync:M,isPending:se}=Qe(),{mutateAsync:ae,isPending:re}=We(),{mutateAsync:ne,isPending:oe}=$e(),{role:Q,permission:_}=K(),U=Q==="owner"||((W=_==null?void 0:_.sitemeasurement)==null?void 0:W.create),B=Q==="owner"||((H=_==null?void 0:_.sitemeasurement)==null?void 0:H.edit),le=async()=>{var g,b;try{Object.values(i.siteDetails).some(q=>typeof q=="number")?await P.mutateAsync({projectId:t,payload:k}):await T.mutateAsync({projectId:t,siteDetails:k}),u(!1),x({description:"Site details updated successfully",title:"Success"})}catch(c){x({title:"Error",description:((b=(g=c==null?void 0:c.response)==null?void 0:g.data)==null?void 0:b.message)||c.message||"Failed to save site details",variant:"destructive"})}},ie=async()=>{var g,b;try{if(!p.name)throw new Error("please select the name");const c=p.length&&p.breadth?(Number(p.length)*Number(p.breadth)).toFixed(2):null,q={...p,area:c};h?await I.mutateAsync({projectId:t,roomId:h,room:q}):await C.mutateAsync({projectId:t,room:q}),d(!1),R(null),j(ee),x({description:h?"Room updated":"Room added",title:"Success"})}catch(c){x({title:"Error",description:((b=(g=c==null?void 0:c.response)==null?void 0:g.data)==null?void 0:b.message)||(c==null?void 0:c.message)||"Operation failed",variant:"destructive"})}},de=async g=>{var b,c;try{await l.mutateAsync({projectId:t,roomId:g}),x({description:"Room deleted",title:"Success"})}catch(q){x({title:"Error",description:((c=(b=q==null?void 0:q.response)==null?void 0:b.data)==null?void 0:c.message)||"Delete failed",variant:"destructive"})}},ce=async()=>{var g,b;try{await f.mutateAsync({projectId:t}),x({description:"Site measurement deleted",title:"Success"})}catch(c){x({title:"Error",description:((b=(g=c==null?void 0:c.response)==null?void 0:g.data)==null?void 0:b.message)||"Delete failed",variant:"destructive"})}},ue=async()=>{var g,b;try{await F.mutateAsync({projectId:t}),x({description:"Completion updated",title:"Success"}),n("../sampledesign")}catch(c){x({title:"Error",description:((b=(g=c==null?void 0:c.response)==null?void 0:g.data)==null?void 0:b.message)||"Update failed",variant:"destructive"})}},me=g=>{j(g),R(g==null?void 0:g._id),d(!0)};return L?e.jsx(fe,{}):e.jsxs("div",{className:"container mx-auto px-2 py-2 max-w-full h-full w-full overflow-y-auto custom-scrollbar",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center mb-6 gap-4",children:[e.jsxs("div",{className:"w-full sm:w-auto",children:[e.jsxs("h2",{className:"text-2xl sm:text-3xl font-semibold text-blue-600 flex items-center",children:[a&&e.jsx("button",{onClick:r,className:"mr-3 p-2 rounded-md border border-gray-300 hover:bg-gray-100",title:"Open Menu",children:e.jsx("i",{className:"fa-solid fa-bars"})}),e.jsx("i",{className:"fa-solid fa-receipt mr-2"})," Site Measurement"]}),e.jsx("p",{className:"text-gray-600 hidden sm:block text-sm sm:text-base",children:"Plan your dream home"})]}),e.jsxs("div",{className:"flex flex-wrap sm:flex-nowrap items-center gap-2  !w-[100%] sm:!w-[50%] lg:!w-[60%] justify-start lg:justify-end",children:[(U||B)&&e.jsxs($,{isLoading:F.isPending,onClick:ue,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2  w-full sm:w-auto",children:[e.jsx("i",{className:"fa-solid fa-circle-check mr-2"})," Mark Complete"]}),(U||B)&&e.jsx(Ne,{projectId:t,stageNumber:2,stagePath:"sitemeasurement",className:"sm:!max-w-[20%] w-full"}),e.jsx(be,{stageName:"SiteMeasurementModel",projectId:t,organizationId:s,currentAssignedStaff:(i==null?void 0:i.assignedTo)||null,className:"w-full sm:w-auto"}),e.jsx("div",{className:"w-full sm:w-auto flex justify-end sm:block",children:e.jsx(ve,{organizationId:s,stageName:"sitemeasurement"})})]})]}),N&&e.jsxs("div",{className:"max-w-xl mx-auto mt-4 p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2",children:"⚠️ Error Occurred"}),e.jsx("p",{className:"text-red-500 text-sm mb-4",children:((Y=(G=N==null?void 0:N.response)==null?void 0:G.data)==null?void 0:Y.message)||"Failed to load data"}),e.jsx($,{onClick:()=>E(),className:"bg-red-600 text-white px-4 py-2",children:"Retry"})]}),!N&&e.jsxs(Z,{className:"p-4 mb-4 shadow border-l-4 border-blue-600 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-3 text-blue-700 text-sm font-medium mb-2",children:[e.jsx("i",{className:"fa-solid fa-clock text-blue-500 text-lg"}),e.jsx("span",{children:"Stage Timings"})]}),e.jsx(we,{completedAt:(V=i==null?void 0:i.timer)==null?void 0:V.compltedAt,stageName:"sitemeasurement",formId:i==null?void 0:i._id,projectId:t,deadLine:(J=i==null?void 0:i.timer)==null?void 0:J.deadLine,startedAt:(X=i==null?void 0:i.timer)==null?void 0:X.startedAt,refetchStageMutate:E,deadLineMutate:M,isPending:se})]}),!N&&e.jsx("div",{className:"mb-6",children:e.jsx(Z,{className:"p-4 shadow border-l-4 border-blue-500 bg-white",children:e.jsx(ye,{enableUpload:B||U,autoUpload:!0,formId:i==null?void 0:i._id,refetch:E,existingUploads:i==null?void 0:i.uploads,onUploadComplete:E,uploadFilesMutate:ae,uploadPending:re,projectId:t,onDeleteUpload:ne,deleteFilePending:oe})})}),!N&&e.jsxs(e.Fragment,{children:[!Object.values((i==null?void 0:i.siteDetails)||{}).some(g=>g!==null)&&!o?e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})})}),e.jsx("p",{className:"text-gray-600 mb-4",children:"No Site Details Added"}),(B||U)&&e.jsx("button",{onClick:()=>u(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"Add Site Details"})]}):e.jsx(tt,{measurementData:i,handleDeleteSiteMeasurement:ce,setShowSiteForm:u,setShowRoomForm:d,handleEditRoom:me,handleDeleteRoom:de,deleteRoomLoading:l.isPending}),o&&e.jsx(rt,{siteDetails:k,setSiteDetails:O,handleSiteSubmit:le,setShowSiteForm:u,updatePending:P.isPending}),m&&e.jsx(st,{handleRoomSubmit:ie,setShowRoomForm:d,roomDetails:p,setRoomDetails:j,updateRoomLoading:I.isPending,createRoomLoading:C.isPending,editingRoomId:h})]})]})}export{wt as default};
