import{u,a as v,j as b}from"./index-Duiduteo.js";import{u as h}from"./designLabApi-BFjg_u4P.js";import{D as y}from"./DesignLabForm-CEY1Iz7y.js";import{t as m}from"./toast-BSC5QTk1.js";import"./useQuery-C2l_NFV4.js";import"./useMutation-BNs_TkNH.js";import"./useInfiniteQuery-BEsLEhdS.js";import"./roleCheck-CeVvsM7Q.js";import"./Button-DF5tm_KZ.js";const w=()=>{const c=u(),{organizationId:r}=v(),{mutateAsync:d,isPending:l}=h(),f=async n=>{const t=new FormData,o=[];n.newRefFiles.forEach(e=>{t.append("files",e),o.push({target:"reference"})});const p=n.components.map(e=>{const a=e.materials.filter(i=>{var s;return((s=i.materialName)==null?void 0:s.trim())||i.rate!==""&&i.rate!==0});return{...e,materials:a}}),g={...n,organizationId:r,components:p.map(e=>({...e,materials:e.materials.map(a=>({...a,vendorId:a.vendorId===""?void 0:a.vendorId}))}))};p.forEach((e,a)=>{e.materials.forEach((i,s)=>{i.tempFile&&(t.append("files",i.tempFile),o.push({target:"material",componentIndex:a,materialIndex:s}))})}),t.append("data",JSON.stringify(g)),t.append("fileMapping",JSON.stringify(o)),t.append("organizationId",r);try{await d({organizationId:r,formData:t}),m({title:"Success",description:"Design created successfully"}),c(`/design-lab/${r}`)}catch(e){console.error(e),m({title:"Error",description:e.message||"Failed to create design",variant:"destructive"})}};return b.jsx(y,{mode:"create",organizationId:r,onSubmit:f,isLoading:l})};export{w as default};
