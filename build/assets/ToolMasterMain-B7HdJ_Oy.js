import{j as e,b as A,d as D,a as E,r as m,O as I}from"./index-By5P0A7l.js";import{u as L}from"./useDebounce-DqqsQWok.js";import{u as P,a as F}from"./toolMasterApi-BHuKq0rA.js";import{t as b}from"./toast-BSC5QTk1.js";import{B as g}from"./Button-DLUK8O0t.js";import{B as M}from"./Breadcrumb-CBhb_ayJ.js";import"./useQuery-Cc7pLKfK.js";import"./useMutation-7YLqc7VE.js";import"./useInfiniteQuery-DQF0m-E9.js";import"./roleCheck-YGaMnK_P.js";const z=({tool:t,onView:r,onDelete:i})=>{var o,l;const c={available:"bg-green-100 text-green-700 border-green-200",issued:"bg-blue-100 text-blue-700 border-blue-200",repair:"bg-orange-100 text-orange-700 border-orange-200",missing:"bg-red-100 text-red-700 border-red-200"};return e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 overflow-hidden shadow-sm hover:shadow-md transition-shadow group",children:[e.jsxs("div",{className:"h-40 bg-gray-100 relative overflow-hidden",children:[(l=(o=t.toolImages)==null?void 0:o[0])!=null&&l.url?e.jsx("img",{src:t.toolImages[0].url,alt:t.toolName,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-300",children:e.jsx("i",{className:"fas fa-tools text-4xl"})}),e.jsx("div",{className:`absolute top-3 right-3 px-2 py-1 rounded-md text-[10px] font-bold uppercase border ${c[t.availabilityStatus]}`,children:t.availabilityStatus}),e.jsx("div",{className:"absolute bottom-3 left-3 px-2 py-0.5 bg-black/60 text-white text-[10px] font-mono rounded backdrop-blur-sm",children:t.toolCode})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("h3",{className:"font-bold text-gray-900 truncate",children:t.toolName}),e.jsxs("p",{className:"text-xs text-gray-500",children:[t.brand," â€¢ ",t.toolCategory]})]}),e.jsxs("div",{className:"space-y-2 border-t pt-3",children:[e.jsxs("div",{className:"flex justify-between text-[11px]",children:[e.jsx("span",{className:"text-gray-400",children:"Serial No:"}),e.jsx("span",{className:"font-medium text-gray-700",children:t.serialNumber})]}),e.jsxs("div",{className:"flex justify-between text-[11px]",children:[e.jsx("span",{className:"text-gray-400",children:"Condition:"}),e.jsx("span",{className:`font-bold capitalize ${t.conditionStatus==="repair"?"text-red-500":"text-gray-700"}`,children:t.conditionStatus})]})]}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx(g,{onClick:r,variant:"outline",className:"flex-1 py-1 h-8 text-xs",children:"Details"}),e.jsx("button",{onClick:i,className:"p-2 text-gray-400 hover:text-red-600 transition-colors",children:e.jsx("i",{className:"fas fa-trash-alt"})})]})]})]})},B=["Drill","Saw","Grinder","Cutter","Laser Level","Other"],O=["available","issued","repair","missing"],Q=()=>{const t=A(),r=D(),{organizationId:i}=E(),c=r.pathname.includes("single")||r.pathname.includes("create")||r.pathname.includes("issueotp"),o=m.useRef(null),[l,n]=m.useState({search:"",toolCategory:"",conditionStatus:"",availabilityStatus:"",minPrice:"",maxPrice:""}),p=L(l.search,700),{data:d,isLoading:j,fetchNextPage:u,hasNextPage:h,isFetchingNextPage:x}=P({organizationId:i,...l,toolName:p}),v=F();m.useEffect(()=>{const s=o.current;if(!s)return;const a=()=>{const{scrollTop:S,scrollHeight:T,clientHeight:k}=s;T-S-k<100&&h&&!x&&u()};return s.addEventListener("scroll",a),()=>s.removeEventListener("scroll",a)},[h,x,u]);const N=async s=>{if(window.confirm("Delete this tool from the registry?"))try{await v.mutateAsync(s),b({title:"Deleted",description:"Tool removed successfully"})}catch(a){b({title:"Error",description:a.message,variant:"destructive"})}},y=()=>{n({search:"",toolCategory:"",conditionStatus:"",availabilityStatus:"",minPrice:"",maxPrice:""})},w=Object.values(l).filter(s=>s!=="").length,f=(d==null?void 0:d.pages.flatMap(s=>s.data))||[],C=[{label:"Tools & Hardware",path:`/organizations/${i}/projects/toolhub`},{label:"Tool Master",path:`/organizations/${i}/projects/toolmain`}];return c?e.jsx(I,{}):e.jsxs("div",{className:"h-full flex flex-col p-2",children:[e.jsxs("header",{className:"flex border-b border-gray-400 justify-between items-center mb-3 px-1 shrink-0",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-tools mr-3 text-blue-600"}),"Tool Master"]}),e.jsx(M,{paths:C})]}),e.jsx("div",{className:"flex gap-2 items-center",children:e.jsxs(g,{onClick:()=>t("create"),className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700 shadow-md",children:[e.jsx("i",{className:"fas fa-plus"}),"Create Tool"]})})]}),e.jsxs("main",{className:"flex gap-6 flex-1 overflow-hidden",children:[e.jsx("aside",{className:"xl:w-72 w-64 flex-shrink-0 overflow-y-auto custom-scrollbar pb-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-5 border border-gray-100 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-filter mr-2 text-blue-600"}),"Filters"]}),w>0&&e.jsx("button",{onClick:y,className:"text-sm text-blue-600 cursor-pointer hover:text-blue-800 font-medium",children:"Clear All"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Search"}),e.jsx("input",{type:"text",placeholder:"Tool name, Serial No...",value:l.search,autoFocus:!0,onChange:s=>n(a=>({...a,search:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition-all"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tool Category"}),e.jsxs("select",{value:l.toolCategory,onChange:s=>n(a=>({...a,toolCategory:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white outline-none",children:[e.jsx("option",{value:"",children:"All Categories"}),B.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Availability"}),e.jsxs("select",{value:l.availabilityStatus,onChange:s=>n(a=>({...a,availabilityStatus:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white outline-none",children:[e.jsx("option",{value:"",children:"All Status"}),O.map(s=>e.jsx("option",{value:s,className:"capitalize",children:s},s))]})]})]})]})}),e.jsx("section",{className:"flex-1 flex flex-col overflow-hidden",children:e.jsxs("div",{ref:o,className:"flex-1 overflow-y-auto custom-scrollbar pr-2",children:[j?e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx("i",{className:"fas fa-spinner fa-spin text-3xl text-blue-600"})}):f.length===0?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-gray-400 bg-white rounded-xl border border-dashed border-gray-300",children:[e.jsx("i",{className:"fas fa-box-open text-5xl mb-4 opacity-20"}),e.jsx("p",{children:"No tools found matching your criteria"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:f.map(s=>e.jsx(z,{tool:s,onDelete:()=>N(s._id),onView:()=>t(`single/${s._id}`)},s._id))}),x&&e.jsxs("div",{className:"py-4 text-center text-blue-600 font-medium text-sm",children:[e.jsx("i",{className:"fas fa-circle-notch fa-spin mr-2"})," Fetching more..."]})]})})]})]})};export{Q as default};
