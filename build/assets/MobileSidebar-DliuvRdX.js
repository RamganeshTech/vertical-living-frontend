import{r as u,h as P,s as I,ao as Ne,ap as ye,aq as ve,a0 as Ce,ar as ke,R as q,F as ee,ag as C,j as e,a as M,u as O,d as Le,v as se,ah as te,as as Ae,at as Oe,C as A,L as B,B as U,au as ae,av as ne,aw as oe,ax as ie,ay as re,az as le,t as z}from"./index-BAM0eJUz.js";import{u as Pe}from"./currentActiveStageApi-CYcZaWni.js";import{c as Ee}from"./notificationApi-DYIWgdjl.js";import{f as $e}from"./issueDiscussionApi-CgOxgxFZ.js";function _e(s,a){u.useEffect(()=>{const i=o=>{o.ctrlKey&&o.key==="]"?(o.preventDefault(),a()):o.ctrlKey&&o.key==="["&&(o.preventDefault(),s())};window.addEventListener("keydown",i)},[a,s])}const Te=async()=>{const{data:s}=await Ne.post("/auth/CTO/logout");if(!s.ok)throw new Error(s.message);return s},ce=()=>P({mutationFn:Te,onSuccess:()=>{I.clear()}}),Se=async()=>{const{data:s}=await ye.post("/auth/client/logout");if(!s.ok)throw new Error(s.message);return s},de=()=>P({mutationFn:Se,onSuccess:()=>{I.clear()}}),Be=async()=>{const{data:s}=await ve.post("/auth/staff/logout");if(!s.ok)throw new Error(s.message);return s},fe=()=>P({mutationFn:Be,onSuccess:()=>{I.clear()}}),ze=async()=>{try{let{data:s}=await Ce.post("/auth/logout");if(s.ok)return s.data}catch(s){throw s}},ue=()=>P({mutationFn:ze}),Ie=async()=>{const{data:s}=await ke.post("/auth/worker/logout");if(!s.ok)throw new Error(s.message);return s.data},xe=()=>P({mutationFn:Ie}),Y=q.memo(({size:s="small"})=>{const{data:a,isLoading:i}=Ee(),o=ee(),r=u.useCallback(()=>{console.log("calling ðŸ“Š Unread count updated:",a),a!==void 0&&I.invalidateQueries({queryKey:["notifications","unread-count"]})},[]);return u.useEffect(()=>{const c=o==null?void 0:o.id;if(c)return C.emit("join_notifications",{userId:c}),console.log(`ðŸ”Œ Joining notification room for user: ${c}`),C.on("unread_count_update",r),()=>{C.off("unread_count_update",r)}},[o==null?void 0:o.id,r]),!i&&typeof a=="number"&&a>0?s==="large"?e.jsx("span",{className:"absolute -top-2 -right-4 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:a>99?"99+":a}):e.jsx("span",{className:"absolute -top-2 -right-4 bg-red-500 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center",children:a>9?"9+":a}):null});Y.displayName="NotificationBadge";const Z=({isExpanded:s=!1,isActive:a=!1})=>{const i=M(),{organizationId:o}=O(),r=()=>{i(`/${o}/notification`)};return s?e.jsxs("div",{onClick:r,className:`cursor-pointer w-full flex justify-between items-center max-w-[95%] py-4 px-4 ${a?"bg-[#3a3b45] rounded-xl text-white":"rounded-xl hover:bg-[#3a3b45]"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("i",{className:`fa-solid fa-bell text-lg ${a?"text-[#4a86f7]":"text-[#9ca3af]"}`}),e.jsx(Y,{size:"large"})]}),e.jsx("span",{className:"text-lg",children:"Notifications"})]}),e.jsx("span",{children:e.jsx("i",{className:"fa-solid fa-chevron-right"})})]}):e.jsx("div",{onClick:r,className:`cursor-pointer flex justify-center items-center py-4 px-4 ${a?"bg-[#3a3b45] rounded-xl text-white":"rounded-xl hover:bg-[#3a3b45]"}`,children:e.jsxs("div",{className:"relative",children:[e.jsx("i",{className:`fa-solid fa-bell ${a?"text-[#4a86f7]":"text-[#9ca3af]"}`}),e.jsx(Y,{size:"small"})]})})},R=q.memo(({size:s="small",organizationId:a})=>{const{data:i,isLoading:o}=$e({organizationId:a}),r=ee(),[l,c]=u.useState(0);return u.useEffect(()=>{typeof i=="number"&&c(i)},[i]),u.useEffect(()=>{if(!(r==null?void 0:r.id)||!C||!a)return;const h=p=>{console.log("ðŸ”” unread_ticket_count_update:",p.count),c(p.count)};return C.on("unread_ticket_count_update",h),()=>{C.off("unread_ticket_count_update",h)}},[]),!o&&typeof l=="number"&&l>0?s==="large"?e.jsx("span",{className:"absolute -top-2 -right-4 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:l>99?"99+":l}):e.jsx("span",{className:"absolute -top-2 -right-4 bg-red-500 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center",children:l>9?"9+":l}):null});R.displayName="TicketOperationBadge";const K=({isExpanded:s=!1,isActive:a=!1})=>{const i=M(),{organizationId:o}=O(),r=()=>{i(`/${o}/ticket`)};return s?e.jsxs("div",{onClick:r,className:`cursor-pointer flex w-full justify-between items-center max-w-[95%] py-4 px-4 ${a?"bg-[#3a3b45] rounded-xl text-white":"rounded-xl hover:bg-[#3a3b45]"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("i",{className:`fa-solid fa-ticket text-lg ${a?"text-[#4a86f7]":"text-[#9ca3af]"}`}),e.jsx(R,{organizationId:o,size:"large"})]}),e.jsx("span",{className:"text-lg",children:"Tickets"})]}),e.jsx("span",{children:e.jsx("i",{className:"fa-solid fa-chevron-right"})})]}):e.jsx("div",{onClick:r,className:`cursor-pointer flex justify-center items-center py-4 px-4 ${a?"bg-[#3a3b45] rounded-xl text-white":"rounded-xl hover:bg-[#3a3b45]"}`,children:e.jsxs("div",{className:"relative",children:[e.jsx("i",{className:`fa-solid fa-ticket ${a?"text-[#4a86f7]":"text-[#9ca3af]"}`}),e.jsx(R,{size:"small",organizationId:o})]})})},Me=({labels:s,icons:a,path:i,setProjectName:o,projectName:r,menuStructure:l})=>{const[c,g]=u.useState(!1),{projectId:E}=O(),h=M(),p=Le(),N=p.pathname.split("/"),{organizationId:k}=O(),j=se(),{role:m}=te(t=>t.authStore),[f,y]=u.useState(""),[$,_]=u.useState({}),T=t=>{_(n=>({...n,[t]:!n[t]}))},{data:w,isLoading:L}=Pe(E),{mutateAsync:G,isPending:x}=ce(),{mutateAsync:v,isPending:b}=de(),{mutateAsync:ge,isPending:F}=fe(),{mutateAsync:me,isPending:D}=ue(),{mutateAsync:he,isPending:W}=xe();u.useEffect(()=>{o&&w&&w.projectName&&!L&&o((w==null?void 0:w.projectName)||"Project")},[w,L]);const pe=()=>{g(!1)},je=()=>{g(!0)},we=N[2]==="projectdetails";u.useEffect(()=>{const n=p.pathname.split("/")[4];y(c?()=>Ae[n]:()=>Oe[n])},[p.pathname,c]),u.useEffect(()=>{if(l){const t={};l==null||l.forEach(n=>{(n==null?void 0:n.type)==="group"&&(n!=null&&n.isOpenByDefault)&&(t[n.id]=!0)}),_(n=>({...n,...t}))}},[l]),_e(je,pe);const H=N[2]==="projectdetails",be=N[1]==="login",J=()=>{const t=p.pathname.split("/").filter(Boolean);if(H){h(`/organizations/${k}/projects`);return}if(t.includes("projects")||t.length>2){h(`/organizations/${k}`);return}be&&h("/organizations")},Q=m&&["owner","CTO","staff","worker"].includes(m),V=m&&["owner","CTO","staff"].includes(m)&&k,X=async()=>{var t,n;try{m==="CTO"?await G():m==="client"?await v():m==="staff"?await ge():m==="owner"?await me():m==="worker"&&await he(),j(ae()),j(ne()),j(oe()),j(ie()),j(re()),j(le()),z({title:"Success",description:"logout successfull"}),(!x||!b||!F||!D||!W)&&h("/")}catch(d){z({title:"Error",description:((n=(t=d==null?void 0:d.response)==null?void 0:t.data)==null?void 0:n.message)||"Failed to logout",variant:"destructive"})}};return e.jsx(e.Fragment,{children:c?e.jsxs("aside",{onMouseLeave:()=>g(!1),className:"relative flex flex-col bg-[#2f303a] w-[17%] min-h-screen max-h-screen text-[#9ca3af] select-none transition-all duration-300",children:[e.jsxs("div",{onClick:J,className:`flex ${H?"cursor-pointer":""} justify-between items-center border-b border-[#3a3b45] px-2 py-2 bg-[#2f303a] z-10`,children:[e.jsx("span",{className:"text-xl cursor-pointer font-bold truncate pr-2",children:we?r||"Project":A.COMPANY_NAME}),e.jsx("div",{className:"w-[30px] h-[30px] flex-shrink-0",children:e.jsx("img",{className:"w-full h-full object-contain",src:A.COMPANY_LOGO,alt:"LOGO"})})]}),e.jsx("div",{className:"flex flex-col flex-grow overflow-y-auto overflow-x-hidden custom-scrollbar p-2 large-scrollbar",children:e.jsx("section",{className:"py-0 space-y-2",children:l==null?void 0:l.map(t=>{if(t.type==="item"){const n=t.key,d=t.label,S=f===d;return i[n]&&e.jsx(B,{to:i[n],className:"outline-none",children:e.jsxs("div",{onClick:()=>y(d),className:`cursor-pointer flex justify-between max-w-[95%] py-4 px-4 ${S?"bg-[#3a3b45] rounded-xl text-white":"rounded-xl hover:bg-[#3a3b45]"}`,children:[e.jsx("span",{className:"text-lg",children:d}),e.jsx("span",{children:e.jsx("i",{className:"fa-solid fa-chevron-right"})})]})},n)}if(t.type==="group"){const n=$[t.id];return e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{onClick:()=>T(t.id),className:"cursor-pointer flex justify-between max-w-[95%] py-4 px-4 rounded-xl hover:bg-[#3a3b45] text-[#9ca3af]",children:[e.jsx("span",{className:"text-lg font-semibold",children:t.label}),e.jsx("span",{children:e.jsx("i",{className:`fa-solid ${n?"fa-chevron-down":"fa-chevron-right"} transition-transform`})})]}),n&&e.jsx("div",{className:"ml-2 border-l-2 border-[#3a3b45] mt-1 space-y-1",children:t.keys.map(d=>s[d]&&i[d]&&e.jsx(B,{to:i[d],className:"outline-none",children:e.jsx("div",{onClick:()=>y(s[d]),className:`cursor-pointer py-3 px-4 rounded-lg text-[18px] hover:text-white hover:bg-[#3a3b45] ${f===s[d]?"text-white bg-[#3a3b45]":""}`,children:s[d]})},d))})]},t.id)}return null})})}),e.jsxs("div",{className:"flex flex-col p-2 border-t border-[#3a3b45]",children:[N[1]!=="login"&&e.jsxs(U,{isLoading:x||b||F||D||W,onClick:X,className:"flex items-center gap-2 px-4 py-3 rounded-lg !bg-[#3a3b45] !text-[#9ca3af] hover:!bg-[#464751] hover:!text-white transition",children:[e.jsx("i",{className:"fa-solid fa-right-from-bracket"}),e.jsx("span",{children:"Logout"})]}),e.jsxs("div",{className:"mt-2 flex gap-2 w-full",children:[Q&&e.jsx(Z,{isExpanded:!1,isActive:!1}),V&&e.jsx(K,{isExpanded:!1,isActive:!1})]})]})]}):e.jsxs("aside",{onMouseEnter:()=>g(!0),className:"flex flex-col relative justify-between bg-[#2f303a] w-[6%]  max-h-full  text-[#9ca3af] transition-all duration-300 ",children:[e.jsx("div",{onClick:J,className:"flex justify-center items-center border-b border-[#3a3b45] pt-2 bg-[#2f303a] z-10 cursor-pointer",children:e.jsx("div",{className:"w-[30px] h-[30px]",children:e.jsx("img",{className:"w-full h-full object-contain",src:A.COMPANY_LOGO,alt:"LOGO"})})}),e.jsx("div",{className:"flex-grow overflow-y-auto overflow-x-hidden custom-scrollbar py-4",children:e.jsx("div",{className:"flex items-center flex-col justify-between w-full",children:Object.entries(a).map(([t,n])=>{const d=(f==null?void 0:f.toLowerCase())===t.toLowerCase();return i[t]?e.jsx(B,{to:i[t],className:`${i[t]?"":"cursor-not-allowed"}`,children:e.jsx("div",{onClick:()=>y(t),className:`cursor-pointer flex justify-between max-w-[95%] py-4 px-4 ${(f==null?void 0:f.toLowerCase())===t.toLowerCase()?"bg-[#3a3b45] rounded-xl text-white":"rounded-xl hover:bg-[#3a3b45]"} `,ref:S=>{d&&S&&S.scrollIntoView({behavior:"smooth",block:"center"})},children:e.jsx("i",{className:`${n} ${(f==null?void 0:f.toLowerCase())===t.toLowerCase()?"text-[#4a86f7]":"text-[#9ca3af]"} `})})},t):e.jsx("div",{className:"cursor-not-allowed flex justify-between max-w-[95%] py-4 px-4",children:e.jsx("i",{className:`${n}`})})})})}),e.jsxs("div",{className:"flex flex-col items-center p-2 border-t border-[#3a3b45]",children:[N[1]!=="login"&&e.jsx(U,{isLoading:x||b||F||D||W,title:"logout",onClick:X,className:"w-[40px] h-[40px] flex items-center justify-center !bg-[#3a3b45] !text-[#9ca3af] hover:!text-red-500 transition",children:e.jsx("i",{className:"fa-solid fa-right-from-bracket"})}),e.jsxs("div",{className:"",children:[Q&&e.jsx(Z,{isExpanded:!1,isActive:!1}),V&&e.jsx(K,{isExpanded:!1,isActive:!1})]})]})]})})},Ue=u.memo(Me),Ye=({isOpen:s,onClose:a,labels:i,path:o})=>{const r=M(),{organizationId:l}=O(),c=se(),{role:g}=te(x=>x.authStore),{mutateAsync:E,isPending:h}=ce(),{mutateAsync:p,isPending:N}=de(),{mutateAsync:k,isPending:j}=fe(),{mutateAsync:m,isPending:f}=ue(),{mutateAsync:y,isPending:$}=xe(),_=async()=>{var x,v;try{g==="CTO"?await E():g==="client"?await p():g==="staff"?await k():g==="owner"?await m():g==="worker"&&await y(),c(ae()),c(ne()),c(oe()),c(ie()),c(re()),c(le()),z({title:"Success",description:"logout successfull"}),(!h||!N||!j||!f||!$)&&r("/")}catch(b){z({title:"Error",description:((v=(x=b==null?void 0:b.response)==null?void 0:x.data)==null?void 0:v.message)||"Failed to logout",variant:"destructive"})}};let T=Object.entries(i);const w=location.pathname.split("/"),L=w[2]==="projectdetails",G=()=>{L&&r(`/organizations/${l}/projects`)};return e.jsxs(e.Fragment,{children:[s&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40",onClick:a}),e.jsxs("aside",{className:`fixed top-0 left-0 z-50 h-screen bg-white w-[75%] flex flex-col transition-transform duration-300 ${s?"translate-x-0":"-translate-x-full"}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsxs("div",{onClick:G,className:`flex items-center gap-3 ${L?"cursor-pointer":""}`,children:[e.jsx("img",{src:A.COMPANY_LOGO,alt:"Logo",className:"w-10 h-10 rounded-full object-cover"}),e.jsx("span",{className:"text-lg font-semibold",children:A.COMPANY_NAME})]}),e.jsx("button",{onClick:a,className:"text-xl text-gray-700",children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsx("nav",{className:"flex flex-col flex-grow overflow-y-auto p-4",children:T.map(([x,v],b)=>e.jsxs(q.Fragment,{children:[o[x]?e.jsx(B,{to:o[x],onClick:a,className:"text-gray-800 hover:bg-gray-100 p-3 rounded block",children:v}):e.jsx("span",{className:"text-gray-400 p-3 rounded cursor-not-allowed block",children:v}),b<T.length-1&&e.jsx("hr",{className:"border-t border-gray-200 my-1"})]},x))}),e.jsx("div",{className:"border-t border-gray-200 p-4",children:w[1]!=="login"&&e.jsxs(U,{className:"w-full flex items-center justify-center gap-2",isLoading:h||N||j||f||$,onClick:_,children:[e.jsx("i",{className:"fas fa-sign-out-alt"})," Logout"]})})]})]})};export{Ye as M,Ue as S};
