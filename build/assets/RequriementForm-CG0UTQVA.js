import{r as v,j as e,B as o,t as r,R as M,u as Y,k as H,a as J,af as oe,M as ce,O as de}from"./index-BAM0eJUz.js";import{g as me,h as xe,u as ue,i as pe,j as he,k as fe,l as ge,m as je,n as be}from"./requirementFormApi-_wh_iBu9.js";import{C as U}from"./Card-CdxfjEr-.js";import{L as k}from"./Label-C8i6KaZe.js";import{I as R}from"./Input-1UBXZqEj.js";import{A as Ne,S as ve}from"./AssignStaff-Bt6qrEbL.js";import{R as we}from"./StageFileUploader-C8lCFpfp.js";import{R as ye}from"./ResetStageButton-DaUxSSZv.js";import{S as Ce}from"./StageGuide-e28gQ0h1.js";import"./getAllUsersApi-O0JEgRtZ.js";import"./downloadFile-BbGV_BaX.js";import"./index-C8BdbktQ.js";import"./ImageGalleryMain-B3g6b13d.js";import"./ShortListMain-CkHPlJB3.js";import"./VideoGalleryMain-frK0Wxau.js";const ke=({client:a,projectId:u,className:p})=>{const[c,i]=v.useState(!1),[t,d]=v.useState(a),{mutateAsync:w,isPending:f}=me();v.useEffect(()=>{d(a)},[a]);const s=m=>{const{name:h,value:y}=m.target;d(j=>({...j,[h]:y}))},S=async()=>{try{await w({projectId:u,payload:{clientData:t}}),i(!1),r({title:"Success",description:"Client info updated"})}catch(m){r({title:"Error",description:m.message||"Update failed",variant:"destructive"})}};return e.jsxs(U,{className:`${p} p-5 bg-white shadow border-l-4 border-blue-500`,children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-blue-700",children:[e.jsx("i",{className:"fa-solid fa-user-tie mr-2"})," Client Info"]}),c?e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>i(!1),disabled:f,children:"Cancel"}),e.jsx(o,{size:"sm",onClick:S,isLoading:f,children:"Save"})]}):e.jsxs(o,{variant:"ghost",size:"sm",onClick:()=>i(!0),children:[e.jsx("i",{className:"fa-solid fa-pen-to-square mr-1"})," Edit"]})]}),e.jsx("div",{className:"space-y-4",children:c?e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("div",{children:[e.jsx(k,{className:"text-[10px] uppercase font-bold text-gray-400",children:"Client Name"}),e.jsx(R,{name:"clientName",value:(t==null?void 0:t.clientName)||"",onChange:s})]}),e.jsxs("div",{children:[e.jsx(k,{className:"text-[10px] uppercase font-bold text-gray-400",children:"Email"}),e.jsx(R,{type:"email",name:"email",value:(t==null?void 0:t.email)||"",onChange:s})]}),e.jsxs("div",{children:[e.jsx(k,{className:"text-[10px] uppercase font-bold text-gray-400",children:"WhatsApp Number"}),e.jsx(R,{name:"whatsapp",value:(t==null?void 0:t.whatsapp)||"",onChange:s,maxLength:10})]}),e.jsxs("div",{children:[e.jsx(k,{className:"text-[10px] uppercase font-bold text-gray-400",children:"Location"}),e.jsx(R,{name:"location",value:(t==null?void 0:t.location)||"",onChange:s})]})]}):e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsx(E,{label:"Name",value:t==null?void 0:t.clientName,icon:"fa-user"}),e.jsx(E,{label:"Email",value:t==null?void 0:t.email,icon:"fa-envelope"}),e.jsx(E,{label:"WhatsApp",value:t==null?void 0:t.whatsapp,icon:"fa-phone"}),e.jsx(E,{label:"Location",value:t==null?void 0:t.location,icon:"fa-location-dot"})]})})]})},E=({label:a,value:u,icon:p})=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("i",{className:`fa-solid ${p} text-gray-400 w-4`}),e.jsxs("strong",{className:"text-gray-600",children:[a,":"]})," ",e.jsx("span",{className:"text-gray-800",children:u||"N/A"})]}),Re=v.memo(ke),Se=({sections:a,setIsCreateRoomOpen:u})=>{var m,h,y;const{projectId:p}=Y(),{role:c,permission:i}=H(),t=c==="owner"||((m=i==null?void 0:i.clientrequirement)==null?void 0:m.delete),d=c==="owner"||((h=i==null?void 0:i.clientrequirement)==null?void 0:h.create),w=c==="owner"||((y=i==null?void 0:i.clientrequirement)==null?void 0:y.edit),f=J(),{mutateAsync:s,isPending:S}=xe();return e.jsxs("section",{className:"w-full",children:[e.jsxs("div",{className:"mb-8 flex justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800 mb-2",children:"Project Rooms"}),e.jsx("p",{className:"hidden sm:inline-block text-slate-600",children:"Manage requirements and items for each room"})]}),(d||w)&&e.jsx("div",{className:"mt-4",children:e.jsx(o,{onClick:()=>u(!0),className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"+ Create New Room"})})]}),!Array.isArray(a)||!(a!=null&&a.length)?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-4",children:[e.jsx("div",{className:"bg-slate-50 rounded-full p-6 mb-4",children:e.jsx("i",{className:"fas fa-home text-4xl text-slate-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-slate-700 mb-2",children:"No Rooms Available"}),e.jsx("p",{className:"text-slate-500 text-center max-w-md",children:"There are currently no rooms configured for this project. Add some rooms to get started."})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:a.map(j=>{const I=async()=>{var N,q;try{await s({projectId:p,roomId:j._id}),r({title:"Success",description:"Room deleted successfully"})}catch(b){r({title:"Error",description:((q=(N=b==null?void 0:b.response)==null?void 0:N.data)==null?void 0:q.message)||(b==null?void 0:b.message)||"Failed to delete room",variant:"destructive"})}};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"group relative bg-white rounded-2xl shadow-sm border border-slate-200 hover:shadow-xl hover:border-blue-300 transition-all duration-300 cursor-pointer overflow-hidden",onClick:()=>f(`roompage/${j._id}`),children:[e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-3 group-hover:from-blue-100 group-hover:to-indigo-100 transition-colors duration-300",children:e.jsx("i",{className:"fas fa-door-open text-2xl text-blue-600 group-hover:text-blue-700"})}),t&&e.jsx("div",{children:e.jsx(o,{variant:"danger",isLoading:S,className:"hover:text-white",onClick:N=>{N.stopPropagation(),I()},children:e.jsx("i",{className:"fas fa-trash"})})})]}),e.jsx("h3",{className:"font-semibold text-slate-800 group-hover:text-blue-700 transition-colors duration-300 mb-2 line-clamp-2",children:j.roomName}),e.jsxs("div",{className:"flex items-center text-sm text-slate-500 mb-4",children:[e.jsx("i",{className:"fas fa-list-ul mr-2"}),e.jsx("span",{children:"Manage items & requirements"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-medium text-slate-400 uppercase tracking-wide",children:"Click to manage"}),e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full opacity-60 group-hover:opacity-100 transition-opacity duration-300"})]})]}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/5 to-indigo-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none"})]},j._id)})})})]})},Le=M.memo(Se);function Ae({open:a,onClose:u,onSubmit:p,isLoading:c}){const[i,t]=M.useState("");return M.useEffect(()=>{a||t("")},[a]),a?e.jsx("div",{className:"fixed top-0 left-0 w-full h-screen  bg-black/70 bg-opacity-40 flex justify-center items-center z-50",onClick:u,children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-sm w-full",onClick:d=>d.stopPropagation(),children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Create New Room"}),e.jsx("input",{type:"text",placeholder:"Enter Room Name",className:"w-full p-2 border border-gray-300 rounded mb-4",value:i,onKeyDown:d=>{d.key==="Enter"&&p(i)},autoFocus:!0,onChange:d=>t(d.target.value)}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(o,{className:"px-4 py-2 bg-gray-500 rounded hover:bg-gray-400",onClick:u,disabled:c,children:"Cancel"}),e.jsx(o,{className:"px-4 py-2 bg-blue-600 text-white rounded disabled:opacity-50",onClick:()=>p(i),disabled:!i.trim()||c,children:c?"Creating...":"Create"})]})]})}):null}function Ye(){var O,$,_,z,G,W,B,K;const{projectId:a,organizationId:u}=Y(),{isMobile:p,openMobileSidebar:c}=oe(),i=J(),[t,d]=v.useState(""),[w,f]=v.useState(!1),{data:s,isLoading:S,error:m,refetch:h}=ue({projectId:a}),{mutateAsync:y,isPending:j}=pe(),{mutateAsync:I,isPending:N}=he(),{mutateAsync:q,isPending:b}=fe(),{mutateAsync:Q,isPending:V}=ge(),{mutateAsync:X,isPending:Z}=je(),[D,P]=v.useState(!1),{mutateAsync:ee,isPending:se}=be(),{role:L,permission:g}=H(),te=L==="owner"||((O=g==null?void 0:g.clientrequirement)==null?void 0:O.list),A=L==="owner"||(($=g==null?void 0:g.clientrequirement)==null?void 0:$.create),F=L==="owner"||((_=g==null?void 0:g.clientrequirement)==null?void 0:_.edit),ae=async x=>{var l,n;if(a)try{await ee({projectId:a,payload:{roomName:x}}),r({title:"Success",description:"Room created successfully"}),P(!1),h()}catch(C){r({title:"Error",description:((n=(l=C==null?void 0:C.response)==null?void 0:l.data)==null?void 0:n.message)||(C==null?void 0:C.message)||"Failed to create room",variant:"destructive"})}};if(S)return e.jsx(ce,{});const ie=async()=>{var x,l;try{N||(await I({formId:s._id,projectId:a}),r({title:"Success",description:"completion updated successfully"}),i("../sitemeasurement"))}catch(n){r({title:"Error",description:((l=(x=n==null?void 0:n.response)==null?void 0:x.data)==null?void 0:l.message)||"Failed to update to complete the form",variant:"destructive"})}},le=async x=>{try{const l=["owner","staff","CTO"];if(!L)throw new Error("Not Authorized");if(!l.includes(L))throw new Error("Dont have the access");await navigator.clipboard.writeText(x),f(!0),r({title:"Success",description:"Link copied to clipboard"}),setTimeout(()=>f(!1),4e3)}catch(l){r({title:"Error",description:l.message||"Failed to copy link",variant:"destructive"})}},ne=async()=>{var x,l;try{const n=await y({projectId:a});d(n.inviteLink||n),r({title:"Success",description:"Invitation link generated successfully"})}catch(n){r({title:"Error",description:((l=(x=n==null?void 0:n.response)==null?void 0:x.data)==null?void 0:l.message)||n.message||"Failed to generate invitation link",variant:"destructive"})}},T=async()=>{try{await navigator.clipboard.writeText(t),f(!0),r({title:"Success",description:"Link copied to clipboard"}),setTimeout(()=>f(!1),2e3)}catch{r({title:"Error",description:"Failed to copy link",variant:"destructive"})}},re=()=>{const x=`You're requested to fill the form, Click this link to fill the form: ${t}`,l=`https://wa.me/?text=${encodeURIComponent(x)}`;window.open(l,"_blank")};return location.pathname.includes("roompage")?e.jsx(de,{}):e.jsx("div",{className:"h-full w-full overflow-y-auto ",children:e.jsxs("div",{className:"h-full w-full space-y-4",children:[e.jsxs("div",{className:"flex flex-col w-full sm:flex-row justify-between sm:items-center items-start gap-4",children:[e.jsx("div",{className:"",children:e.jsxs("h2",{className:"text-2xl sm:text-3xl font-semibold text-blue-600 flex items-center",children:[p&&e.jsx("button",{onClick:c,className:"mr-3 p-2 rounded-md border border-gray-300 hover:bg-gray-100",title:"Open Menu",children:e.jsx("i",{className:"fa-solid fa-bars"})})," ",e.jsx("i",{className:"fa-solid fa-pencil mr-2"})," Client Requirement"]})}),e.jsxs("div",{className:"flex flex-wrap sm:flex-nowrap items-center gap-2  !w-[100%] sm:!w-[50%] lg:!w-[60%] justify-end lg:justify-end",children:[(A||F)&&e.jsxs(o,{isLoading:N,onClick:ie,className:"bg-green-600 hover:bg-green-700 text-white w-full sm:w-auto",children:[e.jsx("i",{className:"fa-solid fa-circle-check mr-2"}),"Mark as Complete"]}),(A||F)&&e.jsx(ye,{projectId:a,stageNumber:1,stagePath:"requirementform",className:"sm:!max-w-[20%] w-full"}),(A||F)&&e.jsx(Ne,{stageName:"RequirementFormModel",projectId:a,organizationId:u,currentAssignedStaff:(s==null?void 0:s.assignedTo)||null,className:"w-full sm:w-auto"}),e.jsx("div",{className:"w-full sm:w-auto flex justify-end sm:block",children:e.jsx(Ce,{organizationId:u,stageName:"clientrequirement"})})]})]}),m&&e.jsxs("div",{className:"max-w-xl sm:min-w-[80%]  mx-auto mt-4 p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2 text-xl sm:text-3xl",children:"⚠️ Error Occurred"}),e.jsx("p",{className:"text-red-500  mb-4 text-lg sm:text-xl",children:((G=(z=m==null?void 0:m.response)==null?void 0:z.data)==null?void 0:G.message)||"Failed to load data"}),e.jsx(o,{onClick:()=>h(),className:"bg-red-600 text-white px-4 py-2",children:"Retry"})]}),!m&&e.jsxs("main",{className:"h-[calc(100vh-90px)] overflow-y-auto custom-scrollbar space-y-6",children:[e.jsxs(U,{className:"p-4 w-full shadow border-l-4 border-blue-600 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-3 text-blue-700 text-sm font-medium mb-2",children:[e.jsx("i",{className:"fa-solid fa-clock text-blue-500 text-lg"}),e.jsx("span",{children:"Stage Timings"})]}),e.jsx(ve,{startedAt:(W=s==null?void 0:s.timer)==null?void 0:W.startedAt,projectId:a,stageName:"requirementform",refetchStageMutate:h,completedAt:(B=s==null?void 0:s.timer)==null?void 0:B.completedAt,deadLine:(K=s==null?void 0:s.timer)==null?void 0:K.deadLine,formId:s==null?void 0:s._id,deadLineMutate:q,isPending:b})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 sm:gap-6",children:[e.jsx(Re,{projectId:a,className:"w-[100%] md:w-[50%]",client:s==null?void 0:s.clientData}),te&&e.jsx(U,{className:"p-4 w-[100%] md:w-[50%] shadow border-l-4 border-blue-500 bg-white",children:e.jsx(we,{enableUpload:F||A,formId:s==null?void 0:s._id,existingUploads:s==null?void 0:s.uploads,onUploadComplete:h,uploadFilesMutate:Q,uploadPending:V,projectId:a,refetch:h,onDeleteUpload:X,deleteFilePending:Z})})]}),e.jsx(Ae,{open:D,onClose:()=>P(!1),onSubmit:ae,isLoading:se}),e.jsx(Le,{sections:s==null?void 0:s.rooms,setIsCreateRoomOpen:P}),e.jsx("div",{className:"pb-6",children:s!=null&&s.shareToken?e.jsxs("div",{className:"space-y-4",children:[e.jsx(k,{children:"Form Link"}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-2",children:[e.jsx(R,{value:s==null?void 0:s.shareToken,readOnly:!0,className:"bg-blue-50 text-blue-800 flex-1"}),e.jsx(o,{onClick:()=>le(s==null?void 0:s.shareToken),className:"w-full sm:w-auto",children:e.jsx("i",{className:`fas ${w?"fa-check":"fa-copy"}`})})]})]}):e.jsxs("div",{className:"bg-white p-4 sm:p-6 rounded-2xl shadow-lg space-y-4",children:[e.jsxs("h2",{className:"text-lg sm:text-xl font-bold text-blue-900 flex items-center",children:[e.jsx("i",{className:"fas fa-link mr-2"})," Generate Form Link"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Request to fill the form by generating a link."}),!t&&(A||F)?e.jsxs(o,{onClick:ne,isLoading:j,className:"w-full bg-blue-600 text-white py-2.5 sm:py-3",children:[e.jsx("i",{className:"fas fa-link mr-2"})," Generate Form Link"]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx(k,{children:"Form Link"}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-2",children:[e.jsx(R,{value:t,readOnly:!0,className:"bg-blue-50 text-blue-800 flex-1"}),e.jsx(o,{onClick:T,className:"w-full sm:w-auto",children:e.jsx("i",{className:`fas ${w?"fa-check":"fa-copy"}`})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs(o,{onClick:re,className:"w-full sm:w-auto bg-green-600 text-white",children:[e.jsx("i",{className:"fab fa-whatsapp mr-2"})," Share on WhatsApp"]}),e.jsxs(o,{onClick:T,className:"w-full sm:w-auto border border-blue-400 text-blue-700",children:[e.jsx("i",{className:"fas fa-copy mr-2"})," Copy"]})]})]})]})})]})]})})}export{Ae as CreateRoomModal,Ye as default};
