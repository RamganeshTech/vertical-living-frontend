import{r as d,j as e,ad as H,ae as J,B as M,t as A,E as U,Z as Q,J as E,af as Y,z as _,K as Z,u as F,Y as W,g as X}from"./index-CKvTvGhg.js";import{S as ee}from"./constants-CP15s2Qq.js";import{b as K}from"./validation-lCXOhVkV.js";const te=({tags:t,setState:p})=>{const[u,j]=d.useState(""),s=a=>{(a.key==="Enter"||a.key===",")&&u.trim()?(a.preventDefault(),t.includes(u.trim())||p(c=>({...c,tags:[...t,u.trim()]})),j("")):a.key==="Backspace"&&!u&&p(c=>({...c,tags:t.slice(0,-1)}))},o=a=>{p(c=>({...c,tags:t.filter((l,m)=>m!==a)}))};return e.jsxs("div",{className:"flex flex-wrap items-center border-b-1 border-[#565656] p-2 gap-2",children:[t.map((a,c)=>e.jsxs("div",{className:"bg-blue-600 text-white text-sm px-2 py-1 rounded-full flex items-center gap-1",children:[a,e.jsx("span",{className:"cursor-pointer ml-1 text-xs",onClick:()=>o(c),children:"Ã—"})]},c)),e.jsx("input",{type:"text",value:u,onChange:a=>j(a.target.value),onKeyDown:s,className:"input flex-1 outline-none text-sm border-none",placeholder:"Type and press Enter"})]})},se=d.memo(te),V=({message:t,onClick:p})=>{const[u,j]=d.useState(!0),[s,o]=d.useState("in"),a=()=>{o("out")},c=()=>{s==="out"&&(j(!1),p())};return u?e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        @keyframes bounceScaleIn {
          0% { transform: scale(0); }
          60% { transform: scale(1.1); }
          80% { transform: scale(0.95); }
          100% { transform: scale(1); }
        }
        @keyframes bounceScaleOut {
          0% { transform: scale(1); }
          20% { transform: scale(1.1); }
          100% { transform: scale(0); }
        }
      `}),e.jsx("div",{className:"fixed inset-0 bg-[#0a0a0a10] z-[1099] flex items-center justify-center px-4",onClick:()=>a(),children:e.jsxs("div",{onClick:l=>l.stopPropagation(),style:{animation:s==="in"?"bounceScaleIn 0.2s ease-out forwards":"bounceScaleOut 0.2s ease-in forwards"},onAnimationEnd:c,className:"bg-[#2f303a] text-gray-800 rounded-2xl !w-[30%] shadow-lg !px-6 max-w-lg sm:!px-3 sm:py-2 sm:w-full text-center !space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center border-b border-red-500 pb-2",children:[e.jsx("span",{className:"text-white text-lg",children:"Error occured"}),e.jsx("span",{className:"cursor-pointer",onClick:a,children:e.jsx("i",{className:"fa-solid fa-xmark text-red-500 text-lg"})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white text-lg",children:t[0].toUpperCase()+t.slice(1)}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:a,className:"cursor-pointer inline-block bg-red-500 hover:bg-red-800 duration-200 px-5 py-1 rounded-md text-white",children:"OK"})})]})]})})]}):null},ae=["none","low","medium","high"],re=["Active","Delayed","In Progress","In Testing","On Track","On Hold","Approved","Cancelled","Planning","Invoice"],ne={Active:"bg-green-100 text-green-800",Delayed:"bg-red-100 text-red-800","In Progress":"bg-blue-100 text-blue-800","In Testing":"bg-yellow-100 text-yellow-800","On Track":"bg-emerald-100 text-emerald-800","On Hold":"bg-gray-100 text-gray-800",Approved:"bg-indigo-100 text-indigo-800",Cancelled:"bg-rose-100 text-rose-800",Planning:"bg-purple-100 text-purple-800",Invoice:"bg-pink-100 text-pink-800"},le=({onClose:t,refetch:p,setShowForm:u,organizationId:j,isEditing:s,setEditForm:o,editForm:a,editProjectId:c})=>{var y,L,B,R;const[l,m]=d.useState({projectName:"",description:"",duration:0,tags:[],startDate:new Date,endDate:null,dueDate:null,priority:"none",status:"Active"}),[f,C]=d.useState({}),i=(r,P)=>{let{name:D,value:x}=r.target;if(D==="tags"){P(I=>({...I,tags:Array.from(new Set([...I.tags,x]))}));return}if(D.includes("Date")){const I=x?new Date(x):null;P(G=>{const k={...G,[D]:I};if(k.startDate&&k.dueDate){const z=k.dueDate.getTime()-k.startDate.getTime();z>=0?k.duration=Math.ceil(z/(1e3*3600*24)):k.duration=0}return k});return}P(I=>({...I,[D]:x}))},{mutateAsync:N,isPending:h,error:n,isError:S,reset:b}=H(),{mutateAsync:O,isPending:v,error:w,isError:T,reset:$}=J(),g=async r=>{var P,D;r.preventDefault(),r.stopPropagation();try{const x=s?K(a):K(l);C(x),Object.keys(x).length===0&&(s&&c?v||(await O({projectId:c,formData:a}),A({title:"Success",description:"Project Edited Successfully"})):h||(await N({projectData:l,orgsId:j}),A({title:"Success",description:"Project Created Successfully"})),p(),u(!1))}catch(x){A({title:"Error",description:((D=(P=x==null?void 0:x.response)==null?void 0:P.data)==null?void 0:D.message)||(x==null?void 0:x.message)||"Operation Failed",variant:"destructive"})}};return e.jsx(e.Fragment,{children:e.jsxs("div",{onClick:r=>r.stopPropagation(),className:"bg-white w-full h-full overflow-y-auto custom-scrollbar max-w-3xl mx-auto rounded-2xl shadow-2xl p-4 sm:p-6 md:p-8 border border-gray-200 relative",children:[!h&&S&&e.jsx(V,{message:((L=(y=n==null?void 0:n.response)==null?void 0:y.data)==null?void 0:L.message)||(n==null?void 0:n.message)||"Something went wrong",onClick:()=>b()}),!v&&T&&e.jsx(V,{message:((R=(B=w==null?void 0:w.response)==null?void 0:B.data)==null?void 0:R.message)||(w==null?void 0:w.message)||"Something went wrong",onClick:()=>$()}),e.jsxs("div",{className:"flex justify-between items-center mb-4 sm:mb-6",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-blue-700 flex items-center gap-2",children:s?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa-solid fa-edit"})," Edit Project"]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa-solid fa-plus"})," Create Project"]})}),e.jsx("button",{onClick:t,className:"text-gray-500 hover:text-red-500 text-xl",children:e.jsx("i",{className:"fa-solid fa-xmark"})})]}),e.jsxs("form",{onSubmit:g,className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Project Name"}),e.jsx("input",{autoFocus:!0,name:"projectName",value:s?a.projectName:l.projectName,onChange:r=>i(r,s?o:m),type:"text",placeholder:"Enter name",className:"input outline-none w-full border border-gray-300 rounded-md px-3 py-2"}),f.projectName&&e.jsx("p",{className:"text-red-600 text-xs mt-1",children:f.projectName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Duration (days)"}),e.jsx("input",{disabled:!0,type:"number",name:"duration",onChange:r=>i(r,s?o:m),value:s?a.duration:l.duration,placeholder:"Ex: 15",className:"input outline-none w-full border border-gray-300 rounded-md px-3 py-2 bg-gray-100 cursor-not-allowed"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{rows:3,name:"description",onChange:r=>i(r,s?o:m),value:s?a.description:l.description,placeholder:"Brief project overview",className:"input outline-none w-full border border-gray-300 rounded-md px-3 py-2 resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tags"}),e.jsx(se,{tags:s?a.tags:l.tags,setState:s?o:m})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Start Date"}),e.jsx("input",{type:"date",onChange:r=>i(r,s?o:m),value:s?a.startDate?a.startDate.toISOString().split("T")[0]:"":l.startDate?l.startDate.toISOString().split("T")[0]:"",name:"startDate",className:"input outline-none w-full border border-gray-300 rounded-md px-3 py-2"}),f.startDate&&e.jsx("p",{className:"text-red-600 text-xs mt-1",children:f.startDate})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"End Date"}),e.jsx("input",{type:"date",name:"endDate",onChange:r=>i(r,s?o:m),value:s?a.endDate?a.endDate.toISOString().split("T")[0]:"":l.endDate?l.endDate.toISOString().split("T")[0]:"",className:"input outline-none w-full border border-gray-300 rounded-md px-3 py-2"}),f.endDate&&e.jsx("p",{className:"text-red-600 text-xs mt-1",children:f.endDate})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Due Date"}),e.jsx("input",{type:"date",name:"dueDate",onChange:r=>i(r,s?o:m),value:s?a.dueDate?a.dueDate.toISOString().split("T")[0]:"":l.dueDate?l.dueDate.toISOString().split("T")[0]:"",className:"input outline-none w-full border border-gray-300 rounded-md px-3 py-2"}),f.dueDate&&e.jsx("p",{className:"text-red-600 text-xs mt-1",children:f.dueDate})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Priority"}),e.jsx("select",{name:"priority",onChange:r=>i(r,s?o:m),value:s?a.priority:l.priority,className:"input w-full border border-gray-300 rounded-md px-3 py-2",children:ae.map(r=>e.jsx("option",{value:r,children:r},r))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsx("select",{name:"status",onChange:r=>i(r,s?o:m),value:s?a.status:l.status,className:"input w-full border border-gray-300 rounded-md px-3 py-2",children:re.map(r=>e.jsx("option",{value:r,children:r},r))})]})]}),e.jsx("div",{className:"text-end",children:e.jsx(M,{isLoading:h||v,type:"submit",disabled:h||v,className:"bg-blue-600 text-white px-6 w-full sm:w-40 py-2 rounded-xl hover:bg-blue-700 transition-all",children:h||v?e.jsx("div",{className:"mx-auto w-5 h-5 border-2 border-white border-t-transparent rounded-full"}):s?"Edit Project":"Create Project"})})]})]})})},oe=d.memo(le),ie=async({projectId:t})=>(await Q.get(`https://houseofram.in/api/currentactivestage/${t}/pendingstage`)).data.redirectTo,de=t=>U({queryKey:["currentactivestage",t],queryFn:()=>ie({projectId:t}),enabled:!!t,retry:!1,refetchOnMount:!1}),ce=({project:t,onEdit:p,organizationId:u,refetch:j})=>{const{setProjectId:s}=E(),{mutateAsync:o,isPending:a}=Y(),{data:c,isLoading:l}=de(t==null?void 0:t._id),m=n=>{s(n)},f=n=>{switch(n){case"high":return"bg-red-100 text-red-500";case"medium":return"bg-yellow-100 text-yellow-600";case"low":return"bg-green-100 text-green-600";default:return"bg-white shadow-sm"}},C=d.useMemo(()=>{var n;return(n=t.projectInformation)!=null&&n.startDate?_(t.projectInformation.startDate):null},[]),i=d.useMemo(()=>{var n;return(n=t.projectInformation)!=null&&n.endDate?_(t.projectInformation.endDate):null},[]),N=d.useMemo(()=>{var n;return(n=t.projectInformation)!=null&&n.dueDate?_(t.projectInformation.dueDate):null},[]),h=async()=>{var n,S;try{if(!window.confirm("Are you sure you want to delete this project?"))return;await o(t._id),A({title:"Success",description:"Project Deleted Successfully"}),j()}catch(b){A({title:"Error",description:((S=(n=b==null?void 0:b.response)==null?void 0:n.data)==null?void 0:S.message)||(b==null?void 0:b.message)||"Failed to Delete",variant:"destructive"})}};return e.jsxs("div",{className:"p-2 sm:p-5 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xl font-semibold text-[#1f2d3d]",children:[e.jsx("i",{className:"fa-solid fa-folder-open text-blue-600"}),t.projectName]}),e.jsxs("span",{className:`text-sm px-3 py-1 rounded-full font-medium ${f(t.projectInformation.priority)}`,children:[t.projectInformation.priority," priority"]})]}),e.jsxs("div",{className:"text-sm text-gray-700 grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-3 gap-y-1 sm:gap-y-2 gap-x-4",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("i",{className:"fa-solid fa-calendar-day text-gray-500"}),e.jsx("strong",{children:"Start:"})," ",C||"N/A"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("i",{className:"fa-solid fa-calendar-check text-gray-500"}),e.jsx("strong",{children:"End:"})," ",i||"N/A"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("i",{className:"fa-solid fa-calendar-check text-gray-500"}),e.jsx("strong",{children:"Due:"})," ",N||"N/A"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("i",{className:"fa-solid fa-hourglass-half text-gray-500"}),e.jsxs("strong",{children:["Duration: ",t.projectInformation.duration," days"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("i",{className:"fa-solid fa-hourglass-half text-gray-500"}),e.jsxs("strong",{children:["Status: ",e.jsx("span",{className:`${ne[t.projectInformation.status]} !bg-transparent`,children:t.projectInformation.status})," "]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Progress"}),e.jsx("div",{className:"mt-1 w-full h-3 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-blue-600",style:{width:`${t.completionPercentage}%`}})}),e.jsxs("div",{className:"text-sm text-right text-gray-600 mt-1",children:[t.completionPercentage,"% Complete"]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-2 text-sm text-blue-600",children:[e.jsx(Z,{to:`/${u}/projectdetails/${t._id}/${c}`,onClick:()=>m(t._id),className:`hover:underline ${l?"cursor-block":"cursor-pointer"}  flex items-center gap-1`,children:l?e.jsx("i",{className:"fa fa-spinner animate-spin text-blue-600"}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa-solid fa-eye"})," View"]})}),e.jsxs(M,{isLoading:a,variant:"outline",onClick:h,className:"hover:underline cursor-pointer flex items-center gap-1 text-red-500 !border-0",children:[e.jsx("i",{className:"fa-solid fa-trash"}),"Delete"]}),e.jsxs("button",{onClick:()=>p(t,t._id),className:"hover:underline cursor-pointer flex items-center gap-1 text-amber-500",children:[e.jsx("i",{className:"fa-solid fa-pencil"}),"edit"]})]})]})},me=d.memo(ce);function xe(t){return{projectName:t.projectName,description:t.description??"",duration:t.projectInformation.duration??0,tags:t.projectInformation.tags??[],startDate:t.projectInformation.startDate?new Date(t.projectInformation.startDate):null,endDate:t.projectInformation.endDate?new Date(t.projectInformation.endDate):null,dueDate:t.projectInformation.dueDate?new Date(t.projectInformation.dueDate):null,priority:t.projectInformation.priority??"none",status:t.projectInformation.status??"Active"}}const q=()=>e.jsxs("div",{className:"animate-pulse bg-white border-l-8 border-blue-600 shadow-md rounded-xl p-4 flex flex-col justify-between min-h-[250px] w-full max-w-[500px]",children:[e.jsx("div",{className:"h-5 w-1/2 bg-gray-200 rounded mb-4"}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"h-4 w-4 bg-gray-300 rounded-full"}),e.jsx("div",{className:"h-3 w-1/3 bg-gray-300 rounded"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"h-4 w-4 bg-gray-300 rounded-full"}),e.jsx("div",{className:"h-3 w-1/3 bg-gray-300 rounded"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"h-4 w-4 bg-gray-300 rounded-full"}),e.jsx("div",{className:"h-3 w-1/3 bg-gray-300 rounded"})]}),e.jsx("div",{className:"h-3 bg-gray-300 rounded w-full mb-4"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"h-3 w-1/4 bg-gray-300 rounded"}),e.jsx("div",{className:"h-3 w-1/4 bg-gray-300 rounded"}),e.jsx("div",{className:"h-3 w-1/4 bg-gray-300 rounded"})]})]}),fe=()=>{var T,$;const{organizationId:t}=F(),{openMobileSidebar:p,isMobile:u}=E(),{role:j}=W(g=>g.authStore),[s,o]=d.useState(!1),[a,c]=d.useState(!1),[l,m]=d.useState({projectName:"",description:"",duration:0,tags:[],startDate:new Date,endDate:null,dueDate:null,priority:"none",status:"Active"}),[f,C]=d.useState(null);let{data:i,refetch:N,isPending:h,error:n,isLoading:S}=X(t);const b=["owner","CTO","staff"],O=d.useCallback((g,y)=>{const L=xe(g);m(L),C(y),c(!0),o(!0)},[]),v=d.useCallback(()=>{o(!1),c(!1)},[]),w=d.useCallback((g,y)=>{O(g,y)},[O]);return S?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4",children:[1,2,3,4].map(g=>e.jsx(q,{},g))}):e.jsxs("div",{className:"w-[100%] flex flex-col h-full min-h-0 ",children:[e.jsxs("header",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex ",children:[u&&e.jsx("button",{onClick:p,className:"mr-3 p-2 rounded-md border-none border-gray-300 hover:bg-gray-100",title:"Open Menu",children:e.jsx("i",{className:"fa-solid fa-bars"})}),e.jsxs("h2",{className:"text-2xl sm:text-3xl font-bold text-[#1f2d3d] flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-diagram-project text-blue-600 text-2xl"}),e.jsx("p",{children:ee.PROJECTS})]})]}),b.includes(j)&&e.jsx("div",{onClick:()=>{o(!s)},className:"bg-blue-600  cursor-pointer !h-[40px] !w-[40px] flex justify-center items-center rounded-full",children:e.jsx("i",{className:`fa-solid fa-plus text-white transition-transform duration-300 ${s?"rotate-135":"rotate-0"}`})})]}),e.jsx("hr",{className:"my-2 border-b-1 border-gray-300"}),!n&&!h&&((i==null?void 0:i.length)??0)===0&&e.jsxs("div",{className:"flex h-full flex-col items-center justify-center w-full py-16 text-center text-gray-500",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“‚"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"No Projects Found"}),e.jsx("p",{className:"text-sm text-gray-400 mb-4 max-w-md",children:"Looks like you havenâ€™t added any projects yet. Click the â€œ+â€ button to get started and create your first project."}),e.jsx("button",{onClick:()=>o(!0),className:"bg-blue-600 cursor-pointer hover:bg-blue-700 text-white px-4 py-2 rounded-md transition",children:"Create New Project"})]}),n&&e.jsxs("div",{className:"max-w-xl sm:min-w-[80%]  mx-auto mt-4 p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2 text-xl sm:text-3xl",children:"âš ï¸ Error Occurred"}),e.jsx("p",{className:"text-red-500  mb-4 text-lg sm:text-xl",children:(($=(T=n==null?void 0:n.response)==null?void 0:T.data)==null?void 0:$.message)||"Failed to load the projects"}),e.jsx(M,{onClick:()=>N(),className:"bg-red-600 text-white px-4 py-2",children:"Retry"})]}),!n&&e.jsxs("div",{className:"h-full flex-1 !overflow-y-auto custom-scrollbar grid md:grid-cols-2 gap-6",children:[h&&[...Array(6)].map((g,y)=>e.jsx(d.Fragment,{children:e.jsx(q,{})},y)),!h&&(i==null?void 0:i.length)>0&&(i==null?void 0:i.map((g,y)=>e.jsx(e.Fragment,{children:e.jsx("div",{className:"h-[256px] sm:!h-[270px] md:!h-[330px] lg:!h-[282px] flex flex-col shadow-md rounded-xl overflow-hidden border-l-8 border-blue-600 bg-white",children:e.jsx(me,{refetch:N,onEdit:w,index:y,project:g,organizationId:t})},g._id)})))]}),s&&e.jsx("div",{onClick:v,className:"fixed inset-0 z-50 bg-black/40 backdrop-blur-sm flex items-center justify-center p-4",children:e.jsx(oe,{onClose:v,refetch:N,setShowForm:o,organizationId:t,isEditing:a,setEditForm:m,editForm:l,editProjectId:f})})]})};export{fe as default};
