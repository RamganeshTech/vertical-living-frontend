import{j as e,u as D,a as E,b as I,r as i,O as L}from"./index-mTWK40SB.js";import{a as S,b as $}from"./customerAccountApi-62c0oW2t.js";import{B as o}from"./Button-D17pPJux.js";import{C as P}from"./Card-BPbh2zyJ.js";import{d as M}from"./dateFormator-BGKi5rfZ.js";import"./useQuery-COMoCVsy.js";import"./useMutation-BbI9x9IC.js";import"./useInfiniteQuery-BCbWIrjk.js";import"./roleCheck-B4W0Vc_0.js";const R=({customer:a,onView:c,onDelete:d,isDeleting:n})=>{const m=`${a.firstName||""} ${a.lastName||""}`.trim()||"N/A";return e.jsx(P,{className:"hover:shadow-lg transition-shadow border-l-4 border-blue-600",children:e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex justify-between items-start mb-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-2 flex items-center",children:[e.jsx("i",{className:`fas ${a.customerType==="business"?"fa-building":"fa-user"} mr-2 text-blue-600`}),m]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:`inline-block px-2 py-1 text-xs font-medium rounded-full ${a.customerType==="business"?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"}`,children:a.customerType==="business"?"Business":"Individual"}),e.jsxs("span",{className:"text-xs text-gray-500 flex items-center",children:[e.jsx("i",{className:"fas fa-calendar-alt mr-1"}),M(a.createdAt)]})]})]})}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx("i",{className:"fas fa-envelope w-5 mr-2 text-gray-400"}),e.jsx("span",{className:"truncate",children:a.email||"-"})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx("i",{className:"fas fa-mobile-alt w-5 mr-2 text-gray-400"}),e.jsx("span",{children:a.phone.mobile||"-"})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx("i",{className:"fas fa-phone w-5 mr-2 text-gray-400"}),e.jsx("span",{children:a.phone.work||"-"})]})]}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsxs(o,{onClick:c,variant:"primary",className:"flex-1",children:[e.jsx("i",{className:"fas fa-eye mr-2"}),"View"]}),e.jsxs(o,{onClick:d,variant:"danger",isLoading:n,className:"flex-1 bg-red-600 text-white ",children:[e.jsx("i",{className:"fas fa-trash mr-2"}),"Delete"]})]})]})})},Q=()=>{const a=D(),c=E(),{organizationId:d}=I(),n=i.useRef(null),m=c.pathname.includes("/customersingle")||c.pathname.includes("/create"),[t,l]=i.useState({search:"",customerType:"",projectId:"",sortBy:"createdAt",sortOrder:"desc"}),[y,v]=i.useState(t.search);i.useEffect(()=>{const s=setTimeout(()=>{v(t.search)},500);return()=>clearTimeout(s)},[t.search]);const{data:x,fetchNextPage:g,hasNextPage:u,isFetchingNextPage:h,isLoading:w,isError:C,error:f,refetch:A}=S({organizationId:d||"",search:y,customerType:t.customerType||void 0,projectId:t.projectId||void 0,sortBy:t.sortBy,sortOrder:t.sortOrder,limit:7}),b=$();i.useEffect(()=>{const s=n.current;if(!s)return;const r=()=>{const{scrollTop:j,scrollHeight:O,clientHeight:F}=s;O-j-F<100&&u&&!h&&(console.log("ðŸ“œ Loading more customers..."),g())};return s.addEventListener("scroll",r),()=>s.removeEventListener("scroll",r)},[u,h,g]);const T=async(s,r)=>{if(window.confirm(`Are you sure you want to delete ${r}?`))try{await b.mutateAsync(s),alert("Customer deleted successfully")}catch(j){alert(j.message||"Failed to delete customer")}},k=s=>{a(`customersingle/${s}`)},N=Object.values(t).filter(s=>s!==""&&s!=="createdAt"&&s!=="desc").length,B=()=>{l({search:"",customerType:"",projectId:"",sortBy:"createdAt",sortOrder:"desc"})},p=(x==null?void 0:x.pages.flatMap(s=>s.data))||[];return m?e.jsx(L,{}):e.jsxs("div",{className:"space-y-4 h-full",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-users mr-3 text-blue-600"}),"Customer Accounts"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your business and individual customers"})]}),e.jsxs(o,{onClick:()=>a("create"),children:[e.jsx("i",{className:"fas fa-plus mr-2"}),"Add Customer"]})]}),w?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("i",{className:"fas fa-spinner fa-spin text-blue-600 text-4xl"})}):C?e.jsxs("div",{className:"max-w-xl sm:min-w-[80%] mx-auto mt-4 p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2 text-xl sm:text-3xl",children:"âš ï¸ Error Occurred"}),e.jsx("p",{className:"text-red-500 mb-4 text-lg sm:text-xl",children:(f==null?void 0:f.message)||"Failed to load customers"}),e.jsx(o,{onClick:()=>A(),className:"bg-red-600 text-white px-4 py-2",children:"Retry"})]}):e.jsxs("main",{className:"flex gap-2 !max-h-[90%]",children:[e.jsx("div",{className:"xl:w-80 flex-shrink-0",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-filter mr-2 text-blue-600"}),"Filters"]}),N>0&&e.jsxs("button",{onClick:B,className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:["Clear All (",N,")"]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx("i",{className:"fas fa-search mr-2"}),"Search"]}),e.jsx("input",{type:"text",placeholder:"Name, email, phone...",value:t.search,onChange:s=>l(r=>({...r,search:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Customer Type"}),e.jsxs("select",{value:t.customerType,onChange:s=>l(r=>({...r,customerType:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"All Types"}),e.jsx("option",{value:"business",children:"Business"}),e.jsx("option",{value:"individual",children:"Individual"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sort By"}),e.jsxs("select",{value:t.sortBy,onChange:s=>l(r=>({...r,sortBy:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"createdAt",children:"Created Date"}),e.jsx("option",{value:"firstName",children:"First Name"}),e.jsx("option",{value:"companyName",children:"Company Name"}),e.jsx("option",{value:"email",children:"Email"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sort Order"}),e.jsxs("select",{value:t.sortOrder,onChange:s=>l(r=>({...r,sortOrder:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"desc",children:"Descending"}),e.jsx("option",{value:"asc",children:"Ascending"})]})]})]})]})}),p.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[300px] w-full bg-white rounded-xl text-center p-6",children:[e.jsx("i",{className:"fas fa-user-slash text-5xl text-blue-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-1",children:"No Customers Found"}),e.jsxs("p",{className:"text-sm text-gray-500",children:[t.search||t.customerType?"Try adjusting your filters to find customers.":"Looks like there are no customers yet.",e.jsx("br",{}),"Click on ",e.jsx("strong",{children:'"Add Customer"'})," to get started ðŸš€"]})]}):e.jsxs("div",{ref:n,className:"flex-1 !max-h-[100%] overflow-y-auto",children:[e.jsx("div",{className:"grid gap-6 grid-cols-1 sm:grid-cols-2 xl:grid-cols-2",children:p.map(s=>e.jsx(R,{customer:s,onView:()=>k(s._id),onDelete:()=>T(s._id,s.customerType==="business"?s.companyName||"Customer":`${s.firstName} ${s.lastName}`),isDeleting:b.isPending},s._id))}),h&&e.jsx("div",{className:"flex justify-center py-8",children:e.jsxs("div",{className:"flex items-center gap-2 text-blue-600",children:[e.jsx("i",{className:"fas fa-spinner fa-spin text-2xl"}),e.jsx("span",{className:"text-sm font-medium",children:"Loading more customers..."})]})}),!u&&p.length>0&&e.jsx("div",{className:"flex justify-center py-6",children:e.jsxs("p",{className:"text-gray-400 text-sm font-medium",children:[e.jsx("i",{className:"fas fa-check-circle mr-2"}),"You've reached the end of the list"]})})]})]})]})};export{Q as default};
