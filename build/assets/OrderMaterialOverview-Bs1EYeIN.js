import{b as Q,a as V,d as X,r as g,j as e,O as Y}from"./index-DkfQDeIt.js";import{u as D,a as K,b as ee,c as se,d as te,e as ae}from"./orderingMaterialApi-CuwrK0B9.js";import{G as re}from"./GenerateWhatsappLink-C30QwXyD.js";import{t as m}from"./toast-BSC5QTk1.js";import{I as c}from"./Input-lr8I7tVA.js";import{B as x}from"./Button-C-chqFKc.js";import le from"./MaterialOverviewLoading-CgXl-m5l.js";import{c as ie}from"./Card-Dx_Z9f0D.js";import{A as ne,S as oe}from"./AssignStaff-DXCssW_O.js";import{R as de}from"./ResetStageButton-DPKiOhg7.js";import"./useQuery-mUmMtORz.js";import"./useMutation-BWlLDX_I.js";import"./roleCheck-DNL7PxQZ.js";import"./Skeleton-CVtEMTN7.js";import"./getAllUsersApi-CuWWGdu9.js";const Ce=()=>{var w,S,y,C,k;const{projectId:d,organizationId:P}=Q(),A=V(),{isMobile:O,openMobileSidebar:M}=X(),E=location.pathname.includes("/ordermaterialroom"),[L,f]=g.useState(!1),[I,j]=g.useState(!1),[i,u]=g.useState({}),[n,h]=g.useState({}),{data:t,isLoading:b,isError:v,error:N,refetch:p}=D(d),{mutateAsync:U,isPending:F}=K(),{mutateAsync:R}=ee(),{mutateAsync:G}=se(),{mutateAsync:$,isPending:B}=te(),{mutateAsync:T,isPending:z}=ae(),W=async()=>{var s,o;try{if(i.phoneNumber&&!/^\d{10}$/.test(i.phoneNumber.trim()))throw new Error("Phone number should contain exactly 10 digit numbers");await R({projectId:d,updates:i}),m({title:"Success",description:"Shop Details Updated"}),f(!1),p()}catch(a){m({variant:"destructive",title:"Error",description:((o=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:o.message)||(a==null?void 0:a.message)||"Update failed"})}},Z=async()=>{var s,o;try{if(n.phoneNumber&&!/^\d{10}$/.test(n.phoneNumber.trim()))throw new Error("Phone number should contain exactly 10 digit numbers");await G({projectId:d,updates:n}),j(!1),m({title:"Success",description:"Delivery Details Updated"}),p()}catch(a){m({variant:"destructive",title:"Error",description:((o=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:o.message)||(a==null?void 0:a.message)||"Update failed"})}},_=async()=>{var s,o;try{await T({projectId:d}),m({description:"Completion status updated successfully",title:"Success"})}catch(a){m({title:"Error",description:((o=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:o.message)||a.message||"Failed to update completion status",variant:"destructive"})}};if(b)return e.jsx(le,{});const q=Object.keys((t==null?void 0:t.materialOrderingList)||{}),{shopDetails:r,deliveryLocationDetails:l,generatedLink:H,materialOrderingList:J}=t||{};return e.jsx("div",{className:"w-full h-full flex flex-col",children:E?e.jsx(Y,{}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex-shrink-0 flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-4",children:[e.jsxs("h2",{className:"text-2xl sm:text-2xl lg:text-2xl xl:text-3xl font-semibold text-blue-600 flex items-center",children:[O&&e.jsx("button",{onClick:M,className:"mr-3 p-2 rounded-md border-gray-300 hover:bg-gray-100",title:"Open Menu",children:e.jsx("i",{className:"fa-solid fa-bars"})}),e.jsx("i",{className:"fa-solid fa-cart-shopping mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Ordering Material"}),e.jsx("span",{className:"sm:hidden",children:"Order Material"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full sm:w-auto",children:[e.jsxs(x,{isLoading:z,onClick:_,className:"bg-green-600 hover:bg-green-700 text-white w-full sm:w-auto whitespace-nowrap",children:[e.jsx("i",{className:"fa-solid fa-circle-check mr-2"}),"Mark as Complete"]}),e.jsx(de,{projectId:d,stageNumber:8,stagePath:"orderingmaterial"}),e.jsx(ne,{stageName:"OrderingMaterialModel",projectId:d,organizationId:P,currentAssignedStaff:(t==null?void 0:t.assignedTo)||null})]})]}),v&&e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"max-w-xl p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2",children:"⚠️ Error Occurred"}),e.jsx("p",{className:"text-red-500 text-sm mb-4",children:((S=(w=N==null?void 0:N.response)==null?void 0:w.data)==null?void 0:S.message)||"Failed to load ordering material"}),e.jsx(x,{isLoading:b,onClick:()=>p(),className:"bg-red-600 text-white hover:bg-red-700",children:"Retry"})]})}),!v&&e.jsxs("div",{className:"flex-1 min-h-0 overflow-y-auto space-y-4 sm:space-y-6",children:[e.jsxs(ie,{className:"p-4 w-full shadow border-l-4 border-blue-600 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-3 text-blue-700 text-sm font-medium mb-2",children:[e.jsx("i",{className:"fa-solid fa-clock text-blue-500 text-lg"}),e.jsx("span",{children:"Stage Timings"})]}),e.jsx(oe,{completedAt:(y=t==null?void 0:t.timer)==null?void 0:y.completedAt,stageName:"orderingmaterial",formId:t==null?void 0:t._id,projectId:d,deadLine:(C=t==null?void 0:t.timer)==null?void 0:C.deadLine,startedAt:(k=t==null?void 0:t.timer)==null?void 0:k.startedAt,refetchStageMutate:p,deadLineMutate:$,isPending:B})]}),e.jsxs("div",{className:"border-l-4 border-blue-600 rounded-lg p-4 shadow-sm relative bg-white",children:[e.jsxs("h2",{className:"text-base sm:text-lg font-bold mb-3 text-blue-700 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-store"}),"Shop Details"]}),L?e.jsxs("div",{className:"space-y-3",children:[e.jsx(c,{placeholder:"Shop Name",value:i.shopName||"",onChange:s=>u({...i,shopName:s.target.value}),className:"w-full"}),e.jsx(c,{placeholder:"Contact Person",value:i.contactPerson||"",onChange:s=>u({...i,contactPerson:s.target.value}),className:"w-full"}),e.jsx(c,{placeholder:"Phone Number",value:i.phoneNumber||"",type:"tel",maxLength:10,onChange:s=>u({...i,phoneNumber:s.target.value}),className:"w-full"}),e.jsx(c,{placeholder:"Address",value:i.address||"",onChange:s=>u({...i,address:s.target.value}),className:"w-full"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mt-3",children:[e.jsxs(x,{onClick:W,className:"w-full sm:w-auto",children:[e.jsx("i",{className:"fa-solid fa-save mr-2"}),"Save"]}),e.jsxs(x,{variant:"outline",onClick:()=>f(!1),className:"w-full sm:w-auto",children:[e.jsx("i",{className:"fa-solid fa-times mr-2"}),"Cancel"]})]})]}):e.jsxs("div",{className:"space-y-2 text-sm sm:text-base",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Shop Name:"})," ",(r==null?void 0:r.shopName)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Contact Person:"})," ",(r==null?void 0:r.contactPerson)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Phone:"})," ",(r==null?void 0:r.phoneNumber)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Address:"})," ",(r==null?void 0:r.address)||"-"]}),(t==null?void 0:t.status)!=="completed"&&e.jsxs("button",{onClick:()=>{u(r),f(!0)},className:"absolute top-3 right-4 text-blue-600 text-xs sm:text-sm underline hover:text-blue-800",children:[e.jsx("i",{className:"fa-solid fa-edit mr-1"}),"Edit"]})]})]}),e.jsxs("div",{className:"border-l-4 border-blue-600 rounded-lg p-4 shadow-sm relative bg-white",children:[e.jsxs("h2",{className:"text-base sm:text-lg font-bold mb-3 text-blue-700 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-truck"}),"Delivery Location"]}),I?e.jsxs("div",{className:"space-y-3",children:[e.jsx(c,{placeholder:"Site Name",value:n.siteName||"",onChange:s=>h({...n,siteName:s.target.value}),className:"w-full"}),e.jsx(c,{placeholder:"Site Supervisor",value:n.siteSupervisor||"",onChange:s=>h({...n,siteSupervisor:s.target.value}),className:"w-full"}),e.jsx(c,{placeholder:"Phone Number",type:"tel",maxLength:10,value:n.phoneNumber||"",onChange:s=>h({...n,phoneNumber:s.target.value}),className:"w-full"}),e.jsx(c,{placeholder:"Address",value:n.address||"",onChange:s=>h({...n,address:s.target.value}),className:"w-full"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mt-3",children:[e.jsxs(x,{onClick:Z,className:"w-full sm:w-auto",children:[e.jsx("i",{className:"fa-solid fa-save mr-2"}),"Save"]}),e.jsxs(x,{variant:"outline",onClick:()=>j(!1),className:"w-full sm:w-auto",children:[e.jsx("i",{className:"fa-solid fa-times mr-2"}),"Cancel"]})]})]}):e.jsxs("div",{className:"space-y-2 text-sm sm:text-base",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Site Name:"})," ",(l==null?void 0:l.siteName)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Supervisor:"})," ",(l==null?void 0:l.siteSupervisor)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Phone:"})," ",(l==null?void 0:l.phoneNumber)||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Address:"})," ",(l==null?void 0:l.address)||"-"]}),(t==null?void 0:t.status)!=="completed"&&e.jsxs("button",{onClick:()=>{h(l),j(!0)},className:"absolute top-3 right-4 text-blue-600 text-xs sm:text-sm underline hover:text-blue-800",children:[e.jsx("i",{className:"fa-solid fa-edit mr-1"}),"Edit"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:q.map(s=>{const o=J[s]||[];return e.jsxs("div",{className:"border-l-4 border-blue-600 p-4 rounded-xl shadow hover:shadow-md transition cursor-pointer bg-white transform hover:scale-[1.02]",onClick:()=>A(`ordermaterialroom/${s}`),children:[e.jsxs("h3",{className:"text-sm sm:text-base font-semibold capitalize text-blue-800 mb-2 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-door-open"}),s.replace(/([A-Z])/g," $1")]}),e.jsxs("p",{className:"text-xs sm:text-sm text-gray-600 mb-1",children:[e.jsx("i",{className:"fa-solid fa-box mr-1"}),"Items: ",o.length]}),e.jsxs("p",{className:"text-xs text-gray-400 flex items-center gap-1",children:[e.jsx("i",{className:"fa-solid fa-mouse-pointer"}),"Click to view details"]})]},s)})}),e.jsx("section",{className:"mt-4",children:e.jsx(re,{projectId:d,context:"order material",stage:"ordermaterial",data:H,isPending:F,generateLink:U})})]})]})})};export{Ce as default};
