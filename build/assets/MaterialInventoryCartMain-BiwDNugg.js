import{j as e,u as U,a as T,r as y}from"./index-IX_jUi_Z.js";import{u as z,b as Q,c as V,d as Y}from"./MaterialInventoryCartApi-HNuy3UhB.js";import{u as H}from"./projectApi-Bftt2BHg.js";import{C as g,a as G,b as M,d as f,c as $}from"./Card-DYFZZWO8.js";import{B as m}from"./Button-D7Kb4xIQ.js";import{B as D}from"./Badge-DGC9tvRt.js";import{t as h}from"./toast-BSC5QTk1.js";import J from"./MaterialOverviewLoading-65JYNlHA.js";import{t as N}from"./dateFormator-BGKi5rfZ.js";import{S as K}from"./SearchSelectNew-BUwpxXf4.js";import{L as W}from"./Label-CTWkJgEj.js";import{d as X}from"./downloadFile-B22emGgP.js";import"./useQuery-BBgvqOK0.js";import"./useMutation-oVcqBODs.js";import"./roleCheck-yWEzJ9f0.js";import"./Skeleton-BKzIbh6x.js";const Z=()=>e.jsxs(g,{className:"mt-6",children:[e.jsx(G,{children:e.jsxs(M,{className:"text-base sm:text-lg flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-circle-info text-blue-600"}),"Order Information"]})}),e.jsx(f,{children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-blue-50 rounded-lg",children:[e.jsx("i",{className:"fa-solid fa-truck text-blue-600 mt-1"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800",children:"Delivery"}),e.jsx("p",{className:"text-gray-600 text-xs mt-1",children:"Estimated 5-7 business days"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-green-50 rounded-lg",children:[e.jsx("i",{className:"fa-solid fa-shield-halved text-green-600 mt-1"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800",children:"Secure Checkout"}),e.jsx("p",{className:"text-gray-600 text-xs mt-1",children:"Your data is protected"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-purple-50 rounded-lg",children:[e.jsx("i",{className:"fa-solid fa-headset text-purple-600 mt-1"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800",children:"Support"}),e.jsx("p",{className:"text-gray-600 text-xs mt-1",children:"24/7 customer service available"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-orange-50 rounded-lg",children:[e.jsx("i",{className:"fa-solid fa-rotate-left text-orange-600 mt-1"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800",children:"Returns"}),e.jsx("p",{className:"text-gray-600 text-xs mt-1",children:"30-day return policy"})]})]})]})})]}),ee=({item:l,onUpdateQuantity:p,onRemoveItem:n,isUpdating:j,isRemoving:o})=>{const a=l.specification||{},u=a.imageUrl||a.image||null;return e.jsxs(g,{className:"mb-4 shadow-xl border border-gray-100 hover:shadow-2xl transition-shadow",children:[e.jsx(G,{className:"flex flex-row items-center justify-between pb-2",children:e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[u&&e.jsx("img",{src:u,alt:"product",className:"w-16 h-16 sm:w-20 sm:h-20 object-cover rounded-lg border border-gray-400 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start gap-2 flex-wrap",children:[e.jsx(M,{className:"text-base sm:text-lg font-bold text-blue-900",children:N(a.subcategory||a.name||a.model||"Unnamed",30)}),l.orderedBefore&&e.jsxs(D,{className:"bg-blue-100 text-blue-700 text-xs whitespace-nowrap",children:[e.jsx("i",{className:"fa-solid fa-clock-rotate-left mr-1"}),"Reorder"]})]}),e.jsxs($,{className:"text-xs text-gray-500 mt-1",children:[a.category&&e.jsx("span",{className:"mr-2",children:e.jsx(D,{variant:"secondary",children:a.category})}),a.model&&e.jsxs("span",{className:"mr-2",children:["Model: ",e.jsx("span",{className:"font-semibold",children:N(a.model,14)})]}),a.itemCode&&e.jsxs("span",{className:"mr-2",children:["Code: ",e.jsx("span",{className:"font-semibold",children:a.itemCode})]})]})]})]})}),e.jsxs(f,{children:[e.jsx("div",{className:"flex flex-wrap gap-3 text-xs text-gray-700 mb-4",children:Object.entries(a).map(([i,s])=>["image","imageUrl","_id","organizationId","series","cct","mrp","itemCode","name","subcategory","category","model"].includes(i)||typeof s=="object"||s===void 0||s===null?null:e.jsxs("div",{className:"bg-gray-50 rounded px-2 py-1 border border-gray-100",children:[e.jsxs("span",{className:"font-semibold capitalize",children:[N(i,12),":"]})," ",N(String(s),18)]},i))}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 border-t border-gray-200 pt-4",children:[e.jsxs("div",{className:"space-y-1",children:[a.mrp&&e.jsxs("p",{className:"text-xs sm:text-sm text-gray-500",children:["Unit Price: ₹",a.mrp.toLocaleString("en-IN",{minimumFractionDigits:2})]}),e.jsxs("p",{className:"text-lg sm:text-xl font-bold text-blue-600",children:["Item Total: ₹",l.singleItemCost.toLocaleString("en-IN",{minimumFractionDigits:2})]})]}),e.jsxs("div",{className:"flex items-center gap-3 w-full sm:w-auto",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-gray-50 rounded-lg p-1 border border-gray-200",children:[e.jsx(m,{onClick:()=>p(l.productId,Math.max(1,l.quantity-1)),className:"w-8 h-8 p-0 bg-red-600 hover:bg-red-700 text-white rounded-md shadow-sm",variant:"danger",disabled:j||l.quantity<=1,isLoading:!1,children:e.jsx("i",{className:"fa-solid fa-minus text-sm"})}),e.jsx("span",{className:"w-12 text-center font-bold text-gray-800 text-lg",children:l.quantity}),e.jsx(m,{onClick:()=>p(l.productId,l.quantity+1),variant:"primary",className:"w-8 h-8 p-0 bg-blue-600 hover:bg-blue-700 rounded-md shadow-sm",disabled:j,isLoading:!1,children:e.jsx("i",{className:"fa-solid fa-plus text-sm"})})]}),e.jsx(m,{onClick:()=>n(l.productId),variant:"danger",className:"w-10 h-10 p-0 bg-red-600 hover:bg-red-700 text-white rounded-lg",disabled:o,isLoading:o,children:e.jsx("i",{className:"fa-solid fa-trash text-sm"})})]})]})]})]})},je=()=>{var L,P,F,k,_;const{organizationId:l}=U(),p=T(),[n,j]=y.useState(""),{data:o}=H(l),a=o==null?void 0:o.map(t=>({_id:t._id,projectName:t.projectName})),u=(L=o||[])==null?void 0:L.map(t=>({value:t._id,label:t.projectName}));y.useEffect(()=>{a&&a.length>0&&!n&&j(a[0]._id)},[a,n]);const i=y.useMemo(()=>a==null?void 0:a.find(t=>{if(t._id===n)return console.log("projectname",t),t==null?void 0:t.projectName}),[n]);console.log("currentProjectName",i);const{data:s,isLoading:R,error:d,refetch:b}=z({organizationId:l,projectId:n}),{mutateAsync:q,isPending:w}=Q(),{mutateAsync:E,isPending:C}=V(),{mutateAsync:O,isPending:I}=Y(),A=async(t,c)=>{var r,x;if(!(!(s!=null&&s._id)||w))try{await q({cartId:s._id,productId:t,quantity:c}),h({title:"Success",description:"Cart updated successfully"}),b()}catch(v){h({title:"Error",description:((x=(r=v==null?void 0:v.response)==null?void 0:r.data)==null?void 0:x.message)||"Failed to update quantity",variant:"destructive"})}},B=async t=>{var c,r;if(!(!(s!=null&&s._id)||C))try{await E({cartId:s._id,productId:t}),h({title:"Success",description:"Item removed from cart"}),b()}catch(x){h({title:"Error",description:((r=(c=x==null?void 0:x.response)==null?void 0:c.data)==null?void 0:r.message)||"Failed to remove item",variant:"destructive"})}},S=async()=>{var t,c;try{const r=await O({projectId:n,id:(s==null?void 0:s._id)||""});X({src:r==null?void 0:r.url,alt:r==null?void 0:r.fileName}),b(),h({title:"Success",description:"Material Pdf Geenrated"})}catch(r){h({title:"Error",description:((c=(t=r==null?void 0:r.response)==null?void 0:t.data)==null?void 0:c.message)||"Failed too Generate Pdf",variant:"destructive"})}};return R?e.jsx(J,{}):d?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4 sm:p-6 lg:p-8",children:e.jsx("div",{className:"container mx-auto max-w-6xl",children:e.jsx(g,{className:"border-red-200",children:e.jsxs(f,{className:"p-8 text-center",children:[e.jsx("div",{className:"mb-4",children:e.jsx("i",{className:"fa-solid fa-circle-exclamation text-6xl text-red-500"})}),e.jsx("h2",{className:"text-xl font-semibold text-red-700 mb-2",children:"Error Loading Cart"}),e.jsx("p",{className:"text-gray-600 mb-4",children:d instanceof Error?((F=(P=d==null?void 0:d.response)==null?void 0:P.data)==null?void 0:F.message)||(d==null?void 0:d.message):"An unexpected error occurred"}),e.jsxs(m,{onClick:()=>b(),className:"bg-red-600 hover:bg-red-700 text-white",children:[e.jsx("i",{className:"fa-solid fa-rotate-right mr-2"}),"Retry"]})]})})})}):e.jsx("div",{className:`min-h-full max-h-full overflow-y-auto \r
        bg-gradient-to-br from-blue-50 to-indigo-100 p-2 `,children:e.jsxs("div",{className:"max-w-full",children:[e.jsx("header",{className:"mb-2 ",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("section",{className:"flex gap-3 items-center",children:[e.jsx("div",{onClick:()=>p(-1),className:"bg-white hover:bg-slate-200 flex items-center justify-center w-10 h-10 border border-gray-300 cursor-pointer rounded-lg shadow-sm mb-4 transition-colors",children:e.jsx("i",{className:"fas fa-arrow-left text-gray-700"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl sm:text-3xl lg:text-4xl font-bold text-blue-900 flex items-center gap-3",children:[e.jsx("i",{className:"fa-solid fa-cart-shopping"}),"Inventory Cart"]}),e.jsx("p",{className:"text-gray-600 text-sm sm:text-base mt-1",children:"Review and manage your selected materials"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 items-stretch sm:items-center",children:[e.jsxs("div",{className:"relative min-w-[250px]",children:[e.jsx(W,{children:"Select project for the displaying the cart items"}),e.jsx(K,{options:u,placeholder:"Select project",searchPlaceholder:"Search projects...",value:n||void 0,onValueChange:t=>j(t||""),searchBy:"name",displayFormat:"simple",className:"w-full"})]}),e.jsxs(m,{isLoading:I,onClick:S,className:"bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white shadow-lg hover:shadow-xl transition-all whitespace-nowrap",disabled:!((k=s==null?void 0:s.items)!=null&&k.length),children:[e.jsx("i",{className:"fa-solid fa-file-pdf mr-2"}),"Generate PDF"]})]})]})}),!s||((_=s.items)==null?void 0:_.length)===0?e.jsx(g,{children:e.jsxs(f,{className:" p-8 sm:p-12 text-center",children:[e.jsx("div",{className:"mb-6",children:e.jsx("i",{className:"fa-solid fa-cart-shopping text-6xl sm:text-8xl text-gray-300"})}),e.jsx("h2",{className:"text-xl sm:text-2xl font-semibold text-gray-700 mb-3",children:"Your Cart is Empty"}),e.jsx("p",{className:"text-gray-500 mb-2 text-sm sm:text-base",children:"Start adding materials to see them here."}),e.jsx("p",{className:"text-gray-500 mb-6 text-sm sm:text-base",children:n&&(i!=null&&i.projectName)?e.jsx("p",{children:`No Carts Available for the ${i==null?void 0:i.projectName}`}):null})]})}):e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"mb-6",children:e.jsx(f,{className:"p-2",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:(s==null?void 0:s.items.length)||0}),e.jsx("p",{className:"text-2xl font-semibold ml-1 text-gray-600",children:"Cart Items"}),e.jsx("br",{})]}),e.jsxs("div",{className:"text-left sm:text-right",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Amount"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:["₹",s==null?void 0:s.totalCost.toLocaleString("en-IN",{minimumFractionDigits:2})]})]})]})})}),e.jsx("div",{className:"space-y-4 mb-6",children:s==null?void 0:s.items.map(t=>e.jsx(ee,{item:t,onUpdateQuantity:A,onRemoveItem:B,isUpdating:w,isRemoving:C},t.productId))}),e.jsx(g,{className:" bottom-4 sm:bottom-6 shadow-2xl",children:e.jsx(f,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm sm:text-base",children:[e.jsxs("span",{className:"text-gray-600",children:["Subtotal (",s==null?void 0:s.items.length," items)"]}),e.jsxs("span",{className:"font-semibold text-gray-800",children:["₹",s==null?void 0:s.totalCost.toLocaleString("en-IN",{minimumFractionDigits:2})]})]}),e.jsx("div",{className:"border-t-2 border-gray-300 pt-3",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-lg sm:text-xl font-bold text-gray-900",children:"Total Cost"}),e.jsxs("span",{className:"text-2xl sm:text-3xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent",children:["₹",s==null?void 0:s.totalCost.toLocaleString("en-IN",{minimumFractionDigits:2})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 pt-2",children:[e.jsxs(m,{variant:"secondary",onClick:()=>p(-1),className:" w-full order-2 sm:order-1",children:[e.jsx("i",{className:"fa-solid fa-arrow-left mr-2"}),"Continue Shopping"]}),e.jsxs(m,{isLoading:I,onClick:S,className:"bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white w-full shadow-lg hover:shadow-xl transition-all order-1 sm:order-2",disabled:!(s!=null&&s.items.length),children:[e.jsx("i",{className:"fa-solid fa-file-pdf mr-2"}),"Generate Order PDF"]})]}),(s==null?void 0:s.pdfLink)&&e.jsx("div",{className:"pt-3 border-t border-gray-200",children:e.jsxs("a",{href:s.pdfLink,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center gap-2 text-sm text-blue-600 hover:text-blue-700 transition-colors font-medium",children:[e.jsx("i",{className:"fa-solid fa-file-pdf"}),e.jsx("span",{children:"View Generated Order Summary (PDF)"}),e.jsx("i",{className:"fa-solid fa-arrow-up-right-from-square text-xs"})]})})]})})}),e.jsx("div",{className:"mt-6",children:e.jsx(Z,{})})]})]})})};export{Z as OrderInformation,je as default};
