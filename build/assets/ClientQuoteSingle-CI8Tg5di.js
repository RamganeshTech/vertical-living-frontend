import{a as L,b as M,c as P,r as n,R as k,j as e}from"./index-By5P0A7l.js";import{B as Q}from"./Button-DLUK8O0t.js";import F from"./MaterialOverviewLoading-9Ck4pGPe.js";import{t as m}from"./toast-BSC5QTk1.js";import{C as I}from"./ClientFurnitures-CCnSnJJw.js";import{a as _,b as O}from"./clientQuoteApi-Dls1oWMQ.js";import{L as V}from"./Label-TAdUzpu-.js";import{S as $,a as G,b as z,c as D,d as U}from"./Select-BbLyDIRO.js";import"./Skeleton-FCBR4RgB.js";import"./roleCheck-YGaMnK_P.js";import"./useQuery-Cc7pLKfK.js";import"./useMutation-7YLqc7VE.js";const re=0,ne=()=>{var h,j,y;const{organizationId:u,quoteId:p}=L(),N=M(),{role:x,permission:l}=P(),b=x==="owner"||((h=l==null?void 0:l.materialquote)==null?void 0:h.create),S=x==="owner"||((j=l==null?void 0:l.materialquote)==null?void 0:j.edit),{data:s,isLoading:v}=_(u,p),{mutateAsync:w,isPending:f}=O(),i=n.useRef([]),[d,T]=n.useState(!0),[g,A]=n.useState("type 1"),[o,E]=n.useState([]),[c,C]=n.useState((s==null?void 0:s.grandTotal)||0);n.useEffect(()=>{C(s==null?void 0:s.grandTotal)},[s]);const B=async()=>{var a,t;try{if(!u||!p||!s){m({title:"Missing info",description:"Please ensure quote and all details are not missing",variant:"destructive"});return}if(!confirm("Are you sure want to send this quotation to payment?"))return;await w({organizationId:u,id:p}),m({title:"success",description:"Quote Selected and stored in the payment stage"})}catch(r){m({title:"Error",description:((t=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:t.message)??"Operation failed"})}},R=async()=>{var a,t;try{T(r=>!r)}catch(r){m({title:"Error",description:((t=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:t.message)??"Operation failed"})}};return n.useEffect(()=>{if(!(s!=null&&s.furnitures))return;const a=s.furnitures.map(t=>({furnitureName:t.furnitureName,coreMaterials:t.coreMaterials||[],fittingsAndAccessories:t.fittingsAndAccessories||[],glues:t.glues||[],nonBrandMaterials:t.nonBrandMaterials||[],totals:{core:t.coreMaterialsTotal||0,fittings:t.fittingsAndAccessoriesTotal||0,glues:t.gluesTotal||0,nbms:t.nonBrandMaterialsTotal||0,furnitureTotal:t.furnitureTotal||0},plywoodBrand:"",laminateBrand:""}));E(a)},[s]),i.current.length!==o.length&&(i.current=o.map((a,t)=>i.current[t]??k.createRef())),n.useEffect(()=>{console.log("furnitureRefs Array",i),i.current=o.map((a,t)=>i.current[t]??n.createRef())},[o]),e.jsxs("div",{className:"p-2 max-h-full overflow-y-auto",children:[e.jsxs("header",{className:"bg-white border-b border-gray-200 pb-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("button",{onClick:()=>N(-1),className:"flex cursor-pointer items-center justify-center w-8 h-8 bg-gray-50 hover:bg-gray-100 border border-gray-300 rounded-md transition-colors flex-shrink-0",children:e.jsx("i",{className:"fas fa-arrow-left text-gray-600 text-sm"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900 truncate",children:((y=s==null?void 0:s.projectId)==null?void 0:y.projectName)||"Project"}),e.jsx("p",{className:"text-md text-gray-500",children:s!=null&&s.quoteNo?`Quote: #${s==null?void 0:s.quoteNo}`:""})]})]}),e.jsxs("div",{className:"flex gap-2 justify-between  items-center",children:[e.jsxs("div",{className:"px-4 text-center",children:[e.jsx("p",{className:"text-md text-gray-600",children:"Total Cost"}),e.jsxs("p",{className:"text-md font-bold text-green-600",children:["₹",c==null?void 0:c.toLocaleString("en-in")]})]}),(b||S)&&e.jsx(Q,{onClick:B,disabled:f,className:"flex-shrink-0 px-4 ",children:f?"Sending...":"Select Quote"}),e.jsxs("div",{className:"flex gap-2 w-fit px-4 justify-center",children:[e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:d,onChange:R,className:"sr-only",id:"blurinput"}),e.jsx("div",{className:`w-11 h-6 rounded-full cursor-pointer transition-colors ${d?"bg-gray-200":"bg-blue-600"}`,children:e.jsx("div",{className:`w-5 h-5 bg-white rounded-full shadow transform transition-transform ${d?"translate-x-0":"translate-x-5"} mt-0.5 ml-0.5`})})]}),e.jsx(V,{htmlFor:"blurinput",className:" cursor-pointer flex flex-4/2",children:"Show Stats"})]}),e.jsx("div",{className:"w-full",children:e.jsxs($,{onValueChange:a=>{let t="type 1";a==="template 1"?t="type 1":a==="template 2"?t="type 2":a==="template 3"&&(t="type 3"),A(t)},children:[e.jsx(G,{className:"w-full",children:e.jsx(z,{placeholder:"Select Template Type",selectedValue:g})}),e.jsx(D,{children:["template 1","template 2","template 3"].map(a=>e.jsx(U,{value:a.toString(),children:a},a))})]})})]})]}),e.jsx("div",{className:" grid grid-cols-4 gap-2"})]}),v?e.jsx(F,{}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-6",children:[o.map((a,t)=>e.jsx(I,{index:t,data:a,ref:i.current[t],templateType:g,isBlurred:d},t)),e.jsx("div",{className:"mt-10 text-right",children:e.jsxs("div",{className:"inline-block bg-green-50 border border-green-200 rounded-md px-6 py-4",children:[e.jsx("p",{className:"text-md font-medium text-gray-700 mb-1",children:"Total Estimate"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700",children:["₹",c==null?void 0:c.toLocaleString("en-in")]})]})})]})})]})};export{re as DEFAULT_LAMINATE_RATE_PER_SQFT,ne as default};
