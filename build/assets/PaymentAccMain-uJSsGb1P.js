import{b as P,j as e,a as $,e as O,u as _,r as w,O as H}from"./index-BZjlY-2Z.js";import{S as V}from"./index-BwY3P9SR.js";import{B as G}from"./Button-BGBzZFjk.js";import{t as C}from"./toast-BSC5QTk1.js";import{B as U}from"./Breadcrumb-CzLdyNJ_.js";import{u as A}from"./useDebounce-Dl4dao7x.js";import{d as q}from"./dateFormator-BGKi5rfZ.js";import{u as J,a as K}from"./paymentAccApi-Dk-eI8uo.js";import{S as Q}from"./StageGuide-BGPpzdDF.js";import"./index-CEnBN4s8.js";import"./useQuery-Coz1VCY2.js";import"./useMutation-BRRIqsxx.js";import"./useInfiniteQuery--LmPAkvr.js";import"./roleCheck-DuKNZHKs.js";const W=({payment:r,index:x,handleView:i,handleDelete:u,deletePending:g})=>{var t,l;const{role:d,permission:m}=P(),f=d==="owner"||((t=m==null?void 0:m.payments)==null?void 0:t.delete),b=o=>{switch(o==null?void 0:o.toLowerCase()){case"paid":return"bg-green-100 text-green-700 border-green-200";case"pending":return"bg-yellow-100 text-yellow-700 border-yellow-200";case"failed":return"bg-red-100 text-red-700 border-red-200";default:return"bg-gray-100 text-gray-700 border-gray-200"}};return e.jsxs("div",{className:"grid cursor-pointer grid-cols-12 gap-4 px-6 py-4 border-b border-gray-100 hover:bg-[#f9fcff] transition-colors items-center last:border-b-0",onClick:()=>i(r._id),children:[e.jsx("div",{className:"col-span-1 text-center text-gray-500 font-medium text-sm",children:x+1}),e.jsx("div",{className:"col-span-3",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("i",{className:`fas ${r.fromSection==="expense"?"fa-receipt":"fa-user"} text-blue-500 text-sm`}),e.jsx("span",{className:"font-semibold text-gray-900 truncate",title:r.paymentPersonName,children:r.paymentPersonName||"Unknown Payee"})]}),e.jsx("span",{className:"text-[10px] text-gray-400 uppercase tracking-wide ml-6 mt-0.5",children:r.fromSection||"Direct"})]})}),e.jsx("div",{className:"col-span-2",children:e.jsx("span",{className:"px-2.5 py-1 bg-blue-50 text-blue-600 border border-blue-100 rounded-md text-xs font-medium tracking-wide",children:r.paymentNumber||"N/A"})}),e.jsxs("div",{className:"col-span-2 text-gray-600 text-sm flex items-center",children:[e.jsx("i",{className:"far fa-calendar-alt text-gray-400 mr-2"}),q(r==null?void 0:r.dueDate)]}),e.jsxs("div",{className:"col-span-2 text-right font-bold text-gray-800",children:["â‚¹",((l=r.grandTotal)==null?void 0:l.toLocaleString("en-IN"))||"0.00"]}),e.jsx("div",{className:"col-span-1 text-center",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-[10px] font-bold uppercase border ${b(r.generalStatus)}`,children:r.generalStatus||"Pending"})}),e.jsx("div",{className:"col-span-1 flex justify-center items-center gap-2",children:f&&e.jsx("button",{onClick:o=>{o.stopPropagation(),u(r._id)},disabled:g,className:"group p-2 rounded-lg hover:bg-red-50 transition-all disabled:opacity-50 disabled:cursor-not-allowed",title:"Delete Record",children:g?e.jsx("i",{className:"fas fa-spinner fa-spin text-red-500 text-sm"}):e.jsx("i",{className:"far fa-trash-alt text-gray-400 group-hover:text-red-500 transition-colors text-sm"})})})]})},me=()=>{var k;const r=$(),x=O(),{organizationId:i}=_(),u=w.useRef(null),{role:g,permission:d}=P(),m=g==="owner"||((k=d==null?void 0:d.payments)==null?void 0:k.list),f=[{label:"Account",path:`/organizations/${i}/projects/accounting`},{label:"Payments",path:`/organizations/${i}/projects/paymentmain`}],b=x.pathname.includes("/single")||x.pathname.includes("/create"),[t,l]=w.useState({search:"",minAmount:0,maxAmount:1e6,startDate:"",endDate:"",fromSection:""}),o=A(t.search,500),L=A(t.minAmount,800),F=A(t.maxAmount,800),{data:h,fetchNextPage:S,hasNextPage:p,isFetchingNextPage:y,isLoading:E,isError:M,error:j,refetch:T}=J({organizationId:i||"",personName:o||void 0,minAmount:L,maxAmount:F,startDate:t.startDate||void 0,endDate:t.endDate||void 0,fromSection:t.fromSection||void 0}),N=K();w.useEffect(()=>{const s=u.current;if(!s)return;const a=()=>{const{scrollTop:c,scrollHeight:n,clientHeight:z}=s;n-c-z<100&&p&&!y&&(console.log("ðŸ“œ Loading more payments..."),S())};return s.addEventListener("scroll",a),()=>s.removeEventListener("scroll",a)},[p,y,S]);const B=async s=>{var a,c;if(confirm("Are you sure you want to delete this payment record?"))try{await N.mutateAsync(s),C({title:"Success",description:"Payment record deleted successfully"})}catch(n){C({title:"Error",description:((c=(a=n==null?void 0:n.response)==null?void 0:a.data)==null?void 0:c.message)||(n==null?void 0:n.message)||"Failed to delete payment",variant:"destructive"})}},I=s=>{r(`single/${s}`)},R=()=>{l({search:"",minAmount:0,maxAmount:1e7,startDate:"",endDate:"",fromSection:""})},D=Object.values(t).filter(s=>s!==""&&s!==0&&s!==1e5).length,v=(h==null?void 0:h.pages.flatMap(s=>s.data))||[];return b?e.jsx(H,{}):e.jsxs("div",{className:"space-y-0 h-full",children:[e.jsxs("header",{className:"flex justify-between items-center pb-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-money-check-alt mr-3 text-blue-600"}),"Payments"]}),e.jsx(U,{paths:f})]}),e.jsx("div",{className:"w-full sm:w-auto flex justify-end sm:block",children:e.jsx(Q,{organizationId:i,stageName:"payments"})})]}),E?e.jsx("div",{className:"flex justify-center items-center py-12 h-[60vh]",children:e.jsx("i",{className:"fas fa-spinner fa-spin text-blue-600 text-4xl"})}):M?e.jsxs("div",{className:"max-w-xl mx-auto mt-4 p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2 text-xl",children:"âš ï¸ Error Occurred"}),e.jsx("p",{className:"text-red-500 mb-4 text-lg",children:(j==null?void 0:j.message)||"Failed to load payments"}),e.jsx(G,{onClick:()=>T(),className:"bg-red-600 text-white px-4 py-2",children:"Retry"})]}):e.jsxs("main",{className:"flex gap-4 h-[calc(100%-80px)]",children:[e.jsx("div",{className:"xl:w-80 lg:w-72 w-64 flex-shrink-0 h-full overflow-y-auto custom-scrollbar",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-5 border border-gray-100 h-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-filter mr-2 text-blue-600"}),"Filters"]}),D>0&&e.jsxs("button",{onClick:R,className:"text-sm text-blue-600 hover:text-blue-800 font-medium transition-colors",children:["Clear All (",D,")"]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx("i",{className:"fas fa-search mr-2 text-gray-400"}),"Search Payee"]}),e.jsx("input",{type:"text",placeholder:"Name, Company...",value:t.search,onChange:s=>l(a=>({...a,search:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-4",children:[e.jsx("i",{className:"fas fa-coins mr-2 text-gray-400"}),"Amount Range"]}),e.jsx("div",{className:"px-2 mb-3",children:e.jsx(V,{range:!0,min:0,max:1e6,step:500,value:[Number(t.minAmount),Number(t.maxAmount)],onChange:s=>{const[a,c]=s;l(n=>({...n,minAmount:a,maxAmount:c}))},trackStyle:[{backgroundColor:"#3b82f6",height:6}],handleStyle:[{borderColor:"#3b82f6",backgroundColor:"#fff",boxShadow:"0 2px 6px rgba(59, 130, 246, 0.4)",width:18,height:18,marginTop:-6,opacity:1},{borderColor:"#3b82f6",backgroundColor:"#fff",boxShadow:"0 2px 6px rgba(59, 130, 246, 0.4)",width:18,height:18,marginTop:-6,opacity:1}],railStyle:{backgroundColor:"#e5e7eb",height:6}})}),e.jsxs("div",{className:"flex justify-between items-center gap-2 text-sm",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-xs text-gray-500 block mb-1",children:"Min"}),e.jsxs("div",{className:"bg-blue-50 px-2 py-1.5 rounded border border-blue-100 font-semibold text-blue-700 text-center text-xs",children:["â‚¹",Number(t.minAmount).toLocaleString("en-IN")]})]}),e.jsx("div",{className:"text-gray-300",children:"â€”"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-xs text-gray-500 block mb-1",children:"Max"}),e.jsxs("div",{className:"bg-blue-50 px-2 py-1.5 rounded border border-blue-100 font-semibold text-blue-700 text-center text-xs",children:["â‚¹",Number(t.maxAmount).toLocaleString("en-IN")]})]})]}),e.jsxs("div",{className:"flex gap-2 items-center mt-3",children:[e.jsx("input",{type:"number",value:t.minAmount,onChange:s=>l(a=>({...a,minAmount:+s.target.value})),placeholder:"Min",className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500",min:"0"}),e.jsx("input",{type:"number",value:t.maxAmount,onChange:s=>l(a=>({...a,maxAmount:+s.target.value})),placeholder:"Max",className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500",min:"0"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx("i",{className:"fas fa-calendar-alt mr-2 text-gray-400"}),"Due Date From"]}),e.jsx("input",{type:"date",value:t.startDate,onChange:s=>l(a=>({...a,startDate:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx("i",{className:"fas fa-calendar-alt mr-2 text-gray-400"}),"Due Date To"]}),e.jsx("input",{type:"date",value:t.endDate,onChange:s=>l(a=>({...a,endDate:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx("i",{className:"fas fa-tag mr-2 text-gray-400"}),"Source Type"]}),e.jsxs("select",{value:t.fromSection,onChange:s=>l(a=>({...a,fromSection:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none bg-white",children:[e.jsx("option",{value:"",children:"All Sources"}),e.jsx("option",{value:"Bill",children:"Bill"}),e.jsx("option",{value:"Expense",children:"Expense"})]})]})]})]})}),m&&e.jsxs(e.Fragment,{children:[" ",v.length===0?e.jsxs("div",{className:"flex-1 bg-white rounded-xl shadow-sm border border-gray-200 flex flex-col items-center justify-center p-8",children:[e.jsx("div",{className:"bg-blue-50 p-4 rounded-full mb-4",children:e.jsx("i",{className:"fas fa-file-invoice-dollar text-4xl text-blue-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:"No Payments Found"}),e.jsx("p",{className:"text-gray-500 text-center max-w-md",children:t.search||t.startDate?"Try adjusting your filters to find payment records.":"No payment records available yet. Start by creating a new payment."})]}):e.jsxs("div",{ref:u,className:"flex-1 bg-white rounded-xl shadow-sm border border-gray-200 overflow-y-auto custom-scrollbar flex flex-col",children:[e.jsx("div",{className:"sticky top-0 z-10 bg-white border-b border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 px-6 py-4 bg-gray-50 font-semibold text-gray-700 text-sm uppercase tracking-wider",children:[e.jsx("div",{className:"col-span-1 text-center",children:"#"}),e.jsx("div",{className:"col-span-3",children:"Payee Name"}),e.jsx("div",{className:"col-span-2",children:"Payment No"}),e.jsx("div",{className:"col-span-2",children:"Due Date"}),e.jsx("div",{className:"col-span-2 text-right",children:"Amount"}),e.jsx("div",{className:"col-span-1 text-center",children:"Status"}),e.jsx("div",{className:"col-span-1 text-center",children:"Action"})]})}),e.jsx("div",{className:"divide-y divide-gray-100",children:v.map((s,a)=>e.jsx(W,{payment:s,index:a,handleView:I,handleDelete:B,deletePending:N.isPending&&N.variables===s._id},s._id))}),y&&e.jsx("div",{className:"flex justify-center py-6 bg-gray-50 border-t border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-2 text-blue-600",children:[e.jsx("i",{className:"fas fa-spinner fa-spin text-xl"}),e.jsx("span",{className:"text-sm font-medium",children:"Loading more payments..."})]})}),!p&&v.length>0&&e.jsx("div",{className:"flex justify-center py-6 bg-gray-50 border-t border-gray-100",children:e.jsxs("p",{className:"text-gray-400 text-sm font-medium flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle mr-2"}),"All records loaded"]})})]})]})]})]})};export{me as default};
