import{u as z,r as m,k as M,j as e,B as g,M as U,t as c}from"./index-BAM0eJUz.js";import{u as q,a as H,b as $,I as K}from"./ImageGalleryMain-B3g6b13d.js";import{C as Q,b as V,c as X,a as Y}from"./Card-CdxfjEr-.js";import{S as w,f as D}from"./ShortListMain-CkHPlJB3.js";import{S as Z}from"./StageGuide-e28gQ0h1.js";import"./downloadFile-BbGV_BaX.js";import"./index-C8BdbktQ.js";const _=["image/jpeg","image/jpg","image/png","image/webp"];function ie(){var b,y,v,N;const{organizationId:n}=z(),x=m.useRef(null),[f,u]=m.useState(!1),[h,I]=m.useState([]),[o,p]=m.useState([]),{data:i,refetch:P,isFetching:S}=q({organizationId:n,search:o.length>0?o.join(","):""}),{role:d,permission:t}=M(),C=d==="owner"||((b=t==null?void 0:t.referencedesign)==null?void 0:b.delete),F=d==="owner"||((y=t==null?void 0:t.referencedesign)==null?void 0:y.list),E=d==="owner"||((v=t==null?void 0:t.referencedesign)==null?void 0:v.create),G=d==="owner"||((N=t==null?void 0:t.referencedesign)==null?void 0:N.create),{mutateAsync:k,isPending:R}=H(),{mutateAsync:T}=$(),A=s=>{const l=Array.from(s.target.files||[]).filter(a=>_.includes(a.type));if(l.length===0){c({title:"Error",description:"Please select valid image files (JPG, JPEG, PNG, WEBP)",variant:"destructive"});return}j(l)},j=async s=>{var r,l;try{const a=new FormData;s.forEach(W=>{a.append("files",W)}),a.append("tags",JSON.stringify(h)),await k({organizationId:n,formData:a}),c({title:"Success",description:"Image(s) uploaded successfully."})}catch(a){c({title:"Error",description:((l=(r=a==null?void 0:a.response)==null?void 0:r.data)==null?void 0:l.message)||(a==null?void 0:a.message)||"Failed to upload images",variant:"destructive"})}},L=async s=>{var r,l;try{await T({organizationId:n,imageId:s}),c({title:"Success",description:"Image deleted"})}catch(a){c({title:"Error",description:((l=(r=a==null?void 0:a.response)==null?void 0:r.data)==null?void 0:l.message)||(a==null?void 0:a.message)||"Failed to upload images",variant:"destructive"})}},B=s=>{s.preventDefault(),s.stopPropagation(),u(!1)},J=s=>{s.preventDefault(),s.stopPropagation()},O=async s=>{s.preventDefault(),s.stopPropagation(),u(!1);const r=Array.from(s.dataTransfer.files);await j(r)};return e.jsxs("div",{className:"w-full max-h-full mx-auto p-2 overflow-y-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6",children:[e.jsxs("h1",{className:"text-2xl font-semibold text-gray-800",children:[e.jsx("i",{className:"fa-solid fa-object-group text-2xl text-blue-600 mr-2"}),"Reference Designs"]}),e.jsx("div",{className:"w-full sm:w-auto flex justify-end sm:block",children:e.jsx(Z,{organizationId:n,stageName:"referencedesign"})})]}),e.jsxs("div",{className:"mb-5",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Enter Categories"}),e.jsx(w,{tags:h,setState:I,suggestionFetcher:s=>D({query:s,organizationId:n})})]}),(E||G)&&e.jsxs(Q,{className:"",children:[e.jsx(V,{children:e.jsxs(X,{className:"flex items-center justify-between",children:[f?"Drop files here...":"Drag and drop image files here or ",e.jsx(g,{variant:"outline",size:"sm",className:"text-blue-600 bg-transparent",children:R?e.jsxs(e.Fragment,{children:["Loading ",e.jsx("i",{className:"fas fa-spinner ml-2 animate-spin"})]}):"Upload reference images, and can be used to compare in the projects"})]})}),e.jsxs(Y,{children:[e.jsx("div",{className:`border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors ${f?"border-blue-400 bg-blue-50":"border-gray-300"}`,onClick:()=>{var s;return(s=x.current)==null?void 0:s.click()},onDragLeave:B,onDragOver:J,onDrop:O,children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-lg font-medium",children:"Drag & drop plan/reference images here or"}),e.jsx(g,{variant:"outline",children:"Browse"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Accepted: JPG/PNG/WebP â€¢ Images auto-saved locally"})]})}),e.jsx("input",{ref:x,type:"file",multiple:!0,accept:"image/*",className:"hidden",onChange:A})]})]}),F&&e.jsxs("div",{className:"mt-5",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-end justify-between gap-4 mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-700 mb-3",children:"Images Gallery"}),e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Filter gallery by tags"}),e.jsx("div",{className:"max-w-md",children:e.jsx(w,{tags:o,setState:p,suggestionFetcher:s=>D({query:s,organizationId:n})})})]}),o.length>0&&e.jsx(g,{variant:"ghost",size:"sm",onClick:()=>p([]),className:"text-red-500 hover:text-red-700",children:"Clear Filters"})]}),S?e.jsx("div",{className:"text-center text-gray-600",children:e.jsx(U,{})}):i!=null&&i.referenceImages.length?e.jsx(K,{imageFiles:(i==null?void 0:i.referenceImages)||[],refetch:P,height:190,minWidth:193,maxWidth:200,showTags:!0,...C?{handleDeleteFile:L}:{}}):e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[300px] w-full bg-white rounded-xl   text-center p-6",children:[e.jsx("i",{className:"fas fa-image text-5xl text-blue-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-1",children:"No Images Found"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Please upload images"})]})]})]})}export{ie as default};
