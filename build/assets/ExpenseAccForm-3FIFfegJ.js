import{r as b,j as e}from"./index-C2yypHlC.js";import{b as A,c as S,d as B}from"./expenseApi-CxRQZQc8.js";import{t as g}from"./toast-BSC5QTk1.js";import{u as $}from"./vendorAccApi-CSdRskxU.js";import{L as E}from"./Label-Cu1McGld.js";import{S as U}from"./SearchSelectNew-pNmNyd8z.js";import M from"./MaterialOverviewLoading-BCEByU05.js";const J=({mode:t,organizationId:f,expenseId:u,onSuccess:c,onCancel:k,onEdit:v,isEditing:P})=>{var C;const y=A(),j=S(),[m,T]=b.useState(!1),{data:n,isLoading:O}=B(u||"",t!=="create"&&!!u),{data:p}=$(f),D=(C=p||[])==null?void 0:C.map(a=>({value:a._id,label:a.vendorName,email:a.email})),[r,h]=b.useState({vendorId:"",vendorName:"",amount:0,dateOfPayment:new Date,paidThrough:"",notes:""}),[d,N]=b.useState({});b.useEffect(()=>{n&&(t==="edit"||t==="view")&&h({vendorId:n.vendorId,vendorName:n.vendorName,amount:n.amount,dateOfPayment:new Date(n.dateOfPayment),paidThrough:n.paidThrough,notes:n.notes||""})},[n,t]);const I=()=>{const a={};return r.vendorName.trim()||(a.vendorName="Vendor name is required"),r.amount<=0&&(a.amount="Amount must be greater than 0"),N(a),Object.keys(a).length===0},x=a=>{const{name:s,value:i}=a.target;h(o=>({...o,[s]:s==="amount"?parseFloat(i)||0:i})),d[s]&&N(o=>({...o,[s]:void 0}))},V=a=>{h(s=>({...s,dateOfPayment:new Date(a.target.value)}))},F=a=>{const s=p==null?void 0:p.find(i=>i._id===a);h(i=>({...i,vendorId:a||"",vendorName:(s==null?void 0:s.vendorName)||""}))},L=async a=>{var s,i;if(a.preventDefault(),t!=="view"){if(!I()){g({title:"Error",description:"Please fix the errors in the form",variant:"destructive"});return}try{t==="create"?(await y.mutateAsync({organizationId:f,...r}),g({title:"Success",description:"Expense created successfully!"}),c==null||c()):t==="edit"&&u&&(await j.mutateAsync({id:u,...r,vendorId:r.vendorId._id}),g({title:"Success",description:"Expense updated successfully!"}),c==null||c())}catch(o){g({title:"Error",description:((i=(s=o==null?void 0:o.response)==null?void 0:s.data)==null?void 0:i.message)||(o==null?void 0:o.message)||"Failed to submit expense",variant:"destructive"})}}};if(t!=="create"&&O)return e.jsx(M,{});const l=t==="view",w=y.isPending||j.isPending;return e.jsxs("form",{onSubmit:L,className:"space-y-6",children:[e.jsxs("header",{className:"border-b pb-4 flex justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900 flex gap-2",children:[e.jsx("div",{onClick:k,className:"bg-blue-50 hover:bg-slate-300 flex items-center justify-between w-8 h-8 border border-[#a6aab8] text-sm cursor-pointer rounded-md px-2 ",children:e.jsx("i",{className:"fas fa-arrow-left"})}),t==="create"&&"Create New Expense",t==="edit"&&"Edit Expense",t==="view"&&"Expense Details"]}),t==="view"&&n&&e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Invoice: ",n==null?void 0:n.invoiceNumber]})]}),e.jsxs("button",{type:"button",onClick:v,className:`bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 \r
                                            transition-colors flex items-center gap-2`,children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),P?"Cancel":"Edit"," Expense"]})]}),e.jsxs("div",{children:[e.jsx(E,{children:"Vendor"}),e.jsx(U,{options:D,placeholder:"Select Vendor",searchPlaceholder:"Search Vendor...",value:(r==null?void 0:r.vendorId)||void 0,onValueChange:a=>F(a),searchBy:"name",displayFormat:"simple",className:"w-full"})]}),e.jsxs("div",{className:"",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"checkbox",className:"cursor-pointer",checked:m,id:"enableName",onChange:()=>T(a=>!a)}),e.jsx(E,{htmlFor:"enableName",className:"cursor-pointer",children:"Click the check box to enter the name manually, if not available from the drop down"})]}),e.jsx("input",{type:"text",name:"vendorName",value:m?r.vendorName:"",onChange:a=>{m&&x(a)},disabled:!m,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",placeholder:"Enter customer name"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Amount ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-2.5 text-gray-500",children:"â‚¹"}),e.jsx("input",{type:"number",name:"amount",value:r.amount,onChange:x,disabled:l,step:"1",min:"0",className:`w-full pl-8 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 
                            ${d.amount?"border-red-500":"border-gray-300"}
                            ${l?"bg-gray-100 cursor-not-allowed":""}`,placeholder:"0.00"})]}),d.amount&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:d.amount})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date of Payment"}),e.jsx("input",{type:"date",value:r.dateOfPayment.toISOString().split("T")[0],onChange:V,disabled:l,className:`w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 
                        ${l?"bg-gray-100 cursor-not-allowed":"border-gray-300"}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Paid Through"}),e.jsxs("select",{name:"paidThrough",value:r.paidThrough,onChange:x,disabled:l,className:`w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 
                        ${d.paidThrough?"border-red-500":"border-gray-300"}
                        ${l?"bg-gray-100 cursor-not-allowed":""}`,children:[e.jsx("option",{value:"",children:"Select payment method"}),e.jsx("option",{value:"Cash",children:"Cash"}),e.jsx("option",{value:"Bank Transfer",children:"Bank Transfer"}),e.jsx("option",{value:"Credit Card",children:"Credit Card"}),e.jsx("option",{value:"Debit Card",children:"Debit Card"}),e.jsx("option",{value:"Check",children:"Check"}),e.jsx("option",{value:"UPI",children:"UPI"}),e.jsx("option",{value:"Other",children:"Other"})]}),d.paidThrough&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:d.paidThrough})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes"}),e.jsx("textarea",{name:"notes",value:r.notes,onChange:x,disabled:l,rows:4,className:`w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 
                        ${l?"bg-gray-100 cursor-not-allowed":"border-gray-300"}`,placeholder:"Add any additional notes..."})]}),e.jsx("div",{className:"flex gap-4 pt-4 border-t",children:!l&&e.jsxs("div",{className:"w-full flex justify-between space-x-3 ",children:[e.jsx("button",{type:"submit",disabled:w,className:`flex-1  bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 \r
                            disabled:opacity-50 disabled:cursor-not-allowed transition-colors`,children:w?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsxs("svg",{className:"animate-spin h-5 w-5",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),t==="create"?"Creating...":"Updating..."]}):t==="create"?"Create Expense":"Update Expense"}),e.jsx("button",{type:"button",onClick:v,className:`flex-1  bg-gray-200 text-gray-700 py-2 px-4 rounded-lg \r
                        hover:bg-gray-300 transition-colors`,children:l?"Close":"Cancel"})]})})]})};export{J as E};
