import{f as s,b as f,g as d,h as c,s as m,i as u,j as r,B as p}from"./index-BAM0eJUz.js";import{u as y}from"./useInfiniteQuery-BGz0VllC.js";import{I as h}from"./Input-1UBXZqEj.js";const l=["owner","CTO","staff"],q=async({organizationId:t,api:a,filters:e,pageParam:o=1})=>{const n={organizationId:t,page:o,limit:20,search:e==null?void 0:e.search,status:e==null?void 0:e.status,startDate:e==null?void 0:e.startDate,endDate:e==null?void 0:e.endDate},{data:i}=await a.get("/quote/presales/getall",{params:n});if(!i.ok)throw new Error(i.message||"Failed to fetch quotes");return i},g=async({id:t,api:a})=>{const{data:e}=await a.get(`/quote/presales/single/${t}`);if(!e.ok)throw new Error(e.message||"Failed to fetch quote");return e.data},x=async({payload:t,api:a})=>{const{data:e}=await a.post("/quote/presales/createmainquote",t);if(!e.ok)throw new Error(e.message||"Failed to create quote");return e},Q=async({id:t,payload:a,api:e})=>{const{data:o}=await e.put(`/quote/presales/update/${t}`,a);if(!o.ok)throw new Error(o.message||"Failed to update quote");return o},P=async({api:t,id:a,formData:e})=>{var n;const o=await t.put(`/quote/presales/update/quotepdfdetails/${a}`,e);if(!(o!=null&&o.data.ok))throw new Error(((n=o==null?void 0:o.data)==null?void 0:n.message)||"Failed to delete materials");return o==null?void 0:o.data.data},E=async({id:t,api:a})=>{const{data:e}=await a.delete(`/quote/presales/delete/${t}`);if(!e.ok)throw new Error(e.message||"Failed to delete quote");return e},N=async({id:t,api:a})=>{const{data:e}=await a.put(`/quote/presales/clone/${t}`);if(!e.ok)throw new Error(e.message||"Failed to delete quote");return e},b=async({id:t,api:a,mainQuoteName:e})=>{const{data:o}=await a.put(`/quote/presales/updatemainquote/${t}`,{mainQuoteName:e});if(!o.ok)throw new Error(o.message||"Failed to delete quote");return o},j=(t,a)=>{const{role:e}=s(),o=u(e);return y({queryKey:["presales","infinite",t,a],queryFn:async({pageParam:n=1})=>{if(!e||!l.includes(e))throw new Error("Not allowed to create quotes");if(!o)throw new Error("API instance for role not found");return await q({organizationId:t,api:o,filters:a,pageParam:n})},initialPageParam:1,getNextPageParam:n=>n.hasMore?n.page+1:void 0,enabled:!!t&&!!e&&!!o})},k=t=>{const{role:a}=s(),e=u(a);return f({queryKey:["presales","single",t],queryFn:async()=>{if(!a||!l.includes(a))throw new Error("Not allowed to create quotes");if(!e)throw new Error("API instance for role not found");return await g({id:t,api:e})},enabled:!!t&&!!a&&!!e})},v=()=>{const{role:t}=s(),a=u(t),e=d();return c({mutationFn:async o=>{if(!t||!l.includes(t))throw new Error("Not allowed to create quotes");if(!a)throw new Error("API instance for role not found");return await x({payload:o,api:a})},onSuccess:()=>{e.invalidateQueries({queryKey:["presales","infinite"]})}})},A=()=>{const{role:t}=s(),a=u(t),e=d();return c({mutationFn:async({id:o,payload:n})=>{if(!t||!l.includes(t))throw new Error("Not allowed to update quotes");if(!a)throw new Error("API instance for role not found");return await Q({id:o,payload:n,api:a})},onSuccess:(o,n)=>{e.invalidateQueries({queryKey:["presales","single",n.id]}),e.invalidateQueries({queryKey:["presales","infinite"]})}})},K=()=>{const{role:t}=s(),a=u(t),e=d();return c({mutationFn:async o=>{if(!t||!l.includes(t))throw new Error("Not allowed to delete quotes");if(!a)throw new Error("API instance for role not found");return await E({id:o,api:a})},onSuccess:()=>{e.invalidateQueries({queryKey:["presales","infinite"]})}})},I=()=>{const{role:t}=s(),a=u(t),e=d();return c({mutationFn:async o=>{if(!t||!l.includes(t))throw new Error("Not allowed to delete quotes");if(!a)throw new Error("API instance for role not found");return await N({id:o,api:a})},onSuccess:()=>{e.invalidateQueries({queryKey:["presales","infinite"]})}})},$=()=>{const{role:t}=s(),a=u(t),e=d();return c({mutationFn:async({id:o,mainQuoteName:n})=>{if(!t||!l.includes(t))throw new Error("Not allowed to delete quotes");if(!a)throw new Error("API instance for role not found");return await b({id:o,api:a,mainQuoteName:n})},onSuccess:()=>{e.invalidateQueries({queryKey:["presales","infinite"]})}})},M=()=>{const t=["owner","staff","CTO"],{role:a}=s(),e=u(a);return c({mutationFn:async({id:o,formData:n})=>{if(!a||!t.includes(a))throw new Error("Not allowed to create quotes");if(!e)throw new Error("API instance for role not found");return await P({api:e,id:o,formData:n})},onSuccess:(o,{id:n})=>{m.invalidateQueries({queryKey:["presales","single",n]})}})},R=({isSubmitting:t,formData:a,setModalOpen:e,isEditing:o,setFormData:n,handleSubmit:i})=>r.jsx("div",{className:"fixed inset-0 z-[120] flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:r.jsxs("div",{className:"bg-white rounded-2xl p-8 w-full max-w-md shadow-2xl animate-in zoom-in-95 duration-200",children:[r.jsx("header",{className:"flex justify-between items-center mb-6",children:r.jsxs("h2",{className:"text-xl font-bold flex items-center gap-2 text-gray-900",children:[r.jsx("i",{className:"fas fa-file-signature text-blue-600"}),o&&"Update"," Pre Sales Quote"]})}),r.jsx("div",{className:"space-y-6",children:r.jsxs("div",{children:[r.jsx("label",{className:"text-[10px] font-black text-gray-400 uppercase tracking-[0.2em] mb-2 block",children:"Quote Name"}),r.jsx(h,{autoFocus:!0,className:"w-full p-4 bg-slate-50 border-slate-100 rounded-xl outline-none focus:ring-2 focus:ring-blue-500 font-bold",value:a.mainQuoteName,onChange:w=>n({...a,mainQuoteName:w.target.value}),placeholder:"e.g. Apartment 402 Pre Sales Quote",onKeyDown:w=>{w.key==="Enter"&&a.mainQuoteName&&i()}})]})}),r.jsxs("div",{className:"flex gap-3 mt-10",children:[r.jsx(p,{variant:"outline",className:"flex-1 rounded-xl h-12",onClick:()=>e(!1),disabled:t,children:"Cancel"}),r.jsx(p,{type:"button",isLoading:t,disabled:!a.mainQuoteName||t,className:"flex-1 bg-blue-600 rounded-xl h-12 shadow-lg shadow-blue-100",onClick:i,children:"Create & Configure"})]})]})});export{R as C,I as a,j as b,v as c,M as d,k as e,A as f,$ as g,K as u};
