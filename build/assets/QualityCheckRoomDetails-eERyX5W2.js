import{j as e,u as te,a as re,r as v,b as le}from"./index-BYTWf4fI.js";import{c as ie,d as ce,e as de,f as ne}from"./qualityCheckApi-BiO5ZF1Z.js";import{I as x}from"./Input-ChgExZu6.js";import{S as W,a as L,b as q,c as z,d as U}from"./Select-DzMj40ZL.js";import{t as h}from"./toast-BSC5QTk1.js";import{B as m}from"./Button-aRmNljle.js";import{S as n}from"./Skeleton-Bc8D3KPj.js";import"./useQuery-DFVFWtWl.js";import"./useMutation-sTZCeqmg.js";import"./roleCheck-DhBlwT6t.js";const oe=()=>{const p=Array.from({length:11});return e.jsxs("div",{className:"w-full max-h-full overflow-hidden mx-auto mt-4 bg-white shadow rounded p-6",children:[e.jsx(n,{className:"h-6 w-40 mb-2"}),e.jsx(n,{className:"h-4 w-32 mb-6"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm border border-gray-200 rounded-lg",children:[e.jsx("thead",{children:e.jsx("tr",{className:"bg-gray-100 text-left",children:["Item","Quantity","Unit","Remarks","Actions"].map((o,u)=>e.jsx("th",{className:"p-3",children:e.jsx(n,{className:"h-4 w-20"})},u))})}),e.jsx("tbody",{children:p.map((o,u)=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-3",children:e.jsx(n,{className:"h-4 w-32"})}),e.jsx("td",{className:"p-3",children:e.jsx(n,{className:"h-4 w-12"})}),e.jsx("td",{className:"p-3",children:e.jsx(n,{className:"h-4 w-10"})}),e.jsx("td",{className:"p-3",children:e.jsx(n,{className:"h-4 w-16"})}),e.jsx("td",{className:"p-3",children:e.jsx(n,{className:"h-8 w-8 rounded-full"})})]},u))})]})})]})};function be(){var R,D,P,_,V;const{roomName:p,projectId:o,organizationId:u}=te(),g=decodeURIComponent(p),B=re(),[E,b]=v.useState(null),{role:w,permission:d}=le(),G=w==="owner"||((R=d==null?void 0:d.qualitycheck)==null?void 0:R.delete),F=w==="owner"||((D=d==null?void 0:d.qualitycheck)==null?void 0:D.create),$=w==="owner"||((P=d==null?void 0:d.qualitycheck)==null?void 0:P.edit),{data:k,isLoading:O,error:y,isError:T,refetch:j}=ie(o,g),{mutateAsync:H,isPending:J}=ce(),{mutateAsync:K,isPending:M}=de(),{mutateAsync:X,isPending:Y}=ne(),[a,i]=v.useState({workName:"",status:"pending",remarks:"",file:void 0}),[C,N]=v.useState(!1),[I,S]=v.useState(null),A=(k==null?void 0:k.tasks)||[],Z=async()=>{var s,l;try{if(!a.workName.trim())throw new Error("Work name is mandatory");const t=new FormData;t.append("workName",a.workName),t.append("status",a.status),a.remarks&&t.append("remarks",a.remarks),a.file&&t.append("file",a.file),await H({projectId:o,roomName:g,formData:t}),h({description:"Created successfully",title:"Success"}),f(),j()}catch(t){h({title:"Error",description:((l=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:l.message)||(t==null?void 0:t.message)||"Failed to create item",variant:"destructive"})}},ee=async s=>{var l,t;try{if(!I)return;if(!a.workName.trim())throw new Error("Work name is mandatory");const r=new FormData;r.append("itemId",I),a.workName&&r.append("workName",a.workName),r.append("status",a.status),a.remarks&&r.append("remarks",a.remarks),a.file&&r.append("file",a.file),await K({projectId:o,roomName:g,formData:r,itemId:s},{onSuccess:()=>{f()}}),h({description:"Edited successfully",title:"Success"}),j()}catch(r){h({title:"Error",description:((t=(l=r==null?void 0:r.response)==null?void 0:l.data)==null?void 0:t.message)||(r==null?void 0:r.message)||"Failed to edit item",variant:"destructive"})}},se=async s=>{var l,t;try{await X({projectId:o,roomName:g,itemId:s}),h({description:"Deleted successfully",title:"Success"}),j()}catch(r){h({title:"Error",description:((t=(l=r==null?void 0:r.response)==null?void 0:l.data)==null?void 0:t.message)||r.message||"Failed to delete item",variant:"destructive"})}},f=()=>{i({workName:"",status:"pending",remarks:"",file:void 0}),N(!1),S(null)};return O?e.jsx(oe,{}):(T&&((V=(_=y==null?void 0:y.response)==null?void 0:_.data)!=null&&V.message,m),e.jsxs("div",{className:"w-full h-full",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("h1",{className:"text-xl font-bold mb-4",children:["Room: ",p]}),e.jsx(m,{variant:"primary",className:"h-10",onClick:()=>B(`/${u}/projectdetails/${o}/qualitycheck`),children:"Go Back"})]}),A.length===0&&!C?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("div",{className:"min-w-[900px] grid grid-cols-5 gap-2 font-semibold bg-blue-100 text-blue-900 p-2 rounded",children:[e.jsx("div",{className:"text-center",children:"Work Name"}),e.jsx("div",{className:"text-center",children:"Status"}),e.jsx("div",{className:"text-center",children:"Remarks"}),e.jsx("div",{className:"text-center",children:"Upload"}),e.jsx("div",{className:"text-center",children:"Actions"})]})}),e.jsxs("div",{className:"flex flex-col items-center justify-center p-12 shadow rounded-lg bg-white",children:[e.jsx("i",{className:"fas fa-check-double text-3xl text-blue-400 mb-2"}),e.jsx("p",{className:"text-blue-600 mb-4 text-sm",children:"No items added yet for this room."}),e.jsxs(m,{onClick:()=>N(!0),variant:"primary",children:[e.jsx("i",{className:"fas fa-plus mr-2"})," Add Item"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsxs("div",{className:"min-w-[900px]",children:[e.jsxs("div",{className:"grid grid-cols-5 text-blue-900 gap-2 font-semibold bg-blue-100 p-2 rounded-t",children:[e.jsx("div",{className:"text-center",children:"Work Name"}),e.jsx("div",{className:"text-center",children:"Status"}),e.jsx("div",{className:"text-center",children:"Remarks"}),e.jsx("div",{className:"text-center",children:"Upload"}),e.jsx("div",{className:"text-center",children:"Actions"})]}),e.jsx("div",{className:"overflow-y-auto relative z-[10] max-h-[70vh] sm:max-h-[75vh] md:max-h-[80vh] lg:max-h-[45vh] xl:max-h-[77vh]",children:A.map((s,l)=>{var t,r;return I===s._id?e.jsxs("div",{className:"grid grid-cols-5 gap-2 px-4 py-3 border-b border-gray-200 items-center bg-white",children:[e.jsx(x,{value:a.workName,placeholder:"Work Name",onChange:c=>i({...a,workName:c.target.value})}),e.jsx("div",{className:"relative z-50",children:e.jsxs(W,{value:a.status,onValueChange:c=>i({...a,status:c}),children:[e.jsx(L,{selectedValue:a.status,children:e.jsx(q,{selectedValue:a.status,placeholder:"Select status"})}),e.jsx(z,{children:["pass","fail","pending"].map(c=>e.jsx(U,{value:c,children:c},c))})]})}),e.jsx(x,{value:a.remarks,placeholder:"Remarks",onChange:c=>i({...a,remarks:c.target.value})}),e.jsx("div",{className:"flex flex-col items-center gap-1",children:e.jsx(x,{type:"file",accept:"image/*",onChange:c=>{var Q;const ae=(Q=c.target.files)==null?void 0:Q[0];i({...a,file:ae})}})}),e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsxs(m,{variant:"primary",isLoading:M,onClick:()=>ee(s._id),className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded",children:[e.jsx("i",{className:"fas fa-save mr-1"})," Save"]}),e.jsxs(m,{variant:"secondary",onClick:f,className:"bg-gray-400 text-white px-3 py-1 rounded",children:[e.jsx("i",{className:"fas fa-times mr-1"})," Cancel"]})]})]},s._id+l):e.jsxs("div",{className:"grid grid-cols-5 gap-2 px-4 py-3 border-b border-gray-200 items-center bg-white",children:[e.jsx("div",{className:"text-center",children:s.workName||"N/A"}),e.jsx("div",{className:"text-center",children:s.status||"N/A"}),e.jsx("div",{className:"text-center",children:s.remarks||"N/A"}),e.jsx("div",{className:"text-center",children:((t=s.upload)==null?void 0:t.type)==="image"?e.jsx("img",{src:s.upload.url,alt:"Preview",className:"w-10 h-10 object-cover rounded border cursor-pointer mx-auto",onClick:()=>b(s.upload.url)}):((r=s.upload)==null?void 0:r.type)==="pdf"?e.jsx("a",{href:s.upload.url,target:"_blank",rel:"noreferrer",className:"text-blue-600 underline",children:"View PDF"}):"No Image"}),e.jsxs("div",{className:"flex gap-2 justify-center",children:[$&&e.jsxs("button",{onClick:()=>{S(s._id),N(!1),i({workName:s.workName||"",status:s.status||"pending",remarks:s.remarks||"",file:void 0})},className:"bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded",children:[e.jsx("i",{className:"fas fa-edit mr-1"})," Edit"]}),G&&e.jsxs(m,{variant:"danger",isLoading:Y,onClick:()=>se(s._id),className:"bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded",children:[e.jsx("i",{className:"fas fa-trash mr-1"})," Delete"]})]})]},s._id+l)})}),C&&e.jsxs("div",{className:"grid grid-cols-5 gap-2 px-4 py-3 bg-white border-b border-gray-200 items-center",children:[e.jsx(x,{placeholder:"Work Name",value:a.workName,onChange:s=>i({...a,workName:s.target.value})}),e.jsxs(W,{value:a.status,onValueChange:s=>i({...a,status:s}),children:[e.jsx(L,{children:e.jsx(q,{selectedValue:a.status,placeholder:"Select status"})}),e.jsx(z,{children:["pass","fail","pending"].map(s=>e.jsx(U,{value:s,children:s},s))})]}),e.jsx(x,{placeholder:"Remarks",value:a.remarks,onChange:s=>i({...a,remarks:s.target.value})}),e.jsx("div",{className:"flex flex-col items-center gap-1",children:e.jsx(x,{type:"file",accept:"image/*",onChange:s=>{var t;const l=(t=s.target.files)==null?void 0:t[0];i({...a,file:l})}})}),e.jsx("div",{className:"flex gap-2 justify-center",children:F&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:Z,className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded",children:[e.jsx("i",{className:"fas fa-save mr-1"})," Save"]}),e.jsxs("button",{onClick:f,className:"bg-gray-400 text-white px-3 py-1 rounded",children:[e.jsx("i",{className:"fas fa-times mr-1"})," Cancel"]})]})})]})]})}),!C&&A.length>0&&e.jsx("div",{className:"mt-4",children:F&&e.jsxs(m,{isLoading:J,variant:"primary",onClick:()=>{N(!0),S(null),i({workName:"",status:"pending",remarks:"",file:void 0})},children:[e.jsx("i",{className:"fas fa-plus mr-2"})," Add Item"]})})]}),E&&e.jsx("div",{onClick:()=>b(null),className:"fixed inset-0 z-50 bg-black/70 bg-opacity-60 flex items-center justify-center",children:e.jsxs("div",{onClick:s=>s.stopPropagation(),className:"relative bg-white rounded p-4 max-w-[90vw] max-h-[80vh] shadow-lg",children:[e.jsx("i",{className:"fas fa-times absolute top-2 right-3 text-xl text-gray-700 hover:text-red-500 cursor-pointer",onClick:()=>b(null)}),e.jsx("img",{src:E,alt:"Full View",className:"max-h-[70vh] w-auto object-contain rounded"})]})})]}))}export{be as default};
