import{r as y,u as F,j as e,a as B,d as I,b as k,O as z}from"./index-PP9bwaFb.js";import{e as T,f as q,g as V,h as W,i as Y}from"./materialSelectionApi-BTmHNHrl.js";import{t as d}from"./toast-BSC5QTk1.js";import{B as j}from"./Button-De5O-mHo.js";import{C as H}from"./Card-gvD20p1g.js";import{A as J,S as K}from"./AssignStaff-CmYESkpA.js";import Q from"./MaterialOverviewLoading-DX9W2li4.js";import{R as X}from"./ResetStageButton-CM5VSQE2.js";import{S as Z}from"./ShareDocumentWhatsapp-CB8_nB23.js";import{d as ee}from"./downloadFile-CTU6Oetr.js";import"./roleCheck-BSRkLz35.js";import"./useQuery-Crlnn1zB.js";import"./useBaseQuery--We87FtY.js";import"./useMutation-CnbKwdgs.js";import"./Input-_X1NL7t9.js";import"./getAllUsersApi-I1nnZEum.js";import"./Skeleton-Yn6Ls0QM.js";import"./documentationApi-D9Ke8zDL.js";import"./requirementFormApi-D8xGCl0z.js";const te=({room:a,projectId:v,packageId:c,roomType:f})=>{var h;const g=F(),{mutateAsync:w,isPending:s}=T(),p=async r=>{var m,b;r.stopPropagation();try{if(!confirm("Are you sure you need to delete the room?"))return;if(!c){d({title:"Error",description:"Package is not selected",variant:"destructive"});return}await w({projectId:v,roomId:a._id,packageId:c}),d({title:"Success",description:"Room deleted successfully"})}catch(u){d({title:"Error",description:((b=(m=u==null?void 0:u.response)==null?void 0:m.data)==null?void 0:b.message)||"Failed to delete the room",variant:"destructive"})}},t=f==="customRoom"?a.items:a.roomFields;return e.jsxs("div",{onClick:()=>g(`materialroom/${a._id}/${f}/${c}`),className:"border-l-4 border-blue-600 cursor-pointer shadow-sm hover:shadow-md transition-all duration-200 rounded-lg p-4 bg-white flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:a.name}),e.jsxs("p",{className:"text-sm text-blue-500",children:["No of Fields: ",(h=Object.keys(t||{}))==null?void 0:h.length]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsx("button",{onClick:r=>{r.stopPropagation(),g(`materialroom/${a._id}/${f}/${c}`)},className:"text-sm text-blue-600 underline hover:no-underline cursor-pointer",children:"View →"}),e.jsxs(j,{variant:"danger",size:"sm",onClick:p,disabled:s,className:"flex items-center gap-1 px-2 py-1 text-sm hover:text-white",children:[e.jsx("i",{className:"fas fa-trash"})," Delete"]})]})]})},se=y.memo(te);function Ne(){var C,M,A,R,$,L,_;const{projectId:a,organizationId:v}=B(),{isMobile:c,openMobileSidebar:f}=I(),g=k(),w=F(),[s,p]=y.useState(null),{data:t,isLoading:h,error:r,refetch:m}=q(a),{mutateAsync:b,isPending:u}=V(),{mutateAsync:P,isPending:U}=W(),{mutateAsync:O,isPending:S}=Y();y.useEffect(()=>{var i,n;if(!s&&((i=t==null?void 0:t.package)!=null&&i.length)){const l=(n=t==null?void 0:t.package)==null?void 0:n.find(o=>(o==null?void 0:o.level)==="economy");l&&p({level:l.level,id:l._id})}},[t,s]);const N=(C=t==null?void 0:t.package)==null?void 0:C.find(i=>i._id===(s==null?void 0:s.id)),x=(N==null?void 0:N.rooms)||[];if(h)return e.jsx(Q,{});const D=g.pathname.includes("/materialroom"),G=async()=>{var i,n;try{await P({projectId:a}),d({description:"Completion status updated successfully",title:"Success"}),w("../costestimation")}catch(l){d({title:"Error",description:((n=(i=l==null?void 0:l.response)==null?void 0:i.data)==null?void 0:n.message)||l.message||"Failed to update completion status",variant:"destructive"})}},E=async()=>{var i,n;try{const l=await O({projectId:a});ee({src:l==null?void 0:l.url,alt:"home-material-selection"}),d({title:"Success",description:"Pdf Generated successfully"}),m()}catch(l){d({title:"Error",description:((n=(i=l==null?void 0:l.response)==null?void 0:i.data)==null?void 0:n.message)||(l==null?void 0:l.message)||"Failed to generate link",variant:"destructive"})}};return e.jsx("div",{className:"flex flex-col h-full w-full  py-2",children:D?e.jsx(z,{}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4 mb-4",children:[e.jsxs("h2",{className:"text-2xl sm:text-3xl font-semibold text-blue-600 flex items-center",children:[c&&e.jsx("button",{onClick:f,className:"mr-3 p-2 rounded-md border-gray-300 hover:bg-gray-100",title:"Open Menu",children:e.jsx("i",{className:"fa-solid fa-bars"})}),e.jsx("i",{className:"fas fa-box mr-2"})," Material Selection"]}),e.jsxs("div",{className:"!w-[100%] sm:!w-[100%] lg:!w-[50%] xl:!w-[65%]  flex flex-col sm:flex-row gap-3 justify-end",children:[e.jsx("div",{className:"flex flex-wrap  md:flex-nowrap gap-2 justify-end",children:e.jsxs(j,{isLoading:U,onClick:G,className:"bg-green-600 hover:bg-green-700 text-white flex-1 sm:flex-initial min-w-max",children:[e.jsx("i",{className:"fa-solid fa-circle-check mr-2"}),"Mark Complete"]})}),e.jsxs("div",{className:"flex flex-wrap md:flex-nowrap gap-2 justify-end",children:[e.jsx(X,{projectId:a,stageNumber:5,stagePath:"materialconfirmation",className:"flex-1 sm:flex-initial min-w-max"}),!r&&e.jsx(Z,{projectId:a,stageNumber:"5",className:"w-full sm:w-fit",isStageCompleted:t==null?void 0:t.status}),e.jsx(J,{stageName:"MaterialRoomConfirmationModel",projectId:a,organizationId:v,currentAssignedStaff:(t==null?void 0:t.assignedTo)||null,className:"flex-1 sm:flex-initial min-w-max"})]})]})]}),r&&e.jsxs("div",{className:"max-w-xl mx-auto p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center mb-4",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2",children:"⚠️ Error Occurred"}),e.jsx("p",{className:"text-red-500 text-sm mb-4",children:((A=(M=r==null?void 0:r.response)==null?void 0:M.data)==null?void 0:A.message)||(r==null?void 0:r.message)||"Failed to load room data"}),e.jsx(j,{onClick:()=>m(),className:"bg-red-600 text-white px-4 py-2",children:"Retry"})]}),e.jsx("div",{className:"flex-grow min-h-0 flex flex-col",children:!r&&e.jsxs(e.Fragment,{children:[e.jsxs(H,{className:"p-4 mb-4 w-full shadow border-l-4 border-blue-600 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-3 text-blue-700 text-sm font-medium mb-2",children:[e.jsx("i",{className:"fa-solid fa-clock text-blue-500 text-lg"}),e.jsx("span",{children:"Stage Timings"})]}),e.jsx(K,{completedAt:(R=t==null?void 0:t.timer)==null?void 0:R.completedAt,stageName:"materialconfirmation",projectId:a,formId:t==null?void 0:t._id,deadLine:($=t==null?void 0:t.timer)==null?void 0:$.deadLine,startedAt:(L=t==null?void 0:t.timer)==null?void 0:L.startedAt,refetchStageMutate:m,deadLineMutate:b,isPending:u})]}),e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4 mb-6",children:[e.jsx("div",{className:"flex flex-wrap gap-3",children:(_=t==null?void 0:t.package)==null?void 0:_.map(i=>{const n=(s==null?void 0:s.id)===i._id,o={economy:{bgUnselected:"bg-green-100",textUnselected:"text-green-800",bgSelected:"bg-green-600",textSelected:"text-white",borderSelected:"border-green-700"},premium:{bgUnselected:"bg-amber-100",textUnselected:"text-amber-800",bgSelected:"bg-amber-500",textSelected:"text-white",borderSelected:"border-amber-600"},luxury:{bgUnselected:"bg-violet-100",textUnselected:"text-violet-800",bgSelected:"bg-violet-600",textSelected:"text-white",borderSelected:"border-violet-700"}}[i.level];return e.jsxs("div",{onClick:()=>p({level:i.level,id:i._id}),className:`
            min-w-[120px] px-5 py-3 rounded-md text-sm font-semibold text-center capitalize
            border-2 cursor-pointer select-none transition-all duration-200 shadow-sm
            ${n?`${o.bgSelected} ${o.textSelected} ${o.borderSelected} border`:`${o.bgUnselected} ${o.textUnselected} border-transparent hover:brightness-95`}
          `,children:[e.jsx("i",{className:"fa-solid fa-box-open mr-2"}),i.level]},i._id)})}),e.jsx("div",{children:e.jsxs(j,{isLoading:S,className:"bg-blue-600 hover:bg-blue-700 text-white px-5 py-2 rounded-md shadow-md transition",onClick:E,children:[e.jsx("i",{className:"fas fa-file-pdf mr-2"}),S?"Generating...":"Generate Comparison PDF"]})})]}),e.jsxs("h1",{className:"text-lg text-gray-600 font-bold",children:["Rooms  ",s?`for ${(s==null?void 0:s.level[0].toUpperCase())+(s==null?void 0:s.level.slice(1))}`:""," "]}),e.jsxs("div",{className:"flex-grow min-h-[100%] py-2 sm:!min-h-0  overflow-y-auto",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:x==null?void 0:x.map(i=>e.jsx(se,{roomType:"predefinedRoom",packageId:(s==null?void 0:s.id)||null,room:i,projectId:a},i._id))}),(x==null?void 0:x.length)===0&&e.jsx("div",{className:"h-full flex items-center justify-center py-8",children:e.jsxs("div",{className:"text-center max-w-md mx-auto",children:[e.jsx("i",{className:"fas fa-door-open text-5xl sm:text-6xl text-blue-300 mb-4"}),e.jsx("h2",{className:"text-xl sm:text-2xl font-semibold text-gray-700 mb-2",children:"No Rooms Created Yet"}),e.jsx("p",{className:"text-gray-500",children:"Add rooms in client requirement stage and complete the stage"})]})})]})]})})]})})}export{Ne as default};
