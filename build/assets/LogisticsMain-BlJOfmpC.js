import{a as I,b as E,j as e,B as h,t as A,u as O,f as z,r as k,O as M,M as B}from"./index-hYGmCEO1.js";import{u as G,a as T,L as R}from"./LogisticsShipmentForm-BuvdhfmR.js";import{u as V}from"./projectApi-Gwage_AH.js";import{C as H,b as U,d as $,a as q}from"./Card-ChYAICVg.js";import{S as J}from"./StageGuide-BKWoPeLK.js";import"./Label-hkBviWcw.js";const K=({s:t,organizationId:p,setEditingShipment:j,setShowForm:i})=>{var g,d,r,f,u;const b=I(),{mutateAsync:N,isPending:a}=G(),{role:n,permission:l}=E(),v=n==="owner"||((g=l==null?void 0:l.logistics)==null?void 0:g.delete),y=n==="owner"||((d=l==null?void 0:l.logistics)==null?void 0:d.edit),x=async w=>{var o,S;try{await N({shipmentId:w,organizationId:p}),A({title:"success",description:"Deleted Successfully"})}catch(m){A({title:"Error",description:((S=(o=m==null?void 0:m.response)==null?void 0:o.data)==null?void 0:S.message)||"Failed to delete",variant:"destructive"})}};return e.jsxs(H,{className:"border-l-4 border-blue-600",children:[e.jsx(U,{children:e.jsx($,{children:t.shipmentNumber||"Untitled Shipment"})}),e.jsxs(q,{className:"space-y-1 text-sm text-blue-950",children:[e.jsxs("p",{children:[e.jsx("i",{className:"fas fa-stream mr-1 text-gray-500"}),e.jsx("span",{className:"font-medium text-gray-700",children:"Status:"})," ",t.shipmentStatus]}),e.jsxs("p",{children:[e.jsx("i",{className:"fas fa-truck mr-1 text-gray-500"}),e.jsx("span",{className:"font-medium text-gray-700",children:"Vehicle:"})," ",((r=t.vehicleDetails)==null?void 0:r.vehicleNumber)||"N/A"]}),e.jsxs("p",{children:[e.jsx("i",{className:"fas fa-map-marker-alt mr-1 text-gray-500"}),e.jsx("span",{className:"font-medium text-gray-700",children:"From:"})," ",((f=t.origin)==null?void 0:f.address)||"-"]}),e.jsxs("p",{children:[e.jsx("i",{className:"fas fa-location-arrow mr-1 text-gray-500"}),e.jsx("span",{className:"font-medium text-gray-700",children:"To:"})," ",((u=t.destination)==null?void 0:u.address)||"-"]}),e.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[e.jsxs(h,{size:"sm",variant:"primary",onClick:()=>b(`sub/${t._id}`),children:[e.jsx("i",{className:"fas fa-eye mr-1"}),"View"]}),y&&e.jsxs(h,{size:"sm",variant:"secondary",onClick:()=>{j(t),i(!0)},children:[e.jsx("i",{className:"fas fa-edit mr-1"}),"Edit"]}),v&&e.jsxs(h,{size:"sm",isLoading:a,variant:"danger",onClick:()=>x(t._id),className:"text-white bg-red-600",children:[e.jsx("i",{className:"fas fa-trash mr-1"}),"Delete"]})]})]})]})},se=()=>{var D,F,L,_;const{organizationId:t}=O(),p=z(),{role:j,permission:i}=E(),b=j==="owner"||((D=i==null?void 0:i.logistics)==null?void 0:D.create),N=j==="owner"||((F=i==null?void 0:i.logistics)==null?void 0:F.list),[a,n]=k.useState({status:"",projectId:"",projectName:"",scheduledDate:""}),{data:l,isLoading:v,isError:y,error:x,refetch:g}=T(t,a),{data:d}=V(t),r=d==null?void 0:d.map(s=>({_id:s._id,projectName:s.projectName})),[f,u]=k.useState(null),[w,o]=k.useState(!1);if(p.pathname.includes("sub"))return e.jsx(M,{});const m=Object.values(a).filter(Boolean).length,P=()=>{n({status:"",projectId:"",projectName:"",scheduledDate:""})};return e.jsxs("div",{className:"p-2 space-y-6 h-full",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-dolly mr-3 text-blue-600"}),"Logistics Department"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your material transport"})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[b&&e.jsxs(h,{onClick:()=>{u(null),o(!0)},children:[e.jsx("i",{className:"fas fa-plus mr-2"}),"Add Shipment"]}),e.jsx("div",{className:"w-full sm:w-auto flex justify-end sm:block",children:e.jsx(J,{organizationId:t,stageName:"logistics"})})]})]}),v?e.jsx(B,{}):y?e.jsxs("div",{className:"max-w-xl sm:min-w-[80%]  mx-auto mt-4 p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2 text-xl sm:text-3xl",children:"âš ï¸ Error Occurred"}),e.jsx("p",{className:"text-red-500  mb-4 text-lg sm:text-xl",children:((_=(L=x==null?void 0:x.response)==null?void 0:L.data)==null?void 0:_.message)||"Failed to load data"}),e.jsx(h,{onClick:()=>g(),className:"bg-red-600 text-white px-4 py-2",children:"Retry"})]}):e.jsxs("main",{className:"flex gap-2 h-[90%]",children:[e.jsx("div",{className:"xl:w-80 flex-shrink-0",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-filter mr-2 text-blue-600"}),"Filters"]}),m>0&&e.jsxs("button",{onClick:P,className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:["Clear All (",m,")"]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsxs("select",{value:a.status||"",onChange:s=>n(c=>({...c,status:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"assigned",children:"Assigned"}),e.jsx("option",{value:"delivered",children:"Delivered"}),e.jsx("option",{value:"in_transit",children:"In Transit"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Schedule Date"}),e.jsx("input",{type:"date",onChange:s=>n(c=>({...c,scheduledDate:s.target.value})),value:a.scheduledDate,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Project"}),e.jsx("select",{value:(a==null?void 0:a.projectId)||"",onChange:s=>{const c=r==null?void 0:r.find(C=>C._id===s.target.value);c&&n(C=>({...C,projectId:c._id,projectName:c.projectName}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:r==null?void 0:r.map(s=>e.jsx("option",{value:s._id,children:s.projectName},s._id))})]})]})]})}),N&&e.jsx(e.Fragment,{children:l.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[300px] w-full bg-white rounded-xl   text-center p-6",children:[e.jsx("i",{className:"fas fa-box-open text-5xl text-blue-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-1",children:"No Shipments Found"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Looks like there are no logistics shipments yet for this project.",e.jsx("br",{}),"Click on ",e.jsx("strong",{children:"Add Shipment"})," to get started ðŸš€"]})]}):e.jsx("div",{className:"flex-1 max-h-[100%] overflow-y-auto",children:e.jsx("div",{className:"grid gap-6 grid-cols-1 sm:grid-cols-2 xl:grid-cols-2 ",children:l.map(s=>e.jsx(e.Fragment,{children:e.jsx(K,{s,organizationId:t,setEditingShipment:u,setShowForm:o},s._id)}))})})})]}),w&&e.jsx(R,{shipment:f,onClose:()=>{o(!1)},organizationId:t})]})};export{se as default};
