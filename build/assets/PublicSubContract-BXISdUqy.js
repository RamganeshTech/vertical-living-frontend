import{u as T,l as q,j as e,r as m,I as o,B as y,t as d}from"./index-MXS_gbde.js";import{h as U,f as M,i as G}from"./subContractNewApi-GnZAz7yy.js";import{C,b as k,d as w,a as W}from"./Card-L4jLwmC3.js";import{L as n}from"./Label-BYfdMzSb.js";import{I as A}from"./ImageGalleryMain-LKPoIxi9.js";import{d as F}from"./dateFormator-BGKi5rfZ.js";import"./downloadFile-BskFWteI.js";import"./index-BDg928G7.js";const X=()=>{var j,N,v;const{subContractId:c}=T(),[O]=q(),p=O.get("token");if(!p)return e.jsx("div",{children:e.jsx("p",{children:"Check the link is correct, Token is missing"})});const x=U(),f=M(),{data:t,isLoading:S}=G({subContractId:c}),[r,l]=m.useState({dateOfCommencement:"",dateOfCompletion:"",workerName:"",labourCost:"",materialCost:"",totalCost:"",files:[]}),[u,g]=m.useState([]),[i,D]=m.useState({});m.useEffect(()=>{if(t){const s=a=>a?new Date(a).toISOString().split("T")[0]:"";l({dateOfCommencement:s(t.dateOfCommencement),dateOfCompletion:s(t.dateOfCompletion),workerName:t.workerName||"",labourCost:t.labourCost||0,materialCost:t.materialCost||0,totalCost:t.totalCost||0,files:t.filesBeforeWork||[]}),g(t.filesAfterWork||[])}},[t]);const P=()=>{const s={};return r.workerName||(s.workerName="Worker name is required"),r.dateOfCommencement||(s.dateOfCommencement="Commencement date is required"),r.dateOfCompletion||(s.dateOfCompletion="Completion date is required"),(!r.labourCost||Number(r.labourCost)<=0)&&(s.labourCost="Valid labour cost is required"),(!r.materialCost||Number(r.materialCost)<=0)&&(s.materialCost="Valid material cost is required"),D(s),Object.keys(s).length===0},I=async s=>{if(s.preventDefault(),!!P())try{const a=Number(r.labourCost)+Number(r.materialCost);await x.mutateAsync({token:p,subContractId:c,workerData:{dateOfCommencement:r.dateOfCommencement,dateOfCompletion:r.dateOfCompletion,workerName:r.workerName,labourCost:Number(r.labourCost),materialCost:Number(r.materialCost),totalCost:a,status:"pending"},files:r.files}),d({title:"Success",description:"Work information submitted successfully"})}catch(a){d({title:"Error",description:(a==null?void 0:a.message)||"Failed to submit information",variant:"destructive"})}},B=async()=>{if(u.length===0){d({title:"Error",description:"Please upload at least one file",variant:"destructive"});return}try{await f.mutateAsync({subContractId:c,files:u}),d({title:"Success",description:"After work files uploaded successfully"})}catch(s){d({title:"Error",description:(s==null?void 0:s.message)||"Failed to upload files",variant:"destructive"})}},b=(s,a)=>{const h=Array.from(s.target.files||[]);a==="before"?l(L=>({...L,files:h})):g(h)},E=()=>{const s=Number(r.labourCost)||0,a=Number(r.materialCost)||0;return s+a};if(S)return e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx("i",{className:"fas fa-spinner fa-spin text-4xl text-blue-600"})});const $=()=>{const{workOrderCreatedBy:s}=t;return s!=null&&s.username?s==null?void 0:s.username:s!=null&&s.staffName?s==null?void 0:s.staffName:s!=null&&s.CTOName?s==null?void 0:s.CTOName:""};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("header",{className:"bg-white border-b border-gray-200 sticky top-0 z-10 shadow-sm",children:[e.jsx("div",{className:"px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-hard-hat mr-3 text-blue-600"}),"Sub Contract Work Portal"]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Submit your work details and upload documentation"})]})}),(t==null?void 0:t.status)&&e.jsxs("div",{className:`px-4 py-2 rounded-lg text-sm font-semibold flex items-center gap-2
                ${t.status==="pending"?"bg-blue-50 text-blue-700 border border-blue-200":t.status==="accepted"?"bg-blue-100 text-blue-800 border border-blue-300":"bg-gray-100 text-gray-700 border border-gray-300"}`,children:[e.jsx("i",{className:`fas ${t.status==="pending"?"fa-clock":t.status==="accepted"?"fa-check-circle":"fa-times-circle"}`}),e.jsx("span",{className:"hidden sm:inline",children:"Status:"})," ",t.status.toUpperCase()]})]})})}),e.jsx("div",{className:"bg-blue-600 text-white",children:e.jsx("div",{className:"px-4 sm:px-6 lg:px-8 py-3",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-project-diagram text-blue-200"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-xs text-blue-200",children:"Project:"}),e.jsx("span",{className:"font-semibold text-sm",children:((j=t==null?void 0:t.projectId)==null?void 0:j.projectName)||"Loading..."})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-briefcase text-blue-200"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-xs text-blue-200",children:"Work:"}),e.jsx("span",{className:"font-semibold text-sm",children:(t==null?void 0:t.workName)||"Loading..."})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-user-tie text-blue-200"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-xs text-blue-200",children:"Created By:"}),e.jsx("span",{className:"font-semibold text-sm",children:$()||"Loading..."})]})]}),e.jsxs("div",{className:"ml-auto flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center text-xs ${t?"bg-white text-blue-600":"bg-blue-400 text-white"}`,children:t?e.jsx("i",{className:"fas fa-check"}):"1"}),e.jsx("span",{className:"text-xs",children:"Before Work"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center text-xs ${((N=t==null?void 0:t.filesAfterWork)==null?void 0:N.length)>0?"bg-white text-blue-600":"bg-blue-400 text-white"}`,children:((v=t==null?void 0:t.filesAfterWork)==null?void 0:v.length)>0?e.jsx("i",{className:"fas fa-check"}):"2"}),e.jsx("span",{className:"text-xs",children:"After Work"})]})]})]})})})]}),e.jsx("div",{className:"px-4 sm:px-6 lg:px-8 py-6",children:e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[e.jsx("div",{children:e.jsxs(C,{className:"shadow-lg border-0",children:[e.jsx(k,{className:"bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-t-lg",children:e.jsxs(w,{className:"text-lg flex items-center text-white",children:[e.jsx("i",{className:"fas fa-clipboard-check mr-2"}),"Before Work Information"]})}),e.jsx(W,{className:"p-6",children:e.jsxs("form",{onSubmit:I,className:"space-y-5",children:[e.jsxs("div",{children:[e.jsxs(n,{htmlFor:"workerName",className:"text-sm font-medium text-gray-700",children:["Worker Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(o,{id:"workerName",value:r.workerName,onChange:s=>l(a=>({...a,workerName:s.target.value})),placeholder:"Enter your full name",className:`mt-1 ${i.workerName?"border-red-500":""}`}),i.workerName&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:i.workerName})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs(n,{htmlFor:"dateOfCommencement",className:"text-sm font-medium text-gray-700",children:["Start Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(o,{id:"dateOfCommencement",type:"date",value:r.dateOfCommencement,onChange:s=>l(a=>({...a,dateOfCommencement:s.target.value})),className:`mt-1 ${i.dateOfCommencement?"border-red-500":""}`})]}),e.jsxs("div",{children:[e.jsxs(n,{htmlFor:"dateOfCompletion",className:"text-sm font-medium text-gray-700",children:["End Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(o,{id:"dateOfCompletion",type:"date",value:r.dateOfCompletion,onChange:s=>l(a=>({...a,dateOfCompletion:s.target.value})),className:`mt-1 ${i.dateOfCompletion?"border-red-500":""}`})]})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-100",children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-3 text-sm",children:"Cost Breakdown"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-3",children:[e.jsxs("div",{children:[e.jsxs(n,{htmlFor:"labourCost",className:"text-sm text-gray-700",children:["Labour Cost ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"₹"}),e.jsx(o,{id:"labourCost",type:"number",value:r.labourCost,onChange:s=>l(a=>({...a,labourCost:s.target.value})),placeholder:"0",className:`pl-8 mt-1 ${i.labourCost?"border-red-500":""}`})]})]}),e.jsxs("div",{children:[e.jsxs(n,{htmlFor:"materialCost",className:"text-sm text-gray-700",children:["Material Cost ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"₹"}),e.jsx(o,{id:"materialCost",type:"number",value:r.materialCost,onChange:s=>l(a=>({...a,materialCost:s.target.value})),placeholder:"0",className:`pl-8 mt-1 ${i.materialCost?"border-red-500":""}`})]})]})]}),e.jsx("div",{className:"bg-white rounded-lg p-3 border border-blue-200",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600 text-sm",children:"Total Cost"}),e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:["₹ ",E().toLocaleString("en-IN")]})]})})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"beforeFiles",className:"text-sm font-medium text-gray-700",children:"Before Work Photos/Documents"}),e.jsx("div",{className:"mt-1 border-2 border-dashed border-gray-300 rounded-lg p-4 hover:border-blue-400 transition-all",children:e.jsx(o,{id:"beforeFiles",type:"file",multiple:!0,accept:"image/*",onChange:s=>b(s,"before"),className:"cursor-pointer"})})]}),(t==null?void 0:t.filesBeforeWork)&&t.filesBeforeWork.length>0&&e.jsxs("div",{className:"space-y-4 mt-4 p-4 bg-gray-50 rounded-lg",children:[t.filesBeforeWork.some(s=>s.type==="image")&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("i",{className:"fas fa-images text-blue-600"}),e.jsx("h4",{className:"font-semibold text-gray-800 text-sm",children:"Images"}),e.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full",children:t.filesBeforeWork.filter(s=>s.type==="image").length})]}),e.jsx(A,{imageFiles:t.filesBeforeWork.filter(s=>s.type==="image"),height:150,minWidth:150,maxWidth:200})]}),t.filesBeforeWork.some(s=>s.type==="pdf")&&e.jsx("div",{children:e.jsx("div",{className:"space-y-2",children:t.filesBeforeWork.some(s=>s.type==="pdf")&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("i",{className:"fas fa-file-pdf text-red-600"}),e.jsx("h4",{className:"font-semibold text-gray-800 text-sm",children:"Documents"}),e.jsx("span",{className:"text-xs bg-red-100 text-red-700 px-2 py-1 rounded-full",children:t.filesBeforeWork.filter(s=>s.type==="pdf").length})]}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:t.filesBeforeWork.filter(s=>s.type==="pdf").map((s,a)=>e.jsxs("div",{className:"flex items-center gap-4 bg-gradient-to-r from-red-50 to-orange-50 p-4 rounded-lg border border-red-200 hover:shadow-md transition-all group",children:[e.jsx("div",{className:"w-14 h-14 bg-red-100 rounded-lg flex items-center justify-center cursor-pointer hover:bg-red-200 transition-colors",children:e.jsx("i",{className:"fas fa-file-pdf text-red-600 text-2xl"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900 truncate",children:s.originalName||`Document ${a+1}.pdf`}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[e.jsx("i",{className:"far fa-calendar mr-1"}),F(s.uploadedAt)]})]}),e.jsxs("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"px-3 py-2 bg-white text-red-600 rounded-lg hover:bg-red-600 hover:text-white transition-colors font-medium text-sm group-hover:shadow-md",title:"Open in new tab",children:[e.jsx("i",{className:"fas fa-external-link-alt mr-1"}),"Open"]})]},a))})]})})})]}),e.jsx(y,{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700",disabled:x.isPending,children:x.isPending?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin mr-2"}),"Submitting..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-paper-plane mr-2"}),"Submit Before Work Information"]})})]})})]})}),e.jsx("div",{children:e.jsxs(C,{className:"shadow-lg border-0",children:[e.jsx(k,{className:"bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-t-lg",children:e.jsxs(w,{className:"text-lg flex items-center text-white",children:[e.jsx("i",{className:"fas fa-images mr-2"}),"After Work Documentation"]})}),e.jsxs(W,{className:"p-6",children:[(t==null?void 0:t.filesAfterWork)&&t.filesAfterWork.length>0&&e.jsxs("div",{className:"space-y-4 mb-6 p-4 bg-gray-50 rounded-lg",children:[t.filesAfterWork.some(s=>s.type==="image")&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("i",{className:"fas fa-images text-blue-600"}),e.jsx("h4",{className:"font-semibold text-gray-800 text-sm",children:"Images"}),e.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full",children:t.filesAfterWork.filter(s=>s.type==="image").length})]}),e.jsx(A,{imageFiles:t.filesAfterWork.filter(s=>s.type==="image"),height:150,minWidth:150,maxWidth:200})]}),t.filesAfterWork.some(s=>s.type==="pdf")&&e.jsx("div",{children:e.jsx("div",{className:"space-y-2",children:t.filesAfterWork.some(s=>s.type==="pdf")&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("i",{className:"fas fa-file-pdf text-red-600"}),e.jsx("h4",{className:"font-semibold text-gray-800 text-sm",children:"Documents"}),e.jsx("span",{className:"text-xs bg-red-100 text-red-700 px-2 py-1 rounded-full",children:t.filesAfterWork.filter(s=>s.type==="pdf").length})]}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:t.filesAfterWork.filter(s=>s.type==="pdf").map((s,a)=>e.jsxs("div",{className:"flex items-center gap-4 bg-gradient-to-r from-red-50 to-orange-50 p-2 rounded-lg border border-red-200 hover:shadow-md transition-all group",children:[e.jsx("div",{className:"w-14 h-14 bg-red-100 rounded-lg flex items-center justify-center cursor-pointer hover:bg-red-200 transition-colors",children:e.jsx("i",{className:"fas fa-file-pdf text-red-600 text-2xl"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900 truncate",children:s.originalName||`Document ${a+1}.pdf`}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[e.jsx("i",{className:"far fa-calendar mr-1"}),F(s.uploadedAt)]})]}),e.jsxs("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"px-3 py-2 bg-white text-red-600 rounded-lg hover:bg-red-600 hover:text-white transition-colors font-medium text-sm group-hover:shadow-md",title:"Open in new tab",children:[e.jsx("i",{className:"fas fa-external-link-alt mr-1"}),"Open"]})]},a))})]})})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs(n,{htmlFor:"afterFiles",className:"text-sm font-medium text-gray-700",children:["After Work Photos/Documents ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"mt-1 border-2 border-dashed border-gray-300 rounded-lg p-4 hover:border-blue-400 transition-all",children:e.jsx(o,{id:"afterFiles",type:"file",multiple:!0,accept:"image/*,application/pdf",onChange:s=>b(s,"after"),className:"cursor-pointer"})})]}),e.jsx(y,{onClick:B,className:"w-full bg-blue-600 hover:bg-blue-700",disabled:f.isPending,children:f.isPending?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin mr-2"}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-cloud-upload-alt mr-2"}),"Upload After Work Files"]})}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-blue-700 flex items-center",children:[e.jsx("i",{className:"fas fa-info-circle mr-2"}),"Please complete Step 1 first before uploading after work files"]})})]})]})]})})]})})]})};export{X as default};
