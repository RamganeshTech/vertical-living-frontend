import{u as R,a as V,r as g,b as T,j as e,B as $,t as f}from"./index-MXS_gbde.js";import{g as P,h as I}from"./toolOtpApi-BXrWxUiY.js";import{B as H}from"./Breadcrumb-BaXmUmlW.js";const S=()=>{var p,b;const{organizationId:c}=R(),i=V(),[t,h]=g.useState("issue"),{role:m,permission:o}=T(),y=m==="owner"||((p=o==null?void 0:o.toolhardware)==null?void 0:p.create),j=m==="owner"||((b=o==null?void 0:o.toolhardware)==null?void 0:b.edit),v=P(),w=I(),d=t==="issue"?v:w,[l,u]=g.useState(["","","","","",""]),x=g.useRef([]),N=[{label:"Tools & Hardware",path:`/organizations/${c}/projects/toolhub`},{label:"Handover Hub",path:`/organizations/${c}/projects/enterotp`}],k=(a,r)=>{var n;if(!/^\d*$/.test(r))return;const s=[...l];s[a]=r.slice(-1),u(s),r&&a<5&&((n=x.current[a+1])==null||n.focus())},C=(a,r)=>{var s;r.key==="Backspace"&&!l[a]&&a>0&&((s=x.current[a-1])==null||s.focus())},E=async()=>{var r,s;const a=l.join("");if(a.length!==6){f({title:"Incomplete OTP",description:"Please enter all 6 digits",variant:"destructive"});return}try{await d.mutateAsync({otp:a,organizationId:c}),f({title:t==="issue"?"Handover Verified":"Return Verified",description:t==="issue"?"Tool assigned to worker successfully.":"Tool returned to store registry successfully."}),i(-1)}catch(n){f({title:"Verification Failed",description:((s=(r=n==null?void 0:n.response)==null?void 0:r.data)==null?void 0:s.message)||"Invalid or Expired OTP",variant:"destructive"})}};return e.jsxs("div",{className:"flex flex-col h-full w-full bg-gray-50/50",children:[e.jsxs("header",{className:"w-full bg-white border-b border-gray-200 px-8 py-4 flex items-center justify-between sticky top-0 z-10",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("button",{onClick:()=>i(-1),className:"p-2 hover:bg-gray-100 rounded-full transition-colors text-gray-500",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx("span",{className:`w-3 h-3 rounded-full animate-pulse ${t==="issue"?"bg-blue-500":"bg-orange-500"}`}),"Verification Protocol"]}),e.jsx(H,{paths:N})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"flex items-center gap-4 bg-gray-100 p-1.5 rounded-2xl border border-gray-200",children:[e.jsxs("button",{onClick:()=>{h("issue"),u(["","","","","",""])},className:`px-8 py-2.5 cursor-pointer rounded-xl text-sm font-bold transition-all flex items-center gap-2 ${t==="issue"?"bg-blue-600 text-white shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx("i",{className:"fas fa-user-shield"})," ISSUE VERIFY"]}),e.jsxs("button",{onClick:()=>{h("return"),u(["","","","","",""])},className:`px-8 py-2.5 cursor-pointer rounded-xl text-sm font-bold transition-all flex items-center gap-2 ${t==="return"?"bg-orange-600 text-white shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx("i",{className:"fas fa-undo-alt"})," RETURN VERIFY"]})]}),e.jsx("div",{className:"h-8 w-[1px] bg-gray-200 mx-2"}),e.jsx("div",{className:"flex items-center gap-4 bg-gray-100 p-1.5 rounded-2xl border border-gray-200",children:e.jsxs("button",{onClick:()=>i("../issueotp"),className:"px-8 cursor-pointer py-2.5 rounded-xl text-sm font-bold transition-all flex items-center gap-2 text-gray-500 hover:text-gray-700 hover:bg-white",children:[e.jsx("i",{className:"fas fa-paper-plane text-blue-500"}),"GENERATE OTP",e.jsx("i",{className:"fas fa-external-link-alt text-[10px] opacity-50"})]})})]})]}),e.jsxs("div",{className:"max-w-md mx-auto mt-6 w-full bg-white rounded-3xl shadow-xl border border-gray-100 p-8 space-y-8 transition-all",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("div",{className:`w-16 h-16 rounded-2xl flex items-center justify-center mx-auto mb-4 transition-colors ${t==="issue"?"bg-blue-100 text-blue-600":"bg-orange-100 text-orange-600"}`,children:e.jsx("i",{className:`fas ${t==="issue"?"fa-user-shield":"fa-undo-alt"} text-2xl`})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:t==="issue"?"Verify Handover":"Verify Return"}),e.jsx("p",{className:"text-gray-500 text-sm px-4",children:t==="issue"?"Enter the 6-digit code sent to the worker to confirm they received the tool.":"Enter the 6-digit code sent to the worker to confirm they returned the tool."})]}),e.jsx("div",{className:"flex justify-between gap-2 sm:gap-4",children:l.map((a,r)=>e.jsx("input",{ref:s=>{x.current[r]=s},type:"text",inputMode:"numeric",maxLength:1,value:a,onChange:s=>k(r,s.target.value),onKeyDown:s=>C(r,s),className:`w-12 h-14 sm:w-14 sm:h-16 text-center text-2xl font-bold border-2 rounded-xl focus:ring-4 outline-none transition-all text-gray-700 ${t==="issue"?"focus:border-blue-500 focus:ring-blue-100 border-gray-100":"focus:border-orange-500 focus:ring-orange-100 border-gray-100"}`},r))}),(y||j)&&e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsx($,{onClick:E,disabled:d.isPending,className:`w-full h-12 text-white rounded-xl font-bold shadow-lg transition-all ${t==="issue"?"bg-blue-600 hover:bg-blue-700 shadow-blue-200":"bg-orange-600 hover:bg-orange-700 shadow-orange-200"}`,children:d.isPending?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin mr-2"})," Processing..."]}):t==="issue"?"Confirm Handover":"Confirm Collection"}),e.jsx("button",{onClick:()=>i(-1),className:"w-full text-sm text-gray-400 hover:text-gray-600 font-medium",children:"Cancel"})]}),e.jsxs("div",{className:`rounded-xl p-4 flex gap-3 border transition-colors ${t==="issue"?"bg-blue-50 border-blue-100 text-blue-700":"bg-orange-50 border-orange-100 text-orange-700"}`,children:[e.jsx("i",{className:"fas fa-info-circle mt-1"}),e.jsx("p",{className:"text-[11px] leading-tight",children:t==="issue"?"Handover verification moves responsibility of the asset to the worker.":"Return verification inspects the tool condition and clears the worker's record."})]})]})]})};export{S as default};
