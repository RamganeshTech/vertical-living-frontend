import{j as e,u as D,a as L,b as P,r as i,O as _}from"./index-C2yypHlC.js";import{B as A}from"./Button-tnhURsi3.js";import{B as z}from"./Breadcrumb-DGGgdai9.js";import{t as k}from"./toast-BSC5QTk1.js";import{a as $,b as R}from"./vendorAccApi-CSdRskxU.js";import{d as T}from"./dateFormator-BGKi5rfZ.js";import"./useQuery-CXWUgeEV.js";import"./useMutation-5BwurMj6.js";import"./useInfiniteQuery-BGm1jTd_.js";import"./roleCheck-ZvNAcsbM.js";const M=({vendor:t,index:o,onView:c,onDelete:d,isDeleting:x})=>{var n,u;const m=t.firstName||t.lastName?`${t.firstName||""} ${t.lastName||""}`.trim():null,a=((n=t.phone)==null?void 0:n.work)||((u=t.phone)==null?void 0:u.mobile)||null;return e.jsxs("div",{className:"grid  cursor-pointer grid-cols-12 gap-4 px-6 py-4 border-b border-gray-100 hover:bg-[#f9fcff] items-center transition-colors last:border-b-0",onClick:()=>c(t._id),children:[e.jsx("div",{className:"col-span-1 text-center text-gray-600 font-medium ",children:o+1}),e.jsx("div",{className:"col-span-3 truncate font-medium text-gray-900 flex items-center gap-2",children:m?e.jsx("span",{className:"!text-center w-full",children:m}):"-"}),e.jsx("div",{className:"col-span-2 text-sm text-gray-700 truncate text-center",children:t.email?t.email:"-"}),e.jsx("div",{className:"col-span-2 text-sm text-gray-700 truncate text-center",children:a||"-"}),e.jsxs("div",{className:"col-span-2 text-sm text-gray-600 whitespace-nowrap text-center",children:[e.jsx("i",{className:"fas fa-calendar-alt mr-2 text-gray-400"}),T(t.createdAt)]}),e.jsx("div",{className:"col-span-2 flex justify-center gap-2",children:e.jsx("button",{onClick:f=>{f.stopPropagation(),d(t._id)},className:"p-2 text-red-600 hover:bg-red-100 rounded transition",disabled:x,title:"Delete vendor",children:x?e.jsx("i",{className:"fas fa-spinner fa-spin"}):e.jsx("i",{className:"fas fa-trash"})})})]})},X=()=>{const t=D(),o=L(),{organizationId:c}=P(),d=i.useRef(null),x=o.pathname.includes("/vendorsingle")||o.pathname.includes("/create"),m=[{label:"Account",path:`/organizations/${c}/projects/accounting`},{label:"Vendor",path:`/organizations/${c}/projects/vendormain`}],[a,n]=i.useState({search:"",sortBy:"createdAt",sortOrder:"desc"}),[u,f]=i.useState(a.search);i.useEffect(()=>{const s=setTimeout(()=>{f(a.search)},500);return()=>clearTimeout(s)},[a.search]);const{data:p,fetchNextPage:v,hasNextPage:g,isFetchingNextPage:j,isLoading:C,isError:V,error:b,refetch:B}=$({organizationId:c||"",search:u,sortBy:a.sortBy,sortOrder:a.sortOrder,limit:9}),N=R();i.useEffect(()=>{const s=d.current;if(!s)return;const r=()=>{const{scrollTop:h,scrollHeight:l,clientHeight:S}=s;l-h-S<100&&g&&!j&&(console.log("ðŸ“œ Loading more vendors..."),v())};return s.addEventListener("scroll",r),()=>s.removeEventListener("scroll",r)},[g,j,v]);const E=async s=>{var r,h;try{await N.mutateAsync(s),k({title:"Success",description:"vendor deleted successfully"})}catch(l){k({title:"Error",description:((h=(r=l==null?void 0:l.response)==null?void 0:r.data)==null?void 0:h.message)||(l==null?void 0:l.message)||"Failed to delete the vendor",variant:"destructive"})}},F=s=>{t(`vendorsingle/${s}`)},w=Object.values(a).filter(s=>s!==""&&s!=="createdAt"&&s!=="desc").length,O=()=>{n({search:"",sortBy:"createdAt",sortOrder:"desc"})},y=(p==null?void 0:p.pages.flatMap(s=>s.data))||[];return x?e.jsx(_,{}):e.jsxs("div",{className:"space-y-4 h-full",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-users mr-3 text-blue-600"}),"Vendor Accounts"]}),e.jsx(z,{paths:m})]}),e.jsxs(A,{onClick:()=>t("create"),children:[e.jsx("i",{className:"fas fa-plus mr-2"}),"Add Vendor"]})]}),C?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("i",{className:"fas fa-spinner fa-spin text-blue-600 text-4xl"})}):V?e.jsxs("div",{className:"max-w-xl sm:min-w-[80%] mx-auto mt-4 p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2 text-xl sm:text-3xl",children:"âš ï¸ Error Occurred"}),e.jsx("p",{className:"text-red-500 mb-4 text-lg sm:text-xl",children:(b==null?void 0:b.message)||"Failed to load vendors"}),e.jsx(A,{onClick:()=>B(),className:"bg-red-600 text-white px-4 py-2",children:"Retry"})]}):e.jsxs("main",{className:"flex gap-2 !max-h-[90%]",children:[e.jsx("div",{className:"xl:w-80 flex-shrink-0",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx("i",{className:"fas fa-filter mr-2 text-blue-600"}),"Filters"]}),w>0&&e.jsxs("button",{onClick:O,className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:["Clear All (",w,")"]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx("i",{className:"fas fa-search mr-2"}),"Search"]}),e.jsx("input",{type:"text",autoFocus:!0,placeholder:"Name, email, phone...",value:a.search,onChange:s=>n(r=>({...r,search:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sort By"}),e.jsxs("select",{value:a.sortBy,onChange:s=>n(r=>({...r,sortBy:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"createdAt",children:"Created Date"}),e.jsx("option",{value:"firstName",children:"First Name"}),e.jsx("option",{value:"companyName",children:"Company Name"}),e.jsx("option",{value:"email",children:"Email"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sort Order"}),e.jsxs("select",{value:a.sortOrder,onChange:s=>n(r=>({...r,sortOrder:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"desc",children:"Descending"}),e.jsx("option",{value:"asc",children:"Ascending"})]})]})]})]})}),y.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[300px] w-full bg-white rounded-xl text-center p-6",children:[e.jsx("i",{className:"fas fa-user-slash text-5xl text-blue-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-1",children:"No vendorss Found"}),e.jsxs("p",{className:"text-sm text-gray-500",children:[a.search?"Try adjusting your filters to find vendorss.":"Looks like there are no vendorss yet.",e.jsx("br",{}),"Click on ",e.jsx("strong",{children:'"Add vendors"'})," to get started ðŸš€"]})]}):e.jsxs("div",{ref:d,className:"flex-1 max-h-[100%] overflow-y-auto",children:[e.jsx("div",{className:"bg-white rounded-t-xl border border-gray-200 sticky top-0 z-10",children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 px-6 py-4 bg-gradient-to-r from-blue-50 to-indigo-50 font-semibold text-gray-700 text-sm",children:[e.jsx("div",{className:"col-span-1 text-center",children:"S.No"}),e.jsx("div",{className:"col-span-3 text-center",children:"Vendor Name"}),e.jsx("div",{className:"col-span-2 text-center",children:"Email"}),e.jsx("div",{className:"col-span-2 text-center",children:"Phone"}),e.jsx("div",{className:"col-span-2 text-center",children:"Created At"}),e.jsx("div",{className:"col-span-2 text-center",children:"Actions"})]})}),e.jsx("div",{className:"bg-white rounded-b-xl border-x border-b border-gray-200",children:y.map((s,r)=>e.jsx(M,{vendor:s,index:r,onView:()=>F(s._id),onDelete:()=>E(s._id),isDeleting:N.isPending&&N.variables===s._id},s._id))}),j&&e.jsx("div",{className:"flex justify-center py-8",children:e.jsxs("div",{className:"flex items-center gap-2 text-blue-600",children:[e.jsx("i",{className:"fas fa-spinner fa-spin text-2xl"}),e.jsx("span",{className:"text-sm font-medium",children:"Loading more vendors..."})]})}),!g&&y.length>0&&e.jsx("div",{className:"flex justify-center py-6",children:e.jsxs("p",{className:"text-gray-400 text-sm font-medium",children:[e.jsx("i",{className:"fas fa-check-circle mr-2"}),"You've reached the end of the list"]})})]})]})]})};export{X as default};
