import{u as v,q as A,r as k,j as e,c as W,a as ee,g as se,b as te,O as ae,L as le}from"./index-By5P0A7l.js";import{B as w}from"./Button-DLUK8O0t.js";import{g as S}from"./roleCheck-YGaMnK_P.js";import{u as oe}from"./useQuery-Cc7pLKfK.js";import{u as R}from"./useMutation-7YLqc7VE.js";import{t as g}from"./toast-BSC5QTk1.js";import{A as ne,S as ie}from"./AssignStaff-C7He-C4b.js";import{C as G}from"./Card-CFqBlVQz.js";import{d as re}from"./downloadFile-DR20oZne.js";import{I as de}from"./ImageGalleryMain-D80ZvsH6.js";import{R as ce}from"./ResetStageButton-CA9meKIk.js";import me from"./MaterialOverviewLoading-9Ck4pGPe.js";import{S as ue}from"./ShareDocumentWhatsapp-BHtyDj5l.js";import{S as xe}from"./StageGuide-D14I8_Im.js";import"./Input-DKpmFZl7.js";import"./getAllUsersApi-CvFDPW6g.js";import"./index-BQTHaHB-.js";import"./Skeleton-FCBR4RgB.js";import"./documentationApi-yPw3eUgu.js";import"./requirementFormApi-CAQntRac.js";const fe=async({projectId:a,roomName:s,api:t})=>{const{data:l}=await t.post(`/sampledesign/${a}/rooms`,{roomName:s});if(!l.ok)throw new Error(l.message);return l.data},pe=async({projectId:a,roomName:s,files:t,api:l})=>{const o=new FormData;t.forEach(i=>o.append("files",i));const{data:d}=await l.post(`/sampledesign/${a}/rooms/${s}/upload`,o,{headers:{"Content-Type":"multipart/form-data"}});return d.data},he=async({projectId:a,api:s})=>{const{data:t}=await s.get(`/sampledesign/${a}/rooms`);if(!t.ok)throw new Error(t.message);return t.data},ge=async({projectId:a,roomName:s,fileId:t,api:l})=>{const{data:o}=await l.delete(`/sampledesign/${a}/rooms/${s}/delete/${t}`);if(!o.ok)throw new Error(o.message);return o.data},we=async({projectId:a,api:s,roomId:t})=>{const{data:l}=await s.delete(`/sampledesign/${a}/${t}/deleteroom`);if(!l.ok)throw new Error(l.message);return l.data},be=async({projectId:a,api:s})=>{const{data:t}=await s.put(`/sampledesign/completionstatus/${a}`);if(!t.ok)throw new Error(t.message);return t.data},je=async({formId:a,projectId:s,deadLine:t,api:l})=>{const{data:o}=await l.put(`/sampledesign/deadline/${s}/${a}`,{deadLine:t});if(!o.ok)throw new Error(o.message);return o.data},ye=()=>{const a=["owner","staff","CTO","client"],{role:s}=v(),t=S(s);return R({mutationFn:async({projectId:l,roomName:o})=>{if(!s||!a.includes(s))throw new Error("not allowed to make this api call");if(!t)throw new Error("API instance not found for role");return await fe({projectId:l,roomName:o,api:t})},onSuccess:(l,{projectId:o})=>{A.invalidateQueries({queryKey:["sampledesign","roomfiles",o]})}})},Ne=()=>{const a=["owner","staff","CTO","client"],{role:s}=v(),t=S(s);return R({mutationFn:async({projectId:l,roomName:o,files:d})=>{if(!s||!a.includes(s))throw new Error("not allowed to make this api call");if(!t)throw new Error("API instance not found for role");return await pe({projectId:l,roomName:o,files:d,api:t})},onSuccess:(l,{projectId:o})=>{A.invalidateQueries({queryKey:["sampledesign","roomfiles",o]})}})},ve=a=>{const s=["owner","staff","CTO","client"],{role:t}=v(),l=S(t);return oe({queryKey:["sampledesign","roomfiles",a],queryFn:async()=>{if(!t||!s.includes(t))throw new Error("not allowed to make this api call");if(!l)throw new Error("API instance not found for role");return await he({projectId:a,api:l})},retry:!1,refetchOnWindowFocus:!1})},Se=()=>{const a=["owner","staff","CTO","client"],{role:s}=v(),t=S(s);return R({mutationFn:async({projectId:l,roomName:o,fileId:d})=>{if(!s||!a.includes(s))throw new Error("not allowed to make this api call");if(!t)throw new Error("API instance not found for role");return await ge({projectId:l,roomName:o,fileId:d,api:t})},onSuccess:(l,{projectId:o})=>{A.invalidateQueries({queryKey:["sampledesign","roomfiles",o]})}})},Fe=()=>{const a=["owner","staff","CTO","client"],{role:s}=v(),t=S(s);return R({mutationFn:async({projectId:l,roomId:o})=>{if(!s||!a.includes(s))throw new Error("not allowed to make this api call");if(!t)throw new Error("API instance not found for role");return await we({projectId:l,roomId:o,api:t})},onSuccess:(l,{projectId:o})=>{A.invalidateQueries({queryKey:["sampledesign","roomfiles",o]})}})},Re=()=>{const a=["owner","staff","CTO","client"],{role:s}=v(),t=S(s);return R({mutationFn:async({projectId:l})=>{if(!s||!a.includes(s))throw new Error("not allowed to make this api call");if(!t)throw new Error("API instance not found for role");return await be({projectId:l,api:t})},onSuccess:(l,{projectId:o})=>{A.invalidateQueries({queryKey:["sampledesign","roomfiles",o]})}})},Ce=()=>{const a=["owner","staff","CTO"],{role:s}=v(),t=S(s);return R({mutationFn:async({formId:l,projectId:o,deadLine:d})=>{if(!s)throw new Error("not authorized");if(!a.includes(s))throw new Error("you  dont have the access to make this api");if(!t)throw new Error("api is null");return await je({formId:l,projectId:o,deadLine:d,api:t})}})},ke=({isOpen:a,onClose:s,onSubmit:t,addPending:l})=>{const[o,d]=k.useState(""),i=async p=>{p.preventDefault(),await t(o),d(""),s()};return a?e.jsx("div",{onClick:s,className:"fixed inset-0 bg-black/70 bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{onClick:p=>p.stopPropagation(),className:"bg-white rounded-lg p-6 w-[80%] sm:w-[60%] lg:w-full max-w-md",children:[e.jsx("h2",{className:"text-2xl font-bold text-blue-700 mb-4",children:"Add New Room"}),e.jsxs("form",{onSubmit:i,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 mb-2",children:"Room Name"}),e.jsx("input",{type:"text",value:o,onChange:p=>d(p.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{type:"button",onClick:s,className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"Cancel"}),e.jsx(w,{isLoading:l,type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Add Room"})]})]})]})}):null},Ae=({files:a,onUpload:s,onDelete:t,uploadPending:l,deletePending:o})=>{var D,N,f;const{role:d,permission:i}=W(),p=d==="owner"||((D=i==null?void 0:i.sampledesign)==null?void 0:D.delete),j=d==="owner"||((N=i==null?void 0:i.sampledesign)==null?void 0:N.create),y=d==="owner"||((f=i==null?void 0:i.sampledesign)==null?void 0:f.edit),E=k.useRef(null),[F,P]=k.useState([]),I=a.filter(r=>r.type==="pdf"),L=a.filter(r=>r.type==="image"),[C,O]=k.useState(null),M=r=>{var b;(b=r.target.files)!=null&&b.length&&P(Array.from(r.target.files))},n=async()=>{F.length!==0&&await s(F)};return e.jsxs("div",{className:"bg-white h-auto rounded-lg p-2 sm:p-6",children:[e.jsx("div",{className:"flex items-center gap-4 mb-6",children:e.jsx("div",{className:"w-full space-x-2",children:(j||y)&&e.jsxs(e.Fragment,{children:[e.jsx("input",{id:"fileInput",ref:E,type:"file",accept:".pdf,image/*",multiple:!0,className:"mb-1 sm:mb-0 w-[55%] sm:w-[80%] h-full py-2 border-1 px-2 rounded-lg",onChange:M}),e.jsxs(w,{variant:"primary",onClick:()=>{var r;return(r=E.current)==null?void 0:r.click()},className:"",children:[e.jsx("span",{className:"hidden sm:block",children:" Select Files"}),e.jsx("span",{className:"block sm:hidden",children:" Select"})]}),e.jsx(w,{isLoading:l,onClick:n,className:"px-2 sm:px-4 py-2 rounded-lg",variant:"primary",children:"upload"})]})})}),e.jsxs("div",{className:"grid h-auto grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 text-blue-700",children:[e.jsx("i",{className:"fas fa-file-pdf text-lg"}),e.jsx("h3",{className:"font-medium",children:"PDF Files"})]}),e.jsx("div",{className:"max-h-[300px] overflow-y-auto custom-scrollbar max-w-[100%] overflow-x-hidden",children:I.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No PDF files uploaded"}):e.jsx("div",{className:"space-y-2 max-w-[100%]",children:I.map((r,b)=>e.jsxs("div",{className:"flex items-center max-w-full justify-between py-2 px-3 bg-green-50 rounded-lg hover:bg-green-100 transition-colors",children:[e.jsx("span",{className:"text-gray-700 truncate whitespace-wrap max-w-[100%] flex-1 ",children:r.originalName||"Unnamed PDF"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{onClick:()=>re({src:r==null?void 0:r.url,alt:(r==null?void 0:r.originalName)||"file.pdf"}),size:"sm",className:"text-sm",children:e.jsx("i",{className:"fa-solid fa-download"})}),p&&e.jsx(w,{size:"sm",isLoading:o,onClick:()=>t(r._id),title:"Delete",children:e.jsx("i",{className:"fas fa-trash"})})]})]},b))})})]}),e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 text-blue-700",children:[e.jsx("i",{className:"fas fa-images text-lg"}),e.jsx("h3",{className:"font-medium",children:"Image Files"})]}),e.jsx("div",{className:"max-h-[300px] overflow-y-auto custom-scrollbar max-w-[100%] overflow-x-hidden",children:L.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No image files uploaded"}):e.jsx(de,{imageFiles:L,...p?{handleDeleteFile:t}:{},height:80,minWidth:98,maxWidth:100})})]})]}),C&&e.jsx("div",{onClick:()=>O(null),className:"fixed inset-0 bg-black/70 z-50 p-8 bg-opacity-60 flex items-center justify-center",children:e.jsxs("div",{onClick:r=>r.stopPropagation(),className:"relative bg-white rounded py-8 px-4 max-w-[90vw] max-h-[80vh] shadow-lg",children:[e.jsx("i",{className:"fas fa-times absolute top-2 right-3 text-xl text-gray-700 hover:text-red-500 cursor-pointer",onClick:()=>O(null)}),e.jsx("img",{src:C,alt:"Full View",className:"max-h-[70vh] w-auto object-contain rounded"})]})})]})},Je=()=>{var T,$,q,_,z,K,Q,U;const{projectId:a,organizationId:s}=ee(),{isMobile:t,openMobileSidebar:l}=se(),o=te();if(!a)return null;const{role:d,permission:i}=W(),p=d==="owner"||((T=i==null?void 0:i.sampledesign)==null?void 0:T.delete),j=d==="owner"||(($=i==null?void 0:i.sampledesign)==null?void 0:$.create),y=d==="owner"||((q=i==null?void 0:i.sampledesign)==null?void 0:q.edit),[E,F]=k.useState(!1),P=ye(),{mutateAsync:I,isPending:L}=Ne(),C=Se(),{mutateAsync:O,isPending:M}=Fe(),{data:n,isLoading:D,refetch:N,error:f}=ve(a),{mutateAsync:r,isPending:b}=Re(),{mutateAsync:B,isPending:Y}=Ce(),V=async()=>{var c,m;try{b||(await r({projectId:a}),o("../workmainschedule")),g({description:"Completion status updated successfully",title:"Success"})}catch(u){g({title:"Error",description:((m=(c=u==null?void 0:u.response)==null?void 0:c.data)==null?void 0:m.message)||"Failed to update completion status",variant:"destructive"})}},H=async c=>{var m,u;try{await P.mutateAsync({projectId:a,roomName:c}),g({description:"Room Created successfully",title:"Success"})}catch(x){g({title:"Error",description:((u=(m=x==null?void 0:x.response)==null?void 0:m.data)==null?void 0:u.message)||"Failed to create room status",variant:"destructive"})}},J=async c=>{var m,u;try{b||await O({projectId:a,roomId:c}),g({description:"Room section Deleted successfully",title:"Success"})}catch(x){g({title:"Error",description:((u=(m=x==null?void 0:x.response)==null?void 0:m.data)==null?void 0:u.message)||"Failed to delete the room",variant:"destructive"})}},X=async(c,m)=>{var u,x;try{await I({projectId:a,roomName:c,files:m}),g({description:"File uploaded successfully",title:"Success"}),N()}catch(h){g({title:"Error",description:((x=(u=h==null?void 0:h.response)==null?void 0:u.data)==null?void 0:x.message)||(h==null?void 0:h.message)||" Failed to upload the files",variant:"destructive"})}},Z=async(c,m)=>{var u,x;try{await C.mutateAsync({projectId:a,roomName:c,fileId:m}),g({description:"File deleted successfully",title:"Success"}),N()}catch(h){g({title:"Error",description:((x=(u=h==null?void 0:h.response)==null?void 0:u.data)==null?void 0:x.message)||"Failed to delete the files",variant:"destructive"})}};return D?e.jsx(me,{}):location.pathname.includes("shortlist")?e.jsx(ae,{}):e.jsxs("div",{className:"container mx-auto max-h-full overflow-y-auto max-w-full min-h-full",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4 mb-6",children:[e.jsxs("h2",{className:"text-2xl sm:text-2xl lg:text-2xl xl:text-3xl font-semibold text-blue-600 flex items-center",children:[t&&e.jsx("button",{onClick:l,className:"mr-3 p-2 rounded-md  border-gray-300 hover:bg-gray-100",title:"Open Menu",children:e.jsx("i",{className:"fa-solid fa-bars"})}),e.jsx("i",{className:"fa-solid fa-object-group mr-2"}),"Sample Design Files"]}),e.jsxs("div",{className:"!w-[100%] sm:!w-[100%] lg:!w-[50%] xl:!w-[65%] flex flex-col sm:flex-row gap-3 justify-end",children:[e.jsxs("div",{className:"flex  flex-wrap md:flex-nowrap gap-2 justify-end",children:[(j||y)&&e.jsxs(w,{onClick:()=>F(!0),className:"bg-blue-600 hover:bg-blue-700 text-white flex-1 sm:flex-initial min-w-max",disabled:!!f,children:[e.jsx("i",{className:"fas fa-plus mr-2"}),e.jsx("span",{className:"",children:"Add room"})]}),(j||y)&&e.jsxs(w,{isLoading:b,onClick:V,className:"bg-green-600 hover:bg-green-700 text-white flex-1 sm:flex-initial min-w-max",disabled:!!f,children:[e.jsx("i",{className:"fa-solid fa-circle-check mr-2"}),"Mark Complete"]})]}),e.jsxs("div",{className:"flex flex-wrap md:flex-nowrap gap-2 justify-end",children:[(j||y)&&e.jsx(ce,{projectId:a,stageNumber:3,stagePath:"sampledesign",className:"flex-1 sm:flex-initial min-w-max",disabled:!!f}),!f&&(j||y)&&e.jsx(ue,{projectId:a,stageNumber:"3",className:"w-full sm:w-fit",isStageCompleted:n==null?void 0:n.status}),e.jsx(ne,{stageName:"SampleDesignModel",projectId:a,organizationId:s,currentAssignedStaff:(n==null?void 0:n.assignedTo)||null,className:"flex-1 sm:flex-initial min-w-max"}),e.jsx("div",{className:"w-full sm:w-auto flex justify-end sm:block",children:e.jsx(xe,{organizationId:s,stageName:"sampledesign"})})]})]})]}),f&&e.jsxs("div",{className:"max-w-xl mx-auto p-4 bg-red-50 border border-red-200 rounded-lg shadow text-center mb-6",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-2",children:"⚠️ Error Occurred"}),e.jsx("p",{className:"text-red-500 text-sm mb-4",children:((z=(_=f==null?void 0:f.response)==null?void 0:_.data)==null?void 0:z.message)||"Failed to load data"}),e.jsx(w,{onClick:()=>N(),className:"bg-red-600 text-white px-4 py-2",children:"Retry"})]}),!f&&e.jsxs(e.Fragment,{children:[e.jsxs(G,{className:"p-4 mb-6 w-full shadow border-l-4 border-blue-600 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-3 text-blue-700 text-sm font-medium mb-2",children:[e.jsx("i",{className:"fa-solid fa-clock text-blue-500 text-lg"}),e.jsx("span",{children:"Stage Timings"})]}),e.jsx(ie,{stageName:"sampledesign",completedAt:(K=n==null?void 0:n.timer)==null?void 0:K.compltedAt,formId:n==null?void 0:n._id,projectId:a,deadLine:(Q=n==null?void 0:n.timer)==null?void 0:Q.deadLine,startedAt:(U=n==null?void 0:n.timer)==null?void 0:U.startedAt,refetchStageMutate:N,deadLineMutate:B,isPending:Y})]}),e.jsx(G,{className:"mb-6  text-blue-600 border-l-4 border-1 border-blue-600",children:e.jsx(le,{to:"shortlist",children:e.jsxs("div",{className:"py-4 ml-2 flex justify-between items-center",children:[e.jsx("p",{className:"text-md sm:text-xl",children:"Sample Reference Designs"}),e.jsx("i",{className:"mr-4 fas fa-arrow-right text-blue-600"})]})})}),!(n!=null&&n.rooms)||n.rooms.length===0?e.jsxs("div",{className:"text-center py-10 sm:py-16 bg-white rounded-lg shadow-sm",children:[e.jsx("i",{className:"fas fa-home text-blue-200 text-5xl sm:text-6xl mb-4"}),e.jsx("h2",{className:"text-xl sm:text-2xl font-semibold text-gray-700 mb-2",children:"No Rooms Added Yet"}),e.jsx("p",{className:"text-gray-500 mb-6 max-w-md mx-auto",children:"Start by adding a room to upload design files"}),(j||y)&&e.jsxs("button",{onClick:()=>F(!0),className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 min-w-[200px]",children:[e.jsx("i",{className:"fas fa-plus mr-2"}),"Add Your First Room"]})]}):e.jsx("div",{className:"grid grid-cols-1  gap-6",children:n.rooms.map(c=>e.jsxs("div",{className:"bg-white border-l-4 border-blue-600 rounded-xl shadow-sm p-1 sm:p-6 flex flex-col",children:[e.jsxs("div",{className:"flex sm:flex-row items-center justify-between gap-3 mb-4",children:[e.jsxs("h2",{className:"text-xl font-semibold text-blue-700 truncate",children:[e.jsx("i",{className:"fas fa-door-open mr-2"}),c.roomName]}),p&&e.jsxs(w,{isLoading:M,onClick:()=>J(c._id),variant:"danger",className:"bg-red-600 text-white  sm:w-auto mt-2 sm:mt-0",children:[e.jsx("i",{className:"fa-solid fa-trash mr-2"}),"Delete"]})]}),e.jsx("div",{className:"flex-grow",children:e.jsx(Ae,{files:c.files,onUpload:m=>X(c.roomName,m),onDelete:m=>Z(c.roomName,m),uploadPending:L,deletePending:C.isPending})})]},c.roomName))})]}),e.jsx(ke,{isOpen:E,onClose:()=>F(!1),onSubmit:H,addPending:P.isPending})]})};export{Je as default};
